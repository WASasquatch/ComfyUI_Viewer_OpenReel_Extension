const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index5.js","assets/webgpu-renderer-impl.js","assets/canvas2d-fallback-renderer.js","assets/react.js","assets/zustand.js","assets/radix.js","assets/three.js"])))=>i.map(i=>d[i]);
import{r as w,b as He,j as c,_ as hi,S as rS,e as IN,v as DN,f as FN}from"./react.js";import{c as Ta,s as Op,p as nS}from"./zustand.js";import{S as BN,C as aS,a as LN,R as ON,b as $N,c as zN,d as oS,e as cS,P as VN,f as lS,I as dS,g as uS,h as hS,i as pS,L as mS,j as fS,k as UN,T as GN,l as WN,O as gS,m as YN,n as yS,o as qN,p as xS,D as bS,q as HN,r as vS,s as wS,t as XN,u as kS,v as CS,w as SS,x as TS,y as AS,z as jS,A as _S,B as KN,E as QN,F as ES,G as JN,H as MS,J as ZN,K as eR,M as PS,N as tR,Q as NS,U as sR,V as RS,W as IS,X as iR,Y as DS,Z as rR,_ as FS,$ as BS,a0 as nR,a1 as aR,a2 as LS,a3 as oR,a4 as cR,a5 as lR,a6 as OS,a7 as dR,a8 as uR,a9 as $S,aa as hR,ab as zS,ac as pR,ad as mR,ae as fR,af as VS,ag as gR,ah as yR,ai as US,aj as GS,ak as WS,al as YS,am as qS,an as HS,ao as XS,ap as xR,aq as bR,ar as vR}from"./radix.js";import{W as KS,S as QS,O as JS,C as Eu,N as wr,a as mv,M as Sg,A as kc,b as bl,D as vl,P as wl,c as Uo,V as wR,d as kR,B as CR,e as Mu,f as SR,g as TR}from"./three.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var H=typeof window<"u"?window:void 0,$s=typeof globalThis<"u"?globalThis:H;typeof self>"u"&&($s.self=$s),typeof File>"u"&&($s.File=function(){});var ZS=Array.prototype,fv=ZS.forEach,gv=ZS.indexOf,$i=$s?.navigator,Ae=$s?.document,ki=$s?.location,Tg=$s?.fetch,Ag=$s!=null&&$s.XMLHttpRequest&&"withCredentials"in new $s.XMLHttpRequest?$s.XMLHttpRequest:void 0,yv=$s?.AbortController,vi=$i?.userAgent,Ye=H??{},ln={DEBUG:!1,LIB_VERSION:"1.335.2"};function xv(r,e,t,s,i,n,a){try{var o=r[n](a),l=o.value}catch(d){return void t(d)}o.done?e(l):Promise.resolve(l).then(s,i)}function rc(r){return function(){var e=this,t=arguments;return new Promise(function(s,i){var n=r.apply(e,t);function a(l){xv(n,s,i,a,o,"next",l)}function o(l){xv(n,s,i,a,o,"throw",l)}a(void 0)})}}function Ne(){return Ne=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Ne.apply(null,arguments)}function eT(r,e){if(r==null)return{};var t={};for(var s in r)if({}.hasOwnProperty.call(r,s)){if(e.indexOf(s)!==-1)continue;t[s]=r[s]}return t}var AR=["amazonbot","amazonproductbot","app.hypefactors.com","applebot","archive.org_bot","awariobot","backlinksextendedbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","dataforseobot","deepscan","duckduckbot","facebookexternal","facebookcatalog","http://yandex.com/bots","hubspot","ia_archiver","leikibot","linkedinbot","meta-externalagent","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","sebot-wa","sitebulb","slackbot","slurp","trendictionbot","turnitin","twitterbot","vercel-screenshot","vercelbot","yahoo! slurp","yandexbot","zoombot","bot.htm","bot.php","(bot;","bot/","crawler","ahrefsbot","ahrefssiteaudit","semrushbot","siteauditbot","splitsignalbot","gptbot","oai-searchbot","chatgpt-user","perplexitybot","better uptime bot","sentryuptimebot","uptimerobot","headlesschrome","cypress","google-hoteladsverifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleother","google-cloudvertexbot","googleweblight","mediapartners-google","storebot-google","google-inspectiontool","bytespider"],bv=function(r,e){if(e===void 0&&(e=[]),!r)return!1;var t=r.toLowerCase();return AR.concat(e).some(s=>{var i=s.toLowerCase();return t.indexOf(i)!==-1})},jR=["$snapshot","$pageview","$pageleave","$set","survey dismissed","survey sent","survey shown","$identify","$groupidentify","$create_alias","$$client_ingestion_warning","$web_experiment_applied","$feature_enrollment_update","$feature_flag_called"];function ot(r,e){return r.indexOf(e)!==-1}var $p=function(r){return r.trim()},jg=function(r){return r.replace(/^\$/,"")},_R=Array.isArray,tT=Object.prototype,sT=tT.hasOwnProperty,zp=tT.toString,bt=_R||function(r){return zp.call(r)==="[object Array]"},oa=r=>typeof r=="function",Ts=r=>r===Object(r)&&!bt(r),nc=r=>{if(Ts(r)){for(var e in r)if(sT.call(r,e))return!1;return!0}return!1},Te=r=>r===void 0,As=r=>zp.call(r)=="[object String]",_g=r=>As(r)&&r.trim().length===0,jr=r=>r===null,xt=r=>Te(r)||jr(r),kn=r=>zp.call(r)=="[object Number]"&&r==r,tc=r=>kn(r)&&r>0,bn=r=>zp.call(r)==="[object Boolean]",ER=r=>r instanceof FormData,MR=r=>ot(jR,r);function Eg(r){return r===null||typeof r!="object"}function Yh(r,e){return Object.prototype.toString.call(r)==="[object "+e+"]"}function iT(r){return!Te(Event)&&function(e,t){try{return e instanceof t}catch{return!1}}(r,Event)}var PR=[!0,"true",1,"1","yes"],gm=r=>ot(PR,r),NR=[!1,"false",0,"0","no"];function Or(r,e,t,s,i){return e>t&&(s.warn("min cannot be greater than max."),e=t),kn(r)?r>t?(s.warn(" cannot be  greater than max: "+t+". Using max value instead."),t):r<e?(s.warn(" cannot be less than min: "+e+". Using min value instead."),e):r:(s.warn(" must be a number. using max or fallback. max: "+t+", fallback: "+i),Or(i||t,e,t,s))}class RR{constructor(e){this.t={},this.i=e.i,this.o=Or(e.bucketSize,0,100,e.h),this.m=Or(e.refillRate,0,this.o,e.h),this.$=Or(e.refillInterval,0,864e5,e.h)}S(e,t){var s=t-e.lastAccess,i=Math.floor(s/this.$);if(i>0){var n=i*this.m;e.tokens=Math.min(e.tokens+n,this.o),e.lastAccess=e.lastAccess+i*this.$}}consumeRateLimit(e){var t,s=Date.now(),i=String(e),n=this.t[i];return n?this.S(n,s):(n={tokens:this.o,lastAccess:s},this.t[i]=n),n.tokens===0||(n.tokens--,n.tokens===0&&((t=this.i)==null||t.call(this,e)),n.tokens===0)}stop(){this.t={}}}var hr="Mobile",qh="iOS",yn="Android",Nd="Tablet",rT=yn+" "+Nd,nT="iPad",aT="Apple",oT=aT+" Watch",Rd="Safari",Lc="BlackBerry",cT="Samsung",lT=cT+"Browser",dT=cT+" Internet",Ao="Chrome",IR=Ao+" OS",uT=Ao+" "+qh,$y="Internet Explorer",hT=$y+" "+hr,zy="Opera",DR=zy+" Mini",Vy="Edge",pT="Microsoft "+Vy,Cc="Firefox",mT=Cc+" "+qh,Id="Nintendo",Dd="PlayStation",Sc="Xbox",fT=yn+" "+hr,gT=hr+" "+Rd,Gl="Windows",Mg=Gl+" Phone",vv="Nokia",Pg="Ouya",yT="Generic",FR=yT+" "+hr.toLowerCase(),xT=yT+" "+Nd.toLowerCase(),Ng="Konqueror",oi="(\\d+(\\.\\d+)?)",ym=new RegExp("Version/"+oi),BR=new RegExp(Sc,"i"),LR=new RegExp(Dd+" \\w+","i"),OR=new RegExp(Id+" \\w+","i"),Uy=new RegExp(Lc+"|PlayBook|BB10","i"),$R={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},Pu,wv,xm,zR=(r,e)=>e&&ot(e,aT)||function(t){return ot(t,Rd)&&!ot(t,Ao)&&!ot(t,yn)}(r),bT=function(r,e){return e=e||"",ot(r," OPR/")&&ot(r,"Mini")?DR:ot(r," OPR/")?zy:Uy.test(r)?Lc:ot(r,"IE"+hr)||ot(r,"WPDesktop")?hT:ot(r,lT)?dT:ot(r,Vy)||ot(r,"Edg/")?pT:ot(r,"FBIOS")?"Facebook "+hr:ot(r,"UCWEB")||ot(r,"UCBrowser")?"UC Browser":ot(r,"CriOS")?uT:ot(r,"CrMo")||ot(r,Ao)?Ao:ot(r,yn)&&ot(r,Rd)?fT:ot(r,"FxiOS")?mT:ot(r.toLowerCase(),Ng.toLowerCase())?Ng:zR(r,e)?ot(r,hr)?gT:Rd:ot(r,Cc)?Cc:ot(r,"MSIE")||ot(r,"Trident/")?$y:ot(r,"Gecko")?Cc:""},VR={[hT]:[new RegExp("rv:"+oi)],[pT]:[new RegExp(Vy+"?\\/"+oi)],[Ao]:[new RegExp("("+Ao+"|CrMo)\\/"+oi)],[uT]:[new RegExp("CriOS\\/"+oi)],"UC Browser":[new RegExp("(UCBrowser|UCWEB)\\/"+oi)],[Rd]:[ym],[gT]:[ym],[zy]:[new RegExp("(Opera|OPR)\\/"+oi)],[Cc]:[new RegExp(Cc+"\\/"+oi)],[mT]:[new RegExp("FxiOS\\/"+oi)],[Ng]:[new RegExp("Konqueror[:/]?"+oi,"i")],[Lc]:[new RegExp(Lc+" "+oi),ym],[fT]:[new RegExp("android\\s"+oi,"i")],[dT]:[new RegExp(lT+"\\/"+oi)],[$y]:[new RegExp("(rv:|MSIE )"+oi)],Mozilla:[new RegExp("rv:"+oi)]},UR=function(r,e){var t=bT(r,e),s=VR[t];if(Te(s))return null;for(var i=0;i<s.length;i++){var n=s[i],a=r.match(n);if(a)return parseFloat(a[a.length-2])}return null},kv=[[new RegExp(Sc+"; "+Sc+" (.*?)[);]","i"),r=>[Sc,r&&r[1]||""]],[new RegExp(Id,"i"),[Id,""]],[new RegExp(Dd,"i"),[Dd,""]],[Uy,[Lc,""]],[new RegExp(Gl,"i"),(r,e)=>{if(/Phone/.test(e)||/WPDesktop/.test(e))return[Mg,""];if(new RegExp(hr).test(e)&&!/IEMobile\b/.test(e))return[Gl+" "+hr,""];var t=/Windows NT ([0-9.]+)/i.exec(e);if(t&&t[1]){var s=t[1],i=$R[s]||"";return/arm/i.test(e)&&(i="RT"),[Gl,i]}return[Gl,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,r=>{if(r&&r[3]){var e=[r[3],r[4],r[5]||"0"];return[qh,e.join(".")]}return[qh,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,r=>{var e="";return r&&r.length>=3&&(e=Te(r[2])?r[3]:r[2]),["watchOS",e]}],[new RegExp("("+yn+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+yn+")","i"),r=>{if(r&&r[2]){var e=[r[2],r[3],r[4]||"0"];return[yn,e.join(".")]}return[yn,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,r=>{var e=["Mac OS X",""];if(r&&r[1]){var t=[r[1],r[2],r[3]||"0"];e[1]=t.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[IR,""]],[/Linux|debian/i,["Linux",""]]],Cv=function(r){return OR.test(r)?Id:LR.test(r)?Dd:BR.test(r)?Sc:new RegExp(Pg,"i").test(r)?Pg:new RegExp("("+Mg+"|WPDesktop)","i").test(r)?Mg:/iPad/.test(r)?nT:/iPod/.test(r)?"iPod Touch":/iPhone/.test(r)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(r)?oT:Uy.test(r)?Lc:/(kobo)\s(ereader|touch)/i.test(r)?"Kobo":new RegExp(vv,"i").test(r)?vv:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(r)||/(kf[a-z]+)( bui|\)).+silk\//i.test(r)?"Kindle Fire":/(Android|ZTE)/i.test(r)?new RegExp(hr).test(r)&&!/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(r)||/pixel[\daxl ]{1,6}/i.test(r)&&!/pixel c/i.test(r)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(r)||/lmy47v/i.test(r)&&!/QTAQZ3/i.test(r)?yn:rT:new RegExp("(pda|"+hr+")","i").test(r)?FR:new RegExp(Nd,"i").test(r)&&!new RegExp(Nd+" pc","i").test(r)?xT:""},GR=r=>r instanceof Error;function WR(r){var e=globalThis._posthogChunkIds;if(e){var t=Object.keys(e);return xm&&t.length===wv||(wv=t.length,xm=t.reduce((s,i)=>{Pu||(Pu={});var n=Pu[i];if(n)s[n[0]]=n[1];else for(var a=r(i),o=a.length-1;o>=0;o--){var l=a[o],d=l?.filename,u=e[i];if(d&&u){s[d]=u,Pu[i]=[d,u];break}}return s},{})),xm}}class YR{constructor(e,t,s){s===void 0&&(s=[]),this.coercers=e,this.stackParser=t,this.modifiers=s}buildFromUnknown(e,t){t===void 0&&(t={});var s=t&&t.mechanism||{handled:!0,type:"generic"},i=this.buildCoercingContext(s,t,0).apply(e),n=this.buildParsingContext(),a=this.parseStacktrace(i,n);return{$exception_list:this.convertToExceptionList(a,s),$exception_level:"error"}}modifyFrames(e){var t=this;return rc(function*(){for(var s of e)s.stacktrace&&s.stacktrace.frames&&bt(s.stacktrace.frames)&&(s.stacktrace.frames=yield t.applyModifiers(s.stacktrace.frames));return e})()}coerceFallback(e){var t;return{type:"Error",value:"Unknown error",stack:(t=e.syntheticException)==null?void 0:t.stack,synthetic:!0}}parseStacktrace(e,t){var s,i;return e.cause!=null&&(s=this.parseStacktrace(e.cause,t)),e.stack!=""&&e.stack!=null&&(i=this.applyChunkIds(this.stackParser(e.stack,e.synthetic?1:0),t.chunkIdMap)),Ne({},e,{cause:s,stack:i})}applyChunkIds(e,t){return e.map(s=>(s.filename&&t&&(s.chunk_id=t[s.filename]),s))}applyCoercers(e,t){for(var s of this.coercers)if(s.match(e))return s.coerce(e,t);return this.coerceFallback(t)}applyModifiers(e){var t=this;return rc(function*(){var s=e;for(var i of t.modifiers)s=yield i(s);return s})()}convertToExceptionList(e,t){var s,i,n,a={type:e.type,value:e.value,mechanism:{type:(s=t.type)!==null&&s!==void 0?s:"generic",handled:(i=t.handled)===null||i===void 0||i,synthetic:(n=e.synthetic)!==null&&n!==void 0&&n}};e.stack&&(a.stacktrace={type:"raw",frames:e.stack});var o=[a];return e.cause!=null&&o.push(...this.convertToExceptionList(e.cause,Ne({},t,{handled:!0}))),o}buildParsingContext(){return{chunkIdMap:WR(this.stackParser)}}buildCoercingContext(e,t,s){s===void 0&&(s=0);var i=(n,a)=>{if(a<=4){var o=this.buildCoercingContext(e,t,a);return this.applyCoercers(n,o)}};return Ne({},t,{syntheticException:s==0?t.syntheticException:void 0,mechanism:e,apply:n=>i(n,s),next:n=>i(n,s+1)})}}var Oc="?";function Rg(r,e,t,s,i){var n={platform:r,filename:e,function:t==="<anonymous>"?Oc:t,in_app:!0};return Te(s)||(n.lineno=s),Te(i)||(n.colno=i),n}var vT=(r,e)=>{var t=r.indexOf("safari-extension")!==-1,s=r.indexOf("safari-web-extension")!==-1;return t||s?[r.indexOf("@")!==-1?r.split("@")[0]:Oc,t?"safari-extension:"+e:"safari-web-extension:"+e]:[r,e]},qR=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,HR=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,XR=/\((\S*)(?::(\d+))(?::(\d+))\)/,KR=(r,e)=>{var t=qR.exec(r);if(t){var[,s,i,n]=t;return Rg(e,s,Oc,+i,+n)}var a=HR.exec(r);if(a){if(a[2]&&a[2].indexOf("eval")===0){var o=XR.exec(a[2]);o&&(a[2]=o[1],a[3]=o[2],a[4]=o[3])}var[l,d]=vT(a[1]||Oc,a[2]);return Rg(e,d,l,a[3]?+a[3]:void 0,a[4]?+a[4]:void 0)}},QR=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,JR=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,ZR=(r,e)=>{var t=QR.exec(r);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){var s=JR.exec(t[3]);s&&(t[1]=t[1]||"eval",t[3]=s[1],t[4]=s[2],t[5]="")}var i=t[3],n=t[1]||Oc;return[n,i]=vT(n,i),Rg(e,i,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},Sv=/\(error: (.*)\)/,Tv=50;function eI(){return function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return function(i,n){n===void 0&&(n=0);for(var a=[],o=i.split(`
`),l=n;l<o.length;l++){var d=o[l];if(!(d.length>1024)){var u=Sv.test(d)?d.replace(Sv,"$1"):d;if(!u.match(/\S*Error: /)){for(var h of t){var p=h(u,r);if(p){a.push(p);break}}if(a.length>=Tv)break}}}return function(m){if(!m.length)return[];var f=Array.from(m);return f.reverse(),f.slice(0,Tv).map(g=>{return Ne({},g,{filename:g.filename||(y=f,y[y.length-1]||{}).filename,function:g.function||Oc});var y})}(a)}}("web:javascript",KR,ZR)}class tI{match(e){return this.isDOMException(e)||this.isDOMError(e)}coerce(e,t){var s=As(e.stack);return{type:this.getType(e),value:this.getValue(e),stack:s?e.stack:void 0,cause:e.cause?t.next(e.cause):void 0,synthetic:!1}}getType(e){return this.isDOMError(e)?"DOMError":"DOMException"}getValue(e){var t=e.name||(this.isDOMError(e)?"DOMError":"DOMException");return e.message?t+": "+e.message:t}isDOMException(e){return Yh(e,"DOMException")}isDOMError(e){return Yh(e,"DOMError")}}class sI{match(e){return(t=>t instanceof Error)(e)}coerce(e,t){return{type:this.getType(e),value:this.getMessage(e,t),stack:this.getStack(e),cause:e.cause?t.next(e.cause):void 0,synthetic:!1}}getType(e){return e.name||e.constructor.name}getMessage(e,t){var s=e.message;return s.error&&typeof s.error.message=="string"?String(s.error.message):String(s)}getStack(e){return e.stacktrace||e.stack||void 0}}class iI{constructor(){}match(e){return Yh(e,"ErrorEvent")&&e.error!=null}coerce(e,t){var s,i=t.apply(e.error);return i||{type:"ErrorEvent",value:e.message,stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}}var rI=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;class nI{match(e){return typeof e=="string"}coerce(e,t){var s,[i,n]=this.getInfos(e);return{type:i??"Error",value:n??e,stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}getInfos(e){var t="Error",s=e,i=e.match(rI);return i&&(t=i[1],s=i[2]),[t,s]}}var aI=["fatal","error","warning","log","info","debug"];function wT(r,e){e===void 0&&(e=40);var t=Object.keys(r);if(t.sort(),!t.length)return"[object has no keys]";for(var s=t.length;s>0;s--){var i=t.slice(0,s).join(", ");if(!(i.length>e))return s===t.length||i.length<=e?i:i.slice(0,e)+"..."}return""}class oI{match(e){return typeof e=="object"&&e!==null}coerce(e,t){var s,i=this.getErrorPropertyFromObject(e);return i?t.apply(i):{type:this.getType(e),value:this.getValue(e),stack:(s=t.syntheticException)==null?void 0:s.stack,level:this.isSeverityLevel(e.level)?e.level:"error",synthetic:!0}}getType(e){return iT(e)?e.constructor.name:"Error"}getValue(e){if("name"in e&&typeof e.name=="string"){var t="'"+e.name+"' captured as exception";return"message"in e&&typeof e.message=="string"&&(t+=" with message: '"+e.message+"'"),t}if("message"in e&&typeof e.message=="string")return e.message;var s=this.getObjectClassName(e);return(s&&s!=="Object"?"'"+s+"'":"Object")+" captured as exception with keys: "+wT(e)}isSeverityLevel(e){return As(e)&&!_g(e)&&aI.indexOf(e)>=0}getErrorPropertyFromObject(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var s=e[t];if(GR(s))return s}}getObjectClassName(e){try{var t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{return}}}class cI{match(e){return iT(e)}coerce(e,t){var s,i=e.constructor.name;return{type:i,value:i+" captured as exception with keys: "+wT(e),stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}}class lI{match(e){return Eg(e)}coerce(e,t){var s;return{type:"Error",value:"Primitive value captured as exception: "+String(e),stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}}class dI{match(e){return Yh(e,"PromiseRejectionEvent")}coerce(e,t){var s,i=this.getUnhandledRejectionReason(e);return Eg(i)?{type:"UnhandledRejection",value:"Non-Error promise rejection captured with value: "+String(i),stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}:t.apply(i)}getUnhandledRejectionReason(e){if(Eg(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch{}return e}}var kT=function(r,e){var{debugEnabled:t}=e===void 0?{}:e,s={k:function(i){if(H&&(ln.DEBUG||Ye.POSTHOG_DEBUG||t)&&!Te(H.console)&&H.console){for(var n=("__rrweb_original__"in H.console[i])?H.console[i].__rrweb_original__:H.console[i],a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];n(r,...o)}},info:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];s.k("log",...n)},warn:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];s.k("warn",...n)},error:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];s.k("error",...n)},critical:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];console.error(r,...n)},uninitializedWarning:i=>{s.error("You must initialize PostHog before calling "+i)},createLogger:(i,n)=>kT(r+" "+i,n)};return s},_e=kT("[PostHog.js]"),as=_e.createLogger,uI=as("[ExternalScriptsLoader]"),Av=(r,e,t)=>{if(r.config.disable_external_dependency_loading)return uI.warn(e+" was requested but loading of external scripts is disabled."),t("Loading of external scripts is disabled");var s=Ae?.querySelectorAll("script");if(s){for(var i,n=function(){if(s[a].src===e){var l=s[a];return l.__posthog_loading_callback_fired?{v:t()}:(l.addEventListener("load",d=>{l.__posthog_loading_callback_fired=!0,t(void 0,d)}),l.onerror=d=>t(d),{v:void 0})}},a=0;a<s.length;a++)if(i=n())return i.v}var o=()=>{if(!Ae)return t("document not found");var l=Ae.createElement("script");if(l.type="text/javascript",l.crossOrigin="anonymous",l.src=e,l.onload=h=>{l.__posthog_loading_callback_fired=!0,t(void 0,h)},l.onerror=h=>t(h),r.config.prepare_external_dependency_script&&(l=r.config.prepare_external_dependency_script(l)),!l)return t("prepare_external_dependency_script returned null");if(r.config.external_scripts_inject_target==="head")Ae.head.appendChild(l);else{var d,u=Ae.querySelectorAll("body > script");u.length>0?(d=u[0].parentNode)==null||d.insertBefore(l,u[0]):Ae.body.appendChild(l)}};Ae!=null&&Ae.body?o():Ae?.addEventListener("DOMContentLoaded",o)};Ye.__PosthogExtensions__=Ye.__PosthogExtensions__||{},Ye.__PosthogExtensions__.loadExternalDependency=(r,e,t)=>{var s="/static/"+e+".js?v="+r.version;if(e==="remote-config"&&(s="/array/"+r.config.token+"/config.js"),e==="toolbar"){var i=3e5;s=s+"&t="+Math.floor(Date.now()/i)*i}var n=r.requestRouter.endpointFor("assets",s);Av(r,n,t)},Ye.__PosthogExtensions__.loadSiteApp=(r,e,t)=>{var s=r.requestRouter.endpointFor("api",e);Av(r,s,t)};var Hh={};function ca(r,e,t){if(bt(r)){if(fv&&r.forEach===fv)r.forEach(e,t);else if("length"in r&&r.length===+r.length){for(var s=0,i=r.length;s<i;s++)if(s in r&&e.call(t,r[s],s)===Hh)return}}}function Dt(r,e,t){if(!xt(r)){if(bt(r))return ca(r,e,t);if(ER(r)){for(var s of r.entries())if(e.call(t,s[1],s[0])===Hh)return}else for(var i in r)if(sT.call(r,i)&&e.call(t,r[i],i)===Hh)return}}var ds=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return ca(t,function(i){for(var n in i)i[n]!==void 0&&(r[n]=i[n])}),r},el=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return ca(t,function(i){ca(i,function(n){r.push(n)})}),r};function Ch(r){for(var e=Object.keys(r),t=e.length,s=new Array(t);t--;)s[t]=[e[t],r[e[t]]];return s}var jv=function(r){try{return r()}catch{return}},hI=function(r){return function(){try{for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return r.apply(this,t)}catch(i){_e.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),_e.critical(i)}}},Gy=function(r){var e={};return Dt(r,function(t,s){(As(t)&&t.length>0||kn(t))&&(e[s]=t)}),e};function pI(r,e){return t=r,s=n=>As(n)&&!jr(e)?n.slice(0,e):n,i=new Set,function n(a,o){return a!==Object(a)?s?s(a,o):a:i.has(a)?void 0:(i.add(a),bt(a)?(l=[],ca(a,d=>{l.push(n(d))})):(l={},Dt(a,(d,u)=>{i.has(d)||(l[u]=n(d,u))})),l);var l}(t);var t,s,i}var mI=["herokuapp.com","vercel.app","netlify.app"];function fI(r){var e=r?.hostname;if(!As(e))return!1;var t=e.split(".").slice(-2).join(".");for(var s of mI)if(t===s)return!1;return!0}function CT(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return r[t]}function xs(r,e,t,s){var{capture:i=!1,passive:n=!0}=s??{};r?.addEventListener(e,t,{capture:i,passive:n})}var ST="$people_distinct_id",Wl="__alias",Yl="__timers",_v="$autocapture_disabled_server_side",Ig="$heatmaps_enabled_server_side",Ev="$exception_capture_enabled_server_side",Dg="$error_tracking_suppression_rules",Mv="$error_tracking_capture_extension_exceptions",Pv="$web_vitals_enabled_server_side",TT="$dead_clicks_enabled_server_side",Nv="$product_tours_enabled_server_side",Rv="$web_vitals_allowed_metrics",bm="$session_recording_remote_config",Xh="$sesid",AT="$session_is_sampled",ac="$enabled_feature_flags",ql="$early_access_features",Fg="$feature_flag_details",Hl="$stored_person_properties",eo="$stored_group_properties",Bg="$surveys",Kh="$flag_call_reported",dn="$user_state",Lg="$client_session_props",Og="$capture_rate_limit",$g="$initial_campaign_params",zg="$initial_referrer_info",Qh="$initial_person_info",Jh="$epp",jT="__POSTHOG_TOOLBAR__",kl="$posthog_cookieless",gI=[ST,Wl,"__cmpns",Yl,"$session_recording_enabled_server_side",Ig,Xh,ac,Dg,dn,ql,Fg,eo,Hl,Bg,Kh,Lg,Og,$g,zg,Jh,Qh,"$conversations_widget_session_id","$conversations_ticket_id","$conversations_widget_state","$conversations_user_traits"];function Iv(r){return r instanceof Element&&(r.id===jT||!(r.closest==null||!r.closest(".toolbar-global-fade-container")))}function Vp(r){return!!r&&r.nodeType===1}function la(r,e){return!!r&&!!r.tagName&&r.tagName.toLowerCase()===e.toLowerCase()}function _T(r){return!!r&&r.nodeType===3}function ET(r){return!!r&&r.nodeType===11}function Wy(r){return r?$p(r).split(/\s+/):[]}function Dv(r){var e=H?.location.href;return!!(e&&r&&r.some(t=>e.match(t)))}function Zh(r){var e="";switch(typeof r.className){case"string":e=r.className;break;case"object":e=(r.className&&"baseVal"in r.className?r.className.baseVal:null)||r.getAttribute("class")||"";break;default:e=""}return Wy(e)}function MT(r){return xt(r)?null:$p(r).split(/(\s+)/).filter(e=>Fd(e)).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function du(r){var e="";return Vg(r)&&!DT(r)&&r.childNodes&&r.childNodes.length&&Dt(r.childNodes,function(t){var s;_T(t)&&t.textContent&&(e+=(s=MT(t.textContent))!==null&&s!==void 0?s:"")}),$p(e)}function PT(r){return Te(r.target)?r.srcElement||null:(e=r.target)!=null&&e.shadowRoot?r.composedPath()[0]||null:r.target||null;var e}var Yy=["a","button","form","input","select","textarea","label"];function NT(r,e){if(Te(e))return!0;var t,s=function(n){if(e.some(a=>n.matches(a)))return{v:!0}};for(var i of r)if(t=s(i))return t.v;return!1}function RT(r){var e=r.parentNode;return!(!e||!Vp(e))&&e}var yI=["next","previous","prev",">","<"],Fv=10,Bv=[".ph-no-rageclick",".ph-no-capture"];function xI(r,e){if(!H||qy(r))return!1;var t,s,i;if(bn(e)?(t=!!e&&Bv,s=void 0):(t=(i=e?.css_selector_ignorelist)!==null&&i!==void 0?i:Bv,s=e?.content_ignorelist),t===!1)return!1;var{targetElementList:n}=IT(r,!1);return!function(a,o){if(a===!1||Te(a))return!1;var l;if(a===!0)l=yI;else{if(!bt(a))return!1;if(a.length>Fv)return _e.error("[PostHog] content_ignorelist array cannot exceed "+Fv+" items. Use css_selector_ignorelist for more complex matching."),!1;l=a.map(d=>d.toLowerCase())}return o.some(d=>{var{safeText:u,ariaLabel:h}=d;return l.some(p=>u.includes(p)||h.includes(p))})}(s,n.map(a=>{var o;return{safeText:du(a).toLowerCase(),ariaLabel:((o=a.getAttribute("aria-label"))==null?void 0:o.toLowerCase().trim())||""}}))&&!NT(n,t)}var qy=r=>!r||la(r,"html")||!Vp(r),IT=(r,e)=>{if(!H||qy(r))return{parentIsUsefulElement:!1,targetElementList:[]};for(var t=!1,s=[r],i=r;i.parentNode&&!la(i,"body");)if(ET(i.parentNode))s.push(i.parentNode.host),i=i.parentNode.host;else{var n=RT(i);if(!n)break;if(e||Yy.indexOf(n.tagName.toLowerCase())>-1)t=!0;else{var a=H.getComputedStyle(n);a&&a.getPropertyValue("cursor")==="pointer"&&(t=!0)}s.push(n),i=n}return{parentIsUsefulElement:t,targetElementList:s}};function bI(r,e,t,s,i){var n,a,o,l;if(t===void 0&&(t=void 0),!H||qy(r)||(n=t)!=null&&n.url_allowlist&&!Dv(t.url_allowlist)||(a=t)!=null&&a.url_ignorelist&&Dv(t.url_ignorelist))return!1;if((o=t)!=null&&o.dom_event_allowlist){var d=t.dom_event_allowlist;if(d&&!d.some(f=>e.type===f))return!1}var{parentIsUsefulElement:u,targetElementList:h}=IT(r,s);if(!function(f,g){var y=g?.element_allowlist;if(Te(y))return!0;var x,v=function(S){if(y.some(k=>S.tagName.toLowerCase()===k))return{v:!0}};for(var b of f)if(x=v(b))return x.v;return!1}(h,t)||!NT(h,(l=t)==null?void 0:l.css_selector_allowlist))return!1;var p=H.getComputedStyle(r);if(p&&p.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var m=r.tagName.toLowerCase();switch(m){case"html":return!1;case"form":return(i||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(e.type)>=0;default:return u?(i||["click"]).indexOf(e.type)>=0:(i||["click"]).indexOf(e.type)>=0&&(Yy.indexOf(m)>-1||r.getAttribute("contenteditable")==="true")}}function Vg(r){for(var e=r;e.parentNode&&!la(e,"body");e=e.parentNode){var t=Zh(e);if(ot(t,"ph-sensitive")||ot(t,"ph-no-capture"))return!1}if(ot(Zh(r),"ph-include"))return!0;var s=r.type||"";if(As(s))switch(s.toLowerCase()){case"hidden":case"password":return!1}var i=r.name||r.id||"";return!(As(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function DT(r){return!!(la(r,"input")&&!["button","checkbox","submit","reset"].includes(r.type)||la(r,"select")||la(r,"textarea")||r.getAttribute("contenteditable")==="true")}var FT="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",vI=new RegExp("^(?:"+FT+")$"),wI=new RegExp(FT),BT="\\d{3}-?\\d{2}-?\\d{4}",kI=new RegExp("^("+BT+")$"),CI=new RegExp("("+BT+")");function Fd(r,e){return e===void 0&&(e=!0),!(xt(r)||As(r)&&(r=$p(r),(e?vI:wI).test((r||"").replace(/[- ]/g,""))||(e?kI:CI).test(r)))}function LT(r){var e=du(r);return Fd(e=(e+" "+OT(r)).trim())?e:""}function OT(r){var e="";return r&&r.childNodes&&r.childNodes.length&&Dt(r.childNodes,function(t){var s;if(t&&((s=t.tagName)==null?void 0:s.toLowerCase())==="span")try{var i=du(t);e=(e+" "+i).trim(),t.childNodes&&t.childNodes.length&&(e=(e+" "+OT(t)).trim())}catch(n){_e.error("[AutoCapture]",n)}}),e}function SI(r){return function(e){var t=e.map(s=>{var i,n,a="";if(s.tag_name&&(a+=s.tag_name),s.attr_class)for(var o of(s.attr_class.sort(),s.attr_class))a+="."+o.replace(/"/g,"");var l=Ne({},s.text?{text:s.text}:{},{"nth-child":(i=s.nth_child)!==null&&i!==void 0?i:0,"nth-of-type":(n=s.nth_of_type)!==null&&n!==void 0?n:0},s.href?{href:s.href}:{},s.attr_id?{attr_id:s.attr_id}:{},s.attributes),d={};return Ch(l).sort((u,h)=>{var[p]=u,[m]=h;return p.localeCompare(m)}).forEach(u=>{var[h,p]=u;return d[Lv(h.toString())]=Lv(p.toString())}),a+=":",a+=Ch(d).map(u=>{var[h,p]=u;return h+'="'+p+'"'}).join("")});return t.join(";")}(function(e){return e.map(t=>{var s,i,n={text:(s=t.$el_text)==null?void 0:s.slice(0,400),tag_name:t.tag_name,href:(i=t.attr__href)==null?void 0:i.slice(0,2048),attr_class:TI(t),attr_id:t.attr__id,nth_child:t.nth_child,nth_of_type:t.nth_of_type,attributes:{}};return Ch(t).filter(a=>{var[o]=a;return o.indexOf("attr__")===0}).forEach(a=>{var[o,l]=a;return n.attributes[o]=l}),n})}(r))}function Lv(r){return r.replace(/"|\\"/g,'\\"')}function TI(r){var e=r.attr__class;return e?bt(e)?e:Wy(e):void 0}class $T{constructor(e){this.disabled=e===!1;var t=Ts(e)?e:{};this.thresholdPx=t.threshold_px||30,this.timeoutMs=t.timeout_ms||1e3,this.clickCount=t.click_count||3,this.clicks=[]}isRageClick(e,t,s){if(this.disabled)return!1;var i=this.clicks[this.clicks.length-1];if(i&&Math.abs(e-i.x)+Math.abs(t-i.y)<this.thresholdPx&&s-i.timestamp<this.timeoutMs){if(this.clicks.push({x:e,y:t,timestamp:s}),this.clicks.length===this.clickCount)return!0}else this.clicks=[{x:e,y:t,timestamp:s}];return!1}}var ep=r=>{var e=Ae?.createElement("a");return Te(e)?null:(e.href=r,e)},AI=function(r,e){var t,s;e===void 0&&(e="&");var i=[];return Dt(r,function(n,a){Te(n)||Te(a)||a==="undefined"||(t=encodeURIComponent((o=>o instanceof File)(n)?n.name:n.toString()),s=encodeURIComponent(a),i[i.length]=s+"="+t)}),i.join(e)},tp=function(r,e){for(var t,s=((r.split("#")[0]||"").split(/\?(.*)/)[1]||"").replace(/^\?+/g,"").split("&"),i=0;i<s.length;i++){var n=s[i].split("=");if(n[0]===e){t=n;break}}if(!bt(t)||t.length<2)return"";var a=t[1];try{a=decodeURIComponent(a)}catch{_e.error("Skipping decoding for malformed query param: "+a)}return a.replace(/\+/g," ")},uu=function(r,e,t){if(!r||!e||!e.length)return r;for(var s=r.split("#"),i=s[0]||"",n=s[1],a=i.split("?"),o=a[1],l=a[0],d=(o||"").split("&"),u=[],h=0;h<d.length;h++){var p=d[h].split("=");bt(p)&&(e.includes(p[0])?u.push(p[0]+"="+t):u.push(d[h]))}var m=l;return o!=null&&(m+="?"+u.join("&")),n!=null&&(m+="#"+n),m},sp=function(r,e){var t=r.match(new RegExp(e+"=([^&]*)"));return t?t[1]:null},vm="$copy_autocapture",Ov=as("[AutoCapture]");function wm(r,e){return e.length>r?e.slice(0,r)+"...":e}function jI(r){if(r.previousElementSibling)return r.previousElementSibling;var e=r;do e=e.previousSibling;while(e&&!Vp(e));return e}function _I(r,e,t,s){var i=r.tagName.toLowerCase(),n={tag_name:i};Yy.indexOf(i)>-1&&!t&&(i.toLowerCase()==="a"||i.toLowerCase()==="button"?n.$el_text=wm(1024,LT(r)):n.$el_text=wm(1024,du(r)));var a=Zh(r);a.length>0&&(n.classes=a.filter(function(u){return u!==""})),Dt(r.attributes,function(u){var h;if((!DT(r)||["name","id","class","aria-label"].indexOf(u.name)!==-1)&&(s==null||!s.includes(u.name))&&!e&&Fd(u.value)&&(h=u.name,!As(h)||h.substring(0,10)!=="_ngcontent"&&h.substring(0,7)!=="_nghost")){var p=u.value;u.name==="class"&&(p=Wy(p).join(" ")),n["attr__"+u.name]=wm(1024,p)}});for(var o=1,l=1,d=r;d=jI(d);)o++,d.tagName===r.tagName&&l++;return n.nth_child=o,n.nth_of_type=l,n}function EI(r,e){for(var t,s,{e:i,maskAllElementAttributes:n,maskAllText:a,elementAttributeIgnoreList:o,elementsChainAsString:l}=e,d=[r],u=r;u.parentNode&&!la(u,"body");)ET(u.parentNode)?(d.push(u.parentNode.host),u=u.parentNode.host):(d.push(u.parentNode),u=u.parentNode);var h,p=[],m={},f=!1,g=!1;if(Dt(d,S=>{var k=Vg(S);S.tagName.toLowerCase()==="a"&&(f=S.getAttribute("href"),f=k&&f&&Fd(f)&&f),ot(Zh(S),"ph-no-capture")&&(g=!0),p.push(_I(S,n,a,o));var C=function(A){if(!Vg(A))return{};var T={};return Dt(A.attributes,function(j){if(j.name&&j.name.indexOf("data-ph-capture-attribute")===0){var _=j.name.replace("data-ph-capture-attribute-",""),M=j.value;_&&M&&Fd(M)&&(T[_]=M)}}),T}(S);ds(m,C)}),g)return{props:{},explicitNoCapture:g};if(a||(r.tagName.toLowerCase()==="a"||r.tagName.toLowerCase()==="button"?p[0].$el_text=LT(r):p[0].$el_text=du(r)),f){var y,x;p[0].attr__href=f;var v=(y=ep(f))==null?void 0:y.host,b=H==null||(x=H.location)==null?void 0:x.host;v&&b&&v!==b&&(h=f)}return{props:ds({$event_type:i.type,$ce_version:1},l?{}:{$elements:p},{$elements_chain:SI(p)},(t=p[0])!=null&&t.$el_text?{$el_text:(s=p[0])==null?void 0:s.$el_text}:{},h&&i.type==="click"?{$external_click_url:h}:{},m)}}class MI{constructor(e){this.P=!1,this.T=null,this.I=!1,this.instance=e,this.rageclicks=new $T(e.config.rageclick),this.C=null}get R(){var e,t,s=Ts(this.instance.config.autocapture)?this.instance.config.autocapture:{};return s.url_allowlist=(e=s.url_allowlist)==null?void 0:e.map(i=>new RegExp(i)),s.url_ignorelist=(t=s.url_ignorelist)==null?void 0:t.map(i=>new RegExp(i)),s}F(){if(this.isBrowserSupported()){if(H&&Ae){var e=s=>{s=s||H?.event;try{this.M(s)}catch(i){Ov.error("Failed to capture event",i)}};if(xs(Ae,"submit",e,{capture:!0}),xs(Ae,"change",e,{capture:!0}),xs(Ae,"click",e,{capture:!0}),this.R.capture_copied_text){var t=s=>{s=s||H?.event,this.M(s,vm)};xs(Ae,"copy",t,{capture:!0}),xs(Ae,"cut",t,{capture:!0})}}}else Ov.info("Disabling Automatic Event Collection because this browser is not supported")}startIfEnabled(){this.isEnabled&&!this.P&&(this.F(),this.P=!0)}onRemoteConfig(e){e.elementsChainAsString&&(this.I=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register({[_v]:!!e.autocapture_opt_out}),this.T=!!e.autocapture_opt_out,this.startIfEnabled()}setElementSelectors(e){this.C=e}getElementSelectors(e){var t,s=[];return(t=this.C)==null||t.forEach(i=>{var n=Ae?.querySelectorAll(i);n?.forEach(a=>{e===a&&s.push(i)})}),s}get isEnabled(){var e,t,s=(e=this.instance.persistence)==null?void 0:e.props[_v],i=this.T;if(jr(i)&&!bn(s)&&!this.instance.O())return!1;var n=(t=this.T)!==null&&t!==void 0?t:!!s;return!!this.instance.config.autocapture&&!n}M(e,t){if(t===void 0&&(t="$autocapture"),this.isEnabled){var s,i=PT(e);_T(i)&&(i=i.parentNode||null),t==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(s=this.rageclicks)!=null&&s.isRageClick(e.clientX,e.clientY,e.timeStamp||new Date().getTime())&&xI(i,this.instance.config.rageclick)&&this.M(e,"$rageclick");var n=t===vm;if(i&&bI(i,e,this.R,n,n?["copy","cut"]:void 0)){var{props:a,explicitNoCapture:o}=EI(i,{e,maskAllElementAttributes:this.instance.config.mask_all_element_attributes,maskAllText:this.instance.config.mask_all_text,elementAttributeIgnoreList:this.R.element_attribute_ignorelist,elementsChainAsString:this.I});if(o)return!1;var l=this.getElementSelectors(i);if(l&&l.length>0&&(a.$element_selectors=l),t===vm){var d,u=MT(H==null||(d=H.getSelection())==null?void 0:d.toString()),h=e.type||"clipboard";if(!u)return!1;a.$selected_content=u,a.$copy_type=h}return this.instance.capture(t,a),!0}}}isBrowserSupported(){return oa(Ae?.querySelectorAll)}}Math.trunc||(Math.trunc=function(r){return r<0?Math.ceil(r):Math.floor(r)}),Number.isInteger||(Number.isInteger=function(r){return kn(r)&&isFinite(r)&&Math.floor(r)===r});var $v="0123456789abcdef";class ip{constructor(e){if(this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,s,i){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(s)||!Number.isInteger(i)||e<0||t<0||s<0||i<0||e>0xffffffffffff||t>4095||s>1073741823||i>4294967295)throw new RangeError("invalid field value");var n=new Uint8Array(16);return n[0]=e/Math.pow(2,40),n[1]=e/Math.pow(2,32),n[2]=e/Math.pow(2,24),n[3]=e/Math.pow(2,16),n[4]=e/Math.pow(2,8),n[5]=e,n[6]=112|t>>>8,n[7]=t,n[8]=128|s>>>24,n[9]=s>>>16,n[10]=s>>>8,n[11]=s,n[12]=i>>>24,n[13]=i>>>16,n[14]=i>>>8,n[15]=i,new ip(n)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+$v.charAt(this.bytes[t]>>>4)+$v.charAt(15&this.bytes[t]),t!==3&&t!==5&&t!==7&&t!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}clone(){return new ip(this.bytes.slice(0))}equals(e){return this.compareTo(e)===0}compareTo(e){for(var t=0;t<16;t++){var s=this.bytes[t]-e.bytes[t];if(s!==0)return Math.sign(s)}return 0}}class PI{constructor(){this.A=0,this.D=0,this.j=new NI}generate(){var e=this.generateOrAbort();if(Te(e)){this.A=0;var t=this.generateOrAbort();if(Te(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.A)this.A=e,this.L();else{if(!(e+1e4>this.A))return;this.D++,this.D>4398046511103&&(this.A++,this.L())}return ip.fromFieldsV7(this.A,Math.trunc(this.D/Math.pow(2,30)),this.D&Math.pow(2,30)-1,this.j.nextUint32())}L(){this.D=1024*this.j.nextUint32()+(1023&this.j.nextUint32())}}var zv,zT=r=>{if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<r.length;e++)r[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return r};H&&!Te(H.crypto)&&crypto.getRandomValues&&(zT=r=>crypto.getRandomValues(r));class NI{constructor(){this.N=new Uint32Array(8),this.U=1/0}nextUint32(){return this.U>=this.N.length&&(zT(this.N),this.U=0),this.N[this.U++]}}var ta=()=>RI().toString(),RI=()=>(zv||(zv=new PI)).generate(),Cl="",II=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function DI(r,e){if(e){var t=function(i,n){if(n===void 0&&(n=Ae),Cl)return Cl;if(!n||["localhost","127.0.0.1"].includes(i))return"";for(var a=i.split("."),o=Math.min(a.length,8),l="dmn_chk_"+ta();!Cl&&o--;){var d=a.slice(o).join("."),u=l+"=1;domain=."+d+";path=/";n.cookie=u+";max-age=3",n.cookie.includes(l)&&(n.cookie=u+";max-age=0",Cl=d)}return Cl}(r);if(!t){var s=(i=>{var n=i.match(II);return n?n[0]:""})(r);s!==t&&_e.info("Warning: cookie subdomain discovery mismatch",s,t),t=s}return t?"; domain=."+t:""}return""}var Br={H:()=>!!Ae,B:function(r){_e.error("cookieStore error: "+r)},q:function(r){if(Ae){try{for(var e=r+"=",t=Ae.cookie.split(";").filter(n=>n.length),s=0;s<t.length;s++){for(var i=t[s];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null}},W:function(r){var e;try{e=JSON.parse(Br.q(r))||{}}catch{}return e},G:function(r,e,t,s,i){if(Ae)try{var n="",a="",o=DI(Ae.location.hostname,s);if(t){var l=new Date;l.setTime(l.getTime()+24*t*60*60*1e3),n="; expires="+l.toUTCString()}i&&(a="; secure");var d=r+"="+encodeURIComponent(JSON.stringify(e))+n+"; SameSite=Lax; path=/"+o+a;return d.length>3686.4&&_e.warn("cookieStore warning: large cookie, len="+d.length),Ae.cookie=d,d}catch{return}},V:function(r,e){if(Ae!=null&&Ae.cookie)try{Br.G(r,"",-1,e)}catch{return}}},km=null,qt={H:function(){if(!jr(km))return km;var r=!0;if(Te(H))r=!1;else try{var e="__mplssupport__";qt.G(e,"xyz"),qt.q(e)!=='"xyz"'&&(r=!1),qt.V(e)}catch{r=!1}return r||_e.error("localStorage unsupported; falling back to cookie store"),km=r,r},B:function(r){_e.error("localStorage error: "+r)},q:function(r){try{return H?.localStorage.getItem(r)}catch(e){qt.B(e)}return null},W:function(r){try{return JSON.parse(qt.q(r))||{}}catch{}return null},G:function(r,e){try{H?.localStorage.setItem(r,JSON.stringify(e))}catch(t){qt.B(t)}},V:function(r){try{H?.localStorage.removeItem(r)}catch(e){qt.B(e)}}},FI=["$device_id","distinct_id",Xh,AT,Jh,Qh],Nu={},BI={H:function(){return!0},B:function(r){_e.error("memoryStorage error: "+r)},q:function(r){return Nu[r]||null},W:function(r){return Nu[r]||null},G:function(r,e){Nu[r]=e},V:function(r){delete Nu[r]}},Ba=null,Ls={H:function(){if(!jr(Ba))return Ba;if(Ba=!0,Te(H))Ba=!1;else try{var r="__support__";Ls.G(r,"xyz"),Ls.q(r)!=='"xyz"'&&(Ba=!1),Ls.V(r)}catch{Ba=!1}return Ba},B:function(r){_e.error("sessionStorage error: ",r)},q:function(r){try{return H?.sessionStorage.getItem(r)}catch(e){Ls.B(e)}return null},W:function(r){try{return JSON.parse(Ls.q(r))||null}catch{}return null},G:function(r,e){try{H?.sessionStorage.setItem(r,JSON.stringify(e))}catch(t){Ls.B(t)}},V:function(r){try{H?.sessionStorage.removeItem(r)}catch(e){Ls.B(e)}}},un=function(r){return r[r.PENDING=-1]="PENDING",r[r.DENIED=0]="DENIED",r[r.GRANTED=1]="GRANTED",r}({});class LI{constructor(e){this._instance=e}get R(){return this._instance.config}get consent(){return this.J()?un.DENIED:this.K}isOptedOut(){return this.R.cookieless_mode==="always"||this.consent===un.DENIED||this.consent===un.PENDING&&(this.R.opt_out_capturing_by_default||this.R.cookieless_mode==="on_reject")}isOptedIn(){return!this.isOptedOut()}isExplicitlyOptedOut(){return this.consent===un.DENIED}optInOut(e){this.Y.G(this.X,e?1:0,this.R.cookie_expiration,this.R.cross_subdomain_cookie,this.R.secure_cookie)}reset(){this.Y.V(this.X,this.R.cross_subdomain_cookie)}get X(){var{token:e,opt_out_capturing_cookie_prefix:t,consent_persistence_name:s}=this._instance.config;return s||(t?t+e:"__ph_opt_in_out_"+e)}get K(){var e=this.Y.q(this.X);return gm(e)?un.GRANTED:ot(NR,e)?un.DENIED:un.PENDING}get Y(){if(!this.Z){var e=this.R.opt_out_capturing_persistence_type;this.Z=e==="localStorage"?qt:Br;var t=e==="localStorage"?Br:qt;t.q(this.X)&&(this.Z.q(this.X)||this.optInOut(gm(t.q(this.X))),t.V(this.X,this.R.cross_subdomain_cookie))}return this.Z}J(){return!!this.R.respect_dnt&&!!CT([$i?.doNotTrack,$i?.msDoNotTrack,Ye.doNotTrack],e=>gm(e))}}var Ru=as("[Dead Clicks]"),OI=()=>!0,$I=r=>{var e,t=!((e=r.instance.persistence)==null||!e.get_property(TT)),s=r.instance.config.capture_dead_clicks;return bn(s)?s:!!Ts(s)||t};class VT{get lazyLoadedDeadClicksAutocapture(){return this.tt}constructor(e,t,s){this.instance=e,this.isEnabled=t,this.onCapture=s,this.startIfEnabled()}onRemoteConfig(e){this.instance.persistence&&this.instance.persistence.register({[TT]:e?.captureDeadClicks}),this.startIfEnabled()}startIfEnabled(){this.isEnabled(this)&&this.it(()=>{this.et()})}it(e){var t,s;(t=Ye.__PosthogExtensions__)!=null&&t.initDeadClicksAutocapture&&e(),(s=Ye.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this.instance,"dead-clicks-autocapture",i=>{i?Ru.error("failed to load script",i):e()})}et(){var e;if(Ae){if(!this.tt&&(e=Ye.__PosthogExtensions__)!=null&&e.initDeadClicksAutocapture){var t=Ts(this.instance.config.capture_dead_clicks)?this.instance.config.capture_dead_clicks:{};t.__onCapture=this.onCapture,this.tt=Ye.__PosthogExtensions__.initDeadClicksAutocapture(this.instance,t),this.tt.start(Ae),Ru.info("starting...")}}else Ru.error("`document` not found. Cannot start.")}stop(){this.tt&&(this.tt.stop(),this.tt=void 0,Ru.info("stopping..."))}}var Sl=as("[ExceptionAutocapture]");class zI{constructor(e){var t,s,i;this.rt=()=>{var n;if(H&&this.isEnabled&&(n=Ye.__PosthogExtensions__)!=null&&n.errorWrappingFunctions){var a=Ye.__PosthogExtensions__.errorWrappingFunctions.wrapOnError,o=Ye.__PosthogExtensions__.errorWrappingFunctions.wrapUnhandledRejection,l=Ye.__PosthogExtensions__.errorWrappingFunctions.wrapConsoleError;try{!this.st&&this.R.capture_unhandled_errors&&(this.st=a(this.captureException.bind(this))),!this.nt&&this.R.capture_unhandled_rejections&&(this.nt=o(this.captureException.bind(this))),!this.ot&&this.R.capture_console_errors&&(this.ot=l(this.captureException.bind(this)))}catch(d){Sl.error("failed to start",d),this.ut()}}},this._instance=e,this.ht=!((t=this._instance.persistence)==null||!t.props[Ev]),this.dt=new RR({refillRate:(s=this._instance.config.error_tracking.__exceptionRateLimiterRefillRate)!==null&&s!==void 0?s:1,bucketSize:(i=this._instance.config.error_tracking.__exceptionRateLimiterBucketSize)!==null&&i!==void 0?i:10,refillInterval:1e4,h:Sl}),this.R=this.vt(),this.startIfEnabledOrStop()}vt(){var e=this._instance.config.capture_exceptions,t={capture_unhandled_errors:!1,capture_unhandled_rejections:!1,capture_console_errors:!1};return Ts(e)?t=Ne({},t,e):(Te(e)?this.ht:e)&&(t=Ne({},t,{capture_unhandled_errors:!0,capture_unhandled_rejections:!0})),t}get isEnabled(){return this.R.capture_console_errors||this.R.capture_unhandled_errors||this.R.capture_unhandled_rejections}startIfEnabledOrStop(){this.isEnabled?(Sl.info("enabled"),this.ut(),this.it(this.rt)):this.ut()}it(e){var t,s;(t=Ye.__PosthogExtensions__)!=null&&t.errorWrappingFunctions&&e(),(s=Ye.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"exception-autocapture",i=>{if(i)return Sl.error("failed to load script",i);e()})}ut(){var e,t,s;(e=this.st)==null||e.call(this),this.st=void 0,(t=this.nt)==null||t.call(this),this.nt=void 0,(s=this.ot)==null||s.call(this),this.ot=void 0}onRemoteConfig(e){var t=e.autocaptureExceptions;this.ht=!!t||!1,this._instance.persistence&&this._instance.persistence.register({[Ev]:this.ht}),this.R=this.vt(),this.startIfEnabledOrStop()}onConfigChange(){this.R=this.vt()}captureException(e){var t,s,i=(t=e==null||(s=e.$exception_list)==null||(s=s[0])==null?void 0:s.type)!==null&&t!==void 0?t:"Exception";this.dt.consumeRateLimit(i)?Sl.info("Skipping exception capture because of client rate limiting.",{exception:i}):this._instance.exceptions.sendExceptionEvent(e)}}function Vv(r,e,t){try{if(!(e in r))return()=>{};var s=r[e],i=t(s);return oa(i)&&(i.prototype=i.prototype||{},Object.defineProperties(i,{__posthog_wrapped__:{enumerable:!1,value:!0}})),r[e]=i,()=>{r[e]=s}}catch{return()=>{}}}class VI{constructor(e){var t;this._instance=e,this.ct=(H==null||(t=H.location)==null?void 0:t.pathname)||""}get isEnabled(){return this._instance.config.capture_pageview==="history_change"}startIfEnabled(){this.isEnabled&&(_e.info("History API monitoring enabled, starting..."),this.monitorHistoryChanges())}stop(){this.ft&&this.ft(),this.ft=void 0,_e.info("History API monitoring stopped")}monitorHistoryChanges(){var e,t;if(H&&H.history){var s=this;(e=H.history.pushState)!=null&&e.__posthog_wrapped__||Vv(H.history,"pushState",i=>function(n,a,o){i.call(this,n,a,o),s._t("pushState")}),(t=H.history.replaceState)!=null&&t.__posthog_wrapped__||Vv(H.history,"replaceState",i=>function(n,a,o){i.call(this,n,a,o),s._t("replaceState")}),this.yt()}}_t(e){try{var t,s=H==null||(t=H.location)==null?void 0:t.pathname;if(!s)return;s!==this.ct&&this.isEnabled&&this._instance.capture("$pageview",{navigation_type:e}),this.ct=s}catch(i){_e.error("Error capturing "+e+" pageview",i)}}yt(){if(!this.ft){var e=()=>{this._t("popstate")};xs(H,"popstate",e),this.ft=()=>{H&&H.removeEventListener("popstate",e)}}}}var Cm=as("[SegmentIntegration]");function UI(r,e){var t=r.config.segment;if(!t)return e();(function(s,i){var n=s.config.segment;if(!n)return i();var a=l=>{var d=()=>l.anonymousId()||ta();s.config.get_device_id=d,l.id()&&(s.register({distinct_id:l.id(),$device_id:d()}),s.persistence.set_property(dn,"identified")),i()},o=n.user();"then"in o&&oa(o.then)?o.then(a):a(o)})(r,()=>{t.register((s=>{Promise&&Promise.resolve||Cm.warn("This browser does not have Promise support, and can not use the segment integration");var i=(n,a)=>{if(!a)return n;n.event.userId||n.event.anonymousId===s.get_distinct_id()||(Cm.info("No userId set, resetting PostHog"),s.reset()),n.event.userId&&n.event.userId!==s.get_distinct_id()&&(Cm.info("UserId set, identifying with PostHog"),s.identify(n.event.userId));var o=s.calculateEventProperties(a,n.event.properties);return n.event.properties=Object.assign({},o,n.event.properties),n};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:()=>!0,load:()=>Promise.resolve(),track:n=>i(n,n.event.event),page:n=>i(n,"$pageview"),identify:n=>i(n,"$identify"),screen:n=>i(n,"$screen")}})(r)).then(()=>{e()})})}var UT="posthog-js";function GT(r,e){var{organization:t,projectId:s,prefix:i,severityAllowList:n=["error"],sendExceptionsToPostHog:a=!0}=e===void 0?{}:e;return o=>{var l,d,u,h,p;if(!(n==="*"||n.includes(o.level))||!r.__loaded)return o;o.tags||(o.tags={});var m=r.requestRouter.endpointFor("ui","/project/"+r.config.token+"/person/"+r.get_distinct_id());o.tags["PostHog Person URL"]=m,r.sessionRecordingStarted()&&(o.tags["PostHog Recording URL"]=r.get_session_replay_url({withTimestamp:!0}));var f=((l=o.exception)==null?void 0:l.values)||[],g=f.map(x=>Ne({},x,{stacktrace:x.stacktrace?Ne({},x.stacktrace,{type:"raw",frames:(x.stacktrace.frames||[]).map(v=>Ne({},v,{platform:"web:javascript"}))}):void 0})),y={$exception_message:((d=f[0])==null?void 0:d.value)||o.message,$exception_type:(u=f[0])==null?void 0:u.type,$exception_level:o.level,$exception_list:g,$sentry_event_id:o.event_id,$sentry_exception:o.exception,$sentry_exception_message:((h=f[0])==null?void 0:h.value)||o.message,$sentry_exception_type:(p=f[0])==null?void 0:p.type,$sentry_tags:o.tags};return t&&s&&(y.$sentry_url=(i||"https://sentry.io/organizations/")+t+"/issues/?project="+s+"&query="+o.event_id),a&&r.exceptions.sendExceptionEvent(y),o}}class GI{constructor(e,t,s,i,n,a){this.name=UT,this.setupOnce=function(o){o(GT(e,{organization:t,projectId:s,prefix:i,severityAllowList:n,sendExceptionsToPostHog:a==null||a}))}}}var WI=H!=null&&H.location?sp(H.location.hash,"__posthog")||sp(location.hash,"state"):null,Uv="_postHogToolbarParams",Gv=as("[Toolbar]"),Kn=function(r){return r[r.UNINITIALIZED=0]="UNINITIALIZED",r[r.LOADING=1]="LOADING",r[r.LOADED=2]="LOADED",r}(Kn||{});class YI{constructor(e){this.instance=e}bt(e){Ye.ph_toolbar_state=e}wt(){var e;return(e=Ye.ph_toolbar_state)!==null&&e!==void 0?e:Kn.UNINITIALIZED}maybeLoadToolbar(e,t,s){if(e===void 0&&(e=void 0),t===void 0&&(t=void 0),s===void 0&&(s=void 0),!H||!Ae)return!1;e=e??H.location,s=s??H.history;try{if(!t){try{H.localStorage.setItem("test","test"),H.localStorage.removeItem("test")}catch{return!1}t=H?.localStorage}var i,n=WI||sp(e.hash,"__posthog")||sp(e.hash,"state"),a=n?jv(()=>JSON.parse(atob(decodeURIComponent(n))))||jv(()=>JSON.parse(decodeURIComponent(n))):null;return a&&a.action==="ph_authorize"?((i=a).source="url",i&&Object.keys(i).length>0&&(a.desiredHash?e.hash=a.desiredHash:s?s.replaceState(s.state,"",e.pathname+e.search):e.hash="")):((i=JSON.parse(t.getItem(Uv)||"{}")).source="localstorage",delete i.userIntent),!(!i.token||this.instance.config.token!==i.token)&&(this.loadToolbar(i),!0)}catch{return!1}}xt(e){var t=Ye.ph_load_toolbar||Ye.ph_load_editor;!xt(t)&&oa(t)?t(e,this.instance):Gv.warn("No toolbar load function found")}loadToolbar(e){var t=!(Ae==null||!Ae.getElementById(jT));if(!H||t)return!1;var s=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,i=Ne({token:this.instance.config.token},e,{apiURL:this.instance.requestRouter.endpointFor("ui")},s?{instrument:!1}:{});if(H.localStorage.setItem(Uv,JSON.stringify(Ne({},i,{source:void 0}))),this.wt()===Kn.LOADED)this.xt(i);else if(this.wt()===Kn.UNINITIALIZED){var n;this.bt(Kn.LOADING),(n=Ye.__PosthogExtensions__)==null||n.loadExternalDependency==null||n.loadExternalDependency(this.instance,"toolbar",a=>{if(a)return Gv.error("[Toolbar] Failed to load",a),void this.bt(Kn.UNINITIALIZED);this.bt(Kn.LOADED),this.xt(i)}),xs(H,"turbolinks:load",()=>{this.bt(Kn.UNINITIALIZED),this.loadToolbar(i)})}return!0}Et(e){return this.loadToolbar(e)}maybeLoadEditor(e,t,s){return e===void 0&&(e=void 0),t===void 0&&(t=void 0),s===void 0&&(s=void 0),this.maybeLoadToolbar(e,t,s)}}var qI=as("[TracingHeaders]");class HI{constructor(e){this.$t=void 0,this.St=void 0,this.rt=()=>{var t,s;Te(this.$t)&&((t=Ye.__PosthogExtensions__)==null||(t=t.tracingHeadersPatchFns)==null||t._patchXHR(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager)),Te(this.St)&&((s=Ye.__PosthogExtensions__)==null||(s=s.tracingHeadersPatchFns)==null||s._patchFetch(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager))},this._instance=e}it(e){var t,s;(t=Ye.__PosthogExtensions__)!=null&&t.tracingHeadersPatchFns&&e(),(s=Ye.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"tracing-headers",i=>{if(i)return qI.error("failed to load script",i);e()})}startIfEnabledOrStop(){var e,t;this._instance.config.__add_tracing_headers?this.it(this.rt):((e=this.$t)==null||e.call(this),(t=this.St)==null||t.call(this),this.$t=void 0,this.St=void 0)}}var Iu="https?://(.*)",tl=["gclid","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","igshid","ttclid","rdt_cid","epik","qclid","sccid","irclid","_kx"],XI=el(["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gad_source","mc_cid"],tl),hu="<masked>",KI=["li_fat_id"];function WT(r,e,t){if(!Ae)return{};var s,i=e?el([],tl,t||[]):[],n=YT(uu(Ae.URL,i,hu),r),a=(s={},Dt(KI,function(o){var l=Br.q(o);s[o]=l||null}),s);return ds(a,n)}function YT(r,e){var t=XI.concat(e||[]),s={};return Dt(t,function(i){var n=tp(r,i);s[i]=n||null}),s}function qT(r){var e=function(n){return n?n.search(Iu+"google.([^/?]*)")===0?"google":n.search(Iu+"bing.com")===0?"bing":n.search(Iu+"yahoo.com")===0?"yahoo":n.search(Iu+"duckduckgo.com")===0?"duckduckgo":null:null}(r),t=e!="yahoo"?"q":"p",s={};if(!jr(e)){s.$search_engine=e;var i=Ae?tp(Ae.referrer,t):"";i.length&&(s.ph_keyword=i)}return s}function Wv(){return navigator.language||navigator.userLanguage}function HT(){return Ae?.referrer||"$direct"}function XT(r,e){var t=r?el([],tl,e||[]):[],s=ki?.href.substring(0,1e3);return{r:HT().substring(0,1e3),u:s?uu(s,t,hu):void 0}}function KT(r){var e,{r:t,u:s}=r,i={$referrer:t,$referring_domain:t==null?void 0:t=="$direct"?"$direct":(e=ep(t))==null?void 0:e.host};if(s){i.$current_url=s;var n=ep(s);i.$host=n?.host,i.$pathname=n?.pathname;var a=YT(s);ds(i,a)}if(t){var o=qT(t);ds(i,o)}return i}function QT(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}}function QI(){try{return new Date().getTimezoneOffset()}catch{return}}function JI(r,e){if(!vi)return{};var t,s,i,n=r?el([],tl,e||[]):[],[a,o]=function(l){for(var d=0;d<kv.length;d++){var[u,h]=kv[d],p=u.exec(l),m=p&&(oa(h)?h(p,l):h);if(m)return m}return["",""]}(vi);return ds(Gy({$os:a,$os_version:o,$browser:bT(vi,navigator.vendor),$device:Cv(vi),$device_type:(s=vi,i=Cv(s),i===nT||i===rT||i==="Kobo"||i==="Kindle Fire"||i===xT?Nd:i===Id||i===Sc||i===Dd||i===Pg?"Console":i===oT?"Wearable":i?hr:"Desktop"),$timezone:QT(),$timezone_offset:QI()}),{$current_url:uu(ki?.href,n,hu),$host:ki?.host,$pathname:ki?.pathname,$raw_user_agent:vi.length>1e3?vi.substring(0,997)+"...":vi,$browser_version:UR(vi,navigator.vendor),$browser_language:Wv(),$browser_language_prefix:(t=Wv(),typeof t=="string"?t.split("-")[0]:void 0),$screen_height:H?.screen.height,$screen_width:H?.screen.width,$viewport_height:H?.innerHeight,$viewport_width:H?.innerWidth,$lib:"web",$lib_version:ln.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:Date.now()/1e3})}var On=as("[Web Vitals]"),Yv=9e5;class ZI{constructor(e){var t;this.kt=!1,this.P=!1,this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0},this.Pt=()=>{clearTimeout(this.Tt),this.N.metrics.length!==0&&(this._instance.capture("$web_vitals",this.N.metrics.reduce((s,i)=>Ne({},s,{["$web_vitals_"+i.name+"_event"]:Ne({},i),["$web_vitals_"+i.name+"_value"]:i.value}),{})),this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0})},this.It=s=>{var i,n=(i=this._instance.sessionManager)==null?void 0:i.checkAndGetSessionAndWindowId(!0);if(Te(n))On.error("Could not read session ID. Dropping metrics!");else{this.N=this.N||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=this.Ct();Te(a)||(xt(s?.name)||xt(s?.value)?On.error("Invalid metric received",s):this.Rt&&s.value>=this.Rt?On.error("Ignoring metric with value >= "+this.Rt,s):(this.N.url!==a&&(this.Pt(),this.Tt=setTimeout(this.Pt,this.flushToCaptureTimeoutMs)),Te(this.N.url)&&(this.N.url=a),this.N.firstMetricTimestamp=Te(this.N.firstMetricTimestamp)?Date.now():this.N.firstMetricTimestamp,s.attribution&&s.attribution.interactionTargetElement&&(s.attribution.interactionTargetElement=void 0),this.N.metrics.push(Ne({},s,{$current_url:a,$session_id:n.sessionId,$window_id:n.windowId,timestamp:Date.now()})),this.N.metrics.length===this.allowedMetrics.length&&this.Pt()))}},this.rt=()=>{if(!this.P){var s,i,n,a,o=Ye.__PosthogExtensions__;Te(o)||Te(o.postHogWebVitalsCallbacks)||({onLCP:s,onCLS:i,onFCP:n,onINP:a}=o.postHogWebVitalsCallbacks),s&&i&&n&&a?(this.allowedMetrics.indexOf("LCP")>-1&&s(this.It.bind(this)),this.allowedMetrics.indexOf("CLS")>-1&&i(this.It.bind(this)),this.allowedMetrics.indexOf("FCP")>-1&&n(this.It.bind(this)),this.allowedMetrics.indexOf("INP")>-1&&a(this.It.bind(this)),this.P=!0):On.error("web vitals callbacks not loaded - not starting")}},this._instance=e,this.kt=!((t=this._instance.persistence)==null||!t.props[Pv]),this.startIfEnabled()}get allowedMetrics(){var e,t,s=Ts(this._instance.config.capture_performance)?(e=this._instance.config.capture_performance)==null?void 0:e.web_vitals_allowed_metrics:void 0;return Te(s)?((t=this._instance.persistence)==null?void 0:t.props[Rv])||["CLS","FCP","INP","LCP"]:s}get flushToCaptureTimeoutMs(){return(Ts(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_delayed_flush_ms:void 0)||5e3}get useAttribution(){var e=Ts(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_attribution:void 0;return e==null||e}get Rt(){var e=Ts(this._instance.config.capture_performance)&&kn(this._instance.config.capture_performance.__web_vitals_max_value)?this._instance.config.capture_performance.__web_vitals_max_value:Yv;return 0<e&&e<=6e4?Yv:e}get isEnabled(){var e=ki?.protocol;if(e!=="http:"&&e!=="https:")return On.info("Web Vitals are disabled on non-http/https protocols"),!1;var t=Ts(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals:bn(this._instance.config.capture_performance)?this._instance.config.capture_performance:void 0;return bn(t)?t:this.kt}startIfEnabled(){this.isEnabled&&!this.P&&(On.info("enabled, starting..."),this.it(this.rt))}onRemoteConfig(e){var t=Ts(e.capturePerformance)&&!!e.capturePerformance.web_vitals,s=Ts(e.capturePerformance)?e.capturePerformance.web_vitals_allowed_metrics:void 0;this._instance.persistence&&(this._instance.persistence.register({[Pv]:t}),this._instance.persistence.register({[Rv]:s})),this.kt=t,this.startIfEnabled()}it(e){var t,s;(t=Ye.__PosthogExtensions__)!=null&&t.postHogWebVitalsCallbacks?e():(s=Ye.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"web-vitals",i=>{var n;if(i)On.error("failed to load script",i);else{var a=(n=Ye.__PosthogExtensions__)==null?void 0:n.loadWebVitalsCallbacks;a&&a(this.useAttribution),e()}})}Ct(){var e=H?H.location.href:void 0;if(e){var t=this._instance.config.mask_personal_data_properties,s=this._instance.config.custom_personal_data_properties,i=t?el([],tl,s||[]):[];return uu(e,i,hu)}On.error("Could not determine current URL")}}var eD=as("[Heatmaps]");function qv(r){return Ts(r)&&"clientX"in r&&"clientY"in r&&kn(r.clientX)&&kn(r.clientY)}class tD{constructor(e){var t;this.kt=!1,this.P=!1,this.Ft=null,this.instance=e,this.kt=!((t=this.instance.persistence)==null||!t.props[Ig]),this.rageclicks=new $T(e.config.rageclick)}get flushIntervalMilliseconds(){var e=5e3;return Ts(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}get isEnabled(){return Te(this.instance.config.capture_heatmaps)?Te(this.instance.config.enable_heatmaps)?this.kt:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}startIfEnabled(){if(this.isEnabled){if(this.P)return;eD.info("starting..."),this.Mt(),this.Ot()}else{var e;clearInterval((e=this.Ft)!==null&&e!==void 0?e:void 0),this.At(),this.getAndClearBuffer()}}onRemoteConfig(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register({[Ig]:t}),this.kt=t,this.startIfEnabled()}getAndClearBuffer(){var e=this.N;return this.N=void 0,e}Dt(e){this.jt(e.originalEvent,"deadclick")}Ot(){this.Ft&&clearInterval(this.Ft),this.Ft=function(e){return e?.visibilityState==="visible"}(Ae)?setInterval(this.Lt.bind(this),this.flushIntervalMilliseconds):null}Mt(){H&&Ae&&(this.Nt=this.Lt.bind(this),xs(H,"beforeunload",this.Nt),this.Ut=e=>this.jt(e||H?.event),xs(Ae,"click",this.Ut,{capture:!0}),this.zt=e=>this.Ht(e||H?.event),xs(Ae,"mousemove",this.zt,{capture:!0}),this.Bt=new VT(this.instance,OI,this.Dt.bind(this)),this.Bt.startIfEnabled(),this.qt=this.Ot.bind(this),xs(Ae,"visibilitychange",this.qt),this.P=!0)}At(){var e;H&&Ae&&(this.Nt&&H.removeEventListener("beforeunload",this.Nt),this.Ut&&Ae.removeEventListener("click",this.Ut,{capture:!0}),this.zt&&Ae.removeEventListener("mousemove",this.zt,{capture:!0}),this.qt&&Ae.removeEventListener("visibilitychange",this.qt),clearTimeout(this.Wt),(e=this.Bt)==null||e.stop(),this.P=!1)}Gt(e,t){var s=this.instance.scrollManager.scrollY(),i=this.instance.scrollManager.scrollX(),n=this.instance.scrollManager.scrollElement(),a=function(o,l,d){for(var u=o;u&&Vp(u)&&!la(u,"body");){if(u===d)return!1;if(ot(l,H?.getComputedStyle(u).position))return!0;u=RT(u)}return!1}(PT(e),["fixed","sticky"],n);return{x:e.clientX+(a?0:i),y:e.clientY+(a?0:s),target_fixed:a,type:t}}jt(e,t){var s;if(t===void 0&&(t="click"),!Iv(e.target)&&qv(e)){var i=this.Gt(e,t);(s=this.rageclicks)!=null&&s.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this.Vt(Ne({},i,{type:"rageclick"})),this.Vt(i)}}Ht(e){!Iv(e.target)&&qv(e)&&(clearTimeout(this.Wt),this.Wt=setTimeout(()=>{this.Vt(this.Gt(e,"mousemove"))},500))}Vt(e){if(H){var t=H.location.href,s=this.instance.config.mask_personal_data_properties,i=this.instance.config.custom_personal_data_properties,n=s?el([],tl,i||[]):[],a=uu(t,n,hu);this.N=this.N||{},this.N[a]||(this.N[a]=[]),this.N[a].push(e)}}Lt(){this.N&&!nc(this.N)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}class Hv{constructor(e){this.Jt=(t,s,i)=>{i&&(i.noSessionId||i.activityTimeout||i.sessionPastMaximumLength)&&(_e.info("[PageViewManager] Session rotated, clearing pageview state",{sessionId:t,changeReason:i}),this.Kt=void 0,this._instance.scrollManager.resetContext())},this._instance=e,this.Yt()}Yt(){var e;this.Xt=(e=this._instance.sessionManager)==null?void 0:e.onSessionId(this.Jt)}destroy(){var e;(e=this.Xt)==null||e.call(this),this.Xt=void 0}doPageView(e,t){var s,i=this.Qt(e,t);return this.Kt={pathname:(s=H?.location.pathname)!==null&&s!==void 0?s:"",pageViewId:t,timestamp:e},this._instance.scrollManager.resetContext(),i}doPageLeave(e){var t;return this.Qt(e,(t=this.Kt)==null?void 0:t.pageViewId)}doEvent(){var e;return{$pageview_id:(e=this.Kt)==null?void 0:e.pageViewId}}Qt(e,t){var s=this.Kt;if(!s)return{$pageview_id:t};var i={$pageview_id:t,$prev_pageview_id:s.pageViewId},n=this._instance.scrollManager.getContext();if(n&&!this._instance.config.disable_scroll_properties){var{maxScrollHeight:a,lastScrollY:o,maxScrollY:l,maxContentHeight:d,lastContentY:u,maxContentY:h}=n;if(!(Te(a)||Te(o)||Te(l)||Te(d)||Te(u)||Te(h))){a=Math.ceil(a),o=Math.ceil(o),l=Math.ceil(l),d=Math.ceil(d),u=Math.ceil(u),h=Math.ceil(h);var p=a<=1?1:Or(o/a,0,1,_e),m=a<=1?1:Or(l/a,0,1,_e),f=d<=1?1:Or(u/d,0,1,_e),g=d<=1?1:Or(h/d,0,1,_e);i=ds(i,{$prev_pageview_last_scroll:o,$prev_pageview_last_scroll_percentage:p,$prev_pageview_max_scroll:l,$prev_pageview_max_scroll_percentage:m,$prev_pageview_last_content:u,$prev_pageview_last_content_percentage:f,$prev_pageview_max_content:h,$prev_pageview_max_content_percentage:g})}}return s.pathname&&(i.$prev_pageview_pathname=s.pathname),s.timestamp&&(i.$prev_pageview_duration=(e.getTime()-s.timestamp.getTime())/1e3),i}}var fn=function(r){return r.GZipJS="gzip-js",r.Base64="base64",r}({}),pr=Uint8Array,Ti=Uint16Array,$c=Uint32Array,Hy=new pr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xy=new pr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Xv=new pr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),JT=function(r,e){for(var t=new Ti(31),s=0;s<31;++s)t[s]=e+=1<<r[s-1];var i=new $c(t[30]);for(s=1;s<30;++s)for(var n=t[s];n<t[s+1];++n)i[n]=n-t[s]<<5|s;return[t,i]},ZT=JT(Hy,2),sD=ZT[0],Ug=ZT[1];sD[28]=258,Ug[258]=28;for(var Kv=JT(Xy,0)[1],eA=new Ti(32768),Ot=0;Ot<32768;++Ot){var La=(43690&Ot)>>>1|(21845&Ot)<<1;La=(61680&(La=(52428&La)>>>2|(13107&La)<<2))>>>4|(3855&La)<<4,eA[Ot]=((65280&La)>>>8|(255&La)<<8)>>>1}var hd=function(r,e,t){for(var s=r.length,i=0,n=new Ti(e);i<s;++i)++n[r[i]-1];var a,o=new Ti(e);for(i=0;i<e;++i)o[i]=o[i-1]+n[i-1]<<1;for(a=new Ti(s),i=0;i<s;++i)a[i]=eA[o[r[i]-1]++]>>>15-r[i];return a},jo=new pr(288);for(Ot=0;Ot<144;++Ot)jo[Ot]=8;for(Ot=144;Ot<256;++Ot)jo[Ot]=9;for(Ot=256;Ot<280;++Ot)jo[Ot]=7;for(Ot=280;Ot<288;++Ot)jo[Ot]=8;var rp=new pr(32);for(Ot=0;Ot<32;++Ot)rp[Ot]=5;var iD=hd(jo,9),rD=hd(rp,5),tA=function(r){return(r/8>>0)+(7&r&&1)},sA=function(r,e,t){(t==null||t>r.length)&&(t=r.length);var s=new(r instanceof Ti?Ti:r instanceof $c?$c:pr)(t-e);return s.set(r.subarray(e,t)),s},nn=function(r,e,t){t<<=7&e;var s=e/8>>0;r[s]|=t,r[s+1]|=t>>>8},Tl=function(r,e,t){t<<=7&e;var s=e/8>>0;r[s]|=t,r[s+1]|=t>>>8,r[s+2]|=t>>>16},Sm=function(r,e){for(var t=[],s=0;s<r.length;++s)r[s]&&t.push({s,f:r[s]});var i=t.length,n=t.slice();if(!i)return[new pr(0),0];if(i==1){var a=new pr(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(k,C){return k.f-C.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],d=0,u=1,h=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=i-1;)o=t[t[d].f<t[h].f?d++:h++],l=t[d!=u&&t[d].f<t[h].f?d++:h++],t[u++]={s:-1,f:o.f+l.f,l:o,r:l};var p=n[0].s;for(s=1;s<i;++s)n[s].s>p&&(p=n[s].s);var m=new Ti(p+1),f=Gg(t[u-1],m,0);if(f>e){s=0;var g=0,y=f-e,x=1<<y;for(n.sort(function(k,C){return m[C.s]-m[k.s]||k.f-C.f});s<i;++s){var v=n[s].s;if(!(m[v]>e))break;g+=x-(1<<f-m[v]),m[v]=e}for(g>>>=y;g>0;){var b=n[s].s;m[b]<e?g-=1<<e-m[b]++-1:++s}for(;s>=0&&g;--s){var S=n[s].s;m[S]==e&&(--m[S],++g)}f=e}return[new pr(m),f]},Gg=function(r,e,t){return r.s==-1?Math.max(Gg(r.l,e,t+1),Gg(r.r,e,t+1)):e[r.s]=t},Qv=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new Ti(++e),s=0,i=r[0],n=1,a=function(l){t[s++]=l},o=1;o<=e;++o)if(r[o]==i&&o!=e)++n;else{if(!i&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(i),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(i);n=1,i=r[o]}return[t.subarray(0,s),e]},Al=function(r,e){for(var t=0,s=0;s<e.length;++s)t+=r[s]*e[s];return t},Wg=function(r,e,t){var s=t.length,i=tA(e+2);r[i]=255&s,r[i+1]=s>>>8,r[i+2]=255^r[i],r[i+3]=255^r[i+1];for(var n=0;n<s;++n)r[i+n+4]=t[n];return 8*(i+4+s)},Jv=function(r,e,t,s,i,n,a,o,l,d,u){nn(e,u++,t),++i[256];for(var h=Sm(i,15),p=h[0],m=h[1],f=Sm(n,15),g=f[0],y=f[1],x=Qv(p),v=x[0],b=x[1],S=Qv(g),k=S[0],C=S[1],A=new Ti(19),T=0;T<v.length;++T)A[31&v[T]]++;for(T=0;T<k.length;++T)A[31&k[T]]++;for(var j=Sm(A,7),_=j[0],M=j[1],E=19;E>4&&!_[Xv[E-1]];--E);var D,R,B,O,F=d+5<<3,I=Al(i,jo)+Al(n,rp)+a,K=Al(i,p)+Al(n,g)+a+14+3*E+Al(A,_)+(2*A[16]+3*A[17]+7*A[18]);if(F<=I&&F<=K)return Wg(e,u,r.subarray(l,l+d));if(nn(e,u,1+(K<I)),u+=2,K<I){D=hd(p,m),R=p,B=hd(g,y),O=g;var ee=hd(_,M);for(nn(e,u,b-257),nn(e,u+5,C-1),nn(e,u+10,E-4),u+=14,T=0;T<E;++T)nn(e,u+3*T,_[Xv[T]]);u+=3*E;for(var P=[v,k],W=0;W<2;++W){var z=P[W];for(T=0;T<z.length;++T){var G=31&z[T];nn(e,u,ee[G]),u+=_[G],G>15&&(nn(e,u,z[T]>>>5&127),u+=z[T]>>>12)}}}else D=iD,R=jo,B=rD,O=rp;for(T=0;T<o;++T)if(s[T]>255){G=s[T]>>>18&31,Tl(e,u,D[G+257]),u+=R[G+257],G>7&&(nn(e,u,s[T]>>>23&31),u+=Hy[G]);var ce=31&s[T];Tl(e,u,B[ce]),u+=O[ce],ce>3&&(Tl(e,u,s[T]>>>5&8191),u+=Xy[ce])}else Tl(e,u,D[s[T]]),u+=R[s[T]];return Tl(e,u,D[256]),u+R[256]},nD=new $c([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),aD=function(){for(var r=new $c(256),e=0;e<256;++e){for(var t=e,s=9;--s;)t=(1&t&&3988292384)^t>>>1;r[e]=t}return r}(),oD=function(r,e,t,s,i){return function(n,a,o,l,d,u){var h=n.length,p=new pr(l+h+5*(1+Math.floor(h/7e3))+d),m=p.subarray(l,p.length-d),f=0;if(!a||h<8)for(var g=0;g<=h;g+=65535){var y=g+65535;y<h?f=Wg(m,f,n.subarray(g,y)):(m[g]=u,f=Wg(m,f,n.subarray(g,h)))}else{for(var x=nD[a-1],v=x>>>13,b=8191&x,S=(1<<o)-1,k=new Ti(32768),C=new Ti(S+1),A=Math.ceil(o/3),T=2*A,j=function(Pe){return(n[Pe]^n[Pe+1]<<A^n[Pe+2]<<T)&S},_=new $c(25e3),M=new Ti(288),E=new Ti(32),D=0,R=0,B=(g=0,0),O=0,F=0;g<h;++g){var I=j(g),K=32767&g,ee=C[I];if(k[K]=ee,C[I]=K,O<=g){var P=h-g;if((D>7e3||B>24576)&&P>423){f=Jv(n,m,0,_,M,E,R,B,F,g-F,f),B=D=R=0,F=g;for(var W=0;W<286;++W)M[W]=0;for(W=0;W<30;++W)E[W]=0}var z=2,G=0,ce=b,ae=K-ee&32767;if(P>2&&I==j(g-ae))for(var te=Math.min(v,P)-1,Ve=Math.min(32767,g),q=Math.min(258,P);ae<=Ve&&--ce&&K!=ee;){if(n[g+z]==n[g+z-ae]){for(var oe=0;oe<q&&n[g+oe]==n[g+oe-ae];++oe);if(oe>z){if(z=oe,G=ae,oe>te)break;var V=Math.min(ae,oe-2),he=0;for(W=0;W<V;++W){var Se=g-ae+W+32768&32767,J=Se-k[Se]+32768&32767;J>he&&(he=J,ee=Se)}}}ae+=(K=ee)-(ee=k[K])+32768&32767}if(G){_[B++]=268435456|Ug[z]<<18|Kv[G];var be=31&Ug[z],ie=31&Kv[G];R+=Hy[be]+Xy[ie],++M[257+be],++E[ie],O=g+z,++D}else _[B++]=n[g],++M[n[g]]}}f=Jv(n,m,u,_,M,E,R,B,F,g-F,f)}return sA(p,0,l+tA(f)+d)}(r,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(r.length)))):12+e.mem,t,s,!0)},Tm=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8};function cD(r,e){e===void 0&&(e={});var t=function(){var o=4294967295;return{p:function(l){for(var d=o,u=0;u<l.length;++u)d=aD[255&d^l[u]]^d>>>8;o=d},d:function(){return 4294967295^o}}}(),s=r.length;t.p(r);var i,n=oD(r,e,10+((i=e).filename&&i.filename.length+1||0),8),a=n.length;return function(o,l){var d=l.filename;if(o[0]=31,o[1]=139,o[2]=8,o[8]=l.level<2?4:l.level==9?2:0,o[9]=3,l.mtime!=0&&Tm(o,4,Math.floor(new Date(l.mtime||Date.now())/1e3)),d){o[3]=8;for(var u=0;u<=d.length;++u)o[u+10]=d.charCodeAt(u)}}(n,e),Tm(n,a-8,t.d()),Tm(n,a-4,s),n}var lD=function(r){var e,t,s,i,n="";for(e=t=0,s=(r=(r+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,i=0;i<s;i++){var a=r.charCodeAt(i),o=null;a<128?t++:o=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),jr(o)||(t>e&&(n+=r.substring(e,t)),n+=o,e=t=i+1)}return t>e&&(n+=r.substring(e,r.length)),n},dD=!!Ag||!!Tg,Zv="text/plain",np=function(r,e,t){var s;t===void 0&&(t=!0);var[i,n]=r.split("?"),a=Ne({},e),o=(s=n?.split("&").map(d=>{var u,[h,p]=d.split("="),m=t&&(u=a[h])!==null&&u!==void 0?u:p;return delete a[h],h+"="+m}))!==null&&s!==void 0?s:[],l=AI(a);return l&&o.push(l),i+"?"+o.join("&")},Xl=(r,e)=>JSON.stringify(r,(t,s)=>typeof s=="bigint"?s.toString():s,e),Am=r=>{var{data:e,compression:t}=r;if(e){if(t===fn.GZipJS){var s=cD(function(l,d){var u=l.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(l);for(var h=new pr(l.length+(l.length>>>1)),p=0,m=function(x){h[p++]=x},f=0;f<u;++f){if(p+5>h.length){var g=new pr(p+8+(u-f<<1));g.set(h),h=g}var y=l.charCodeAt(f);y<128||d?m(y):y<2048?(m(192|y>>>6),m(128|63&y)):y>55295&&y<57344?(m(240|(y=65536+(1047552&y)|1023&l.charCodeAt(++f))>>>18),m(128|y>>>12&63),m(128|y>>>6&63),m(128|63&y)):(m(224|y>>>12),m(128|y>>>6&63),m(128|63&y))}return sA(h,0,p)}(Xl(e)),{mtime:0}),i=new Blob([s],{type:Zv});return{contentType:Zv,body:i,estimatedSize:i.size}}if(t===fn.Base64){var n=function(l){var d,u,h,p,m,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g=0,y=0,x="",v=[];if(!l)return l;l=lD(l);do d=(m=l.charCodeAt(g++)<<16|l.charCodeAt(g++)<<8|l.charCodeAt(g++))>>18&63,u=m>>12&63,h=m>>6&63,p=63&m,v[y++]=f.charAt(d)+f.charAt(u)+f.charAt(h)+f.charAt(p);while(g<l.length);switch(x=v.join(""),l.length%3){case 1:x=x.slice(0,-2)+"==";break;case 2:x=x.slice(0,-1)+"="}return x}(Xl(e)),a=(l=>"data="+encodeURIComponent(typeof l=="string"?l:Xl(l)))(n);return{contentType:"application/x-www-form-urlencoded",body:a,estimatedSize:new Blob([a]).size}}var o=Xl(e);return{contentType:"application/json",body:o,estimatedSize:new Blob([o]).size}}},Sh=[];Tg&&Sh.push({transport:"fetch",method:r=>{var e,t,{contentType:s,body:i,estimatedSize:n}=(e=Am(r))!==null&&e!==void 0?e:{},a=new Headers;Dt(r.headers,function(u,h){a.append(h,u)}),s&&a.append("Content-Type",s);var o=r.url,l=null;if(yv){var d=new yv;l={signal:d.signal,timeout:setTimeout(()=>d.abort(),r.timeout)}}Tg(o,Ne({method:r?.method||"GET",headers:a,keepalive:r.method==="POST"&&(n||0)<52428.8,body:i,signal:(t=l)==null?void 0:t.signal},r.fetchOptions)).then(u=>u.text().then(h=>{var p={statusCode:u.status,text:h};if(u.status===200)try{p.json=JSON.parse(h)}catch(m){_e.error(m)}r.callback==null||r.callback(p)})).catch(u=>{_e.error(u),r.callback==null||r.callback({statusCode:0,text:u})}).finally(()=>l?clearTimeout(l.timeout):null)}}),Ag&&Sh.push({transport:"XHR",method:r=>{var e,t=new Ag;t.open(r.method||"GET",r.url,!0);var{contentType:s,body:i}=(e=Am(r))!==null&&e!==void 0?e:{};Dt(r.headers,function(n,a){t.setRequestHeader(a,n)}),s&&t.setRequestHeader("Content-Type",s),r.timeout&&(t.timeout=r.timeout),r.disableXHRCredentials||(t.withCredentials=!0),t.onreadystatechange=()=>{if(t.readyState===4){var n={statusCode:t.status,text:t.responseText};if(t.status===200)try{n.json=JSON.parse(t.responseText)}catch{}r.callback==null||r.callback(n)}},t.send(i)}}),$i!=null&&$i.sendBeacon&&Sh.push({transport:"sendBeacon",method:r=>{var e=np(r.url,{beacon:"1"});try{var t,{contentType:s,body:i}=(t=Am(r))!==null&&t!==void 0?t:{},n=typeof i=="string"?new Blob([i],{type:s}):i;$i.sendBeacon(e,n)}catch{}}});var ap=function(r,e){if(!function(t){try{new RegExp(t)}catch{return!1}return!0}(e))return!1;try{return new RegExp(e).test(r)}catch{return!1}};function e1(r,e,t){return Xl({distinct_id:r,userPropertiesToSet:e,userPropertiesToSetOnce:t})}var iA={exact:(r,e)=>e.some(t=>r.some(s=>t===s)),is_not:(r,e)=>e.every(t=>r.every(s=>t!==s)),regex:(r,e)=>e.some(t=>r.some(s=>ap(t,s))),not_regex:(r,e)=>e.every(t=>r.every(s=>!ap(t,s))),icontains:(r,e)=>e.map(Du).some(t=>r.map(Du).some(s=>t.includes(s))),not_icontains:(r,e)=>e.map(Du).every(t=>r.map(Du).every(s=>!t.includes(s))),gt:(r,e)=>e.some(t=>{var s=parseFloat(t);return!isNaN(s)&&r.some(i=>s>parseFloat(i))}),lt:(r,e)=>e.some(t=>{var s=parseFloat(t);return!isNaN(s)&&r.some(i=>s<parseFloat(i))})},Du=r=>r.toLowerCase();function rA(r,e){return!r||Object.entries(r).every(t=>{var[s,i]=t,n=e?.[s];if(Te(n)||jr(n))return!1;var a=[String(n)],o=iA[i.operator];return!!o&&o(i.values,a)})}var jm=as("[Error tracking]");class uD{constructor(e){var t,s;this.Zt=[],this.ti=new YR([new tI,new dI,new iI,new sI,new cI,new oI,new nI,new lI],eI()),this._instance=e,this.Zt=(t=(s=this._instance.persistence)==null?void 0:s.get_property(Dg))!==null&&t!==void 0?t:[]}onRemoteConfig(e){var t,s,i,n=(t=(s=e.errorTracking)==null?void 0:s.suppressionRules)!==null&&t!==void 0?t:[],a=(i=e.errorTracking)==null?void 0:i.captureExtensionExceptions;this.Zt=n,this._instance.persistence&&this._instance.persistence.register({[Dg]:this.Zt,[Mv]:a})}get ii(){var e,t=!!this._instance.get_property(Mv),s=this._instance.config.error_tracking.captureExtensionExceptions;return(e=s??t)!==null&&e!==void 0&&e}buildProperties(e,t){return this.ti.buildFromUnknown(e,{syntheticException:t?.syntheticException,mechanism:{handled:t?.handled}})}sendExceptionEvent(e){var t=e.$exception_list;if(this.ei(t)){if(this.ri(t))return void jm.info("Skipping exception capture because a suppression rule matched");if(!this.ii&&this.si(t))return void jm.info("Skipping exception capture because it was thrown by an extension");if(!this._instance.config.error_tracking.__capturePostHogExceptions&&this.ni(t))return void jm.info("Skipping exception capture because it was thrown by the PostHog SDK")}return this._instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent"})}ri(e){if(e.length===0)return!1;var t=e.reduce((s,i)=>{var{type:n,value:a}=i;return As(n)&&n.length>0&&s.$exception_types.push(n),As(a)&&a.length>0&&s.$exception_values.push(a),s},{$exception_types:[],$exception_values:[]});return this.Zt.some(s=>{var i=s.values.map(n=>{var a,o=iA[n.operator],l=bt(n.value)?n.value:[n.value],d=(a=t[n.key])!==null&&a!==void 0?a:[];return l.length>0&&o(l,d)});return s.type==="OR"?i.some(Boolean):i.every(Boolean)})}si(e){return e.flatMap(t=>{var s,i;return(s=(i=t.stacktrace)==null?void 0:i.frames)!==null&&s!==void 0?s:[]}).some(t=>t.filename&&t.filename.startsWith("chrome-extension://"))}ni(e){if(e.length>0){var t,s,i,n,a=(t=(s=e[0].stacktrace)==null?void 0:s.frames)!==null&&t!==void 0?t:[],o=a[a.length-1];return(i=o==null||(n=o.filename)==null?void 0:n.includes("posthog.com/static"))!==null&&i!==void 0&&i}return!1}ei(e){return!xt(e)&&bt(e)}}var er=as("[FeatureFlags]"),jl=as("[FeatureFlags]",{debugEnabled:!0}),_m="$active_feature_flags",Go="$override_feature_flags",t1="$feature_flag_payloads",_l="$override_feature_flag_payloads",s1="$feature_flag_request_id",i1="$feature_flag_evaluated_at",r1=r=>{var e={};for(var[t,s]of Ch(r||{}))s&&(e[t]=s);return e},hD=r=>{var e=r.flags;return e?(r.featureFlags=Object.fromEntries(Object.keys(e).map(t=>{var s;return[t,(s=e[t].variant)!==null&&s!==void 0?s:e[t].enabled]})),r.featureFlagPayloads=Object.fromEntries(Object.keys(e).filter(t=>e[t].enabled).filter(t=>{var s;return(s=e[t].metadata)==null?void 0:s.payload}).map(t=>{var s;return[t,(s=e[t].metadata)==null?void 0:s.payload]}))):er.warn("Using an older version of the feature flags endpoint. Please upgrade your PostHog server to the latest version"),r},pD=function(r){return r.FeatureFlags="feature_flags",r.Recordings="recordings",r}({});class mD{constructor(e){this.oi=!1,this.ai=!1,this.li=!1,this.ui=!1,this.hi=!1,this.di=!1,this.vi=!1,this.ci=!1,this._instance=e,this.featureFlagEventHandlers=[]}fi(){var e,t=(e=this._instance.config.evaluation_contexts)!==null&&e!==void 0?e:this._instance.config.evaluation_environments;return!this._instance.config.evaluation_environments||this._instance.config.evaluation_contexts||this.ci||(er.warn("evaluation_environments is deprecated. Use evaluation_contexts instead. evaluation_environments will be removed in a future version."),this.ci=!0),t!=null&&t.length?t.filter(s=>{var i=s&&typeof s=="string"&&s.trim().length>0;return i||er.error("Invalid evaluation context found:",s,"Expected non-empty string"),i}):[]}pi(){return this.fi().length>0}flags(){if(this._instance.config.__preview_remote_config)this.di=!0;else{var e=!this.gi&&(this._instance.config.advanced_disable_feature_flags||this._instance.config.advanced_disable_feature_flags_on_first_load);this.mi({disableFlags:e})}}get hasLoadedFlags(){return this.ai}getFlags(){return Object.keys(this.getFlagVariants())}getFlagsWithDetails(){var e=this._instance.get_property(Fg),t=this._instance.get_property(Go),s=this._instance.get_property(_l);if(!s&&!t)return e||{};var i=ds({},e||{}),n=[...new Set([...Object.keys(s||{}),...Object.keys(t||{})])];for(var a of n){var o,l,d=i[a],u=t?.[a],h=Te(u)?(o=d?.enabled)!==null&&o!==void 0&&o:!!u,p=Te(u)?d.variant:typeof u=="string"?u:void 0,m=s?.[a],f=Ne({},d,{enabled:h,variant:h?p??d?.variant:void 0});h!==d?.enabled&&(f.original_enabled=d?.enabled),p!==d?.variant&&(f.original_variant=d?.variant),m&&(f.metadata=Ne({},d?.metadata,{payload:m,original_payload:d==null||(l=d.metadata)==null?void 0:l.payload})),i[a]=f}return this.oi||(er.warn(" Overriding feature flag details!",{flagDetails:e,overriddenPayloads:s,finalDetails:i}),this.oi=!0),i}getFlagVariants(){var e=this._instance.get_property(ac),t=this._instance.get_property(Go);if(!t)return e||{};for(var s=ds({},e),i=Object.keys(t),n=0;n<i.length;n++)s[i[n]]=t[i[n]];return this.oi||(er.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:s}),this.oi=!0),s}getFlagPayloads(){var e=this._instance.get_property(t1),t=this._instance.get_property(_l);if(!t)return e||{};for(var s=ds({},e||{}),i=Object.keys(t),n=0;n<i.length;n++)s[i[n]]=t[i[n]];return this.oi||(er.warn(" Overriding feature flag payloads!",{flagPayloads:e,overriddenPayloads:t,finalPayloads:s}),this.oi=!0),s}reloadFeatureFlags(){this.ui||this._instance.config.advanced_disable_feature_flags||this.gi||(this.gi=setTimeout(()=>{this.mi()},5))}yi(){clearTimeout(this.gi),this.gi=void 0}ensureFlagsLoaded(){this.ai||this.li||this.gi||this.reloadFeatureFlags()}setAnonymousDistinctId(e){this.$anon_distinct_id=e}setReloadingPaused(e){this.ui=e}mi(e){var t;if(this.yi(),!this._instance.O())if(this.li)this.hi=!0;else{var s=this._instance.config.token,i=this._instance.get_property("$device_id"),n={token:s,distinct_id:this._instance.get_distinct_id(),groups:this._instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:Ne({},((t=this._instance.persistence)==null?void 0:t.get_initial_props())||{},this._instance.get_property(Hl)||{}),group_properties:this._instance.get_property(eo)};jr(i)||Te(i)||(n.$device_id=i),(e!=null&&e.disableFlags||this._instance.config.advanced_disable_feature_flags)&&(n.disable_flags=!0),this.pi()&&(n.evaluation_contexts=this.fi());var a=this._instance.config.__preview_remote_config,o=a?"/flags/?v=2":"/flags/?v=2&config=true",l=this._instance.config.advanced_only_evaluate_survey_feature_flags?"&only_evaluate_survey_feature_flags=true":"",d=this._instance.requestRouter.endpointFor("flags",o+l);a&&(n.timezone=QT()),this.li=!0,this._instance._send_request({method:"POST",url:d,data:n,compression:this._instance.config.disable_compression?void 0:fn.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:u=>{var h,p,m=!0;if(u.statusCode===200&&(this.hi||(this.$anon_distinct_id=void 0),m=!1),this.li=!1,this.di||(this.di=!0,this._instance.bi((p=u.json)!==null&&p!==void 0?p:{})),!n.disable_flags||this.hi)if(this.vi=!m,u.json&&(h=u.json.quotaLimited)!=null&&h.includes(pD.FeatureFlags))er.warn("You have hit your feature flags quota limit, and will not be able to load feature flags until the quota is reset.  Please visit https://posthog.com/docs/billing/limits-alerts to learn more.");else{var f;n.disable_flags||this.receivedFeatureFlags((f=u.json)!==null&&f!==void 0?f:{},m),this.hi&&(this.hi=!1,this.mi())}}})}}getFeatureFlag(e,t){if(t===void 0&&(t={}),this.ai||this.getFlags()&&this.getFlags().length>0){var s=this.getFlagVariants()[e],i=""+s,n=this._instance.get_property(s1)||void 0,a=this._instance.get_property(i1)||void 0,o=this._instance.get_property(Kh)||{};if((t.send_event||!("send_event"in t))&&(!(e in o)||!o[e].includes(i))){var l,d,u,h,p,m,f,g,y;bt(o[e])?o[e].push(i):o[e]=[i],(l=this._instance.persistence)==null||l.register({[Kh]:o});var x=this.getFeatureFlagDetails(e),v={$feature_flag:e,$feature_flag_response:s,$feature_flag_payload:this.getFeatureFlagPayload(e)||null,$feature_flag_request_id:n,$feature_flag_evaluated_at:a,$feature_flag_bootstrapped_response:((d=this._instance.config.bootstrap)==null||(d=d.featureFlags)==null?void 0:d[e])||null,$feature_flag_bootstrapped_payload:((u=this._instance.config.bootstrap)==null||(u=u.featureFlagPayloads)==null?void 0:u[e])||null,$used_bootstrap_value:!this.vi};Te(x==null||(h=x.metadata)==null?void 0:h.version)||(v.$feature_flag_version=x.metadata.version);var b,S=(p=x==null||(m=x.reason)==null?void 0:m.description)!==null&&p!==void 0?p:x==null||(f=x.reason)==null?void 0:f.code;S&&(v.$feature_flag_reason=S),x!=null&&(g=x.metadata)!=null&&g.id&&(v.$feature_flag_id=x.metadata.id),Te(x?.original_variant)&&Te(x?.original_enabled)||(v.$feature_flag_original_response=Te(x.original_variant)?x.original_enabled:x.original_variant),x!=null&&(y=x.metadata)!=null&&y.original_payload&&(v.$feature_flag_original_payload=x==null||(b=x.metadata)==null?void 0:b.original_payload),this._instance.capture("$feature_flag_called",v)}return s}er.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}getFeatureFlagDetails(e){return this.getFlagsWithDetails()[e]}getFeatureFlagPayload(e){return this.getFlagPayloads()[e]}getRemoteConfigPayload(e,t){var s=this._instance.config.token,i={distinct_id:this._instance.get_distinct_id(),token:s};this.pi()&&(i.evaluation_contexts=this.fi()),this._instance._send_request({method:"POST",url:this._instance.requestRouter.endpointFor("flags","/flags/?v=2&config=true"),data:i,compression:this._instance.config.disable_compression?void 0:fn.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:n=>{var a,o=(a=n.json)==null?void 0:a.featureFlagPayloads;t(o?.[e]||void 0)}})}isFeatureEnabled(e,t){if(t===void 0&&(t={}),this.ai||this.getFlags()&&this.getFlags().length>0){var s=this.getFeatureFlag(e,t);return Te(s)?void 0:!!s}er.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}addFeatureFlagsHandler(e){this.featureFlagEventHandlers.push(e)}removeFeatureFlagsHandler(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(t=>t!==e)}receivedFeatureFlags(e,t){if(this._instance.persistence){this.ai=!0;var s=this.getFlagVariants(),i=this.getFlagPayloads(),n=this.getFlagsWithDetails();(function(a,o,l,d,u){l===void 0&&(l={}),d===void 0&&(d={}),u===void 0&&(u={});var h=hD(a),p=h.flags,m=h.featureFlags,f=h.featureFlagPayloads;if(m){var g=a.requestId,y=a.evaluatedAt;if(bt(m)){er.warn("v1 of the feature flags endpoint is deprecated. Please use the latest version.");var x={};if(m)for(var v=0;v<m.length;v++)x[m[v]]=!0;o&&o.register({[_m]:m,[ac]:x})}else{var b=m,S=f,k=p;a.errorsWhileComputingFlags&&(b=Ne({},l,b),S=Ne({},d,S),k=Ne({},u,k)),o&&o.register(Ne({[_m]:Object.keys(r1(b)),[ac]:b||{},[t1]:S||{},[Fg]:k||{}},g?{[s1]:g}:{},y?{[i1]:y}:{}))}}})(e,this._instance.persistence,s,i,n),this.wi(t)}}override(e,t){t===void 0&&(t=!1),er.warn("override is deprecated. Please use overrideFeatureFlags instead."),this.overrideFeatureFlags({flags:e,suppressWarning:t})}overrideFeatureFlags(e){if(!this._instance.__loaded||!this._instance.persistence)return er.uninitializedWarning("posthog.featureFlags.overrideFeatureFlags");if(e===!1)return this._instance.persistence.unregister(Go),this._instance.persistence.unregister(_l),this.wi(),jl.info("All overrides cleared");if(e&&typeof e=="object"&&("flags"in e||"payloads"in e)){var t,s=e;if(this.oi=!!((t=s.suppressWarning)!==null&&t!==void 0&&t),"flags"in s){if(s.flags===!1)this._instance.persistence.unregister(Go),jl.info("Flag overrides cleared");else if(s.flags){if(bt(s.flags)){for(var i={},n=0;n<s.flags.length;n++)i[s.flags[n]]=!0;this._instance.persistence.register({[Go]:i})}else this._instance.persistence.register({[Go]:s.flags});jl.info("Flag overrides set",{flags:s.flags})}}return"payloads"in s&&(s.payloads===!1?(this._instance.persistence.unregister(_l),jl.info("Payload overrides cleared")):s.payloads&&(this._instance.persistence.register({[_l]:s.payloads}),jl.info("Payload overrides set",{payloads:s.payloads}))),void this.wi()}this.wi()}onFeatureFlags(e){if(this.addFeatureFlagsHandler(e),this.ai){var{flags:t,flagVariants:s}=this.xi();e(t,s)}return()=>this.removeFeatureFlagsHandler(e)}updateEarlyAccessFeatureEnrollment(e,t,s){var i,n=(this._instance.get_property(ql)||[]).find(d=>d.flagKey===e),a={["$feature_enrollment/"+e]:t},o={$feature_flag:e,$feature_enrollment:t,$set:a};n&&(o.$early_access_feature_name=n.name),s&&(o.$feature_enrollment_stage=s),this._instance.capture("$feature_enrollment_update",o),this.setPersonPropertiesForFlags(a,!1);var l=Ne({},this.getFlagVariants(),{[e]:t});(i=this._instance.persistence)==null||i.register({[_m]:Object.keys(r1(l)),[ac]:l}),this.wi()}getEarlyAccessFeatures(e,t,s){t===void 0&&(t=!1);var i=this._instance.get_property(ql),n=s?"&"+s.map(a=>"stage="+a).join("&"):"";if(i&&!t)return e(i);this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/early_access_features/?token="+this._instance.config.token+n),method:"GET",callback:a=>{var o,l;if(a.json){var d=a.json.earlyAccessFeatures;return(o=this._instance.persistence)==null||o.unregister(ql),(l=this._instance.persistence)==null||l.register({[ql]:d}),e(d)}}})}xi(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter(s=>t[s]),flagVariants:Object.keys(t).filter(s=>t[s]).reduce((s,i)=>(s[i]=t[i],s),{})}}wi(e){var{flags:t,flagVariants:s}=this.xi();this.featureFlagEventHandlers.forEach(i=>i(t,s,{errorsLoading:e}))}setPersonPropertiesForFlags(e,t){t===void 0&&(t=!0);var s=this._instance.get_property(Hl)||{};this._instance.register({[Hl]:Ne({},s,e)}),t&&this._instance.reloadFeatureFlags()}resetPersonPropertiesForFlags(){this._instance.unregister(Hl)}setGroupPropertiesForFlags(e,t){t===void 0&&(t=!0);var s=this._instance.get_property(eo)||{};Object.keys(s).length!==0&&Object.keys(s).forEach(i=>{s[i]=Ne({},s[i],e[i]),delete e[i]}),this._instance.register({[eo]:Ne({},s,e)}),t&&this._instance.reloadFeatureFlags()}resetGroupPropertiesForFlags(e){if(e){var t=this._instance.get_property(eo)||{};this._instance.register({[eo]:Ne({},t,{[e]:{}})})}else this._instance.unregister(eo)}reset(){this.ai=!1,this.li=!1,this.ui=!1,this.hi=!1,this.di=!1,this.vi=!1,this.$anon_distinct_id=void 0,this.yi(),this.oi=!1}}var fD=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"];class Em{constructor(e,t){this.R=e,this.props={},this.Ei=!1,this.$i=(s=>{var i="";return s.token&&(i=s.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),s.persistence_name?"ph_"+s.persistence_name:"ph_"+i+"_posthog"})(e),this.Y=this.Si(e),this.load(),e.debug&&_e.info("Persistence loaded",e.persistence,Ne({},this.props)),this.update_config(e,e,t),this.save()}isDisabled(){return!!this.ki}Si(e){fD.indexOf(e.persistence.toLowerCase())===-1&&(_e.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=function(i){i===void 0&&(i=[]);var n=[...FI,...i];return Ne({},qt,{W:function(a){try{var o={};try{o=Br.W(a)||{}}catch{}var l=ds(o,JSON.parse(qt.q(a)||"{}"));return qt.G(a,l),l}catch{}return null},G:function(a,o,l,d,u,h){try{qt.G(a,o,void 0,void 0,h);var p={};n.forEach(m=>{o[m]&&(p[m]=o[m])}),Object.keys(p).length&&Br.G(a,p,l,d,u,h)}catch(m){qt.B(m)}},V:function(a,o){try{H?.localStorage.removeItem(a),Br.V(a,o)}catch(l){qt.B(l)}}})}(e.cookie_persisted_properties||[]),s=e.persistence.toLowerCase();return s==="localstorage"&&qt.H()?qt:s==="localstorage+cookie"&&t.H()?t:s==="sessionstorage"&&Ls.H()?Ls:s==="memory"?BI:s==="cookie"?Br:t.H()?t:Br}properties(){var e={};return Dt(this.props,function(t,s){if(s===ac&&Ts(t))for(var i=Object.keys(t),n=0;n<i.length;n++)e["$feature/"+i[n]]=t[i[n]];else o=s,l=!1,(jr(a=gI)?l:gv&&a.indexOf===gv?a.indexOf(o)!=-1:(Dt(a,function(d){if(l||(l=d===o))return Hh}),l))||(e[s]=t);var a,o,l}),e}load(){if(!this.ki){var e=this.Y.W(this.$i);e&&(this.props=ds({},e))}}save(){this.ki||this.Y.G(this.$i,this.props,this.Pi,this.Ti,this.Ii,this.R.debug)}remove(){this.Y.V(this.$i,!1),this.Y.V(this.$i,!0)}clear(){this.remove(),this.props={}}register_once(e,t,s){if(Ts(e)){Te(t)&&(t="None"),this.Pi=Te(s)?this.Ci:s;var i=!1;if(Dt(e,(n,a)=>{this.props.hasOwnProperty(a)&&this.props[a]!==t||(this.props[a]=n,i=!0)}),i)return this.save(),!0}return!1}register(e,t){if(Ts(e)){this.Pi=Te(t)?this.Ci:t;var s=!1;if(Dt(e,(i,n)=>{e.hasOwnProperty(n)&&this.props[n]!==i&&(this.props[n]=i,s=!0)}),s)return this.save(),!0}return!1}unregister(e){e in this.props&&(delete this.props[e],this.save())}update_campaign_params(){if(!this.Ei){var e=WT(this.R.custom_campaign_params,this.R.mask_personal_data_properties,this.R.custom_personal_data_properties);nc(Gy(e))||this.register(e),this.Ei=!0}}update_search_keyword(){var e;this.register((e=Ae?.referrer)?qT(e):{})}update_referrer_info(){var e;this.register_once({$referrer:HT(),$referring_domain:Ae!=null&&Ae.referrer&&((e=ep(Ae.referrer))==null?void 0:e.host)||"$direct"},void 0)}set_initial_person_info(){this.props[$g]||this.props[zg]||this.register_once({[Qh]:XT(this.R.mask_personal_data_properties,this.R.custom_personal_data_properties)},void 0)}get_initial_props(){var e={};Dt([zg,$g],a=>{var o=this.props[a];o&&Dt(o,function(l,d){e["$initial_"+jg(d)]=l})});var t,s,i=this.props[Qh];if(i){var n=(t=KT(i),s={},Dt(t,function(a,o){s["$initial_"+jg(o)]=a}),s);ds(e,n)}return e}safe_merge(e){return Dt(this.props,function(t,s){s in e||(e[s]=t)}),e}update_config(e,t,s){if(this.Ci=this.Pi=e.cookie_expiration,this.set_disabled(e.disable_persistence||!!s),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence||!((a,o)=>{if(a.length!==o.length)return!1;var l=[...a].sort(),d=[...o].sort();return l.every((u,h)=>u===d[h])})(e.cookie_persisted_properties||[],t.cookie_persisted_properties||[])){var i=this.Si(e),n=this.props;this.clear(),this.Y=i,this.props=n,this.save()}}set_disabled(e){this.ki=e,this.ki?this.remove():this.save()}set_cross_subdomain(e){e!==this.Ti&&(this.Ti=e,this.remove(),this.save())}set_secure(e){e!==this.Ii&&(this.Ii=e,this.remove(),this.save())}set_event_timer(e,t){var s=this.props[Yl]||{};s[e]=t,this.props[Yl]=s,this.save()}remove_event_timer(e){var t=(this.props[Yl]||{})[e];return Te(t)||(delete this.props[Yl][e],this.save()),t}get_property(e){return this.props[e]}set_property(e,t){this.props[e]=t,this.save()}}var n1=as("[Product Tours]"),Mm="ph_product_tours";class gD{constructor(e){this.Ri=null,this.Fi=null,this._instance=e}onRemoteConfig(e){this._instance.persistence&&this._instance.persistence.register({[Nv]:!(e==null||!e.productTours)}),this.loadIfEnabled()}loadIfEnabled(){var e,t;this.Ri||(e=this._instance).config.disable_product_tours||(t=e.persistence)==null||!t.get_property(Nv)||this.it(()=>this.Mi())}it(e){var t,s;(t=Ye.__PosthogExtensions__)!=null&&t.generateProductTours?e():(s=Ye.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"product-tours",i=>{i?n1.error("Could not load product tours script",i):e()})}Mi(){var e;!this.Ri&&(e=Ye.__PosthogExtensions__)!=null&&e.generateProductTours&&(this.Ri=Ye.__PosthogExtensions__.generateProductTours(this._instance,!0))}getProductTours(e,t){if(t===void 0&&(t=!1),!bt(this.Fi)||t){var s=this._instance.persistence;if(s){var i=s.props[Mm];if(bt(i)&&!t)return this.Fi=i,void e(i,{isLoaded:!0})}this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/product_tours/?token="+this._instance.config.token),method:"GET",callback:n=>{var a=n.statusCode;if(a!==200||!n.json){var o="Product Tours API could not be loaded, status: "+a;return n1.error(o),void e([],{isLoaded:!1,error:o})}var l=bt(n.json.product_tours)?n.json.product_tours:[];this.Fi=l,s&&s.register({[Mm]:l}),e(l,{isLoaded:!0})}})}else e(this.Fi,{isLoaded:!0})}getActiveProductTours(e){xt(this.Ri)?e([],{isLoaded:!1,error:"Product tours not loaded"}):this.Ri.getActiveProductTours(e)}showProductTour(e){var t;(t=this.Ri)==null||t.showTourById(e)}previewTour(e){this.Ri?this.Ri.previewTour(e):this.it(()=>{var t;this.Mi(),(t=this.Ri)==null||t.previewTour(e)})}dismissProductTour(){var e;(e=this.Ri)==null||e.dismissTour("user_clicked_skip")}nextStep(){var e;(e=this.Ri)==null||e.nextStep()}previousStep(){var e;(e=this.Ri)==null||e.previousStep()}clearCache(){var e;this.Fi=null,(e=this._instance.persistence)==null||e.unregister(Mm)}resetTour(e){var t;(t=this.Ri)==null||t.resetTour(e)}resetAllTours(){var e;(e=this.Ri)==null||e.resetAllTours()}cancelPendingTour(e){var t;(t=this.Ri)==null||t.cancelPendingTour(e)}}var El=function(r){return r.Activation="events",r.Cancellation="cancelEvents",r}({});(function(r){return r.Button="button",r.Tab="tab",r.Selector="selector",r})({});(function(r){return r.TopLeft="top_left",r.TopRight="top_right",r.TopCenter="top_center",r.MiddleLeft="middle_left",r.MiddleRight="middle_right",r.MiddleCenter="middle_center",r.Left="left",r.Center="center",r.Right="right",r.NextToTrigger="next_to_trigger",r})({});(function(r){return r.Top="top",r.Left="left",r.Right="right",r.Bottom="bottom",r})({});var Pm=function(r){return r.Popover="popover",r.API="api",r.Widget="widget",r.ExternalSurvey="external_survey",r}({});(function(r){return r.Open="open",r.MultipleChoice="multiple_choice",r.SingleChoice="single_choice",r.Rating="rating",r.Link="link",r})({});(function(r){return r.NextQuestion="next_question",r.End="end",r.ResponseBased="response_based",r.SpecificQuestion="specific_question",r})({});(function(r){return r.Once="once",r.Recurring="recurring",r.Always="always",r})({});var Kl=function(r){return r.SHOWN="survey shown",r.DISMISSED="survey dismissed",r.SENT="survey sent",r.ABANDONED="survey abandoned",r}({}),Nm=function(r){return r.SURVEY_ID="$survey_id",r.SURVEY_NAME="$survey_name",r.SURVEY_RESPONSE="$survey_response",r.SURVEY_ITERATION="$survey_iteration",r.SURVEY_ITERATION_START_DATE="$survey_iteration_start_date",r.SURVEY_PARTIALLY_COMPLETED="$survey_partially_completed",r.SURVEY_SUBMISSION_ID="$survey_submission_id",r.SURVEY_QUESTIONS="$survey_questions",r.SURVEY_COMPLETED="$survey_completed",r.PRODUCT_TOUR_ID="$product_tour_id",r.SURVEY_LAST_SEEN_DATE="$survey_last_seen_date",r}({}),Yg=function(r){return r.Popover="popover",r.Inline="inline",r}({}),_t=as("[Surveys]"),nA="seenSurvey_",yD=(r,e)=>{var t="$survey_"+e+"/"+r.id;return r.current_iteration&&r.current_iteration>0&&(t="$survey_"+e+"/"+r.id+"/"+r.current_iteration),t},a1=r=>((e,t)=>{var s=""+e+t.id;return t.current_iteration&&t.current_iteration>0&&(s=""+e+t.id+"_"+t.current_iteration),s})(nA,r),xD=[Pm.Popover,Pm.Widget,Pm.API],bD={ignoreConditions:!1,ignoreDelay:!1,displayType:Yg.Popover};class Ky{constructor(){this.Oi={},this.Oi={}}on(e,t){return this.Oi[e]||(this.Oi[e]=[]),this.Oi[e].push(t),()=>{this.Oi[e]=this.Oi[e].filter(s=>s!==t)}}emit(e,t){for(var s of this.Oi[e]||[])s(t);for(var i of this.Oi["*"]||[])i(e,t)}}function Wo(r,e,t){if(xt(r))return!1;switch(t){case"exact":return r===e;case"contains":var s=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/_/g,".").replace(/%/g,".*");return new RegExp(s,"i").test(r);case"regex":try{return new RegExp(e).test(r)}catch{return!1}default:return!1}}class vD{constructor(e){this.Ai=new Ky,this.Di=(t,s)=>this.ji(t,s)&&this.Li(t,s)&&this.Ni(t,s)&&this.Ui(t,s),this.ji=(t,s)=>s==null||!s.event||t?.event===s?.event,this._instance=e,this.zi=new Set,this.Hi=new Set}init(){var e;if(!Te((e=this._instance)==null?void 0:e.Bi)){var t;(t=this._instance)==null||t.Bi((s,i)=>{this.on(s,i)})}}register(e){var t,s;if(!Te((t=this._instance)==null?void 0:t.Bi)&&(e.forEach(a=>{var o,l;(o=this.Hi)==null||o.add(a),(l=a.steps)==null||l.forEach(d=>{var u;(u=this.zi)==null||u.add(d?.event||"")})}),(s=this._instance)!=null&&s.autocapture)){var i,n=new Set;e.forEach(a=>{var o;(o=a.steps)==null||o.forEach(l=>{l!=null&&l.selector&&n.add(l?.selector)})}),(i=this._instance)==null||i.autocapture.setElementSelectors(n)}}on(e,t){var s;t!=null&&e.length!=0&&(this.zi.has(e)||this.zi.has(t?.event))&&this.Hi&&((s=this.Hi)==null?void 0:s.size)>0&&this.Hi.forEach(i=>{this.qi(t,i)&&this.Ai.emit("actionCaptured",i.name)})}Wi(e){this.onAction("actionCaptured",t=>e(t))}qi(e,t){if(t?.steps==null)return!1;for(var s of t.steps)if(this.Di(e,s))return!0;return!1}onAction(e,t){return this.Ai.on(e,t)}Li(e,t){if(t!=null&&t.url){var s,i=e==null||(s=e.properties)==null?void 0:s.$current_url;if(!i||typeof i!="string"||!Wo(i,t.url,t.url_matching||"contains"))return!1}return!0}Ni(e,t){return!!this.Gi(e,t)&&!!this.Vi(e,t)&&!!this.Ji(e,t)}Gi(e,t){var s;if(t==null||!t.href)return!0;var i=this.Ki(e);if(i.length>0)return i.some(o=>Wo(o.href,t.href,t.href_matching||"exact"));var n,a=(e==null||(s=e.properties)==null?void 0:s.$elements_chain)||"";return!!a&&Wo((n=a.match(/(?::|")href="(.*?)"/))?n[1]:"",t.href,t.href_matching||"exact")}Vi(e,t){var s;if(t==null||!t.text)return!0;var i=this.Ki(e);if(i.length>0)return i.some(d=>Wo(d.text,t.text,t.text_matching||"exact")||Wo(d.$el_text,t.text,t.text_matching||"exact"));var n,a,o,l=(e==null||(s=e.properties)==null?void 0:s.$elements_chain)||"";return!!l&&(n=function(d){for(var u,h=[],p=/(?::|")text="(.*?)"/g;!xt(u=p.exec(d));)h.includes(u[1])||h.push(u[1]);return h}(l),a=t.text,o=t.text_matching||"exact",n.some(d=>Wo(d,a,o)))}Ji(e,t){var s,i;if(t==null||!t.selector)return!0;var n=e==null||(s=e.properties)==null?void 0:s.$element_selectors;if(n!=null&&n.includes(t.selector))return!0;var a=(e==null||(i=e.properties)==null?void 0:i.$elements_chain)||"";if(t.selector_regex&&a)try{return new RegExp(t.selector_regex).test(a)}catch{return!1}return!1}Ki(e){var t;return(e==null||(t=e.properties)==null?void 0:t.$elements)==null?[]:e?.properties.$elements}Ui(e,t){return t==null||!t.properties||t.properties.length===0||rA(t.properties.reduce((s,i)=>{var n=bt(i.value)?i.value.map(String):i.value!=null?[String(i.value)]:[];return s[i.key]={values:n,operator:i.operator||"exact"},s},{}),e?.properties)}}class wD{constructor(e){this._instance=e,this.Yi=new Map,this.Xi=new Map,this.Qi=new Map}Zi(e,t){return!!e&&rA(e.propertyFilters,t?.properties)}te(e,t){var s=new Map;return e.forEach(i=>{var n;(n=i.conditions)==null||(n=n[t])==null||(n=n.values)==null||n.forEach(a=>{if(a!=null&&a.name){var o=s.get(a.name)||[];o.push(i.id),s.set(a.name,o)}})}),s}ie(e,t,s){var i=(s===El.Activation?this.Yi:this.Xi).get(e),n=[];return this.ee(a=>{n=a.filter(o=>i?.includes(o.id))}),n.filter(a=>{var o,l=(o=a.conditions)==null||(o=o[s])==null||(o=o.values)==null?void 0:o.find(d=>d.name===e);return this.Zi(l,t)})}register(e){var t;Te((t=this._instance)==null?void 0:t.Bi)||(this.re(e),this.se(e))}se(e){var t=e.filter(s=>{var i,n;return((i=s.conditions)==null?void 0:i.actions)&&((n=s.conditions)==null||(n=n.actions)==null||(n=n.values)==null?void 0:n.length)>0});t.length!==0&&(this.ne==null&&(this.ne=new vD(this._instance),this.ne.init(),this.ne.Wi(s=>{this.onAction(s)})),t.forEach(s=>{var i,n,a,o,l;s.conditions&&(i=s.conditions)!=null&&i.actions&&(n=s.conditions)!=null&&(n=n.actions)!=null&&n.values&&((a=s.conditions)==null||(a=a.actions)==null||(a=a.values)==null?void 0:a.length)>0&&((o=this.ne)==null||o.register(s.conditions.actions.values),(l=s.conditions)==null||(l=l.actions)==null||(l=l.values)==null||l.forEach(d=>{if(d&&d.name){var u=this.Qi.get(d.name);u&&u.push(s.id),this.Qi.set(d.name,u||[s.id])}}))}))}re(e){var t,s=e.filter(n=>{var a,o;return((a=n.conditions)==null?void 0:a.events)&&((o=n.conditions)==null||(o=o.events)==null||(o=o.values)==null?void 0:o.length)>0}),i=e.filter(n=>{var a,o;return((a=n.conditions)==null?void 0:a.cancelEvents)&&((o=n.conditions)==null||(o=o.cancelEvents)==null||(o=o.values)==null?void 0:o.length)>0});(s.length!==0||i.length!==0)&&((t=this._instance)==null||t.Bi((n,a)=>{this.onEvent(n,a)}),this.Yi=this.te(e,El.Activation),this.Xi=this.te(e,El.Cancellation))}onEvent(e,t){var s,i=this.oe(),n=this.ae(),a=this.le(),o=((s=this._instance)==null||(s=s.persistence)==null?void 0:s.props[n])||[];if(a===e&&t&&o.length>0){var l,d;i.info("event matched, removing item from activated items",{event:e,eventPayload:t,existingActivatedItems:o});var u=(t==null||(l=t.properties)==null?void 0:l.$survey_id)||(t==null||(d=t.properties)==null?void 0:d.$product_tour_id);if(u){var h=o.indexOf(u);h>=0&&(o.splice(h,1),this.ue(o))}}else{if(this.Xi.has(e)){var p=this.ie(e,t,El.Cancellation);p.length>0&&(i.info("cancel event matched, cancelling items",{event:e,itemsToCancel:p.map(f=>f.id)}),p.forEach(f=>{var g=o.indexOf(f.id);g>=0&&o.splice(g,1),this.he(f.id)}),this.ue(o))}if(this.Yi.has(e)){i.info("event name matched",{event:e,eventPayload:t,items:this.Yi.get(e)});var m=this.ie(e,t,El.Activation);this.ue(o.concat(m.map(f=>f.id)||[]))}}}onAction(e){var t,s=this.ae(),i=((t=this._instance)==null||(t=t.persistence)==null?void 0:t.props[s])||[];this.Qi.has(e)&&this.ue(i.concat(this.Qi.get(e)||[]))}ue(e){var t,s=this.oe(),i=this.ae(),n=[...new Set(e)].filter(a=>!this.de(a));s.info("updating activated items",{activatedItems:n}),(t=this._instance)==null||(t=t.persistence)==null||t.register({[i]:n})}getActivatedIds(){var e,t=this.ae(),s=(e=this._instance)==null||(e=e.persistence)==null?void 0:e.props[t];return s||[]}getEventToItemsMap(){return this.Yi}ve(){return this.ne}}class kD extends wD{constructor(e){super(e)}ae(){return"$surveys_activated"}le(){return Kl.SHOWN}ee(e){var t;(t=this._instance)==null||t.getSurveys(e)}he(e){var t;(t=this._instance)==null||t.cancelPendingSurvey(e)}oe(){return _t}de(){return!1}getSurveys(){return this.getActivatedIds()}getEventToSurveys(){return this.getEventToItemsMap()}}class CD{constructor(e){this.ce=void 0,this._surveyManager=null,this.fe=!1,this.pe=[],this.ge=null,this._instance=e,this._surveyEventReceiver=null}onRemoteConfig(e){if(!this._instance.config.disable_surveys){var t=e.surveys;if(xt(t))return _t.warn("Flags not loaded yet. Not loading surveys.");var s=bt(t);this.ce=s?t.length>0:t,_t.info("flags response received, isSurveysEnabled: "+this.ce),this.loadIfEnabled()}}reset(){localStorage.removeItem("lastSeenSurveyDate");for(var e=[],t=0;t<localStorage.length;t++){var s=localStorage.key(t);(s!=null&&s.startsWith(nA)||s!=null&&s.startsWith("inProgressSurvey_"))&&e.push(s)}e.forEach(i=>localStorage.removeItem(i))}loadIfEnabled(){if(!this._surveyManager)if(this.fe)_t.info("Already initializing surveys, skipping...");else if(this._instance.config.disable_surveys)_t.info("Disabled. Not loading surveys.");else if(this._instance.config.cookieless_mode&&this._instance.consent.isOptedOut())_t.info("Not loading surveys in cookieless mode without consent.");else{var e=Ye?.__PosthogExtensions__;if(e){if(!Te(this.ce)||this._instance.config.advanced_enable_surveys){var t=this.ce||this._instance.config.advanced_enable_surveys;this.fe=!0;try{var s=e.generateSurveys;if(s)return void this._e(s,t);var i=e.loadExternalDependency;if(!i)return void this.me("PostHog loadExternalDependency extension not found.");i(this._instance,"surveys",n=>{n||!e.generateSurveys?this.me("Could not load surveys script",n):this._e(e.generateSurveys,t)})}catch(n){throw this.me("Error initializing surveys",n),n}finally{this.fe=!1}}}else _t.error("PostHog Extensions not found.")}}_e(e,t){this._surveyManager=e(this._instance,t),this._surveyEventReceiver=new kD(this._instance),_t.info("Surveys loaded successfully"),this.ye({isLoaded:!0})}me(e,t){_t.error(e,t),this.ye({isLoaded:!1,error:e})}onSurveysLoaded(e){return this.pe.push(e),this._surveyManager&&this.ye({isLoaded:!0}),()=>{this.pe=this.pe.filter(t=>t!==e)}}getSurveys(e,t){if(t===void 0&&(t=!1),this._instance.config.disable_surveys)return _t.info("Disabled. Not loading surveys."),e([]);var s,i=this._instance.get_property(Bg);if(i&&!t)return e(i,{isLoaded:!0});typeof Promise<"u"&&this.ge?this.ge.then(n=>{var{surveys:a,context:o}=n;return e(a,o)}):(typeof Promise<"u"&&(this.ge=new Promise(n=>{s=n})),this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/surveys/?token="+this._instance.config.token),method:"GET",timeout:this._instance.config.surveys_request_timeout_ms,callback:n=>{var a;this.ge=null;var o=n.statusCode;if(o!==200||!n.json){var l="Surveys API could not be loaded, status: "+o;_t.error(l);var d={isLoaded:!1,error:l};return e([],d),void(s==null||s({surveys:[],context:d}))}var u,h=n.json.surveys||[],p=h.filter(f=>function(g){return!(!g.start_date||g.end_date)}(f)&&(function(g){var y;return!((y=g.conditions)==null||(y=y.events)==null||(y=y.values)==null||!y.length)}(f)||function(g){var y;return!((y=g.conditions)==null||(y=y.actions)==null||(y=y.values)==null||!y.length)}(f)));p.length>0&&((u=this._surveyEventReceiver)==null||u.register(p)),(a=this._instance.persistence)==null||a.register({[Bg]:h});var m={isLoaded:!0};e(h,m),s?.({surveys:h,context:m})}}))}ye(e){for(var t of this.pe)try{if(!e.isLoaded)return t([],e);this.getSurveys(t)}catch(s){_t.error("Error in survey callback",s)}}getActiveMatchingSurveys(e,t){if(t===void 0&&(t=!1),!xt(this._surveyManager))return this._surveyManager.getActiveMatchingSurveys(e,t);_t.warn("init was not called")}be(e){var t=null;return this.getSurveys(s=>{var i;t=(i=s.find(n=>n.id===e))!==null&&i!==void 0?i:null}),t}we(e){if(xt(this._surveyManager))return{eligible:!1,reason:"SDK is not enabled or survey functionality is not yet loaded"};var t=typeof e=="string"?this.be(e):e;return t?this._surveyManager.checkSurveyEligibility(t):{eligible:!1,reason:"Survey not found"}}canRenderSurvey(e){if(xt(this._surveyManager))return _t.warn("init was not called"),{visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"};var t=this.we(e);return{visible:t.eligible,disabledReason:t.reason}}canRenderSurveyAsync(e,t){return xt(this._surveyManager)?(_t.warn("init was not called"),Promise.resolve({visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"})):new Promise(s=>{this.getSurveys(i=>{var n,a=(n=i.find(l=>l.id===e))!==null&&n!==void 0?n:null;if(a){var o=this.we(a);s({visible:o.eligible,disabledReason:o.reason})}else s({visible:!1,disabledReason:"Survey not found"})},t)})}renderSurvey(e,t,s){var i;if(xt(this._surveyManager))_t.warn("init was not called");else{var n=typeof e=="string"?this.be(e):e;if(n!=null&&n.id)if(xD.includes(n.type)){var a=Ae?.querySelector(t);if(a)return(i=n.appearance)!=null&&i.surveyPopupDelaySeconds?(_t.info("Rendering survey "+n.id+" with delay of "+n.appearance.surveyPopupDelaySeconds+" seconds"),void setTimeout(()=>{var o,l;_t.info("Rendering survey "+n.id+" with delay of "+((o=n.appearance)==null?void 0:o.surveyPopupDelaySeconds)+" seconds"),(l=this._surveyManager)==null||l.renderSurvey(n,a,s),_t.info("Survey "+n.id+" rendered")},1e3*n.appearance.surveyPopupDelaySeconds)):void this._surveyManager.renderSurvey(n,a,s);_t.warn("Survey element not found")}else _t.warn("Surveys of type "+n.type+" cannot be rendered in the app");else _t.warn("Survey not found")}}displaySurvey(e,t){var s;if(xt(this._surveyManager))_t.warn("init was not called");else{var i=this.be(e);if(i){var n=i;if((s=i.appearance)!=null&&s.surveyPopupDelaySeconds&&t.ignoreDelay&&(n=Ne({},i,{appearance:Ne({},i.appearance,{surveyPopupDelaySeconds:0})})),t.displayType!==Yg.Popover&&t.initialResponses&&_t.warn("initialResponses is only supported for popover surveys. prefill will not be applied."),t.ignoreConditions===!1){var a=this.canRenderSurvey(i);if(!a.visible)return void _t.warn("Survey is not eligible to be displayed: ",a.disabledReason)}t.displayType!==Yg.Inline?this._surveyManager.handlePopoverSurvey(n,t):this.renderSurvey(n,t.selector,t.properties)}else _t.warn("Survey not found")}}cancelPendingSurvey(e){xt(this._surveyManager)?_t.warn("init was not called"):this._surveyManager.cancelSurvey(e)}handlePageUnload(){var e;(e=this._surveyManager)==null||e.handlePageUnload()}}var an=as("[Conversations]");class SD{constructor(e){this.xe=void 0,this._conversationsManager=null,this.Ee=!1,this.$e=null,this._instance=e}onRemoteConfig(e){if(!this._instance.config.disable_conversations){var t=e.conversations;xt(t)||(bn(t)?this.xe=t:(this.xe=t.enabled,this.$e=t),this.loadIfEnabled())}}reset(){var e;(e=this._conversationsManager)==null||e.reset(),this._conversationsManager=null,this.xe=void 0,this.$e=null}loadIfEnabled(){if(!this._conversationsManager&&!this.Ee&&!(this._instance.config.disable_conversations||this._instance.config.cookieless_mode&&this._instance.consent.isOptedOut())){var e=Ye?.__PosthogExtensions__;if(e&&!Te(this.xe)&&this.xe)if(this.$e&&this.$e.token){this.Ee=!0;try{var t=e.initConversations;if(t)return this.Se(t),void(this.Ee=!1);var s=e.loadExternalDependency;if(!s)return void this.ke("PostHog loadExternalDependency extension not found.");s(this._instance,"conversations",i=>{i||!e.initConversations?this.ke("Could not load conversations script",i):this.Se(e.initConversations),this.Ee=!1})}catch(i){this.ke("Error initializing conversations",i),this.Ee=!1}}else an.error("Conversations enabled but missing token in remote config.")}}Se(e){if(this.$e)try{this._conversationsManager=e(this.$e,this._instance),an.info("Conversations loaded successfully")}catch(t){this.ke("Error completing conversations initialization",t)}else an.error("Cannot complete initialization: remote config is null")}ke(e,t){an.error(e,t),this._conversationsManager=null,this.Ee=!1}show(){this._conversationsManager?this._conversationsManager.show():an.warn("Conversations not loaded yet.")}hide(){this._conversationsManager&&this._conversationsManager.hide()}isAvailable(){return this.xe===!0&&!jr(this._conversationsManager)}isVisible(){var e,t;return(e=(t=this._conversationsManager)==null?void 0:t.isVisible())!==null&&e!==void 0&&e}sendMessage(e,t,s){var i=this;return rc(function*(){return i._conversationsManager?i._conversationsManager.sendMessage(e,t,s):(an.warn("Conversations not available yet."),null)})()}getMessages(e,t){var s=this;return rc(function*(){return s._conversationsManager?s._conversationsManager.getMessages(e,t):(an.warn("Conversations not available yet."),null)})()}markAsRead(e){var t=this;return rc(function*(){return t._conversationsManager?t._conversationsManager.markAsRead(e):(an.warn("Conversations not available yet."),null)})()}getTickets(e){var t=this;return rc(function*(){return t._conversationsManager?t._conversationsManager.getTickets(e):(an.warn("Conversations not available yet."),null)})()}getCurrentTicketId(){var e,t;return(e=(t=this._conversationsManager)==null?void 0:t.getCurrentTicketId())!==null&&e!==void 0?e:null}getWidgetSessionId(){var e,t;return(e=(t=this._conversationsManager)==null?void 0:t.getWidgetSessionId())!==null&&e!==void 0?e:null}}class TD{constructor(e){var t;this.Pe=!1,this.Te=!1,this._instance=e,this._instance&&(t=this._instance.config.logs)!=null&&t.captureConsoleLogs&&(this.Pe=!0)}onRemoteConfig(e){var t,s=(t=e.logs)==null?void 0:t.captureConsoleLogs;!xt(s)&&s&&(this.Pe=!0,this.loadIfEnabled())}reset(){}loadIfEnabled(){if(this.Pe&&!this.Te){var e=as("[logs]"),t=Ye?.__PosthogExtensions__;if(t){var s=t.loadExternalDependency;s?s(this._instance,"logs",i=>{var n;i||(n=t.logs)==null||!n.initializeLogs?e.error("Could not load logs script",i):(t.logs.initializeLogs(this._instance),this.Te=!0)}):e.error("PostHog loadExternalDependency extension not found.")}else e.error("PostHog Extensions not found.")}}}var o1=as("[RateLimiter]");class AD{constructor(e){this.serverLimits={},this.lastEventRateLimited=!1,this.checkForLimiting=t=>{var s=t.text;if(s&&s.length)try{(JSON.parse(s).quota_limited||[]).forEach(i=>{o1.info((i||"events")+" is quota limited."),this.serverLimits[i]=new Date().getTime()+6e4})}catch(i){return void o1.warn('could not rate limit - continuing. Error: "'+i?.message+'"',{text:s})}},this.instance=e,this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}get captureEventsPerSecond(){var e;return((e=this.instance.config.rate_limiting)==null?void 0:e.events_per_second)||10}get captureEventsBurstLimit(){var e;return Math.max(((e=this.instance.config.rate_limiting)==null?void 0:e.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond)}clientRateLimitContext(e){var t,s,i;e===void 0&&(e=!1);var{captureEventsBurstLimit:n,captureEventsPerSecond:a}=this,o=new Date().getTime(),l=(t=(s=this.instance.persistence)==null?void 0:s.get_property(Og))!==null&&t!==void 0?t:{tokens:n,last:o};l.tokens+=(o-l.last)/1e3*a,l.last=o,l.tokens>n&&(l.tokens=n);var d=l.tokens<1;return d||e||(l.tokens=Math.max(0,l.tokens-1)),!d||this.lastEventRateLimited||e||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to "+a+" events per second and "+n+" events burst limit."},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=d,(i=this.instance.persistence)==null||i.set_property(Og,l),{isRateLimited:d,remainingTokens:l.tokens}}isServerRateLimited(e){var t=this.serverLimits[e||"events"]||!1;return t!==!1&&new Date().getTime()<t}}var Oa=as("[RemoteConfig]");class jD{constructor(e){this._instance=e}get remoteConfig(){var e;return(e=Ye._POSTHOG_REMOTE_CONFIG)==null||(e=e[this._instance.config.token])==null?void 0:e.config}Ie(e){var t,s;(t=Ye.__PosthogExtensions__)!=null&&t.loadExternalDependency?(s=Ye.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"remote-config",()=>e(this.remoteConfig)):(Oa.error("PostHog Extensions not found. Cannot load remote config."),e())}Ce(e){this._instance._send_request({method:"GET",url:this._instance.requestRouter.endpointFor("assets","/array/"+this._instance.config.token+"/config"),callback:t=>{e(t.json)}})}load(){try{if(this.remoteConfig)return Oa.info("Using preloaded remote config",this.remoteConfig),void this.bi(this.remoteConfig);if(this._instance.O())return void Oa.warn("Remote config is disabled. Falling back to local config.");this.Ie(e=>{if(!e)return Oa.info("No config found after loading remote JS config. Falling back to JSON."),void this.Ce(t=>{this.bi(t)});this.bi(e)})}catch(e){Oa.error("Error loading remote config",e)}}bi(e){e?this._instance.config.__preview_remote_config?(this._instance.bi(e),e.hasFeatureFlags!==!1&&this._instance.featureFlags.ensureFlagsLoaded()):Oa.info("__preview_remote_config is disabled. Logging config instead",e):Oa.error("Failed to fetch remote config from PostHog.")}}var qg=3e3;class _D{constructor(e,t){this.Re=!0,this.Fe=[],this.Me=Or(t?.flush_interval_ms||qg,250,5e3,_e.createLogger("flush interval"),qg),this.Oe=e}enqueue(e){this.Fe.push(e),this.Ae||this.De()}unload(){this.je();var e=this.Fe.length>0?this.Le():{},t=Object.values(e);[...t.filter(s=>s.url.indexOf("/e")===0),...t.filter(s=>s.url.indexOf("/e")!==0)].map(s=>{this.Oe(Ne({},s,{transport:"sendBeacon"}))})}enable(){this.Re=!1,this.De()}De(){var e=this;this.Re||(this.Ae=setTimeout(()=>{if(this.je(),this.Fe.length>0){var t=this.Le(),s=function(){var n=t[i],a=new Date().getTime();n.data&&bt(n.data)&&Dt(n.data,o=>{o.offset=Math.abs(o.timestamp-a),delete o.timestamp}),e.Oe(n)};for(var i in t)s()}},this.Me))}je(){clearTimeout(this.Ae),this.Ae=void 0}Le(){var e={};return Dt(this.Fe,t=>{var s,i=t,n=(i?i.batchKey:null)||i.url;Te(e[n])&&(e[n]=Ne({},i,{data:[]})),(s=e[n].data)==null||s.push(i.data)}),this.Fe=[],e}}var ED=["retriesPerformedSoFar"];class MD{constructor(e){this.Ne=!1,this.Ue=3e3,this.Fe=[],this._instance=e,this.Fe=[],this.ze=!0,!Te(H)&&"onLine"in H.navigator&&(this.ze=H.navigator.onLine,this.He=()=>{this.ze=!0,this.Lt()},this.Be=()=>{this.ze=!1},xs(H,"online",this.He),xs(H,"offline",this.Be))}get length(){return this.Fe.length}retriableRequest(e){var{retriesPerformedSoFar:t}=e,s=eT(e,ED);tc(t)&&(s.url=np(s.url,{retry_count:t})),this._instance._send_request(Ne({},s,{callback:i=>{i.statusCode!==200&&(i.statusCode<400||i.statusCode>=500)&&(t??0)<10?this.qe(Ne({retriesPerformedSoFar:t},s)):s.callback==null||s.callback(i)}}))}qe(e){var t=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=t+1;var s=function(a){var o=3e3*Math.pow(2,a),l=o/2,d=Math.min(18e5,o),u=(Math.random()-.5)*(d-l);return Math.ceil(d+u)}(t),i=Date.now()+s;this.Fe.push({retryAt:i,requestOptions:e});var n="Enqueued failed request for retry in "+s;navigator.onLine||(n+=" (Browser is offline)"),_e.warn(n),this.Ne||(this.Ne=!0,this.We())}We(){if(this.Ge&&clearTimeout(this.Ge),this.Fe.length===0)return this.Ne=!1,void(this.Ge=void 0);this.Ge=setTimeout(()=>{this.ze&&this.Fe.length>0&&this.Lt(),this.We()},this.Ue)}Lt(){var e=Date.now(),t=[],s=this.Fe.filter(n=>n.retryAt<e||(t.push(n),!1));if(this.Fe=t,s.length>0)for(var{requestOptions:i}of s)this.retriableRequest(i)}unload(){for(var{requestOptions:e}of(this.Ge&&(clearTimeout(this.Ge),this.Ge=void 0),this.Ne=!1,Te(H)||(this.He&&(H.removeEventListener("online",this.He),this.He=void 0),this.Be&&(H.removeEventListener("offline",this.Be),this.Be=void 0)),this.Fe))try{this._instance._send_request(Ne({},e,{transport:"sendBeacon"}))}catch(t){_e.error(t)}this.Fe=[]}}class PD{constructor(e){this.Ve=()=>{var t,s,i,n;this.Je||(this.Je={});var a=this.scrollElement(),o=this.scrollY(),l=a?Math.max(0,a.scrollHeight-a.clientHeight):0,d=o+(a?.clientHeight||0),u=a?.scrollHeight||0;this.Je.lastScrollY=Math.ceil(o),this.Je.maxScrollY=Math.max(o,(t=this.Je.maxScrollY)!==null&&t!==void 0?t:0),this.Je.maxScrollHeight=Math.max(l,(s=this.Je.maxScrollHeight)!==null&&s!==void 0?s:0),this.Je.lastContentY=d,this.Je.maxContentY=Math.max(d,(i=this.Je.maxContentY)!==null&&i!==void 0?i:0),this.Je.maxContentHeight=Math.max(u,(n=this.Je.maxContentHeight)!==null&&n!==void 0?n:0)},this._instance=e}getContext(){return this.Je}resetContext(){var e=this.Je;return setTimeout(this.Ve,0),e}startMeasuringScrollPosition(){xs(H,"scroll",this.Ve,{capture:!0}),xs(H,"scrollend",this.Ve,{capture:!0}),xs(H,"resize",this.Ve)}scrollElement(){if(!this._instance.config.scroll_root_selector)return H?.document.documentElement;var e=bt(this._instance.config.scroll_root_selector)?this._instance.config.scroll_root_selector:[this._instance.config.scroll_root_selector];for(var t of e){var s=H?.document.querySelector(t);if(s)return s}}scrollY(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return H&&(H.scrollY||H.pageYOffset||H.document.documentElement.scrollTop)||0}scrollX(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return H&&(H.scrollX||H.pageXOffset||H.document.documentElement.scrollLeft)||0}}var ND=r=>XT(r?.config.mask_personal_data_properties,r?.config.custom_personal_data_properties);class c1{constructor(e,t,s,i){this.Ke=n=>{var a=this.Ye();if(!a||a.sessionId!==n){var o={sessionId:n,props:this.Xe(this._instance)};this.Qe.register({[Lg]:o})}},this._instance=e,this.Ze=t,this.Qe=s,this.Xe=i||ND,this.Ze.onSessionId(this.Ke)}Ye(){return this.Qe.props[Lg]}getSetOnceProps(){var e,t=(e=this.Ye())==null?void 0:e.props;return t?"r"in t?KT(t):{$referring_domain:t.referringDomain,$pathname:t.initialPathName,utm_source:t.utm_source,utm_campaign:t.utm_campaign,utm_medium:t.utm_medium,utm_content:t.utm_content,utm_term:t.utm_term}:{}}getSessionProps(){var e={};return Dt(Gy(this.getSetOnceProps()),(t,s)=>{s==="$current_url"&&(s="url"),e["$session_entry_"+jg(s)]=t}),e}}var Rm=as("[SessionId]");class l1{on(e,t){return this.tr.on(e,t)}constructor(e,t,s){var i;if(this.ir=[],this.er=void 0,this.tr=new Ky,this.rr=(u,h)=>!(!tc(u)||!tc(h))&&Math.abs(u-h)>this.sessionTimeoutMs,!e.persistence)throw new Error("SessionIdManager requires a PostHogPersistence instance");if(e.config.cookieless_mode==="always")throw new Error('SessionIdManager cannot be used with cookieless_mode="always"');this.R=e.config,this.Qe=e.persistence,this.sr=void 0,this.nr=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this.ar=t||ta,this.lr=s||ta;var n=this.R.persistence_name||this.R.token,a=this.R.session_idle_timeout_seconds||1800;if(this._sessionTimeoutMs=1e3*Or(a,60,36e3,Rm.createLogger("session_idle_timeout_seconds"),1800),e.register({$configured_session_timeout_ms:this._sessionTimeoutMs}),this.ur(),this.hr="ph_"+n+"_window_id",this.dr="ph_"+n+"_primary_window_exists",this.vr()){var o=Ls.W(this.hr),l=Ls.W(this.dr);o&&!l?this.sr=o:Ls.V(this.hr),Ls.G(this.dr,!0)}if((i=this.R.bootstrap)!=null&&i.sessionID)try{var d=(u=>{var h=u.replace(/-/g,"");if(h.length!==32)throw new Error("Not a valid UUID");if(h[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(h.substring(0,12),16)})(this.R.bootstrap.sessionID);this.cr(this.R.bootstrap.sessionID,new Date().getTime(),d)}catch(u){Rm.error("Invalid sessionID in bootstrap",u)}this.pr()}get sessionTimeoutMs(){return this._sessionTimeoutMs}onSessionId(e){return Te(this.ir)&&(this.ir=[]),this.ir.push(e),this.nr&&e(this.nr,this.sr),()=>{this.ir=this.ir.filter(t=>t!==e)}}vr(){return this.R.persistence!=="memory"&&!this.Qe.ki&&Ls.H()}gr(e){e!==this.sr&&(this.sr=e,this.vr()&&Ls.G(this.hr,e))}_r(){return this.sr?this.sr:this.vr()?Ls.W(this.hr):null}cr(e,t,s){e===this.nr&&t===this._sessionActivityTimestamp&&s===this._sessionStartTimestamp||(this._sessionStartTimestamp=s,this._sessionActivityTimestamp=t,this.nr=e,this.Qe.register({[Xh]:[t,e,s]}))}mr(){var e=this.Qe.props[Xh];return bt(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}resetSessionId(){this.cr(null,null,null)}destroy(){clearTimeout(this.yr),this.yr=void 0,this.er&&H&&(H.removeEventListener("beforeunload",this.er,{capture:!1}),this.er=void 0),this.ir=[]}pr(){this.er=()=>{this.vr()&&Ls.V(this.dr)},xs(H,"beforeunload",this.er,{capture:!1})}checkAndGetSessionAndWindowId(e,t){if(e===void 0&&(e=!1),t===void 0&&(t=null),this.R.cookieless_mode==="always")throw new Error('checkAndGetSessionAndWindowId should not be called with cookieless_mode="always"');var s=t||new Date().getTime(),[i,n,a]=this.mr(),o=this._r(),l=tc(a)&&Math.abs(s-a)>864e5,d=!1,u=!n,h=!u&&!e&&this.rr(s,i);u||h||l?(n=this.ar(),o=this.lr(),Rm.info("new session ID generated",{sessionId:n,windowId:o,changeReason:{noSessionId:u,activityTimeout:h,sessionPastMaximumLength:l}}),a=s,d=!0):o||(o=this.lr(),d=!0);var p=tc(i)&&e&&!l?i:s,m=tc(a)?a:new Date().getTime();return this.gr(o),this.cr(n,p,m),e||this.ur(),d&&this.ir.forEach(f=>f(n,o,d?{noSessionId:u,activityTimeout:h,sessionPastMaximumLength:l}:void 0)),{sessionId:n,windowId:o,sessionStartTimestamp:m,changeReason:d?{noSessionId:u,activityTimeout:h,sessionPastMaximumLength:l}:void 0,lastActivityTimestamp:i}}ur(){clearTimeout(this.yr),this.yr=setTimeout(()=>{var[e]=this.mr();if(this.rr(new Date().getTime(),e)){var t=this.nr;this.resetSessionId(),this.tr.emit("forcedIdleReset",{idleSessionId:t})}},1.1*this.sessionTimeoutMs)}}var RD=["$set_once","$set"],$n=as("[SiteApps]");class ID{constructor(e){this._instance=e,this.br=[],this.apps={}}get isEnabled(){return!!this._instance.config.opt_in_site_apps}wr(e,t){if(t){var s=this.globalsForEvent(t);this.br.push(s),this.br.length>1e3&&(this.br=this.br.slice(10))}}get siteAppLoaders(){var e;return(e=Ye._POSTHOG_REMOTE_CONFIG)==null||(e=e[this._instance.config.token])==null?void 0:e.siteApps}init(){if(this.isEnabled){var e=this._instance.Bi(this.wr.bind(this));this.Er=()=>{e(),this.br=[],this.Er=void 0}}}globalsForEvent(e){var t,s,i,n,a,o,l;if(!e)throw new Error("Event payload is required");var d={},u=this._instance.get_property("$groups")||[],h=this._instance.get_property("$stored_group_properties")||{};for(var[p,m]of Object.entries(h))d[p]={id:u[p],type:p,properties:m};var{$set_once:f,$set:g}=e;return{event:Ne({},eT(e,RD),{properties:Ne({},e.properties,g?{$set:Ne({},(t=(s=e.properties)==null?void 0:s.$set)!==null&&t!==void 0?t:{},g)}:{},f?{$set_once:Ne({},(i=(n=e.properties)==null?void 0:n.$set_once)!==null&&i!==void 0?i:{},f)}:{}),elements_chain:(a=(o=e.properties)==null?void 0:o.$elements_chain)!==null&&a!==void 0?a:"",distinct_id:(l=e.properties)==null?void 0:l.distinct_id}),person:{properties:this._instance.get_property("$stored_person_properties")},groups:d}}setupSiteApp(e){var t=this.apps[e.id],s=()=>{var o;!t.errored&&this.br.length&&($n.info("Processing "+this.br.length+" events for site app with id "+e.id),this.br.forEach(l=>t.processEvent==null?void 0:t.processEvent(l)),t.processedBuffer=!0),Object.values(this.apps).every(l=>l.processedBuffer||l.errored)&&((o=this.Er)==null||o.call(this))},i=!1,n=o=>{t.errored=!o,t.loaded=!0,$n.info("Site app with id "+e.id+" "+(o?"loaded":"errored")),i&&s()};try{var{processEvent:a}=e.init({posthog:this._instance,callback:o=>{n(o)}});a&&(t.processEvent=a),i=!0}catch(o){$n.error("Error while initializing PostHog app with config id "+e.id,o),n(!1)}if(i&&t.loaded)try{s()}catch(o){$n.error("Error while processing buffered events PostHog app with config id "+e.id,o),t.errored=!0}}$r(){var e=this.siteAppLoaders||[];for(var t of e)this.apps[t.id]={id:t.id,loaded:!1,errored:!1,processedBuffer:!1};for(var s of e)this.setupSiteApp(s)}Sr(e){if(Object.keys(this.apps).length!==0){var t=this.globalsForEvent(e);for(var s of Object.values(this.apps))try{s.processEvent==null||s.processEvent(t)}catch(i){$n.error("Error while processing event "+e.event+" for site app "+s.id,i)}}}onRemoteConfig(e){var t,s,i,n=this;if((t=this.siteAppLoaders)!=null&&t.length)return this.isEnabled?(this.$r(),void this._instance.on("eventCaptured",d=>this.Sr(d))):void $n.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.');if((s=this.Er)==null||s.call(this),(i=e.siteApps)!=null&&i.length)if(this.isEnabled){var a=function(d){var u;Ye["__$$ph_site_app_"+d]=n._instance,(u=Ye.__PosthogExtensions__)==null||u.loadSiteApp==null||u.loadSiteApp(n._instance,l,h=>{if(h)return $n.error("Error while initializing PostHog app with config id "+d,h)})};for(var{id:o,url:l}of e.siteApps)a(o)}else $n.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}var aA=function(r,e){if(!r)return!1;var t=r.userAgent;if(t&&bv(t,e))return!0;try{var s=r?.userAgentData;if(s!=null&&s.brands&&s.brands.some(i=>bv(i?.brand,e)))return!0}catch{}return!!r.webdriver},Ql=function(r){return r.US="us",r.EU="eu",r.CUSTOM="custom",r}({}),d1="i.posthog.com";class DD{constructor(e){this.kr={},this.instance=e}get apiHost(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}get flagsApiHost(){var e=this.instance.config.flags_api_host;return e?e.trim().replace(/\/$/,""):this.apiHost}get uiHost(){var e,t=(e=this.instance.config.ui_host)==null?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace("."+d1,".posthog.com")),t==="https://app.posthog.com"?"https://us.posthog.com":t}get region(){return this.kr[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.kr[this.apiHost]=Ql.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.kr[this.apiHost]=Ql.EU:this.kr[this.apiHost]=Ql.CUSTOM),this.kr[this.apiHost]}endpointFor(e,t){if(t===void 0&&(t=""),t&&(t=t[0]==="/"?t:"/"+t),e==="ui")return this.uiHost+t;if(e==="flags")return this.flagsApiHost+t;if(this.region===Ql.CUSTOM)return this.apiHost+t;var s=d1+t;switch(e){case"assets":return"https://"+this.region+"-assets."+s;case"api":return"https://"+this.region+"."+s}}}var FD={icontains:(r,e)=>!!H&&e.href.toLowerCase().indexOf(r.toLowerCase())>-1,not_icontains:(r,e)=>!!H&&e.href.toLowerCase().indexOf(r.toLowerCase())===-1,regex:(r,e)=>!!H&&ap(e.href,r),not_regex:(r,e)=>!!H&&!ap(e.href,r),exact:(r,e)=>e.href===r,is_not:(r,e)=>e.href!==r};class Xs{constructor(e){var t=this;this.getWebExperimentsAndEvaluateDisplayLogic=function(s){s===void 0&&(s=!1),t.getWebExperiments(i=>{Xs.Pr("retrieved web experiments from the server"),t.Tr=new Map,i.forEach(n=>{if(n.feature_flag_key){var a;t.Tr&&(Xs.Pr("setting flag key ",n.feature_flag_key," to web experiment ",n),(a=t.Tr)==null||a.set(n.feature_flag_key,n));var o=t._instance.getFeatureFlag(n.feature_flag_key);As(o)&&n.variants[o]&&t.Ir(n.name,o,n.variants[o].transforms)}else if(n.variants)for(var l in n.variants){var d=n.variants[l];Xs.Cr(d)&&t.Ir(n.name,l,d.transforms)}})},s)},this._instance=e,this._instance.onFeatureFlags(s=>{this.onFeatureFlags(s)})}onFeatureFlags(e){if(this._is_bot())Xs.Pr("Refusing to render web experiment since the viewer is a likely bot");else if(!this._instance.config.disable_web_experiments){if(xt(this.Tr))return this.Tr=new Map,this.loadIfEnabled(),void this.previewWebExperiment();Xs.Pr("applying feature flags",e),e.forEach(t=>{var s;if(this.Tr&&(s=this.Tr)!=null&&s.has(t)){var i,n=this._instance.getFeatureFlag(t),a=(i=this.Tr)==null?void 0:i.get(t);n&&a!=null&&a.variants[n]&&this.Ir(a.name,n,a.variants[n].transforms)}})}}previewWebExperiment(){var e=Xs.getWindowLocation();if(e!=null&&e.search){var t=tp(e?.search,"__experiment_id"),s=tp(e?.search,"__experiment_variant");t&&s&&(Xs.Pr("previewing web experiments "+t+" && "+s),this.getWebExperiments(i=>{this.Rr(parseInt(t),s,i)},!1,!0))}}loadIfEnabled(){this._instance.config.disable_web_experiments||this.getWebExperimentsAndEvaluateDisplayLogic()}getWebExperiments(e,t,s){if(this._instance.config.disable_web_experiments&&!s)return e([]);var i=this._instance.get_property("$web_experiments");if(i&&!t)return e(i);this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/web_experiments/?token="+this._instance.config.token),method:"GET",callback:n=>{if(n.statusCode!==200||!n.json)return e([]);var a=n.json.experiments||[];return e(a)}})}Rr(e,t,s){var i=s.filter(n=>n.id===e);i&&i.length>0&&(Xs.Pr("Previewing web experiment ["+i[0].name+"] with variant ["+t+"]"),this.Ir(i[0].name,t,i[0].variants[t].transforms))}static Cr(e){return!xt(e.conditions)&&Xs.Fr(e)&&Xs.Mr(e)}static Fr(e){var t;if(xt(e.conditions)||xt((t=e.conditions)==null?void 0:t.url))return!0;var s,i,n,a=Xs.getWindowLocation();return!!a&&((s=e.conditions)==null||!s.url||FD[(i=(n=e.conditions)==null?void 0:n.urlMatchType)!==null&&i!==void 0?i:"icontains"](e.conditions.url,a))}static getWindowLocation(){return H?.location}static Mr(e){var t;if(xt(e.conditions)||xt((t=e.conditions)==null?void 0:t.utm))return!0;var s=WT();if(s.utm_source){var i,n,a,o,l,d,u,h,p=(i=e.conditions)==null||(i=i.utm)==null||!i.utm_campaign||((n=e.conditions)==null||(n=n.utm)==null?void 0:n.utm_campaign)==s.utm_campaign,m=(a=e.conditions)==null||(a=a.utm)==null||!a.utm_source||((o=e.conditions)==null||(o=o.utm)==null?void 0:o.utm_source)==s.utm_source,f=(l=e.conditions)==null||(l=l.utm)==null||!l.utm_medium||((d=e.conditions)==null||(d=d.utm)==null?void 0:d.utm_medium)==s.utm_medium,g=(u=e.conditions)==null||(u=u.utm)==null||!u.utm_term||((h=e.conditions)==null||(h=h.utm)==null?void 0:h.utm_term)==s.utm_term;return p&&f&&g&&m}return!1}static Pr(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];_e.info("[WebExperiments] "+e,s)}Ir(e,t,s){this._is_bot()?Xs.Pr("Refusing to render web experiment since the viewer is a likely bot"):t!=="control"?s.forEach(i=>{if(i.selector){var n;Xs.Pr("applying transform of variant "+t+" for experiment "+e+" ",i);var a=(n=document)==null?void 0:n.querySelectorAll(i.selector);a?.forEach(o=>{var l=o;i.html&&(l.innerHTML=i.html),i.css&&l.setAttribute("style",i.css)})}}):Xs.Pr("Control variants leave the page unmodified.")}_is_bot(){return $i&&this._instance?aA($i,this._instance.config.custom_blocked_useragents):void 0}}var BD=as("[PostHog ExternalIntegrations]"),LD={intercom:"intercom-integration",crispChat:"crisp-chat-integration"};class OD{constructor(e){this._instance=e}it(e,t){var s;(s=Ye.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,e,i=>{if(i)return BD.error("failed to load script",i);t()})}startIfEnabledOrStop(){var e=this,t=function(a){var o,l,d;!i||(o=Ye.__PosthogExtensions__)!=null&&(o=o.integrations)!=null&&o[a]||e.it(LD[a],()=>{var u;(u=Ye.__PosthogExtensions__)==null||(u=u.integrations)==null||(u=u[a])==null||u.start(e._instance)}),!i&&(l=Ye.__PosthogExtensions__)!=null&&(l=l.integrations)!=null&&l[a]&&((d=Ye.__PosthogExtensions__)==null||(d=d.integrations)==null||(d=d[a])==null||d.stop())};for(var[s,i]of Object.entries((n=this._instance.config.integrations)!==null&&n!==void 0?n:{})){var n;t(s)}}}var Hg="[SessionRecording]",Ml=as(Hg);class u1{get started(){var e;return!((e=this.Or)==null||!e.isStarted)}get status(){return this.Or?this.Or.status:this.Ar&&!this.Dr?"disabled":"lazy_loading"}constructor(e){if(this._forceAllowLocalhostNetworkCapture=!1,this.Ar=!1,this.jr=void 0,this._instance=e,!this._instance.sessionManager)throw Ml.error("started without valid sessionManager"),new Error(Hg+" started without valid sessionManager. This is a bug.");if(this._instance.config.cookieless_mode==="always")throw new Error(Hg+' cannot be used with cookieless_mode="always"')}get Dr(){var e,t=!((e=this._instance.get_property(bm))==null||!e.enabled),s=!this._instance.config.disable_session_recording,i=this._instance.config.disable_session_recording||this._instance.consent.isOptedOut();return H&&t&&s&&!i}startIfEnabledOrStop(e){var t;if(!this.Dr||(t=this.Or)==null||!t.isStarted){var s=!Te(Object.assign)&&!Te(Array.from);this.Dr&&s?(this.Lr(e),Ml.info("starting")):this.stopRecording()}}Lr(e){var t,s,i;this.Dr&&(Ye!=null&&(t=Ye.__PosthogExtensions__)!=null&&(t=t.rrweb)!=null&&t.record&&(s=Ye.__PosthogExtensions__)!=null&&s.initSessionRecording?this.Nr(e):(i=Ye.__PosthogExtensions__)==null||i.loadExternalDependency==null||i.loadExternalDependency(this._instance,this.Ur,n=>{if(n)return Ml.error("could not load recorder",n);this.Nr(e)}))}stopRecording(){var e,t;(e=this.jr)==null||e.call(this),this.jr=void 0,(t=this.Or)==null||t.stop()}zr(){var e;(e=this._instance.persistence)==null||e.unregister(AT)}Hr(e){if(this._instance.persistence){var t,s,i=this._instance.persistence,n=()=>{var a=e.sessionRecording===!1?void 0:e.sessionRecording,o=a?.sampleRate,l=xt(o)?null:parseFloat(o);xt(l)&&this.zr();var d=a?.minimumDurationMilliseconds;i.register({[bm]:Ne({enabled:!!a},a,{networkPayloadCapture:Ne({capturePerformance:e.capturePerformance},a?.networkPayloadCapture),canvasRecording:{enabled:a?.recordCanvas,fps:a?.canvasFps,quality:a?.canvasQuality},sampleRate:l,minimumDurationMilliseconds:Te(d)?null:d,endpoint:a?.endpoint,triggerMatchType:a?.triggerMatchType,masking:a?.masking,urlTriggers:a?.urlTriggers})})};n(),(t=this.jr)==null||t.call(this),this.jr=(s=this._instance.sessionManager)==null?void 0:s.onSessionId(n)}}onRemoteConfig(e){"sessionRecording"in e?e.sessionRecording!==!1?(this.Hr(e),this.Ar=!0,this.startIfEnabledOrStop()):this.Ar=!0:Ml.info("skipping remote config with no sessionRecording",e)}log(e,t){var s;t===void 0&&(t="log"),(s=this.Or)!=null&&s.log?this.Or.log(e,t):Ml.warn("log called before recorder was ready")}get Ur(){var e,t,s=(e=this._instance)==null||(e=e.persistence)==null?void 0:e.get_property(bm);return(s==null||(t=s.scriptConfig)==null?void 0:t.script)||"lazy-recorder"}Nr(e){var t,s;if((t=Ye.__PosthogExtensions__)==null||!t.initSessionRecording)throw Error("Called on script loaded before session recording is available");this.Or||(this.Or=(s=Ye.__PosthogExtensions__)==null?void 0:s.initSessionRecording(this._instance),this.Or._forceAllowLocalhostNetworkCapture=this._forceAllowLocalhostNetworkCapture),this.Or.start(e)}onRRwebEmit(e){var t;(t=this.Or)==null||t.onRRwebEmit==null||t.onRRwebEmit(e)}overrideLinkedFlag(){var e,t;this.Or||(t=this._instance.persistence)==null||t.register({$replay_override_linked_flag:!0}),(e=this.Or)==null||e.overrideLinkedFlag()}overrideSampling(){var e,t;this.Or||(t=this._instance.persistence)==null||t.register({$replay_override_sampling:!0}),(e=this.Or)==null||e.overrideSampling()}overrideTrigger(e){var t,s;this.Or||(s=this._instance.persistence)==null||s.register({[e==="url"?"$replay_override_url_trigger":"$replay_override_event_trigger"]:!0}),(t=this.Or)==null||t.overrideTrigger(e)}get sdkDebugProperties(){var e;return((e=this.Or)==null?void 0:e.sdkDebugProperties)||{$recording_status:this.status}}tryAddCustomEvent(e,t){var s;return!((s=this.Or)==null||!s.tryAddCustomEvent(e,t))}}var pd={},Xg=()=>{},sc="posthog",oA=!dD&&vi?.indexOf("MSIE")===-1&&vi?.indexOf("Mozilla")===-1,h1=r=>{var e;return Ne({api_host:"https://us.i.posthog.com",flags_api_host:null,ui_host:null,token:"",autocapture:!0,cross_subdomain_cookie:fI(Ae?.location),persistence:"localStorage+cookie",persistence_name:"",cookie_persisted_properties:[],loaded:Xg,save_campaign_params:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageleave:"if_capture_pageview",defaults:r??"unset",__preview_deferred_init_extensions:!1,debug:ki&&As(ki?.search)&&ki.search.indexOf("__posthog_debug=true")!==-1||!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_web_experiments:!0,disable_surveys:!1,disable_surveys_automatic_display:!1,disable_conversations:!1,disable_product_tours:!0,disable_external_dependency_loading:!1,enable_recording_console_log:void 0,secure_cookie:(H==null||(e=H.location)==null?void 0:e.protocol)==="https:",ip:!1,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",consent_persistence_name:null,opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},request_batching:!0,properties_string_max_length:65535,mask_all_element_attributes:!1,mask_all_text:!1,mask_personal_data_properties:!1,custom_personal_data_properties:[],advanced_disable_flags:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_only_evaluate_survey_feature_flags:!1,advanced_enable_surveys:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,surveys_request_timeout_ms:1e4,on_request_error:t=>{var s="Bad HTTP status: "+t.statusCode+" "+t.text;_e.error(s)},get_device_id:t=>t,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"identified_only",before_send:void 0,request_queue_config:{flush_interval_ms:qg},error_tracking:{},_onCapture:Xg,__preview_eager_load_replay:!1},(t=>({rageclick:!(t&&t>="2025-11-30")||{content_ignorelist:!0},capture_pageview:!(t&&t>="2025-05-24")||"history_change",session_recording:t&&t>="2025-11-30"?{strictMinimumDuration:!0}:{},external_scripts_inject_target:t&&t>="2026-01-30"?"head":"body"}))(r))},p1=r=>{var e={};Te(r.process_person)||(e.person_profiles=r.process_person),Te(r.xhr_headers)||(e.request_headers=r.xhr_headers),Te(r.cookie_name)||(e.persistence_name=r.cookie_name),Te(r.disable_cookie)||(e.disable_persistence=r.disable_cookie),Te(r.store_google)||(e.save_campaign_params=r.store_google),Te(r.verbose)||(e.debug=r.verbose);var t=ds({},e,r);return bt(r.property_blacklist)&&(Te(r.property_denylist)?t.property_denylist=r.property_blacklist:bt(r.property_denylist)?t.property_denylist=[...r.property_blacklist,...r.property_denylist]:_e.error("Invalid value for property_denylist config: "+r.property_denylist)),t};class $D{constructor(){this.__forceAllowLocalhost=!1}get Br(){return this.__forceAllowLocalhost}set Br(e){_e.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}class Up{get decideEndpointWasHit(){var e,t;return(e=(t=this.featureFlags)==null?void 0:t.hasLoadedFlags)!==null&&e!==void 0&&e}get flagsEndpointWasHit(){var e,t;return(e=(t=this.featureFlags)==null?void 0:t.hasLoadedFlags)!==null&&e!==void 0&&e}constructor(){this.webPerformance=new $D,this.qr=!1,this.version=ln.LIB_VERSION,this.Wr=new Ky,this._calculate_event_properties=this.calculateEventProperties.bind(this),this.config=h1(),this.SentryIntegration=GI,this.sentryIntegration=e=>function(t,s){var i=GT(t,s);return{name:UT,processEvent:n=>i(n)}}(this,e),this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this.Gr=!1,this.Vr=null,this.Jr=null,this.Kr=null,this.featureFlags=new mD(this),this.toolbar=new YI(this),this.scrollManager=new PD(this),this.pageViewManager=new Hv(this),this.surveys=new CD(this),this.conversations=new SD(this),this.logs=new TD(this),this.experiments=new Xs(this),this.exceptions=new uD(this),this.rateLimiter=new AD(this),this.requestRouter=new DD(this),this.consent=new LI(this),this.externalIntegrations=new OD(this),this.people={set:(e,t,s)=>{var i=As(e)?{[e]:t}:e;this.setPersonProperties(i),s?.({})},set_once:(e,t,s)=>{var i=As(e)?{[e]:t}:e;this.setPersonProperties(void 0,i),s?.({})}},this.on("eventCaptured",e=>_e.info('send "'+e?.event+'"',e))}init(e,t,s){if(s&&s!==sc){var i,n=(i=pd[s])!==null&&i!==void 0?i:new Up;return n._init(e,t,s),pd[s]=n,pd[sc][s]=n,n}return this._init(e,t,s)}_init(e,t,s){var i;if(t===void 0&&(t={}),Te(e)||_g(e))return _e.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return console.warn("[PostHog.js]","You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},t.debug=this.Yr(t.debug),this.Xr=t,this.Qr=[],t.person_profiles&&(this.Jr=t.person_profiles),this.set_config(ds({},h1(t.defaults),p1(t),{name:s,token:e})),this.config.on_xhr_error&&_e.error("on_xhr_error is deprecated. Use on_request_error instead"),this.compression=t.disable_compression?void 0:fn.GZipJS;var n=this.Zr();this.persistence=new Em(this.config,n),this.sessionPersistence=this.config.persistence==="sessionStorage"||this.config.persistence==="memory"?this.persistence:new Em(Ne({},this.config,{persistence:"sessionStorage"}),n);var a=Ne({},this.persistence.props),o=Ne({},this.sessionPersistence.props);this.register({$initialization_time:new Date().toISOString()}),this.ts=new _D(v=>this.es(v),this.config.request_queue_config),this.rs=new MD(this),this.__request_queue=[];var l=this.config.cookieless_mode==="always"||this.config.cookieless_mode==="on_reject"&&this.consent.isExplicitlyOptedOut();if(l||(this.sessionManager=new l1(this),this.sessionPropsManager=new c1(this,this.sessionManager,this.persistence)),this.config.__preview_deferred_init_extensions?(_e.info("Deferring extension initialization to improve startup performance"),setTimeout(()=>{this.ss(l)},0)):(_e.info("Initializing extensions synchronously"),this.ss(l)),ln.DEBUG=ln.DEBUG||this.config.debug,ln.DEBUG&&_e.info("Starting in debug mode",{this:this,config:t,thisC:Ne({},this.config),p:a,s:o}),((i=t.bootstrap)==null?void 0:i.distinctID)!==void 0){var d,u,h=this.config.get_device_id(ta()),p=(d=t.bootstrap)!=null&&d.isIdentifiedID?h:t.bootstrap.distinctID;this.persistence.set_property(dn,(u=t.bootstrap)!=null&&u.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:t.bootstrap.distinctID,$device_id:p})}if(this.ns()){var m,f,g=Object.keys(((m=t.bootstrap)==null?void 0:m.featureFlags)||{}).filter(v=>{var b;return!((b=t.bootstrap)==null||(b=b.featureFlags)==null||!b[v])}).reduce((v,b)=>{var S;return v[b]=((S=t.bootstrap)==null||(S=S.featureFlags)==null?void 0:S[b])||!1,v},{}),y=Object.keys(((f=t.bootstrap)==null?void 0:f.featureFlagPayloads)||{}).filter(v=>g[v]).reduce((v,b)=>{var S,k;return(S=t.bootstrap)!=null&&(S=S.featureFlagPayloads)!=null&&S[b]&&(v[b]=(k=t.bootstrap)==null||(k=k.featureFlagPayloads)==null?void 0:k[b]),v},{});this.featureFlags.receivedFeatureFlags({featureFlags:g,featureFlagPayloads:y})}if(l)this.register_once({distinct_id:kl,$device_id:null},"");else if(!this.get_distinct_id()){var x=this.config.get_device_id(ta());this.register_once({distinct_id:x,$device_id:x},""),this.persistence.set_property(dn,"anonymous")}return xs(H,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this),{passive:!1}),this.toolbar.maybeLoadToolbar(),t.segment?UI(this,()=>this.os()):this.os(),oa(this.config._onCapture)&&this.config._onCapture!==Xg&&(_e.warn("onCapture is deprecated. Please use `before_send` instead"),this.on("eventCaptured",v=>this.config._onCapture(v.event,v))),this.config.ip&&_e.warn('The `ip` config option has NO EFFECT AT ALL and has been deprecated. Use a custom transformation or "Discard IP data" project setting instead. See https://posthog.com/tutorials/web-redact-properties#hiding-customer-ip-address for more information.'),this}ss(e){var t=performance.now();this.historyAutocapture=new VI(this),this.historyAutocapture.startIfEnabled();var s=[];s.push(()=>{new HI(this).startIfEnabledOrStop()}),s.push(()=>{var i;this.siteApps=new ID(this),(i=this.siteApps)==null||i.init()}),e||s.push(()=>{this.sessionRecording=new u1(this),this.sessionRecording.startIfEnabledOrStop()}),this.config.disable_scroll_properties||s.push(()=>{this.scrollManager.startMeasuringScrollPosition()}),s.push(()=>{this.autocapture=new MI(this),this.autocapture.startIfEnabled()}),s.push(()=>{this.surveys.loadIfEnabled()}),s.push(()=>{this.logs.loadIfEnabled()}),s.push(()=>{this.conversations.loadIfEnabled()}),s.push(()=>{this.productTours=new gD(this),this.productTours.loadIfEnabled()}),s.push(()=>{this.heatmaps=new tD(this),this.heatmaps.startIfEnabled()}),s.push(()=>{this.webVitalsAutocapture=new ZI(this)}),s.push(()=>{this.exceptionObserver=new zI(this),this.exceptionObserver.startIfEnabledOrStop()}),s.push(()=>{this.deadClicksAutocapture=new VT(this,$I),this.deadClicksAutocapture.startIfEnabled()}),s.push(()=>{if(this.ls){var i=this.ls;this.ls=void 0,this.bi(i)}}),this.us(s,t)}us(e,t){for(;e.length>0;){if(this.config.__preview_deferred_init_extensions&&performance.now()-t>=30&&e.length>0)return void setTimeout(()=>{this.us(e,t)},0);var s=e.shift();if(s)try{s()}catch(n){_e.error("Error initializing extension:",n)}}var i=Math.round(performance.now()-t);this.register_for_session({$sdk_debug_extensions_init_method:this.config.__preview_deferred_init_extensions?"deferred":"synchronous",$sdk_debug_extensions_init_time_ms:i}),this.config.__preview_deferred_init_extensions&&_e.info("PostHog extensions initialized ("+i+"ms)")}bi(e){var t,s,i,n,a,o,l,d,u;if(!Ae||!Ae.body)return _e.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(()=>{this.bi(e)},500);this.config.__preview_deferred_init_extensions&&(this.ls=e),this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=ot(e.supportedCompression,fn.GZipJS)?fn.GZipJS:ot(e.supportedCompression,fn.Base64)?fn.Base64:void 0),(t=e.analytics)!=null&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),this.set_config({person_profiles:this.Jr?this.Jr:"identified_only"}),(s=this.siteApps)==null||s.onRemoteConfig(e),(i=this.sessionRecording)==null||i.onRemoteConfig(e),(n=this.autocapture)==null||n.onRemoteConfig(e),(a=this.heatmaps)==null||a.onRemoteConfig(e),this.surveys.onRemoteConfig(e),this.logs.onRemoteConfig(e),this.conversations.onRemoteConfig(e),(o=this.productTours)==null||o.onRemoteConfig(e),(l=this.webVitalsAutocapture)==null||l.onRemoteConfig(e),(d=this.exceptionObserver)==null||d.onRemoteConfig(e),this.exceptions.onRemoteConfig(e),(u=this.deadClicksAutocapture)==null||u.onRemoteConfig(e)}os(){try{this.config.loaded(this)}catch(e){_e.critical("`loaded` function failed",e)}this.hs(),this.config.capture_pageview&&setTimeout(()=>{(this.consent.isOptedIn()||this.config.cookieless_mode==="always")&&this.ds()},1),new jD(this).load(),this.featureFlags.flags()}hs(){var e;this.is_capturing()&&this.config.request_batching&&((e=this.ts)==null||e.enable())}_dom_loaded(){this.is_capturing()&&ca(this.__request_queue,e=>this.es(e)),this.__request_queue=[],this.hs()}_handle_unload(){var e,t;this.surveys.handlePageUnload(),this.config.request_batching?(this.vs()&&this.capture("$pageleave"),(e=this.ts)==null||e.unload(),(t=this.rs)==null||t.unload()):this.vs()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}_send_request(e){this.__loaded&&(oA?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=np(e.url,{ip:this.config.ip?1:0}),e.headers=Ne({},this.config.request_headers,e.headers),e.compression=e.compression==="best-available"?this.compression:e.compression,e.disableXHRCredentials=this.config.__preview_disable_xhr_credentials,this.config.__preview_disable_beacon&&(e.disableTransport=["sendBeacon"]),e.fetchOptions=e.fetchOptions||this.config.fetch_options,(t=>{var s,i,n,a=Ne({},t);a.timeout=a.timeout||6e4,a.url=np(a.url,{_:new Date().getTime().toString(),ver:ln.LIB_VERSION,compression:a.compression});var o=(s=a.transport)!==null&&s!==void 0?s:"fetch",l=Sh.filter(u=>!a.disableTransport||!u.transport||!a.disableTransport.includes(u.transport)),d=(i=(n=CT(l,u=>u.transport===o))==null?void 0:n.method)!==null&&i!==void 0?i:l[0].method;if(!d)throw new Error("No available transport method");d(a)})(Ne({},e,{callback:t=>{var s,i;this.rateLimiter.checkForLimiting(t),t.statusCode>=400&&((s=(i=this.config).on_request_error)==null||s.call(i,t)),e.callback==null||e.callback(t)}}))))}es(e){this.rs?this.rs.retriableRequest(e):this._send_request(e)}_execute_array(e){var t,s=[],i=[],n=[];ca(e,o=>{o&&(t=o[0],bt(t)?n.push(o):oa(o)?o.call(this):bt(o)&&t==="alias"?s.push(o):bt(o)&&t.indexOf("capture")!==-1&&oa(this[t])?n.push(o):i.push(o))});var a=function(o,l){ca(o,function(d){if(bt(d[0])){var u=l;Dt(d,function(h){u=u[h[0]].apply(u,h.slice(1))})}else this[d[0]].apply(this,d.slice(1))},l)};a(s,this),a(i,this),a(n,this)}ns(){var e,t;return((e=this.config.bootstrap)==null?void 0:e.featureFlags)&&Object.keys((t=this.config.bootstrap)==null?void 0:t.featureFlags).length>0||!1}push(e){this._execute_array([e])}capture(e,t,s){var i;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this.ts){if(this.is_capturing())if(!Te(e)&&As(e)){var n=!this.config.opt_out_useragent_filter&&this._is_bot();if(!(n&&!this.config.__preview_capture_bot_pageviews)){var a=s!=null&&s.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(a==null||!a.isRateLimited){t!=null&&t.$current_url&&!As(t?.$current_url)&&(_e.error("Invalid `$current_url` property provided to `posthog.capture`. Input must be a string. Ignoring provided value."),t==null||delete t.$current_url),this.sessionPersistence.update_search_keyword(),this.config.save_campaign_params&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.save_campaign_params||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,l=s?.timestamp||o,d=ta(),u={uuid:d,event:e,properties:this.calculateEventProperties(e,t||{},l,d)};e==="$pageview"&&this.config.__preview_capture_bot_pageviews&&n&&(u.event="$bot_pageview",u.properties.$browser_type="bot"),a&&(u.properties.$lib_rate_limit_remaining_tokens=a.remainingTokens),s?.$set&&(u.$set=s?.$set);var h,p=e!=="$groupidentify",m=this.cs(s?.$set_once,p);if(m&&(u.$set_once=m),(u=pI(u,s!=null&&s._noTruncate?null:this.config.properties_string_max_length)).timestamp=l,Te(s?.timestamp)||(u.properties.$event_time_override_provided=!0,u.properties.$event_time_override_system_time=o),e===Kl.DISMISSED||e===Kl.SENT){var f=t?.[Nm.SURVEY_ID],g=t?.[Nm.SURVEY_ITERATION];h={id:f,current_iteration:g},localStorage.getItem(a1(h))||localStorage.setItem(a1(h),"true"),u.$set=Ne({},u.$set,{[yD({id:f,current_iteration:g},e===Kl.SENT?"responded":"dismissed")]:!0})}else e===Kl.SHOWN&&(u.$set=Ne({},u.$set,{[Nm.SURVEY_LAST_SEEN_DATE]:new Date().toISOString()}));var y=Ne({},u.properties.$set,u.$set);if(nc(y)||this.setPersonPropertiesForFlags(y),!xt(this.config.before_send)){var x=this.fs(u);if(!x)return;u=x}this.Wr.emit("eventCaptured",u);var v={method:"POST",url:(i=s?._url)!==null&&i!==void 0?i:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:u,compression:"best-available",batchKey:s?._batchKey};return!this.config.request_batching||s&&(s==null||!s._batchKey)||s!=null&&s.send_instantly?this.es(v):this.ts.enqueue(v),u}_e.critical("This capture call is ignored due to client rate limiting.")}}else _e.error("No event name provided to posthog.capture")}else _e.uninitializedWarning("posthog.capture")}Bi(e){return this.on("eventCaptured",t=>e(t.event,t))}calculateEventProperties(e,t,s,i,n){if(s=s||new Date,!this.persistence||!this.sessionPersistence)return t;var a=n?void 0:this.persistence.remove_event_timer(e),o=Ne({},t);if(o.token=this.config.token,o.$config_defaults=this.config.defaults,(this.config.cookieless_mode=="always"||this.config.cookieless_mode=="on_reject"&&this.consent.isExplicitlyOptedOut())&&(o.$cookieless_mode=!0),e==="$snapshot"){var l=Ne({},this.persistence.properties(),this.sessionPersistence.properties());return o.distinct_id=l.distinct_id,(!As(o.distinct_id)&&!kn(o.distinct_id)||_g(o.distinct_id))&&_e.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),o}var d,u=JI(this.config.mask_personal_data_properties,this.config.custom_personal_data_properties);if(this.sessionManager){var{sessionId:h,windowId:p}=this.sessionManager.checkAndGetSessionAndWindowId(n,s.getTime());o.$session_id=h,o.$window_id=p}this.sessionPropsManager&&ds(o,this.sessionPropsManager.getSessionProps());try{var m;this.sessionRecording&&ds(o,this.sessionRecording.sdkDebugProperties),o.$sdk_debug_retry_queue_size=(m=this.rs)==null?void 0:m.length}catch(x){o.$sdk_debug_error_capturing_properties=String(x)}if(this.requestRouter.region===Ql.CUSTOM&&(o.$lib_custom_api_host=this.config.api_host),d=e!=="$pageview"||n?e!=="$pageleave"||n?this.pageViewManager.doEvent():this.pageViewManager.doPageLeave(s):this.pageViewManager.doPageView(s,i),o=ds(o,d),e==="$pageview"&&Ae&&(o.title=Ae.title),!Te(a)){var f=s.getTime()-a;o.$duration=parseFloat((f/1e3).toFixed(3))}vi&&this.config.opt_out_useragent_filter&&(o.$browser_type=this._is_bot()?"bot":"browser"),(o=ds({},u,this.persistence.properties(),this.sessionPersistence.properties(),o)).$is_identified=this._isIdentified(),bt(this.config.property_denylist)?Dt(this.config.property_denylist,function(x){delete o[x]}):_e.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var g=this.config.sanitize_properties;g&&(_e.error("sanitize_properties is deprecated. Use before_send instead"),o=g(o,e));var y=this.ps();return o.$process_person_profile=y,y&&!n&&this.gs("_calculate_event_properties"),o}cs(e,t){var s;if(t===void 0&&(t=!0),!this.persistence||!this.ps()||this.qr)return e;var i=this.persistence.get_initial_props(),n=(s=this.sessionPropsManager)==null?void 0:s.getSetOnceProps(),a=ds({},i,n||{},e||{}),o=this.config.sanitize_properties;return o&&(_e.error("sanitize_properties is deprecated. Use before_send instead"),a=o(a,"$set_once")),t&&(this.qr=!0),nc(a)?void 0:a}register(e,t){var s;(s=this.persistence)==null||s.register(e,t)}register_once(e,t,s){var i;(i=this.persistence)==null||i.register_once(e,t,s)}register_for_session(e){var t;(t=this.sessionPersistence)==null||t.register(e)}unregister(e){var t;(t=this.persistence)==null||t.unregister(e)}unregister_for_session(e){var t;(t=this.sessionPersistence)==null||t.unregister(e)}_s(e,t){this.register({[e]:t})}getFeatureFlag(e,t){return this.featureFlags.getFeatureFlag(e,t)}getFeatureFlagPayload(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch{return t}}isFeatureEnabled(e,t){return this.featureFlags.isFeatureEnabled(e,t)}reloadFeatureFlags(){this.featureFlags.reloadFeatureFlags()}updateFlags(e,t,s){var i=s!=null&&s.merge?this.featureFlags.getFlagVariants():{},n=s!=null&&s.merge?this.featureFlags.getFlagPayloads():{},a=Ne({},i,e),o=Ne({},n,t),l={};for(var[d,u]of Object.entries(a)){var h=typeof u=="string";l[d]={key:d,enabled:!!h||!!u,variant:h?u:void 0,reason:void 0,metadata:Te(o?.[d])?void 0:{id:0,version:void 0,description:void 0,payload:o[d]}}}this.featureFlags.receivedFeatureFlags({flags:l})}updateEarlyAccessFeatureEnrollment(e,t,s){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t,s)}getEarlyAccessFeatures(e,t,s){return t===void 0&&(t=!1),this.featureFlags.getEarlyAccessFeatures(e,t,s)}on(e,t){return this.Wr.on(e,t)}onFeatureFlags(e){return this.featureFlags.onFeatureFlags(e)}onSurveysLoaded(e){return this.surveys.onSurveysLoaded(e)}onSessionId(e){var t,s;return(t=(s=this.sessionManager)==null?void 0:s.onSessionId(e))!==null&&t!==void 0?t:()=>{}}getSurveys(e,t){t===void 0&&(t=!1),this.surveys.getSurveys(e,t)}getActiveMatchingSurveys(e,t){t===void 0&&(t=!1),this.surveys.getActiveMatchingSurveys(e,t)}renderSurvey(e,t){this.surveys.renderSurvey(e,t)}displaySurvey(e,t){t===void 0&&(t=bD),this.surveys.displaySurvey(e,t)}cancelPendingSurvey(e){this.surveys.cancelPendingSurvey(e)}canRenderSurvey(e){return this.surveys.canRenderSurvey(e)}canRenderSurveyAsync(e,t){return t===void 0&&(t=!1),this.surveys.canRenderSurveyAsync(e,t)}identify(e,t,s){if(!this.__loaded||!this.persistence)return _e.uninitializedWarning("posthog.identify");if(kn(e)&&(e=e.toString(),_e.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e)if(["distinct_id","distinctid"].includes(e.toLowerCase()))_e.critical('The string "'+e+'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.');else if(e!==kl){if(this.gs("posthog.identify")){var i=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var n=i;this.register_once({$had_persisted_distinct_id:!0,$device_id:n},"")}e!==i&&e!==this.get_property(Wl)&&(this.unregister(Wl),this.register({distinct_id:e}));var a=(this.persistence.get_property(dn)||"anonymous")==="anonymous";e!==i&&a?(this.persistence.set_property(dn,"identified"),this.setPersonPropertiesForFlags(Ne({},s||{},t||{}),!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:i},{$set:t||{},$set_once:s||{}}),this.Kr=e1(e,t,s),this.featureFlags.setAnonymousDistinctId(i)):(t||s)&&this.setPersonProperties(t,s),e!==i&&(this.reloadFeatureFlags(),this.unregister(Kh))}}else _e.critical('The string "'+kl+'" was set in posthog.identify which indicates an error. This ID is only used as a sentinel value.');else _e.error("Unique user id has not been set in posthog.identify")}setPersonProperties(e,t){if((e||t)&&this.gs("posthog.setPersonProperties")){var s=e1(this.get_distinct_id(),e,t);this.Kr!==s?(this.setPersonPropertiesForFlags(Ne({},t||{},e||{})),this.capture("$set",{$set:e||{},$set_once:t||{}}),this.Kr=s):_e.info("A duplicate setPersonProperties call was made with the same properties. It has been ignored.")}}group(e,t,s){if(e&&t){var i=this.getGroups();i[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:Ne({},i,{[e]:t})}),s&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:s}),this.setGroupPropertiesForFlags({[e]:s})),i[e]===t||s||this.reloadFeatureFlags()}else _e.error("posthog.group requires a group type and group key")}resetGroups(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}setPersonPropertiesForFlags(e,t){t===void 0&&(t=!0),this.featureFlags.setPersonPropertiesForFlags(e,t)}resetPersonPropertiesForFlags(){this.featureFlags.resetPersonPropertiesForFlags()}setGroupPropertiesForFlags(e,t){t===void 0&&(t=!0),this.gs("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}resetGroupPropertiesForFlags(e){this.featureFlags.resetGroupPropertiesForFlags(e)}reset(e){var t,s,i,n;if(_e.info("reset"),!this.__loaded)return _e.uninitializedWarning("posthog.reset");var a=this.get_property("$device_id");if(this.consent.reset(),(t=this.persistence)==null||t.clear(),(s=this.sessionPersistence)==null||s.clear(),this.surveys.reset(),this.featureFlags.reset(),(i=this.persistence)==null||i.set_property(dn,"anonymous"),(n=this.sessionManager)==null||n.resetSessionId(),this.Kr=null,this.config.cookieless_mode==="always")this.register_once({distinct_id:kl,$device_id:null},"");else{var o=this.config.get_device_id(ta());this.register_once({distinct_id:o,$device_id:e?o:a},"")}this.register({$last_posthog_reset:new Date().toISOString()},1)}get_distinct_id(){return this.get_property("distinct_id")}getGroups(){return this.get_property("$groups")||{}}get_session_id(){var e,t;return(e=(t=this.sessionManager)==null?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}get_session_replay_url(e){if(!this.sessionManager)return"";var{sessionId:t,sessionStartTimestamp:s}=this.sessionManager.checkAndGetSessionAndWindowId(!0),i=this.requestRouter.endpointFor("ui","/project/"+this.config.token+"/replay/"+t);if(e!=null&&e.withTimestamp&&s){var n,a=(n=e.timestampLookBack)!==null&&n!==void 0?n:10;if(!s)return i;i+="?t="+Math.max(Math.floor((new Date().getTime()-s)/1e3)-a,0)}return i}alias(e,t){return e===this.get_property(ST)?(_e.critical("Attempting to create alias for existing People user - aborting."),-2):this.gs("posthog.alias")?(Te(t)&&(t=this.get_distinct_id()),e!==t?(this._s(Wl,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(_e.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}set_config(e){var t=Ne({},this.config);if(Ts(e)){var s,i,n,a,o,l,d;ds(this.config,p1(e));var u=this.Zr();(s=this.persistence)==null||s.update_config(this.config,t,u),this.sessionPersistence=this.config.persistence==="sessionStorage"||this.config.persistence==="memory"?this.persistence:new Em(Ne({},this.config,{persistence:"sessionStorage"}),u);var h=this.Yr(this.config.debug);bn(h)&&(this.config.debug=h),bn(this.config.debug)&&(this.config.debug?(ln.DEBUG=!0,qt.H()&&qt.G("ph_debug","true"),_e.info("set_config",{config:e,oldConfig:t,newConfig:Ne({},this.config)})):(ln.DEBUG=!1,qt.H()&&qt.V("ph_debug"))),(i=this.exceptionObserver)==null||i.onConfigChange(),(n=this.sessionRecording)==null||n.startIfEnabledOrStop(),(a=this.autocapture)==null||a.startIfEnabled(),(o=this.heatmaps)==null||o.startIfEnabled(),(l=this.exceptionObserver)==null||l.startIfEnabledOrStop(),this.surveys.loadIfEnabled(),this.ys(),(d=this.externalIntegrations)==null||d.startIfEnabledOrStop()}}startSessionRecording(e){var t=e===!0,s={sampling:t||!(e==null||!e.sampling),linked_flag:t||!(e==null||!e.linked_flag),url_trigger:t||!(e==null||!e.url_trigger),event_trigger:t||!(e==null||!e.event_trigger)};if(Object.values(s).some(Boolean)){var i,n,a,o,l;(i=this.sessionManager)==null||i.checkAndGetSessionAndWindowId(),s.sampling&&((n=this.sessionRecording)==null||n.overrideSampling()),s.linked_flag&&((a=this.sessionRecording)==null||a.overrideLinkedFlag()),s.url_trigger&&((o=this.sessionRecording)==null||o.overrideTrigger("url")),s.event_trigger&&((l=this.sessionRecording)==null||l.overrideTrigger("event"))}this.set_config({disable_session_recording:!1})}stopSessionRecording(){this.set_config({disable_session_recording:!0})}sessionRecordingStarted(){var e;return!((e=this.sessionRecording)==null||!e.started)}captureException(e,t){var s=new Error("PostHog syntheticException"),i=this.exceptions.buildProperties(e,{handled:!0,syntheticException:s});return this.exceptions.sendExceptionEvent(Ne({},i,t))}startExceptionAutocapture(e){this.set_config({capture_exceptions:e==null||e})}stopExceptionAutocapture(){this.set_config({capture_exceptions:!1})}loadToolbar(e){return this.toolbar.loadToolbar(e)}get_property(e){var t;return(t=this.persistence)==null?void 0:t.props[e]}getSessionProperty(e){var t;return(t=this.sessionPersistence)==null?void 0:t.props[e]}toString(){var e,t=(e=this.config.name)!==null&&e!==void 0?e:sc;return t!==sc&&(t=sc+"."+t),t}_isIdentified(){var e,t;return((e=this.persistence)==null?void 0:e.get_property(dn))==="identified"||((t=this.sessionPersistence)==null?void 0:t.get_property(dn))==="identified"}ps(){var e,t;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&nc(this.getGroups())&&((e=this.persistence)==null||(e=e.props)==null||!e[Wl])&&((t=this.persistence)==null||(t=t.props)==null||!t[Jh]))}vs(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&(this.config.capture_pageview===!0||this.config.capture_pageview==="history_change")}createPersonProfile(){this.ps()||this.gs("posthog.createPersonProfile")&&this.setPersonProperties({},{})}gs(e){return this.config.person_profiles==="never"?(_e.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._s(Jh,!0),!0)}Zr(){if(this.config.cookieless_mode==="always")return!0;var e=this.consent.isOptedOut(),t=this.config.opt_out_persistence_by_default||this.config.cookieless_mode==="on_reject";return this.config.disable_persistence||e&&!!t}ys(){var e,t,s,i,n=this.Zr();return((e=this.persistence)==null?void 0:e.ki)!==n&&((s=this.persistence)==null||s.set_disabled(n)),((t=this.sessionPersistence)==null?void 0:t.ki)!==n&&((i=this.sessionPersistence)==null||i.set_disabled(n)),n}opt_in_capturing(e){var t;if(this.config.cookieless_mode!=="always"){var s,i,n;this.config.cookieless_mode==="on_reject"&&this.consent.isExplicitlyOptedOut()&&(this.reset(!0),(s=this.sessionManager)==null||s.destroy(),(i=this.pageViewManager)==null||i.destroy(),this.sessionManager=new l1(this),this.pageViewManager=new Hv(this),this.persistence&&(this.sessionPropsManager=new c1(this,this.sessionManager,this.persistence)),this.sessionRecording=new u1(this),this.sessionRecording.startIfEnabledOrStop()),this.consent.optInOut(!0),this.ys(),this.hs(),(t=this.sessionRecording)==null||t.startIfEnabledOrStop(),this.config.cookieless_mode=="on_reject"&&this.surveys.loadIfEnabled(),(Te(e?.captureEventName)||e!=null&&e.captureEventName)&&this.capture((n=e?.captureEventName)!==null&&n!==void 0?n:"$opt_in",e?.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this.ds()}else _e.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}opt_out_capturing(){var e,t,s;this.config.cookieless_mode!=="always"?(this.config.cookieless_mode==="on_reject"&&this.consent.isOptedIn()&&this.reset(!0),this.consent.optInOut(!1),this.ys(),this.config.cookieless_mode==="on_reject"&&(this.register({distinct_id:kl,$device_id:null}),(e=this.sessionManager)==null||e.destroy(),(t=this.pageViewManager)==null||t.destroy(),this.sessionManager=void 0,this.sessionPropsManager=void 0,(s=this.sessionRecording)==null||s.stopRecording(),this.sessionRecording=void 0,this.ds())):_e.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}has_opted_in_capturing(){return this.consent.isOptedIn()}has_opted_out_capturing(){return this.consent.isOptedOut()}get_explicit_consent_status(){var e=this.consent.consent;return e===un.GRANTED?"granted":e===un.DENIED?"denied":"pending"}is_capturing(){return this.config.cookieless_mode==="always"||(this.config.cookieless_mode==="on_reject"?this.consent.isExplicitlyOptedOut()||this.consent.isOptedIn():!this.has_opted_out_capturing())}clear_opt_in_out_capturing(){this.consent.reset(),this.ys()}_is_bot(){return $i?aA($i,this.config.custom_blocked_useragents):void 0}ds(){Ae&&(Ae.visibilityState==="visible"?this.Gr||(this.Gr=!0,this.capture("$pageview",{title:Ae.title},{send_instantly:!0}),this.Vr&&(Ae.removeEventListener("visibilitychange",this.Vr),this.Vr=null)):this.Vr||(this.Vr=this.ds.bind(this),xs(Ae,"visibilitychange",this.Vr)))}debug(e){e===!1?(H?.console.log("You've disabled debug mode."),this.set_config({debug:!1})):(H?.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),this.set_config({debug:!0}))}O(){var e,t,s,i,n,a,o,l=this.Xr||{};return"advanced_disable_flags"in l?!!l.advanced_disable_flags:this.config.advanced_disable_flags!==!1?!!this.config.advanced_disable_flags:this.config.advanced_disable_decide===!0?(_e.warn("Config field 'advanced_disable_decide' is deprecated. Please use 'advanced_disable_flags' instead. The old field will be removed in a future major version."),!0):(s="advanced_disable_decide",i=!1,n=_e,a=(t="advanced_disable_flags")in(e=l)&&!Te(e[t]),o=s in e&&!Te(e[s]),a?e[t]:o?(n&&n.warn("Config field '"+s+"' is deprecated. Please use '"+t+"' instead. The old field will be removed in a future major version."),e[s]):i)}fs(e){if(xt(this.config.before_send))return e;var t=bt(this.config.before_send)?this.config.before_send:[this.config.before_send],s=e;for(var i of t){if(s=i(s),xt(s)){var n="Event '"+e.event+"' was rejected in beforeSend function";return MR(e.event)?_e.warn(n+". This can cause unexpected behavior."):_e.info(n),null}s.properties&&!nc(s.properties)||_e.warn("Event '"+e.event+"' has no properties after beforeSend function, this is likely an error.")}return s}getPageViewId(){var e;return(e=this.pageViewManager.Kt)==null?void 0:e.pageViewId}captureTraceFeedback(e,t){this.capture("$ai_feedback",{$ai_trace_id:String(e),$ai_feedback_text:t})}captureTraceMetric(e,t,s){this.capture("$ai_metric",{$ai_trace_id:String(e),$ai_metric_name:t,$ai_metric_value:String(s)})}Yr(e){var t=bn(e)&&!e,s=qt.H()&&qt.q("ph_debug")==="true";return!t&&(!!s||e)}}(function(r,e){for(var t=0;t<e.length;t++)r.prototype[e[t]]=hI(r.prototype[e[t]])})(Up,["identify"]);var m1,zD=(m1=pd[sc]=new Up,function(){function r(){r.done||(r.done=!0,oA=!1,Dt(pd,function(e){e._dom_loaded()}))}Ae!=null&&Ae.addEventListener?Ae.readyState==="complete"?r():xs(Ae,"DOMContentLoaded",r,{capture:!1}):H&&_e.error("Browser doesn't support `document.addEventListener` so PostHog couldn't be initialized")}(),m1),cA=w.createContext({client:zD,bootstrap:void 0}),Im=function(r){return typeof r=="function"},VD=function(){var r=w.useContext(cA).client;return r},Kg=function(r,e){return Kg=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])},Kg(r,e)};function UD(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Kg(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var GD={componentStack:null,exceptionEvent:null,error:null},WD={INVALID_FALLBACK:"[PostHog.js][PostHogErrorBoundary] Invalid fallback prop, provide a valid React element or a function that returns a valid React element."};(function(r){UD(e,r);function e(t){var s=r.call(this,t)||this;return s.state=GD,s}return e.prototype.componentDidCatch=function(t,s){var i=this.props.additionalProperties,n;Im(i)?n=i(t):typeof i=="object"&&(n=i);var a=this.context.client,o=a.captureException(t,n),l=s.componentStack;this.setState({error:t,componentStack:l??null,exceptionEvent:o})},e.prototype.render=function(){var t=this.props,s=t.children,i=t.fallback,n=this.state;if(n.componentStack==null)return Im(s)?s():s;var a=Im(i)?He.createElement(i,{error:n.error,componentStack:n.componentStack,exceptionEvent:n.exceptionEvent}):i;return He.isValidElement(a)?a:(console.warn(WD.INVALID_FALLBACK),He.createElement(He.Fragment,null))},e.contextType=cA,e})(He.Component);const Qy=w.createContext({});function Jy(r){const e=w.useRef(null);return e.current===null&&(e.current=r()),e.current}const Zy=typeof window<"u",lA=Zy?w.useLayoutEffect:w.useEffect,Gp=w.createContext(null);function ex(r,e){r.indexOf(e)===-1&&r.push(e)}function tx(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}const Cn=(r,e,t)=>t>e?e:t<r?r:t;let sx=()=>{};const Sn={},dA=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function uA(r){return typeof r=="object"&&r!==null}const hA=r=>/^0[^.\s]+$/u.test(r);function ix(r){let e;return()=>(e===void 0&&(e=r()),e)}const mr=r=>r,YD=(r,e)=>t=>e(r(t)),pu=(...r)=>r.reduce(YD),Bd=(r,e,t)=>{const s=e-r;return s===0?1:(t-r)/s};let rx=class{constructor(){this.subscriptions=[]}add(e){return ex(this.subscriptions,e),()=>tx(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,s);else for(let n=0;n<i;n++){const a=this.subscriptions[n];a&&a(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}};const Vr=r=>r*1e3,or=r=>r/1e3;function pA(r,e){return e?r*(1e3/e):0}const mA=(r,e,t)=>(((1-3*t+3*e)*r+(3*t-6*e))*r+3*e)*r,qD=1e-7,HD=12;function XD(r,e,t,s,i){let n,a,o=0;do a=e+(t-e)/2,n=mA(a,s,i)-r,n>0?t=a:e=a;while(Math.abs(n)>qD&&++o<HD);return a}function mu(r,e,t,s){if(r===e&&t===s)return mr;const i=n=>XD(n,0,1,r,t);return n=>n===0||n===1?n:mA(i(n),e,s)}const fA=r=>e=>e<=.5?r(2*e)/2:(2-r(2*(1-e)))/2,gA=r=>e=>1-r(1-e),yA=mu(.33,1.53,.69,.99),nx=gA(yA),xA=fA(nx),bA=r=>(r*=2)<1?.5*nx(r):.5*(2-Math.pow(2,-10*(r-1))),ax=r=>1-Math.sin(Math.acos(r)),vA=gA(ax),wA=fA(ax),KD=mu(.42,0,1,1),QD=mu(0,0,.58,1),kA=mu(.42,0,.58,1),JD=r=>Array.isArray(r)&&typeof r[0]!="number",CA=r=>Array.isArray(r)&&typeof r[0]=="number",ZD={linear:mr,easeIn:KD,easeInOut:kA,easeOut:QD,circIn:ax,circInOut:wA,circOut:vA,backIn:nx,backInOut:xA,backOut:yA,anticipate:bA},e5=r=>typeof r=="string",f1=r=>{if(CA(r)){sx(r.length===4);const[e,t,s,i]=r;return mu(e,t,s,i)}else if(e5(r))return ZD[r];return r},Fu=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function t5(r,e){let t=new Set,s=new Set,i=!1,n=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(u){a.has(u)&&(d.schedule(u),r()),u(o)}const d={schedule:(u,h=!1,p=!1)=>{const f=p&&i?t:s;return h&&a.add(u),f.has(u)||f.add(u),u},cancel:u=>{s.delete(u),a.delete(u)},process:u=>{if(o=u,i){n=!0;return}i=!0,[t,s]=[s,t],t.forEach(l),t.clear(),i=!1,n&&(n=!1,d.process(u))}};return d}const s5=40;function SA(r,e){let t=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},n=()=>t=!0,a=Fu.reduce((b,S)=>(b[S]=t5(n),b),{}),{setup:o,read:l,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:m,postRender:f}=a,g=()=>{const b=Sn.useManualTiming?i.timestamp:performance.now();t=!1,Sn.useManualTiming||(i.delta=s?1e3/60:Math.max(Math.min(b-i.timestamp,s5),1)),i.timestamp=b,i.isProcessing=!0,o.process(i),l.process(i),d.process(i),u.process(i),h.process(i),p.process(i),m.process(i),f.process(i),i.isProcessing=!1,t&&e&&(s=!1,r(g))},y=()=>{t=!0,s=!0,i.isProcessing||r(g)};return{schedule:Fu.reduce((b,S)=>{const k=a[S];return b[S]=(C,A=!1,T=!1)=>(t||y(),k.schedule(C,A,T)),b},{}),cancel:b=>{for(let S=0;S<Fu.length;S++)a[Fu[S]].cancel(b)},state:i,steps:a}}const{schedule:Ut,cancel:fa,state:Fs,steps:Dm}=SA(typeof requestAnimationFrame<"u"?requestAnimationFrame:mr,!0);let Th;function i5(){Th=void 0}const Ai={now:()=>(Th===void 0&&Ai.set(Fs.isProcessing||Sn.useManualTiming?Fs.timestamp:performance.now()),Th),set:r=>{Th=r,queueMicrotask(i5)}},TA=r=>e=>typeof e=="string"&&e.startsWith(r),ox=TA("--"),r5=TA("var(--"),cx=r=>r5(r)?n5.test(r.split("/*")[0].trim()):!1,n5=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,sl={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},Ld={...sl,transform:r=>Cn(0,1,r)},Bu={...sl,default:1},md=r=>Math.round(r*1e5)/1e5,lx=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function a5(r){return r==null}const o5=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,dx=(r,e)=>t=>!!(typeof t=="string"&&o5.test(t)&&t.startsWith(r)||e&&!a5(t)&&Object.prototype.hasOwnProperty.call(t,e)),AA=(r,e,t)=>s=>{if(typeof s!="string")return s;const[i,n,a,o]=s.match(lx);return{[r]:parseFloat(i),[e]:parseFloat(n),[t]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},c5=r=>Cn(0,255,r),Fm={...sl,transform:r=>Math.round(c5(r))},ao={test:dx("rgb","red"),parse:AA("red","green","blue"),transform:({red:r,green:e,blue:t,alpha:s=1})=>"rgba("+Fm.transform(r)+", "+Fm.transform(e)+", "+Fm.transform(t)+", "+md(Ld.transform(s))+")"};function l5(r){let e="",t="",s="",i="";return r.length>5?(e=r.substring(1,3),t=r.substring(3,5),s=r.substring(5,7),i=r.substring(7,9)):(e=r.substring(1,2),t=r.substring(2,3),s=r.substring(3,4),i=r.substring(4,5),e+=e,t+=t,s+=s,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const Qg={test:dx("#"),parse:l5,transform:ao.transform},fu=r=>({test:e=>typeof e=="string"&&e.endsWith(r)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${r}`}),Qn=fu("deg"),Ur=fu("%"),Qe=fu("px"),d5=fu("vh"),u5=fu("vw"),g1={...Ur,parse:r=>Ur.parse(r)/100,transform:r=>Ur.transform(r*100)},oc={test:dx("hsl","hue"),parse:AA("hue","saturation","lightness"),transform:({hue:r,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(r)+", "+Ur.transform(md(e))+", "+Ur.transform(md(t))+", "+md(Ld.transform(s))+")"},fs={test:r=>ao.test(r)||Qg.test(r)||oc.test(r),parse:r=>ao.test(r)?ao.parse(r):oc.test(r)?oc.parse(r):Qg.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?ao.transform(r):oc.transform(r),getAnimatableNone:r=>{const e=fs.parse(r);return e.alpha=0,fs.transform(e)}},h5=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function p5(r){return isNaN(r)&&typeof r=="string"&&(r.match(lx)?.length||0)+(r.match(h5)?.length||0)>0}const jA="number",_A="color",m5="var",f5="var(",y1="${}",g5=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Od(r){const e=r.toString(),t=[],s={color:[],number:[],var:[]},i=[];let n=0;const o=e.replace(g5,l=>(fs.test(l)?(s.color.push(n),i.push(_A),t.push(fs.parse(l))):l.startsWith(f5)?(s.var.push(n),i.push(m5),t.push(l)):(s.number.push(n),i.push(jA),t.push(parseFloat(l))),++n,y1)).split(y1);return{values:t,split:o,indexes:s,types:i}}function EA(r){return Od(r).values}function MA(r){const{split:e,types:t}=Od(r),s=e.length;return i=>{let n="";for(let a=0;a<s;a++)if(n+=e[a],i[a]!==void 0){const o=t[a];o===jA?n+=md(i[a]):o===_A?n+=fs.transform(i[a]):n+=i[a]}return n}}const y5=r=>typeof r=="number"?0:fs.test(r)?fs.getAnimatableNone(r):r;function x5(r){const e=EA(r);return MA(r)(e.map(y5))}const ga={test:p5,parse:EA,createTransformer:MA,getAnimatableNone:x5};function Bm(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function b5({hue:r,saturation:e,lightness:t,alpha:s}){r/=360,e/=100,t/=100;let i=0,n=0,a=0;if(!e)i=n=a=t;else{const o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;i=Bm(l,o,r+1/3),n=Bm(l,o,r),a=Bm(l,o,r-1/3)}return{red:Math.round(i*255),green:Math.round(n*255),blue:Math.round(a*255),alpha:s}}function op(r,e){return t=>t>0?e:r}const Kt=(r,e,t)=>r+(e-r)*t,Lm=(r,e,t)=>{const s=r*r,i=t*(e*e-s)+s;return i<0?0:Math.sqrt(i)},v5=[Qg,ao,oc],w5=r=>v5.find(e=>e.test(r));function x1(r){const e=w5(r);if(!e)return!1;let t=e.parse(r);return e===oc&&(t=b5(t)),t}const b1=(r,e)=>{const t=x1(r),s=x1(e);if(!t||!s)return op(r,e);const i={...t};return n=>(i.red=Lm(t.red,s.red,n),i.green=Lm(t.green,s.green,n),i.blue=Lm(t.blue,s.blue,n),i.alpha=Kt(t.alpha,s.alpha,n),ao.transform(i))},Jg=new Set(["none","hidden"]);function k5(r,e){return Jg.has(r)?t=>t<=0?r:e:t=>t>=1?e:r}function C5(r,e){return t=>Kt(r,e,t)}function ux(r){return typeof r=="number"?C5:typeof r=="string"?cx(r)?op:fs.test(r)?b1:A5:Array.isArray(r)?PA:typeof r=="object"?fs.test(r)?b1:S5:op}function PA(r,e){const t=[...r],s=t.length,i=r.map((n,a)=>ux(n)(n,e[a]));return n=>{for(let a=0;a<s;a++)t[a]=i[a](n);return t}}function S5(r,e){const t={...r,...e},s={};for(const i in t)r[i]!==void 0&&e[i]!==void 0&&(s[i]=ux(r[i])(r[i],e[i]));return i=>{for(const n in s)t[n]=s[n](i);return t}}function T5(r,e){const t=[],s={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const n=e.types[i],a=r.indexes[n][s[n]],o=r.values[a]??0;t[i]=o,s[n]++}return t}const A5=(r,e)=>{const t=ga.createTransformer(e),s=Od(r),i=Od(e);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?Jg.has(r)&&!i.values.length||Jg.has(e)&&!s.values.length?k5(r,e):pu(PA(T5(s,i),i.values),t):op(r,e)};function NA(r,e,t){return typeof r=="number"&&typeof e=="number"&&typeof t=="number"?Kt(r,e,t):ux(r)(r,e)}const j5=r=>{const e=({timestamp:t})=>r(t);return{start:(t=!0)=>Ut.update(e,t),stop:()=>fa(e),now:()=>Fs.isProcessing?Fs.timestamp:Ai.now()}},RA=(r,e,t=10)=>{let s="";const i=Math.max(Math.round(e/t),2);for(let n=0;n<i;n++)s+=Math.round(r(n/(i-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},cp=2e4;function hx(r){let e=0;const t=50;let s=r.next(e);for(;!s.done&&e<cp;)e+=t,s=r.next(e);return e>=cp?1/0:e}function _5(r,e=100,t){const s=t({...r,keyframes:[0,e]}),i=Math.min(hx(s),cp);return{type:"keyframes",ease:n=>s.next(i*n).value/e,duration:or(i)}}const E5=5;function IA(r,e,t){const s=Math.max(e-E5,0);return pA(t-r(s),e-s)}const es={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Om=.001;function M5({duration:r=es.duration,bounce:e=es.bounce,velocity:t=es.velocity,mass:s=es.mass}){let i,n,a=1-e;a=Cn(es.minDamping,es.maxDamping,a),r=Cn(es.minDuration,es.maxDuration,or(r)),a<1?(i=d=>{const u=d*a,h=u*r,p=u-t,m=Zg(d,a),f=Math.exp(-h);return Om-p/m*f},n=d=>{const h=d*a*r,p=h*t+t,m=Math.pow(a,2)*Math.pow(d,2)*r,f=Math.exp(-h),g=Zg(Math.pow(d,2),a);return(-i(d)+Om>0?-1:1)*((p-m)*f)/g}):(i=d=>{const u=Math.exp(-d*r),h=(d-t)*r+1;return-Om+u*h},n=d=>{const u=Math.exp(-d*r),h=(t-d)*(r*r);return u*h});const o=5/r,l=N5(i,n,o);if(r=Vr(r),isNaN(l))return{stiffness:es.stiffness,damping:es.damping,duration:r};{const d=Math.pow(l,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:r}}}const P5=12;function N5(r,e,t){let s=t;for(let i=1;i<P5;i++)s=s-r(s)/e(s);return s}function Zg(r,e){return r*Math.sqrt(1-e*e)}const R5=["duration","bounce"],I5=["stiffness","damping","mass"];function v1(r,e){return e.some(t=>r[t]!==void 0)}function D5(r){let e={velocity:es.velocity,stiffness:es.stiffness,damping:es.damping,mass:es.mass,isResolvedFromDuration:!1,...r};if(!v1(r,I5)&&v1(r,R5))if(r.visualDuration){const t=r.visualDuration,s=2*Math.PI/(t*1.2),i=s*s,n=2*Cn(.05,1,1-(r.bounce||0))*Math.sqrt(i);e={...e,mass:es.mass,stiffness:i,damping:n}}else{const t=M5(r);e={...e,...t,mass:es.mass},e.isResolvedFromDuration=!0}return e}function lp(r=es.visualDuration,e=es.bounce){const t=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:e}:r;let{restSpeed:s,restDelta:i}=t;const n=t.keyframes[0],a=t.keyframes[t.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:m}=D5({...t,velocity:-or(t.velocity||0)}),f=p||0,g=d/(2*Math.sqrt(l*u)),y=a-n,x=or(Math.sqrt(l/u)),v=Math.abs(y)<5;s||(s=v?es.restSpeed.granular:es.restSpeed.default),i||(i=v?es.restDelta.granular:es.restDelta.default);let b;if(g<1){const k=Zg(x,g);b=C=>{const A=Math.exp(-g*x*C);return a-A*((f+g*x*y)/k*Math.sin(k*C)+y*Math.cos(k*C))}}else if(g===1)b=k=>a-Math.exp(-x*k)*(y+(f+x*y)*k);else{const k=x*Math.sqrt(g*g-1);b=C=>{const A=Math.exp(-g*x*C),T=Math.min(k*C,300);return a-A*((f+g*x*y)*Math.sinh(T)+k*y*Math.cosh(T))/k}}const S={calculatedDuration:m&&h||null,next:k=>{const C=b(k);if(m)o.done=k>=h;else{let A=k===0?f:0;g<1&&(A=k===0?Vr(f):IA(b,k,C));const T=Math.abs(A)<=s,j=Math.abs(a-C)<=i;o.done=T&&j}return o.value=o.done?a:C,o},toString:()=>{const k=Math.min(hx(S),cp),C=RA(A=>S.next(k*A).value,k,30);return k+"ms "+C},toTransition:()=>{}};return S}lp.applyToOptions=r=>{const e=_5(r,100,lp);return r.ease=e.ease,r.duration=Vr(e.duration),r.type="keyframes",r};function e0({keyframes:r,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:n=500,modifyTarget:a,min:o,max:l,restDelta:d=.5,restSpeed:u}){const h=r[0],p={done:!1,value:h},m=T=>o!==void 0&&T<o||l!==void 0&&T>l,f=T=>o===void 0?l:l===void 0||Math.abs(o-T)<Math.abs(l-T)?o:l;let g=t*e;const y=h+g,x=a===void 0?y:a(y);x!==y&&(g=x-h);const v=T=>-g*Math.exp(-T/s),b=T=>x+v(T),S=T=>{const j=v(T),_=b(T);p.done=Math.abs(j)<=d,p.value=p.done?x:_};let k,C;const A=T=>{m(p.value)&&(k=T,C=lp({keyframes:[p.value,f(p.value)],velocity:IA(b,T,p.value),damping:i,stiffness:n,restDelta:d,restSpeed:u}))};return A(0),{calculatedDuration:null,next:T=>{let j=!1;return!C&&k===void 0&&(j=!0,S(T),A(T)),k!==void 0&&T>=k?C.next(T-k):(!j&&S(T),p)}}}function F5(r,e,t){const s=[],i=t||Sn.mix||NA,n=r.length-1;for(let a=0;a<n;a++){let o=i(r[a],r[a+1]);if(e){const l=Array.isArray(e)?e[a]||mr:e;o=pu(l,o)}s.push(o)}return s}function B5(r,e,{clamp:t=!0,ease:s,mixer:i}={}){const n=r.length;if(sx(n===e.length),n===1)return()=>e[0];if(n===2&&e[0]===e[1])return()=>e[1];const a=r[0]===r[1];r[0]>r[n-1]&&(r=[...r].reverse(),e=[...e].reverse());const o=F5(e,s,i),l=o.length,d=u=>{if(a&&u<r[0])return e[0];let h=0;if(l>1)for(;h<r.length-2&&!(u<r[h+1]);h++);const p=Bd(r[h],r[h+1],u);return o[h](p)};return t?u=>d(Cn(r[0],r[n-1],u)):d}function L5(r,e){const t=r[r.length-1];for(let s=1;s<=e;s++){const i=Bd(0,e,s);r.push(Kt(t,1,i))}}function O5(r){const e=[0];return L5(e,r.length-1),e}function $5(r,e){return r.map(t=>t*e)}function z5(r,e){return r.map(()=>e||kA).splice(0,r.length-1)}function fd({duration:r=300,keyframes:e,times:t,ease:s="easeInOut"}){const i=JD(s)?s.map(f1):f1(s),n={done:!1,value:e[0]},a=$5(t&&t.length===e.length?t:O5(e),r),o=B5(a,e,{ease:Array.isArray(i)?i:z5(e,i)});return{calculatedDuration:r,next:l=>(n.value=o(l),n.done=l>=r,n)}}const V5=r=>r!==null;function px(r,{repeat:e,repeatType:t="loop"},s,i=1){const n=r.filter(V5),o=i<0||e&&t!=="loop"&&e%2===1?0:n.length-1;return!o||s===void 0?n[o]:s}const U5={decay:e0,inertia:e0,tween:fd,keyframes:fd,spring:lp};function DA(r){typeof r.type=="string"&&(r.type=U5[r.type])}let mx=class{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}};const G5=r=>r/100;let fx=class extends mx{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==Ai.now()&&this.tick(Ai.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;DA(e);const{type:t=fd,repeat:s=0,repeatDelay:i=0,repeatType:n,velocity:a=0}=e;let{keyframes:o}=e;const l=t||fd;l!==fd&&typeof o[0]!="number"&&(this.mixKeyframes=pu(G5,NA(o[0],o[1])),o=[0,100]);const d=l({...e,keyframes:o});n==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...o].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=hx(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(s+1)-i,this.generator=d}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:i,mixKeyframes:n,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:m,type:f,onUpdate:g,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const x=this.currentTime-d*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?x<0:x>i;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let b=this.currentTime,S=s;if(h){const T=Math.min(this.currentTime,i)/o;let j=Math.floor(T),_=T%1;!_&&T>=1&&(_=1),_===1&&j--,j=Math.min(j,h+1),!!(j%2)&&(p==="reverse"?(_=1-_,m&&(_-=m/o)):p==="mirror"&&(S=a)),b=Cn(0,1,_)*o}const k=v?{done:!1,value:u[0]}:S.next(b);n&&(k.value=n(k.value));let{done:C}=k;!v&&l!==null&&(C=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const A=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&C);return A&&f!==e0&&(k.value=px(u,this.options,y,this.speed)),g&&g(k.value),A&&this.finish(),k}then(e,t){return this.finished.then(e,t)}get duration(){return or(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+or(e)}get time(){return or(this.currentTime)}set time(e){e=Vr(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Ai.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=or(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=j5,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ai.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}};function W5(r){for(let e=1;e<r.length;e++)r[e]??(r[e]=r[e-1])}const oo=r=>r*180/Math.PI,t0=r=>{const e=oo(Math.atan2(r[1],r[0]));return s0(e)},Y5={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:t0,rotateZ:t0,skewX:r=>oo(Math.atan(r[1])),skewY:r=>oo(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},s0=r=>(r=r%360,r<0&&(r+=360),r),w1=t0,k1=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),C1=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),q5={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:k1,scaleY:C1,scale:r=>(k1(r)+C1(r))/2,rotateX:r=>s0(oo(Math.atan2(r[6],r[5]))),rotateY:r=>s0(oo(Math.atan2(-r[2],r[0]))),rotateZ:w1,rotate:w1,skewX:r=>oo(Math.atan(r[4])),skewY:r=>oo(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function i0(r){return r.includes("scale")?1:0}function r0(r,e){if(!r||r==="none")return i0(e);const t=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,i;if(t)s=q5,i=t;else{const o=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=Y5,i=o}if(!i)return i0(e);const n=s[e],a=i[1].split(",").map(X5);return typeof n=="function"?n(a):a[n]}const H5=(r,e)=>{const{transform:t="none"}=getComputedStyle(r);return r0(t,e)};function X5(r){return parseFloat(r.trim())}const il=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],rl=new Set(il),S1=r=>r===sl||r===Qe,K5=new Set(["x","y","z"]),Q5=il.filter(r=>!K5.has(r));function J5(r){const e=[];return Q5.forEach(t=>{const s=r.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const go={width:({x:r},{paddingLeft:e="0",paddingRight:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),height:({y:r},{paddingTop:e="0",paddingBottom:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),top:(r,{top:e})=>parseFloat(e),left:(r,{left:e})=>parseFloat(e),bottom:({y:r},{top:e})=>parseFloat(e)+(r.max-r.min),right:({x:r},{left:e})=>parseFloat(e)+(r.max-r.min),x:(r,{transform:e})=>r0(e,"x"),y:(r,{transform:e})=>r0(e,"y")};go.translateX=go.x;go.translateY=go.y;const yo=new Set;let n0=!1,a0=!1,o0=!1;function FA(){if(a0){const r=Array.from(yo).filter(s=>s.needsMeasurement),e=new Set(r.map(s=>s.element)),t=new Map;e.forEach(s=>{const i=J5(s);i.length&&(t.set(s,i),s.render())}),r.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const i=t.get(s);i&&i.forEach(([n,a])=>{s.getValue(n)?.set(a)})}),r.forEach(s=>s.measureEndState()),r.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}a0=!1,n0=!1,yo.forEach(r=>r.complete(o0)),yo.clear()}function BA(){yo.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(a0=!0)})}function Z5(){o0=!0,BA(),FA(),o0=!1}let gx=class{constructor(e,t,s,i,n,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=n,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(yo.add(this),n0||(n0=!0,Ut.read(BA),Ut.resolveKeyframes(FA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;if(e[0]===null){const n=i?.get(),a=e[e.length-1];if(n!==void 0)e[0]=n;else if(s&&t){const o=s.readValue(t,a);o!=null&&(e[0]=o)}e[0]===void 0&&(e[0]=a),i&&n===void 0&&i.set(e[0])}W5(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),yo.delete(this)}cancel(){this.state==="scheduled"&&(yo.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}};const e3=r=>r.startsWith("--");function t3(r,e,t){e3(e)?r.style.setProperty(e,t):r.style[e]=t}const s3=ix(()=>window.ScrollTimeline!==void 0),i3={};function r3(r,e){const t=ix(r);return()=>i3[e]??t()}const LA=r3(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Jl=([r,e,t,s])=>`cubic-bezier(${r}, ${e}, ${t}, ${s})`,T1={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Jl([0,.65,.55,1]),circOut:Jl([.55,0,1,.45]),backIn:Jl([.31,.01,.66,-.59]),backOut:Jl([.33,1.53,.69,.99])};function OA(r,e){if(r)return typeof r=="function"?LA()?RA(r,e):"ease-out":CA(r)?Jl(r):Array.isArray(r)?r.map(t=>OA(t,e)||T1.easeOut):T1[r]}function n3(r,e,t,{delay:s=0,duration:i=300,repeat:n=0,repeatType:a="loop",ease:o="easeOut",times:l}={},d=void 0){const u={[e]:t};l&&(u.offset=l);const h=OA(o,i);Array.isArray(h)&&(u.easing=h);const p={delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:n+1,direction:a==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),r.animate(u,p)}function $A(r){return typeof r=="function"&&"applyToOptions"in r}function a3({type:r,...e}){return $A(r)&&LA()?r.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}let o3=class extends mx{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:i,pseudoElement:n,allowFlatten:a=!1,finalKeyframe:o,onComplete:l}=e;this.isPseudoElement=!!n,this.allowFlatten=a,this.options=e,sx(typeof e.type!="string");const d=a3(e);this.animation=n3(t,s,i,d,n),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!n){const u=px(i,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(u):t3(t,s,u),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return or(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+or(e)}get time(){return or(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Vr(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&s3()?(this.animation.timeline=e,mr):t(this)}};const zA={anticipate:bA,backInOut:xA,circInOut:wA};function c3(r){return r in zA}function l3(r){typeof r.ease=="string"&&c3(r.ease)&&(r.ease=zA[r.ease])}const A1=10;let d3=class extends o3{constructor(e){l3(e),DA(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:i,element:n,...a}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const o=new fx({...a,autoplay:!1}),l=Vr(this.finishedTime??this.time);t.setWithVelocity(o.sample(l-A1).value,o.sample(l).value,A1),o.stop()}};const j1=(r,e)=>e==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(ga.test(r)||r==="0")&&!r.startsWith("url("));function u3(r){const e=r[0];if(r.length===1)return!0;for(let t=0;t<r.length;t++)if(r[t]!==e)return!0}function h3(r,e,t,s){const i=r[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const n=r[r.length-1],a=j1(i,e),o=j1(n,e);return!a||!o?!1:u3(r)||(t==="spring"||$A(t))&&s}function c0(r){r.duration=0,r.type="keyframes"}const p3=new Set(["opacity","clipPath","filter","transform"]),m3=ix(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function f3(r){const{motionValue:e,name:t,repeatDelay:s,repeatType:i,damping:n,type:a}=r;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:d}=e.owner.getProps();return m3()&&t&&p3.has(t)&&(t!=="transform"||!d)&&!l&&!s&&i!=="mirror"&&n!==0&&a!=="inertia"}const g3=40;let y3=class extends mx{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:n=0,repeatType:a="loop",keyframes:o,name:l,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Ai.now();const p={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:n,repeatType:a,name:l,motionValue:d,element:u,...h},m=u?.KeyframeResolver||gx;this.keyframeResolver=new m(o,(f,g,y)=>this.onKeyframesResolved(f,g,p,!y),l,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,i){this.keyframeResolver=void 0;const{name:n,type:a,velocity:o,delay:l,isHandoff:d,onUpdate:u}=s;this.resolvedAt=Ai.now(),h3(e,n,a,o)||((Sn.instantAnimations||!l)&&u?.(px(e,s,t)),e[0]=e[e.length-1],c0(s),s.repeat=0);const p={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>g3?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},m=!d&&f3(p)?new d3({...p,element:p.motionValue.owner.current}):new fx(p);m.finished.then(()=>this.notifyFinished()).catch(mr),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Z5()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}};const x3=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function b3(r){const e=x3.exec(r);if(!e)return[,];const[,t,s,i]=e;return[`--${t??s}`,i]}function VA(r,e,t=1){const[s,i]=b3(r);if(!s)return;const n=window.getComputedStyle(e).getPropertyValue(s);if(n){const a=n.trim();return dA(a)?parseFloat(a):a}return cx(i)?VA(i,e,t+1):i}function yx(r,e){return r?.[e]??r?.default??r}const UA=new Set(["width","height","top","left","right","bottom",...il]),v3={test:r=>r==="auto",parse:r=>r},GA=r=>e=>e.test(r),WA=[sl,Qe,Ur,Qn,u5,d5,v3],_1=r=>WA.find(GA(r));function w3(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||hA(r):!0}const k3=new Set(["brightness","contrast","saturate","opacity"]);function C3(r){const[e,t]=r.slice(0,-1).split("(");if(e==="drop-shadow")return r;const[s]=t.match(lx)||[];if(!s)return r;const i=t.replace(s,"");let n=k3.has(e)?1:0;return s!==t&&(n*=100),e+"("+n+i+")"}const S3=/\b([a-z-]*)\(.*?\)/gu,l0={...ga,getAnimatableNone:r=>{const e=r.match(S3);return e?e.map(C3).join(" "):r}},E1={...sl,transform:Math.round},T3={rotate:Qn,rotateX:Qn,rotateY:Qn,rotateZ:Qn,scale:Bu,scaleX:Bu,scaleY:Bu,scaleZ:Bu,skew:Qn,skewX:Qn,skewY:Qn,distance:Qe,translateX:Qe,translateY:Qe,translateZ:Qe,x:Qe,y:Qe,z:Qe,perspective:Qe,transformPerspective:Qe,opacity:Ld,originX:g1,originY:g1,originZ:Qe},xx={borderWidth:Qe,borderTopWidth:Qe,borderRightWidth:Qe,borderBottomWidth:Qe,borderLeftWidth:Qe,borderRadius:Qe,radius:Qe,borderTopLeftRadius:Qe,borderTopRightRadius:Qe,borderBottomRightRadius:Qe,borderBottomLeftRadius:Qe,width:Qe,maxWidth:Qe,height:Qe,maxHeight:Qe,top:Qe,right:Qe,bottom:Qe,left:Qe,padding:Qe,paddingTop:Qe,paddingRight:Qe,paddingBottom:Qe,paddingLeft:Qe,margin:Qe,marginTop:Qe,marginRight:Qe,marginBottom:Qe,marginLeft:Qe,backgroundPositionX:Qe,backgroundPositionY:Qe,...T3,zIndex:E1,fillOpacity:Ld,strokeOpacity:Ld,numOctaves:E1},A3={...xx,color:fs,backgroundColor:fs,outlineColor:fs,fill:fs,stroke:fs,borderColor:fs,borderTopColor:fs,borderRightColor:fs,borderBottomColor:fs,borderLeftColor:fs,filter:l0,WebkitFilter:l0},YA=r=>A3[r];function qA(r,e){let t=YA(r);return t!==l0&&(t=ga),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const j3=new Set(["auto","none","0"]);function _3(r,e,t){let s=0,i;for(;s<r.length&&!i;){const n=r[s];typeof n=="string"&&!j3.has(n)&&Od(n).values.length&&(i=r[s]),s++}if(i&&t)for(const n of e)r[n]=qA(t,i)}let E3=class extends gx{constructor(e,t,s,i,n){super(e,t,s,i,n,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let d=e[l];if(typeof d=="string"&&(d=d.trim(),cx(d))){const u=VA(d,t.current);u!==void 0&&(e[l]=u),l===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!UA.has(s)||e.length!==2)return;const[i,n]=e,a=_1(i),o=_1(n);if(a!==o)if(S1(a)&&S1(o))for(let l=0;l<e.length;l++){const d=e[l];typeof d=="string"&&(e[l]=parseFloat(d))}else go[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let i=0;i<e.length;i++)(e[i]===null||w3(e[i]))&&s.push(i);s.length&&_3(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=go[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(s,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const n=s.length-1,a=s[n];s[n]=go[t](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,l])=>{e.getValue(o).set(l)}),this.resolveNoneKeyframes()}};function M3(r,e,t){if(r instanceof EventTarget)return[r];if(typeof r=="string"){let s=document;const i=t?.[r]??s.querySelectorAll(r);return i?Array.from(i):[]}return Array.from(r)}const HA=(r,e)=>e&&typeof r=="number"?e.transform(r):r;function XA(r){return uA(r)&&"offsetHeight"in r}const M1=30,P3=r=>!isNaN(parseFloat(r));let N3=class{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const i=Ai.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const n of this.dependents)n.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=Ai.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=P3(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new rx);const s=this.events[e].add(t);return e==="change"?()=>{s(),Ut.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ai.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>M1)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,M1);return pA(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}};function zc(r,e){return new N3(r,e)}const{schedule:bx}=SA(queueMicrotask,!1),kr={x:!1,y:!1};function KA(){return kr.x||kr.y}function R3(r){return r==="x"||r==="y"?kr[r]?null:(kr[r]=!0,()=>{kr[r]=!1}):kr.x||kr.y?null:(kr.x=kr.y=!0,()=>{kr.x=kr.y=!1})}function QA(r,e){const t=M3(r),s=new AbortController,i={passive:!0,...e,signal:s.signal};return[t,i,()=>s.abort()]}function P1(r){return!(r.pointerType==="touch"||KA())}function I3(r,e,t={}){const[s,i,n]=QA(r,t),a=o=>{if(!P1(o))return;const{target:l}=o,d=e(l,o);if(typeof d!="function"||!l)return;const u=h=>{P1(h)&&(d(h),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,i)};return s.forEach(o=>{o.addEventListener("pointerenter",a,i)}),n}const JA=(r,e)=>e?r===e?!0:JA(r,e.parentElement):!1,vx=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,D3=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function F3(r){return D3.has(r.tagName)||r.tabIndex!==-1}const Ah=new WeakSet;function N1(r){return e=>{e.key==="Enter"&&r(e)}}function $m(r,e){r.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const B3=(r,e)=>{const t=r.currentTarget;if(!t)return;const s=N1(()=>{if(Ah.has(t))return;$m(t,"down");const i=N1(()=>{$m(t,"up")}),n=()=>$m(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",n,e)});t.addEventListener("keydown",s,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",s),e)};function R1(r){return vx(r)&&!KA()}function L3(r,e,t={}){const[s,i,n]=QA(r,t),a=o=>{const l=o.currentTarget;if(!R1(o))return;Ah.add(l);const d=e(l,o),u=(m,f)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),Ah.has(l)&&Ah.delete(l),R1(m)&&typeof d=="function"&&d(m,{success:f})},h=m=>{u(m,l===window||l===document||t.useGlobalTarget||JA(l,m.target))},p=m=>{u(m,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",p,i)};return s.forEach(o=>{(t.useGlobalTarget?window:o).addEventListener("pointerdown",a,i),XA(o)&&(o.addEventListener("focus",d=>B3(d,i)),!F3(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),n}function ZA(r){return uA(r)&&"ownerSVGElement"in r}function O3(r){return ZA(r)&&r.tagName==="svg"}const Js=r=>!!(r&&r.getVelocity),$3=[...WA,fs,ga],z3=r=>$3.find(GA(r)),wx=w.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function I1(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function V3(...r){return e=>{let t=!1;const s=r.map(i=>{const n=I1(i,e);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let i=0;i<s.length;i++){const n=s[i];typeof n=="function"?n():I1(r[i],null)}}}}function U3(...r){return w.useCallback(V3(...r),r)}let G3=class extends w.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=t.offsetParent,i=XA(s)&&s.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=i-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}};function W3({children:r,isPresent:e,anchorX:t,root:s}){const i=w.useId(),n=w.useRef(null),a=w.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=w.useContext(wx),l=U3(n,r?.ref);return w.useInsertionEffect(()=>{const{width:d,height:u,top:h,left:p,right:m}=a.current;if(e||!n.current||!d||!u)return;const f=t==="left"?`left: ${p}`:`right: ${m}`;n.current.dataset.motionPopId=i;const g=document.createElement("style");o&&(g.nonce=o);const y=s??document.head;return y.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${u}px !important;
            ${f}px !important;
            top: ${h}px !important;
          }
        `),()=>{y.contains(g)&&y.removeChild(g)}},[e]),c.jsx(G3,{isPresent:e,childRef:n,sizeRef:a,children:w.cloneElement(r,{ref:l})})}const Y3=({children:r,initial:e,isPresent:t,onExitComplete:s,custom:i,presenceAffectsLayout:n,mode:a,anchorX:o,root:l})=>{const d=Jy(q3),u=w.useId();let h=!0,p=w.useMemo(()=>(h=!1,{id:u,initial:e,isPresent:t,custom:i,onExitComplete:m=>{d.set(m,!0);for(const f of d.values())if(!f)return;s&&s()},register:m=>(d.set(m,!1),()=>d.delete(m))}),[t,d,s]);return n&&h&&(p={...p}),w.useMemo(()=>{d.forEach((m,f)=>d.set(f,!1))},[t]),w.useEffect(()=>{!t&&!d.size&&s&&s()},[t]),a==="popLayout"&&(r=c.jsx(W3,{isPresent:t,anchorX:o,root:l,children:r})),c.jsx(Gp.Provider,{value:p,children:r})};function q3(){return new Map}function ej(r=!0){const e=w.useContext(Gp);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:i}=e,n=w.useId();w.useEffect(()=>{if(r)return i(n)},[r]);const a=w.useCallback(()=>r&&s&&s(n),[n,s,r]);return!t&&s?[!1,a]:[!0]}const Lu=r=>r.key||"";function D1(r){const e=[];return w.Children.forEach(r,t=>{w.isValidElement(t)&&e.push(t)}),e}const kx=({children:r,custom:e,initial:t=!0,onExitComplete:s,presenceAffectsLayout:i=!0,mode:n="sync",propagate:a=!1,anchorX:o="left",root:l})=>{const[d,u]=ej(a),h=w.useMemo(()=>D1(r),[r]),p=a&&!d?[]:h.map(Lu),m=w.useRef(!0),f=w.useRef(h),g=Jy(()=>new Map),[y,x]=w.useState(h),[v,b]=w.useState(h);lA(()=>{m.current=!1,f.current=h;for(let C=0;C<v.length;C++){const A=Lu(v[C]);p.includes(A)?g.delete(A):g.get(A)!==!0&&g.set(A,!1)}},[v,p.length,p.join("-")]);const S=[];if(h!==y){let C=[...h];for(let A=0;A<v.length;A++){const T=v[A],j=Lu(T);p.includes(j)||(C.splice(A,0,T),S.push(T))}return n==="wait"&&S.length&&(C=S),b(D1(C)),x(h),null}const{forceRender:k}=w.useContext(Qy);return c.jsx(c.Fragment,{children:v.map(C=>{const A=Lu(C),T=a&&!d?!1:h===v||p.includes(A),j=()=>{if(g.has(A))g.set(A,!0);else return;let _=!0;g.forEach(M=>{M||(_=!1)}),_&&(k?.(),b(f.current),a&&u?.(),s&&s())};return c.jsx(Y3,{isPresent:T,initial:!m.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:n,root:l,onExitComplete:T?void 0:j,anchorX:o,children:C},A)})})},tj=w.createContext({strict:!1}),F1={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Vc={};for(const r in F1)Vc[r]={isEnabled:e=>F1[r].some(t=>!!e[t])};function H3(r){for(const e in r)Vc[e]={...Vc[e],...r[e]}}const X3=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function dp(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||X3.has(r)}let sj=r=>!dp(r);function K3(r){typeof r=="function"&&(sj=e=>e.startsWith("on")?!dp(e):r(e))}try{K3(require("@emotion/is-prop-valid").default)}catch{}function Q3(r,e,t){const s={};for(const i in r)i==="values"&&typeof r.values=="object"||(sj(i)||t===!0&&dp(i)||!e&&!dp(i)||r.draggable&&i.startsWith("onDrag"))&&(s[i]=r[i]);return s}const Wp=w.createContext({});function Yp(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function $d(r){return typeof r=="string"||Array.isArray(r)}const Cx=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Sx=["initial",...Cx];function qp(r){return Yp(r.animate)||Sx.some(e=>$d(r[e]))}function ij(r){return!!(qp(r)||r.variants)}function J3(r,e){if(qp(r)){const{initial:t,animate:s}=r;return{initial:t===!1||$d(t)?t:void 0,animate:$d(s)?s:void 0}}return r.inherit!==!1?e:{}}function Z3(r){const{initial:e,animate:t}=J3(r,w.useContext(Wp));return w.useMemo(()=>({initial:e,animate:t}),[B1(e),B1(t)])}function B1(r){return Array.isArray(r)?r.join(" "):r}const zd={};function e4(r){for(const e in r)zd[e]=r[e],ox(e)&&(zd[e].isCSSVariable=!0)}function rj(r,{layout:e,layoutId:t}){return rl.has(r)||r.startsWith("origin")||(e||t!==void 0)&&(!!zd[r]||r==="opacity")}const t4={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},s4=il.length;function i4(r,e,t){let s="",i=!0;for(let n=0;n<s4;n++){const a=il[n],o=r[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||t){const d=HA(o,xx[a]);if(!l){i=!1;const u=t4[a]||a;s+=`${u}(${d}) `}t&&(e[a]=d)}}return s=s.trim(),t?s=t(e,i?"":s):i&&(s="none"),s}function Tx(r,e,t){const{style:s,vars:i,transformOrigin:n}=r;let a=!1,o=!1;for(const l in e){const d=e[l];if(rl.has(l)){a=!0;continue}else if(ox(l)){i[l]=d;continue}else{const u=HA(d,xx[l]);l.startsWith("origin")?(o=!0,n[l]=u):s[l]=u}}if(e.transform||(a||t?s.transform=i4(e,r.transform,t):s.transform&&(s.transform="none")),o){const{originX:l="50%",originY:d="50%",originZ:u=0}=n;s.transformOrigin=`${l} ${d} ${u}`}}const Ax=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function nj(r,e,t){for(const s in e)!Js(e[s])&&!rj(s,t)&&(r[s]=e[s])}function r4({transformTemplate:r},e){return w.useMemo(()=>{const t=Ax();return Tx(t,e,r),Object.assign({},t.vars,t.style)},[e])}function n4(r,e){const t=r.style||{},s={};return nj(s,t,r),Object.assign(s,r4(r,e)),s}function a4(r,e){const t={},s=n4(r,e);return r.drag&&r.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(t.tabIndex=0),t.style=s,t}const o4={offset:"stroke-dashoffset",array:"stroke-dasharray"},c4={offset:"strokeDashoffset",array:"strokeDasharray"};function l4(r,e,t=1,s=0,i=!0){r.pathLength=1;const n=i?o4:c4;r[n.offset]=Qe.transform(-s);const a=Qe.transform(e),o=Qe.transform(t);r[n.array]=`${a} ${o}`}function aj(r,{attrX:e,attrY:t,attrScale:s,pathLength:i,pathSpacing:n=1,pathOffset:a=0,...o},l,d,u){if(Tx(r,o,d),l){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:h,style:p}=r;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),t!==void 0&&(h.y=t),s!==void 0&&(h.scale=s),i!==void 0&&l4(h,i,n,a,!1)}const oj=()=>({...Ax(),attrs:{}}),cj=r=>typeof r=="string"&&r.toLowerCase()==="svg";function d4(r,e,t,s){const i=w.useMemo(()=>{const n=oj();return aj(n,e,cj(s),r.transformTemplate,r.style),{...n.attrs,style:{...n.style}}},[e]);if(r.style){const n={};nj(n,r.style,r),i.style={...n,...i.style}}return i}const u4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function jx(r){return typeof r!="string"||r.includes("-")?!1:!!(u4.indexOf(r)>-1||/[A-Z]/u.test(r))}function h4(r,e,t,{latestValues:s},i,n=!1){const o=(jx(r)?d4:a4)(e,s,i,r),l=Q3(e,typeof r=="string",n),d=r!==w.Fragment?{...l,...o,ref:t}:{},{children:u}=e,h=w.useMemo(()=>Js(u)?u.get():u,[u]);return w.createElement(r,{...d,children:h})}function L1(r){const e=[{},{}];return r?.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function _x(r,e,t,s){if(typeof e=="function"){const[i,n]=L1(s);e=e(t!==void 0?t:r.custom,i,n)}if(typeof e=="string"&&(e=r.variants&&r.variants[e]),typeof e=="function"){const[i,n]=L1(s);e=e(t!==void 0?t:r.custom,i,n)}return e}function jh(r){return Js(r)?r.get():r}function p4({scrapeMotionValuesFromProps:r,createRenderState:e},t,s,i){return{latestValues:m4(t,s,i,r),renderState:e()}}function m4(r,e,t,s){const i={},n=s(r,{});for(const p in n)i[p]=jh(n[p]);let{initial:a,animate:o}=r;const l=qp(r),d=ij(r);e&&d&&!l&&r.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let u=t?t.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!Yp(h)){const p=Array.isArray(h)?h:[h];for(let m=0;m<p.length;m++){const f=_x(r,p[m]);if(f){const{transitionEnd:g,transition:y,...x}=f;for(const v in x){let b=x[v];if(Array.isArray(b)){const S=u?b.length-1:0;b=b[S]}b!==null&&(i[v]=b)}for(const v in g)i[v]=g[v]}}}return i}const lj=r=>(e,t)=>{const s=w.useContext(Wp),i=w.useContext(Gp),n=()=>p4(r,e,s,i);return t?n():Jy(n)};function Ex(r,e,t){const{style:s}=r,i={};for(const n in s)(Js(s[n])||e.style&&Js(e.style[n])||rj(n,r)||t?.getValue(n)?.liveStyle!==void 0)&&(i[n]=s[n]);return i}const f4=lj({scrapeMotionValuesFromProps:Ex,createRenderState:Ax});function dj(r,e,t){const s=Ex(r,e,t);for(const i in r)if(Js(r[i])||Js(e[i])){const n=il.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[n]=r[i]}return s}const g4=lj({scrapeMotionValuesFromProps:dj,createRenderState:oj}),y4=Symbol.for("motionComponentSymbol");function cc(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function x4(r,e,t){return w.useCallback(s=>{s&&r.onMount&&r.onMount(s),e&&(s?e.mount(s):e.unmount()),t&&(typeof t=="function"?t(s):cc(t)&&(t.current=s))},[e])}const Mx=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),b4="framerAppearId",uj="data-"+Mx(b4),hj=w.createContext({});function v4(r,e,t,s,i){const{visualElement:n}=w.useContext(Wp),a=w.useContext(tj),o=w.useContext(Gp),l=w.useContext(wx).reducedMotion,d=w.useRef(null);s=s||a.renderer,!d.current&&s&&(d.current=s(r,{visualState:e,parent:n,props:t,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:l}));const u=d.current,h=w.useContext(hj);u&&!u.projection&&i&&(u.type==="html"||u.type==="svg")&&w4(d.current,t,i,h);const p=w.useRef(!1);w.useInsertionEffect(()=>{u&&p.current&&u.update(t,o)});const m=t[uj],f=w.useRef(!!m&&!window.MotionHandoffIsComplete?.(m)&&window.MotionHasOptimisedAnimation?.(m));return lA(()=>{u&&(p.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),f.current&&u.animationState&&u.animationState.animateChanges())}),w.useEffect(()=>{u&&(!f.current&&u.animationState&&u.animationState.animateChanges(),f.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(m)}),f.current=!1),u.enteringChildren=void 0)}),u}function w4(r,e,t,s){const{layoutId:i,layout:n,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:d,layoutCrossfade:u}=e;r.projection=new t(r.latestValues,e["data-framer-portal-id"]?void 0:pj(r.parent)),r.projection.setOptions({layoutId:i,layout:n,alwaysMeasureLayout:!!a||o&&cc(o),visualElement:r,animationType:typeof n=="string"?n:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:l,layoutRoot:d})}function pj(r){if(r)return r.options.allowProjection!==!1?r.projection:pj(r.parent)}function zm(r,{forwardMotionProps:e=!1}={},t,s){t&&H3(t);const i=jx(r)?g4:f4;function n(o,l){let d;const u={...w.useContext(wx),...o,layoutId:k4(o)},{isStatic:h}=u,p=Z3(o),m=i(o,h);if(!h&&Zy){C4();const f=S4(u);d=f.MeasureLayout,p.visualElement=v4(r,m,u,s,f.ProjectionNode)}return c.jsxs(Wp.Provider,{value:p,children:[d&&p.visualElement?c.jsx(d,{visualElement:p.visualElement,...u}):null,h4(r,o,x4(m,p.visualElement,l),m,h,e)]})}n.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const a=w.forwardRef(n);return a[y4]=r,a}function k4({layoutId:r}){const e=w.useContext(Qy).id;return e&&r!==void 0?e+"-"+r:r}function C4(r,e){w.useContext(tj).strict}function S4(r){const{drag:e,layout:t}=Vc;if(!e&&!t)return{};const s={...e,...t};return{MeasureLayout:e?.isEnabled(r)||t?.isEnabled(r)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function T4(r,e){if(typeof Proxy>"u")return zm;const t=new Map,s=(n,a)=>zm(n,a,r,e),i=(n,a)=>s(n,a);return new Proxy(i,{get:(n,a)=>a==="create"?s:(t.has(a)||t.set(a,zm(a,void 0,r,e)),t.get(a))})}function mj({top:r,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:r,max:s}}}function A4({x:r,y:e}){return{top:e.min,right:r.max,bottom:e.max,left:r.min}}function j4(r,e){if(!e)return r;const t=e({x:r.left,y:r.top}),s=e({x:r.right,y:r.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function Vm(r){return r===void 0||r===1}function d0({scale:r,scaleX:e,scaleY:t}){return!Vm(r)||!Vm(e)||!Vm(t)}function to(r){return d0(r)||fj(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function fj(r){return O1(r.x)||O1(r.y)}function O1(r){return r&&r!=="0%"}function up(r,e,t){const s=r-t,i=e*s;return t+i}function $1(r,e,t,s,i){return i!==void 0&&(r=up(r,i,s)),up(r,t,s)+e}function u0(r,e=0,t=1,s,i){r.min=$1(r.min,e,t,s,i),r.max=$1(r.max,e,t,s,i)}function gj(r,{x:e,y:t}){u0(r.x,e.translate,e.scale,e.originPoint),u0(r.y,t.translate,t.scale,t.originPoint)}const z1=.999999999999,V1=1.0000000000001;function _4(r,e,t,s=!1){const i=t.length;if(!i)return;e.x=e.y=1;let n,a;for(let o=0;o<i;o++){n=t[o],a=n.projectionDelta;const{visualElement:l}=n.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&n.options.layoutScroll&&n.scroll&&n!==n.root&&dc(r,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,gj(r,a)),s&&to(n.latestValues)&&dc(r,n.latestValues))}e.x<V1&&e.x>z1&&(e.x=1),e.y<V1&&e.y>z1&&(e.y=1)}function lc(r,e){r.min=r.min+e,r.max=r.max+e}function U1(r,e,t,s,i=.5){const n=Kt(r.min,r.max,i);u0(r,e,t,n,s)}function dc(r,e){U1(r.x,e.x,e.scaleX,e.scale,e.originX),U1(r.y,e.y,e.scaleY,e.scale,e.originY)}function yj(r,e){return mj(j4(r.getBoundingClientRect(),e))}function E4(r,e,t){const s=yj(r,t),{scroll:i}=e;return i&&(lc(s.x,i.offset.x),lc(s.y,i.offset.y)),s}const G1=()=>({translate:0,scale:1,origin:0,originPoint:0}),uc=()=>({x:G1(),y:G1()}),W1=()=>({min:0,max:0}),cs=()=>({x:W1(),y:W1()}),h0={current:null},xj={current:!1};function M4(){if(xj.current=!0,!!Zy)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),e=()=>h0.current=r.matches;r.addEventListener("change",e),e()}else h0.current=!1}const P4=new WeakMap;function N4(r,e,t){for(const s in e){const i=e[s],n=t[s];if(Js(i))r.addValue(s,i);else if(Js(n))r.addValue(s,zc(i,{owner:r}));else if(n!==i)if(r.hasValue(s)){const a=r.getValue(s);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=r.getStaticValue(s);r.addValue(s,zc(a!==void 0?a:i,{owner:r}))}}for(const s in t)e[s]===void 0&&r.removeValue(s);return e}const Y1=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let R4=class{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:n,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=gx,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=Ai.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Ut.render(this.render,!1,!0))};const{latestValues:l,renderState:d}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=d,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=o,this.blockInitialAnimation=!!n,this.isControllingVariants=qp(t),this.isVariantNode=ij(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const p in h){const m=h[p];l[p]!==void 0&&Js(m)&&m.set(l[p])}}mount(e){this.current=e,P4.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),xj.current||M4(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:h0.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),fa(this.notifyUpdate),fa(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=rl.has(e);s&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Ut.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let n;window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),n&&n(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in Vc){const t=Vc[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):cs()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<Y1.length;s++){const i=Y1[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const n="on"+i,a=e[n];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=N4(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=zc(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(dA(s)||hA(s))?s=parseFloat(s):!z3(s)&&ga.test(t)&&(s=qA(e,t)),this.setBaseTarget(e,Js(s)?s.get():s)),Js(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if(typeof t=="string"||typeof t=="object"){const n=_x(this.props,t,this.presenceContext?.custom);n&&(s=n[e])}if(t&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Js(i)?i:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new rx),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){bx.render(this.render)}},bj=class extends R4{constructor(){super(...arguments),this.KeyframeResolver=E3}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Js(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}};function vj(r,{style:e,vars:t},s,i){const n=r.style;let a;for(a in e)n[a]=e[a];i?.applyProjectionStyles(n,s);for(a in t)n.setProperty(a,t[a])}function I4(r){return window.getComputedStyle(r)}let D4=class extends bj{constructor(){super(...arguments),this.type="html",this.renderInstance=vj}readValueFromInstance(e,t){if(rl.has(t))return this.projection?.isProjecting?i0(t):H5(e,t);{const s=I4(e),i=(ox(t)?s.getPropertyValue(t):s[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return yj(e,t)}build(e,t,s){Tx(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Ex(e,t,s)}};const wj=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function F4(r,e,t,s){vj(r,e,void 0,s);for(const i in e.attrs)r.setAttribute(wj.has(i)?i:Mx(i),e.attrs[i])}let B4=class extends bj{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=cs}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(rl.has(t)){const s=YA(t);return s&&s.default||0}return t=wj.has(t)?t:Mx(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return dj(e,t,s)}build(e,t,s){aj(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,i){F4(e,t,s,i)}mount(e){this.isSVGTag=cj(e.tagName),super.mount(e)}};const L4=(r,e)=>jx(r)?new B4(e):new D4(e,{allowProjection:r!==w.Fragment});function Tc(r,e,t){const s=r.getProps();return _x(s,e,t!==void 0?t:s.custom,r)}const p0=r=>Array.isArray(r);function O4(r,e,t){r.hasValue(e)?r.getValue(e).set(t):r.addValue(e,zc(t))}function $4(r){return p0(r)?r[r.length-1]||0:r}function z4(r,e){const t=Tc(r,e);let{transitionEnd:s={},transition:i={},...n}=t||{};n={...n,...s};for(const a in n){const o=$4(n[a]);O4(r,a,o)}}function V4(r){return!!(Js(r)&&r.add)}function m0(r,e){const t=r.getValue("willChange");if(V4(t))return t.add(e);if(!t&&Sn.WillChange){const s=new Sn.WillChange("auto");r.addValue("willChange",s),s.add(e)}}function kj(r){return r.props[uj]}const U4=r=>r!==null;function G4(r,{repeat:e,repeatType:t="loop"},s){const i=r.filter(U4),n=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[n]}const W4={type:"spring",stiffness:500,damping:25,restSpeed:10},Y4=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),q4={type:"keyframes",duration:.8},H4={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},X4=(r,{keyframes:e})=>e.length>2?q4:rl.has(r)?r.startsWith("scale")?Y4(e[1]):W4:H4;function K4({when:r,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:i,repeat:n,repeatType:a,repeatDelay:o,from:l,elapsed:d,...u}){return!!Object.keys(u).length}const Px=(r,e,t,s={},i,n)=>a=>{const o=yx(s,r)||{},l=o.delay||s.delay||0;let{elapsed:d=0}=s;d=d-Vr(l);const u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-d,onUpdate:p=>{e.set(p),o.onUpdate&&o.onUpdate(p)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:r,motionValue:e,element:n?void 0:i};K4(o)||Object.assign(u,X4(r,u)),u.duration&&(u.duration=Vr(u.duration)),u.repeatDelay&&(u.repeatDelay=Vr(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(c0(u),u.delay===0&&(h=!0)),(Sn.instantAnimations||Sn.skipAnimations)&&(h=!0,c0(u),u.delay=0),u.allowFlatten=!o.type&&!o.ease,h&&!n&&e.get()!==void 0){const p=G4(u.keyframes,o);if(p!==void 0){Ut.update(()=>{u.onUpdate(p),u.onComplete()});return}}return o.isSync?new fx(u):new y3(u)};function Q4({protectedKeys:r,needsAnimating:e},t){const s=r.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function Cj(r,e,{delay:t=0,transitionOverride:s,type:i}={}){let{transition:n=r.getDefaultTransition(),transitionEnd:a,...o}=e;s&&(n=s);const l=[],d=i&&r.animationState&&r.animationState.getState()[i];for(const u in o){const h=r.getValue(u,r.latestValues[u]??null),p=o[u];if(p===void 0||d&&Q4(d,u))continue;const m={delay:t,...yx(n||{},u)},f=h.get();if(f!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===f&&!m.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const x=kj(r);if(x){const v=window.MotionHandoffAnimation(x,u,Ut);v!==null&&(m.startTime=v,g=!0)}}m0(r,u),h.start(Px(u,h,p,r.shouldReduceMotion&&UA.has(u)?{type:!1}:m,r,g));const y=h.animation;y&&l.push(y)}return a&&Promise.all(l).then(()=>{Ut.update(()=>{a&&z4(r,a)})}),l}function Sj(r,e,t,s=0,i=1){const n=Array.from(r).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=r.size,o=(a-1)*s;return typeof t=="function"?t(n,a):i===1?n*s:o-n*s}function f0(r,e,t={}){const s=Tc(r,e,t.type==="exit"?r.presenceContext?.custom:void 0);let{transition:i=r.getDefaultTransition()||{}}=s||{};t.transitionOverride&&(i=t.transitionOverride);const n=s?()=>Promise.all(Cj(r,s,t)):()=>Promise.resolve(),a=r.variantChildren&&r.variantChildren.size?(l=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=i;return J4(r,e,l,d,u,h,t)}:()=>Promise.resolve(),{when:o}=i;if(o){const[l,d]=o==="beforeChildren"?[n,a]:[a,n];return l().then(()=>d())}else return Promise.all([n(),a(t.delay)])}function J4(r,e,t=0,s=0,i=0,n=1,a){const o=[];for(const l of r.variantChildren)l.notify("AnimationStart",e),o.push(f0(l,e,{...a,delay:t+(typeof s=="function"?0:s)+Sj(r.variantChildren,l,s,i,n)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(o)}function Z4(r,e,t={}){r.notify("AnimationStart",e);let s;if(Array.isArray(e)){const i=e.map(n=>f0(r,n,t));s=Promise.all(i)}else if(typeof e=="string")s=f0(r,e,t);else{const i=typeof e=="function"?Tc(r,e,t.custom):e;s=Promise.all(Cj(r,i,t))}return s.then(()=>{r.notify("AnimationComplete",e)})}function Tj(r,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==r.length)return!1;for(let s=0;s<t;s++)if(e[s]!==r[s])return!1;return!0}const eF=Sx.length;function Aj(r){if(!r)return;if(!r.isControllingVariants){const t=r.parent?Aj(r.parent)||{}:{};return r.props.initial!==void 0&&(t.initial=r.props.initial),t}const e={};for(let t=0;t<eF;t++){const s=Sx[t],i=r.props[s];($d(i)||i===!1)&&(e[s]=i)}return e}const tF=[...Cx].reverse(),sF=Cx.length;function iF(r){return e=>Promise.all(e.map(({animation:t,options:s})=>Z4(r,t,s)))}function rF(r){let e=iF(r),t=q1(),s=!0;const i=l=>(d,u)=>{const h=Tc(r,u,l==="exit"?r.presenceContext?.custom:void 0);if(h){const{transition:p,transitionEnd:m,...f}=h;d={...d,...f,...m}}return d};function n(l){e=l(r)}function a(l){const{props:d}=r,u=Aj(r.parent)||{},h=[],p=new Set;let m={},f=1/0;for(let y=0;y<sF;y++){const x=tF[y],v=t[x],b=d[x]!==void 0?d[x]:u[x],S=$d(b),k=x===l?v.isActive:null;k===!1&&(f=y);let C=b===u[x]&&b!==d[x]&&S;if(C&&s&&r.manuallyAnimateOnMount&&(C=!1),v.protectedKeys={...m},!v.isActive&&k===null||!b&&!v.prevProp||Yp(b)||typeof b=="boolean")continue;const A=nF(v.prevProp,b);let T=A||x===l&&v.isActive&&!C&&S||y>f&&S,j=!1;const _=Array.isArray(b)?b:[b];let M=_.reduce(i(x),{});k===!1&&(M={});const{prevResolvedValues:E={}}=v,D={...E,...M},R=F=>{T=!0,p.has(F)&&(j=!0,p.delete(F)),v.needsAnimating[F]=!0;const I=r.getValue(F);I&&(I.liveStyle=!1)};for(const F in D){const I=M[F],K=E[F];if(m.hasOwnProperty(F))continue;let ee=!1;p0(I)&&p0(K)?ee=!Tj(I,K):ee=I!==K,ee?I!=null?R(F):p.add(F):I!==void 0&&p.has(F)?R(F):v.protectedKeys[F]=!0}v.prevProp=b,v.prevResolvedValues=M,v.isActive&&(m={...m,...M}),s&&r.blockInitialAnimation&&(T=!1);const B=C&&A;T&&(!B||j)&&h.push(..._.map(F=>{const I={type:x};if(typeof F=="string"&&s&&!B&&r.manuallyAnimateOnMount&&r.parent){const{parent:K}=r,ee=Tc(K,F);if(K.enteringChildren&&ee){const{delayChildren:P}=ee.transition||{};I.delay=Sj(K.enteringChildren,r,P)}}return{animation:F,options:I}}))}if(p.size){const y={};if(typeof d.initial!="boolean"){const x=Tc(r,Array.isArray(d.initial)?d.initial[0]:d.initial);x&&x.transition&&(y.transition=x.transition)}p.forEach(x=>{const v=r.getBaseTarget(x),b=r.getValue(x);b&&(b.liveStyle=!0),y[x]=v??null}),h.push({animation:y})}let g=!!h.length;return s&&(d.initial===!1||d.initial===d.animate)&&!r.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(h):Promise.resolve()}function o(l,d){if(t[l].isActive===d)return Promise.resolve();r.variantChildren?.forEach(h=>h.animationState?.setActive(l,d)),t[l].isActive=d;const u=a(l);for(const h in t)t[h].protectedKeys={};return u}return{animateChanges:a,setActive:o,setAnimateFunction:n,getState:()=>t,reset:()=>{t=q1()}}}function nF(r,e){return typeof e=="string"?e!==r:Array.isArray(e)?!Tj(e,r):!1}function $a(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function q1(){return{animate:$a(!0),whileInView:$a(),whileHover:$a(),whileTap:$a(),whileDrag:$a(),whileFocus:$a(),exit:$a()}}let Aa=class{constructor(e){this.isMounted=!1,this.node=e}update(){}},aF=class extends Aa{constructor(e){super(e),e.animationState||(e.animationState=rF(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Yp(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}},oF=0,cF=class extends Aa{constructor(){super(...arguments),this.id=oF++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}};const lF={animation:{Feature:aF},exit:{Feature:cF}};function Vd(r,e,t,s={passive:!0}){return r.addEventListener(e,t,s),()=>r.removeEventListener(e,t)}function gu(r){return{point:{x:r.pageX,y:r.pageY}}}const dF=r=>e=>vx(e)&&r(e,gu(e));function gd(r,e,t,s){return Vd(r,e,dF(t),s)}const jj=1e-4,uF=1-jj,hF=1+jj,_j=.01,pF=0-_j,mF=0+_j;function li(r){return r.max-r.min}function fF(r,e,t){return Math.abs(r-e)<=t}function H1(r,e,t,s=.5){r.origin=s,r.originPoint=Kt(e.min,e.max,r.origin),r.scale=li(t)/li(e),r.translate=Kt(t.min,t.max,r.origin)-r.originPoint,(r.scale>=uF&&r.scale<=hF||isNaN(r.scale))&&(r.scale=1),(r.translate>=pF&&r.translate<=mF||isNaN(r.translate))&&(r.translate=0)}function yd(r,e,t,s){H1(r.x,e.x,t.x,s?s.originX:void 0),H1(r.y,e.y,t.y,s?s.originY:void 0)}function X1(r,e,t){r.min=t.min+e.min,r.max=r.min+li(e)}function gF(r,e,t){X1(r.x,e.x,t.x),X1(r.y,e.y,t.y)}function K1(r,e,t){r.min=e.min-t.min,r.max=r.min+li(e)}function xd(r,e,t){K1(r.x,e.x,t.x),K1(r.y,e.y,t.y)}function tr(r){return[r("x"),r("y")]}const Ej=({current:r})=>r?r.ownerDocument.defaultView:null,Q1=(r,e)=>Math.abs(r-e);function yF(r,e){const t=Q1(r.x,e.x),s=Q1(r.y,e.y);return Math.sqrt(t**2+s**2)}let Mj=class{constructor(e,t,{transformPagePoint:s,contextWindow:i=window,dragSnapToOrigin:n=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=Gm(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,f=yF(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!f)return;const{point:g}=p,{timestamp:y}=Fs;this.history.push({...g,timestamp:y});const{onStart:x,onMove:v}=this.handlers;m||(x&&x(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),v&&v(this.lastMoveEvent,p)},this.handlePointerMove=(p,m)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=Um(m,this.transformPagePoint),Ut.update(this.updatePoint,!0)},this.handlePointerUp=(p,m)=>{this.end();const{onEnd:f,onSessionEnd:g,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const x=Gm(p.type==="pointercancel"?this.lastMoveEventInfo:Um(m,this.transformPagePoint),this.history);this.startEvent&&f&&f(p,x),g&&g(p,x)},!vx(e))return;this.dragSnapToOrigin=n,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=a,this.contextWindow=i||window;const o=gu(e),l=Um(o,this.transformPagePoint),{point:d}=l,{timestamp:u}=Fs;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=t;h&&h(e,Gm(l,this.history)),this.removeListeners=pu(gd(this.contextWindow,"pointermove",this.handlePointerMove),gd(this.contextWindow,"pointerup",this.handlePointerUp),gd(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),fa(this.updatePoint)}};function Um(r,e){return e?{point:e(r.point)}:r}function J1(r,e){return{x:r.x-e.x,y:r.y-e.y}}function Gm({point:r},e){return{point:r,delta:J1(r,Pj(e)),offset:J1(r,xF(e)),velocity:bF(e,.1)}}function xF(r){return r[0]}function Pj(r){return r[r.length-1]}function bF(r,e){if(r.length<2)return{x:0,y:0};let t=r.length-1,s=null;const i=Pj(r);for(;t>=0&&(s=r[t],!(i.timestamp-s.timestamp>Vr(e)));)t--;if(!s)return{x:0,y:0};const n=or(i.timestamp-s.timestamp);if(n===0)return{x:0,y:0};const a={x:(i.x-s.x)/n,y:(i.y-s.y)/n};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function vF(r,{min:e,max:t},s){return e!==void 0&&r<e?r=s?Kt(e,r,s.min):Math.max(r,e):t!==void 0&&r>t&&(r=s?Kt(t,r,s.max):Math.min(r,t)),r}function Z1(r,e,t){return{min:e!==void 0?r.min+e:void 0,max:t!==void 0?r.max+t-(r.max-r.min):void 0}}function wF(r,{top:e,left:t,bottom:s,right:i}){return{x:Z1(r.x,t,i),y:Z1(r.y,e,s)}}function ew(r,e){let t=e.min-r.min,s=e.max-r.max;return e.max-e.min<r.max-r.min&&([t,s]=[s,t]),{min:t,max:s}}function kF(r,e){return{x:ew(r.x,e.x),y:ew(r.y,e.y)}}function CF(r,e){let t=.5;const s=li(r),i=li(e);return i>s?t=Bd(e.min,e.max-s,r.min):s>i&&(t=Bd(r.min,r.max-i,e.min)),Cn(0,1,t)}function SF(r,e){const t={};return e.min!==void 0&&(t.min=e.min-r.min),e.max!==void 0&&(t.max=e.max-r.min),t}const g0=.35;function TF(r=g0){return r===!1?r=0:r===!0&&(r=g0),{x:tw(r,"left","right"),y:tw(r,"top","bottom")}}function tw(r,e,t){return{min:sw(r,e),max:sw(r,t)}}function sw(r,e){return typeof r=="number"?r:r[e]||0}const AF=new WeakMap;let jF=class{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=cs(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const n=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(gu(h).point)},a=(h,p)=>{const{drag:m,dragPropagation:f,onDragStart:g}=this.getProps();if(m&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=R3(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),tr(x=>{let v=this.getAxisMotionValue(x).get()||0;if(Ur.test(v)){const{projection:b}=this.visualElement;if(b&&b.layout){const S=b.layout.layoutBox[x];S&&(v=li(S)*(parseFloat(v)/100))}}this.originPoint[x]=v}),g&&Ut.postRender(()=>g(h,p)),m0(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},o=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:g,onDrag:y}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:x}=p;if(f&&this.currentDirection===null){this.currentDirection=_F(x),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,x),this.updateAxis("y",p.point,x),this.visualElement.render(),y&&y(h,p)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>tr(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Mj(e,{onSessionStart:n,onStart:a,onMove:o,onSessionEnd:l,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:Ej(this.visualElement)})}stop(e,t){const s=e||this.latestPointerEvent,i=t||this.latestPanInfo,n=this.isDragging;if(this.cancel(),!n||!i||!s)return;const{velocity:a}=i;this.startAnimation(a);const{onDragEnd:o}=this.getProps();o&&Ut.postRender(()=>o(s,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!Ou(e,i,this.currentDirection))return;const n=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=vF(a,this.constraints[e],this.elastic[e])),n.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&cc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=wF(s.layoutBox,e):this.constraints=!1,this.elastic=TF(t),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&tr(n=>{this.constraints!==!1&&this.getAxisMotionValue(n)&&(this.constraints[n]=SF(s.layoutBox[n],this.constraints[n]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!cc(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const n=E4(s,i.root,this.visualElement.getTransformPagePoint());let a=kF(i.layout.layoutBox,n);if(t){const o=t(A4(a));this.hasMutatedConstraints=!!o,o&&(a=mj(o))}return a}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:n,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},d=tr(u=>{if(!Ou(u,t,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const p=i?200:1e6,m=i?40:1e7,f={type:"inertia",velocity:s?e[u]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...n,...h};return this.startAxisValueAnimation(u,f)});return Promise.all(d).then(o)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return m0(this.visualElement,e),s.start(Px(e,s,0,t,this.visualElement,!1))}stopAnimation(){tr(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){tr(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){tr(t=>{const{drag:s}=this.getProps();if(!Ou(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,n=this.getAxisMotionValue(t);if(i&&i.layout){const{min:a,max:o}=i.layout.layoutBox[t];n.set(e[t]-Kt(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!cc(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};tr(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();i[a]=CF({min:l,max:l},this.constraints[a])}});const{transformTemplate:n}=this.visualElement.getProps();this.visualElement.current.style.transform=n?n({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),tr(a=>{if(!Ou(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:d}=this.constraints[a];o.set(Kt(l,d,i[a]))})}addListeners(){if(!this.visualElement.current)return;AF.set(this.visualElement,this);const e=this.visualElement.current,t=gd(e,"pointerdown",l=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();cc(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,n=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Ut.read(s);const a=Vd(window,"resize",()=>this.scalePositionWithinConstraints()),o=i.addEventListener("didUpdate",({delta:l,hasLayoutChanged:d})=>{this.isDragging&&d&&(tr(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),t(),n(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:n=!1,dragElastic:a=g0,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:n,dragElastic:a,dragMomentum:o}}};function Ou(r,e,t){return(e===!0||e===r)&&(t===null||t===r)}function _F(r,e=10){let t=null;return Math.abs(r.y)>e?t="y":Math.abs(r.x)>e&&(t="x"),t}let EF=class extends Aa{constructor(e){super(e),this.removeGroupControls=mr,this.removeListeners=mr,this.controls=new jF(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||mr}unmount(){this.removeGroupControls(),this.removeListeners()}};const iw=r=>(e,t)=>{r&&Ut.postRender(()=>r(e,t))};let MF=class extends Aa{constructor(){super(...arguments),this.removePointerDownListener=mr}onPointerDown(e){this.session=new Mj(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ej(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:iw(e),onStart:iw(t),onMove:s,onEnd:(n,a)=>{delete this.session,i&&Ut.postRender(()=>i(n,a))}}}mount(){this.removePointerDownListener=gd(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}};const _h={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function rw(r,e){return e.max===e.min?0:r/(e.max-e.min)*100}const Pl={correct:(r,e)=>{if(!e.target)return r;if(typeof r=="string")if(Qe.test(r))r=parseFloat(r);else return r;const t=rw(r,e.target.x),s=rw(r,e.target.y);return`${t}% ${s}%`}},PF={correct:(r,{treeScale:e,projectionDelta:t})=>{const s=r,i=ga.parse(r);if(i.length>5)return s;const n=ga.createTransformer(r),a=typeof i[0]!="number"?1:0,o=t.x.scale*e.x,l=t.y.scale*e.y;i[0+a]/=o,i[1+a]/=l;const d=Kt(o,l,.5);return typeof i[2+a]=="number"&&(i[2+a]/=d),typeof i[3+a]=="number"&&(i[3+a]/=d),n(i)}};let Wm=!1,NF=class extends w.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:n}=e;e4(RF),n&&(t.group&&t.group.add(n),s&&s.register&&i&&s.register(n),Wm&&n.root.didUpdate(),n.addEventListener("animationComplete",()=>{this.safeToRemove()}),n.setOptions({...n.options,onExitComplete:()=>this.safeToRemove()})),_h.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:n}=this.props,{projection:a}=s;return a&&(a.isPresent=n,Wm=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==n?a.willUpdate():this.safeToRemove(),e.isPresent!==n&&(n?a.promote():a.relegate()||Ut.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),bx.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;Wm=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}};function Nj(r){const[e,t]=ej(),s=w.useContext(Qy);return c.jsx(NF,{...r,layoutGroup:s,switchLayoutGroup:w.useContext(hj),isPresent:e,safeToRemove:t})}const RF={borderRadius:{...Pl,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Pl,borderTopRightRadius:Pl,borderBottomLeftRadius:Pl,borderBottomRightRadius:Pl,boxShadow:PF};function IF(r,e,t){const s=Js(r)?r:zc(r);return s.start(Px("",s,e,t)),s.animation}const DF=(r,e)=>r.depth-e.depth;let FF=class{constructor(){this.children=[],this.isDirty=!1}add(e){ex(this.children,e),this.isDirty=!0}remove(e){tx(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(DF),this.isDirty=!1,this.children.forEach(e)}};function BF(r,e){const t=Ai.now(),s=({timestamp:i})=>{const n=i-t;n>=e&&(fa(s),r(n-e))};return Ut.setup(s,!0),()=>fa(s)}const Rj=["TopLeft","TopRight","BottomLeft","BottomRight"],LF=Rj.length,nw=r=>typeof r=="string"?parseFloat(r):r,aw=r=>typeof r=="number"||Qe.test(r);function OF(r,e,t,s,i,n){i?(r.opacity=Kt(0,t.opacity??1,$F(s)),r.opacityExit=Kt(e.opacity??1,0,zF(s))):n&&(r.opacity=Kt(e.opacity??1,t.opacity??1,s));for(let a=0;a<LF;a++){const o=`border${Rj[a]}Radius`;let l=ow(e,o),d=ow(t,o);if(l===void 0&&d===void 0)continue;l||(l=0),d||(d=0),l===0||d===0||aw(l)===aw(d)?(r[o]=Math.max(Kt(nw(l),nw(d),s),0),(Ur.test(d)||Ur.test(l))&&(r[o]+="%")):r[o]=d}(e.rotate||t.rotate)&&(r.rotate=Kt(e.rotate||0,t.rotate||0,s))}function ow(r,e){return r[e]!==void 0?r[e]:r.borderRadius}const $F=Ij(0,.5,vA),zF=Ij(.5,.95,mr);function Ij(r,e,t){return s=>s<r?0:s>e?1:t(Bd(r,e,s))}function cw(r,e){r.min=e.min,r.max=e.max}function Ki(r,e){cw(r.x,e.x),cw(r.y,e.y)}function lw(r,e){r.translate=e.translate,r.scale=e.scale,r.originPoint=e.originPoint,r.origin=e.origin}function dw(r,e,t,s,i){return r-=e,r=up(r,1/t,s),i!==void 0&&(r=up(r,1/i,s)),r}function VF(r,e=0,t=1,s=.5,i,n=r,a=r){if(Ur.test(e)&&(e=parseFloat(e),e=Kt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=Kt(n.min,n.max,s);r===n&&(o-=e),r.min=dw(r.min,e,t,o,i),r.max=dw(r.max,e,t,o,i)}function uw(r,e,[t,s,i],n,a){VF(r,e[t],e[s],e[i],e.scale,n,a)}const UF=["x","scaleX","originX"],GF=["y","scaleY","originY"];function hw(r,e,t,s){uw(r.x,e,UF,t?t.x:void 0,s?s.x:void 0),uw(r.y,e,GF,t?t.y:void 0,s?s.y:void 0)}function pw(r){return r.translate===0&&r.scale===1}function Dj(r){return pw(r.x)&&pw(r.y)}function mw(r,e){return r.min===e.min&&r.max===e.max}function WF(r,e){return mw(r.x,e.x)&&mw(r.y,e.y)}function fw(r,e){return Math.round(r.min)===Math.round(e.min)&&Math.round(r.max)===Math.round(e.max)}function Fj(r,e){return fw(r.x,e.x)&&fw(r.y,e.y)}function gw(r){return li(r.x)/li(r.y)}function yw(r,e){return r.translate===e.translate&&r.scale===e.scale&&r.originPoint===e.originPoint}let YF=class{constructor(){this.members=[]}add(e){ex(this.members,e),e.scheduleRender()}remove(e){if(tx(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let s;for(let i=t;i>=0;i--){const n=this.members[i];if(n.isPresent!==!1){s=n;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}};function qF(r,e,t){let s="";const i=r.x.translate/e.x,n=r.y.translate/e.y,a=t?.z||0;if((i||n||a)&&(s=`translate3d(${i}px, ${n}px, ${a}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:m,skewY:f}=t;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),p&&(s+=`rotateY(${p}deg) `),m&&(s+=`skewX(${m}deg) `),f&&(s+=`skewY(${f}deg) `)}const o=r.x.scale*e.x,l=r.y.scale*e.y;return(o!==1||l!==1)&&(s+=`scale(${o}, ${l})`),s||"none"}const Ym=["","X","Y","Z"],HF=1e3;let XF=0;function qm(r,e,t,s){const{latestValues:i}=e;i[r]&&(t[r]=i[r],e.setStaticValue(r,0),s&&(s[r]=0))}function Bj(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:e}=r.options;if(!e)return;const t=kj(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:n}=r.options;window.MotionCancelOptimisedAnimation(t,"transform",Ut,!(i||n))}const{parent:s}=r;s&&!s.hasCheckedOptimisedAppear&&Bj(s)}function Lj({attachResizeListener:r,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(a={},o=e?.()){this.id=XF++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(JF),this.nodes.forEach(sB),this.nodes.forEach(iB),this.nodes.forEach(ZF)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new FF)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new rx),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=ZA(a)&&!O3(a),this.instance=a;const{layoutId:o,layout:l,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||o)&&(this.isLayoutDirty=!0),r){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;Ut.read(()=>{h=window.innerWidth}),r(a,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=BF(p,250),_h.hasAnimatedSinceResize&&(_h.hasAnimatedSinceResize=!1,this.nodes.forEach(vw)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&d&&(o||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const f=this.options.transition||d.getDefaultTransition()||cB,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=d.getProps(),x=!this.targetLayout||!Fj(this.targetLayout,m),v=!h&&p;if(this.options.layoutRoot||this.resumeFrom||v||h&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const b={...yx(f,"layout"),onPlay:g,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(b.delay=0,b.type=!1),this.startAnimation(b),this.setAnimationOrigin(u,v)}else h||vw(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),fa(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(rB),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Bj(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(xw);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(bw);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(tB),this.nodes.forEach(KF),this.nodes.forEach(QF)):this.nodes.forEach(bw),this.clearAllSnapshots();const o=Ai.now();Fs.delta=Cn(0,1e3/60,o-Fs.timestamp),Fs.timestamp=o,Fs.isProcessing=!0,Dm.update.process(Fs),Dm.preRender.process(Fs),Dm.render.process(Fs),Fs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,bx.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(eB),this.sharedNodes.forEach(nB)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ut.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ut.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!li(this.snapshot.measuredBox.x)&&!li(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=cs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&this.instance){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!Dj(this.projectionDelta),l=this.getTransformTemplate(),d=l?l(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(o||to(this.latestValues)||u)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),lB(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return cs();const o=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(dB))){const{scroll:d}=this.root;d&&(lc(o.x,d.offset.x),lc(o.y,d.offset.y))}return o}removeElementScroll(a){const o=cs();if(Ki(o,a),this.scroll?.wasRoot)return o;for(let l=0;l<this.path.length;l++){const d=this.path[l],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&Ki(o,a),lc(o.x,u.offset.x),lc(o.y,u.offset.y))}return o}applyTransform(a,o=!1){const l=cs();Ki(l,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&dc(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),to(u.latestValues)&&dc(l,u.latestValues)}return to(this.latestValues)&&dc(l,this.latestValues),l}removeTransform(a){const o=cs();Ki(o,a);for(let l=0;l<this.path.length;l++){const d=this.path[l];if(!d.instance||!to(d.latestValues))continue;d0(d.latestValues)&&d.updateSnapshot();const u=cs(),h=d.measurePageBox();Ki(u,h),hw(o,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return to(this.latestValues)&&hw(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==o;if(!(a||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!(!this.layout||!(u||h))){if(this.resolvedRelativeTargetAt=Fs.timestamp,!this.targetDelta&&!this.relativeTarget){const p=this.getClosestProjectingParent();p&&p.layout&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=cs(),this.relativeTargetOrigin=cs(),xd(this.relativeTargetOrigin,this.layout.layoutBox,p.layout.layoutBox),Ki(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=cs(),this.targetWithTransforms=cs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),gF(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ki(this.target,this.layout.layoutBox),gj(this.target,this.targetDelta)):Ki(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const p=this.getClosestProjectingParent();p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=cs(),this.relativeTargetOrigin=cs(),xd(this.relativeTargetOrigin,this.target,p.target),Ki(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||d0(this.parent.latestValues)||fj(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const a=this.getLead(),o=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Fs.timestamp&&(l=!1),l)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Ki(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;_4(this.layoutCorrected,this.treeScale,this.path,o),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=cs());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(lw(this.prevProjectionDelta.x,this.projectionDelta.x),lw(this.prevProjectionDelta.y,this.projectionDelta.y)),yd(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!yw(this.projectionDelta.x,this.prevProjectionDelta.x)||!yw(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=uc(),this.projectionDelta=uc(),this.projectionDeltaWithTransform=uc()}setAnimationOrigin(a,o=!1){const l=this.snapshot,d=l?l.latestValues:{},u={...this.latestValues},h=uc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const p=cs(),m=l?l.source:void 0,f=this.layout?this.layout.source:void 0,g=m!==f,y=this.getStack(),x=!y||y.members.length<=1,v=!!(g&&!x&&this.options.crossfade===!0&&!this.path.some(oB));this.animationProgress=0;let b;this.mixTargetDelta=S=>{const k=S/1e3;ww(h.x,a.x,k),ww(h.y,a.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(xd(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),aB(this.relativeTarget,this.relativeTargetOrigin,p,k),b&&WF(this.relativeTarget,b)&&(this.isProjectionDirty=!1),b||(b=cs()),Ki(b,this.relativeTarget)),g&&(this.animationValues=u,OF(u,d,this.latestValues,k,v,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(fa(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ut.update(()=>{_h.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=zc(0)),this.currentAnimation=IF(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(HF),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:d,latestValues:u}=a;if(!(!o||!l||!d)){if(this!==a&&this.layout&&d&&Oj(this.options.animationType,this.layout.layoutBox,d.layoutBox)){l=this.target||cs();const h=li(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const p=li(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+p}Ki(o,l),dc(o,u),yd(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new YF),this.sharedNodes.get(a).add(o);const d=o.options.initialPromotionConfig;o.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const d=this.getStack();d&&d.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const d={};l.z&&qm("z",a,d,this.animationValues);for(let u=0;u<Ym.length;u++)qm(`rotate${Ym[u]}`,a,d,this.animationValues),qm(`skew${Ym[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=jh(o?.pointerEvents)||"",a.transform=l?l(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=jh(o?.pointerEvents)||""),this.hasProjected&&!to(this.latestValues)&&(a.transform=l?l({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=qF(this.projectionDeltaWithTransform,this.treeScale,u);l&&(h=l(u,h)),a.transform=h;const{x:p,y:m}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const f in zd){if(u[f]===void 0)continue;const{correct:g,applyTo:y,isCSSVariable:x}=zd[f],v=h==="none"?u[f]:g(u[f],d);if(y){const b=y.length;for(let S=0;S<b;S++)a[y[S]]=v}else x?this.options.visualElement.renderState.vars[f]=v:a[f]=v}this.options.layoutId&&(a.pointerEvents=d===this?jh(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(xw),this.root.sharedNodes.clear()}}}function KF(r){r.updateLayout()}function QF(r){const e=r.resumeFrom?.snapshot||r.snapshot;if(r.isLead()&&r.layout&&e&&r.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:s}=r.layout,{animationType:i}=r.options,n=e.source!==r.layout.source;i==="size"?tr(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=li(h);h.min=t[u].min,h.max=h.min+p}):Oj(i,e.layoutBox,t)&&tr(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=li(t[u]);h.max=h.min+p,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[u].max=r.relativeTarget[u].min+p)});const a=uc();yd(a,t,e.layoutBox);const o=uc();n?yd(o,r.applyTransform(s,!0),e.measuredBox):yd(o,t,e.layoutBox);const l=!Dj(a);let d=!1;if(!r.resumeFrom){const u=r.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:p}=u;if(h&&p){const m=cs();xd(m,e.layoutBox,h.layoutBox);const f=cs();xd(f,t,p.layoutBox),Fj(m,f)||(d=!0),u.options.layoutRoot&&(r.relativeTarget=f,r.relativeTargetOrigin=m,r.relativeParent=u)}}}r.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:d})}else if(r.isLead()){const{onExitComplete:t}=r.options;t&&t()}r.options.transition=void 0}function JF(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function ZF(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function eB(r){r.clearSnapshot()}function xw(r){r.clearMeasurements()}function bw(r){r.isLayoutDirty=!1}function tB(r){const{visualElement:e}=r.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),r.resetTransform()}function vw(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function sB(r){r.resolveTargetDelta()}function iB(r){r.calcProjection()}function rB(r){r.resetSkewAndRotation()}function nB(r){r.removeLeadSnapshot()}function ww(r,e,t){r.translate=Kt(e.translate,0,t),r.scale=Kt(e.scale,1,t),r.origin=e.origin,r.originPoint=e.originPoint}function kw(r,e,t,s){r.min=Kt(e.min,t.min,s),r.max=Kt(e.max,t.max,s)}function aB(r,e,t,s){kw(r.x,e.x,t.x,s),kw(r.y,e.y,t.y,s)}function oB(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const cB={duration:.45,ease:[.4,0,.1,1]},Cw=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),Sw=Cw("applewebkit/")&&!Cw("chrome/")?Math.round:mr;function Tw(r){r.min=Sw(r.min),r.max=Sw(r.max)}function lB(r){Tw(r.x),Tw(r.y)}function Oj(r,e,t){return r==="position"||r==="preserve-aspect"&&!fF(gw(e),gw(t),.2)}function dB(r){return r!==r.root&&r.scroll?.wasRoot}const uB=Lj({attachResizeListener:(r,e)=>Vd(r,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Hm={current:void 0},$j=Lj({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!Hm.current){const r=new uB({});r.mount(window),r.setOptions({layoutScroll:!0}),Hm.current=r}return Hm.current},resetTransform:(r,e)=>{r.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),hB={pan:{Feature:MF},drag:{Feature:EF,ProjectionNode:$j,MeasureLayout:Nj}};function Aw(r,e,t){const{props:s}=r;r.animationState&&s.whileHover&&r.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,n=s[i];n&&Ut.postRender(()=>n(e,gu(e)))}let pB=class extends Aa{mount(){const{current:e}=this.node;e&&(this.unmount=I3(e,(t,s)=>(Aw(this.node,s,"Start"),i=>Aw(this.node,i,"End"))))}unmount(){}},mB=class extends Aa{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pu(Vd(this.node.current,"focus",()=>this.onFocus()),Vd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}};function jw(r,e,t){const{props:s}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&s.whileTap&&r.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),n=s[i];n&&Ut.postRender(()=>n(e,gu(e)))}let fB=class extends Aa{mount(){const{current:e}=this.node;e&&(this.unmount=L3(e,(t,s)=>(jw(this.node,s,"Start"),(i,{success:n})=>jw(this.node,i,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}};const y0=new WeakMap,Xm=new WeakMap,gB=r=>{const e=y0.get(r.target);e&&e(r)},yB=r=>{r.forEach(gB)};function xB({root:r,...e}){const t=r||document;Xm.has(t)||Xm.set(t,{});const s=Xm.get(t),i=JSON.stringify(e);return s[i]||(s[i]=new IntersectionObserver(yB,{root:r,...e})),s[i]}function bB(r,e,t){const s=xB(e);return y0.set(r,t),s.observe(r),()=>{y0.delete(r),s.unobserve(r)}}const vB={some:0,all:1};let wB=class extends Aa{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:n}=e,a={root:t?t.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:vB[i]},o=l=>{const{isIntersecting:d}=l;if(this.isInView===d||(this.isInView=d,n&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(l)};return bB(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(kB(e,t))&&this.startObserver()}unmount(){}};function kB({viewport:r={}},{viewport:e={}}={}){return t=>r[t]!==e[t]}const CB={inView:{Feature:wB},tap:{Feature:fB},focus:{Feature:mB},hover:{Feature:pB}},SB={layout:{ProjectionNode:$j,MeasureLayout:Nj}},TB={...lF,...CB,...hB,...SB},Xt=T4(TB,L4);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AB=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),jB=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),_w=r=>{const e=jB(r);return e.charAt(0).toUpperCase()+e.slice(1)},zj=(...r)=>r.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),_B=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var EB={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MB=w.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:i="",children:n,iconNode:a,...o},l)=>w.createElement("svg",{ref:l,...EB,width:e,height:e,stroke:r,strokeWidth:s?Number(t)*24/Number(e):t,className:zj("lucide",i),...!n&&!_B(o)&&{"aria-hidden":"true"},...o},[...a.map(([d,u])=>w.createElement(d,u)),...Array.isArray(n)?n:[n]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=(r,e)=>{const t=w.forwardRef(({className:s,...i},n)=>w.createElement(MB,{ref:n,iconNode:e,className:zj(`lucide-${AB(_w(r))}`,`lucide-${r}`,s),...i}));return t.displayName=_w(r),t};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PB=[["rect",{width:"6",height:"14",x:"2",y:"5",rx:"2",key:"dy24zr"}],["rect",{width:"6",height:"10",x:"16",y:"7",rx:"2",key:"13zkjt"}],["path",{d:"M12 2v20",key:"t6zp3m"}]],NB=Z("align-horizontal-justify-center",PB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RB=[["rect",{width:"14",height:"6",x:"5",y:"16",rx:"2",key:"1i8z2d"}],["rect",{width:"10",height:"6",x:"7",y:"2",rx:"2",key:"ypihtt"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],IB=Z("align-vertical-justify-center",RB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DB=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],FB=Z("archive",DB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BB=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],LB=Z("arrow-down",BB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OB=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Nx=Z("arrow-left",OB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $B=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],da=Z("arrow-right",$B);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zB=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],VB=Z("arrow-up",zB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UB=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]],GB=Z("at-sign",UB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WB=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],YB=Z("bold",WB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qB=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],HB=Z("bookmark-plus",qB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XB=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],x0=Z("bookmark",XB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KB=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],QB=Z("briefcase",KB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JB=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ZB=Z("camera",JB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eL=[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]],Ew=Z("captions",eL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tL=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ri=Z("check",tL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sL=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ns=Z("chevron-down",sL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iL=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ei=Z("chevron-right",iL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rL=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Vj=Z("chevron-left",rL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nL=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Uj=Z("chevron-up",nL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],_o=Z("circle-alert",aL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oL=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Rx=Z("circle-check-big",oL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],b0=Z("circle-check",cL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],dL=Z("circle-question-mark",lL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Gj=Z("circle-x",uL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Wr=Z("circle",hL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pL=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],mL=Z("clipboard",pL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fL=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],pi=Z("clock",fL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gL=[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]],Mw=Z("command",gL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yL=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Eo=Z("copy",yL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xL=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],bL=Z("cpu",xL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vL=[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]],wL=Z("crop",vL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],CL=Z("crosshair",kL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SL=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],TL=Z("crown",SL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AL=[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]],Hp=Z("diamond",AL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jL=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ix=Z("download",jL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _L=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],EL=Z("droplet",_L);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ML=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],PL=Z("droplets",ML);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NL=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],v0=Z("external-link",NL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RL=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ya=Z("eye-off",RL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IL=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Yr=Z("eye",IL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DL=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]],Uc=Z("file-code",DL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FL=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]],co=Z("file-play",FL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BL=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],vn=Z("film",BL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LL=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],OL=Z("flag",LL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $L=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],zL=Z("focus",$L);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VL=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Dx=Z("folder-open",VL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UL=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],GL=Z("gauge",UL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Wj=Z("globe",WL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YL=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],qL=Z("grip-vertical",YL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HL=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],XL=Z("hard-drive",HL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KL=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],QL=Z("hash",KL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JL=[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}]],Yj=Z("hexagon",JL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZL=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Eh=Z("history",ZL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eO=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],No=Z("image",eO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tO=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],qj=Z("info",tO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sO=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],iO=Z("italic",sO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rO=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Pw=Z("key",rO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nO=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],Nw=Z("keyboard",nO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aO=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Gs=Z("layers",aO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oO=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],Fx=Z("layout-grid",oO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cO=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],lO=Z("lightbulb",cO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dO=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],_i=Z("loader-circle",dO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uO=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],hO=Z("lock",uO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pO=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ja=Z("maximize-2",pO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mO=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],fO=Z("mic-off",mO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gO=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],w0=Z("mic",gO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yO=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Hj=Z("minimize-2",yO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xO=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],ji=Z("monitor",xO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bO=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],vO=Z("moon",bO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wO=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],ua=Z("move",wO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kO=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],k0=Z("music-2",kO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CO=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],qr=Z("music",CO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SO=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Ud=Z("palette",SO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TO=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Xj=Z("pause",TO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AO=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],jO=Z("pen-line",AO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _O=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Kj=Z("pen",_O);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EO=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],MO=Z("pencil",EO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PO=[["path",{d:"M10.83 2.38a2 2 0 0 1 2.34 0l8 5.74a2 2 0 0 1 .73 2.25l-3.04 9.26a2 2 0 0 1-1.9 1.37H7.04a2 2 0 0 1-1.9-1.37L2.1 10.37a2 2 0 0 1 .73-2.25z",key:"2hea0t"}]],NO=Z("pentagon",PO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RO=[["path",{d:"M21 9V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h4",key:"daa4of"}],["rect",{width:"10",height:"7",x:"12",y:"13",rx:"2",key:"1nb8gs"}]],IO=Z("picture-in-picture-2",RO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DO=[["path",{d:"m12 9-8.414 8.414A2 2 0 0 0 3 18.828v1.344a2 2 0 0 1-.586 1.414A2 2 0 0 1 3.828 21h1.344a2 2 0 0 0 1.414-.586L15 12",key:"1y3wsu"}],["path",{d:"m18 9 .4.4a1 1 0 1 1-3 3l-3.8-3.8a1 1 0 1 1 3-3l.4.4 3.4-3.4a1 1 0 1 1 3 3z",key:"110lr1"}],["path",{d:"m2 22 .414-.414",key:"jhxm08"}]],FO=Z("pipette",DO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BO=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ii=Z("play",BO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LO=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Ar=Z("plus",LO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OO=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],Qj=Z("redo-2",OO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $O=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],nl=Z("refresh-cw",$O);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zO=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Gi=Z("rotate-ccw",zO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VO=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],UO=Z("rotate-cw",VO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GO=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Rw=Z("route",GO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WO=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],Bx=Z("scissors",WO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YO=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Mo=Z("search",YO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qO=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],Jj=Z("settings-2",qO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HO=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Gc=Z("settings",HO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XO=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],yu=Z("shapes",XO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KO=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],$u=Z("share-2",KO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QO=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],JO=Z("skip-back",QO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZO=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],e$=Z("skip-forward",ZO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t$=[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]],Mh=Z("sliders-vertical",t$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s$=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],Si=Z("smartphone",s$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i$=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Zj=Z("smile",i$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r$=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Xp=Z("sparkles",r$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n$=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],rs=Z("square",n$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a$=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],xa=Z("star",a$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o$=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M14.837 16.385a6 6 0 1 1-7.223-7.222c.624-.147.97.66.715 1.248a4 4 0 0 0 5.26 5.259c.589-.255 1.396.09 1.248.715",key:"xlf6rm"}],["path",{d:"M16 12a4 4 0 0 0-4-4",key:"6vsxu"}],["path",{d:"m19 5-1.256 1.256",key:"1yg6a6"}],["path",{d:"M20 12h2",key:"1q8mjw"}]],c$=Z("sun-moon",o$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l$=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],d$=Z("sun",l$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u$=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],C0=Z("target",u$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h$=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]],p$=Z("text-align-center",h$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m$=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]],f$=Z("text-align-end",m$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g$=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],y$=Z("text-align-start",g$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x$=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],b$=Z("toggle-left",x$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v$=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],bs=Z("trash-2",v$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w$=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Po=Z("triangle-alert",w$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k$=[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]],e_=Z("triangle",k$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C$=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Vs=Z("type",C$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S$=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],T$=Z("underline",S$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A$=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],t_=Z("undo-2",A$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j$=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Kp=Z("upload",j$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],E$=Z("users",_$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M$=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Wc=Z("video",M$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P$=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Tn=Z("volume-2",P$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N$=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],hp=Z("volume-x",N$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R$=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],I$=Z("wand-sparkles",R$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D$=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],ti=Z("x",D$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F$=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],B$=Z("zoom-in",F$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L$=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],zs=Z("zap",L$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O$=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],$$=Z("zoom-out",O$);let z$=0;const Zl=Ta((r,e)=>({notifications:[],addNotification:t=>{const s=`notification-${++z$}`,i={id:s,duration:4e3,dismissible:!0,...t};return r(n=>({notifications:[...n.notifications,i]})),i.duration&&i.duration>0&&setTimeout(()=>{e().removeNotification(s)},i.duration),s},removeNotification:t=>{r(s=>({notifications:s.notifications.filter(i=>i.id!==t)}))},clearAll:()=>{r({notifications:[]})}})),Os={success:(r,e)=>Zl.getState().addNotification({type:"success",title:r,message:e}),error:(r,e)=>Zl.getState().addNotification({type:"error",title:r,message:e,duration:6e3}),warning:(r,e)=>Zl.getState().addNotification({type:"warning",title:r,message:e}),info:(r,e)=>Zl.getState().addNotification({type:"info",title:r,message:e})},V$={success:c.jsx(b0,{size:20}),error:c.jsx(Gj,{size:20}),warning:c.jsx(Po,{size:20}),info:c.jsx(qj,{size:20})},U$={success:{light:{bg:"bg-white",border:"border-emerald-200",icon:"text-emerald-600",progress:"bg-emerald-500"},dark:{bg:"bg-zinc-900/95",border:"border-emerald-500/30",icon:"text-emerald-400",progress:"bg-emerald-500"}},error:{light:{bg:"bg-white",border:"border-red-200",icon:"text-red-600",progress:"bg-red-500"},dark:{bg:"bg-zinc-900/95",border:"border-red-500/30",icon:"text-red-400",progress:"bg-red-500"}},warning:{light:{bg:"bg-white",border:"border-amber-200",icon:"text-amber-600",progress:"bg-amber-500"},dark:{bg:"bg-zinc-900/95",border:"border-amber-500/30",icon:"text-amber-400",progress:"bg-amber-500"}},info:{light:{bg:"bg-white",border:"border-blue-200",icon:"text-blue-600",progress:"bg-blue-500"},dark:{bg:"bg-zinc-900/95",border:"border-blue-500/30",icon:"text-blue-400",progress:"bg-blue-500"}}},s_=He.forwardRef(({notification:r,onRemove:e},t)=>{const[s,i]=w.useState(100),n=typeof document<"u"&&document.documentElement.classList.contains("dark"),a=n?"dark":"light",o=U$[r.type][a],l=r.duration||4e3;return w.useEffect(()=>{if(l<=0)return;const d=Date.now(),u=setInterval(()=>{const h=Date.now()-d,p=Math.max(0,100-h/l*100);i(p),p<=0&&clearInterval(u)},50);return()=>clearInterval(u)},[l]),c.jsxs(Xt.div,{ref:t,layout:!0,initial:{opacity:0,x:100,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:100,scale:.9},transition:{type:"spring",stiffness:500,damping:30,opacity:{duration:.2}},className:`
        relative overflow-hidden
        min-w-[320px] max-w-[420px]
        rounded-xl border shadow-lg
        ${o.bg} ${o.border}
        backdrop-blur-xl
      `,children:[c.jsxs("div",{className:"flex items-start gap-3 p-4",children:[c.jsx(Xt.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:500,damping:25,delay:.1},className:`flex-shrink-0 mt-0.5 ${o.icon}`,children:V$[r.type]}),c.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[c.jsx(Xt.p,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.05},className:`text-sm font-semibold ${n?"text-zinc-100":"text-zinc-900"}`,children:r.title}),r.message&&c.jsx(Xt.p,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.1},className:`text-xs mt-1 leading-relaxed ${n?"text-zinc-400":"text-zinc-600"}`,children:r.message})]}),r.dismissible&&c.jsx(Xt.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>e(r.id),className:`
              flex-shrink-0 p-1.5 rounded-lg
              transition-colors duration-150
              ${n?"hover:bg-white/10 text-zinc-500 hover:text-zinc-300":"hover:bg-black/5 text-zinc-400 hover:text-zinc-600"}
            `,"aria-label":"Dismiss notification",children:c.jsx(ti,{size:16})})]}),l>0&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/5 dark:bg-white/5",children:c.jsx(Xt.div,{initial:{width:"100%"},animate:{width:`${s}%`},transition:{duration:.05,ease:"linear"},className:`h-full ${o.progress}`})})]})});s_.displayName="ToastItem";const G$=()=>{const{notifications:r,removeNotification:e}=Zl();return c.jsx("div",{className:"fixed top-4 right-4 z-[9999] flex flex-col gap-3",role:"region","aria-label":"Notifications",children:c.jsx(kx,{mode:"popLayout",children:r.map(t=>c.jsx(s_,{notification:t,onRemove:e},t.id))})})};function i_(r){var e,t,s="";if(typeof r=="string"||typeof r=="number")s+=r;else if(typeof r=="object")if(Array.isArray(r)){var i=r.length;for(e=0;e<i;e++)r[e]&&(t=i_(r[e]))&&(s&&(s+=" "),s+=t)}else for(t in r)r[t]&&(s&&(s+=" "),s+=t);return s}function r_(){for(var r,e,t=0,s="",i=arguments.length;t<i;t++)(r=arguments[t])&&(e=i_(r))&&(s&&(s+=" "),s+=e);return s}const W$=(r,e)=>{const t=new Array(r.length+e.length);for(let s=0;s<r.length;s++)t[s]=r[s];for(let s=0;s<e.length;s++)t[r.length+s]=e[s];return t},Y$=(r,e)=>({classGroupId:r,validator:e}),n_=(r=new Map,e=null,t)=>({nextPart:r,validators:e,classGroupId:t}),pp="-",Iw=[],q$="arbitrary..",H$=r=>{const e=K$(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:s}=r;return{getClassGroupId:a=>{if(a.startsWith("[")&&a.endsWith("]"))return X$(a);const o=a.split(pp),l=o[0]===""&&o.length>1?1:0;return a_(o,l,e)},getConflictingClassGroupIds:(a,o)=>{if(o){const l=s[a],d=t[a];return l?d?W$(d,l):l:d||Iw}return t[a]||Iw}}},a_=(r,e,t)=>{if(r.length-e===0)return t.classGroupId;const i=r[e],n=t.nextPart.get(i);if(n){const d=a_(r,e+1,n);if(d)return d}const a=t.validators;if(a===null)return;const o=e===0?r.join(pp):r.slice(e).join(pp),l=a.length;for(let d=0;d<l;d++){const u=a[d];if(u.validator(o))return u.classGroupId}},X$=r=>r.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=r.slice(1,-1),t=e.indexOf(":"),s=e.slice(0,t);return s?q$+s:void 0})(),K$=r=>{const{theme:e,classGroups:t}=r;return Q$(t,e)},Q$=(r,e)=>{const t=n_();for(const s in r){const i=r[s];Lx(i,t,s,e)}return t},Lx=(r,e,t,s)=>{const i=r.length;for(let n=0;n<i;n++){const a=r[n];J$(a,e,t,s)}},J$=(r,e,t,s)=>{if(typeof r=="string"){Z$(r,e,t);return}if(typeof r=="function"){ez(r,e,t,s);return}tz(r,e,t,s)},Z$=(r,e,t)=>{const s=r===""?e:o_(e,r);s.classGroupId=t},ez=(r,e,t,s)=>{if(sz(r)){Lx(r(s),e,t,s);return}e.validators===null&&(e.validators=[]),e.validators.push(Y$(t,r))},tz=(r,e,t,s)=>{const i=Object.entries(r),n=i.length;for(let a=0;a<n;a++){const[o,l]=i[a];Lx(l,o_(e,o),t,s)}},o_=(r,e)=>{let t=r;const s=e.split(pp),i=s.length;for(let n=0;n<i;n++){const a=s[n];let o=t.nextPart.get(a);o||(o=n_(),t.nextPart.set(a,o)),t=o}return t},sz=r=>"isThemeGetter"in r&&r.isThemeGetter===!0,iz=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=Object.create(null),s=Object.create(null);const i=(n,a)=>{t[n]=a,e++,e>r&&(e=0,s=t,t=Object.create(null))};return{get(n){let a=t[n];if(a!==void 0)return a;if((a=s[n])!==void 0)return i(n,a),a},set(n,a){n in t?t[n]=a:i(n,a)}}},S0="!",Dw=":",rz=[],Fw=(r,e,t,s,i)=>({modifiers:r,hasImportantModifier:e,baseClassName:t,maybePostfixModifierPosition:s,isExternal:i}),nz=r=>{const{prefix:e,experimentalParseClassName:t}=r;let s=i=>{const n=[];let a=0,o=0,l=0,d;const u=i.length;for(let g=0;g<u;g++){const y=i[g];if(a===0&&o===0){if(y===Dw){n.push(i.slice(l,g)),l=g+1;continue}if(y==="/"){d=g;continue}}y==="["?a++:y==="]"?a--:y==="("?o++:y===")"&&o--}const h=n.length===0?i:i.slice(l);let p=h,m=!1;h.endsWith(S0)?(p=h.slice(0,-1),m=!0):h.startsWith(S0)&&(p=h.slice(1),m=!0);const f=d&&d>l?d-l:void 0;return Fw(n,m,p,f)};if(e){const i=e+Dw,n=s;s=a=>a.startsWith(i)?n(a.slice(i.length)):Fw(rz,!1,a,void 0,!0)}if(t){const i=s;s=n=>t({className:n,parseClassName:i})}return s},az=r=>{const e=new Map;return r.orderSensitiveModifiers.forEach((t,s)=>{e.set(t,1e6+s)}),t=>{const s=[];let i=[];for(let n=0;n<t.length;n++){const a=t[n],o=a[0]==="[",l=e.has(a);o||l?(i.length>0&&(i.sort(),s.push(...i),i=[]),s.push(a)):i.push(a)}return i.length>0&&(i.sort(),s.push(...i)),s}},oz=r=>({cache:iz(r.cacheSize),parseClassName:nz(r),sortModifiers:az(r),...H$(r)}),cz=/\s+/,lz=(r,e)=>{const{parseClassName:t,getClassGroupId:s,getConflictingClassGroupIds:i,sortModifiers:n}=e,a=[],o=r.trim().split(cz);let l="";for(let d=o.length-1;d>=0;d-=1){const u=o[d],{isExternal:h,modifiers:p,hasImportantModifier:m,baseClassName:f,maybePostfixModifierPosition:g}=t(u);if(h){l=u+(l.length>0?" "+l:l);continue}let y=!!g,x=s(y?f.substring(0,g):f);if(!x){if(!y){l=u+(l.length>0?" "+l:l);continue}if(x=s(f),!x){l=u+(l.length>0?" "+l:l);continue}y=!1}const v=p.length===0?"":p.length===1?p[0]:n(p).join(":"),b=m?v+S0:v,S=b+x;if(a.indexOf(S)>-1)continue;a.push(S);const k=i(x,y);for(let C=0;C<k.length;++C){const A=k[C];a.push(b+A)}l=u+(l.length>0?" "+l:l)}return l},dz=(...r)=>{let e=0,t,s,i="";for(;e<r.length;)(t=r[e++])&&(s=c_(t))&&(i&&(i+=" "),i+=s);return i},c_=r=>{if(typeof r=="string")return r;let e,t="";for(let s=0;s<r.length;s++)r[s]&&(e=c_(r[s]))&&(t&&(t+=" "),t+=e);return t},uz=(r,...e)=>{let t,s,i,n;const a=l=>{const d=e.reduce((u,h)=>h(u),r());return t=oz(d),s=t.cache.get,i=t.cache.set,n=o,o(l)},o=l=>{const d=s(l);if(d)return d;const u=lz(l,t);return i(l,u),u};return n=a,(...l)=>n(dz(...l))},hz=[],Cs=r=>{const e=t=>t[r]||hz;return e.isThemeGetter=!0,e},l_=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,d_=/^\((?:(\w[\w-]*):)?(.+)\)$/i,pz=/^\d+\/\d+$/,mz=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,fz=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,gz=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,yz=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,xz=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Yo=r=>pz.test(r),at=r=>!!r&&!Number.isNaN(Number(r)),zn=r=>!!r&&Number.isInteger(Number(r)),Km=r=>r.endsWith("%")&&at(r.slice(0,-1)),on=r=>mz.test(r),bz=()=>!0,vz=r=>fz.test(r)&&!gz.test(r),u_=()=>!1,wz=r=>yz.test(r),kz=r=>xz.test(r),Cz=r=>!De(r)&&!Fe(r),Sz=r=>al(r,m_,u_),De=r=>l_.test(r),za=r=>al(r,f_,vz),Qm=r=>al(r,Ez,at),Bw=r=>al(r,h_,u_),Tz=r=>al(r,p_,kz),zu=r=>al(r,g_,wz),Fe=r=>d_.test(r),Nl=r=>ol(r,f_),Az=r=>ol(r,Mz),Lw=r=>ol(r,h_),jz=r=>ol(r,m_),_z=r=>ol(r,p_),Vu=r=>ol(r,g_,!0),al=(r,e,t)=>{const s=l_.exec(r);return s?s[1]?e(s[1]):t(s[2]):!1},ol=(r,e,t=!1)=>{const s=d_.exec(r);return s?s[1]?e(s[1]):t:!1},h_=r=>r==="position"||r==="percentage",p_=r=>r==="image"||r==="url",m_=r=>r==="length"||r==="size"||r==="bg-size",f_=r=>r==="length",Ez=r=>r==="number",Mz=r=>r==="family-name",g_=r=>r==="shadow",Pz=()=>{const r=Cs("color"),e=Cs("font"),t=Cs("text"),s=Cs("font-weight"),i=Cs("tracking"),n=Cs("leading"),a=Cs("breakpoint"),o=Cs("container"),l=Cs("spacing"),d=Cs("radius"),u=Cs("shadow"),h=Cs("inset-shadow"),p=Cs("text-shadow"),m=Cs("drop-shadow"),f=Cs("blur"),g=Cs("perspective"),y=Cs("aspect"),x=Cs("ease"),v=Cs("animate"),b=()=>["auto","avoid","all","avoid-page","page","left","right","column"],S=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],k=()=>[...S(),Fe,De],C=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto","contain","none"],T=()=>[Fe,De,l],j=()=>[Yo,"full","auto",...T()],_=()=>[zn,"none","subgrid",Fe,De],M=()=>["auto",{span:["full",zn,Fe,De]},zn,Fe,De],E=()=>[zn,"auto",Fe,De],D=()=>["auto","min","max","fr",Fe,De],R=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],B=()=>["start","end","center","stretch","center-safe","end-safe"],O=()=>["auto",...T()],F=()=>[Yo,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...T()],I=()=>[r,Fe,De],K=()=>[...S(),Lw,Bw,{position:[Fe,De]}],ee=()=>["no-repeat",{repeat:["","x","y","space","round"]}],P=()=>["auto","cover","contain",jz,Sz,{size:[Fe,De]}],W=()=>[Km,Nl,za],z=()=>["","none","full",d,Fe,De],G=()=>["",at,Nl,za],ce=()=>["solid","dashed","dotted","double"],ae=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],te=()=>[at,Km,Lw,Bw],Ve=()=>["","none",f,Fe,De],q=()=>["none",at,Fe,De],oe=()=>["none",at,Fe,De],V=()=>[at,Fe,De],he=()=>[Yo,"full",...T()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[on],breakpoint:[on],color:[bz],container:[on],"drop-shadow":[on],ease:["in","out","in-out"],font:[Cz],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[on],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[on],shadow:[on],spacing:["px",at],text:[on],"text-shadow":[on],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Yo,De,Fe,y]}],container:["container"],columns:[{columns:[at,De,Fe,o]}],"break-after":[{"break-after":b()}],"break-before":[{"break-before":b()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:k()}],overflow:[{overflow:C()}],"overflow-x":[{"overflow-x":C()}],"overflow-y":[{"overflow-y":C()}],overscroll:[{overscroll:A()}],"overscroll-x":[{"overscroll-x":A()}],"overscroll-y":[{"overscroll-y":A()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:j()}],"inset-x":[{"inset-x":j()}],"inset-y":[{"inset-y":j()}],start:[{start:j()}],end:[{end:j()}],top:[{top:j()}],right:[{right:j()}],bottom:[{bottom:j()}],left:[{left:j()}],visibility:["visible","invisible","collapse"],z:[{z:[zn,"auto",Fe,De]}],basis:[{basis:[Yo,"full","auto",o,...T()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[at,Yo,"auto","initial","none",De]}],grow:[{grow:["",at,Fe,De]}],shrink:[{shrink:["",at,Fe,De]}],order:[{order:[zn,"first","last","none",Fe,De]}],"grid-cols":[{"grid-cols":_()}],"col-start-end":[{col:M()}],"col-start":[{"col-start":E()}],"col-end":[{"col-end":E()}],"grid-rows":[{"grid-rows":_()}],"row-start-end":[{row:M()}],"row-start":[{"row-start":E()}],"row-end":[{"row-end":E()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":D()}],"auto-rows":[{"auto-rows":D()}],gap:[{gap:T()}],"gap-x":[{"gap-x":T()}],"gap-y":[{"gap-y":T()}],"justify-content":[{justify:[...R(),"normal"]}],"justify-items":[{"justify-items":[...B(),"normal"]}],"justify-self":[{"justify-self":["auto",...B()]}],"align-content":[{content:["normal",...R()]}],"align-items":[{items:[...B(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...B(),{baseline:["","last"]}]}],"place-content":[{"place-content":R()}],"place-items":[{"place-items":[...B(),"baseline"]}],"place-self":[{"place-self":["auto",...B()]}],p:[{p:T()}],px:[{px:T()}],py:[{py:T()}],ps:[{ps:T()}],pe:[{pe:T()}],pt:[{pt:T()}],pr:[{pr:T()}],pb:[{pb:T()}],pl:[{pl:T()}],m:[{m:O()}],mx:[{mx:O()}],my:[{my:O()}],ms:[{ms:O()}],me:[{me:O()}],mt:[{mt:O()}],mr:[{mr:O()}],mb:[{mb:O()}],ml:[{ml:O()}],"space-x":[{"space-x":T()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":T()}],"space-y-reverse":["space-y-reverse"],size:[{size:F()}],w:[{w:[o,"screen",...F()]}],"min-w":[{"min-w":[o,"screen","none",...F()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...F()]}],h:[{h:["screen","lh",...F()]}],"min-h":[{"min-h":["screen","lh","none",...F()]}],"max-h":[{"max-h":["screen","lh",...F()]}],"font-size":[{text:["base",t,Nl,za]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,Fe,Qm]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Km,De]}],"font-family":[{font:[Az,De,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,Fe,De]}],"line-clamp":[{"line-clamp":[at,"none",Fe,Qm]}],leading:[{leading:[n,...T()]}],"list-image":[{"list-image":["none",Fe,De]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Fe,De]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:I()}],"text-color":[{text:I()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ce(),"wavy"]}],"text-decoration-thickness":[{decoration:[at,"from-font","auto",Fe,za]}],"text-decoration-color":[{decoration:I()}],"underline-offset":[{"underline-offset":[at,"auto",Fe,De]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Fe,De]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Fe,De]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:K()}],"bg-repeat":[{bg:ee()}],"bg-size":[{bg:P()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},zn,Fe,De],radial:["",Fe,De],conic:[zn,Fe,De]},_z,Tz]}],"bg-color":[{bg:I()}],"gradient-from-pos":[{from:W()}],"gradient-via-pos":[{via:W()}],"gradient-to-pos":[{to:W()}],"gradient-from":[{from:I()}],"gradient-via":[{via:I()}],"gradient-to":[{to:I()}],rounded:[{rounded:z()}],"rounded-s":[{"rounded-s":z()}],"rounded-e":[{"rounded-e":z()}],"rounded-t":[{"rounded-t":z()}],"rounded-r":[{"rounded-r":z()}],"rounded-b":[{"rounded-b":z()}],"rounded-l":[{"rounded-l":z()}],"rounded-ss":[{"rounded-ss":z()}],"rounded-se":[{"rounded-se":z()}],"rounded-ee":[{"rounded-ee":z()}],"rounded-es":[{"rounded-es":z()}],"rounded-tl":[{"rounded-tl":z()}],"rounded-tr":[{"rounded-tr":z()}],"rounded-br":[{"rounded-br":z()}],"rounded-bl":[{"rounded-bl":z()}],"border-w":[{border:G()}],"border-w-x":[{"border-x":G()}],"border-w-y":[{"border-y":G()}],"border-w-s":[{"border-s":G()}],"border-w-e":[{"border-e":G()}],"border-w-t":[{"border-t":G()}],"border-w-r":[{"border-r":G()}],"border-w-b":[{"border-b":G()}],"border-w-l":[{"border-l":G()}],"divide-x":[{"divide-x":G()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":G()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...ce(),"hidden","none"]}],"divide-style":[{divide:[...ce(),"hidden","none"]}],"border-color":[{border:I()}],"border-color-x":[{"border-x":I()}],"border-color-y":[{"border-y":I()}],"border-color-s":[{"border-s":I()}],"border-color-e":[{"border-e":I()}],"border-color-t":[{"border-t":I()}],"border-color-r":[{"border-r":I()}],"border-color-b":[{"border-b":I()}],"border-color-l":[{"border-l":I()}],"divide-color":[{divide:I()}],"outline-style":[{outline:[...ce(),"none","hidden"]}],"outline-offset":[{"outline-offset":[at,Fe,De]}],"outline-w":[{outline:["",at,Nl,za]}],"outline-color":[{outline:I()}],shadow:[{shadow:["","none",u,Vu,zu]}],"shadow-color":[{shadow:I()}],"inset-shadow":[{"inset-shadow":["none",h,Vu,zu]}],"inset-shadow-color":[{"inset-shadow":I()}],"ring-w":[{ring:G()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:I()}],"ring-offset-w":[{"ring-offset":[at,za]}],"ring-offset-color":[{"ring-offset":I()}],"inset-ring-w":[{"inset-ring":G()}],"inset-ring-color":[{"inset-ring":I()}],"text-shadow":[{"text-shadow":["none",p,Vu,zu]}],"text-shadow-color":[{"text-shadow":I()}],opacity:[{opacity:[at,Fe,De]}],"mix-blend":[{"mix-blend":[...ae(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":ae()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[at]}],"mask-image-linear-from-pos":[{"mask-linear-from":te()}],"mask-image-linear-to-pos":[{"mask-linear-to":te()}],"mask-image-linear-from-color":[{"mask-linear-from":I()}],"mask-image-linear-to-color":[{"mask-linear-to":I()}],"mask-image-t-from-pos":[{"mask-t-from":te()}],"mask-image-t-to-pos":[{"mask-t-to":te()}],"mask-image-t-from-color":[{"mask-t-from":I()}],"mask-image-t-to-color":[{"mask-t-to":I()}],"mask-image-r-from-pos":[{"mask-r-from":te()}],"mask-image-r-to-pos":[{"mask-r-to":te()}],"mask-image-r-from-color":[{"mask-r-from":I()}],"mask-image-r-to-color":[{"mask-r-to":I()}],"mask-image-b-from-pos":[{"mask-b-from":te()}],"mask-image-b-to-pos":[{"mask-b-to":te()}],"mask-image-b-from-color":[{"mask-b-from":I()}],"mask-image-b-to-color":[{"mask-b-to":I()}],"mask-image-l-from-pos":[{"mask-l-from":te()}],"mask-image-l-to-pos":[{"mask-l-to":te()}],"mask-image-l-from-color":[{"mask-l-from":I()}],"mask-image-l-to-color":[{"mask-l-to":I()}],"mask-image-x-from-pos":[{"mask-x-from":te()}],"mask-image-x-to-pos":[{"mask-x-to":te()}],"mask-image-x-from-color":[{"mask-x-from":I()}],"mask-image-x-to-color":[{"mask-x-to":I()}],"mask-image-y-from-pos":[{"mask-y-from":te()}],"mask-image-y-to-pos":[{"mask-y-to":te()}],"mask-image-y-from-color":[{"mask-y-from":I()}],"mask-image-y-to-color":[{"mask-y-to":I()}],"mask-image-radial":[{"mask-radial":[Fe,De]}],"mask-image-radial-from-pos":[{"mask-radial-from":te()}],"mask-image-radial-to-pos":[{"mask-radial-to":te()}],"mask-image-radial-from-color":[{"mask-radial-from":I()}],"mask-image-radial-to-color":[{"mask-radial-to":I()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":S()}],"mask-image-conic-pos":[{"mask-conic":[at]}],"mask-image-conic-from-pos":[{"mask-conic-from":te()}],"mask-image-conic-to-pos":[{"mask-conic-to":te()}],"mask-image-conic-from-color":[{"mask-conic-from":I()}],"mask-image-conic-to-color":[{"mask-conic-to":I()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:K()}],"mask-repeat":[{mask:ee()}],"mask-size":[{mask:P()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Fe,De]}],filter:[{filter:["","none",Fe,De]}],blur:[{blur:Ve()}],brightness:[{brightness:[at,Fe,De]}],contrast:[{contrast:[at,Fe,De]}],"drop-shadow":[{"drop-shadow":["","none",m,Vu,zu]}],"drop-shadow-color":[{"drop-shadow":I()}],grayscale:[{grayscale:["",at,Fe,De]}],"hue-rotate":[{"hue-rotate":[at,Fe,De]}],invert:[{invert:["",at,Fe,De]}],saturate:[{saturate:[at,Fe,De]}],sepia:[{sepia:["",at,Fe,De]}],"backdrop-filter":[{"backdrop-filter":["","none",Fe,De]}],"backdrop-blur":[{"backdrop-blur":Ve()}],"backdrop-brightness":[{"backdrop-brightness":[at,Fe,De]}],"backdrop-contrast":[{"backdrop-contrast":[at,Fe,De]}],"backdrop-grayscale":[{"backdrop-grayscale":["",at,Fe,De]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[at,Fe,De]}],"backdrop-invert":[{"backdrop-invert":["",at,Fe,De]}],"backdrop-opacity":[{"backdrop-opacity":[at,Fe,De]}],"backdrop-saturate":[{"backdrop-saturate":[at,Fe,De]}],"backdrop-sepia":[{"backdrop-sepia":["",at,Fe,De]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":T()}],"border-spacing-x":[{"border-spacing-x":T()}],"border-spacing-y":[{"border-spacing-y":T()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Fe,De]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[at,"initial",Fe,De]}],ease:[{ease:["linear","initial",x,Fe,De]}],delay:[{delay:[at,Fe,De]}],animate:[{animate:["none",v,Fe,De]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[g,Fe,De]}],"perspective-origin":[{"perspective-origin":k()}],rotate:[{rotate:q()}],"rotate-x":[{"rotate-x":q()}],"rotate-y":[{"rotate-y":q()}],"rotate-z":[{"rotate-z":q()}],scale:[{scale:oe()}],"scale-x":[{"scale-x":oe()}],"scale-y":[{"scale-y":oe()}],"scale-z":[{"scale-z":oe()}],"scale-3d":["scale-3d"],skew:[{skew:V()}],"skew-x":[{"skew-x":V()}],"skew-y":[{"skew-y":V()}],transform:[{transform:[Fe,De,"","none","gpu","cpu"]}],"transform-origin":[{origin:k()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:he()}],"translate-x":[{"translate-x":he()}],"translate-y":[{"translate-y":he()}],"translate-z":[{"translate-z":he()}],"translate-none":["translate-none"],accent:[{accent:I()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:I()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Fe,De]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Fe,De]}],fill:[{fill:["none",...I()]}],"stroke-w":[{stroke:[at,Nl,za,Qm]}],stroke:[{stroke:["none",...I()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Nz=uz(Pz);function Oe(...r){return Nz(r_(r))}const Ow=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,$w=r_,Qp=(r,e)=>t=>{var s;if(e?.variants==null)return $w(r,t?.class,t?.className);const{variants:i,defaultVariants:n}=e,a=Object.keys(i).map(d=>{const u=t?.[d],h=n?.[d];if(u===null)return null;const p=Ow(u)||Ow(h);return i[d][p]}),o=t&&Object.entries(t).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),l=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((d,u)=>{let{class:h,className:p,...m}=u;return Object.entries(m).every(f=>{let[g,y]=f;return Array.isArray(y)?y.includes({...n,...o}[g]):{...n,...o}[g]===y})?[...d,h,p]:d},[]);return $w(r,a,l,t?.class,t?.className)},Rz=Qp("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Iz=w.forwardRef(({className:r,variant:e,...t},s)=>c.jsx("div",{ref:s,role:"alert",className:Oe(Rz({variant:e}),r),...t}));Iz.displayName="Alert";const Dz=w.forwardRef(({className:r,...e},t)=>c.jsx("h5",{ref:t,className:Oe("mb-1 font-medium leading-none tracking-tight",r),...e}));Dz.displayName="AlertTitle";const Fz=w.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:Oe("text-sm [&_p]:leading-relaxed",r),...e}));Fz.displayName="AlertDescription";const Bz=Qp("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-white hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10","icon-sm":"h-8 w-8 [&_svg]:size-4","icon-xs":"h-6 w-6 [&_svg]:size-3.5"}},defaultVariants:{variant:"default",size:"default"}}),Rt=w.forwardRef(({className:r,variant:e,size:t,asChild:s=!1,...i},n)=>{const a=s?BN:"button";return c.jsx(a,{className:Oe(Bz({variant:e,size:t,className:r})),ref:n,...i})});Rt.displayName="Button";const Lz=w.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:Oe("rounded-lg border bg-card text-card-foreground shadow-sm",r),...e}));Lz.displayName="Card";const Oz=w.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:Oe("flex flex-col space-y-1.5 p-6",r),...e}));Oz.displayName="CardHeader";const $z=w.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:Oe("text-2xl font-semibold leading-none tracking-tight",r),...e}));$z.displayName="CardTitle";const zz=w.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:Oe("text-sm text-muted-foreground",r),...e}));zz.displayName="CardDescription";const Vz=w.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:Oe("p-6 pt-0",r),...e}));Vz.displayName="CardContent";const Uz=w.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:Oe("flex items-center p-6 pt-0",r),...e}));Uz.displayName="CardFooter";const T0=w.forwardRef(({className:r,...e},t)=>c.jsx(aS,{ref:t,className:Oe("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...e,children:c.jsx(LN,{className:Oe("grid place-content-center text-current"),children:c.jsx(Ri,{className:"h-4 w-4"})})}));T0.displayName=aS.displayName;const $r=w.forwardRef(({icon:r,iconSize:e=14,className:t,variant:s="ghost",size:i="icon-xs",...n},a)=>c.jsx(Rt,{ref:a,variant:s,size:i,className:Oe("text-text-secondary hover:text-text-primary hover:bg-background-elevated",t),...n,children:c.jsx(r,{size:e})}));$r.displayName="IconButton";const Gd=w.createContext({});function Ox(r){const e=w.useRef(null);return e.current===null&&(e.current=r()),e.current}const y_=typeof window<"u",$x=y_?w.useLayoutEffect:w.useEffect,Jp=w.createContext(null);function zx(r,e){r.indexOf(e)===-1&&r.push(e)}function Vx(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}const Hr=(r,e,t)=>t>e?e:t<r?r:t;let Ux=()=>{};const An={},x_=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function b_(r){return typeof r=="object"&&r!==null}const v_=r=>/^0[^.\s]+$/u.test(r);function Gx(r){let e;return()=>(e===void 0&&(e=r()),e)}const fr=r=>r,Gz=(r,e)=>t=>e(r(t)),xu=(...r)=>r.reduce(Gz),Wd=(r,e,t)=>{const s=e-r;return s===0?1:(t-r)/s};class Wx{constructor(){this.subscriptions=[]}add(e){return zx(this.subscriptions,e),()=>Vx(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,s);else for(let n=0;n<i;n++){const a=this.subscriptions[n];a&&a(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const wn=r=>r*1e3,cr=r=>r/1e3;function w_(r,e){return e?r*(1e3/e):0}const k_=(r,e,t)=>(((1-3*t+3*e)*r+(3*t-6*e))*r+3*e)*r,Wz=1e-7,Yz=12;function qz(r,e,t,s,i){let n,a,o=0;do a=e+(t-e)/2,n=k_(a,s,i)-r,n>0?t=a:e=a;while(Math.abs(n)>Wz&&++o<Yz);return a}function bu(r,e,t,s){if(r===e&&t===s)return fr;const i=n=>qz(n,0,1,r,t);return n=>n===0||n===1?n:k_(i(n),e,s)}const C_=r=>e=>e<=.5?r(2*e)/2:(2-r(2*(1-e)))/2,S_=r=>e=>1-r(1-e),T_=bu(.33,1.53,.69,.99),Yx=S_(T_),A_=C_(Yx),j_=r=>(r*=2)<1?.5*Yx(r):.5*(2-Math.pow(2,-10*(r-1))),qx=r=>1-Math.sin(Math.acos(r)),__=S_(qx),E_=C_(qx),Hz=bu(.42,0,1,1),Xz=bu(0,0,.58,1),M_=bu(.42,0,.58,1),Kz=r=>Array.isArray(r)&&typeof r[0]!="number",P_=r=>Array.isArray(r)&&typeof r[0]=="number",Qz={linear:fr,easeIn:Hz,easeInOut:M_,easeOut:Xz,circIn:qx,circInOut:E_,circOut:__,backIn:Yx,backInOut:A_,backOut:T_,anticipate:j_},Jz=r=>typeof r=="string",zw=r=>{if(P_(r)){Ux(r.length===4);const[e,t,s,i]=r;return bu(e,t,s,i)}else if(Jz(r))return Qz[r];return r},Uu=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Zz(r,e){let t=new Set,s=new Set,i=!1,n=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(u){a.has(u)&&(d.schedule(u),r()),u(o)}const d={schedule:(u,h=!1,p=!1)=>{const f=p&&i?t:s;return h&&a.add(u),f.has(u)||f.add(u),u},cancel:u=>{s.delete(u),a.delete(u)},process:u=>{if(o=u,i){n=!0;return}i=!0,[t,s]=[s,t],t.forEach(l),t.clear(),i=!1,n&&(n=!1,d.process(u))}};return d}const eV=40;function N_(r,e){let t=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},n=()=>t=!0,a=Uu.reduce((b,S)=>(b[S]=Zz(n),b),{}),{setup:o,read:l,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:m,postRender:f}=a,g=()=>{const b=An.useManualTiming?i.timestamp:performance.now();t=!1,An.useManualTiming||(i.delta=s?1e3/60:Math.max(Math.min(b-i.timestamp,eV),1)),i.timestamp=b,i.isProcessing=!0,o.process(i),l.process(i),d.process(i),u.process(i),h.process(i),p.process(i),m.process(i),f.process(i),i.isProcessing=!1,t&&e&&(s=!1,r(g))},y=()=>{t=!0,s=!0,i.isProcessing||r(g)};return{schedule:Uu.reduce((b,S)=>{const k=a[S];return b[S]=(C,A=!1,T=!1)=>(t||y(),k.schedule(C,A,T)),b},{}),cancel:b=>{for(let S=0;S<Uu.length;S++)a[Uu[S]].cancel(b)},state:i,steps:a}}const{schedule:Ft,cancel:ba,state:Bs,steps:Jm}=N_(typeof requestAnimationFrame<"u"?requestAnimationFrame:fr,!0);let Ph;function tV(){Ph=void 0}const di={now:()=>(Ph===void 0&&di.set(Bs.isProcessing||An.useManualTiming?Bs.timestamp:performance.now()),Ph),set:r=>{Ph=r,queueMicrotask(tV)}},R_=r=>e=>typeof e=="string"&&e.startsWith(r),I_=R_("--"),sV=R_("var(--"),Hx=r=>sV(r)?iV.test(r.split("/*")[0].trim()):!1,iV=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Vw(r){return typeof r!="string"?!1:r.split("/*")[0].includes("var(--")}const cl={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},Yd={...cl,transform:r=>Hr(0,1,r)},Gu={...cl,default:1},bd=r=>Math.round(r*1e5)/1e5,Xx=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function rV(r){return r==null}const nV=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Kx=(r,e)=>t=>!!(typeof t=="string"&&nV.test(t)&&t.startsWith(r)||e&&!rV(t)&&Object.prototype.hasOwnProperty.call(t,e)),D_=(r,e,t)=>s=>{if(typeof s!="string")return s;const[i,n,a,o]=s.match(Xx);return{[r]:parseFloat(i),[e]:parseFloat(n),[t]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},aV=r=>Hr(0,255,r),Zm={...cl,transform:r=>Math.round(aV(r))},lo={test:Kx("rgb","red"),parse:D_("red","green","blue"),transform:({red:r,green:e,blue:t,alpha:s=1})=>"rgba("+Zm.transform(r)+", "+Zm.transform(e)+", "+Zm.transform(t)+", "+bd(Yd.transform(s))+")"};function oV(r){let e="",t="",s="",i="";return r.length>5?(e=r.substring(1,3),t=r.substring(3,5),s=r.substring(5,7),i=r.substring(7,9)):(e=r.substring(1,2),t=r.substring(2,3),s=r.substring(3,4),i=r.substring(4,5),e+=e,t+=t,s+=s,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const A0={test:Kx("#"),parse:oV,transform:lo.transform},vu=r=>({test:e=>typeof e=="string"&&e.endsWith(r)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${r}`}),Jn=vu("deg"),Gr=vu("%"),Be=vu("px"),cV=vu("vh"),lV=vu("vw"),Uw={...Gr,parse:r=>Gr.parse(r)/100,transform:r=>Gr.transform(r*100)},hc={test:Kx("hsl","hue"),parse:D_("hue","saturation","lightness"),transform:({hue:r,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(r)+", "+Gr.transform(bd(e))+", "+Gr.transform(bd(t))+", "+bd(Yd.transform(s))+")"},gs={test:r=>lo.test(r)||A0.test(r)||hc.test(r),parse:r=>lo.test(r)?lo.parse(r):hc.test(r)?hc.parse(r):A0.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?lo.transform(r):hc.transform(r),getAnimatableNone:r=>{const e=gs.parse(r);return e.alpha=0,gs.transform(e)}},dV=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function uV(r){return isNaN(r)&&typeof r=="string"&&(r.match(Xx)?.length||0)+(r.match(dV)?.length||0)>0}const F_="number",B_="color",hV="var",pV="var(",Gw="${}",mV=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function qd(r){const e=r.toString(),t=[],s={color:[],number:[],var:[]},i=[];let n=0;const o=e.replace(mV,l=>(gs.test(l)?(s.color.push(n),i.push(B_),t.push(gs.parse(l))):l.startsWith(pV)?(s.var.push(n),i.push(hV),t.push(l)):(s.number.push(n),i.push(F_),t.push(parseFloat(l))),++n,Gw)).split(Gw);return{values:t,split:o,indexes:s,types:i}}function L_(r){return qd(r).values}function O_(r){const{split:e,types:t}=qd(r),s=e.length;return i=>{let n="";for(let a=0;a<s;a++)if(n+=e[a],i[a]!==void 0){const o=t[a];o===F_?n+=bd(i[a]):o===B_?n+=gs.transform(i[a]):n+=i[a]}return n}}const fV=r=>typeof r=="number"?0:gs.test(r)?gs.getAnimatableNone(r):r;function gV(r){const e=L_(r);return O_(r)(e.map(fV))}const va={test:uV,parse:L_,createTransformer:O_,getAnimatableNone:gV};function ef(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function yV({hue:r,saturation:e,lightness:t,alpha:s}){r/=360,e/=100,t/=100;let i=0,n=0,a=0;if(!e)i=n=a=t;else{const o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;i=ef(l,o,r+1/3),n=ef(l,o,r),a=ef(l,o,r-1/3)}return{red:Math.round(i*255),green:Math.round(n*255),blue:Math.round(a*255),alpha:s}}function mp(r,e){return t=>t>0?e:r}const Qt=(r,e,t)=>r+(e-r)*t,tf=(r,e,t)=>{const s=r*r,i=t*(e*e-s)+s;return i<0?0:Math.sqrt(i)},xV=[A0,lo,hc],bV=r=>xV.find(e=>e.test(r));function Ww(r){const e=bV(r);if(!e)return!1;let t=e.parse(r);return e===hc&&(t=yV(t)),t}const Yw=(r,e)=>{const t=Ww(r),s=Ww(e);if(!t||!s)return mp(r,e);const i={...t};return n=>(i.red=tf(t.red,s.red,n),i.green=tf(t.green,s.green,n),i.blue=tf(t.blue,s.blue,n),i.alpha=Qt(t.alpha,s.alpha,n),lo.transform(i))},j0=new Set(["none","hidden"]);function vV(r,e){return j0.has(r)?t=>t<=0?r:e:t=>t>=1?e:r}function wV(r,e){return t=>Qt(r,e,t)}function Qx(r){return typeof r=="number"?wV:typeof r=="string"?Hx(r)?mp:gs.test(r)?Yw:SV:Array.isArray(r)?$_:typeof r=="object"?gs.test(r)?Yw:kV:mp}function $_(r,e){const t=[...r],s=t.length,i=r.map((n,a)=>Qx(n)(n,e[a]));return n=>{for(let a=0;a<s;a++)t[a]=i[a](n);return t}}function kV(r,e){const t={...r,...e},s={};for(const i in t)r[i]!==void 0&&e[i]!==void 0&&(s[i]=Qx(r[i])(r[i],e[i]));return i=>{for(const n in s)t[n]=s[n](i);return t}}function CV(r,e){const t=[],s={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const n=e.types[i],a=r.indexes[n][s[n]],o=r.values[a]??0;t[i]=o,s[n]++}return t}const SV=(r,e)=>{const t=va.createTransformer(e),s=qd(r),i=qd(e);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?j0.has(r)&&!i.values.length||j0.has(e)&&!s.values.length?vV(r,e):xu($_(CV(s,i),i.values),t):mp(r,e)};function z_(r,e,t){return typeof r=="number"&&typeof e=="number"&&typeof t=="number"?Qt(r,e,t):Qx(r)(r,e)}const TV=r=>{const e=({timestamp:t})=>r(t);return{start:(t=!0)=>Ft.update(e,t),stop:()=>ba(e),now:()=>Bs.isProcessing?Bs.timestamp:di.now()}},V_=(r,e,t=10)=>{let s="";const i=Math.max(Math.round(e/t),2);for(let n=0;n<i;n++)s+=Math.round(r(n/(i-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},fp=2e4;function Jx(r){let e=0;const t=50;let s=r.next(e);for(;!s.done&&e<fp;)e+=t,s=r.next(e);return e>=fp?1/0:e}function AV(r,e=100,t){const s=t({...r,keyframes:[0,e]}),i=Math.min(Jx(s),fp);return{type:"keyframes",ease:n=>s.next(i*n).value/e,duration:cr(i)}}const jV=5;function U_(r,e,t){const s=Math.max(e-jV,0);return w_(t-r(s),e-s)}const ts={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},sf=.001;function _V({duration:r=ts.duration,bounce:e=ts.bounce,velocity:t=ts.velocity,mass:s=ts.mass}){let i,n,a=1-e;a=Hr(ts.minDamping,ts.maxDamping,a),r=Hr(ts.minDuration,ts.maxDuration,cr(r)),a<1?(i=d=>{const u=d*a,h=u*r,p=u-t,m=_0(d,a),f=Math.exp(-h);return sf-p/m*f},n=d=>{const h=d*a*r,p=h*t+t,m=Math.pow(a,2)*Math.pow(d,2)*r,f=Math.exp(-h),g=_0(Math.pow(d,2),a);return(-i(d)+sf>0?-1:1)*((p-m)*f)/g}):(i=d=>{const u=Math.exp(-d*r),h=(d-t)*r+1;return-sf+u*h},n=d=>{const u=Math.exp(-d*r),h=(t-d)*(r*r);return u*h});const o=5/r,l=MV(i,n,o);if(r=wn(r),isNaN(l))return{stiffness:ts.stiffness,damping:ts.damping,duration:r};{const d=Math.pow(l,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:r}}}const EV=12;function MV(r,e,t){let s=t;for(let i=1;i<EV;i++)s=s-r(s)/e(s);return s}function _0(r,e){return r*Math.sqrt(1-e*e)}const PV=["duration","bounce"],NV=["stiffness","damping","mass"];function qw(r,e){return e.some(t=>r[t]!==void 0)}function RV(r){let e={velocity:ts.velocity,stiffness:ts.stiffness,damping:ts.damping,mass:ts.mass,isResolvedFromDuration:!1,...r};if(!qw(r,NV)&&qw(r,PV))if(r.visualDuration){const t=r.visualDuration,s=2*Math.PI/(t*1.2),i=s*s,n=2*Hr(.05,1,1-(r.bounce||0))*Math.sqrt(i);e={...e,mass:ts.mass,stiffness:i,damping:n}}else{const t=_V(r);e={...e,...t,mass:ts.mass},e.isResolvedFromDuration=!0}return e}function gp(r=ts.visualDuration,e=ts.bounce){const t=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:e}:r;let{restSpeed:s,restDelta:i}=t;const n=t.keyframes[0],a=t.keyframes[t.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:m}=RV({...t,velocity:-cr(t.velocity||0)}),f=p||0,g=d/(2*Math.sqrt(l*u)),y=a-n,x=cr(Math.sqrt(l/u)),v=Math.abs(y)<5;s||(s=v?ts.restSpeed.granular:ts.restSpeed.default),i||(i=v?ts.restDelta.granular:ts.restDelta.default);let b;if(g<1){const k=_0(x,g);b=C=>{const A=Math.exp(-g*x*C);return a-A*((f+g*x*y)/k*Math.sin(k*C)+y*Math.cos(k*C))}}else if(g===1)b=k=>a-Math.exp(-x*k)*(y+(f+x*y)*k);else{const k=x*Math.sqrt(g*g-1);b=C=>{const A=Math.exp(-g*x*C),T=Math.min(k*C,300);return a-A*((f+g*x*y)*Math.sinh(T)+k*y*Math.cosh(T))/k}}const S={calculatedDuration:m&&h||null,next:k=>{const C=b(k);if(m)o.done=k>=h;else{let A=k===0?f:0;g<1&&(A=k===0?wn(f):U_(b,k,C));const T=Math.abs(A)<=s,j=Math.abs(a-C)<=i;o.done=T&&j}return o.value=o.done?a:C,o},toString:()=>{const k=Math.min(Jx(S),fp),C=V_(A=>S.next(k*A).value,k,30);return k+"ms "+C},toTransition:()=>{}};return S}gp.applyToOptions=r=>{const e=AV(r,100,gp);return r.ease=e.ease,r.duration=wn(e.duration),r.type="keyframes",r};function E0({keyframes:r,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:n=500,modifyTarget:a,min:o,max:l,restDelta:d=.5,restSpeed:u}){const h=r[0],p={done:!1,value:h},m=T=>o!==void 0&&T<o||l!==void 0&&T>l,f=T=>o===void 0?l:l===void 0||Math.abs(o-T)<Math.abs(l-T)?o:l;let g=t*e;const y=h+g,x=a===void 0?y:a(y);x!==y&&(g=x-h);const v=T=>-g*Math.exp(-T/s),b=T=>x+v(T),S=T=>{const j=v(T),_=b(T);p.done=Math.abs(j)<=d,p.value=p.done?x:_};let k,C;const A=T=>{m(p.value)&&(k=T,C=gp({keyframes:[p.value,f(p.value)],velocity:U_(b,T,p.value),damping:i,stiffness:n,restDelta:d,restSpeed:u}))};return A(0),{calculatedDuration:null,next:T=>{let j=!1;return!C&&k===void 0&&(j=!0,S(T),A(T)),k!==void 0&&T>=k?C.next(T-k):(!j&&S(T),p)}}}function IV(r,e,t){const s=[],i=t||An.mix||z_,n=r.length-1;for(let a=0;a<n;a++){let o=i(r[a],r[a+1]);if(e){const l=Array.isArray(e)?e[a]||fr:e;o=xu(l,o)}s.push(o)}return s}function DV(r,e,{clamp:t=!0,ease:s,mixer:i}={}){const n=r.length;if(Ux(n===e.length),n===1)return()=>e[0];if(n===2&&e[0]===e[1])return()=>e[1];const a=r[0]===r[1];r[0]>r[n-1]&&(r=[...r].reverse(),e=[...e].reverse());const o=IV(e,s,i),l=o.length,d=u=>{if(a&&u<r[0])return e[0];let h=0;if(l>1)for(;h<r.length-2&&!(u<r[h+1]);h++);const p=Wd(r[h],r[h+1],u);return o[h](p)};return t?u=>d(Hr(r[0],r[n-1],u)):d}function FV(r,e){const t=r[r.length-1];for(let s=1;s<=e;s++){const i=Wd(0,e,s);r.push(Qt(t,1,i))}}function BV(r){const e=[0];return FV(e,r.length-1),e}function LV(r,e){return r.map(t=>t*e)}function OV(r,e){return r.map(()=>e||M_).splice(0,r.length-1)}function vd({duration:r=300,keyframes:e,times:t,ease:s="easeInOut"}){const i=Kz(s)?s.map(zw):zw(s),n={done:!1,value:e[0]},a=LV(t&&t.length===e.length?t:BV(e),r),o=DV(a,e,{ease:Array.isArray(i)?i:OV(e,i)});return{calculatedDuration:r,next:l=>(n.value=o(l),n.done=l>=r,n)}}const $V=r=>r!==null;function Zx(r,{repeat:e,repeatType:t="loop"},s,i=1){const n=r.filter($V),o=i<0||e&&t!=="loop"&&e%2===1?0:n.length-1;return!o||s===void 0?n[o]:s}const zV={decay:E0,inertia:E0,tween:vd,keyframes:vd,spring:gp};function G_(r){typeof r.type=="string"&&(r.type=zV[r.type])}class eb{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const VV=r=>r/100;class tb extends eb{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==di.now()&&this.tick(di.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;G_(e);const{type:t=vd,repeat:s=0,repeatDelay:i=0,repeatType:n,velocity:a=0}=e;let{keyframes:o}=e;const l=t||vd;l!==vd&&typeof o[0]!="number"&&(this.mixKeyframes=xu(VV,z_(o[0],o[1])),o=[0,100]);const d=l({...e,keyframes:o});n==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...o].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=Jx(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(s+1)-i,this.generator=d}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:i,mixKeyframes:n,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:m,type:f,onUpdate:g,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const x=this.currentTime-d*(this.playbackSpeed>=0?1:-1),v=this.playbackSpeed>=0?x<0:x>i;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let b=this.currentTime,S=s;if(h){const T=Math.min(this.currentTime,i)/o;let j=Math.floor(T),_=T%1;!_&&T>=1&&(_=1),_===1&&j--,j=Math.min(j,h+1),!!(j%2)&&(p==="reverse"?(_=1-_,m&&(_-=m/o)):p==="mirror"&&(S=a)),b=Hr(0,1,_)*o}const k=v?{done:!1,value:u[0]}:S.next(b);n&&(k.value=n(k.value));let{done:C}=k;!v&&l!==null&&(C=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const A=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&C);return A&&f!==E0&&(k.value=Zx(u,this.options,y,this.speed)),g&&g(k.value),A&&this.finish(),k}then(e,t){return this.finished.then(e,t)}get duration(){return cr(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+cr(e)}get time(){return cr(this.currentTime)}set time(e){e=wn(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(di.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=cr(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=TV,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(di.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function UV(r){for(let e=1;e<r.length;e++)r[e]??(r[e]=r[e-1])}const uo=r=>r*180/Math.PI,M0=r=>{const e=uo(Math.atan2(r[1],r[0]));return P0(e)},GV={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:M0,rotateZ:M0,skewX:r=>uo(Math.atan(r[1])),skewY:r=>uo(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},P0=r=>(r=r%360,r<0&&(r+=360),r),Hw=M0,Xw=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),Kw=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),WV={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Xw,scaleY:Kw,scale:r=>(Xw(r)+Kw(r))/2,rotateX:r=>P0(uo(Math.atan2(r[6],r[5]))),rotateY:r=>P0(uo(Math.atan2(-r[2],r[0]))),rotateZ:Hw,rotate:Hw,skewX:r=>uo(Math.atan(r[4])),skewY:r=>uo(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function N0(r){return r.includes("scale")?1:0}function R0(r,e){if(!r||r==="none")return N0(e);const t=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,i;if(t)s=WV,i=t;else{const o=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=GV,i=o}if(!i)return N0(e);const n=s[e],a=i[1].split(",").map(qV);return typeof n=="function"?n(a):a[n]}const YV=(r,e)=>{const{transform:t="none"}=getComputedStyle(r);return R0(t,e)};function qV(r){return parseFloat(r.trim())}const ll=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],dl=new Set(ll),Qw=r=>r===cl||r===Be,HV=new Set(["x","y","z"]),XV=ll.filter(r=>!HV.has(r));function KV(r){const e=[];return XV.forEach(t=>{const s=r.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const sa={width:({x:r},{paddingLeft:e="0",paddingRight:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),height:({y:r},{paddingTop:e="0",paddingBottom:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),top:(r,{top:e})=>parseFloat(e),left:(r,{left:e})=>parseFloat(e),bottom:({y:r},{top:e})=>parseFloat(e)+(r.max-r.min),right:({x:r},{left:e})=>parseFloat(e)+(r.max-r.min),x:(r,{transform:e})=>R0(e,"x"),y:(r,{transform:e})=>R0(e,"y")};sa.translateX=sa.x;sa.translateY=sa.y;const xo=new Set;let I0=!1,D0=!1,F0=!1;function W_(){if(D0){const r=Array.from(xo).filter(s=>s.needsMeasurement),e=new Set(r.map(s=>s.element)),t=new Map;e.forEach(s=>{const i=KV(s);i.length&&(t.set(s,i),s.render())}),r.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const i=t.get(s);i&&i.forEach(([n,a])=>{s.getValue(n)?.set(a)})}),r.forEach(s=>s.measureEndState()),r.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}D0=!1,I0=!1,xo.forEach(r=>r.complete(F0)),xo.clear()}function Y_(){xo.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(D0=!0)})}function QV(){F0=!0,Y_(),W_(),F0=!1}class sb{constructor(e,t,s,i,n,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=n,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(xo.add(this),I0||(I0=!0,Ft.read(Y_),Ft.resolveKeyframes(W_))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;if(e[0]===null){const n=i?.get(),a=e[e.length-1];if(n!==void 0)e[0]=n;else if(s&&t){const o=s.readValue(t,a);o!=null&&(e[0]=o)}e[0]===void 0&&(e[0]=a),i&&n===void 0&&i.set(e[0])}UV(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),xo.delete(this)}cancel(){this.state==="scheduled"&&(xo.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const JV=r=>r.startsWith("--");function ZV(r,e,t){JV(e)?r.style.setProperty(e,t):r.style[e]=t}const e6=Gx(()=>window.ScrollTimeline!==void 0),t6={};function s6(r,e){const t=Gx(r);return()=>t6[e]??t()}const q_=s6(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ed=([r,e,t,s])=>`cubic-bezier(${r}, ${e}, ${t}, ${s})`,Jw={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ed([0,.65,.55,1]),circOut:ed([.55,0,1,.45]),backIn:ed([.31,.01,.66,-.59]),backOut:ed([.33,1.53,.69,.99])};function H_(r,e){if(r)return typeof r=="function"?q_()?V_(r,e):"ease-out":P_(r)?ed(r):Array.isArray(r)?r.map(t=>H_(t,e)||Jw.easeOut):Jw[r]}function i6(r,e,t,{delay:s=0,duration:i=300,repeat:n=0,repeatType:a="loop",ease:o="easeOut",times:l}={},d=void 0){const u={[e]:t};l&&(u.offset=l);const h=H_(o,i);Array.isArray(h)&&(u.easing=h);const p={delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:n+1,direction:a==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),r.animate(u,p)}function X_(r){return typeof r=="function"&&"applyToOptions"in r}function r6({type:r,...e}){return X_(r)&&q_()?r.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class n6 extends eb{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:t,name:s,keyframes:i,pseudoElement:n,allowFlatten:a=!1,finalKeyframe:o,onComplete:l}=e;this.isPseudoElement=!!n,this.allowFlatten=a,this.options=e,Ux(typeof e.type!="string");const d=r6(e);this.animation=i6(t,s,i,d,n),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!n){const u=Zx(i,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(u):ZV(t,s,u),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return cr(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+cr(e)}get time(){return cr(Number(this.animation.currentTime)||0)}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=wn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&e6()?(this.animation.timeline=e,fr):t(this)}}const K_={anticipate:j_,backInOut:A_,circInOut:E_};function a6(r){return r in K_}function o6(r){typeof r.ease=="string"&&a6(r.ease)&&(r.ease=K_[r.ease])}const rf=10;class c6 extends n6{constructor(e){o6(e),G_(e),super(e),e.startTime!==void 0&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:i,element:n,...a}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const o=new tb({...a,autoplay:!1}),l=Math.max(rf,di.now()-this.startTime),d=Hr(0,rf,l-rf);t.setWithVelocity(o.sample(Math.max(0,l-d)).value,o.sample(l).value,d),o.stop()}}const Zw=(r,e)=>e==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(va.test(r)||r==="0")&&!r.startsWith("url("));function l6(r){const e=r[0];if(r.length===1)return!0;for(let t=0;t<r.length;t++)if(r[t]!==e)return!0}function d6(r,e,t,s){const i=r[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const n=r[r.length-1],a=Zw(i,e),o=Zw(n,e);return!a||!o?!1:l6(r)||(t==="spring"||X_(t))&&s}function B0(r){r.duration=0,r.type="keyframes"}const u6=new Set(["opacity","clipPath","filter","transform"]),h6=Gx(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function p6(r){const{motionValue:e,name:t,repeatDelay:s,repeatType:i,damping:n,type:a}=r;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:d}=e.owner.getProps();return h6()&&t&&u6.has(t)&&(t!=="transform"||!d)&&!l&&!s&&i!=="mirror"&&n!==0&&a!=="inertia"}const m6=40;class f6 extends eb{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:n=0,repeatType:a="loop",keyframes:o,name:l,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=di.now();const p={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:n,repeatType:a,name:l,motionValue:d,element:u,...h},m=u?.KeyframeResolver||sb;this.keyframeResolver=new m(o,(f,g,y)=>this.onKeyframesResolved(f,g,p,!y),l,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,i){this.keyframeResolver=void 0;const{name:n,type:a,velocity:o,delay:l,isHandoff:d,onUpdate:u}=s;this.resolvedAt=di.now(),d6(e,n,a,o)||((An.instantAnimations||!l)&&u?.(Zx(e,s,t)),e[0]=e[e.length-1],B0(s),s.repeat=0);const p={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>m6?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},m=!d&&p6(p),f=p.motionValue?.owner?.current,g=m?new c6({...p,element:f}):new tb(p);g.finished.then(()=>{this.notifyFinished()}).catch(fr),this.pendingTimeline&&(this.stopTimeline=g.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=g}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),QV()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}function Q_(r,e,t,s=0,i=1){const n=Array.from(r).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=r.size,o=(a-1)*s;return typeof t=="function"?t(n,a):i===1?n*s:o-n*s}const g6=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function y6(r){const e=g6.exec(r);if(!e)return[,];const[,t,s,i]=e;return[`--${t??s}`,i]}function J_(r,e,t=1){const[s,i]=y6(r);if(!s)return;const n=window.getComputedStyle(e).getPropertyValue(s);if(n){const a=n.trim();return x_(a)?parseFloat(a):a}return Hx(i)?J_(i,e,t+1):i}const x6={type:"spring",stiffness:500,damping:25,restSpeed:10},b6=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),v6={type:"keyframes",duration:.8},w6={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},k6=(r,{keyframes:e})=>e.length>2?v6:dl.has(r)?r.startsWith("scale")?b6(e[1]):x6:w6,C6=r=>r!==null;function S6(r,{repeat:e,repeatType:t="loop"},s){const i=r.filter(C6),n=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[n]}function ib(r,e){return r?.[e]??r?.default??r}function T6({when:r,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:i,repeat:n,repeatType:a,repeatDelay:o,from:l,elapsed:d,...u}){return!!Object.keys(u).length}const rb=(r,e,t,s={},i,n)=>a=>{const o=ib(s,r)||{},l=o.delay||s.delay||0;let{elapsed:d=0}=s;d=d-wn(l);const u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-d,onUpdate:p=>{e.set(p),o.onUpdate&&o.onUpdate(p)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:r,motionValue:e,element:n?void 0:i};T6(o)||Object.assign(u,k6(r,u)),u.duration&&(u.duration=wn(u.duration)),u.repeatDelay&&(u.repeatDelay=wn(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(B0(u),u.delay===0&&(h=!0)),(An.instantAnimations||An.skipAnimations)&&(h=!0,B0(u),u.delay=0),u.allowFlatten=!o.type&&!o.ease,h&&!n&&e.get()!==void 0){const p=S6(u.keyframes,o);if(p!==void 0){Ft.update(()=>{u.onUpdate(p),u.onComplete()});return}}return o.isSync?new tb(u):new f6(u)};function ek(r){const e=[{},{}];return r?.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function nb(r,e,t,s){if(typeof e=="function"){const[i,n]=ek(s);e=e(t!==void 0?t:r.custom,i,n)}if(typeof e=="string"&&(e=r.variants&&r.variants[e]),typeof e=="function"){const[i,n]=ek(s);e=e(t!==void 0?t:r.custom,i,n)}return e}function Ac(r,e,t){const s=r.getProps();return nb(s,e,t!==void 0?t:s.custom,r)}const Z_=new Set(["width","height","top","left","right","bottom",...ll]),tk=30,A6=r=>!isNaN(parseFloat(r));class j6{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const i=di.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const n of this.dependents)n.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=di.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=A6(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Wx);const s=this.events[e].add(t);return e==="change"?()=>{s(),Ft.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=di.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>tk)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,tk);return w_(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Yc(r,e){return new j6(r,e)}const L0=r=>Array.isArray(r);function _6(r,e,t){r.hasValue(e)?r.getValue(e).set(t):r.addValue(e,Yc(t))}function E6(r){return L0(r)?r[r.length-1]||0:r}function M6(r,e){const t=Ac(r,e);let{transitionEnd:s={},transition:i={},...n}=t||{};n={...n,...s};for(const a in n){const o=E6(n[a]);_6(r,a,o)}}const Zs=r=>!!(r&&r.getVelocity);function P6(r){return!!(Zs(r)&&r.add)}function O0(r,e){const t=r.getValue("willChange");if(P6(t))return t.add(e);if(!t&&An.WillChange){const s=new An.WillChange("auto");r.addValue("willChange",s),s.add(e)}}function ab(r){return r.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}const N6="framerAppearId",eE="data-"+ab(N6);function tE(r){return r.props[eE]}function R6({protectedKeys:r,needsAnimating:e},t){const s=r.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function sE(r,e,{delay:t=0,transitionOverride:s,type:i}={}){let{transition:n=r.getDefaultTransition(),transitionEnd:a,...o}=e;s&&(n=s);const l=[],d=i&&r.animationState&&r.animationState.getState()[i];for(const u in o){const h=r.getValue(u,r.latestValues[u]??null),p=o[u];if(p===void 0||d&&R6(d,u))continue;const m={delay:t,...ib(n||{},u)},f=h.get();if(f!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===f&&!m.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const x=tE(r);if(x){const v=window.MotionHandoffAnimation(x,u,Ft);v!==null&&(m.startTime=v,g=!0)}}O0(r,u),h.start(rb(u,h,p,r.shouldReduceMotion&&Z_.has(u)?{type:!1}:m,r,g));const y=h.animation;y&&l.push(y)}return a&&Promise.all(l).then(()=>{Ft.update(()=>{a&&M6(r,a)})}),l}function $0(r,e,t={}){const s=Ac(r,e,t.type==="exit"?r.presenceContext?.custom:void 0);let{transition:i=r.getDefaultTransition()||{}}=s||{};t.transitionOverride&&(i=t.transitionOverride);const n=s?()=>Promise.all(sE(r,s,t)):()=>Promise.resolve(),a=r.variantChildren&&r.variantChildren.size?(l=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=i;return I6(r,e,l,d,u,h,t)}:()=>Promise.resolve(),{when:o}=i;if(o){const[l,d]=o==="beforeChildren"?[n,a]:[a,n];return l().then(()=>d())}else return Promise.all([n(),a(t.delay)])}function I6(r,e,t=0,s=0,i=0,n=1,a){const o=[];for(const l of r.variantChildren)l.notify("AnimationStart",e),o.push($0(l,e,{...a,delay:t+(typeof s=="function"?0:s)+Q_(r.variantChildren,l,s,i,n)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(o)}function D6(r,e,t={}){r.notify("AnimationStart",e);let s;if(Array.isArray(e)){const i=e.map(n=>$0(r,n,t));s=Promise.all(i)}else if(typeof e=="string")s=$0(r,e,t);else{const i=typeof e=="function"?Ac(r,e,t.custom):e;s=Promise.all(sE(r,i,t))}return s.then(()=>{r.notify("AnimationComplete",e)})}const F6={test:r=>r==="auto",parse:r=>r},iE=r=>e=>e.test(r),rE=[cl,Be,Gr,Jn,lV,cV,F6],sk=r=>rE.find(iE(r));function B6(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||v_(r):!0}const L6=new Set(["brightness","contrast","saturate","opacity"]);function O6(r){const[e,t]=r.slice(0,-1).split("(");if(e==="drop-shadow")return r;const[s]=t.match(Xx)||[];if(!s)return r;const i=t.replace(s,"");let n=L6.has(e)?1:0;return s!==t&&(n*=100),e+"("+n+i+")"}const $6=/\b([a-z-]*)\(.*?\)/gu,z0={...va,getAnimatableNone:r=>{const e=r.match($6);return e?e.map(O6).join(" "):r}},ik={...cl,transform:Math.round},z6={rotate:Jn,rotateX:Jn,rotateY:Jn,rotateZ:Jn,scale:Gu,scaleX:Gu,scaleY:Gu,scaleZ:Gu,skew:Jn,skewX:Jn,skewY:Jn,distance:Be,translateX:Be,translateY:Be,translateZ:Be,x:Be,y:Be,z:Be,perspective:Be,transformPerspective:Be,opacity:Yd,originX:Uw,originY:Uw,originZ:Be},ob={borderWidth:Be,borderTopWidth:Be,borderRightWidth:Be,borderBottomWidth:Be,borderLeftWidth:Be,borderRadius:Be,borderTopLeftRadius:Be,borderTopRightRadius:Be,borderBottomRightRadius:Be,borderBottomLeftRadius:Be,width:Be,maxWidth:Be,height:Be,maxHeight:Be,top:Be,right:Be,bottom:Be,left:Be,inset:Be,insetBlock:Be,insetBlockStart:Be,insetBlockEnd:Be,insetInline:Be,insetInlineStart:Be,insetInlineEnd:Be,padding:Be,paddingTop:Be,paddingRight:Be,paddingBottom:Be,paddingLeft:Be,paddingBlock:Be,paddingBlockStart:Be,paddingBlockEnd:Be,paddingInline:Be,paddingInlineStart:Be,paddingInlineEnd:Be,margin:Be,marginTop:Be,marginRight:Be,marginBottom:Be,marginLeft:Be,marginBlock:Be,marginBlockStart:Be,marginBlockEnd:Be,marginInline:Be,marginInlineStart:Be,marginInlineEnd:Be,fontSize:Be,backgroundPositionX:Be,backgroundPositionY:Be,...z6,zIndex:ik,fillOpacity:Yd,strokeOpacity:Yd,numOctaves:ik},V6={...ob,color:gs,backgroundColor:gs,outlineColor:gs,fill:gs,stroke:gs,borderColor:gs,borderTopColor:gs,borderRightColor:gs,borderBottomColor:gs,borderLeftColor:gs,filter:z0,WebkitFilter:z0},nE=r=>V6[r];function aE(r,e){let t=nE(r);return t!==z0&&(t=va),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const U6=new Set(["auto","none","0"]);function G6(r,e,t){let s=0,i;for(;s<r.length&&!i;){const n=r[s];typeof n=="string"&&!U6.has(n)&&qd(n).values.length&&(i=r[s]),s++}if(i&&t)for(const n of e)r[n]=aE(t,i)}class W6 extends sb{constructor(e,t,s,i,n){super(e,t,s,i,n,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let u=0;u<e.length;u++){let h=e[u];if(typeof h=="string"&&(h=h.trim(),Hx(h))){const p=J_(h,t.current);p!==void 0&&(e[u]=p),u===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!Z_.has(s)||e.length!==2)return;const[i,n]=e,a=sk(i),o=sk(n),l=Vw(i),d=Vw(n);if(l!==d&&sa[s]){this.needsMeasurement=!0;return}if(a!==o)if(Qw(a)&&Qw(o))for(let u=0;u<e.length;u++){const h=e[u];typeof h=="string"&&(e[u]=parseFloat(h))}else sa[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let i=0;i<e.length;i++)(e[i]===null||B6(e[i]))&&s.push(i);s.length&&G6(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=sa[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(s,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const n=s.length-1,a=s[n];s[n]=sa[t](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,l])=>{e.getValue(o).set(l)}),this.resolveNoneKeyframes()}}function Y6(r,e,t){if(r==null)return[];if(r instanceof EventTarget)return[r];if(typeof r=="string"){let s=document;const i=t?.[r]??s.querySelectorAll(r);return i?Array.from(i):[]}return Array.from(r).filter(s=>s!=null)}const oE=(r,e)=>e&&typeof r=="number"?e.transform(r):r;function V0(r){return b_(r)&&"offsetHeight"in r}const{schedule:cb}=N_(queueMicrotask,!1),Cr={x:!1,y:!1};function cE(){return Cr.x||Cr.y}function q6(r){return r==="x"||r==="y"?Cr[r]?null:(Cr[r]=!0,()=>{Cr[r]=!1}):Cr.x||Cr.y?null:(Cr.x=Cr.y=!0,()=>{Cr.x=Cr.y=!1})}function lE(r,e){const t=Y6(r),s=new AbortController,i={passive:!0,...e,signal:s.signal};return[t,i,()=>s.abort()]}function rk(r){return!(r.pointerType==="touch"||cE())}function H6(r,e,t={}){const[s,i,n]=lE(r,t),a=o=>{if(!rk(o))return;const{target:l}=o,d=e(l,o);if(typeof d!="function"||!l)return;const u=h=>{rk(h)&&(d(h),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,i)};return s.forEach(o=>{o.addEventListener("pointerenter",a,i)}),n}const dE=(r,e)=>e?r===e?!0:dE(r,e.parentElement):!1,lb=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,X6=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function uE(r){return X6.has(r.tagName)||r.isContentEditable===!0}const Nh=new WeakSet;function nk(r){return e=>{e.key==="Enter"&&r(e)}}function nf(r,e){r.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const K6=(r,e)=>{const t=r.currentTarget;if(!t)return;const s=nk(()=>{if(Nh.has(t))return;nf(t,"down");const i=nk(()=>{nf(t,"up")}),n=()=>nf(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",n,e)});t.addEventListener("keydown",s,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",s),e)};function ak(r){return lb(r)&&!cE()}function Q6(r,e,t={}){const[s,i,n]=lE(r,t),a=o=>{const l=o.currentTarget;if(!ak(o))return;Nh.add(l);const d=e(l,o),u=(m,f)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),Nh.has(l)&&Nh.delete(l),ak(m)&&typeof d=="function"&&d(m,{success:f})},h=m=>{u(m,l===window||l===document||t.useGlobalTarget||dE(l,m.target))},p=m=>{u(m,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",p,i)};return s.forEach(o=>{(t.useGlobalTarget?window:o).addEventListener("pointerdown",a,i),V0(o)&&(o.addEventListener("focus",d=>K6(d,i)),!uE(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),n}function hE(r){return b_(r)&&"ownerSVGElement"in r}function J6(r){return hE(r)&&r.tagName==="svg"}const Z6=[...rE,gs,va],e8=r=>Z6.find(iE(r)),ok=()=>({translate:0,scale:1,origin:0,originPoint:0}),pc=()=>({x:ok(),y:ok()}),ck=()=>({min:0,max:0}),Ss=()=>({x:ck(),y:ck()}),U0={current:null},pE={current:!1},t8=typeof window<"u";function s8(){if(pE.current=!0,!!t8)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),e=()=>U0.current=r.matches;r.addEventListener("change",e),e()}else U0.current=!1}const i8=new WeakMap;function Zp(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function Hd(r){return typeof r=="string"||Array.isArray(r)}const db=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ub=["initial",...db];function em(r){return Zp(r.animate)||ub.some(e=>Hd(r[e]))}function mE(r){return!!(em(r)||r.variants)}function r8(r,e,t){for(const s in e){const i=e[s],n=t[s];if(Zs(i))r.addValue(s,i);else if(Zs(n))r.addValue(s,Yc(i,{owner:r}));else if(n!==i)if(r.hasValue(s)){const a=r.getValue(s);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=r.getStaticValue(s);r.addValue(s,Yc(a!==void 0?a:i,{owner:r}))}}for(const s in t)e[s]===void 0&&r.removeValue(s);return e}const lk=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let yp={};function fE(r){yp=r}function n8(){return yp}class a8{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:n,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=sb,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=di.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Ft.render(this.render,!1,!0))};const{latestValues:l,renderState:d}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=d,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=o,this.blockInitialAnimation=!!n,this.isControllingVariants=em(t),this.isVariantNode=mE(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const p in h){const m=h[p];l[p]!==void 0&&Zs(m)&&m.set(l[p])}}mount(e){this.current=e,i8.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(pE.current||s8(),this.shouldReduceMotion=U0.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ba(this.notifyUpdate),ba(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=dl.has(e);s&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Ft.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let n;typeof window<"u"&&window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),n&&n(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in yp){const t=yp[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ss()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<lk.length;s++){const i=lk[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const n="on"+i,a=e[n];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=r8(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=Yc(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(x_(s)||v_(s))?s=parseFloat(s):!e8(s)&&va.test(t)&&(s=aE(e,t)),this.setBaseTarget(e,Zs(s)?s.get():s)),Zs(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if(typeof t=="string"||typeof t=="object"){const n=nb(this.props,t,this.presenceContext?.custom);n&&(s=n[e])}if(t&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Zs(i)?i:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Wx),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){cb.render(this.render)}}class gE extends a8{constructor(){super(...arguments),this.KeyframeResolver=W6}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){const s=e.style;return s?s[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Zs(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}class _a{constructor(e){this.isMounted=!1,this.node=e}update(){}}function yE({top:r,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:r,max:s}}}function o8({x:r,y:e}){return{top:e.min,right:r.max,bottom:e.max,left:r.min}}function c8(r,e){if(!e)return r;const t=e({x:r.left,y:r.top}),s=e({x:r.right,y:r.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function af(r){return r===void 0||r===1}function G0({scale:r,scaleX:e,scaleY:t}){return!af(r)||!af(e)||!af(t)}function so(r){return G0(r)||xE(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function xE(r){return dk(r.x)||dk(r.y)}function dk(r){return r&&r!=="0%"}function xp(r,e,t){const s=r-t,i=e*s;return t+i}function uk(r,e,t,s,i){return i!==void 0&&(r=xp(r,i,s)),xp(r,t,s)+e}function W0(r,e=0,t=1,s,i){r.min=uk(r.min,e,t,s,i),r.max=uk(r.max,e,t,s,i)}function bE(r,{x:e,y:t}){W0(r.x,e.translate,e.scale,e.originPoint),W0(r.y,t.translate,t.scale,t.originPoint)}const hk=.999999999999,pk=1.0000000000001;function l8(r,e,t,s=!1){const i=t.length;if(!i)return;e.x=e.y=1;let n,a;for(let o=0;o<i;o++){n=t[o],a=n.projectionDelta;const{visualElement:l}=n.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&n.options.layoutScroll&&n.scroll&&n!==n.root&&fc(r,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,bE(r,a)),s&&so(n.latestValues)&&fc(r,n.latestValues))}e.x<pk&&e.x>hk&&(e.x=1),e.y<pk&&e.y>hk&&(e.y=1)}function mc(r,e){r.min=r.min+e,r.max=r.max+e}function mk(r,e,t,s,i=.5){const n=Qt(r.min,r.max,i);W0(r,e,t,n,s)}function fc(r,e){mk(r.x,e.x,e.scaleX,e.scale,e.originX),mk(r.y,e.y,e.scaleY,e.scale,e.originY)}function vE(r,e){return yE(c8(r.getBoundingClientRect(),e))}function d8(r,e,t){const s=vE(r,t),{scroll:i}=e;return i&&(mc(s.x,i.offset.x),mc(s.y,i.offset.y)),s}const u8={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},h8=ll.length;function p8(r,e,t){let s="",i=!0;for(let n=0;n<h8;n++){const a=ll[n],o=r[a];if(o===void 0)continue;let l=!0;if(typeof o=="number")l=o===(a.startsWith("scale")?1:0);else{const d=parseFloat(o);l=a.startsWith("scale")?d===1:d===0}if(!l||t){const d=oE(o,ob[a]);if(!l){i=!1;const u=u8[a]||a;s+=`${u}(${d}) `}t&&(e[a]=d)}}return s=s.trim(),t?s=t(e,i?"":s):i&&(s="none"),s}function hb(r,e,t){const{style:s,vars:i,transformOrigin:n}=r;let a=!1,o=!1;for(const l in e){const d=e[l];if(dl.has(l)){a=!0;continue}else if(I_(l)){i[l]=d;continue}else{const u=oE(d,ob[l]);l.startsWith("origin")?(o=!0,n[l]=u):s[l]=u}}if(e.transform||(a||t?s.transform=p8(e,r.transform,t):s.transform&&(s.transform="none")),o){const{originX:l="50%",originY:d="50%",originZ:u=0}=n;s.transformOrigin=`${l} ${d} ${u}`}}function wE(r,{style:e,vars:t},s,i){const n=r.style;let a;for(a in e)n[a]=e[a];i?.applyProjectionStyles(n,s);for(a in t)n.setProperty(a,t[a])}function fk(r,e){return e.max===e.min?0:r/(e.max-e.min)*100}const Rl={correct:(r,e)=>{if(!e.target)return r;if(typeof r=="string")if(Be.test(r))r=parseFloat(r);else return r;const t=fk(r,e.target.x),s=fk(r,e.target.y);return`${t}% ${s}%`}},m8={correct:(r,{treeScale:e,projectionDelta:t})=>{const s=r,i=va.parse(r);if(i.length>5)return s;const n=va.createTransformer(r),a=typeof i[0]!="number"?1:0,o=t.x.scale*e.x,l=t.y.scale*e.y;i[0+a]/=o,i[1+a]/=l;const d=Qt(o,l,.5);return typeof i[2+a]=="number"&&(i[2+a]/=d),typeof i[3+a]=="number"&&(i[3+a]/=d),n(i)}},Y0={borderRadius:{...Rl,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Rl,borderTopRightRadius:Rl,borderBottomLeftRadius:Rl,borderBottomRightRadius:Rl,boxShadow:m8};function kE(r,{layout:e,layoutId:t}){return dl.has(r)||r.startsWith("origin")||(e||t!==void 0)&&(!!Y0[r]||r==="opacity")}function pb(r,e,t){const s=r.style,i=e?.style,n={};if(!s)return n;for(const a in s)(Zs(s[a])||i&&Zs(i[a])||kE(a,r)||t?.getValue(a)?.liveStyle!==void 0)&&(n[a]=s[a]);return n}function f8(r){return window.getComputedStyle(r)}class g8 extends gE{constructor(){super(...arguments),this.type="html",this.renderInstance=wE}readValueFromInstance(e,t){if(dl.has(t))return this.projection?.isProjecting?N0(t):YV(e,t);{const s=f8(e),i=(I_(t)?s.getPropertyValue(t):s[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return vE(e,t)}build(e,t,s){hb(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return pb(e,t,s)}}const y8={offset:"stroke-dashoffset",array:"stroke-dasharray"},x8={offset:"strokeDashoffset",array:"strokeDasharray"};function b8(r,e,t=1,s=0,i=!0){r.pathLength=1;const n=i?y8:x8;r[n.offset]=`${-s}`,r[n.array]=`${e} ${t}`}const v8=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function CE(r,{attrX:e,attrY:t,attrScale:s,pathLength:i,pathSpacing:n=1,pathOffset:a=0,...o},l,d,u){if(hb(r,o,d),l){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:h,style:p}=r;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=u?.transformBox??"fill-box",delete h.transformBox);for(const m of v8)h[m]!==void 0&&(p[m]=h[m],delete h[m]);e!==void 0&&(h.x=e),t!==void 0&&(h.y=t),s!==void 0&&(h.scale=s),i!==void 0&&b8(h,i,n,a,!1)}const SE=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),TE=r=>typeof r=="string"&&r.toLowerCase()==="svg";function w8(r,e,t,s){wE(r,e,void 0,s);for(const i in e.attrs)r.setAttribute(SE.has(i)?i:ab(i),e.attrs[i])}function AE(r,e,t){const s=pb(r,e,t);for(const i in r)if(Zs(r[i])||Zs(e[i])){const n=ll.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[n]=r[i]}return s}class k8 extends gE{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ss}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(dl.has(t)){const s=nE(t);return s&&s.default||0}return t=SE.has(t)?t:ab(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return AE(e,t,s)}build(e,t,s){CE(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,i){w8(e,t,s,i)}mount(e){this.isSVGTag=TE(e.tagName),super.mount(e)}}const C8=ub.length;function jE(r){if(!r)return;if(!r.isControllingVariants){const t=r.parent?jE(r.parent)||{}:{};return r.props.initial!==void 0&&(t.initial=r.props.initial),t}const e={};for(let t=0;t<C8;t++){const s=ub[t],i=r.props[s];(Hd(i)||i===!1)&&(e[s]=i)}return e}function _E(r,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==r.length)return!1;for(let s=0;s<t;s++)if(e[s]!==r[s])return!1;return!0}const S8=[...db].reverse(),T8=db.length;function A8(r){return e=>Promise.all(e.map(({animation:t,options:s})=>D6(r,t,s)))}function j8(r){let e=A8(r),t=gk(),s=!0;const i=l=>(d,u)=>{const h=Ac(r,u,l==="exit"?r.presenceContext?.custom:void 0);if(h){const{transition:p,transitionEnd:m,...f}=h;d={...d,...f,...m}}return d};function n(l){e=l(r)}function a(l){const{props:d}=r,u=jE(r.parent)||{},h=[],p=new Set;let m={},f=1/0;for(let y=0;y<T8;y++){const x=S8[y],v=t[x],b=d[x]!==void 0?d[x]:u[x],S=Hd(b),k=x===l?v.isActive:null;k===!1&&(f=y);let C=b===u[x]&&b!==d[x]&&S;if(C&&s&&r.manuallyAnimateOnMount&&(C=!1),v.protectedKeys={...m},!v.isActive&&k===null||!b&&!v.prevProp||Zp(b)||typeof b=="boolean")continue;const A=_8(v.prevProp,b);let T=A||x===l&&v.isActive&&!C&&S||y>f&&S,j=!1;const _=Array.isArray(b)?b:[b];let M=_.reduce(i(x),{});k===!1&&(M={});const{prevResolvedValues:E={}}=v,D={...E,...M},R=F=>{T=!0,p.has(F)&&(j=!0,p.delete(F)),v.needsAnimating[F]=!0;const I=r.getValue(F);I&&(I.liveStyle=!1)};for(const F in D){const I=M[F],K=E[F];if(m.hasOwnProperty(F))continue;let ee=!1;L0(I)&&L0(K)?ee=!_E(I,K):ee=I!==K,ee?I!=null?R(F):p.add(F):I!==void 0&&p.has(F)?R(F):v.protectedKeys[F]=!0}v.prevProp=b,v.prevResolvedValues=M,v.isActive&&(m={...m,...M}),s&&r.blockInitialAnimation&&(T=!1);const B=C&&A;T&&(!B||j)&&h.push(..._.map(F=>{const I={type:x};if(typeof F=="string"&&s&&!B&&r.manuallyAnimateOnMount&&r.parent){const{parent:K}=r,ee=Ac(K,F);if(K.enteringChildren&&ee){const{delayChildren:P}=ee.transition||{};I.delay=Q_(K.enteringChildren,r,P)}}return{animation:F,options:I}}))}if(p.size){const y={};if(typeof d.initial!="boolean"){const x=Ac(r,Array.isArray(d.initial)?d.initial[0]:d.initial);x&&x.transition&&(y.transition=x.transition)}p.forEach(x=>{const v=r.getBaseTarget(x),b=r.getValue(x);b&&(b.liveStyle=!0),y[x]=v??null}),h.push({animation:y})}let g=!!h.length;return s&&(d.initial===!1||d.initial===d.animate)&&!r.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(h):Promise.resolve()}function o(l,d){if(t[l].isActive===d)return Promise.resolve();r.variantChildren?.forEach(h=>h.animationState?.setActive(l,d)),t[l].isActive=d;const u=a(l);for(const h in t)t[h].protectedKeys={};return u}return{animateChanges:a,setActive:o,setAnimateFunction:n,getState:()=>t,reset:()=>{t=gk()}}}function _8(r,e){return typeof e=="string"?e!==r:Array.isArray(e)?!_E(e,r):!1}function Va(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function gk(){return{animate:Va(!0),whileInView:Va(),whileHover:Va(),whileTap:Va(),whileDrag:Va(),whileFocus:Va(),exit:Va()}}function yk(r,e){r.min=e.min,r.max=e.max}function xr(r,e){yk(r.x,e.x),yk(r.y,e.y)}function xk(r,e){r.translate=e.translate,r.scale=e.scale,r.originPoint=e.originPoint,r.origin=e.origin}const EE=1e-4,E8=1-EE,M8=1+EE,ME=.01,P8=0-ME,N8=0+ME;function ui(r){return r.max-r.min}function R8(r,e,t){return Math.abs(r-e)<=t}function bk(r,e,t,s=.5){r.origin=s,r.originPoint=Qt(e.min,e.max,r.origin),r.scale=ui(t)/ui(e),r.translate=Qt(t.min,t.max,r.origin)-r.originPoint,(r.scale>=E8&&r.scale<=M8||isNaN(r.scale))&&(r.scale=1),(r.translate>=P8&&r.translate<=N8||isNaN(r.translate))&&(r.translate=0)}function wd(r,e,t,s){bk(r.x,e.x,t.x,s?s.originX:void 0),bk(r.y,e.y,t.y,s?s.originY:void 0)}function vk(r,e,t){r.min=t.min+e.min,r.max=r.min+ui(e)}function I8(r,e,t){vk(r.x,e.x,t.x),vk(r.y,e.y,t.y)}function wk(r,e,t){r.min=e.min-t.min,r.max=r.min+ui(e)}function bp(r,e,t){wk(r.x,e.x,t.x),wk(r.y,e.y,t.y)}function kk(r,e,t,s,i){return r-=e,r=xp(r,1/t,s),i!==void 0&&(r=xp(r,1/i,s)),r}function D8(r,e=0,t=1,s=.5,i,n=r,a=r){if(Gr.test(e)&&(e=parseFloat(e),e=Qt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=Qt(n.min,n.max,s);r===n&&(o-=e),r.min=kk(r.min,e,t,o,i),r.max=kk(r.max,e,t,o,i)}function Ck(r,e,[t,s,i],n,a){D8(r,e[t],e[s],e[i],e.scale,n,a)}const F8=["x","scaleX","originX"],B8=["y","scaleY","originY"];function Sk(r,e,t,s){Ck(r.x,e,F8,t?t.x:void 0,s?s.x:void 0),Ck(r.y,e,B8,t?t.y:void 0,s?s.y:void 0)}function Tk(r){return r.translate===0&&r.scale===1}function PE(r){return Tk(r.x)&&Tk(r.y)}function Ak(r,e){return r.min===e.min&&r.max===e.max}function L8(r,e){return Ak(r.x,e.x)&&Ak(r.y,e.y)}function jk(r,e){return Math.round(r.min)===Math.round(e.min)&&Math.round(r.max)===Math.round(e.max)}function NE(r,e){return jk(r.x,e.x)&&jk(r.y,e.y)}function _k(r){return ui(r.x)/ui(r.y)}function Ek(r,e){return r.translate===e.translate&&r.scale===e.scale&&r.originPoint===e.originPoint}function sr(r){return[r("x"),r("y")]}function O8(r,e,t){let s="";const i=r.x.translate/e.x,n=r.y.translate/e.y,a=t?.z||0;if((i||n||a)&&(s=`translate3d(${i}px, ${n}px, ${a}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:m,skewY:f}=t;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),p&&(s+=`rotateY(${p}deg) `),m&&(s+=`skewX(${m}deg) `),f&&(s+=`skewY(${f}deg) `)}const o=r.x.scale*e.x,l=r.y.scale*e.y;return(o!==1||l!==1)&&(s+=`scale(${o}, ${l})`),s||"none"}const RE=["TopLeft","TopRight","BottomLeft","BottomRight"],$8=RE.length,Mk=r=>typeof r=="string"?parseFloat(r):r,Pk=r=>typeof r=="number"||Be.test(r);function z8(r,e,t,s,i,n){i?(r.opacity=Qt(0,t.opacity??1,V8(s)),r.opacityExit=Qt(e.opacity??1,0,U8(s))):n&&(r.opacity=Qt(e.opacity??1,t.opacity??1,s));for(let a=0;a<$8;a++){const o=`border${RE[a]}Radius`;let l=Nk(e,o),d=Nk(t,o);if(l===void 0&&d===void 0)continue;l||(l=0),d||(d=0),l===0||d===0||Pk(l)===Pk(d)?(r[o]=Math.max(Qt(Mk(l),Mk(d),s),0),(Gr.test(d)||Gr.test(l))&&(r[o]+="%")):r[o]=d}(e.rotate||t.rotate)&&(r.rotate=Qt(e.rotate||0,t.rotate||0,s))}function Nk(r,e){return r[e]!==void 0?r[e]:r.borderRadius}const V8=IE(0,.5,__),U8=IE(.5,.95,fr);function IE(r,e,t){return s=>s<r?0:s>e?1:t(Wd(r,e,s))}function G8(r,e,t){const s=Zs(r)?r:Yc(r);return s.start(rb("",s,e,t)),s.animation}function Xd(r,e,t,s={passive:!0}){return r.addEventListener(e,t,s),()=>r.removeEventListener(e,t)}const W8=(r,e)=>r.depth-e.depth;class Y8{constructor(){this.children=[],this.isDirty=!1}add(e){zx(this.children,e),this.isDirty=!0}remove(e){Vx(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(W8),this.isDirty=!1,this.children.forEach(e)}}function q8(r,e){const t=di.now(),s=({timestamp:i})=>{const n=i-t;n>=e&&(ba(s),r(n-e))};return Ft.setup(s,!0),()=>ba(s)}function Rh(r){return Zs(r)?r.get():r}class H8{constructor(){this.members=[]}add(e){zx(this.members,e),e.scheduleRender()}remove(e){if(Vx(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let s;for(let i=t;i>=0;i--){const n=this.members[i];if(n.isPresent!==!1){s=n;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender();const i=s.options.layoutDependency,n=e.options.layoutDependency;i!==void 0&&n!==void 0&&i===n||(e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0));const{crossfade:o}=e.options;o===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Ih={hasAnimatedSinceResize:!0,hasEverUpdated:!1},of=["","X","Y","Z"],X8=1e3;let K8=0;function cf(r,e,t,s){const{latestValues:i}=e;i[r]&&(t[r]=i[r],e.setStaticValue(r,0),s&&(s[r]=0))}function DE(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:e}=r.options;if(!e)return;const t=tE(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:n}=r.options;window.MotionCancelOptimisedAnimation(t,"transform",Ft,!(i||n))}const{parent:s}=r;s&&!s.hasCheckedOptimisedAppear&&DE(s)}function FE({attachResizeListener:r,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(a={},o=e?.()){this.id=K8++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Z8),this.nodes.forEach(iU),this.nodes.forEach(rU),this.nodes.forEach(eU)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Y8)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Wx),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=hE(a)&&!J6(a),this.instance=a;const{layoutId:o,layout:l,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||o)&&(this.isLayoutDirty=!0),r){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;Ft.read(()=>{h=window.innerWidth}),r(a,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,u&&u(),u=q8(p,250),Ih.hasAnimatedSinceResize&&(Ih.hasAnimatedSinceResize=!1,this.nodes.forEach(Dk)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&d&&(o||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const f=this.options.transition||d.getDefaultTransition()||lU,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=d.getProps(),x=!this.targetLayout||!NE(this.targetLayout,m),v=!h&&p;if(this.options.layoutRoot||this.resumeFrom||v||h&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const b={...ib(f,"layout"),onPlay:g,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(b.delay=0,b.type=!1),this.startAnimation(b),this.setAnimationOrigin(u,v)}else h||Dk(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ba(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(nU),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&DE(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Rk);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Ik);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(sU),this.nodes.forEach(Q8),this.nodes.forEach(J8)):this.nodes.forEach(Ik),this.clearAllSnapshots();const o=di.now();Bs.delta=Hr(0,1e3/60,o-Bs.timestamp),Bs.timestamp=o,Bs.isProcessing=!0,Jm.update.process(Bs),Jm.preRender.process(Bs),Jm.render.process(Bs),Bs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,cb.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(tU),this.sharedNodes.forEach(aU)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ft.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ft.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ui(this.snapshot.measuredBox.x)&&!ui(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Ss(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&this.instance){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!PE(this.projectionDelta),l=this.getTransformTemplate(),d=l?l(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(o||so(this.latestValues)||u)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),dU(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return Ss();const o=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(uU))){const{scroll:d}=this.root;d&&(mc(o.x,d.offset.x),mc(o.y,d.offset.y))}return o}removeElementScroll(a){const o=Ss();if(xr(o,a),this.scroll?.wasRoot)return o;for(let l=0;l<this.path.length;l++){const d=this.path[l],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&xr(o,a),mc(o.x,u.offset.x),mc(o.y,u.offset.y))}return o}applyTransform(a,o=!1){const l=Ss();xr(l,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&fc(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),so(u.latestValues)&&fc(l,u.latestValues)}return so(this.latestValues)&&fc(l,this.latestValues),l}removeTransform(a){const o=Ss();xr(o,a);for(let l=0;l<this.path.length;l++){const d=this.path[l];if(!d.instance||!so(d.latestValues))continue;G0(d.latestValues)&&d.updateSnapshot();const u=Ss(),h=d.measurePageBox();xr(u,h),Sk(o,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return so(this.latestValues)&&Sk(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Bs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==o;if(!(a||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=Bs.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ss(),this.targetWithTransforms=Ss()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),I8(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):xr(this.target,this.layout.layoutBox),bE(this.target,this.targetDelta)):xr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||G0(this.parent.latestValues)||xE(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,o,l){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ss(),this.relativeTargetOrigin=Ss(),bp(this.relativeTargetOrigin,o,l),xr(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const a=this.getLead(),o=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Bs.timestamp&&(l=!1),l)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;xr(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;l8(this.layoutCorrected,this.treeScale,this.path,o),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Ss());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(xk(this.prevProjectionDelta.x,this.projectionDelta.x),xk(this.prevProjectionDelta.y,this.projectionDelta.y)),wd(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!Ek(this.projectionDelta.x,this.prevProjectionDelta.x)||!Ek(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=pc(),this.projectionDelta=pc(),this.projectionDeltaWithTransform=pc()}setAnimationOrigin(a,o=!1){const l=this.snapshot,d=l?l.latestValues:{},u={...this.latestValues},h=pc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const p=Ss(),m=l?l.source:void 0,f=this.layout?this.layout.source:void 0,g=m!==f,y=this.getStack(),x=!y||y.members.length<=1,v=!!(g&&!x&&this.options.crossfade===!0&&!this.path.some(cU));this.animationProgress=0;let b;this.mixTargetDelta=S=>{const k=S/1e3;Fk(h.x,a.x,k),Fk(h.y,a.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(bp(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),oU(this.relativeTarget,this.relativeTargetOrigin,p,k),b&&L8(this.relativeTarget,b)&&(this.isProjectionDirty=!1),b||(b=Ss()),xr(b,this.relativeTarget)),g&&(this.animationValues=u,z8(u,d,this.latestValues,k,v,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ba(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ft.update(()=>{Ih.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Yc(0)),this.currentAnimation=G8(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(X8),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:d,latestValues:u}=a;if(!(!o||!l||!d)){if(this!==a&&this.layout&&d&&BE(this.options.animationType,this.layout.layoutBox,d.layoutBox)){l=this.target||Ss();const h=ui(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const p=ui(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+p}xr(o,l),fc(o,u),wd(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new H8),this.sharedNodes.get(a).add(o);const d=o.options.initialPromotionConfig;o.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const d=this.getStack();d&&d.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const d={};l.z&&cf("z",a,d,this.animationValues);for(let u=0;u<of.length;u++)cf(`rotate${of[u]}`,a,d,this.animationValues),cf(`skew${of[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=Rh(o?.pointerEvents)||"",a.transform=l?l(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=Rh(o?.pointerEvents)||""),this.hasProjected&&!so(this.latestValues)&&(a.transform=l?l({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=O8(this.projectionDeltaWithTransform,this.treeScale,u);l&&(h=l(u,h)),a.transform=h;const{x:p,y:m}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${m.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const f in Y0){if(u[f]===void 0)continue;const{correct:g,applyTo:y,isCSSVariable:x}=Y0[f],v=h==="none"?u[f]:g(u[f],d);if(y){const b=y.length;for(let S=0;S<b;S++)a[y[S]]=v}else x?this.options.visualElement.renderState.vars[f]=v:a[f]=v}this.options.layoutId&&(a.pointerEvents=d===this?Rh(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(Rk),this.root.sharedNodes.clear()}}}function Q8(r){r.updateLayout()}function J8(r){const e=r.resumeFrom?.snapshot||r.snapshot;if(r.isLead()&&r.layout&&e&&r.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:s}=r.layout,{animationType:i}=r.options,n=e.source!==r.layout.source;i==="size"?sr(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=ui(h);h.min=t[u].min,h.max=h.min+p}):BE(i,e.layoutBox,t)&&sr(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=ui(t[u]);h.max=h.min+p,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[u].max=r.relativeTarget[u].min+p)});const a=pc();wd(a,t,e.layoutBox);const o=pc();n?wd(o,r.applyTransform(s,!0),e.measuredBox):wd(o,t,e.layoutBox);const l=!PE(a);let d=!1;if(!r.resumeFrom){const u=r.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:p}=u;if(h&&p){const m=Ss();bp(m,e.layoutBox,h.layoutBox);const f=Ss();bp(f,t,p.layoutBox),NE(m,f)||(d=!0),u.options.layoutRoot&&(r.relativeTarget=f,r.relativeTargetOrigin=m,r.relativeParent=u)}}}r.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:d})}else if(r.isLead()){const{onExitComplete:t}=r.options;t&&t()}r.options.transition=void 0}function Z8(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function eU(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function tU(r){r.clearSnapshot()}function Rk(r){r.clearMeasurements()}function Ik(r){r.isLayoutDirty=!1}function sU(r){const{visualElement:e}=r.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),r.resetTransform()}function Dk(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function iU(r){r.resolveTargetDelta()}function rU(r){r.calcProjection()}function nU(r){r.resetSkewAndRotation()}function aU(r){r.removeLeadSnapshot()}function Fk(r,e,t){r.translate=Qt(e.translate,0,t),r.scale=Qt(e.scale,1,t),r.origin=e.origin,r.originPoint=e.originPoint}function Bk(r,e,t,s){r.min=Qt(e.min,t.min,s),r.max=Qt(e.max,t.max,s)}function oU(r,e,t,s){Bk(r.x,e.x,t.x,s),Bk(r.y,e.y,t.y,s)}function cU(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const lU={duration:.45,ease:[.4,0,.1,1]},Lk=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),Ok=Lk("applewebkit/")&&!Lk("chrome/")?Math.round:fr;function $k(r){r.min=Ok(r.min),r.max=Ok(r.max)}function dU(r){$k(r.x),$k(r.y)}function BE(r,e,t){return r==="position"||r==="preserve-aspect"&&!R8(_k(e),_k(t),.2)}function uU(r){return r!==r.root&&r.scroll?.wasRoot}const hU=FE({attachResizeListener:(r,e)=>Xd(r,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body?.scrollLeft||0,y:document.documentElement.scrollTop||document.body?.scrollTop||0}),checkIsScrollRoot:()=>!0}),pU=r=>!r.isLayoutDirty&&r.willUpdate(!1);function zk(){const r=new Set,e=new WeakMap,t=()=>r.forEach(pU);return{add:s=>{r.add(s),e.set(s,s.addEventListener("willUpdate",t))},remove:s=>{r.delete(s);const i=e.get(s);i&&(i(),e.delete(s)),t()},dirty:t}}const lf={current:void 0},LE=FE({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!lf.current){const r=new hU({});r.mount(window),r.setOptions({layoutScroll:!0}),lf.current=r}return lf.current},resetTransform:(r,e)=>{r.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),mb=w.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function Vk(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function mU(...r){return e=>{let t=!1;const s=r.map(i=>{const n=Vk(i,e);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let i=0;i<s.length;i++){const n=s[i];typeof n=="function"?n():Vk(r[i],null)}}}}function fU(...r){return w.useCallback(mU(...r),r)}class gU extends w.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=t.offsetParent,i=V0(s)&&s.offsetWidth||0,n=V0(s)&&s.offsetHeight||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=i-a.width-a.left,a.bottom=n-a.height-a.top}return null}componentDidUpdate(){}render(){return this.props.children}}function yU({children:r,isPresent:e,anchorX:t,anchorY:s,root:i}){const n=w.useId(),a=w.useRef(null),o=w.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:l}=w.useContext(mb),d=r.props?.ref??r?.ref,u=fU(a,d);return w.useInsertionEffect(()=>{const{width:h,height:p,top:m,left:f,right:g,bottom:y}=o.current;if(e||!a.current||!h||!p)return;const x=t==="left"?`left: ${f}`:`right: ${g}`,v=s==="bottom"?`bottom: ${y}`:`top: ${m}`;a.current.dataset.motionPopId=n;const b=document.createElement("style");l&&(b.nonce=l);const S=i??document.head;return S.appendChild(b),b.sheet&&b.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${h}px !important;
            height: ${p}px !important;
            ${x}px !important;
            ${v}px !important;
          }
        `),()=>{S.contains(b)&&S.removeChild(b)}},[e]),c.jsx(gU,{isPresent:e,childRef:a,sizeRef:o,children:w.cloneElement(r,{ref:u})})}const xU=({children:r,initial:e,isPresent:t,onExitComplete:s,custom:i,presenceAffectsLayout:n,mode:a,anchorX:o,anchorY:l,root:d})=>{const u=Ox(bU),h=w.useId();let p=!0,m=w.useMemo(()=>(p=!1,{id:h,initial:e,isPresent:t,custom:i,onExitComplete:f=>{u.set(f,!0);for(const g of u.values())if(!g)return;s&&s()},register:f=>(u.set(f,!1),()=>u.delete(f))}),[t,u,s]);return n&&p&&(m={...m}),w.useMemo(()=>{u.forEach((f,g)=>u.set(g,!1))},[t]),w.useEffect(()=>{!t&&!u.size&&s&&s()},[t]),a==="popLayout"&&(r=c.jsx(yU,{isPresent:t,anchorX:o,anchorY:l,root:d,children:r})),c.jsx(Jp.Provider,{value:m,children:r})};function bU(){return new Map}function OE(r=!0){const e=w.useContext(Jp);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:i}=e,n=w.useId();w.useEffect(()=>{if(r)return i(n)},[r]);const a=w.useCallback(()=>r&&s&&s(n),[n,s,r]);return!t&&s?[!1,a]:[!0]}const Wu=r=>r.key||"";function Uk(r){const e=[];return w.Children.forEach(r,t=>{w.isValidElement(t)&&e.push(t)}),e}const $E=({children:r,custom:e,initial:t=!0,onExitComplete:s,presenceAffectsLayout:i=!0,mode:n="sync",propagate:a=!1,anchorX:o="left",anchorY:l="top",root:d})=>{const[u,h]=OE(a),p=w.useMemo(()=>Uk(r),[r]),m=a&&!u?[]:p.map(Wu),f=w.useRef(!0),g=w.useRef(p),y=Ox(()=>new Map),x=w.useRef(new Set),[v,b]=w.useState(p),[S,k]=w.useState(p);$x(()=>{f.current=!1,g.current=p;for(let T=0;T<S.length;T++){const j=Wu(S[T]);m.includes(j)?(y.delete(j),x.current.delete(j)):y.get(j)!==!0&&y.set(j,!1)}},[S,m.length,m.join("-")]);const C=[];if(p!==v){let T=[...p];for(let j=0;j<S.length;j++){const _=S[j],M=Wu(_);m.includes(M)||(T.splice(j,0,_),C.push(_))}return n==="wait"&&C.length&&(T=C),k(Uk(T)),b(p),null}const{forceRender:A}=w.useContext(Gd);return c.jsx(c.Fragment,{children:S.map(T=>{const j=Wu(T),_=a&&!u?!1:p===S||m.includes(j),M=()=>{if(x.current.has(j))return;if(x.current.add(j),y.has(j))y.set(j,!0);else return;let E=!0;y.forEach(D=>{D||(E=!1)}),E&&(A?.(),k(g.current),a&&h?.(),s&&s())};return c.jsx(xU,{isPresent:_,initial:!f.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:n,root:d,onExitComplete:_?void 0:M,anchorX:o,anchorY:l,children:T},j)})})},vU=w.createContext(null);function wU(){const r=w.useRef(!1);return $x(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function kU(){const r=wU(),[e,t]=w.useState(0),s=w.useCallback(()=>{r.current&&t(e+1)},[e]);return[w.useCallback(()=>Ft.postRender(s),[s]),e]}const zE=r=>r===!0,CU=r=>zE(r===!0)||r==="id",SU=({children:r,id:e,inherit:t=!0})=>{const s=w.useContext(Gd),i=w.useContext(vU),[n,a]=kU(),o=w.useRef(null),l=s.id||i;o.current===null&&(CU(t)&&l&&(e=e?l+"-"+e:l),o.current={id:e,group:zE(t)&&s.group||zk()});const d=w.useMemo(()=>({...o.current,forceRender:n}),[a]);return c.jsx(Gd.Provider,{value:d,children:r})},VE=w.createContext({strict:!1}),Gk={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Wk=!1;function TU(){if(Wk)return;const r={};for(const e in Gk)r[e]={isEnabled:t=>Gk[e].some(s=>!!t[s])};fE(r),Wk=!0}function UE(){return TU(),n8()}function AU(r){const e=UE();for(const t in r)e[t]={...e[t],...r[t]};fE(e)}const jU=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function vp(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||jU.has(r)}let GE=r=>!vp(r);function _U(r){typeof r=="function"&&(GE=e=>e.startsWith("on")?!vp(e):r(e))}try{_U(require("@emotion/is-prop-valid").default)}catch{}function EU(r,e,t){const s={};for(const i in r)i==="values"&&typeof r.values=="object"||(GE(i)||t===!0&&vp(i)||!e&&!vp(i)||r.draggable&&i.startsWith("onDrag"))&&(s[i]=r[i]);return s}const tm=w.createContext({});function MU(r,e){if(em(r)){const{initial:t,animate:s}=r;return{initial:t===!1||Hd(t)?t:void 0,animate:Hd(s)?s:void 0}}return r.inherit!==!1?e:{}}function PU(r){const{initial:e,animate:t}=MU(r,w.useContext(tm));return w.useMemo(()=>({initial:e,animate:t}),[Yk(e),Yk(t)])}function Yk(r){return Array.isArray(r)?r.join(" "):r}const fb=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function WE(r,e,t){for(const s in e)!Zs(e[s])&&!kE(s,t)&&(r[s]=e[s])}function NU({transformTemplate:r},e){return w.useMemo(()=>{const t=fb();return hb(t,e,r),Object.assign({},t.vars,t.style)},[e])}function RU(r,e){const t=r.style||{},s={};return WE(s,t,r),Object.assign(s,NU(r,e)),s}function IU(r,e){const t={},s=RU(r,e);return r.drag&&r.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(t.tabIndex=0),t.style=s,t}const YE=()=>({...fb(),attrs:{}});function DU(r,e,t,s){const i=w.useMemo(()=>{const n=YE();return CE(n,e,TE(s),r.transformTemplate,r.style),{...n.attrs,style:{...n.style}}},[e]);if(r.style){const n={};WE(n,r.style,r),i.style={...n,...i.style}}return i}const FU=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function gb(r){return typeof r!="string"||r.includes("-")?!1:!!(FU.indexOf(r)>-1||/[A-Z]/u.test(r))}function BU(r,e,t,{latestValues:s},i,n=!1,a){const l=(a??gb(r)?DU:IU)(e,s,i,r),d=EU(e,typeof r=="string",n),u=r!==w.Fragment?{...d,...l,ref:t}:{},{children:h}=e,p=w.useMemo(()=>Zs(h)?h.get():h,[h]);return w.createElement(r,{...u,children:p})}function LU({scrapeMotionValuesFromProps:r,createRenderState:e},t,s,i){return{latestValues:OU(t,s,i,r),renderState:e()}}function OU(r,e,t,s){const i={},n=s(r,{});for(const p in n)i[p]=Rh(n[p]);let{initial:a,animate:o}=r;const l=em(r),d=mE(r);e&&d&&!l&&r.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let u=t?t.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!Zp(h)){const p=Array.isArray(h)?h:[h];for(let m=0;m<p.length;m++){const f=nb(r,p[m]);if(f){const{transitionEnd:g,transition:y,...x}=f;for(const v in x){let b=x[v];if(Array.isArray(b)){const S=u?b.length-1:0;b=b[S]}b!==null&&(i[v]=b)}for(const v in g)i[v]=g[v]}}}return i}const qE=r=>(e,t)=>{const s=w.useContext(tm),i=w.useContext(Jp),n=()=>LU(r,e,s,i);return t?n():Ox(n)},$U=qE({scrapeMotionValuesFromProps:pb,createRenderState:fb}),zU=qE({scrapeMotionValuesFromProps:AE,createRenderState:YE}),VU=Symbol.for("motionComponentSymbol");function UU(r,e,t){const s=w.useRef(t);w.useInsertionEffect(()=>{s.current=t});const i=w.useRef(null);return w.useCallback(n=>{n&&r.onMount?.(n),e&&(n?e.mount(n):e.unmount());const a=s.current;if(typeof a=="function")if(n){const o=a(n);typeof o=="function"&&(i.current=o)}else i.current?(i.current(),i.current=null):a(n);else a&&(a.current=n)},[e])}const HE=w.createContext({});function td(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function GU(r,e,t,s,i,n){const{visualElement:a}=w.useContext(tm),o=w.useContext(VE),l=w.useContext(Jp),d=w.useContext(mb).reducedMotion,u=w.useRef(null),h=w.useRef(!1);s=s||o.renderer,!u.current&&s&&(u.current=s(r,{visualState:e,parent:a,props:t,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:d,isSVG:n}),h.current&&u.current&&(u.current.manuallyAnimateOnMount=!0));const p=u.current,m=w.useContext(HE);p&&!p.projection&&i&&(p.type==="html"||p.type==="svg")&&WU(u.current,t,i,m);const f=w.useRef(!1);w.useInsertionEffect(()=>{p&&f.current&&p.update(t,l)});const g=t[eE],y=w.useRef(!!g&&!window.MotionHandoffIsComplete?.(g)&&window.MotionHasOptimisedAnimation?.(g));return $x(()=>{h.current=!0,p&&(f.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),p.scheduleRenderMicrotask(),y.current&&p.animationState&&p.animationState.animateChanges())}),w.useEffect(()=>{p&&(!y.current&&p.animationState&&p.animationState.animateChanges(),y.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(g)}),y.current=!1),p.enteringChildren=void 0)}),p}function WU(r,e,t,s){const{layoutId:i,layout:n,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:d,layoutCrossfade:u}=e;r.projection=new t(r.latestValues,e["data-framer-portal-id"]?void 0:XE(r.parent)),r.projection.setOptions({layoutId:i,layout:n,alwaysMeasureLayout:!!a||o&&td(o),visualElement:r,animationType:typeof n=="string"?n:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:l,layoutRoot:d})}function XE(r){if(r)return r.options.allowProjection!==!1?r.projection:XE(r.parent)}function df(r,{forwardMotionProps:e=!1,type:t}={},s,i){s&&AU(s);const n=t?t==="svg":gb(r),a=n?zU:$U;function o(d,u){let h;const p={...w.useContext(mb),...d,layoutId:YU(d)},{isStatic:m}=p,f=PU(d),g=a(d,m);if(!m&&y_){qU();const y=HU(p);h=y.MeasureLayout,f.visualElement=GU(r,g,p,i,y.ProjectionNode,n)}return c.jsxs(tm.Provider,{value:f,children:[h&&f.visualElement?c.jsx(h,{visualElement:f.visualElement,...p}):null,BU(r,d,UU(g,f.visualElement,u),g,m,e,n)]})}o.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const l=w.forwardRef(o);return l[VU]=r,l}function YU({layoutId:r}){const e=w.useContext(Gd).id;return e&&r!==void 0?e+"-"+r:r}function qU(r,e){w.useContext(VE).strict}function HU(r){const e=UE(),{drag:t,layout:s}=e;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:t?.isEnabled(r)||s?.isEnabled(r)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function XU(r,e){if(typeof Proxy>"u")return df;const t=new Map,s=(n,a)=>df(n,a,r,e),i=(n,a)=>s(n,a);return new Proxy(i,{get:(n,a)=>a==="create"?s:(t.has(a)||t.set(a,df(a,void 0,r,e)),t.get(a))})}const KU=(r,e)=>e.isSVG??gb(r)?new k8(e):new g8(e,{allowProjection:r!==w.Fragment});class QU extends _a{constructor(e){super(e),e.animationState||(e.animationState=j8(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Zp(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let JU=0;class ZU extends _a{constructor(){super(...arguments),this.id=JU++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const eG={animation:{Feature:QU},exit:{Feature:ZU}};function wu(r){return{point:{x:r.pageX,y:r.pageY}}}const tG=r=>e=>lb(e)&&r(e,wu(e));function kd(r,e,t,s){return Xd(r,e,tG(t),s)}const KE=({current:r})=>r?r.ownerDocument.defaultView:null,qk=(r,e)=>Math.abs(r-e);function sG(r,e){const t=qk(r.x,e.x),s=qk(r.y,e.y);return Math.sqrt(t**2+s**2)}const Hk=new Set(["auto","scroll"]);class QE{constructor(e,t,{transformPagePoint:s,contextWindow:i=window,dragSnapToOrigin:n=!1,distanceThreshold:a=3,element:o}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=m=>{this.handleScroll(m.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=hf(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,g=sG(m.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!g)return;const{point:y}=m,{timestamp:x}=Bs;this.history.push({...y,timestamp:x});const{onStart:v,onMove:b}=this.handlers;f||(v&&v(this.lastMoveEvent,m),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,m)},this.handlePointerMove=(m,f)=>{this.lastMoveEvent=m,this.lastMoveEventInfo=uf(f,this.transformPagePoint),Ft.update(this.updatePoint,!0)},this.handlePointerUp=(m,f)=>{this.end();const{onEnd:g,onSessionEnd:y,resumeAnimation:x}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const v=hf(m.type==="pointercancel"?this.lastMoveEventInfo:uf(f,this.transformPagePoint),this.history);this.startEvent&&g&&g(m,v),y&&y(m,v)},!lb(e))return;this.dragSnapToOrigin=n,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=a,this.contextWindow=i||window;const l=wu(e),d=uf(l,this.transformPagePoint),{point:u}=d,{timestamp:h}=Bs;this.history=[{...u,timestamp:h}];const{onSessionStart:p}=t;p&&p(e,hf(d,this.history)),this.removeListeners=xu(kd(this.contextWindow,"pointermove",this.handlePointerMove),kd(this.contextWindow,"pointerup",this.handlePointerUp),kd(this.contextWindow,"pointercancel",this.handlePointerUp)),o&&this.startScrollTracking(o)}startScrollTracking(e){let t=e.parentElement;for(;t;){const s=getComputedStyle(t);(Hk.has(s.overflowX)||Hk.has(s.overflowY))&&this.scrollPositions.set(t,{x:t.scrollLeft,y:t.scrollTop}),t=t.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){const t=this.scrollPositions.get(e);if(!t)return;const s=e===window,i=s?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},n={x:i.x-t.x,y:i.y-t.y};n.x===0&&n.y===0||(s?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=n.x,this.lastMoveEventInfo.point.y+=n.y):this.history.length>0&&(this.history[0].x-=n.x,this.history[0].y-=n.y),this.scrollPositions.set(e,i),Ft.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),ba(this.updatePoint)}}function uf(r,e){return e?{point:e(r.point)}:r}function Xk(r,e){return{x:r.x-e.x,y:r.y-e.y}}function hf({point:r},e){return{point:r,delta:Xk(r,JE(e)),offset:Xk(r,iG(e)),velocity:rG(e,.1)}}function iG(r){return r[0]}function JE(r){return r[r.length-1]}function rG(r,e){if(r.length<2)return{x:0,y:0};let t=r.length-1,s=null;const i=JE(r);for(;t>=0&&(s=r[t],!(i.timestamp-s.timestamp>wn(e)));)t--;if(!s)return{x:0,y:0};const n=cr(i.timestamp-s.timestamp);if(n===0)return{x:0,y:0};const a={x:(i.x-s.x)/n,y:(i.y-s.y)/n};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function nG(r,{min:e,max:t},s){return e!==void 0&&r<e?r=s?Qt(e,r,s.min):Math.max(r,e):t!==void 0&&r>t&&(r=s?Qt(t,r,s.max):Math.min(r,t)),r}function Kk(r,e,t){return{min:e!==void 0?r.min+e:void 0,max:t!==void 0?r.max+t-(r.max-r.min):void 0}}function aG(r,{top:e,left:t,bottom:s,right:i}){return{x:Kk(r.x,t,i),y:Kk(r.y,e,s)}}function Qk(r,e){let t=e.min-r.min,s=e.max-r.max;return e.max-e.min<r.max-r.min&&([t,s]=[s,t]),{min:t,max:s}}function oG(r,e){return{x:Qk(r.x,e.x),y:Qk(r.y,e.y)}}function cG(r,e){let t=.5;const s=ui(r),i=ui(e);return i>s?t=Wd(e.min,e.max-s,r.min):s>i&&(t=Wd(r.min,r.max-i,e.min)),Hr(0,1,t)}function lG(r,e){const t={};return e.min!==void 0&&(t.min=e.min-r.min),e.max!==void 0&&(t.max=e.max-r.min),t}const q0=.35;function dG(r=q0){return r===!1?r=0:r===!0&&(r=q0),{x:Jk(r,"left","right"),y:Jk(r,"top","bottom")}}function Jk(r,e,t){return{min:Zk(r,e),max:Zk(r,t)}}function Zk(r,e){return typeof r=="number"?r:r[e]||0}const uG=new WeakMap;class hG{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ss(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const n=h=>{t?(this.stopAnimation(),this.snapToCursor(wu(h).point)):this.pauseAnimation()},a=(h,p)=>{this.stopAnimation();const{drag:m,dragPropagation:f,onDragStart:g}=this.getProps();if(m&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=q6(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),sr(x=>{let v=this.getAxisMotionValue(x).get()||0;if(Gr.test(v)){const{projection:b}=this.visualElement;if(b&&b.layout){const S=b.layout.layoutBox[x];S&&(v=ui(S)*(parseFloat(v)/100))}}this.originPoint[x]=v}),g&&Ft.postRender(()=>g(h,p)),O0(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},o=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:g,onDrag:y}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:x}=p;if(f&&this.currentDirection===null){this.currentDirection=pG(x),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,x),this.updateAxis("y",p.point,x),this.visualElement.render(),y&&y(h,p)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>sr(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new QE(e,{onSessionStart:n,onStart:a,onMove:o,onSessionEnd:l,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:KE(this.visualElement),element:this.visualElement.current})}stop(e,t){const s=e||this.latestPointerEvent,i=t||this.latestPanInfo,n=this.isDragging;if(this.cancel(),!n||!i||!s)return;const{velocity:a}=i;this.startAnimation(a);const{onDragEnd:o}=this.getProps();o&&Ft.postRender(()=>o(s,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!Yu(e,i,this.currentDirection))return;const n=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=nG(a,this.constraints[e],this.elastic[e])),n.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&td(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=aG(s.layoutBox,e):this.constraints=!1,this.elastic=dG(t),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&sr(n=>{this.constraints!==!1&&this.getAxisMotionValue(n)&&(this.constraints[n]=lG(s.layoutBox[n],this.constraints[n]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!td(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const n=d8(s,i.root,this.visualElement.getTransformPagePoint());let a=oG(i.layout.layoutBox,n);if(t){const o=t(o8(a));this.hasMutatedConstraints=!!o,o&&(a=yE(o))}return a}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:n,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},d=sr(u=>{if(!Yu(u,t,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const p=i?200:1e6,m=i?40:1e7,f={type:"inertia",velocity:s?e[u]:0,bounceStiffness:p,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...n,...h};return this.startAxisValueAnimation(u,f)});return Promise.all(d).then(o)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return O0(this.visualElement,e),s.start(rb(e,s,0,t,this.visualElement,!1))}stopAnimation(){sr(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){sr(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){sr(t=>{const{drag:s}=this.getProps();if(!Yu(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,n=this.getAxisMotionValue(t);if(i&&i.layout){const{min:a,max:o}=i.layout.layoutBox[t],l=n.get()||0;n.set(e[t]-Qt(a,o,.5)+l)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!td(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};sr(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();i[a]=cG({min:l,max:l},this.constraints[a])}});const{transformTemplate:n}=this.visualElement.getProps();this.visualElement.current.style.transform=n?n({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),sr(a=>{if(!Yu(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:d}=this.constraints[a];o.set(Qt(l,d,i[a]))})}addListeners(){if(!this.visualElement.current)return;uG.set(this.visualElement,this);const e=this.visualElement.current,t=kd(e,"pointerdown",l=>{const{drag:d,dragListener:u=!0}=this.getProps(),h=l.target,p=h!==e&&uE(h);d&&u&&!p&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();td(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,n=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Ft.read(s);const a=Xd(window,"resize",()=>this.scalePositionWithinConstraints()),o=i.addEventListener("didUpdate",({delta:l,hasLayoutChanged:d})=>{this.isDragging&&d&&(sr(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),t(),n(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:n=!1,dragElastic:a=q0,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:n,dragElastic:a,dragMomentum:o}}}function Yu(r,e,t){return(e===!0||e===r)&&(t===null||t===r)}function pG(r,e=10){let t=null;return Math.abs(r.y)>e?t="y":Math.abs(r.x)>e&&(t="x"),t}class mG extends _a{constructor(e){super(e),this.removeGroupControls=fr,this.removeListeners=fr,this.controls=new hG(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||fr}update(){const{dragControls:e}=this.node.getProps(),{dragControls:t}=this.node.prevProps||{};e!==t&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const eC=r=>(e,t)=>{r&&Ft.postRender(()=>r(e,t))};class fG extends _a{constructor(){super(...arguments),this.removePointerDownListener=fr}onPointerDown(e){this.session=new QE(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:KE(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:eC(e),onStart:eC(t),onMove:s,onEnd:(n,a)=>{delete this.session,i&&Ft.postRender(()=>i(n,a))}}}mount(){this.removePointerDownListener=kd(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let pf=!1;class gG extends w.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:n}=e;n&&(t.group&&t.group.add(n),s&&s.register&&i&&s.register(n),pf&&n.root.didUpdate(),n.addEventListener("animationComplete",()=>{this.safeToRemove()}),n.setOptions({...n.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),Ih.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:n}=this.props,{projection:a}=s;return a&&(a.isPresent=n,e.layoutDependency!==t&&a.setOptions({...a.options,layoutDependency:t}),pf=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==n?a.willUpdate():this.safeToRemove(),e.isPresent!==n&&(n?a.promote():a.relegate()||Ft.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),cb.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;pf=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function ZE(r){const[e,t]=OE(),s=w.useContext(Gd);return c.jsx(gG,{...r,layoutGroup:s,switchLayoutGroup:w.useContext(HE),isPresent:e,safeToRemove:t})}const yG={pan:{Feature:fG},drag:{Feature:mG,ProjectionNode:LE,MeasureLayout:ZE}};function tC(r,e,t){const{props:s}=r;r.animationState&&s.whileHover&&r.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,n=s[i];n&&Ft.postRender(()=>n(e,wu(e)))}class xG extends _a{mount(){const{current:e}=this.node;e&&(this.unmount=H6(e,(t,s)=>(tC(this.node,s,"Start"),i=>tC(this.node,i,"End"))))}unmount(){}}class bG extends _a{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=xu(Xd(this.node.current,"focus",()=>this.onFocus()),Xd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function sC(r,e,t){const{props:s}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&s.whileTap&&r.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),n=s[i];n&&Ft.postRender(()=>n(e,wu(e)))}class vG extends _a{mount(){const{current:e}=this.node;e&&(this.unmount=Q6(e,(t,s)=>(sC(this.node,s,"Start"),(i,{success:n})=>sC(this.node,i,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const H0=new WeakMap,mf=new WeakMap,wG=r=>{const e=H0.get(r.target);e&&e(r)},kG=r=>{r.forEach(wG)};function CG({root:r,...e}){const t=r||document;mf.has(t)||mf.set(t,{});const s=mf.get(t),i=JSON.stringify(e);return s[i]||(s[i]=new IntersectionObserver(kG,{root:r,...e})),s[i]}function SG(r,e,t){const s=CG(e);return H0.set(r,t),s.observe(r),()=>{H0.delete(r),s.unobserve(r)}}const TG={some:0,all:1};class AG extends _a{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:n}=e,a={root:t?t.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:TG[i]},o=l=>{const{isIntersecting:d}=l;if(this.isInView===d||(this.isInView=d,n&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(l)};return SG(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(jG(e,t))&&this.startObserver()}unmount(){}}function jG({viewport:r={}},{viewport:e={}}={}){return t=>r[t]!==e[t]}const _G={inView:{Feature:AG},tap:{Feature:vG},focus:{Feature:bG},hover:{Feature:xG}},EG={layout:{ProjectionNode:LE,MeasureLayout:ZE}},MG={...eG,..._G,...yG,...EG},Ro=XU(MG,KU),eM=w.createContext({open:!1}),Kd=w.forwardRef(({open:r,onOpenChange:e,defaultOpen:t=!1,children:s,...i},n)=>{const[a,o]=w.useState(t),l=r??a,d=w.useCallback(u=>{o(u),e?.(u)},[e]);return c.jsx(eM.Provider,{value:{open:l},children:c.jsx(ON,{ref:n,open:l,onOpenChange:d,...i,children:s})})});Kd.displayName="Collapsible";const wp=zN,Qd=w.forwardRef(({className:r,children:e,...t},s)=>{const{open:i}=w.useContext(eM);return c.jsx($E,{initial:!1,children:i&&c.jsx($N,{forceMount:!0,asChild:!0,...t,children:c.jsx(Ro.div,{ref:s,initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{height:{type:"spring",stiffness:500,damping:40},opacity:{duration:.15}},className:Oe("overflow-hidden",r),children:e})})})});Qd.displayName="CollapsibleContent";const sm=UN,im=GN,iC=WN,X0=w.forwardRef(({className:r,inset:e,children:t,...s},i)=>c.jsxs(oS,{ref:i,className:Oe("flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e&&"pl-8",r),...s,children:[t,c.jsx(ei,{className:"ml-auto h-4 w-4"})]}));X0.displayName=oS.displayName;const K0=w.forwardRef(({className:r,...e},t)=>c.jsx(cS,{ref:t,className:Oe("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 slide-in-from-left-1 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95",r),...e}));K0.displayName=cS.displayName;const rm=w.forwardRef(({className:r,...e},t)=>c.jsx(VN,{children:c.jsx(lS,{ref:t,className:Oe("z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95",r),...e})}));rm.displayName=lS.displayName;const bi=w.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(dS,{ref:s,className:Oe("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed",e&&"pl-8",r),...t}));bi.displayName=dS.displayName;const PG=w.forwardRef(({className:r,children:e,checked:t,...s},i)=>c.jsxs(uS,{ref:i,className:Oe("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed",r),checked:t,...s,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx($E,{children:t&&c.jsx(hS,{forceMount:!0,asChild:!0,children:c.jsx(Ro.span,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:500,damping:30},children:c.jsx(Ri,{className:"h-4 w-4"})})})})}),e]}));PG.displayName=uS.displayName;const NG=w.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(pS,{ref:s,className:Oe("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed",r),...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(hS,{asChild:!0,children:c.jsx(Ro.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30},children:c.jsx(Wr,{className:"h-2 w-2 fill-current"})})})}),e]}));NG.displayName=pS.displayName;const yb=w.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(mS,{ref:s,className:Oe("px-2 py-1.5 text-sm font-semibold text-foreground",e&&"pl-8",r),...t}));yb.displayName=mS.displayName;const pn=w.forwardRef(({className:r,...e},t)=>c.jsx(fS,{ref:t,className:Oe("-mx-1 my-1 h-px bg-border",r),...e}));pn.displayName=fS.displayName;const ho=({className:r,...e})=>c.jsx("span",{className:Oe("ml-auto text-xs tracking-widest text-muted-foreground",r),...e});ho.displayName="ContextMenuShortcut";const Ea=HN,RG=YN,tM=w.forwardRef(({className:r,...e},t)=>c.jsx(gS,{ref:t,className:Oe("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...e}));tM.displayName=gS.displayName;const En=w.forwardRef(({className:r,children:e,hideCloseButton:t=!1,...s},i)=>c.jsxs(RG,{children:[c.jsx(tM,{}),c.jsxs(yS,{ref:i,className:Oe("fixed left-1/2 top-1/2 z-50 grid w-full max-w-lg -translate-x-1/2 -translate-y-1/2 gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 sm:rounded-lg",r),...s,children:[e,!t&&c.jsxs(qN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[c.jsx(ti,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));En.displayName=yS.displayName;const Ma=({className:r,...e})=>c.jsx("div",{className:Oe("flex flex-col space-y-1.5 text-center sm:text-left",r),...e});Ma.displayName="DialogHeader";const Pa=w.forwardRef(({className:r,...e},t)=>c.jsx(xS,{ref:t,className:Oe("text-lg font-semibold leading-none tracking-tight",r),...e}));Pa.displayName=xS.displayName;const ku=w.forwardRef(({className:r,...e},t)=>c.jsx(bS,{ref:t,className:Oe("text-sm text-muted-foreground",r),...e}));ku.displayName=bS.displayName;const Cd=KN,Sd=QN,IG=w.forwardRef(({className:r,inset:e,children:t,...s},i)=>c.jsxs(vS,{ref:i,className:Oe("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",r),...s,children:[t,c.jsx(ei,{className:"ml-auto"})]}));IG.displayName=vS.displayName;const DG=w.forwardRef(({className:r,...e},t)=>c.jsx(wS,{ref:t,className:Oe("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...e}));DG.displayName=wS.displayName;const jc=w.forwardRef(({className:r,sideOffset:e=4,...t},s)=>c.jsx(XN,{children:c.jsx(kS,{ref:s,sideOffset:e,className:Oe("z-[9999] max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));jc.displayName=kS.displayName;const wi=w.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(CS,{ref:s,className:Oe("relative flex cursor-pointer select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",r),...t}));wi.displayName=CS.displayName;const FG=w.forwardRef(({className:r,children:e,checked:t,...s},i)=>c.jsxs(SS,{ref:i,className:Oe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:t,...s,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(TS,{children:c.jsx(Ri,{className:"h-4 w-4"})})}),e]}));FG.displayName=SS.displayName;const BG=w.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(AS,{ref:s,className:Oe("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(TS,{children:c.jsx(Wr,{className:"h-2 w-2 fill-current"})})}),e]}));BG.displayName=AS.displayName;const sM=w.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(jS,{ref:s,className:Oe("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",r),...t}));sM.displayName=jS.displayName;const Td=w.forwardRef(({className:r,...e},t)=>c.jsx(_S,{ref:t,className:Oe("-mx-1 my-1 h-px bg-muted",r),...e}));Td.displayName=_S.displayName;const Ns=w.forwardRef(({className:r,type:e,...t},s)=>c.jsx("input",{type:e,className:Oe("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...t}));Ns.displayName="Input";const LG=Qp("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ss=w.forwardRef(({className:r,...e},t)=>c.jsx(ES,{ref:t,className:Oe(LG(),r),...e}));ss.displayName=ES.displayName;const iM=ZN,rM=eR,xb=w.forwardRef(({className:r,align:e="center",sideOffset:t=4,...s},i)=>c.jsx(JN,{children:c.jsx(MS,{ref:i,align:e,sideOffset:t,className:Oe("z-[9999] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));xb.displayName=MS.displayName;const bb=w.forwardRef(({className:r,value:e,...t},s)=>c.jsx(PS,{ref:s,className:Oe("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...t,children:c.jsx(tR,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})}));bb.displayName=PS.displayName;const Pt=oR,sd=lR,Nt=cR,Ct=w.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(NS,{ref:s,className:Oe("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[e,c.jsx(sR,{asChild:!0,children:c.jsx(ns,{className:"h-4 w-4 opacity-50"})})]}));Ct.displayName=NS.displayName;const nM=w.forwardRef(({className:r,...e},t)=>c.jsx(RS,{ref:t,className:Oe("flex cursor-default items-center justify-center py-1",r),...e,children:c.jsx(Uj,{className:"h-4 w-4"})}));nM.displayName=RS.displayName;const aM=w.forwardRef(({className:r,...e},t)=>c.jsx(IS,{ref:t,className:Oe("flex cursor-default items-center justify-center py-1",r),...e,children:c.jsx(ns,{className:"h-4 w-4"})}));aM.displayName=IS.displayName;const St=w.forwardRef(({className:r,children:e,position:t="popper",...s},i)=>c.jsx(iR,{children:c.jsx(DS,{ref:i,position:t,asChild:!0,...s,children:c.jsxs(Ro.div,{initial:{opacity:0,scale:.96,y:-4},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.96,y:-4},transition:{type:"spring",stiffness:500,damping:30},className:Oe("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),children:[c.jsx(nM,{}),c.jsx(rR,{className:Oe("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),c.jsx(aM,{})]})})}));St.displayName=DS.displayName;const gc=w.forwardRef(({className:r,...e},t)=>c.jsx(FS,{ref:t,className:Oe("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...e}));gc.displayName=FS.displayName;const ze=w.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(BS,{ref:s,className:Oe("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(nR,{asChild:!0,children:c.jsx(Ro.span,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:c.jsx(Ri,{className:"h-4 w-4"})})})}),c.jsx(aR,{children:e})]}));ze.displayName=BS.displayName;const OG=w.forwardRef(({className:r,...e},t)=>c.jsx(LS,{ref:t,className:Oe("-mx-1 my-1 h-px bg-muted",r),...e}));OG.displayName=LS.displayName;const ha=w.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(OS,{ref:s,className:Oe("relative overflow-hidden",r),...t,children:[c.jsx(dR,{className:"h-full w-full rounded-[inherit] [&>div]:!block [&>div]:!min-w-0",children:e}),c.jsx(oM,{}),c.jsx(uR,{})]}));ha.displayName=OS.displayName;const oM=w.forwardRef(({className:r,orientation:e="vertical",...t},s)=>c.jsx($S,{ref:s,orientation:e,className:Oe("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:c.jsx(hR,{className:"relative flex-1 rounded-full bg-border"})}));oM.displayName=$S.displayName;const rt=w.forwardRef(({className:r,...e},t)=>c.jsxs(zS,{ref:t,className:Oe("relative flex w-full touch-none select-none items-center",r),...e,children:[c.jsx(pR,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-background-tertiary",children:c.jsx(mR,{className:"absolute h-full bg-text-secondary"})}),c.jsx(fR,{className:"block h-2.5 w-2.5 rounded-full bg-white shadow-sm ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));rt.displayName=zS.displayName;const ut=w.forwardRef(({label:r,value:e,onChange:t,min:s=0,max:i=100,step:n=1,unit:a="",className:o},l)=>{const d=n<1?e.toFixed(1):Math.round(e);return c.jsxs("div",{ref:l,className:Oe("space-y-1",o),children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[d,a]})]}),c.jsx(rt,{value:[e],onValueChange:u=>t(u[0]),min:s,max:i,step:n,className:"h-1.5"})]})});ut.displayName="LabeledSlider";const $G=w.forwardRef(({value:r,onChange:e,min:t=0,max:s=100,step:i=1,className:n},a)=>c.jsxs("div",{ref:a,className:Oe("flex items-center gap-3",n),children:[c.jsx(rt,{value:[r],onValueChange:o=>e(o[0]),min:t,max:s,step:i,className:"flex-1 h-1.5"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary w-8 text-right bg-background-tertiary px-1 py-0.5 rounded border border-border",children:Math.round(r)})]}));$G.displayName="InspectorSlider";const wa=w.forwardRef(({className:r,...e},t)=>c.jsx(VS,{className:Oe("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...e,ref:t,children:c.jsx(gR,{className:Oe("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));wa.displayName=VS.displayName;const cM=w.createContext({activeValue:void 0}),vb=w.forwardRef(({value:r,defaultValue:e,onValueChange:t,children:s,...i},n)=>{const[a,o]=w.useState(e),l=r??a,d=w.useCallback(u=>{o(u),t?.(u)},[t]);return c.jsx(cM.Provider,{value:{activeValue:l},children:c.jsx(yR,{ref:n,value:l,onValueChange:d,...i,children:s})})});vb.displayName="Tabs";const wb=w.forwardRef(({className:r,layoutId:e="tabs-indicator",children:t,...s},i)=>c.jsx(US,{ref:i,className:Oe("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground relative",r),...s,children:c.jsx(SU,{id:e,children:t})}));wb.displayName=US.displayName;const Jd=w.forwardRef(({className:r,value:e,children:t,...s},i)=>{const{activeValue:n}=w.useContext(cM),a=n===e;return c.jsxs(GS,{ref:i,value:e,className:Oe("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative z-10 data-[state=active]:text-foreground",r),...s,children:[a&&c.jsx(Ro.span,{layoutId:"active-tab",className:"absolute inset-0 bg-background rounded-sm shadow-sm -z-10",transition:{type:"spring",stiffness:500,damping:30}}),t]})});Jd.displayName=GS.displayName;const Zd=w.forwardRef(({className:r,children:e,...t},s)=>c.jsx(WS,{ref:s,asChild:!0,...t,children:c.jsx(Ro.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},transition:{duration:.15},className:Oe("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),children:e})}));Zd.displayName=WS.displayName;const lM=Qp("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),zG=w.forwardRef(({className:r,variant:e,size:t,...s},i)=>c.jsx(YS,{ref:i,className:Oe(lM({variant:e,size:t,className:r})),...s}));zG.displayName=YS.displayName;const dM=w.createContext({size:"default",variant:"default"}),VG=w.forwardRef(({className:r,variant:e,size:t,children:s,...i},n)=>c.jsx(qS,{ref:n,className:Oe("flex items-center justify-center gap-1",r),...i,children:c.jsx(dM.Provider,{value:{variant:e,size:t},children:s})}));VG.displayName=qS.displayName;const UG=w.forwardRef(({className:r,children:e,variant:t,size:s,...i},n)=>{const a=w.useContext(dM);return c.jsx(HS,{ref:n,className:Oe(lM({variant:a.variant||t,size:a.size||s}),r),...i,children:e})});UG.displayName=HS.displayName;const GG=xR,Ua=bR,Ga=vR,Zn=w.forwardRef(({className:r,sideOffset:e=4,...t},s)=>c.jsx(XS,{ref:s,sideOffset:e,className:Oe("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",r),...t}));Zn.displayName=XS.displayName;const kp={tiktok:{width:1080,height:1920,frameRate:30,maxDuration:180,recommendedDuration:15,safeZone:{top:150,bottom:300,left:40,right:40}},"instagram-reels":{width:1080,height:1920,frameRate:30,maxDuration:90,recommendedDuration:30,safeZone:{top:200,bottom:280,left:40,right:40}},"instagram-stories":{width:1080,height:1920,frameRate:30,maxDuration:15,recommendedDuration:10,safeZone:{top:200,bottom:200,left:40,right:40}},"instagram-post":{width:1080,height:1080,frameRate:30,maxDuration:60,recommendedDuration:30},"youtube-shorts":{width:1080,height:1920,frameRate:30,maxDuration:60,recommendedDuration:30,safeZone:{top:100,bottom:200,left:40,right:40}},"youtube-video":{width:1920,height:1080,frameRate:30},facebook:{width:1080,height:1080,frameRate:30,maxDuration:240,recommendedDuration:60},twitter:{width:1280,height:720,frameRate:30,maxDuration:140,recommendedDuration:45},linkedin:{width:1920,height:1080,frameRate:30,maxDuration:600,recommendedDuration:90},pinterest:{width:1e3,height:1500,frameRate:30,maxDuration:60,recommendedDuration:15},intro:{width:1920,height:1080,frameRate:30,recommendedDuration:5},outro:{width:1920,height:1080,frameRate:30,recommendedDuration:10},promo:{width:1920,height:1080,frameRate:30,recommendedDuration:30},"lower-third":{width:1920,height:1080,frameRate:30,recommendedDuration:5},slideshow:{width:1920,height:1080,frameRate:30},custom:{width:1920,height:1080,frameRate:30}},uM=[{id:"tiktok",name:"TikTok",icon:"smartphone",platform:"TikTok"},{id:"instagram-reels",name:"Reels",icon:"film",platform:"Instagram"},{id:"instagram-stories",name:"Stories",icon:"clock",platform:"Instagram"},{id:"instagram-post",name:"Post",icon:"square",platform:"Instagram"},{id:"youtube-shorts",name:"Shorts",icon:"smartphone",platform:"YouTube"},{id:"youtube-video",name:"Video",icon:"monitor",platform:"YouTube"},{id:"facebook",name:"Facebook",icon:"users",platform:"Facebook"},{id:"twitter",name:"Twitter/X",icon:"at-sign",platform:"Twitter"},{id:"linkedin",name:"LinkedIn",icon:"briefcase",platform:"LinkedIn"},{id:"pinterest",name:"Pinterest",icon:"bookmark",platform:"Pinterest"},{id:"intro",name:"Intro",icon:"play",platform:"General"},{id:"outro",name:"Outro",icon:"square",platform:"General"},{id:"promo",name:"Promo",icon:"megaphone",platform:"General"},{id:"lower-third",name:"Lower Third",icon:"type",platform:"General"},{id:"slideshow",name:"Slideshow",icon:"images",platform:"General"},{id:"custom",name:"Custom",icon:"settings",platform:"Custom"}];function WG(r){return JSON.stringify(r,null,2)}function YG(r){return JSON.parse(r)}function ff(){return`${Date.now()}-${Math.random().toString(36).substring(2,11)}`}class qG{validate(e,t){const s=[];if(!e.type||typeof e.type!="string")return s.push({code:"INVALID_TYPE",message:"Action type is required and must be a string"}),{valid:!1,errors:s};if(!e.params||typeof e.params!="object")return s.push({code:"INVALID_PARAMS",message:"Action params are required and must be an object"}),{valid:!1,errors:s};const i=this.validateActionType(e,t);return s.push(...i),{valid:s.length===0,errors:s}}validateActionType(e,t){const s=e.type;return s.startsWith("project/")?this.validateProjectAction(e,t):s.startsWith("media/")?this.validateMediaAction(e,t):s.startsWith("track/")?this.validateTrackAction(e,t):s.startsWith("clip/")?this.validateClipAction(e,t):s.startsWith("effect/")?this.validateEffectAction(e,t):s.startsWith("transform/")?this.validateTransformAction(e,t):s.startsWith("keyframe/")?this.validateKeyframeAction(e,t):s.startsWith("transition/")?this.validateTransitionAction(e,t):s.startsWith("audio/")?this.validateAudioAction(e,t):s.startsWith("subtitle/")?this.validateSubtitleAction(e,t):[{code:"UNKNOWN_ACTION_TYPE",message:`Unknown action type: ${s}`}]}validateProjectAction(e,t){const s=[];switch(e.type){case"project/create":(!e.params.name||typeof e.params.name!="string")&&s.push({code:"INVALID_PARAMS",message:"Project name is required and must be a string",path:"params.name"}),e.params.settings||s.push({code:"INVALID_PARAMS",message:"Project settings are required",path:"params.settings"});break;case"project/rename":(!e.params.name||typeof e.params.name!="string")&&s.push({code:"INVALID_PARAMS",message:"Project name is required and must be a string",path:"params.name"});break;case"project/updateSettings":(!e.params||typeof e.params!="object"||Array.isArray(e.params))&&s.push({code:"INVALID_PARAMS",message:"Settings must be an object",path:"params"});break}return s}validateMediaAction(e,t){const s=[];switch(e.type){case"media/import":e.params.file||s.push({code:"INVALID_PARAMS",message:"File is required for media import",path:"params.file"});break;case"media/delete":case"media/rename":!e.params.mediaId||typeof e.params.mediaId!="string"?s.push({code:"INVALID_PARAMS",message:"Media ID is required and must be a string",path:"params.mediaId"}):t.mediaLibrary.items.some(n=>n.id===e.params.mediaId)||s.push({code:"MEDIA_NOT_FOUND",message:`Media with ID ${e.params.mediaId} not found`,path:"params.mediaId"}),e.type==="media/rename"&&(!e.params.name||typeof e.params.name!="string")&&s.push({code:"INVALID_PARAMS",message:"Media name is required and must be a string",path:"params.name"});break}return s}validateTrackAction(e,t){const s=[],i=t.timeline;switch(e.type){case"track/add":["video","audio","image","text","graphics"].includes(e.params.trackType)||s.push({code:"INVALID_PARAMS",message:"Track type must be 'video', 'audio', 'image', 'text', or 'graphics'",path:"params.trackType"}),e.params.position!==void 0&&(typeof e.params.position!="number"||e.params.position<0)&&s.push({code:"INVALID_PARAMS",message:"Track position must be a non-negative number",path:"params.position"});break;case"track/remove":case"track/lock":case"track/hide":case"track/mute":case"track/solo":!e.params.trackId||typeof e.params.trackId!="string"?s.push({code:"INVALID_PARAMS",message:"Track ID is required and must be a string",path:"params.trackId"}):this.findTrack(i,e.params.trackId)||s.push({code:"TRACK_NOT_FOUND",message:`Track with ID ${e.params.trackId} not found`,path:"params.trackId"}),e.type==="track/lock"&&typeof e.params.locked!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Locked parameter must be a boolean",path:"params.locked"}),e.type==="track/hide"&&typeof e.params.hidden!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Hidden parameter must be a boolean",path:"params.hidden"}),e.type==="track/mute"&&typeof e.params.muted!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Muted parameter must be a boolean",path:"params.muted"}),e.type==="track/solo"&&typeof e.params.solo!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Solo parameter must be a boolean",path:"params.solo"});break;case"track/reorder":!e.params.trackId||typeof e.params.trackId!="string"?s.push({code:"INVALID_PARAMS",message:"Track ID is required and must be a string",path:"params.trackId"}):this.findTrack(i,e.params.trackId)||s.push({code:"TRACK_NOT_FOUND",message:`Track with ID ${e.params.trackId} not found`,path:"params.trackId"}),(typeof e.params.newPosition!="number"||e.params.newPosition<0||e.params.newPosition>=i.tracks.length)&&s.push({code:"INVALID_PARAMS",message:`New position must be between 0 and ${i.tracks.length-1}`,path:"params.newPosition"});break}return s}validateClipAction(e,t){const s=[],i=t.timeline;switch(e.type){case"clip/add":if(!e.params.trackId||typeof e.params.trackId!="string")s.push({code:"INVALID_PARAMS",message:"Track ID is required and must be a string",path:"params.trackId"});else{const n=this.findTrack(i,e.params.trackId);n?n.locked&&s.push({code:"TRACK_LOCKED",message:`Track ${e.params.trackId} is locked`,path:"params.trackId"}):s.push({code:"TRACK_NOT_FOUND",message:`Track with ID ${e.params.trackId} not found`,path:"params.trackId"})}!e.params.mediaId||typeof e.params.mediaId!="string"?s.push({code:"INVALID_PARAMS",message:"Media ID is required and must be a string",path:"params.mediaId"}):t.mediaLibrary.items.some(a=>a.id===e.params.mediaId)||s.push({code:"MEDIA_NOT_FOUND",message:`Media with ID ${e.params.mediaId} not found`,path:"params.mediaId"}),(typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"});break;case"clip/remove":case"clip/rippleDelete":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}break;case"clip/move":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}if((typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"}),e.params.trackId!==void 0)if(typeof e.params.trackId!="string")s.push({code:"INVALID_PARAMS",message:"Track ID must be a string",path:"params.trackId"});else{const n=this.findTrack(i,e.params.trackId);n?n.locked&&s.push({code:"TRACK_LOCKED",message:`Target track ${e.params.trackId} is locked`,path:"params.trackId"}):s.push({code:"TRACK_NOT_FOUND",message:`Target track with ID ${e.params.trackId} not found`,path:"params.trackId"})}break;case"clip/trim":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}e.params.inPoint!==void 0&&(typeof e.params.inPoint!="number"||e.params.inPoint<0)&&s.push({code:"INVALID_PARAMS",message:"In-point must be a non-negative number",path:"params.inPoint"}),e.params.outPoint!==void 0&&(typeof e.params.outPoint!="number"||e.params.outPoint<0)&&s.push({code:"INVALID_PARAMS",message:"Out-point must be a non-negative number",path:"params.outPoint"}),e.params.inPoint!==void 0&&e.params.outPoint!==void 0&&e.params.outPoint<=e.params.inPoint&&s.push({code:"INVALID_TIME_RANGE",message:"Out-point must be greater than in-point",path:"params"});break;case"clip/split":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),typeof e.params.time=="number"?(e.params.time<=n.startTime||e.params.time>=n.startTime+n.duration)&&s.push({code:"OUT_OF_BOUNDS",message:`Split time must be within clip bounds (${n.startTime} to ${n.startTime+n.duration})`,path:"params.time"}):s.push({code:"INVALID_PARAMS",message:"Split time is required and must be a number",path:"params.time"})):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}break}return s}validateEffectAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);if(!n)return s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s;switch(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),e.type){case"effect/add":(!e.params.effectType||typeof e.params.effectType!="string")&&s.push({code:"INVALID_PARAMS",message:"Effect type is required and must be a string",path:"params.effectType"});break;case"effect/remove":case"effect/update":case"effect/reorder":!e.params.effectId||typeof e.params.effectId!="string"?s.push({code:"INVALID_PARAMS",message:"Effect ID is required and must be a string",path:"params.effectId"}):n.effects.some(l=>l.id===e.params.effectId)||s.push({code:"EFFECT_NOT_FOUND",message:`Effect with ID ${e.params.effectId} not found on clip`,path:"params.effectId"}),e.type==="effect/reorder"&&(typeof e.params.newIndex!="number"||e.params.newIndex<0||e.params.newIndex>=n.effects.length)&&s.push({code:"INVALID_PARAMS",message:`New index must be between 0 and ${n.effects.length-1}`,path:"params.newIndex"});break}return s}validateTransformAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);return n?(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),(!e.params.transform||typeof e.params.transform!="object")&&s.push({code:"INVALID_PARAMS",message:"Transform is required and must be an object",path:"params.transform"}),s):(s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s)}validateKeyframeAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);return n?(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),(!e.params.property||typeof e.params.property!="string")&&s.push({code:"INVALID_PARAMS",message:"Property is required and must be a string",path:"params.property"}),(typeof e.params.time!="number"||e.params.time<0)&&s.push({code:"INVALID_PARAMS",message:"Time is required and must be a non-negative number",path:"params.time"}),s):(s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s)}validateTransitionAction(e,t){const s=[],i=t.timeline;switch(e.type){case"transition/add":if((!e.params.clipAId||typeof e.params.clipAId!="string")&&s.push({code:"INVALID_PARAMS",message:"Clip A ID is required and must be a string",path:"params.clipAId"}),(!e.params.clipBId||typeof e.params.clipBId!="string")&&s.push({code:"INVALID_PARAMS",message:"Clip B ID is required and must be a string",path:"params.clipBId"}),(typeof e.params.duration!="number"||e.params.duration<=0)&&s.push({code:"INVALID_PARAMS",message:"Duration must be a positive number",path:"params.duration"}),e.params.clipAId&&e.params.clipBId){const n=this.findClip(i,e.params.clipAId),a=this.findClip(i,e.params.clipBId);if(n||s.push({code:"CLIP_NOT_FOUND",message:`Clip A with ID ${e.params.clipAId} not found`,path:"params.clipAId"}),a||s.push({code:"CLIP_NOT_FOUND",message:`Clip B with ID ${e.params.clipBId} not found`,path:"params.clipBId"}),n&&a){n.trackId!==a.trackId&&s.push({code:"INVALID_PARAMS",message:"Clips must be on the same track for transition",path:"params"});const o=n.startTime+n.duration,l=a.startTime+a.duration,d=.001,u=Math.abs(o-a.startTime)<d,h=Math.abs(l-n.startTime)<d;!u&&!h&&s.push({code:"INVALID_PARAMS",message:"Clips must be adjacent for transition",path:"params"})}}break;case"transition/remove":case"transition/update":(!e.params.transitionId||typeof e.params.transitionId!="string")&&s.push({code:"INVALID_PARAMS",message:"Transition ID is required and must be a string",path:"params.transitionId"}),e.type==="transition/update"&&e.params.duration!==void 0&&(typeof e.params.duration!="number"||e.params.duration<=0)&&s.push({code:"INVALID_PARAMS",message:"Duration must be a positive number",path:"params.duration"});break}return s}validateAudioAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);if(!n)return s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s;switch(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),e.type){case"audio/setVolume":(typeof e.params.volume!="number"||e.params.volume<0||e.params.volume>4)&&s.push({code:"INVALID_PARAMS",message:"Volume must be a number between 0 and 4",path:"params.volume"});break;case"audio/setFade":e.params.fadeIn!==void 0&&(typeof e.params.fadeIn!="number"||e.params.fadeIn<0)&&s.push({code:"INVALID_PARAMS",message:"Fade-in must be a non-negative number",path:"params.fadeIn"}),e.params.fadeOut!==void 0&&(typeof e.params.fadeOut!="number"||e.params.fadeOut<0)&&s.push({code:"INVALID_PARAMS",message:"Fade-out must be a non-negative number",path:"params.fadeOut"});break;case"audio/addAutomation":Array.isArray(e.params.points)||s.push({code:"INVALID_PARAMS",message:"Automation points must be an array",path:"params.points"});break}return s}validateSubtitleAction(e,t){const s=[];switch(e.type){case"subtitle/import":(!e.params.srtContent||typeof e.params.srtContent!="string")&&s.push({code:"INVALID_PARAMS",message:"SRT content is required and must be a string",path:"params.srtContent"});break;case"subtitle/add":(!e.params.text||typeof e.params.text!="string")&&s.push({code:"INVALID_PARAMS",message:"Subtitle text is required and must be a string",path:"params.text"}),(typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"}),(typeof e.params.endTime!="number"||e.params.endTime<0)&&s.push({code:"INVALID_PARAMS",message:"End time must be a non-negative number",path:"params.endTime"}),typeof e.params.startTime=="number"&&typeof e.params.endTime=="number"&&e.params.endTime<=e.params.startTime&&s.push({code:"INVALID_TIME_RANGE",message:"End time must be greater than start time",path:"params"});break;case"subtitle/update":(!e.params.subtitleId||typeof e.params.subtitleId!="string")&&s.push({code:"INVALID_PARAMS",message:"Subtitle ID is required and must be a string",path:"params.subtitleId"}),e.params.startTime!==void 0&&(typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"}),e.params.endTime!==void 0&&(typeof e.params.endTime!="number"||e.params.endTime<0)&&s.push({code:"INVALID_PARAMS",message:"End time must be a non-negative number",path:"params.endTime"});break;case"subtitle/remove":(!e.params.subtitleId||typeof e.params.subtitleId!="string")&&s.push({code:"INVALID_PARAMS",message:"Subtitle ID is required and must be a string",path:"params.subtitleId"});break;case"subtitle/setStyle":(!e.params.style||typeof e.params.style!="object")&&s.push({code:"INVALID_PARAMS",message:"Style is required and must be an object",path:"params.style"});break}return s}findTrack(e,t){return e.tracks.find(s=>s.id===t)||null}findClip(e,t){for(const s of e.tracks){const i=s.clips.find(n=>n.id===t);if(i)return i}return null}}const HG={"clip/add":()=>"Add clip","clip/remove":()=>"Delete clip","clip/move":()=>"Move clip","clip/trim":()=>"Trim clip","clip/split":()=>"Split clip","clip/rippleDelete":()=>"Ripple delete","clip/duplicate":()=>"Duplicate clip","track/add":r=>`Add ${r.trackType} track`,"track/remove":()=>"Remove track","effect/add":r=>`Add ${r.effectType} effect`,"effect/remove":()=>"Remove effect","effect/update":()=>"Update effect","transform/update":()=>"Transform clip","keyframe/add":r=>`Add ${r.property} keyframe`,"keyframe/remove":()=>"Remove keyframe","transition/add":r=>`Add ${r.transitionType} transition`,"transition/remove":()=>"Remove transition","audio/setVolume":()=>"Adjust volume","audio/setFade":()=>"Adjust fade","subtitle/add":()=>"Add subtitle","subtitle/remove":()=>"Remove subtitle","project/rename":()=>"Rename project","project/updateSettings":()=>"Update settings","media/import":()=>"Import media","media/delete":()=>"Delete media"};function XG(r){const e=HG[r.type];if(e)return e(r.params);const t=r.type.split("/");return`${t[0]}: ${t[1]||"action"}`}class id{undoStack=[];redoStack=[];maxHistorySize;currentGroupId=null;snapshots=[];listeners=new Set;lastActionTime=0;autoGroupWindow=100;constructor(e=1e3){this.maxHistorySize=e}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}push(e,t=null){const s=Date.now(),i=s-this.lastActionTime;this.lastActionTime=s;const n=i<this.autoGroupWindow&&this.undoStack.length>0&&this.undoStack[this.undoStack.length-1].action.type===e.type;let a=this.currentGroupId;if(n&&!a){a=`auto-${s}`;const l=this.undoStack[this.undoStack.length-1];l.groupId||(this.undoStack[this.undoStack.length-1]={...l,groupId:a})}const o={action:e,inverseAction:t,timestamp:s,description:XG(e),groupId:a||void 0};this.undoStack.push(o),this.redoStack=[],this.snapshots=this.snapshots.filter(l=>l.stackIndex<=this.undoStack.length),this.undoStack.length>this.maxHistorySize&&(this.undoStack.shift(),this.snapshots=this.snapshots.map(l=>({...l,stackIndex:l.stackIndex-1})).filter(l=>l.stackIndex>=0)),this.notify()}beginGroup(e){return this.currentGroupId=`group-${Date.now()}`,this.currentGroupId}endGroup(){this.currentGroupId=null,this.notify()}setAutoGroupWindow(e){this.autoGroupWindow=e}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),this.notify(),e.inverseAction):null}undoGroup(){if(this.undoStack.length===0)return[];const t=this.undoStack[this.undoStack.length-1].groupId;if(!t){const i=this.undo();return i?[i]:[]}const s=[];for(;this.undoStack.length>0&&this.undoStack[this.undoStack.length-1].groupId===t;){const i=this.undo();i&&s.push(i)}return s}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),this.notify(),e.action):null}redoGroup(){if(this.redoStack.length===0)return[];const t=this.redoStack[this.redoStack.length-1].groupId;if(!t){const i=this.redo();return i?[i]:[]}const s=[];for(;this.redoStack.length>0&&this.redoStack[this.redoStack.length-1].groupId===t;){const i=this.redo();i&&s.push(i)}return s}createSnapshot(e){const t={id:`snapshot-${Date.now()}`,name:e,timestamp:Date.now(),stackIndex:this.undoStack.length};return this.snapshots.push(t),this.notify(),t}getSnapshots(){return[...this.snapshots]}deleteSnapshot(e){const t=this.snapshots.findIndex(s=>s.id===e);return t!==-1?(this.snapshots.splice(t,1),this.notify(),!0):!1}getDisplayHistory(){const e=[],t=new Set;for(let s=this.undoStack.length-1;s>=0;s--){const i=this.undoStack[s];i.groupId?t.has(i.groupId)||(t.add(i.groupId),e.push({entry:i,isCurrent:s===this.undoStack.length-1})):e.push({entry:i,isCurrent:s===this.undoStack.length-1})}return e.reverse()}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}getHistory(){return this.undoStack.map(e=>e.action)}getHistoryEntries(){return[...this.undoStack]}getRedoEntries(){return[...this.redoStack]}clear(){this.undoStack=[],this.redoStack=[],this.snapshots=[],this.currentGroupId=null,this.notify()}getUndoStackSize(){return this.undoStack.length}getRedoStackSize(){return this.redoStack.length}peekUndo(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}peekRedo(){return this.redoStack.length>0?this.redoStack[this.redoStack.length-1]:null}getMaxHistorySize(){return this.maxHistorySize}setMaxHistorySize(e){for(this.maxHistorySize=e;this.undoStack.length>this.maxHistorySize;)this.undoStack.shift()}}class KG{generate(e,t){const s=e.type;return s.startsWith("project/")?this.generateProjectInverse(e,t):s.startsWith("media/")?this.generateMediaInverse(e,t):s.startsWith("track/")?this.generateTrackInverse(e,t):s.startsWith("clip/")?this.generateClipInverse(e,t):s.startsWith("effect/")?this.generateEffectInverse(e,t):s.startsWith("transform/")?this.generateTransformInverse(e,t):s.startsWith("keyframe/")?this.generateKeyframeInverse(e,t):s.startsWith("transition/")?this.generateTransitionInverse(e,t):s.startsWith("audio/")?this.generateAudioInverse(e,t):s.startsWith("subtitle/")?this.generateSubtitleInverse(e,t):null}createInverseAction(e,t,s){return{type:t,id:`inverse-${e.id}`,timestamp:Date.now(),params:s}}generateProjectInverse(e,t){switch(e.type){case"project/rename":return this.createInverseAction(e,"project/rename",{name:t.name});case"project/updateSettings":return this.createInverseAction(e,"project/updateSettings",{...t.settings});case"project/create":return null}}generateMediaInverse(e,t){switch(e.type){case"media/import":return this.createInverseAction(e,"media/delete",{mediaId:"__LAST_IMPORTED__"});case"media/delete":{const s=t.mediaLibrary.items.find(i=>i.id===e.params.mediaId);return s?this.createInverseAction(e,"media/restore",{mediaItem:this.cloneMediaItem(s)}):null}case"media/rename":{const s=t.mediaLibrary.items.find(i=>i.id===e.params.mediaId);return s?this.createInverseAction(e,"media/rename",{mediaId:e.params.mediaId,name:s.name}):null}}}generateTrackInverse(e,t){const s=t.timeline;switch(e.type){case"track/add":return this.createInverseAction(e,"track/remove",{trackId:"__LAST_ADDED__"});case"track/remove":{const i=s.tracks.find(a=>a.id===e.params.trackId);if(!i)return null;const n=s.tracks.findIndex(a=>a.id===e.params.trackId);return this.createInverseAction(e,"track/restore",{track:this.cloneTrack(i),position:n})}case"track/reorder":{const i=s.tracks.findIndex(n=>n.id===e.params.trackId);return i===-1?null:this.createInverseAction(e,"track/reorder",{trackId:e.params.trackId,newPosition:i})}case"track/lock":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/lock",{trackId:e.params.trackId,locked:i.locked}):null}case"track/hide":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/hide",{trackId:e.params.trackId,hidden:i.hidden}):null}case"track/mute":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/mute",{trackId:e.params.trackId,muted:i.muted}):null}case"track/solo":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/solo",{trackId:e.params.trackId,solo:i.solo}):null}}}generateClipInverse(e,t){const s=t.timeline;switch(e.type){case"clip/add":return this.createInverseAction(e,"clip/remove",{clipId:"__LAST_ADDED__"});case"clip/remove":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/restore",{clip:this.cloneClip(i)}):null}case"clip/move":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/move",{clipId:e.params.clipId,startTime:i.startTime,trackId:i.trackId}):null}case"clip/trim":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/trim",{clipId:e.params.clipId,inPoint:i.inPoint,outPoint:i.outPoint}):null}case"clip/split":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/merge",{clipId:e.params.clipId,originalClip:this.cloneClip(i)}):null}case"clip/rippleDelete":{const i=this.findClip(s,e.params.clipId);if(!i)return null;const a=s.tracks.find(o=>o.id===i.trackId)?.clips.filter(o=>o.startTime>i.startTime).map(o=>({id:o.id,originalStartTime:o.startTime}))||[];return this.createInverseAction(e,"clip/rippleRestore",{clip:this.cloneClip(i),affectedClips:a})}}}generateEffectInverse(e,t){const s=t.timeline,i=this.findClip(s,e.params.clipId);if(!i)return null;switch(e.type){case"effect/add":return this.createInverseAction(e,"effect/remove",{clipId:e.params.clipId,effectId:"__LAST_ADDED__"});case"effect/remove":{const n=i.effects.find(o=>o.id===e.params.effectId);if(!n)return null;const a=i.effects.findIndex(o=>o.id===e.params.effectId);return this.createInverseAction(e,"effect/restore",{clipId:e.params.clipId,effect:{...n},index:a})}case"effect/update":{const n=i.effects.find(a=>a.id===e.params.effectId);return n?this.createInverseAction(e,"effect/update",{clipId:e.params.clipId,effectId:e.params.effectId,params:{...n.params}}):null}case"effect/reorder":{const n=i.effects.findIndex(a=>a.id===e.params.effectId);return n===-1?null:this.createInverseAction(e,"effect/reorder",{clipId:e.params.clipId,effectId:e.params.effectId,newIndex:n})}}}generateTransformInverse(e,t){const s=this.findClip(t.timeline,e.params.clipId);return s?this.createInverseAction(e,"transform/update",{clipId:e.params.clipId,transform:{...s.transform}}):null}generateKeyframeInverse(e,t){const s=this.findClip(t.timeline,e.params.clipId);if(!s)return null;switch(e.type){case"keyframe/add":return this.createInverseAction(e,"keyframe/remove",{clipId:e.params.clipId,property:e.params.property,time:e.params.time});case"keyframe/remove":{const i=s.keyframes.find(n=>n.property===e.params.property&&n.time===e.params.time);return i?this.createInverseAction(e,"keyframe/add",{clipId:e.params.clipId,property:i.property,time:i.time,value:i.value}):null}case"keyframe/update":{const i=s.keyframes.find(n=>n.property===e.params.property&&n.time===e.params.time);return i?this.createInverseAction(e,"keyframe/update",{clipId:e.params.clipId,property:i.property,time:i.time,value:i.value,easing:i.easing}):null}}}generateTransitionInverse(e,t){const s=t.timeline;switch(e.type){case"transition/add":return this.createInverseAction(e,"transition/remove",{transitionId:"__LAST_ADDED__"});case"transition/remove":{const i=this.findTransition(s,e.params.transitionId);return i?this.createInverseAction(e,"transition/restore",{transition:{...i}}):null}case"transition/update":{const i=this.findTransition(s,e.params.transitionId);return i?this.createInverseAction(e,"transition/update",{transitionId:e.params.transitionId,duration:i.duration,params:{...i.params}}):null}}}generateAudioInverse(e,t){const s=this.findClip(t.timeline,e.params.clipId);if(!s)return null;switch(e.type){case"audio/setVolume":return this.createInverseAction(e,"audio/setVolume",{clipId:e.params.clipId,volume:s.volume});case"audio/setFade":return this.createInverseAction(e,"audio/setFade",{clipId:e.params.clipId,fadeIn:s.fade?.fadeIn??0,fadeOut:s.fade?.fadeOut??0});case"audio/addAutomation":return this.createInverseAction(e,"audio/addAutomation",{clipId:e.params.clipId,points:s.automation?.volume??[]})}}generateSubtitleInverse(e,t){const s=t.timeline;switch(e.type){case"subtitle/import":return this.createInverseAction(e,"subtitle/restoreAll",{subtitles:s.subtitles.map(i=>({...i}))});case"subtitle/add":return this.createInverseAction(e,"subtitle/remove",{subtitleId:"__LAST_ADDED__"});case"subtitle/remove":{const i=s.subtitles.find(n=>n.id===e.params.subtitleId);return i?this.createInverseAction(e,"subtitle/restore",{subtitle:{...i}}):null}case"subtitle/update":{const i=s.subtitles.find(n=>n.id===e.params.subtitleId);return i?this.createInverseAction(e,"subtitle/update",{subtitleId:e.params.subtitleId,text:i.text,startTime:i.startTime,endTime:i.endTime}):null}case"subtitle/setStyle":{const i=s.subtitles[0];return this.createInverseAction(e,"subtitle/setStyle",{style:i?.style??null})}}}findClip(e,t){for(const s of e.tracks){const i=s.clips.find(n=>n.id===t);if(i)return i}return null}findTransition(e,t){for(const s of e.tracks){const i=s.transitions?.find(n=>n.id===t);if(i)return i}return null}cloneMediaItem(e){return{id:e.id,name:e.name,type:e.type,fileHandle:e.fileHandle,blob:e.blob,metadata:{...e.metadata},thumbnailUrl:e.thumbnailUrl,waveformData:e.waveformData?new Float32Array(e.waveformData):null}}cloneTrack(e){return{id:e.id,type:e.type,name:e.name,clips:e.clips.map(t=>this.cloneClip(t)),transitions:e.transitions?.map(t=>({...t}))??[],locked:e.locked,hidden:e.hidden,muted:e.muted,solo:e.solo}}cloneClip(e){return{id:e.id,mediaId:e.mediaId,trackId:e.trackId,startTime:e.startTime,duration:e.duration,inPoint:e.inPoint,outPoint:e.outPoint,effects:e.effects.map(t=>({...t,params:{...t.params}})),transform:{...e.transform},volume:e.volume,fade:e.fade?{...e.fade}:void 0,automation:e.automation?{volume:e.automation.volume?.map(t=>({...t})),pan:e.automation.pan?.map(t=>({...t}))}:void 0,keyframes:e.keyframes.map(t=>({...t}))}}}class qu{validator;history;inverseGenerator;lastAddedIds=new Map;constructor(e){this.validator=new qG,this.history=e||new id,this.inverseGenerator=new KG}async execute(e,t){const s=this.validator.validate(e,t);if(!s.valid)return{success:!1,error:{code:"INVALID_PARAMS",message:s.errors.map(a=>a.message).join("; "),details:{errors:s.errors}}};const i=JSON.parse(JSON.stringify(t)),n=this.inverseGenerator.generate(e,i);try{return await this.applyAction(e,t),this.history.push(e,n),{success:!0,actionId:e.id}}catch(a){return{success:!1,error:{code:"INVALID_PARAMS",message:a instanceof Error?a.message:"Unknown error occurred"}}}}async executeMany(e,t){const s=[];for(const i of e){const n=await this.execute(i,t);if(s.push(n),!n.success)break}return s}async undo(e){if(!this.history.canUndo())return{success:!1,error:{code:"INVALID_PARAMS",message:"Nothing to undo"}};const t=this.history.undoGroup();if(t.length===0)return{success:!1,error:{code:"INVALID_PARAMS",message:"No inverse action available"}};try{for(const s of t){const i=this.resolveSpecialMarkers(s);await this.applyAction(i,e)}return{success:!0,actionId:t[0].id}}catch(s){return{success:!1,error:{code:"INVALID_PARAMS",message:s instanceof Error?s.message:"Undo failed"}}}}async redo(e){if(!this.history.canRedo())return{success:!1,error:{code:"INVALID_PARAMS",message:"Nothing to redo"}};const t=this.history.redoGroup();if(t.length===0)return{success:!1,error:{code:"INVALID_PARAMS",message:"No action to redo"}};try{for(const s of t)await this.applyAction(s,e);return{success:!0,actionId:t[0].id}}catch(s){return{success:!1,error:{code:"INVALID_PARAMS",message:s instanceof Error?s.message:"Redo failed"}}}}getHistory(){return this.history}resolveSpecialMarkers(e){const t={...e.params};for(const[s,i]of Object.entries(t))if(i==="__LAST_ADDED__"){const n=this.lastAddedIds.get(e.type.split("/")[0]);n&&(t[s]=n)}return{...e,params:t}}async applyAction(e,t){const s=e.type;s.startsWith("project/")?this.applyProjectAction(e,t):s.startsWith("media/")?await this.applyMediaAction(e,t):s.startsWith("track/")?this.applyTrackAction(e,t):s.startsWith("clip/")?this.applyClipAction(e,t):s.startsWith("effect/")?this.applyEffectAction(e,t):s.startsWith("transform/")?this.applyTransformAction(e,t):s.startsWith("keyframe/")?this.applyKeyframeAction(e,t):s.startsWith("transition/")?this.applyTransitionAction(e,t):s.startsWith("audio/")?this.applyAudioAction(e,t):s.startsWith("subtitle/")&&this.applySubtitleAction(e,t)}applyProjectAction(e,t){switch(e.type){case"project/rename":t.name=e.params.name,t.modifiedAt=Date.now();break;case"project/updateSettings":t.settings={...t.settings,...e.params},t.modifiedAt=Date.now();break;case"project/create":t.name=e.params.name,t.settings=e.params.settings,t.modifiedAt=Date.now();break}}async applyMediaAction(e,t){const s=t.mediaLibrary;switch(e.type){case"media/import":{const i=e.params,n={id:`media-${Date.now()}`,name:i.file.name,type:this.inferMediaType(i.file),fileHandle:null,blob:i.file,metadata:{duration:0,width:0,height:0,frameRate:0,codec:"",sampleRate:0,channels:0,fileSize:i.file.size},thumbnailUrl:null,waveformData:null};s.items=[...s.items,n],this.lastAddedIds.set("media",n.id);break}case"media/delete":{const i=e.params;s.items=s.items.filter(n=>n.id!==i.mediaId);break}case"media/rename":{const i=e.params;s.items=s.items.map(n=>n.id===i.mediaId?{...n,name:i.name}:n);break}case"media/restore":{const i=e.params;s.items=[...s.items,i.mediaItem];break}}}inferMediaType(e){return e.type.startsWith("video/")?"video":e.type.startsWith("audio/")?"audio":e.type.startsWith("image/")?"image":"video"}applyTrackAction(e,t){const s=t.timeline;switch(e.type){case"track/add":{const i=e.params,n={video:"Video",audio:"Audio",image:"Image",text:"Text",graphics:"Graphics"},a=s.tracks.filter(d=>d.type===i.trackType).length+1,o={id:`track-${Date.now()}`,type:i.trackType,name:`${n[i.trackType]||i.trackType} ${a}`,clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},l=i.position!==void 0?i.position:s.tracks.length;s.tracks=[...s.tracks.slice(0,l),o,...s.tracks.slice(l)],this.lastAddedIds.set("track",o.id);break}case"track/remove":{const i=e.params;s.tracks=s.tracks.filter(n=>n.id!==i.trackId);break}case"track/restore":{const i=e.params;s.tracks=[...s.tracks.slice(0,i.position),i.track,...s.tracks.slice(i.position)];break}case"track/reorder":{const i=e.params,n=s.tracks.findIndex(a=>a.id===i.trackId);if(n!==-1){const[a]=s.tracks.splice(n,1);s.tracks.splice(i.newPosition,0,a)}break}case"track/lock":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,locked:i.locked}:n);break}case"track/hide":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,hidden:i.hidden}:n);break}case"track/mute":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,muted:i.muted}:n);break}case"track/solo":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,solo:i.solo}:n);break}}}applyClipAction(e,t){const s=t.timeline;switch(e.type){case"clip/add":{const i=e.params,n=s.tracks.find(a=>a.id===i.trackId);if(n){const a=t.mediaLibrary.items.find(d=>d.id===i.mediaId),o=i.duration??(a?.metadata.duration&&a.metadata.duration>0?a.metadata.duration:5),l={id:`clip-${Date.now()}`,mediaId:i.mediaId,trackId:i.trackId,startTime:i.startTime,duration:o,inPoint:0,outPoint:o,effects:[],audioEffects:[],transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},volume:1,keyframes:[]};n.clips=[...n.clips,l],this.lastAddedIds.set("clip",l.id)}break}case"clip/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.filter(a=>a.id!==i.clipId)}));break}case"clip/restore":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.clip.trackId?{...n,clips:[...n.clips,i.clip]}:n);break}case"clip/move":{const i=e.params,n=this.findClip(s,i.clipId);if(n){s.tracks=s.tracks.map(o=>({...o,clips:o.clips.filter(l=>l.id!==i.clipId)}));const a=i.trackId||n.trackId;s.tracks=s.tracks.map(o=>o.id===a?{...o,clips:[...o.clips,{...n,startTime:i.startTime,trackId:a}]}:o)}break}case"clip/trim":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>{if(a.id===i.clipId){const o={};return i.inPoint!==void 0&&(o.inPoint=i.inPoint,o.duration=a.outPoint-i.inPoint),i.outPoint!==void 0&&(o.outPoint=i.outPoint,o.duration=i.outPoint-a.inPoint),{...a,...o}}return a})}));break}case"clip/split":{const i=e.params,n=this.findClip(s,i.clipId);if(n){const a=i.time,o=a-n.startTime,l={...n,duration:o,outPoint:n.inPoint+o},d={...n,id:`clip-${Date.now()}`,startTime:a,duration:n.duration-o,inPoint:n.inPoint+o};s.tracks=s.tracks.map(u=>({...u,clips:u.clips.flatMap(h=>h.id===i.clipId?[l,d]:[h])})),this.lastAddedIds.set("clip",d.id)}break}case"clip/merge":{const i=e.params,n=i.originalClip.startTime,a=n+i.originalClip.duration,o=i.originalClip.mediaId;s.tracks=s.tracks.map(l=>{if(l.id===i.originalClip.trackId){const d=l.clips.filter(u=>{if(u.id===i.clipId)return!1;if(u.mediaId===o){const h=u.startTime+u.duration;if(u.startTime>=n&&h<=a)return!1}return!0});return{...l,clips:[...d,i.originalClip]}}return l});break}case"clip/rippleDelete":{const i=e.params,n=this.findClip(s,i.clipId);if(n){const a=n.duration,o=n.startTime;s.tracks=s.tracks.map(l=>l.id===n.trackId?{...l,clips:l.clips.filter(d=>d.id!==i.clipId).map(d=>d.startTime>o?{...d,startTime:d.startTime-a}:d)}:l)}break}case"clip/rippleRestore":{const i=e.params;s.tracks=s.tracks.map(n=>{if(n.id===i.clip.trackId){const a=n.clips.map(o=>{const l=i.affectedClips.find(d=>d.id===o.id);return l?{...o,startTime:l.originalStartTime}:o});return{...n,clips:[...a,i.clip]}}return n});break}case"clip/slip":{const i=e.params,n=this.findClip(s,i.clipId);if(n){const a=Math.max(0,n.inPoint+i.delta),o=a+n.duration;s.tracks=s.tracks.map(l=>({...l,clips:l.clips.map(d=>d.id===i.clipId?{...d,inPoint:a,outPoint:o}:d)}))}break}case"clip/slide":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,startTime:Math.max(0,a.startTime+i.delta)}:a.id===i.prevClipId&&i.delta>0?{...a,duration:a.duration+i.delta}:a.id===i.nextClipId&&i.delta<0?{...a,startTime:a.startTime+i.delta,inPoint:a.inPoint-i.delta,duration:a.duration-i.delta}:a)}));break}case"clip/roll":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.leftClipId?{...a,duration:a.duration+i.delta,outPoint:a.outPoint+i.delta}:a.id===i.rightClipId?{...a,startTime:a.startTime+i.delta,inPoint:a.inPoint+i.delta,duration:a.duration-i.delta}:a)}));break}case"clip/trimToPlayhead":{const i=e.params;this.findClip(s,i.clipId)&&(s.tracks=s.tracks.map(a=>({...a,clips:a.clips.map(o=>{if(o.id!==i.clipId)return o;if(i.trimStart){const l=i.playheadTime-o.startTime;return{...o,startTime:i.playheadTime,inPoint:o.inPoint+l,duration:o.duration-l}}else return{...o,duration:i.playheadTime-o.startTime,outPoint:o.inPoint+(i.playheadTime-o.startTime)}})})));break}}}applyEffectAction(e,t){const s=t.timeline;switch(e.type){case"effect/add":{const i=e.params,n={id:`effect-${Date.now()}`,type:i.effectType,params:i.params||{},enabled:!0};s.tracks=s.tracks.map(a=>({...a,clips:a.clips.map(o=>o.id===i.clipId?{...o,effects:[...o.effects,n]}:o)})),this.lastAddedIds.set("effect",n.id);break}case"effect/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,effects:a.effects.filter(o=>o.id!==i.effectId)}:a)}));break}case"effect/restore":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>{if(a.id===i.clipId){const o=[...a.effects];return o.splice(i.index,0,i.effect),{...a,effects:o}}return a})}));break}case"effect/update":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,effects:a.effects.map(o=>o.id===i.effectId?{...o,params:{...o.params,...i.params}}:o)}:a)}));break}case"effect/reorder":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>{if(a.id===i.clipId){const o=[...a.effects],l=o.findIndex(d=>d.id===i.effectId);if(l!==-1){const[d]=o.splice(l,1);o.splice(i.newIndex,0,d)}return{...a,effects:o}}return a})}));break}}}applyTransformAction(e,t){const s=t.timeline;s.tracks=s.tracks.map(i=>({...i,clips:i.clips.map(n=>n.id===e.params.clipId?{...n,transform:{...n.transform,...e.params.transform}}:n)}))}applyKeyframeAction(e,t){const s=t.timeline;switch(e.type){case"keyframe/add":{const i=e.params,n={id:`keyframe-${Date.now()}`,time:i.time,property:i.property,value:i.value,easing:"linear"};s.tracks=s.tracks.map(a=>({...a,clips:a.clips.map(o=>o.id===i.clipId?{...o,keyframes:[...o.keyframes,n]}:o)})),this.lastAddedIds.set("keyframe",n.id);break}case"keyframe/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,keyframes:a.keyframes.filter(o=>!(o.property===i.property&&o.time===i.time))}:a)}));break}case"keyframe/update":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,keyframes:a.keyframes.map(o=>o.property===i.property&&o.time===i.time?{...o,...i.value!==void 0&&{value:i.value},...i.easing!==void 0&&{easing:i.easing}}:o)}:a)}));break}}}applyTransitionAction(e,t){const s=t.timeline;switch(e.type){case"transition/add":{const i=e.params,n=this.findClip(s,i.clipAId);if(n){const a=s.tracks.find(o=>o.id===n.trackId);if(a){const o={id:`transition-${Date.now()}`,clipAId:i.clipAId,clipBId:i.clipBId,type:i.transitionType,duration:i.duration,params:{}};a.transitions=[...a.transitions||[],o],this.lastAddedIds.set("transition",o.id)}}break}case"transition/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,transitions:(n.transitions||[]).filter(a=>a.id!==i.transitionId)}));break}case"transition/restore":{const i=e.params,n=this.findClip(s,i.transition.clipAId);n&&(s.tracks=s.tracks.map(a=>a.id===n.trackId?{...a,transitions:[...a.transitions||[],i.transition]}:a));break}case"transition/update":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,transitions:(n.transitions||[]).map(a=>a.id===i.transitionId?{...a,...i.duration!==void 0&&{duration:i.duration},...i.params!==void 0&&{params:{...a.params,...i.params}}}:a)}));break}}}applyAudioAction(e,t){const s=t.timeline;switch(e.type){case"audio/setVolume":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,volume:i.volume}:a)}));break}case"audio/setFade":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,fade:{fadeIn:i.fadeIn!==void 0?i.fadeIn:a.fade?.fadeIn||0,fadeOut:i.fadeOut!==void 0?i.fadeOut:a.fade?.fadeOut||0}}:a)}));break}case"audio/addAutomation":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,automation:{...a.automation,volume:i.points}}:a)}));break}}}applySubtitleAction(e,t){const s=t.timeline;switch(e.type){case"subtitle/add":{const i=e.params,n={id:`subtitle-${Date.now()}`,text:i.text,startTime:i.startTime,endTime:i.endTime};s.subtitles=[...s.subtitles||[],n],this.lastAddedIds.set("subtitle",n.id);break}case"subtitle/remove":{const i=e.params;s.subtitles=(s.subtitles||[]).filter(n=>n.id!==i.subtitleId);break}case"subtitle/restore":{const i=e.params;s.subtitles=[...s.subtitles||[],i.subtitle];break}case"subtitle/restoreAll":{const i=e.params;s.subtitles=i.subtitles;break}case"subtitle/update":{const i=e.params;s.subtitles=(s.subtitles||[]).map(n=>n.id===i.subtitleId?{...n,...i.text!==void 0&&{text:i.text},...i.startTime!==void 0&&{startTime:i.startTime},...i.endTime!==void 0&&{endTime:i.endTime}}:n);break}case"subtitle/setStyle":{const i=e.params;s.subtitles=(s.subtitles||[]).map(n=>({...n,style:i.style}));break}case"subtitle/import":{const i=e.params,n=/(\d+)\n(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})\n([\s\S]*?)(?=\n\n|\n*$)/g;let a;const o=[];for(;(a=n.exec(i.srtContent))!==null;){const l=this.parseSrtTime(a[2]),d=this.parseSrtTime(a[3]),u=a[4].trim();o.push({id:`subtitle-${Date.now()}-${a[1]}`,text:u,startTime:l,endTime:d})}o.length>0&&(s.subtitles=[...s.subtitles||[],...o]);break}}}parseSrtTime(e){const[t,s]=e.split(","),[i,n,a]=t.split(":").map(Number);return i*3600+n*60+a+Number(s)/1e3}findClip(e,t){for(const s of e.tracks){const i=s.clips.find(n=>n.id===t);if(i)return i}return null}}const QG=1,JG="openreel-db",it={PROJECTS:"projects",MEDIA:"media",CACHE:"cache",WAVEFORMS:"waveforms"};function Vn(r,e,t){return{code:r,message:e,quotaInfo:t}}class hM{db=null;dbPromise=null;async getDb(){return this.db?this.db:this.dbPromise?this.dbPromise:(this.dbPromise=this.openDatabase(),this.db=await this.dbPromise,this.db)}openDatabase(){return new Promise((e,t)=>{if(typeof indexedDB>"u"){t(Vn("BROWSER_NOT_SUPPORTED","IndexedDB is not supported in this environment"));return}const s=indexedDB.open(JG,QG);s.onerror=()=>{t(Vn("DATABASE_ERROR",`Failed to open database: ${s.error?.message}`))},s.onsuccess=()=>{e(s.result)},s.onupgradeneeded=i=>{const n=i.target.result;this.createStores(n)}})}createStores(e){if(!e.objectStoreNames.contains(it.PROJECTS)){const t=e.createObjectStore(it.PROJECTS,{keyPath:"id"});t.createIndex("modifiedAt","modifiedAt",{unique:!1}),t.createIndex("name","name",{unique:!1})}e.objectStoreNames.contains(it.MEDIA)||e.createObjectStore(it.MEDIA,{keyPath:"id"}).createIndex("projectId","projectId",{unique:!1}),e.objectStoreNames.contains(it.CACHE)||e.createObjectStore(it.CACHE,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1}),e.objectStoreNames.contains(it.WAVEFORMS)||e.createObjectStore(it.WAVEFORMS,{keyPath:"mediaId"})}async transaction(e,t,s){const i=await this.getDb();return new Promise((n,a)=>{const o=i.transaction(e,t),l={},d=Array.isArray(e)?e:[e];for(const h of d)l[h]=o.objectStore(h);const u=s(l);u.onsuccess=()=>n(u.result),u.onerror=()=>a(Vn("DATABASE_ERROR",`Transaction failed: ${u.error?.message}`))})}async transactionGetAll(e,t,s){const i=await this.getDb();return new Promise((n,a)=>{const l=i.transaction(e,"readonly").objectStore(e),d=t?l.index(t):l,u=s?d.getAll(s):d.getAll();u.onsuccess=()=>n(u.result),u.onerror=()=>a(Vn("DATABASE_ERROR",`Failed to get all: ${u.error?.message}`))})}async saveProject(e){try{const t=WG(e),s={id:e.id,name:e.name,createdAt:e.createdAt,modifiedAt:e.modifiedAt,data:t};await this.transaction(it.PROJECTS,"readwrite",i=>i[it.PROJECTS].put(s))}catch(t){throw t.code?t:Vn("SERIALIZATION_FAILED",`Failed to serialize project: ${t.message}`)}}async loadProject(e){try{const t=await this.transaction(it.PROJECTS,"readonly",s=>s[it.PROJECTS].get(e));return t?YG(t.data):null}catch(t){throw t.code?t:Vn("DESERIALIZATION_FAILED",`Failed to deserialize project: ${t.message}`)}}async listProjects(){return(await this.transactionGetAll(it.PROJECTS)).map(t=>({id:t.id,name:t.name,createdAt:t.createdAt,modifiedAt:t.modifiedAt})).sort((t,s)=>s.modifiedAt-t.modifiedAt)}async deleteProject(e){const t=await this.getDb(),s=await this.getMediaByProject(e);for(const i of s)await this.deleteMedia(i.id);return new Promise((i,n)=>{const l=t.transaction(it.PROJECTS,"readwrite").objectStore(it.PROJECTS).delete(e);l.onsuccess=()=>i(),l.onerror=()=>n(Vn("DATABASE_ERROR",`Failed to delete project: ${l.error?.message}`))})}async saveMedia(e){await this.transaction(it.MEDIA,"readwrite",t=>t[it.MEDIA].put(e))}async loadMedia(e){return await this.transaction(it.MEDIA,"readonly",s=>s[it.MEDIA].get(e))||null}async deleteMedia(e){await this.deleteWaveform(e),await this.transaction(it.MEDIA,"readwrite",t=>t[it.MEDIA].delete(e))}async getMediaByProject(e){return this.transactionGetAll(it.MEDIA,"projectId",e)}async saveCache(e){await this.transaction(it.CACHE,"readwrite",t=>t[it.CACHE].put(e))}async loadCache(e){const t=await this.transaction(it.CACHE,"readonly",s=>s[it.CACHE].get(e));if(t){const s={...t,timestamp:Date.now()};return await this.saveCache(s),s}return null}async deleteCache(e){await this.transaction(it.CACHE,"readwrite",t=>t[it.CACHE].delete(e))}async clearCache(){const e=await this.getDb();return new Promise((t,s)=>{const a=e.transaction(it.CACHE,"readwrite").objectStore(it.CACHE).clear();a.onsuccess=()=>t(),a.onerror=()=>s(Vn("DATABASE_ERROR",`Failed to clear cache: ${a.error?.message}`))})}async saveWaveform(e){await this.transaction(it.WAVEFORMS,"readwrite",t=>t[it.WAVEFORMS].put(e))}async loadWaveform(e){return await this.transaction(it.WAVEFORMS,"readonly",s=>s[it.WAVEFORMS].get(e))||null}async deleteWaveform(e){await this.transaction(it.WAVEFORMS,"readwrite",t=>t[it.WAVEFORMS].delete(e))}async getStorageUsage(){const e=await this.getDb(),t=await new Promise((a,o)=>{const u=e.transaction(it.PROJECTS,"readonly").objectStore(it.PROJECTS).count();u.onsuccess=()=>a(u.result),u.onerror=()=>o(u.error)}),s=await new Promise((a,o)=>{const u=e.transaction(it.MEDIA,"readonly").objectStore(it.MEDIA).count();u.onsuccess=()=>a(u.result),u.onerror=()=>o(u.error)});let i=0,n=0;if(navigator.storage&&navigator.storage.estimate)try{const a=await navigator.storage.estimate();i=a.usage||0,n=a.quota||0}catch{}return{used:i,quota:n,projects:t,mediaItems:s}}close(){this.db&&(this.db.close(),this.db=null,this.dbPromise=null)}}function ZG(){return new hM}const Il="1.0.0";class e9{storage;constructor(e){this.storage=e}async saveProject(e){await this.saveMediaBlobs(e);const t={...e,modifiedAt:Date.now()};await this.storage.saveProject(t)}async loadProject(e){const t=await this.storage.loadProject(e);return t?await this.restoreMediaBlobs(t):null}exportToJson(e){const t={version:Il,project:this.stripMediaBlobs(e)};return JSON.stringify(t,(s,i)=>this.safeJsonReplacer(s,i),2)}importFromJson(e){const t=JSON.parse(e);if(t.version!==Il)return this.migrateProject(t);const s=t.project,i=s.mediaLibrary.items.map(n=>n.blob?n:{...n,isPlaceholder:!0,originalUrl:n.thumbnailUrl||void 0});return{...s,mediaLibrary:{items:i}}}exportToJsonWithMetadata(e,t){const s={version:Il,project:this.stripMediaBlobs(e),metadata:{exportedAt:Date.now(),description:t}};return JSON.stringify(s,(i,n)=>this.safeJsonReplacer(i,n),2)}validateProjectJson(e){const t={valid:!0,errors:[],warnings:[],missingAssets:[]};try{const s=JSON.parse(e);if(s.version?s.version!==Il&&t.warnings.push(`Version mismatch: expected ${Il}, got ${s.version}`):(t.errors.push("Missing version field"),t.valid=!1),!s.project)return t.errors.push("Missing project field"),t.valid=!1,t;const i=s.project;if(i.id||(t.errors.push("Missing project.id"),t.valid=!1),i.name||(t.errors.push("Missing project.name"),t.valid=!1),i.settings||(t.errors.push("Missing project.settings"),t.valid=!1),i.timeline||(t.errors.push("Missing project.timeline"),t.valid=!1),i.mediaLibrary||(t.errors.push("Missing project.mediaLibrary"),t.valid=!1),!t.valid)return t;const n=new Set(i.mediaLibrary.items.map(a=>a.id));for(const a of i.mediaLibrary.items)!a.blob&&!a.thumbnailUrl&&t.missingAssets.push(a.id);if(i.timeline.tracks){for(const a of i.timeline.tracks)if(a.clips)for(const o of a.clips)o.mediaId&&!n.has(o.mediaId)&&(t.errors.push(`Clip ${o.id} references non-existent mediaId: ${o.mediaId}`),t.valid=!1)}t.missingAssets&&t.missingAssets.length>0&&t.warnings.push(`${t.missingAssets.length} asset(s) need replacement`)}catch(s){t.errors.push(`Invalid JSON: ${s instanceof Error?s.message:"Parse error"}`),t.valid=!1}return t}importFromJsonWithValidation(e){const t=this.validateProjectJson(e);return t.valid?{project:this.importFromJson(e),validation:t}:{project:null,validation:t}}async saveMediaBlobs(e){for(const t of e.mediaLibrary.items)if(t.blob){const s={id:t.id,projectId:e.id,blob:t.blob,metadata:t.metadata};await this.storage.saveMedia(s)}}async restoreMediaBlobs(e){const t=[];for(const s of e.mediaLibrary.items){const i=await this.storage.loadMedia(s.id);i?t.push({...s,blob:i.blob,metadata:i.metadata}):t.push(s)}return{...e,mediaLibrary:{items:t}}}stripMediaBlobs(e){const t=e.mediaLibrary.items.map(s=>({...s,blob:null,fileHandle:null,waveformData:null,filmstripThumbnails:void 0,thumbnailUrl:null}));return{...e,mediaLibrary:{items:t}}}safeJsonReplacer(e,t){if(t==null)return t;if(typeof t=="bigint")return Number(t);if(typeof t!="function"&&typeof t!="symbol")return t instanceof Blob||t instanceof File||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||typeof FileSystemFileHandle<"u"&&t instanceof FileSystemFileHandle?null:t}migrateProject(e){return e.project}async deleteProject(e){await this.storage.deleteProject(e)}async listProjects(){return this.storage.listProjects()}}function t9(r){return new e9(r)}const rC=["#8b5cf6","#ec4899","#f97316","#22c55e","#06b6d4","#3b82f6","#eab308","#ef4444"];function nC(){return`compound_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}class s9{compoundClips=new Map;instances=new Map;instancesByCompound=new Map;colorIndex=0;createCompoundClip(e,t,s={}){if(e.length===0)throw new Error("Cannot create compound clip from empty selection");const i=Math.min(...e.map(h=>h.startTime)),a=Math.max(...e.map(h=>h.startTime+h.duration))-i,o=e.map(h=>({...h,startTime:h.startTime-i})),l=new Set(e.map(h=>h.trackId)),d=t.filter(h=>l.has(h.id)),u={id:nC(),name:s.name||`Compound Clip ${this.compoundClips.size+1}`,content:{clips:o,tracks:d,duration:a},createdAt:Date.now(),modifiedAt:Date.now(),color:s.color||rC[this.colorIndex++%rC.length]};return this.compoundClips.set(u.id,u),this.instancesByCompound.set(u.id,new Set),u}getCompoundClip(e){return this.compoundClips.get(e)}getAllCompoundClips(){return Array.from(this.compoundClips.values())}updateCompoundClip(e,t){const s=this.compoundClips.get(e);return s?(this.compoundClips.set(e,{...s,content:t,modifiedAt:Date.now()}),!0):!1}renameCompoundClip(e,t){const s=this.compoundClips.get(e);return s?(this.compoundClips.set(e,{...s,name:t,modifiedAt:Date.now()}),!0):!1}deleteCompoundClip(e){const t=this.instancesByCompound.get(e);return t&&t.size>0?!1:(this.instancesByCompound.delete(e),this.compoundClips.delete(e))}createInstance(e,t,s){const i=this.compoundClips.get(e);if(!i)return null;const n={id:`instance_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,compoundClipId:e,trackId:t,startTime:s,duration:i.content.duration,inPoint:0,outPoint:i.content.duration,transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},volume:1};return this.instances.set(n.id,n),this.instancesByCompound.get(e)?.add(n.id),n}getInstance(e){return this.instances.get(e)}getInstancesForCompound(e){const t=this.instancesByCompound.get(e);return t?Array.from(t).map(s=>this.instances.get(s)).filter(s=>s!==void 0):[]}getAllInstances(){return Array.from(this.instances.values())}updateInstance(e,t){const s=this.instances.get(e);return s?(this.instances.set(e,{...s,...t,id:s.id,compoundClipId:s.compoundClipId}),!0):!1}deleteInstance(e){const t=this.instances.get(e);return t?(this.instancesByCompound.get(t.compoundClipId)?.delete(e),this.instances.delete(e)):!1}flattenInstance(e){const t=this.instances.get(e);if(!t)return null;const s=this.compoundClips.get(t.compoundClipId);if(!s)return null;const i=s.content.clips.map(n=>({...n,id:`flat_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,startTime:t.startTime+n.startTime,trackId:t.trackId}));return this.deleteInstance(e),{clips:i,trackId:t.trackId,startTime:t.startTime}}duplicateCompoundClip(e,t){const s=this.compoundClips.get(e);if(!s)return null;const i={...s,id:nC(),name:t||`${s.name} (Copy)`,createdAt:Date.now(),modifiedAt:Date.now()};return this.compoundClips.set(i.id,i),this.instancesByCompound.set(i.id,new Set),i}getCompoundClipForInstance(e){const t=this.instances.get(e);if(t)return this.compoundClips.get(t.compoundClipId)}getInstanceCount(e){return this.instancesByCompound.get(e)?.size||0}clearAll(){this.compoundClips.clear(),this.instances.clear(),this.instancesByCompound.clear(),this.colorIndex=0}}const pM=["video/mp4","video/webm","video/quicktime","video/x-matroska"],mM=["audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/aac","audio/flac","audio/webm"],fM=["image/jpeg","image/png","image/webp","image/gif"];function gM(r){const e=r.split(";")[0].trim();return pM.includes(e)||mM.includes(e)||fM.includes(e)}function aC(r){const e=r.split(";")[0].trim();return pM.includes(e)?"video":mM.includes(e)?"audio":fM.includes(e)?"image":null}class i9{input=null;sink=null;mediabunny;file;width;initialized=!1;constructor(e,t,s){this.mediabunny=e,this.file=t,this.width=s}async initialize(){if(this.initialized)return!0;const{Input:e,ALL_FORMATS:t,BlobSource:s,CanvasSink:i}=this.mediabunny;this.input=new e({source:new s(this.file),formats:t});const n=await this.input.getPrimaryVideoTrack();if(!n)return this.dispose(),!1;if(!await n.canDecode())return this.dispose(),!1;const o={poolSize:2};if(this.width){const l=n.displayHeight/n.displayWidth;o.width=this.width,o.height=Math.round(this.width*l),o.fit="contain"}return this.sink=new i(n,o),this.initialized=!0,!0}async getFrame(e){if(!this.sink)return null;const t=await this.sink.getCanvas(e);if(!t)return null;const s=new OffscreenCanvas(t.canvas.width,t.canvas.height),i=s.getContext("2d");return i&&i.drawImage(t.canvas,0,0),s}dispose(){this.input&&(this.input[Symbol.dispose]?.(),this.input=null),this.sink=null,this.initialized=!1}}class r9{initialized=!1;mediabunny=null;frameCache=new Map;MAX_CACHE_SIZE=50;exportDecoders=new Map;async initialize(){if(!this.initialized)try{this.mediabunny=await hi(()=>import("./index2.js"),[]),this.initialized=!0}catch{throw console.warn("MediaBunny not available, will use fallback"),new Error("MediaBunny initialization failed")}}isAvailable(){return this.initialized&&this.mediabunny!==null}clearFrameCache(){this.frameCache.clear()}getFrameCacheSize(){return this.frameCache.size}async createExportDecoder(e,t,s){this.ensureInitialized();const i=this.exportDecoders.get(e);if(i)return i;const n=new i9(this.mediabunny,t,s);return await n.initialize()?(this.exportDecoders.set(e,n),n):null}getExportDecoder(e){return this.exportDecoders.get(e)||null}disposeExportDecoder(e){const t=this.exportDecoders.get(e);t&&(t.dispose(),this.exportDecoders.delete(e))}disposeAllExportDecoders(){for(const e of this.exportDecoders.values())e.dispose();this.exportDecoders.clear()}ensureInitialized(){if(!this.mediabunny)throw new Error("MediaBunny not initialized. Call initialize() first.")}async createInput(e){this.ensureInitialized();const{Input:t,ALL_FORMATS:s,BlobSource:i}=this.mediabunny;return new t({source:new i(e),formats:s})}async validateFormat(e){const t=e.type;if(!gM(t))return{supported:!1,format:null,error:`Unsupported format: ${t||"unknown"}. Supported formats: MP4, WebM, MOV, MP3, WAV, AAC, JPG, PNG, WebP`};if(t.startsWith("image/"))return{supported:!0,format:t};try{const s=await this.createInput(e),i=await s.getFormat();return s[Symbol.dispose]?.(),i?{supported:!0,format:t}:{supported:!1,format:null,error:"Could not determine file format. The file may be corrupted."}}catch(s){return{supported:!1,format:null,error:`Failed to parse file: ${s instanceof Error?s.message:"Unknown error"}`}}}async extractImageMetadata(e,t){const s=new Image,i=URL.createObjectURL(e);try{return await new Promise((n,a)=>{s.onload=()=>n(),s.onerror=()=>a(new Error("Failed to load image")),s.src=i}),{duration:0,width:s.naturalWidth,height:s.naturalHeight,frameRate:0,codec:"",sampleRate:0,channels:0,fileSize:e.size,mimeType:t,hasVideo:!1,hasAudio:!1,rotation:0,canDecode:!0,videoBitrate:0}}finally{URL.revokeObjectURL(i)}}async extractMetadata(e){const t=e instanceof File?e.type:"";if(t.startsWith("image/"))return await this.extractImageMetadata(e,t);const s=await this.createInput(e);try{const i=await s.computeDuration(),n=await s.getMimeType(),a=await s.getPrimaryVideoTrack(),o=await s.getPrimaryAudioTrack();let l=0,d=0,u=0,h="",p=0,m=!1,f=0;if(a){l=a.displayWidth,d=a.displayHeight,p=a.rotation||0,h=a.codec||"",m=await a.canDecode();try{const b=await a.computePacketStats(100);u=b.averagePacketRate||30,f=b.averageBitrate||0}catch{u=30}}let g=0,y=0,x="",v=!1;return o&&(g=o.sampleRate,y=o.numberOfChannels,x=o.codec||"",v=await o.canDecode()),{duration:i,width:l,height:d,frameRate:u,codec:h||x,sampleRate:g,channels:y,fileSize:e.size,mimeType:n,hasVideo:!!a,hasAudio:!!o,rotation:p,canDecode:m||v,videoBitrate:f}}finally{s[Symbol.dispose]?.()}}async generateThumbnails(e,t=5,s=320){this.ensureInitialized();const{CanvasSink:i}=this.mediabunny,n=await this.createInput(e);try{const a=await n.getPrimaryVideoTrack();if(!a)return[];if(!await a.canDecode())throw new Error("Cannot decode video track");const l=a.displayHeight/a.displayWidth,d=Math.round(s*l),u=new i(a,{width:s,height:d,fit:"contain",poolSize:Math.min(t,10)}),h=await a.getFirstTimestamp(),m=await a.computeDuration()-h,f=t===1?[h]:Array.from({length:t},(y,x)=>h+x/(t-1)*m),g=[];for await(const y of u.canvasesAtTimestamps(f))if(y){const x=new OffscreenCanvas(y.canvas.width,y.canvas.height),v=x.getContext("2d");v&&v.drawImage(y.canvas,0,0);let b;try{const S=await x.convertToBlob({type:"image/jpeg",quality:.7});b=URL.createObjectURL(S)}catch{}g.push({timestamp:y.timestamp,canvas:x,dataUrl:b})}return g}finally{n[Symbol.dispose]?.()}}async generateFilmstripThumbnails(e,t,s=80,i=1){this.ensureInitialized();const{CanvasSink:n}=this.mediabunny,a=await this.createInput(e);try{const o=await a.getPrimaryVideoTrack();if(!o)return[];if(!await o.canDecode())throw new Error("Cannot decode video track");const d=o.displayHeight/o.displayWidth,u=Math.round(s*d),h=Math.max(1,Math.ceil(t/i)),p=new n(o,{width:s,height:u,fit:"cover",poolSize:Math.min(h,20)}),m=await o.getFirstTimestamp(),f=Array.from({length:h},(y,x)=>m+x*i),g=[];for await(const y of p.canvasesAtTimestamps(f))if(y){const x=new OffscreenCanvas(y.canvas.width,y.canvas.height),v=x.getContext("2d");v&&v.drawImage(y.canvas,0,0);let b;try{const S=await x.convertToBlob({type:"image/jpeg",quality:.6});b=URL.createObjectURL(S)}catch{}g.push({timestamp:y.timestamp,canvas:x,dataUrl:b})}return g}finally{a[Symbol.dispose]?.()}}async getFrameAtTime(e,t,s){this.ensureInitialized();const{CanvasSink:i}=this.mediabunny,a=`${"name"in e?e.name:"blob"}-${e.size}-${t}-${s||"auto"}`,o=this.frameCache.get(a);if(o)return o.lastAccessed=Date.now(),{timestamp:o.timestamp,duration:0,canvas:o.image,width:o.width,height:o.height};const l=await this.createInput(e);try{const d=await l.getPrimaryVideoTrack();if(!d)return null;if(!await d.canDecode())throw new Error("Cannot decode video track");const h={poolSize:1};if(s){const y=d.displayHeight/d.displayWidth;h.width=s,h.height=Math.round(s*y),h.fit="contain"}const m=await new i(d,h).getCanvas(t);if(!m)return null;const f=new OffscreenCanvas(m.canvas.width,m.canvas.height),g=f.getContext("2d");if(g&&g.drawImage(m.canvas,0,0),this.frameCache.size>=this.MAX_CACHE_SIZE){let y="",x=1/0;for(const[v,b]of this.frameCache.entries())b.lastAccessed<x&&(x=b.lastAccessed,y=v);y&&this.frameCache.delete(y)}return this.frameCache.set(a,{timestamp:m.timestamp,image:f,width:f.width,height:f.height,lastAccessed:Date.now()}),{timestamp:m.timestamp,duration:m.duration,canvas:f,width:f.width,height:f.height}}finally{l[Symbol.dispose]?.()}}async generateWaveform(e,t=100){this.ensureInitialized();const{AudioSampleSink:s}=this.mediabunny,i=await this.createInput(e);try{const n=await i.getPrimaryAudioTrack();if(!n)throw new Error("No audio track found");if(!await n.canDecode())throw new Error("Cannot decode audio track");const o=new s(n),l=await n.computeDuration(),d=Math.ceil(l*t),u=[],h=[],p=Array.from({length:d},(m,f)=>f/t);for await(const m of o.samplesAtTimestamps(p)){if(!m){u.push(0),h.push(0);continue}const f=m.allocationSize({format:"f32",planeIndex:0}),g=new Float32Array(f/4);m.copyTo(g,{format:"f32",planeIndex:0});let y=0,x=0;for(let v=0;v<g.length;v++){const b=Math.abs(g[v]);y=Math.max(y,b),x+=g[v]*g[v]}u.push(y),h.push(Math.sqrt(x/g.length)),m.close()}return{peaks:new Float32Array(u),rms:new Float32Array(h),sampleRate:t,duration:l,samplesPerSecond:t}}finally{i[Symbol.dispose]?.()}}async convertMedia(e,t,s,i){this.ensureInitialized();const{Input:n,Output:a,Conversion:o,ALL_FORMATS:l,BlobSource:d,BufferTarget:u,Mp4OutputFormat:h,WebMOutputFormat:p,MovOutputFormat:m,Mp3OutputFormat:f,QUALITY_HIGH:g,QUALITY_MEDIUM:y}=this.mediabunny;if(i?.aborted)throw new DOMException("Aborted","AbortError");const x=new n({source:new d(e),formats:l});let v;switch(t.format){case"webm":v=new p;break;case"mov":v=new m;break;case"mp3":v=new f;break;case"mp4":default:v=new h({fastStart:"in-memory"});break}const b=new a({format:v,target:new u}),S={input:x,output:b};(t.width||t.height||t.videoBitrate)&&(S.video={...t.width&&{width:t.width},...t.height&&{height:t.height},...t.width&&t.height&&{fit:"contain"},...t.frameRate&&{frameRate:t.frameRate},bitrate:t.videoBitrate||g}),(t.audioBitrate||t.sampleRate||t.channels)&&(S.audio={...t.audioBitrate&&{bitrate:t.audioBitrate},...t.sampleRate&&{sampleRate:t.sampleRate},...t.channels&&{numberOfChannels:t.channels}}),(t.format==="mp4"||t.format==="webm"||t.format==="mov")&&(S.audio||(S.audio={bitrate:y}));const k=await o.init(S);if(!k.isValid){const T=k.discardedTracks.map(j=>j.reason).join(", ");throw new Error(`Conversion invalid: ${T}`)}if(k.discardedTracks.length>0&&console.warn("Some tracks were discarded during conversion:",k.discardedTracks),s){let T=0;k.onProgress=j=>{j>T&&(T=j,s({phase:j<1?"encoding":"complete",progress:j,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0}))}}i&&i.addEventListener("abort",()=>{k.cancel()});try{await k.execute()}catch(T){throw i?.aborted?new DOMException("Aborted","AbortError"):T}const C=b.target.buffer;if(!C)throw new Error("Output buffer is empty");const A=this.getMimeTypeForFormat(t.format);return new Blob([C],{type:A})}async extractAudio(e,t="mp3",s,i){return this.convertMedia(e,{format:t,audioBitrate:128e3,sampleRate:48e3,channels:2},s,i)}async trimMedia(e,t,s,i,n,a){this.ensureInitialized();const{Input:o,Output:l,Conversion:d,ALL_FORMATS:u,BlobSource:h,BufferTarget:p,Mp4OutputFormat:m}=this.mediabunny;if(a?.aborted)throw new DOMException("Aborted","AbortError");const f=new o({source:new h(e),formats:u}),g=new l({format:new m({fastStart:"in-memory"}),target:new p}),y=await d.init({input:f,output:g,trim:{start:t,end:s},...i?.videoBitrate&&{video:{bitrate:i.videoBitrate}},...i?.audioBitrate&&{audio:{bitrate:i.audioBitrate}}});if(!y.isValid){const x=y.discardedTracks.map(v=>v.reason).join(", ");throw new Error(`Trim conversion invalid: ${x}`)}n&&(y.onProgress=x=>{n({phase:x<1?"encoding":"complete",progress:x,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0})}),a&&a.addEventListener("abort",()=>{y.cancel()});try{await y.execute()}catch(x){throw a?.aborted?new DOMException("Aborted","AbortError"):x}if(!g.target.buffer)throw new Error("Output buffer is empty");return new Blob([g.target.buffer],{type:"video/mp4"})}getMimeTypeForFormat(e){switch(e){case"mp4":return"video/mp4";case"webm":return"video/webm";case"mov":return"video/quicktime";case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"aac":return"audio/aac";default:return"video/mp4"}}async checkCodecSupport(){this.ensureInitialized();const{getEncodableVideoCodecs:e,getEncodableAudioCodecs:t}=this.mediabunny,[s,i]=await Promise.all([e(),t()]);return{video:s,audio:i}}async getBestVideoCodec(e,t){this.ensureInitialized();const{getFirstEncodableVideoCodec:s,Mp4OutputFormat:i}=this.mediabunny,a=new i().getSupportedVideoCodecs();try{return await s(a,{width:e,height:t})||null}catch{return null}}async exportFrame(e,t,s="image/jpeg",i=.8){const n=await this.getFrameAtTime(e,t);if(!n)throw new Error("Could not extract frame");const{canvas:a}=n;let o=null;if(a instanceof OffscreenCanvas)o=await a.convertToBlob({type:s,quality:i});else if(a instanceof HTMLCanvasElement)o=await new Promise(l=>a.toBlob(l,s,i));else if(a instanceof ImageBitmap){const l=new OffscreenCanvas(a.width,a.height),d=l.getContext("2d");d&&(d.drawImage(a,0,0),o=await l.convertToBlob({type:s,quality:i}))}if(!o)throw new Error("Failed to create image blob");return o}async generateProxy(e,t,s){const i={format:"mp4",height:540,videoBitrate:1e6,audioBitrate:96e3};return this.convertMedia(e,i,t,s)}async exportImageSequence(e,t,s,i,n="image/jpeg",a=.8,o,l){this.ensureInitialized();const{CanvasSink:d}=this.mediabunny,u=await this.createInput(e);try{const h=await u.getPrimaryVideoTrack();if(!h)throw new Error("No video track found");if(!await h.canDecode())throw new Error("Cannot decode video track");const m=s-t,f=Math.ceil(m*i),g=Array.from({length:f},(b,S)=>t+S/i),y=new d(h,{fit:"contain",poolSize:5}),x=[];let v=0;for await(const b of y.canvasesAtTimestamps(g)){if(l?.aborted)throw new DOMException("Aborted","AbortError");if(b){const{canvas:S}=b;let k=null;S instanceof OffscreenCanvas&&(k=await S.convertToBlob({type:n,quality:a})),k&&x.push(k)}v++,o?.(v/f)}return x}finally{u[Symbol.dispose]?.()}}async getBestAudioCodec(){this.ensureInitialized();const{getFirstEncodableAudioCodec:e,Mp4OutputFormat:t}=this.mediabunny,i=new t().getSupportedAudioCodecs();try{return await e(i)||null}catch{return null}}}let gf=null;function _c(){return gf||(gf=new r9),gf}const oC={low:{scale:.25,preset:"ultrafast",crf:32,audioBitrate:96,maxWidth:960,maxHeight:540},medium:{scale:.5,preset:"fast",crf:28,audioBitrate:128,maxWidth:1280,maxHeight:720},high:{scale:.75,preset:"medium",crf:23,audioBitrate:192,maxWidth:1920,maxHeight:1080}},Dh={minPixelCount:3840*2160,minDuration:600,minFileSize:500*1024*1024},n9={format:"webm",videoCodec:"libvpx-vp9",audioCodec:"libopus",videoBitrate:"2M",audioBitrate:"128k",enableRowMt:!0};class a9{ffmpeg=null;loaded=!1;loading=null;progressCallback=null;calculateBufsize(e){const t=e.match(/^(\d+(?:\.\d+)?)\s*([KkMmGg]?)$/);if(!t)return e;const s=parseFloat(t[1]),i=t[2]||"";return`${Math.round(s*2)}${i}`}async load(){if(!this.loaded){if(this.loading)return this.loading;this.loading=this.doLoad(),await this.loading}}async doLoad(){try{const{FFmpeg:e}=await hi(async()=>{const{FFmpeg:n}=await import("./index3.js");return{FFmpeg:n}},[]),{toBlobURL:t}=await hi(async()=>{const{toBlobURL:n}=await import("./index4.js");return{toBlobURL:n}},[]);this.ffmpeg=new e;const s=typeof crossOriginIsolated<"u"&&crossOriginIsolated,i=s?"https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm":"https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";if(s){const[n,a,o]=await Promise.all([t(`${i}/ffmpeg-core.js`,"text/javascript"),t(`${i}/ffmpeg-core.wasm`,"application/wasm"),t(`${i}/ffmpeg-core.worker.js`,"text/javascript")]);await this.ffmpeg.load({coreURL:n,wasmURL:a,workerURL:o})}else{const[n,a]=await Promise.all([t(`${i}/ffmpeg-core.js`,"text/javascript"),t(`${i}/ffmpeg-core.wasm`,"application/wasm")]);await this.ffmpeg.load({coreURL:n,wasmURL:a})}this.loaded=!0}catch(e){throw this.loading=null,console.error("[FFmpeg] Load error:",e),new Error(`Failed to load FFmpeg.wasm: ${e instanceof Error?e.message:"Unknown error"}`)}}isLoaded(){return this.loaded&&this.ffmpeg!==null}ensureLoaded(){if(!this.ffmpeg||!this.loaded)throw new Error("FFmpeg not loaded. Call load() first.")}async fileToUint8Array(e){const t=await e.arrayBuffer();return new Uint8Array(t)}async cleanupFiles(e){if(this.ffmpeg)for(const t of e)try{await this.ffmpeg.deleteFile(t)}catch{}}setupProgressTracking(e,t){!this.ffmpeg||!e||(this.progressCallback&&this.ffmpeg.off("progress",this.progressCallback),this.progressCallback=({progress:s,time:i})=>{let n=0;if(t&&i&&s>0){const o=i/1e6/s;n=(1-s)*o}e({phase:s<1?"encoding":"complete",progress:Math.min(s,1),currentFrame:0,totalFrames:0,estimatedTimeRemaining:n,bytesWritten:0,currentBitrate:0})},this.ffmpeg.on("progress",this.progressCallback))}removeProgressTracking(){!this.ffmpeg||!this.progressCallback||(this.ffmpeg.off("progress",this.progressCallback),this.progressCallback=null)}async transcodeToCompatible(e,t,s={}){await this.load(),this.ensureLoaded();const i={...n9,...s},n="input",a=`output.${i.format}`;try{const o=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(n,o),this.setupProgressTracking(t);const l=["-i",n];l.push("-c:v",i.videoCodec),l.push("-b:v",i.videoBitrate),i.videoCodec==="libvpx-vp9"&&i.enableRowMt&&l.push("-row-mt","1"),l.push("-c:a",i.audioCodec),l.push("-b:a",i.audioBitrate),l.push(a),await this.ffmpeg.exec(l);const d=await this.ffmpeg.readFile(a),u=i.format==="webm"?"video/webm":"video/mp4";return new Blob([d.buffer],{type:u})}finally{this.removeProgressTracking(),await this.cleanupFiles([n,a])}}async transcodeToMp4(e,t){return this.transcodeToCompatible(e,t,{format:"mp4",videoCodec:"libx264",audioCodec:"aac",videoBitrate:"5M",audioBitrate:"192k"})}async extractAudioAsWav(e){await this.load(),this.ensureLoaded();const t="input",s="output.wav";try{const i=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(t,i),await this.ffmpeg.exec(["-i",t,"-vn","-acodec","pcm_f32le","-ar","48000","-ac","2",s]);const n=await this.ffmpeg.readFile(s);return new Blob([n.buffer],{type:"audio/wav"})}finally{await this.cleanupFiles([t,s])}}async generateProxy(e,t={},s){await this.load(),this.ensureLoaded();const i={...oC.medium,...t},n="input",a="proxy.mp4";try{const o=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(n,o),this.setupProgressTracking(s);let l;i.maxWidth&&i.maxHeight?l=`scale='min(${i.maxWidth},iw*${i.scale})':'min(${i.maxHeight},ih*${i.scale})':force_original_aspect_ratio=decrease`:l=`scale=iw*${i.scale}:ih*${i.scale}`,l+=",pad=ceil(iw/2)*2:ceil(ih/2)*2",await this.ffmpeg.exec(["-i",n,"-vf",l,"-c:v","libx264","-preset",i.preset,"-crf",i.crf.toString(),"-c:a","aac","-b:a",`${i.audioBitrate}k`,"-movflags","+faststart",a]);const d=await this.ffmpeg.readFile(a);return new Blob([d.buffer],{type:"video/mp4"})}finally{this.removeProgressTracking(),await this.cleanupFiles([n,a])}}async generateProxyWithPreset(e,t,s){return this.generateProxy(e,oC[t],s)}async extractRange(e,t,s,i){await this.load(),this.ensureLoaded();const n="input",a="output.mp4",o=s-t;try{const l=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(n,l),this.setupProgressTracking(i,o),await this.ffmpeg.exec(["-ss",t.toString(),"-i",n,"-t",o.toString(),"-c:v","libx264","-preset","fast","-c:a","aac","-movflags","+faststart",a]);const d=await this.ffmpeg.readFile(a);return new Blob([d.buffer],{type:"video/mp4"})}finally{this.removeProgressTracking(),await this.cleanupFiles([n,a])}}async getMetadata(e){await this.load(),this.ensureLoaded();const t="input";try{const s=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(t,s);try{await this.ffmpeg.exec(["-i",t,"-f","null","-"])}catch{}return{duration:0,width:0,height:0,hasVideo:!0,hasAudio:!0}}finally{await this.cleanupFiles([t])}}shouldUseProxy(e){return e.width*e.height>=Dh.minPixelCount||e.duration>=Dh.minDuration||e.fileSize!==void 0&&e.fileSize>=Dh.minFileSize}getRecommendedProxyPreset(e){const t=e.width*e.height;return t>=7680*4320?"low":t>=3840*2160?"medium":"high"}async convertAudio(e,t,s={}){await this.load(),this.ensureLoaded();const i="input",n=`output.${t}`;try{const a=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(i,a);const o=["-i",i,"-vn"];switch(t){case"mp3":o.push("-c:a","libmp3lame");break;case"wav":o.push("-c:a","pcm_s16le");break;case"aac":o.push("-c:a","aac");break;case"ogg":o.push("-c:a","libvorbis");break}s.bitrate&&o.push("-b:a",s.bitrate),s.sampleRate&&o.push("-ar",s.sampleRate.toString()),s.channels&&o.push("-ac",s.channels.toString()),o.push(n),await this.ffmpeg.exec(o);const l=await this.ffmpeg.readFile(n),d={mp3:"audio/mpeg",wav:"audio/wav",aac:"audio/aac",ogg:"audio/ogg"};return new Blob([l.buffer],{type:d[t]})}finally{await this.cleanupFiles([i,n])}}async extractFrame(e,t,s="jpg"){await this.load(),this.ensureLoaded();const i="input",n=`frame.${s}`;try{const a=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(i,a),await this.ffmpeg.exec(["-ss",t.toString(),"-i",i,"-vframes","1","-q:v","2",n]);const o=await this.ffmpeg.readFile(n),l=s==="png"?"image/png":"image/jpeg";return new Blob([o.buffer],{type:l})}finally{await this.cleanupFiles([i,n])}}async encodeFrameSequence(e,t,s){await this.load(),this.ensureLoaded();const{width:i,height:n,frameRate:a,totalFrames:o,format:l="mp4",videoBitrate:d="10M",audioBitrate:u="192k",audioBuffer:h,writableStream:p}=t,m=`output.${l}`;let f=0;try{for await(const{image:S,frameIndex:k}of e){const C=new OffscreenCanvas(i,n),A=C.getContext("2d");A.fillStyle="#000000",A.fillRect(0,0,i,n),A.drawImage(S,0,0,i,n);const j=await(await C.convertToBlob({type:"image/jpeg",quality:.95})).arrayBuffer(),_=new Uint8Array(j),E=`frame_${String(k).padStart(6,"0")}.jpg`;await this.ffmpeg.writeFile(E,_),f++,S.close(),s&&s({phase:"rendering",progress:f/o*.7,currentFrame:f,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0}),f%10===0&&await new Promise(D=>setTimeout(D,10))}let y=!1;if(h&&h.length>0){const S=this.encodeAudioBufferToWav(h),k=new Uint8Array(await S.arrayBuffer());k.length>44&&(await this.ffmpeg.writeFile("audio.wav",k),y=!0)}s&&s({phase:"encoding",progress:.7,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0});const x=["-framerate",a.toString(),"-i","frame_%06d.jpg"];y&&x.push("-i","audio.wav"),x.push("-threads","4"),l==="mp4"?x.push("-c:v","libx264","-preset","fast","-crf","23","-maxrate",d,"-bufsize",this.calculateBufsize(d),"-pix_fmt","yuv420p"):x.push("-c:v","libvpx-vp9","-crf","31","-b:v","0","-deadline","good","-cpu-used","4","-row-mt","1"),y&&x.push("-c:a",l==="mp4"?"aac":"libopus","-b:a",u),x.push("-movflags","+faststart","-y",m),this.setupProgressTracking(S=>{s&&s({phase:"encoding",progress:.7+S.progress*.25,currentFrame:o,totalFrames:o,estimatedTimeRemaining:S.estimatedTimeRemaining,bytesWritten:0,currentBitrate:0})}),await this.ffmpeg.exec(x),this.removeProgressTracking(),s&&s({phase:"muxing",progress:.95,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0});const v=await this.ffmpeg.readFile(m),b=l==="mp4"?"video/mp4":"video/webm";if(p){const k=v.buffer;for(let C=0;C<k.byteLength;C+=4194304){const A=new Uint8Array(k,C,Math.min(4194304,k.byteLength-C));await p.write(A)}return await p.close(),s&&s({phase:"complete",progress:1,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:k.byteLength,currentBitrate:0}),null}return s&&s({phase:"complete",progress:1,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:v.buffer.byteLength,currentBitrate:0}),new Blob([v.buffer],{type:b})}finally{for(let g=0;g<f;g++){const y=String(g).padStart(6,"0");try{await this.ffmpeg.deleteFile(`frame_${y}.jpg`)}catch{}}try{await this.ffmpeg.deleteFile("audio.wav")}catch{}try{await this.ffmpeg.deleteFile(m)}catch{}}}encodeAudioBufferToWav(e){const t=e.numberOfChannels,s=e.sampleRate,i=16,n=i/8,a=t*n,o=s*a,l=e.length*a,u=44+l,h=new ArrayBuffer(u),p=new DataView(h),m=(g,y)=>{for(let x=0;x<y.length;x++)p.setUint8(g+x,y.charCodeAt(x))};m(0,"RIFF"),p.setUint32(4,u-8,!0),m(8,"WAVE"),m(12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,1,!0),p.setUint16(22,t,!0),p.setUint32(24,s,!0),p.setUint32(28,o,!0),p.setUint16(32,a,!0),p.setUint16(34,i,!0),m(36,"data"),p.setUint32(40,l,!0);let f=44;for(let g=0;g<e.length;g++)for(let y=0;y<t;y++){const x=e.getChannelData(y)[g],v=Math.max(-32768,Math.min(32767,Math.round(x*32767)));p.setInt16(f,v,!0),f+=n}return new Blob([h],{type:"audio/wav"})}async exportVideoDirectly(e,t,s){await this.load(),this.ensureLoaded();const{startTime:i=0,endTime:n,width:a,height:o,frameRate:l,format:d="mp4",videoBitrate:u="10M",audioBitrate:h="192k",speed:p=1,writableStream:m,useStreamCopy:f=!1}=t,g="input_video",y=`output.${d}`;try{s&&s({phase:"preparing",progress:.05,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0});const x=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(g,x);const v=[];if(i>0&&v.push("-ss",i.toString()),v.push("-i",g),n!==void 0&&n>i&&v.push("-t",(n-i).toString()),v.push("-threads","4"),p!==1||!f){const C=`scale=${a}:${o}:force_original_aspect_ratio=decrease,pad=${a}:${o}:(ow-iw)/2:(oh-ih)/2,fps=${l}`;if(p!==1&&p>0){const A=1/p,T=Math.max(.5,Math.min(2,p));v.push("-filter_complex",`[0:v]${C},setpts=${A}*PTS[v];[0:a]atempo=${T}[a]`,"-map","[v]","-map","[a]")}else v.push("-vf",C);d==="mp4"?v.push("-c:v","libx264","-preset","fast","-crf","23","-maxrate",u,"-bufsize",this.calculateBufsize(u),"-pix_fmt","yuv420p","-c:a","aac","-b:a",h):v.push("-c:v","libvpx-vp9","-crf","31","-b:v","0","-deadline","good","-cpu-used","4","-row-mt","1","-c:a","libopus","-b:a",h)}else v.push("-c","copy");v.push("-movflags","+faststart","-y",y),this.setupProgressTracking(C=>{s&&s({phase:"encoding",progress:.1+C.progress*.85,currentFrame:0,totalFrames:0,estimatedTimeRemaining:C.estimatedTimeRemaining,bytesWritten:0,currentBitrate:0})}),await this.ffmpeg.exec(v),this.removeProgressTracking();const S=await this.ffmpeg.readFile(y),k=d==="mp4"?"video/mp4":"video/webm";if(m){const A=S.buffer;for(let T=0;T<A.byteLength;T+=4194304){const j=new Uint8Array(A,T,Math.min(4194304,A.byteLength-T));await m.write(j)}return await m.close(),s&&s({phase:"complete",progress:1,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0,bytesWritten:A.byteLength,currentBitrate:0}),null}return s&&s({phase:"complete",progress:1,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0,bytesWritten:S.buffer.byteLength,currentBitrate:0}),new Blob([S.buffer],{type:k})}finally{try{await this.ffmpeg.deleteFile(g)}catch{}try{await this.ffmpeg.deleteFile(y)}catch{}}}terminate(){this.ffmpeg&&(this.removeProgressTracking(),this.ffmpeg.terminate(),this.ffmpeg=null,this.loaded=!1,this.loading=null)}}let yf=null;function yM(){return yf||(yf=new a9),yf}const Ds=[];for(let r=0;r<256;++r)Ds.push((r+256).toString(16).slice(1));function o9(r,e=0){return(Ds[r[e+0]]+Ds[r[e+1]]+Ds[r[e+2]]+Ds[r[e+3]]+"-"+Ds[r[e+4]]+Ds[r[e+5]]+"-"+Ds[r[e+6]]+Ds[r[e+7]]+"-"+Ds[r[e+8]]+Ds[r[e+9]]+"-"+Ds[r[e+10]]+Ds[r[e+11]]+Ds[r[e+12]]+Ds[r[e+13]]+Ds[r[e+14]]+Ds[r[e+15]]).toLowerCase()}let xf;const c9=new Uint8Array(16);function l9(){if(!xf){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");xf=crypto.getRandomValues.bind(crypto)}return xf(c9)}const d9=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),cC={randomUUID:d9};function u9(r,e,t){r=r||{};const s=r.random??r.rng?.()??l9();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,o9(s)}function dt(r,e,t){return cC.randomUUID&&!r?cC.randomUUID():u9(r)}const h9={generateThumbnails:!0,thumbnailCount:5,thumbnailWidth:320,generateWaveform:!0,waveformSamplesPerSecond:100,useFallback:!0,quickMode:!1};class p9{mediaEngine;ffmpegFallback;initialized=!1;constructor(e,t){this.mediaEngine=e||_c(),this.ffmpegFallback=t||yM()}async initialize(){if(!this.initialized)try{await this.mediaEngine.initialize(),this.initialized=!0}catch{console.warn("MediaBunny initialization failed, will use fallback only"),this.initialized=!0}}async importMedia(e,t={}){const s={...h9,...t},i=[],n=await this.validateFormat(e);if(!n.supported){if(s.useFallback)try{return await this.importWithFallback(e,s)}catch(a){return{success:!1,error:n.error||"Unsupported format",warnings:[`FFmpeg fallback also failed: ${a instanceof Error?a.message:"Unknown error"}`]}}return{success:!1,error:n.error||"Unsupported format"}}try{const a=await this.mediaEngine.extractMetadata(e),o=aC(e.type);if(!o)return{success:!1,error:"Could not determine media type"};if(!a.canDecode&&(i.push("Codec may not be fully supported. Playback might be limited."),s.useFallback))try{return await this.importWithFallback(e,s)}catch{}let l=[];if(s.generateThumbnails&&!s.quickMode){if(o==="video"&&a.hasVideo)try{l=await this.mediaEngine.generateThumbnails(e,s.thumbnailCount,s.thumbnailWidth)}catch(h){i.push(`Thumbnail generation failed: ${h instanceof Error?h.message:"Unknown error"}`)}else if(o==="image")try{const h=new Image,p=URL.createObjectURL(e);await new Promise((v,b)=>{h.onload=()=>{URL.revokeObjectURL(p),v()},h.onerror=()=>{URL.revokeObjectURL(p),b(new Error("Failed to load image"))},h.src=p});const m=document.createElement("canvas"),f=s.thumbnailWidth||320,g=h.height/h.width,y=Math.round(f*g);m.width=f,m.height=y;const x=m.getContext("2d");if(x){x.drawImage(h,0,0,f,y);const v=m.toDataURL("image/jpeg",.8);l=[{timestamp:0,canvas:m,dataUrl:v}]}}catch(h){i.push(`Image thumbnail generation failed: ${h instanceof Error?h.message:"Unknown error"}`)}}let d=null;if(s.generateWaveform&&a.hasAudio&&!s.quickMode)try{d=await this.mediaEngine.generateWaveform(e,s.waveformSamplesPerSecond)}catch(h){i.push(`Waveform generation failed: ${h instanceof Error?h.message:"Unknown error"}`)}return{success:!0,media:{id:dt(),name:e.name,type:o,blob:e,metadata:a,thumbnails:l,waveformData:d},warnings:i.length>0?i:void 0}}catch(a){if(s.useFallback)try{return await this.importWithFallback(e,s)}catch(o){return{success:!1,error:`Import failed: ${a instanceof Error?a.message:"Unknown error"}`,warnings:[`FFmpeg fallback also failed: ${o instanceof Error?o.message:"Unknown error"}`]}}return{success:!1,error:`Import failed: ${a instanceof Error?a.message:"Unknown error"}`}}}async importWithFallback(e,t){const s=await this.ffmpegFallback.transcodeToCompatible(e),i=new File([s],e.name.replace(/\.[^.]+$/,".webm"),{type:"video/webm"}),n=await this.mediaEngine.extractMetadata(i),a=aC(i.type)||"video";let o=[];if(t.generateThumbnails&&n.hasVideo)try{o=await this.mediaEngine.generateThumbnails(i,t.thumbnailCount,t.thumbnailWidth)}catch{}let l=null;if(t.generateWaveform&&n.hasAudio)try{l=await this.mediaEngine.generateWaveform(i,t.waveformSamplesPerSecond)}catch{}return{success:!0,media:{id:dt(),name:e.name,type:a,blob:i,metadata:n,thumbnails:o,waveformData:l},warnings:["File was transcoded using FFmpeg fallback"]}}async validateFormat(e){return gM(e.type)?this.mediaEngine.isAvailable()?this.mediaEngine.validateFormat(e):{supported:!0,format:e.type}:{supported:!1,format:null,error:`Unsupported format: ${e.type||"unknown"}. Supported formats: MP4, WebM, MOV, MP3, WAV, AAC, JPG, PNG, WebP`}}processedMediaToMediaItem(e,t){const s={duration:e.metadata.duration,width:e.metadata.width,height:e.metadata.height,frameRate:e.metadata.frameRate,codec:e.metadata.codec,sampleRate:e.metadata.sampleRate,channels:e.metadata.channels,fileSize:e.metadata.fileSize};return{id:e.id,name:e.name,type:e.type,fileHandle:null,blob:e.blob,metadata:s,thumbnailUrl:t||null,waveformData:e.waveformData?.peaks||null}}async importMultiple(e,t={},s){const i=[];for(let n=0;n<e.length;n++){const a=e[n];s?.(n,e.length,a.name);const o=await this.importMedia(a,t);i.push(o)}return s?.(e.length,e.length,"Complete"),i}shouldUseProxy(e){return this.ffmpegFallback.shouldUseProxy(e)}shouldUseProxyForFile(e,t){return this.ffmpegFallback.shouldUseProxy({...t,fileSize:e.size})}getRecommendedProxyPreset(e){return this.ffmpegFallback.getRecommendedProxyPreset(e)}async generateProxy(e,t,s){if(this.mediaEngine.isAvailable())try{return await this.mediaEngine.generateProxy(e)}catch{}return this.ffmpegFallback.generateProxy(e,t,s)}async generateProxyWithPreset(e,t,s){return this.ffmpegFallback.generateProxyWithPreset(e,t,s)}async generateProxyIfNeeded(e,t,s){if(!this.shouldUseProxyForFile(e,t))return null;const i=this.getRecommendedProxyPreset(t);return this.generateProxyWithPreset(e,i,s)}getProxyThresholds(){return{...Dh}}getSupportedFormats(){return{video:["MP4","WebM","MOV","MKV"],audio:["MP3","WAV","AAC","OGG","FLAC"],image:["JPEG","PNG","WebP","GIF"]}}async generateThumbnailsForMedia(e,t,s={}){this.initialized||await this.initialize();const{count:i=10,width:n=160}=s;if(t==="video")return this.mediaEngine.generateThumbnails(e,i,n);if(t==="image"){const a=new Image,o=URL.createObjectURL(e);await new Promise((p,m)=>{a.onload=()=>{URL.revokeObjectURL(o),p()},a.onerror=()=>{URL.revokeObjectURL(o),m(new Error("Failed to load image"))},a.src=o});const l=document.createElement("canvas"),d=a.height/a.width,u=Math.round(n*d);l.width=n,l.height=u;const h=l.getContext("2d");if(h){h.drawImage(a,0,0,n,u);const p=l.toDataURL("image/jpeg",.8);return[{timestamp:0,canvas:l,dataUrl:p}]}}return[]}async generateWaveformForMedia(e,t=100){return this.initialized||await this.initialize(),this.mediaEngine.generateWaveform(e,t)}}let bf=null;function m9(){return bf||(bf=new p9),bf}async function f9(){const r=m9();return await r.initialize(),r}const Fh={OVERVIEW:10,MEDIUM:100,HIGH:200},g9={samplesPerSecond:Fh.MEDIUM,enableCaching:!0};class y9{mediaEngine;storageEngine=null;memoryCache=new Map;MAX_MEMORY_CACHE_SIZE=20;constructor(e,t){this.mediaEngine=e||_c(),this.storageEngine=t||null}setStorageEngine(e){this.storageEngine=e}async generateWaveform(e,t,s={}){const i={...g9,...s},n=this.memoryCache.get(t);if(n&&n.data.samplesPerSecond===i.samplesPerSecond)return n.data;if(i.enableCaching&&this.storageEngine){const o=await this.loadFromCache(t);if(o&&o.samplesPerSecond===i.samplesPerSecond)return this.updateMemoryCache(t,o),o}const a=await this.mediaEngine.generateWaveform(e,i.samplesPerSecond);return i.enableCaching&&await this.saveToCache(t,a),this.updateMemoryCache(t,a),a}async generateMultiResolutionWaveform(e,t,s=[Fh.OVERVIEW,Fh.MEDIUM,Fh.HIGH]){const i={mediaId:t,duration:0,resolutions:new Map},n=[...s].sort((l,d)=>d-l),a=n[0],o=await this.generateWaveform(e,t,{samplesPerSecond:a,enableCaching:!0});i.duration=o.duration,i.resolutions.set(a,o);for(let l=1;l<n.length;l++){const d=n[l],u=this.downsampleWaveform(o,d);i.resolutions.set(d,u)}return i}getWaveformForZoomLevel(e,t){const s=Math.max(10,Math.min(500,t*2));let i=null,n=1/0;for(const[a,o]of e.resolutions){const l=Math.abs(a-s);(l<n||l===n&&a>(i?.samplesPerSecond||0))&&(n=l,i=o)}return i}downsampleWaveform(e,t){if(t>=e.samplesPerSecond)return e;const s=e.samplesPerSecond/t,i=Math.ceil(e.peaks.length/s),n=new Float32Array(i),a=new Float32Array(i);for(let o=0;o<i;o++){const l=Math.floor(o*s),d=Math.min(Math.floor((o+1)*s),e.peaks.length);let u=0,h=0,p=0;for(let m=l;m<d;m++)u=Math.max(u,e.peaks[m]),h+=e.rms[m]*e.rms[m],p++;n[o]=u,a[o]=p>0?Math.sqrt(h/p):0}return{peaks:n,rms:a,sampleRate:t,duration:e.duration,samplesPerSecond:t}}getWaveformSlice(e,t,s){const i=Math.max(0,Math.floor(t*e.samplesPerSecond)),n=Math.min(e.peaks.length,Math.ceil(s*e.samplesPerSecond));return{peaks:e.peaks.slice(i,n),rms:e.rms.slice(i,n),sampleRate:e.sampleRate,duration:s-t,samplesPerSecond:e.samplesPerSecond}}async loadFromCache(e){if(!this.storageEngine)return null;try{const t=await this.storageEngine.loadWaveform(e);return t?this.waveformRecordToData(t):null}catch(t){return console.warn("Failed to load waveform from cache:",t),null}}async saveToCache(e,t){if(this.storageEngine)try{const s=this.waveformDataToRecord(e,t);await this.storageEngine.saveWaveform(s)}catch(s){console.warn("Failed to save waveform to cache:",s)}}waveformRecordToData(e){const t=e.data.length/2,s=new Float32Array(t),i=new Float32Array(t);for(let a=0;a<t;a++)s[a]=e.data[a],i[a]=e.data[t+a];const n=t/e.sampleRate;return{peaks:s,rms:i,sampleRate:e.sampleRate,duration:n,samplesPerSecond:e.sampleRate}}waveformDataToRecord(e,t){const s=[];for(let i=0;i<t.peaks.length;i++)s.push(t.peaks[i]);for(let i=0;i<t.rms.length;i++)s.push(t.rms[i]);return{mediaId:e,data:s,sampleRate:t.samplesPerSecond}}updateMemoryCache(e,t){if(this.memoryCache.size>=this.MAX_MEMORY_CACHE_SIZE){let s="",i=1/0;for(const[n,a]of this.memoryCache.entries())a.createdAt<i&&(i=a.createdAt,s=n);s&&this.memoryCache.delete(s)}this.memoryCache.set(e,{mediaId:e,data:t,createdAt:Date.now()})}async clearCache(e){if(this.memoryCache.delete(e),this.storageEngine)try{await this.storageEngine.deleteWaveform(e)}catch(t){console.warn("Failed to delete waveform from cache:",t)}}clearAllCache(){this.memoryCache.clear()}async isCached(e){return this.memoryCache.has(e)?!0:this.storageEngine?await this.storageEngine.loadWaveform(e)!==null:!1}}let vf=null;function x9(){return vf||(vf=new y9),vf}async function b9(r){try{const e=await createImageBitmap(r),t=e.width,s=e.height,n=new OffscreenCanvas(t,s).getContext("2d");if(!n)return e.close(),null;n.drawImage(e,0,0);const a=[e],o=[100];return{frames:a,delays:o,totalDuration:o.reduce((l,d)=>l+d,0)}}catch{return null}}function v9(r,e){if(r.frames.length<=1)return 0;const t=e%r.totalDuration;let s=0;for(let i=0;i<r.delays.length;i++)if(s+=r.delays[i],t<s)return i;return r.frames.length-1}function w9(r){return r.type==="image/gif"}const k9={fontFamily:"Inter",fontSize:48,fontWeight:"bold",fontStyle:"normal",color:"#ffffff",textAlign:"center",verticalAlign:"middle",lineHeight:1.2,letterSpacing:0},C9={position:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},Ad=Math.PI,Cp=1.70158,Hu=Cp*1.525,lC=Cp+1,dC=2*Ad/3,uC=2*Ad/4.5,Xu=r=>r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375,Li={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>1-(1-r)*(1-r),easeInOutQuad:r=>r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2,easeInCubic:r=>r*r*r,easeOutCubic:r=>1-Math.pow(1-r,3),easeInOutCubic:r=>r<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2,easeInQuart:r=>r*r*r*r,easeOutQuart:r=>1-Math.pow(1-r,4),easeInOutQuart:r=>r<.5?8*r*r*r*r:1-Math.pow(-2*r+2,4)/2,easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>1-Math.pow(1-r,5),easeInOutQuint:r=>r<.5?16*r*r*r*r*r:1-Math.pow(-2*r+2,5)/2,easeInSine:r=>1-Math.cos(r*Ad/2),easeOutSine:r=>Math.sin(r*Ad/2),easeInOutSine:r=>-(Math.cos(Ad*r)-1)/2,easeInExpo:r=>r===0?0:Math.pow(2,10*r-10),easeOutExpo:r=>r===1?1:1-Math.pow(2,-10*r),easeInOutExpo:r=>r===0?0:r===1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2,easeInCirc:r=>1-Math.sqrt(1-Math.pow(r,2)),easeOutCirc:r=>Math.sqrt(1-Math.pow(r-1,2)),easeInOutCirc:r=>r<.5?(1-Math.sqrt(1-Math.pow(2*r,2)))/2:(Math.sqrt(1-Math.pow(-2*r+2,2))+1)/2,easeInBack:r=>lC*r*r*r-Cp*r*r,easeOutBack:r=>1+lC*Math.pow(r-1,3)+Cp*Math.pow(r-1,2),easeInOutBack:r=>r<.5?Math.pow(2*r,2)*((Hu+1)*2*r-Hu)/2:(Math.pow(2*r-2,2)*((Hu+1)*(r*2-2)+Hu)+2)/2,easeInElastic:r=>r===0?0:r===1?1:-Math.pow(2,10*r-10)*Math.sin((r*10-10.75)*dC),easeOutElastic:r=>r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r*10-.75)*dC)+1,easeInOutElastic:r=>r===0?0:r===1?1:r<.5?-(Math.pow(2,20*r-10)*Math.sin((20*r-11.125)*uC))/2:Math.pow(2,-20*r+10)*Math.sin((20*r-11.125)*uC)/2+1,easeInBounce:r=>1-Xu(1-r),easeOutBounce:Xu,easeInOutBounce:r=>r<.5?(1-Xu(1-2*r))/2:(1+Xu(2*r-1))/2},S9=[{name:"Basic",easings:["linear"]},{name:"Quad",easings:["easeInQuad","easeOutQuad","easeInOutQuad"]},{name:"Cubic",easings:["easeInCubic","easeOutCubic","easeInOutCubic"]},{name:"Quart",easings:["easeInQuart","easeOutQuart","easeInOutQuart"]},{name:"Quint",easings:["easeInQuint","easeOutQuint","easeInOutQuint"]},{name:"Sine",easings:["easeInSine","easeOutSine","easeInOutSine"]},{name:"Expo",easings:["easeInExpo","easeOutExpo","easeInOutExpo"]},{name:"Circ",easings:["easeInCirc","easeOutCirc","easeInOutCirc"]},{name:"Back",easings:["easeInBack","easeOutBack","easeInOutBack"]},{name:"Elastic",easings:["easeInElastic","easeOutElastic","easeInOutElastic"]},{name:"Bounce",easings:["easeInBounce","easeOutBounce","easeInOutBounce"]}];class Cu{bezierCache=new Map;getValueAtTime(e,t){if(e.length===0)return{value:void 0,keyframeA:null,keyframeB:null,progress:0};const s=[...e].sort((h,p)=>h.time-p.time);if(t<=s[0].time)return{value:s[0].value,keyframeA:s[0],keyframeB:null,progress:0};if(t>=s[s.length-1].time)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1};let i=null,n=null;for(let h=0;h<s.length-1;h++)if(t>=s[h].time&&t<=s[h+1].time){i=s[h],n=s[h+1];break}if(!i||!n)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1};const a=n.time-i.time,o=t-i.time,l=a>0?o/a:0,d=this.applyEasing(l,i.easing);return{value:this.interpolateValue(i.value,n.value,d),keyframeA:i,keyframeB:n,progress:d}}interpolate(e,t,s){const[i,n]=e.time<=t.time?[e,t]:[t,e],a=Math.max(i.time,Math.min(n.time,s)),o=n.time-i.time,l=a-i.time,d=o>0?l/o:0,u=this.applyEasing(d,i.easing);return this.interpolateValue(i.value,n.value,u)}applyEasing(e,t,s){const i=Math.max(0,Math.min(1,e));if(t==="bezier")return s?this.cubicBezier(i,s.x1,s.y1,s.x2,s.y2):this.cubicBezier(i,.25,.1,.25,1);if(t==="ease-in")return Li.easeInQuad(i);if(t==="ease-out")return Li.easeOutQuad(i);if(t==="ease-in-out")return Li.easeInOutQuad(i);const n=Li[t];return n?n(i):i}cubicBezier(e,t,s,i,n){const a=`${t},${s},${i},${n}`;let o=this.bezierCache.get(a);return o||(o=this.createBezierFunction(t,s,i,n),this.bezierCache.set(a,o)),o(e)}createBezierFunction(e,t,s,i){const d=3*e-3*s+1,u=3*s-6*e,h=3*e,p=3*t-3*i+1,m=3*i-6*t,f=3*t,g=b=>((d*b+u)*b+h)*b,y=b=>((p*b+m)*b+f)*b,x=b=>(3*d*b+2*u)*b+h,v=b=>{let S=b;for(let A=0;A<4;A++){const T=x(S);if(Math.abs(T)<.001)break;const j=g(S)-b;S-=j/T}let k=0,C=1;S=b;for(let A=0;A<10;A++){const T=g(S)-b;if(Math.abs(T)<1e-7)break;T>0?C=S:k=S,S=(C+k)/2}return S};return b=>b===0?0:b===1?1:y(v(b))}interpolateValue(e,t,s){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*s;if(typeof e=="object"&&typeof t=="object"&&e!==null&&t!==null){const i={},n=e,a=t;for(const o of Object.keys(n))o in a?i[o]=this.interpolateValue(n[o],a[o],s):i[o]=n[o];return i}return s<.5?e:t}addKeyframe(e,t){const s=e.findIndex(i=>i.time===t.time&&i.property===t.property);if(s>=0){const i=[...e];return i[s]=t,i}return[...e,t].sort((i,n)=>i.time-n.time)}removeKeyframe(e,t){return e.filter(s=>s.id!==t)}updateKeyframe(e,t,s){const i=e.map(n=>n.id===t?{...n,...s}:n);return s.time!==void 0&&i.sort((n,a)=>n.time-a.time),i}getKeyframesForProperty(e,t){return e.filter(s=>s.property===t).sort((s,i)=>s.time-i.time)}findKeyframeAtTime(e,t,s,i=.001){return e.find(n=>n.property===t&&Math.abs(n.time-s)<=i)||null}clearCache(){this.bezierCache.clear()}}class T9{animationEngine;constructor(){this.animationEngine=new Cu}getAnimatedState(e,t){const{animation:s,style:i,transform:n,text:a,keyframes:o}=e;if(o&&o.length>0)return this.applyKeyframeAnimation(e,t);if(!s||s.preset==="none")return{opacity:n.opacity,transform:n,style:i,visibleText:a};const l=e.duration,d=s.inDuration,u=s.outDuration,h=l-u;let p=1,m=0;t<d&&(p=d>0?t/d:1),t>h&&u>0&&(m=(t-h)/u);const f=s.params.easing??"ease-out",g=this.animationEngine.applyEasing(p,f),y=this.animationEngine.applyEasing(m,f);return this.applyPreset(e,s.preset,s.params,g,y,t)}applyKeyframeAnimation(e,t){const{style:s,transform:i,text:n,keyframes:a}=e;let o=i.position.x,l=i.position.y,d=i.scale.x,u=i.scale.y,h=i.rotation,p=i.opacity;const m=new Map;for(const g of a)m.has(g.property)||m.set(g.property,[]),m.get(g.property).push(g);for(const[g,y]of m){const x=this.animationEngine.getValueAtTime(y,t);if(x.value!==void 0&&typeof x.value=="number")switch(g){case"opacity":p=Math.max(0,Math.min(1,x.value));break;case"position.x":o=x.value;break;case"position.y":l=x.value;break;case"scale.x":d=x.value;break;case"scale.y":u=x.value;break;case"rotation":h=x.value;break}}const f={position:{x:o,y:l},scale:{x:d,y:u},rotation:h,opacity:p,anchor:{...i.anchor}};return{opacity:f.opacity,transform:f,style:s,visibleText:n}}applyPreset(e,t,s,i,n,a){const{style:o,transform:l,text:d}=e;switch(t){case"typewriter":return this.applyTypewriter(e,i,n,a);case"fade":return this.applyFade(e,i,n,s);case"slide-left":return this.applySlide(e,i,n,s,"left");case"slide-right":return this.applySlide(e,i,n,s,"right");case"slide-up":return this.applySlide(e,i,n,s,"up");case"slide-down":return this.applySlide(e,i,n,s,"down");case"scale":return this.applyScale(e,i,n,s);case"blur":return this.applyBlur(e,i,n,s);case"bounce":return this.applyBounce(e,i,n,s);case"rotate":return this.applyRotate(e,i,n,s);case"wave":return this.applyWave(e,i,n,s,a);case"shake":return this.applyShake(e,i,n,s,a);case"pop":return this.applyPop(e,i,n,s);case"glitch":return this.applyGlitch(e,i,n,s,a);case"split":return this.applySplit(e,i,n,s);case"flip":return this.applyFlip(e,i,n,s);case"word-by-word":return this.applyWordByWord(e,i,n,s,a);case"rainbow":return this.applyRainbow(e,i,n,s,a);default:return{opacity:l.opacity,transform:l,style:o,visibleText:d}}}applyTypewriter(e,t,s,i){const{style:n,transform:a,text:o}=e,l=o.length,d=Math.floor(t*l),u=o.substring(0,d),h=a.opacity*(1-s);return{opacity:h,transform:{...a,opacity:h},style:n,visibleText:u}}applyFade(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.fadeOpacity?.start??0,d=i.fadeOpacity?.end??1;let u=l+(d-l)*t;return u=u*(1-s),{opacity:u,transform:{...a,opacity:u},style:n,visibleText:o}}applySlide(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.slideDistance??.2;let u=0,h=0;switch(n){case"left":u=-d*(1-t)+d*s;break;case"right":u=d*(1-t)-d*s;break;case"up":h=-d*(1-t)+d*s;break;case"down":h=d*(1-t)-d*s;break}const p=o.opacity*t*(1-s),m={...o,position:{x:o.position.x+u,y:o.position.y+h},opacity:p};return{opacity:p,transform:m,style:a,visibleText:l}}applyScale(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.scaleFrom??0,d=i.scaleTo??1;let u=l+(d-l)*t;u=u*(1-s)+l*s;const h=a.opacity*t*(1-s),p={...a,scale:{x:u,y:u},opacity:h};return{opacity:h,transform:p,style:n,visibleText:o}}applyBlur(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.blurAmount??10,d=l*(1-t)+l*s,u=a.opacity*t*(1-s),h={...n,shadowColor:n.color,shadowBlur:d,shadowOffsetX:0,shadowOffsetY:0};return{opacity:u,transform:{...a,opacity:u},style:h,visibleText:o}}applyBounce(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.bounceHeight??.1,d=i.bounceCount??3;let u=0;if(t<1){const m=t*Math.PI*d,f=1-t;u=-Math.abs(Math.sin(m))*l*f}if(s>0){const m=s*Math.PI;u=Math.sin(m)*l*s}const h=a.opacity*Math.min(t*2,1)*(1-s),p={...a,position:{x:a.position.x,y:a.position.y+u},opacity:h};return{opacity:h,transform:p,style:n,visibleText:o}}applyRotate(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.rotateAngle??360;let d=a.rotation+l*(1-t);d=d-l*s;const u=a.opacity*t*(1-s),h={...a,rotation:d,opacity:u};return{opacity:u,transform:h,style:n,visibleText:o}}applyWave(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.waveAmplitude??.02,u=i.waveFrequency??2,h=o.opacity*t*(1-s),p=l.split("").map((m,f)=>{const g=f/l.length*Math.PI*2*u,y=Math.sin(n*5+g)*d*t;return{char:m,index:f,opacity:h,offsetX:0,offsetY:y,scale:1,rotation:0}});return{opacity:h,transform:{...o,opacity:h},style:a,visibleText:l,characterStates:p}}applyShake(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.shakeIntensity??.01,u=i.shakeSpeed??20,h=Math.sin(n*u)*d*t*(1-s),p=Math.cos(n*u*1.3)*d*t*(1-s),m=o.opacity*t*(1-s),f={...o,position:{x:o.position.x+h,y:o.position.y+p},opacity:m};return{opacity:m,transform:f,style:a,visibleText:l}}applyPop(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.popOvershoot??1.2;let d=0;t<.5?d=t*2*l:t<.7?d=l-(t-.5)*(l-1)/.2:d=1,d=d*(1-s);const u=a.opacity*Math.min(t*2,1)*(1-s),h={...a,scale:{x:d,y:d},opacity:u};return{opacity:u,transform:h,style:n,visibleText:o}}applyGlitch(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.glitchIntensity??.02,u=i.glitchSpeed??10,h=Math.sin(n*u)>.7,p=h?(Math.random()-.5)*d:0,m=h?(Math.random()-.5)*5:0,f=o.opacity*t*(1-s),g={...o,position:{x:o.position.x+p*t,y:o.position.y},rotation:o.rotation+m*t,opacity:f},y={...a,letterSpacing:a.letterSpacing+(h?Math.random()*2:0)};return{opacity:f,transform:g,style:y,visibleText:l}}applySplit(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.splitDirection??"horizontal",d=.1*(1-t)+.1*s,u=a.opacity*t*(1-s),h=o.split("").map((p,m)=>{const f=m<o.length/2,g=l==="horizontal"?{x:f?-d:d,y:0}:{x:0,y:f?-d:d};return{char:p,index:m,opacity:u,offsetX:g.x,offsetY:g.y,scale:1,rotation:0}});return{opacity:u,transform:{...a,opacity:u},style:n,visibleText:o,characterStates:h}}applyFlip(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.flipAxis??"y",d=(1-t)*Math.PI+s*Math.PI,u=Math.abs(Math.cos(d)),h=a.opacity*t*(1-s),p={...a,scale:l==="y"?{x:u,y:a.scale.y}:{x:a.scale.x,y:u},opacity:h};return{opacity:h,transform:p,style:n,visibleText:o}}applyWordByWord(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=l.split(" "),u=Math.ceil(t*d.length),h=d.slice(0,u).join(" "),p=o.opacity*(1-s);return{opacity:p,transform:{...o,opacity:p},style:a,visibleText:h}}applyRainbow(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.rainbowSpeed??1,u=n*d*100%360,h=o.opacity*t*(1-s),p=l.split("").map((f,g)=>({char:f,index:g,opacity:h,offsetX:0,offsetY:0,scale:1,rotation:0})),m={...a,color:`hsl(${u}, 100%, 50%)`};return{opacity:h,transform:{...o,opacity:h},style:m,visibleText:l,characterStates:p}}createAnimationPreset(e,t=.5,s=.5,i={}){const n=this.getDefaultParams(e);return{preset:e,params:{...n,...i},inDuration:t,outDuration:s}}getDefaultParams(e){switch(e){case"fade":return{fadeOpacity:{start:0,end:1},easing:"ease-out"};case"slide-left":case"slide-right":case"slide-up":case"slide-down":return{slideDistance:.2,easing:"ease-out"};case"scale":return{scaleFrom:0,scaleTo:1,easing:"ease-out"};case"blur":return{blurAmount:10,easing:"ease-out"};case"bounce":return{bounceHeight:.1,bounceCount:3,easing:"ease-out"};case"rotate":return{rotateAngle:360,easing:"ease-out"};case"wave":return{waveAmplitude:.02,waveFrequency:2,easing:"linear"};case"typewriter":return{easing:"linear"};case"shake":return{shakeIntensity:.01,shakeSpeed:20,easing:"linear"};case"pop":return{popOvershoot:1.2,easing:"ease-out"};case"glitch":return{glitchIntensity:.02,glitchSpeed:10,easing:"linear"};case"split":return{splitDirection:"horizontal",easing:"ease-out"};case"flip":return{flipAxis:"y",easing:"ease-out"};case"word-by-word":return{wordDelay:.2,easing:"linear"};case"rainbow":return{rainbowSpeed:1,easing:"linear"};default:return{easing:"ease-out"}}}getAvailablePresets(){return["none","typewriter","fade","slide-left","slide-right","slide-up","slide-down","scale","blur","bounce","rotate","wave","shake","pop","glitch","split","flip","word-by-word","rainbow"]}}const Sp=new T9;class A9{textClips=new Map;canvas=null;ctx=null;initialize(e=1920,t=1080){typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(e,t):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t),this.ctx=this.canvas.getContext("2d")}createTextClip(e){const t=e.id||this.generateId(),s={...k9,...e.style},i={...C9,...e.transform},n={id:t,trackId:e.trackId,startTime:e.startTime,duration:e.duration??5,text:e.text,style:s,transform:i,animation:e.animation,keyframes:[]};return this.textClips.set(t,n),n}getTextClip(e){return this.textClips.get(e)}getAllTextClips(){return Array.from(this.textClips.values())}getTextClipsForTrack(e){return Array.from(this.textClips.values()).filter(t=>t.trackId===e)}updateTextClip(e,t){const s=this.textClips.get(e);if(!s)return;const i={...s,text:t.text??s.text,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,style:t.style?{...s.style,...t.style}:s.style,transform:t.transform?{...s.transform,...t.transform}:s.transform,animation:t.animation??s.animation,keyframes:t.keyframes??s.keyframes,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation};return this.textClips.set(e,i),i}updateText(e,t){return this.updateTextClip(e,{text:t})}updateStyle(e,t){return this.updateTextClip(e,{style:t})}updatePosition(e,t){return this.updateTextClip(e,{transform:{position:t}})}deleteTextClip(e){return this.textClips.delete(e)}addKeyframe(e,t){const s=this.textClips.get(e);if(!s)return;const i=s.keyframes.findIndex(o=>o.time===t.time&&o.property===t.property);let n;i>=0?(n=[...s.keyframes],n[i]=t):n=[...s.keyframes,t].sort((o,l)=>o.time-l.time);const a={...s,keyframes:n};return this.textClips.set(e,a),a}removeKeyframe(e,t){const s=this.textClips.get(e);if(!s)return;const i={...s,keyframes:s.keyframes.filter(n=>n.id!==t)};return this.textClips.set(e,i),i}renderText(e,t,s,i=0){let n,a;typeof OffscreenCanvas<"u"?n=new OffscreenCanvas(t,s):(n=document.createElement("canvas"),n.width=t,n.height=s),a=n.getContext("2d"),a.clearRect(0,0,t,s);const o=Sp.getAnimatedState(e,i);let{opacity:l,transform:d,style:u,visibleText:h,characterStates:p}=o;if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"){const S=this.applyEmphasisAnimation(e.emphasisAnimation,i);l=l*S.opacity,d={...d,scale:{x:d.scale.x*S.scale*S.scaleX,y:d.scale.y*S.scale*S.scaleY},position:{x:d.position.x+S.offsetX,y:d.position.y+S.offsetY},rotation:d.rotation+S.rotation}}if(l<=0||h.length===0)return{canvas:n,width:t,height:s,textMetrics:this.measureText("",e.style,t)};const m=this.measureText(h,u,t);a.save();const f=d.position.x*t,g=d.position.y*s;a.translate(f,g),a.rotate(d.rotation*Math.PI/180),a.scale(d.scale.x,d.scale.y),a.globalAlpha=l,this.applyTextStyle(a,u);const y=h.split(`
`),x=u.fontSize*u.lineHeight,v=y.length*x;let b=-v/2+x/2;if(u.verticalAlign==="top"?b=0:u.verticalAlign==="bottom"&&(b=-v),u.backgroundColor){const S=m.width+20,k=v;a.fillStyle=u.backgroundColor,a.fillRect(-S/2,-k/2,S,k)}if(p&&p.length>0){let S=0;for(let k=0;k<y.length;k++){const C=y[k],A=b+k*x;let T=0;const j=a.measureText(C).width,_=u.textAlign==="center"?-j/2:u.textAlign==="right"?-j:0;for(const M of C){if(S<p.length){const E=p[S],D=a.measureText(M).width;a.save(),a.globalAlpha=l*E.opacity,a.translate(_+T+E.offsetX+D/2,A+E.offsetY),a.rotate(E.rotation*Math.PI/180),a.scale(E.scale,E.scale),u.strokeColor&&u.strokeWidth&&(a.strokeStyle=u.strokeColor,a.lineWidth=u.strokeWidth,a.strokeText(M,0,0)),a.fillStyle=u.color,a.fillText(M,0,0),a.restore(),T+=D}S++}S++}}else for(let S=0;S<y.length;S++){const k=y[S],C=b+S*x;if(u.backgroundColor){const T=a.measureText(k).width+20,j=x;a.fillStyle=u.backgroundColor,a.fillRect(-T/2,C-j/2,T,j)}u.strokeColor&&u.strokeWidth&&(a.strokeStyle=u.strokeColor,a.lineWidth=u.strokeWidth,a.strokeText(k,0,C)),a.fillStyle=u.color,a.fillText(k,0,C)}return a.restore(),{canvas:n,width:t,height:s,textMetrics:m}}measureText(e,t,s){this.ctx||this.initialize();const i=this.ctx;this.applyTextStyle(i,t);const n=this.wrapText(e,t,s),a=t.fontSize*t.lineHeight,o=n.map(u=>{const h=i.measureText(u);return{text:u,width:h.width,height:a,baseline:t.fontSize*.8}}),l=Math.max(...o.map(u=>u.width)),d=o.reduce((u,h)=>u+h.height,0);return{width:l,height:d,lines:o}}wrapText(e,t,s){if(!s)return e.split(`
`);this.ctx||this.initialize();const i=this.ctx;this.applyTextStyle(i,t);const n=e.split(`
`),a=[];for(const o of n){const l=o.split(" ");let d="";for(const u of l){const h=d?`${d} ${u}`:u;i.measureText(h).width>s&&d?(a.push(d),d=u):d=h}d&&a.push(d)}return a.length>0?a:[""]}applyTextStyle(e,t){const s=typeof t.fontWeight=="number"?t.fontWeight.toString():t.fontWeight;e.font=`${t.fontStyle} ${s} ${t.fontSize}px "${t.fontFamily}"`,e.fillStyle=t.color,e.textAlign=t.textAlign,e.textBaseline="middle",t.shadowColor?(e.shadowColor=t.shadowColor,e.shadowBlur=t.shadowBlur??0,e.shadowOffsetX=t.shadowOffsetX??0,e.shadowOffsetY=t.shadowOffsetY??0):(e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),"letterSpacing"in e&&t.letterSpacing!==0&&(e.letterSpacing=`${t.letterSpacing}px`)}generateId(){return`text-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}clear(){this.textClips.clear()}loadTextClips(e){this.textClips.clear();for(const t of e)this.textClips.set(t.id,t)}exportTextClips(){return Array.from(this.textClips.values())}applyEmphasisAnimation(e,t){const{type:s,speed:i,intensity:n,loop:a,startTime:o,animationDuration:l}=e,d=o??0;if(t<d)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};if(l!==void 0&&l>0){const m=d+l;if(t>m)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}const u=t-d,h=a?u*i%1:Math.min(u*i,1),p=h*Math.PI*2;switch(s){case"pulse":return{opacity:1,scale:1+Math.sin(p)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":{const m=Math.sin(p*5)*.02*n,f=Math.cos(p*5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:m,offsetY:f,rotation:0}}case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(p))*-.05*n,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(p)*.03*n,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:h*360*n};case"flash":return{opacity:.5+Math.abs(Math.sin(p))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":{const m=h*4;let f=1;return m<1?f=1+.15*n*Math.sin(m*Math.PI):m<2&&(f=1+.1*n*Math.sin((m-1)*Math.PI)),{opacity:1,scale:f,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p)*15*n};case"wobble":{const m=Math.sin(p*3)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(p)*.02*n,offsetY:0,rotation:m}}case"jello":{const m=1+Math.sin(p*2)*.1*n,f=1-Math.sin(p*2)*.1*n;return{opacity:1,scale:1,scaleX:m,scaleY:f,offsetX:0,offsetY:0,rotation:0}}case"rubber-band":{const m=1+Math.sin(p)*.2*n,f=1-Math.sin(p)*.1*n;return{opacity:1,scale:1,scaleX:m,scaleY:f,offsetX:0,offsetY:0,rotation:0}}case"tada":{const m=Math.sin(p*4)*10*n;return{opacity:1,scale:1+Math.sin(p*2)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:m}}case"vibrate":{const m=(Math.random()-.5)*.02*n,f=(Math.random()-.5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:m,offsetY:f,rotation:0}}case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":{const m=1+Math.sin(p)*.05*n;return{opacity:.8+Math.sin(p)*.2,scale:m,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"breathe":return{opacity:1,scale:1+Math.sin(p*.5)*.08*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":{const m=Math.sin(p+u*2)*.03*n,f=Math.sin(p)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:m,rotation:f}}case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p*.5)*10*n};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(p)*.15*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const m=e.focusPoint||{x:.5,y:.5},f=e.zoomScale||1.5,g=e.holdDuration||.3,y=.3,x=1-g-y;let v=1,b=0,S=0;if(h<y){const k=h/y,C=1-Math.pow(1-k,3);v=1+(f-1)*C*n,b=(.5-m.x)*(v-1),S=(.5-m.y)*(v-1)}else if(h<y+g)v=f*n,b=(.5-m.x)*(v-1),S=(.5-m.y)*(v-1);else{const k=(h-y-g)/x,C=Math.pow(k,3);v=f-(f-1)*C*n,b=(.5-m.x)*(v-1),S=(.5-m.y)*(v-1)}return{opacity:1,scale:v,scaleX:1,scaleY:1,offsetX:b,offsetY:S,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-h*.2*n,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:h*.2*n,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-h*.2*n,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:h*.2*n,rotation:0};case"ken-burns":{const m=1+h*.3*n,f=h*.1*n,g=h*.05*n;return{opacity:1,scale:m,scaleX:1,scaleY:1,offsetX:f,offsetY:g,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}}}const bo=new A9,wf={fill:{type:"solid",color:"#3b82f6",opacity:1},stroke:{color:"#1d4ed8",width:2,opacity:1}},Tp={position:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1};class j9{animationEngine;svgCache=new Map;imageCache=new Map;shapeClips=new Map;svgClips=new Map;stickerClips=new Map;constructor(e){this.animationEngine=e||new Cu}createShape(e,t,s,i){const n=this.generateId(),a={...wf,...e.style,fill:{...wf.fill,...e.style?.fill},stroke:{...wf.stroke,...e.style?.stroke}},o={id:n,trackId:t,startTime:s,duration:i,type:"shape",shapeType:e.shapeType,style:a,transform:{...Tp},keyframes:[],points:e.points};return this.shapeClips.set(n,o),o}createRectangle(e,t,s,i,n,a){return this.createShape({shapeType:"rectangle",width:i,height:n,style:a},e,t,s)}createCircle(e,t,s,i,n){return this.createShape({shapeType:"circle",width:i*2,height:i*2,style:n},e,t,s)}createArrow(e,t,s,i,n,a,o){const l={headWidth:n*.6,headLength:i*.3,tailWidth:n*.3,curved:!1,doubleHeaded:!1};return this.createShape({shapeType:"arrow",width:i,height:n,style:o,arrowProps:{...l,...a}},e,t,s)}updateShapeStyle(e,t){const s={...e,style:{...e.style,...t,fill:t.fill?{...e.style.fill,...t.fill}:e.style.fill,stroke:t.stroke?{...e.style.stroke,...t.stroke}:e.style.stroke}};return this.shapeClips.set(s.id,s),s}updateFill(e,t){return this.updateShapeStyle(e,{fill:{...e.style.fill,...t}})}updateStroke(e,t){return this.updateShapeStyle(e,{stroke:{...e.style.stroke,...t}})}updateShapeClip(e,t){const s=this.shapeClips.get(e);if(!s)return;const i={...s,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,transform:t.transform?{...s.transform,...t.transform}:s.transform,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation,keyframes:t.keyframes??s.keyframes};return this.shapeClips.set(e,i),i}updateTransform(e,t){return{...e,transform:{...e.transform,...t}}}importSVG(e,t,s,i){const n=this.parseSVG(e),a=this.generateId(),o={id:a,trackId:t,startTime:s,duration:i,type:"svg",svgContent:n.svgContent,viewBox:n.viewBox,preserveAspectRatio:"xMidYMid",transform:{...Tp},keyframes:[],colorStyle:{colorMode:"none",tintColor:"#ffffff",tintOpacity:1},entryAnimation:{type:"none",duration:.5,easing:"ease-out"},exitAnimation:{type:"none",duration:.5,easing:"ease-in"}};return this.svgClips.set(a,o),o}parseSVG(e){const i=new DOMParser().parseFromString(e,"image/svg+xml").querySelector("svg");if(!i)throw new Error("Invalid SVG content: no svg element found");const n=i.getAttribute("viewBox");let a={minX:0,minY:0,width:100,height:100};if(n){const o=n.split(/[\s,]+/).map(Number);o.length===4&&(a={minX:o[0],minY:o[1],width:o[2],height:o[3]})}else{const o=parseFloat(i.getAttribute("width")||"100"),l=parseFloat(i.getAttribute("height")||"100");a={minX:0,minY:0,width:o,height:l}}return{svgContent:e,viewBox:a,width:a.width,height:a.height}}async renderGraphic(e,t,s,i){const n=typeof OffscreenCanvas<"u"?new OffscreenCanvas(s,i):document.createElement("canvas");n instanceof HTMLCanvasElement&&(n.width=s,n.height=i);const a=n.getContext("2d");if(!a)throw new Error("Failed to get canvas context");const o=this.getAnimatedGraphicState(e,t);if(o.opacity<=0)return{canvas:n,width:s,height:i};switch(this.applyTransform(a,o.transform,s,i),e.type){case"shape":this.renderShape(a,e,s,i);break;case"svg":await this.renderSVG(a,e,s,i,o);break;case"sticker":case"emoji":await this.renderSticker(a,e,s,i);break}return{canvas:n,width:s,height:i}}renderShape(e,t,s,i){const{style:n,shapeType:a}=t,l=Math.min(s,i)*.15,d=l/2;switch(e.save(),n.shadow&&(e.shadowColor=n.shadow.color,e.shadowBlur=n.shadow.blur,e.shadowOffsetX=n.shadow.offsetX,e.shadowOffsetY=n.shadow.offsetY),e.beginPath(),a){case"rectangle":this.drawRectangle(e,0,0,l,l,n.cornerRadius);break;case"circle":this.drawCircle(e,0,0,d);break;case"ellipse":this.drawEllipse(e,0,0,d,d);break;case"triangle":this.drawTriangle(e,0,0,l,l);break;case"arrow":this.drawArrow(e,0,0,l,l);break;case"line":this.drawLine(e,-d,0,d,0);break;case"star":this.drawStar(e,0,0,d,n.points||5,n.innerRadius||.5);break;case"polygon":t.points&&t.points.length>0&&this.drawPolygonCentered(e,t.points,l);break}n.fill.type!=="none"&&(e.globalAlpha=n.fill.opacity,n.fill.type==="gradient"&&n.fill.gradient?e.fillStyle=this.createGradient(e,n.fill.gradient,l,l):e.fillStyle=n.fill.color||"#000000",e.fill()),n.stroke.width>0&&(e.globalAlpha=n.stroke.opacity,e.strokeStyle=n.stroke.color,e.lineWidth=n.stroke.width,e.lineCap=n.stroke.lineCap||"butt",e.lineJoin=n.stroke.lineJoin||"miter",n.stroke.dashArray&&(e.setLineDash(n.stroke.dashArray),e.lineDashOffset=n.stroke.dashOffset||0),e.stroke()),e.restore()}async renderSVG(e,t,s,i,n){const a=t.svgContent,o=new Blob([a],{type:"image/svg+xml"}),l=URL.createObjectURL(o);try{const d=await this.loadImage(l),u=t.viewBox.width,h=t.viewBox.height;if(n.blur>0&&(e.filter=`blur(${n.blur}px)`),t.colorStyle&&t.colorStyle.colorMode!=="none"&&(t.colorStyle.colorMode==="tint"||t.colorStyle.colorMode==="replace")){const p=new OffscreenCanvas(u,h),m=p.getContext("2d");m?(m.drawImage(d,0,0,u,h),m.globalCompositeOperation="source-in",m.fillStyle=t.colorStyle.tintColor||"#ffffff",m.globalAlpha=t.colorStyle.tintOpacity??1,m.fillRect(0,0,u,h),e.drawImage(p,-u/2,-h/2)):e.drawImage(d,-u/2,-h/2,u,h)}else e.drawImage(d,-u/2,-h/2,u,h);e.filter="none"}finally{URL.revokeObjectURL(l)}}async renderSticker(e,t,s,i){const n=await this.loadImage(t.imageUrl),a=n.width,o=n.height,l=t.transform.anchor?.x??.5,d=t.transform.anchor?.y??.5;e.drawImage(n,-a*l,-o*d,a,o)}drawRectangle(e,t,s,i,n,a){const o=t-i/2,l=s-n/2;if(a&&a>0){const d=Math.min(a,i/2,n/2);e.moveTo(o+d,l),e.lineTo(o+i-d,l),e.quadraticCurveTo(o+i,l,o+i,l+d),e.lineTo(o+i,l+n-d),e.quadraticCurveTo(o+i,l+n,o+i-d,l+n),e.lineTo(o+d,l+n),e.quadraticCurveTo(o,l+n,o,l+n-d),e.lineTo(o,l+d),e.quadraticCurveTo(o,l,o+d,l)}else e.rect(o,l,i,n)}drawCircle(e,t,s,i){e.arc(t,s,i,0,Math.PI*2)}drawEllipse(e,t,s,i,n){e.ellipse(t,s,i,n,0,0,Math.PI*2)}drawTriangle(e,t,s,i,n){e.moveTo(t,s-n/2),e.lineTo(t+i/2,s+n/2),e.lineTo(t-i/2,s+n/2),e.closePath()}drawArrow(e,t,s,i,n){const a=n*.6,o=i*.3,l=n*.3,d=t-i/2,u=t+i/2,h=u-o;e.moveTo(d,s-l/2),e.lineTo(h,s-l/2),e.lineTo(h,s-a/2),e.lineTo(u,s),e.lineTo(h,s+a/2),e.lineTo(h,s+l/2),e.lineTo(d,s+l/2),e.closePath()}drawLine(e,t,s,i,n){e.moveTo(t,s),e.lineTo(i,n)}drawStar(e,t,s,i,n,a){const o=i*a,l=Math.PI/n;e.moveTo(t,s-i);for(let d=0;d<n*2;d++){const u=d%2===0?i:o,h=-Math.PI/2+d*l;e.lineTo(t+Math.cos(h)*u,s+Math.sin(h)*u)}e.closePath()}drawPolygonCentered(e,t,s){if(t.length<2)return;const i=s/2;e.moveTo(t[0].x*s-i,t[0].y*s-i);for(let n=1;n<t.length;n++)e.lineTo(t[n].x*s-i,t[n].y*s-i);e.closePath()}createGradient(e,t,s,i){let n;if(t.type==="linear"){const a=(t.angle||0)*Math.PI/180,o=s/2-Math.cos(a)*s/2,l=i/2-Math.sin(a)*i/2,d=s/2+Math.cos(a)*s/2,u=i/2+Math.sin(a)*i/2;n=e.createLinearGradient(o,l,d,u)}else n=e.createRadialGradient(s/2,i/2,0,s/2,i/2,Math.max(s,i)/2);for(const a of t.stops)n.addColorStop(a.offset,a.color);return n}getAnimatedGraphicState(e,t){let s={...e.transform},i=s.opacity,n=1,a=1,o=1,l=0,d=0,u=0,h=0;e.keyframes.length>0&&(s=this.getAnimatedTransform(e,t),i=s.opacity);let p=!1,m=!1;if(e.type==="svg"){const f=e,g=f.entryAnimation,y=f.exitAnimation;if(g||y){const x=g?.duration||0,v=y?.duration||0,S=e.duration-v;if(g&&t<x){p=!0;const k=x>0?t/x:1,C=this.applyGraphicAnimation(g.type,k,g.easing,!0);n*=C.scale,l+=C.offsetX,d+=C.offsetY,u+=C.rotation,i*=C.opacity,h=C.blur}if(y&&t>=S){m=!0;const k=v>0?(t-S)/v:1,C=this.applyGraphicAnimation(y.type,k,y.easing,!1);n*=C.scale,l+=C.offsetX,d+=C.offsetY,u+=C.rotation,i*=C.opacity,h=Math.max(h,C.blur)}}}if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"&&!p&&!m){const f=this.applyEmphasisAnimation(e.emphasisAnimation,t);n*=f.scale,a*=f.scaleX,o*=f.scaleY,l+=f.offsetX,d+=f.offsetY,u+=f.rotation,i*=f.opacity}return{transform:{...s,position:{x:s.position.x+l,y:s.position.y+d},scale:{x:s.scale.x*n*a,y:s.scale.y*n*o},rotation:s.rotation+u,opacity:i,anchor:s.anchor},opacity:i,scale:n,scaleX:a,scaleY:o,offsetX:l,offsetY:d,rotation:u,blur:h}}applyEmphasisAnimation(e,t){const{type:s,speed:i,intensity:n,loop:a,startTime:o,animationDuration:l}=e,d=o??0;if(t<d)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};if(l!==void 0&&l>0){const m=d+l;if(t>m)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}const u=t-d,h=a?u*i%1:Math.min(u*i,1),p=h*Math.PI*2;switch(s){case"pulse":return{opacity:1,scale:1+Math.sin(p)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":const f=Math.sin(p*5)*.02*n,g=Math.cos(p*5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:f,offsetY:g,rotation:0};case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(p))*-.05*n,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(p)*.03*n,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:h*360*n};case"flash":return{opacity:.5+Math.abs(Math.sin(p))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":const S=h*4;let k=1;return S<1?k=1+.15*n*Math.sin(S*Math.PI):S<2&&(k=1+.1*n*Math.sin((S-1)*Math.PI)),{opacity:1,scale:k,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p)*15*n};case"wobble":const A=Math.sin(p*3)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(p)*.02*n,offsetY:0,rotation:A};case"jello":const j=1+Math.sin(p*2)*.1*n,_=1-Math.sin(p*2)*.1*n;return{opacity:1,scale:1,scaleX:j,scaleY:_,offsetX:0,offsetY:0,rotation:0};case"rubber-band":const M=1+Math.sin(p)*.2*n,E=1-Math.sin(p)*.1*n;return{opacity:1,scale:1,scaleX:M,scaleY:E,offsetX:0,offsetY:0,rotation:0};case"tada":const D=Math.sin(p*4)*10*n;return{opacity:1,scale:1+Math.sin(p*2)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:D};case"vibrate":const B=(Math.random()-.5)*.02*n,O=(Math.random()-.5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:B,offsetY:O,rotation:0};case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":const I=1+Math.sin(p)*.05*n;return{opacity:.8+Math.sin(p)*.2,scale:I,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"breathe":return{opacity:1,scale:1+Math.sin(p*.5)*.08*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":const P=Math.sin(p+t*2)*.03*n,W=Math.sin(p)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:P,rotation:W};case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p*.5)*10*n};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(p)*.15*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const q=e.focusPoint||{x:.5,y:.5},oe=e.zoomScale||1.5,V=e.holdDuration||.3,he=.3,Se=1-V-he;let J=1,be=0,ie=0;if(h<he){const Pe=h/he,$=1-Math.pow(1-Pe,3);J=1+(oe-1)*$*n,be=(.5-q.x)*(J-1),ie=(.5-q.y)*(J-1)}else if(h<he+V)J=oe*n,be=(.5-q.x)*(J-1),ie=(.5-q.y)*(J-1);else{const Pe=(h-he-V)/Se,$=Math.pow(Pe,3);J=oe-(oe-1)*$*n,be=(.5-q.x)*(J-1),ie=(.5-q.y)*(J-1)}return{opacity:1,scale:J,scaleX:1,scaleY:1,offsetX:be,offsetY:ie,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-h*.2*n,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:h*.2*n,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-h*.2*n,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:h*.2*n,rotation:0};case"ken-burns":{const q=1+h*.3*n,oe=h*.1*n,V=h*.05*n;return{opacity:1,scale:q,scaleX:1,scaleY:1,offsetX:oe,offsetY:V,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}}applyGraphicAnimation(e,t,s,i){const n=this.animationEngine.applyEasing(t,s),a=i?n:1-n;switch(e){case"fade":return{opacity:a,scale:1,offsetX:0,offsetY:0,rotation:0,blur:0};case"slide-left":return{opacity:a,scale:1,offsetX:(1-a)*-1,offsetY:0,rotation:0,blur:0};case"slide-right":return{opacity:a,scale:1,offsetX:(1-a)*1,offsetY:0,rotation:0,blur:0};case"slide-up":return{opacity:a,scale:1,offsetX:0,offsetY:(1-a)*-1,rotation:0,blur:0};case"slide-down":return{opacity:a,scale:1,offsetX:0,offsetY:(1-a)*1,rotation:0,blur:0};case"scale":return{opacity:a,scale:a,offsetX:0,offsetY:0,rotation:0,blur:0};case"rotate":return{opacity:a,scale:1,offsetX:0,offsetY:0,rotation:(1-a)*(i?-180:180),blur:0};case"bounce":const o=Math.abs(Math.sin(a*Math.PI*3))*(1-a);return{opacity:a,scale:1,offsetX:0,offsetY:o*-.1,rotation:0,blur:0};case"pop":const l=1.2;let d=0;return a<.5?d=a*2*l:a<.7?d=l-(a-.5)*(l-1)/.2:d=1,{opacity:Math.min(a*2,1),scale:d,offsetX:0,offsetY:0,rotation:0,blur:0};case"none":default:return{opacity:1,scale:1,offsetX:0,offsetY:0,rotation:0,blur:0}}}getAnimatedTransform(e,t){if(e.keyframes.length===0)return e.transform;const s={...e.transform},i=["position.x","position.y","scale.x","scale.y","rotation","opacity"];for(const n of i){const a=this.animationEngine.getKeyframesForProperty(e.keyframes,n);if(a.length>0){const o=this.animationEngine.getValueAtTime(a,t);o.value!==void 0&&this.setNestedProperty(s,n,o.value)}}return s}applyTransform(e,t,s,i){const n=t.position.x*s,a=t.position.y*i;e.translate(n,a),e.rotate(t.rotation*Math.PI/180),e.scale(t.scale.x,t.scale.y),e.globalAlpha=t.opacity}setNestedProperty(e,t,s){const i=t.split(".");let n=e;for(let a=0;a<i.length-1;a++)i[a]in n||(n[i[a]]={}),n=n[i[a]];n[i[i.length-1]]=s}addKeyframe(e,t){return{...e,keyframes:this.animationEngine.addKeyframe(e.keyframes,t)}}removeKeyframe(e,t){return{...e,keyframes:this.animationEngine.removeKeyframe(e.keyframes,t)}}updateKeyframe(e,t,s){return{...e,keyframes:this.animationEngine.updateKeyframe(e.keyframes,t,s)}}loadImage(e){const t=this.imageCache.get(e);return t?Promise.resolve(t):new Promise((s,i)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{this.imageCache.set(e,n),s(n)},n.onerror=()=>i(new Error(`Failed to load image: ${e}`)),n.src=e})}generateId(){return`graphic_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}getShapeClip(e){return this.shapeClips.get(e)}getSVGClip(e){return this.svgClips.get(e)}getAllShapeClips(){return Array.from(this.shapeClips.values())}getAllSVGClips(){return Array.from(this.svgClips.values())}getShapeClipsForTrack(e){return Array.from(this.shapeClips.values()).filter(t=>t.trackId===e)}getSVGClipsForTrack(e){return Array.from(this.svgClips.values()).filter(t=>t.trackId===e)}deleteShapeClip(e){return this.shapeClips.delete(e)}deleteSVGClip(e){return this.svgClips.delete(e)}updateSVGClip(e,t){const s=this.svgClips.get(e);if(!s){console.warn(`[GraphicsEngine] SVG clip not found: ${e}`);return}const i={...s,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,transform:t.transform?{...s.transform,...t.transform}:s.transform,entryAnimation:t.entryAnimation??s.entryAnimation,exitAnimation:t.exitAnimation??s.exitAnimation,colorStyle:t.colorStyle??s.colorStyle,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation,keyframes:t.keyframes??s.keyframes};return this.svgClips.set(e,i),i}setSVGAnimation(e,t,s){const i={...e,[t==="entry"?"entryAnimation":"exitAnimation"]:s};return this.svgClips.set(e.id,i),i}setSVGColorStyle(e,t){const s={...e,colorStyle:t};return this.svgClips.set(e.id,s),s}addStickerClip(e){this.stickerClips.set(e.id,e)}getStickerClip(e){return this.stickerClips.get(e)}getAllStickerClips(){return Array.from(this.stickerClips.values())}getStickerClipsForTrack(e){return Array.from(this.stickerClips.values()).filter(t=>t.trackId===e)}deleteStickerClip(e){return this.stickerClips.delete(e)}updateStickerClip(e,t){const s=this.stickerClips.get(e);if(!s){console.warn(`[GraphicsEngine] Sticker clip not found: ${e}`);return}const i={...s,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,transform:t.transform?{...s.transform,...t.transform}:s.transform,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation};return this.stickerClips.set(e,i),i}clearCache(){this.svgCache.clear(),this.imageCache.clear(),this.shapeClips.clear(),this.svgClips.clear(),this.stickerClips.clear(),this.animationEngine.clearCache()}loadShapeClips(e){this.shapeClips.clear();for(const t of e)this.shapeClips.set(t.id,t)}loadSVGClips(e){this.svgClips.clear();for(const t of e)this.svgClips.set(t.id,t)}loadStickerClips(e){this.stickerClips.clear();for(const t of e)this.stickerClips.set(t.id,t)}createGraphicAnimation(e,t=.5,s="ease-out"){return{type:e,duration:t,easing:s}}}const Sr=new j9;function qc(){return typeof navigator>"u"?!1:"gpu"in navigator&&navigator.gpu!==void 0}function _9(r){return r==="canvas2d"?"canvas2d":qc()?"webgpu":"canvas2d"}class ia{static instance=null;currentRenderer=null;config=null;constructor(){}static getInstance(){return ia.instance||(ia.instance=new ia),ia.instance}isWebGPUSupported(){return qc()}getRendererType(e){return _9(e)}async createRenderer(e){if(this.config=e,qc())try{const{WebGPURenderer:i}=await hi(async()=>{const{WebGPURenderer:o}=await import("./webgpu-renderer-impl.js").then(l=>l.w);return{WebGPURenderer:o}},[]),n=new i(e);if(await n.initialize())return this.currentRenderer=n,n;console.warn("[RendererFactory] WebGPU init failed, using Canvas2D")}catch(i){console.warn("[RendererFactory] WebGPU error, using Canvas2D:",i)}const{Canvas2DFallbackRenderer:t}=await hi(async()=>{const{Canvas2DFallbackRenderer:i}=await import("./canvas2d-fallback-renderer.js");return{Canvas2DFallbackRenderer:i}},[]),s=new t(e);return await s.initialize(),this.currentRenderer=s,s}getCurrentRenderer(){return this.currentRenderer}destroyRenderer(){this.currentRenderer&&(this.currentRenderer.destroy(),this.currentRenderer=null)}async recreateRenderer(){return this.config?(this.destroyRenderer(),this.createRenderer(this.config)):null}}function E9(){return ia.getInstance()}const Di=`#version 300 es
precision highp float;

in vec2 a_position;
in vec2 a_texCoord;

out vec2 v_texCoord;

void main() {
 gl_Position = vec4(a_position, 0.0, 1.0);
 v_texCoord = a_texCoord;
}
`,M9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;

void main() {
 fragColor = texture(u_texture, v_texCoord);
}
`,P9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_brightness;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 rgb = color.rgb + u_brightness;
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,N9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_contrast;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 rgb = (color.rgb - 0.5) * u_contrast + 0.5;
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,R9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_saturation;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float luminance = dot(color.rgb, vec3(0.299, 0.587, 0.114));
 vec3 rgb = mix(vec3(luminance), color.rgb, u_saturation);
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,I9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_hueRotation;

vec3 rgb2hsv(vec3 c) {
 vec4 K = vec4(0.0, -1.0/3.0, 2.0/3.0, -1.0);
 vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
 vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
 float d = q.x - min(q.w, q.y);
 float e = 1.0e-10;
 return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}

vec3 hsv2rgb(vec3 c) {
 vec4 K = vec4(1.0, 2.0/3.0, 1.0/3.0, 3.0);
 vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
 return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 hsv = rgb2hsv(color.rgb);
 hsv.x = fract(hsv.x + u_hueRotation / 360.0);
 vec3 rgb = hsv2rgb(hsv);
 fragColor = vec4(rgb, color.a);
}
`,D9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec2 u_resolution;
uniform float u_radius;

void main() {
 vec2 texelSize = 1.0 / u_resolution;
 vec4 color = vec4(0.0);
 float total = 0.0;
 
 int r = int(min(u_radius, 10.0));
 for (int x = -r; x <= r; x++) {
 for (int y = -r; y <= r; y++) {
 vec2 offset = vec2(float(x), float(y)) * texelSize;
 color += texture(u_texture, v_texCoord + offset);
 total += 1.0;
 }
 }
 
 fragColor = color / total;
}
`,F9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec2 u_resolution;
uniform float u_amount;

void main() {
 vec2 texelSize = 1.0 / u_resolution;
 
 vec4 center = texture(u_texture, v_texCoord);
 vec4 top = texture(u_texture, v_texCoord + vec2(0.0, -texelSize.y));
 vec4 bottom = texture(u_texture, v_texCoord + vec2(0.0, texelSize.y));
 vec4 left = texture(u_texture, v_texCoord + vec2(-texelSize.x, 0.0));
 vec4 right = texture(u_texture, v_texCoord + vec2(texelSize.x, 0.0));
 
 vec4 sharpened = center * (1.0 + 4.0 * u_amount) - (top + bottom + left + right) * u_amount;
 fragColor = vec4(clamp(sharpened.rgb, 0.0, 1.0), center.a);
}
`,B9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_amount;
uniform float u_midpoint;
uniform float u_feather;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec2 center = vec2(0.5, 0.5);
 float dist = distance(v_texCoord, center);
 float vignette = smoothstep(u_midpoint - u_feather, u_midpoint + u_feather, dist);
 vec3 rgb = color.rgb * (1.0 - vignette * u_amount);
 fragColor = vec4(rgb, color.a);
}
`,L9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_amount;
uniform float u_size;
uniform float u_time;

float random(vec2 st) {
 return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec2 st = v_texCoord * u_size + u_time;
 float noise = random(st) * 2.0 - 1.0;
 vec3 rgb = color.rgb + noise * u_amount;
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,O9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec3 u_keyColor;
uniform float u_tolerance;
uniform float u_softness;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float diff = distance(color.rgb, u_keyColor);
 float alpha = smoothstep(u_tolerance - u_softness, u_tolerance + u_softness, diff);
 fragColor = vec4(color.rgb, color.a * alpha);
}
`,$9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_temperature; // -1 (cool/blue) to 1 (warm/orange)

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 
 // Temperature adjustment using color balance

 vec3 rgb = color.rgb;
 
 if (u_temperature > 0.0) {
 rgb.r = rgb.r + u_temperature * 0.2;
 rgb.g = rgb.g + u_temperature * 0.1;
 rgb.b = rgb.b - u_temperature * 0.2;
 } else {
 rgb.r = rgb.r + u_temperature * 0.2;
 rgb.g = rgb.g + u_temperature * 0.05;
 rgb.b = rgb.b - u_temperature * 0.2;
 }
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,z9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_tint; // -1 (green) to 1 (magenta)

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 
 // Tint adjustment

 vec3 rgb = color.rgb;
 
 rgb.r = rgb.r + u_tint * 0.1;
 rgb.g = rgb.g - u_tint * 0.2;
 rgb.b = rgb.b + u_tint * 0.1;
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,V9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_shadows; // -1 to 1
uniform float u_midtones; // -1 to 1
uniform float u_highlights; // -1 to 1

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float luma = dot(color.rgb, vec3(0.299, 0.587, 0.114));
 float shadowWeight = 1.0 - smoothstep(0.0, 0.33, luma);
 float highlightWeight = smoothstep(0.66, 1.0, luma);
 float midtoneWeight = 1.0 - shadowWeight - highlightWeight;
 midtoneWeight = max(0.0, midtoneWeight);
 vec3 rgb = color.rgb;
 rgb += u_shadows * shadowWeight * 0.3;
 rgb += u_midtones * midtoneWeight * 0.3;
 rgb += u_highlights * highlightWeight * 0.3;
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`;class Su{canvas=null;gl=null;shaders=new Map;quadBuffer=null;texCoordBuffer=null;framebuffers=[];renderTextures=[];currentRenderTarget=0;width;height;useGPU;preferWebGPU;initialized=!1;initializing=!1;initPromise=null;renderer=null;rendererFactory=null;useNewRenderer=!1;constructor(e){this.width=e.width,this.height=e.height,this.useGPU=e.useGPU??!0,this.preferWebGPU=e.preferWebGPU??!0,this._applyEffectsWithNewRenderer,this._applyEffectsGPU}async initialize(){if(this.initialized)return!0;if(this.initializing&&this.initPromise)return this.initPromise;this.initializing=!0,this.initPromise=this.doInitialize();try{const e=await this.initPromise;return this.initialized=e,e}finally{this.initializing=!1}}async doInitialize(){if(this.useGPU){if(this.preferWebGPU&&qc())try{return await this.initializeNewRenderer(),!0}catch(e){console.warn("[VideoEffectsEngine] WebGPU initialization failed, falling back to WebGL2:",e)}if(Su.isWebGL2Supported())return this.initializeWebGL(),!0}return!0}async initializeNewRenderer(){try{this.rendererFactory=ia.getInstance(),this.canvas=new OffscreenCanvas(this.width,this.height);const e={canvas:this.canvas,width:this.width,height:this.height,preferredRenderer:this.preferWebGPU?"webgpu":"canvas2d"};this.renderer=await this.rendererFactory.createRenderer(e),this.useNewRenderer=!0}catch(e){console.warn("[VideoEffectsEngine] Failed to initialize new renderer, falling back to WebGL2:",e),this.useNewRenderer=!1,this.initializeWebGL()}}initializeWebGL(){this.canvas=new OffscreenCanvas(this.width,this.height);const e=this.canvas.getContext("webgl2",{preserveDrawingBuffer:!0,premultipliedAlpha:!0,alpha:!0,antialias:!1});if(!e){console.warn("WebGL2 not available, falling back to CPU processing"),this.useGPU=!1;return}this.gl=e,this.quadBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),this.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),e.STATIC_DRAW);for(let t=0;t<2;t++){const s=e.createFramebuffer(),i=this.createRenderTexture();this.framebuffers.push(s),this.renderTextures.push(i)}this.compileShader("passthrough",Di,M9),this.compileShader("brightness",Di,P9),this.compileShader("contrast",Di,N9),this.compileShader("saturation",Di,R9),this.compileShader("hue",Di,I9),this.compileShader("blur",Di,D9),this.compileShader("sharpen",Di,F9),this.compileShader("vignette",Di,B9),this.compileShader("grain",Di,L9),this.compileShader("chromaKey",Di,O9),this.compileShader("temperature",Di,$9),this.compileShader("tint",Di,z9),this.compileShader("tonal",Di,V9),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)}createRenderTexture(){const e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t}compileShader(e,t,s){const i=this.gl,n=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error(`Vertex shader error: ${i.getShaderInfoLog(n)}`);const a=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(a,s),i.compileShader(a),!i.getShaderParameter(a,i.COMPILE_STATUS))throw new Error(`Fragment shader error: ${i.getShaderInfoLog(a)}`);const o=i.createProgram();if(i.attachShader(o,n),i.attachShader(o,a),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw new Error(`Program link error: ${i.getProgramInfoLog(o)}`);const l=new Map,d=i.getProgramParameter(o,i.ACTIVE_UNIFORMS);for(let p=0;p<d;p++){const m=i.getActiveUniform(o,p);if(m){const f=i.getUniformLocation(o,m.name);f&&l.set(m.name,f)}}const u=new Map,h=i.getProgramParameter(o,i.ACTIVE_ATTRIBUTES);for(let p=0;p<h;p++){const m=i.getActiveAttrib(o,p);m&&u.set(m.name,i.getAttribLocation(o,m.name))}this.shaders.set(e,{program:o,uniforms:l,attributes:u}),i.deleteShader(n),i.deleteShader(a)}async applyEffects(e,t){const s=performance.now(),i=t.filter(a=>a.enabled);return i.length===0?{image:await createImageBitmap(e),processingTime:performance.now()-s,gpuAccelerated:!1}:{image:await this.applyEffectsCPU(e,i),processingTime:performance.now()-s,gpuAccelerated:!1}}async _applyEffectsWithNewRenderer(e,t){if(!this.renderer)throw new Error("Renderer not initialized");try{const s=this.renderer.createTextureFromImage(e),i=this.renderer.applyEffects(s,t);this.renderer.beginFrame(),this.renderer.renderLayer({texture:i,transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,anchor:{x:.5,y:.5}},effects:[],opacity:1,borderRadius:0});const n=await this.renderer.endFrame();return this.renderer.releaseTexture(s),!n||n.width===0||n.height===0?(console.warn("[VideoEffectsEngine] Renderer returned invalid result, using CPU fallback"),this.applyEffectsCPU(e,t)):n}catch(s){return console.warn("[VideoEffectsEngine] applyEffectsWithNewRenderer failed:",s),this.applyEffectsCPU(e,t)}}async _applyEffectsGPU(e,t){const s=this.gl;if(s.isContextLost())return console.warn("[VideoEffectsEngine] WebGL context lost, falling back to CPU"),this.applyEffectsCPU(e,t);try{if(this.canvas.width!==e.width||this.canvas.height!==e.height){this.canvas.width=e.width,this.canvas.height=e.height,this.width=e.width,this.height=e.height;for(let o=0;o<2;o++)s.bindTexture(s.TEXTURE_2D,this.renderTextures[o]),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.width,this.height,0,s.RGBA,s.UNSIGNED_BYTE,null)}const i=this.uploadTexture(e);for(let o=0;o<2;o++)s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffers[o]),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.renderTextures[o],0),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT);let n=i;this.currentRenderTarget=0;for(const o of t){const l=o.type;this.shaders.get(l)&&(this.renderWithShader(l,n,o.params),n=this.renderTextures[this.currentRenderTarget],this.currentRenderTarget=1-this.currentRenderTarget)}s.bindFramebuffer(s.FRAMEBUFFER,null),s.viewport(0,0,this.width,this.height),this.renderPassthrough(n),s.deleteTexture(i);const a=s.getError();return a!==s.NO_ERROR?(console.warn("[VideoEffectsEngine] WebGL error:",a),createImageBitmap(e)):createImageBitmap(this.canvas)}catch(i){return console.error("[VideoEffectsEngine] GPU processing failed:",i),this.applyEffectsCPU(e,t)}}uploadTexture(e){const t=this.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s}renderWithShader(e,t,s){const i=this.gl,n=this.shaders.get(e);if(!n)return;i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffers[this.currentRenderTarget]),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.renderTextures[this.currentRenderTarget],0),i.viewport(0,0,this.width,this.height),i.useProgram(n.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t);const a=n.uniforms.get("u_texture");a&&i.uniform1i(a,0),this.setFilterUniforms(e,n,s),this.setupVertexAttributes(n),i.drawArrays(i.TRIANGLE_STRIP,0,4)}renderPassthrough(e){const t=this.gl,s=this.shaders.get("passthrough");t.useProgram(s.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e);const i=s.uniforms.get("u_texture");i&&t.uniform1i(i,0),this.setupVertexAttributes(s),t.drawArrays(t.TRIANGLE_STRIP,0,4)}setupVertexAttributes(e){const t=this.gl,s=e.attributes.get("a_position");s!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0));const i=e.attributes.get("a_texCoord");i!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffer),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0))}setFilterUniforms(e,t,s){const i=this.gl;switch(e){case"brightness":{const n=t.uniforms.get("u_brightness");n&&i.uniform1f(n,s.value||0);break}case"contrast":{const n=t.uniforms.get("u_contrast");n&&i.uniform1f(n,s.value||1);break}case"saturation":{const n=t.uniforms.get("u_saturation");n&&i.uniform1f(n,s.value||1);break}case"hue":{const n=t.uniforms.get("u_hueRotation");n&&i.uniform1f(n,s.rotation||0);break}case"blur":{const n=t.uniforms.get("u_radius"),a=t.uniforms.get("u_resolution");n&&i.uniform1f(n,Math.min(s.radius||0,10)),a&&i.uniform2f(a,this.width,this.height);break}case"sharpen":{const n=t.uniforms.get("u_amount"),a=t.uniforms.get("u_resolution");n&&i.uniform1f(n,s.amount||0),a&&i.uniform2f(a,this.width,this.height);break}case"vignette":{const n=t.uniforms.get("u_amount"),a=t.uniforms.get("u_midpoint"),o=t.uniforms.get("u_feather");n&&i.uniform1f(n,s.amount||.5),a&&i.uniform1f(a,s.midpoint||.5),o&&i.uniform1f(o,s.feather||.3);break}case"grain":{const n=t.uniforms.get("u_amount"),a=t.uniforms.get("u_size"),o=t.uniforms.get("u_time");n&&i.uniform1f(n,s.amount||.1),a&&i.uniform1f(a,s.size||1),o&&i.uniform1f(o,performance.now()/1e3);break}case"chromaKey":{const n=t.uniforms.get("u_keyColor"),a=t.uniforms.get("u_tolerance"),o=t.uniforms.get("u_softness"),l=s.keyColor;n&&i.uniform3f(n,l?.r??0,l?.g??1,l?.b??0),a&&i.uniform1f(a,s.tolerance||.3),o&&i.uniform1f(o,s.edgeSoftness||.1);break}case"temperature":{const n=t.uniforms.get("u_temperature");n&&i.uniform1f(n,s.value||0);break}case"tint":{const n=t.uniforms.get("u_tint");n&&i.uniform1f(n,s.value||0);break}case"tonal":{const n=t.uniforms.get("u_shadows"),a=t.uniforms.get("u_midtones"),o=t.uniforms.get("u_highlights");n&&i.uniform1f(n,s.shadows||0),a&&i.uniform1f(a,s.midtones||0),o&&i.uniform1f(o,s.highlights||0);break}}}async applyEffectsCPU(e,t){const s=new OffscreenCanvas(e.width,e.height),i=s.getContext("2d",{willReadFrequently:!0}),n=[],a=[];for(const o of t){const l=this.buildCSSFilter(o);l?n.push(l):a.push(o)}n.length>0?(i.filter=n.join(" "),i.drawImage(e,0,0),i.filter="none"):i.drawImage(e,0,0);for(const o of a)await this.applyEffectPixelLevel(i,o,s.width,s.height);return createImageBitmap(s)}async applyEffectPixelLevel(e,t,s,i){const n=e.getImageData(0,0,s,i),a=n.data,o=t.params;switch(t.type){case"sharpen":{const l=o.amount||.5;this.applySharpenKernel(a,s,i,l);break}case"vignette":{const l=o.amount||.5,d=o.midpoint||.5,u=o.feather||.3;this.applyVignette(a,s,i,l,d,u);break}case"grain":{const l=o.amount||.1;this.applyGrain(a,l);break}case"chromaKey":{const l=o.keyColor,d=o.tolerance||.3,u=o.edgeSoftness||.1;this.applyChromaKey(a,l||{r:0,g:1,b:0},d,u);break}case"temperature":{const l=o.value||0;this.applyTemperature(a,l);break}case"tint":{const l=o.value||0;this.applyTint(a,l);break}case"tonal":{const l=o.shadows||0,d=o.midtones||0,u=o.highlights||0;this.applyTonal(a,l,d,u);break}}e.putImageData(n,0,0)}applySharpenKernel(e,t,s,i){const n=i/100,a=new Uint8ClampedArray(e),o=[0,-n,0,-n,1+4*n,-n,0,-n,0];for(let l=1;l<s-1;l++)for(let d=1;d<t-1;d++)for(let u=0;u<3;u++){let h=0;for(let p=-1;p<=1;p++)for(let m=-1;m<=1;m++){const f=((l+p)*t+(d+m))*4+u;h+=a[f]*o[(p+1)*3+(m+1)]}e[(l*t+d)*4+u]=Math.max(0,Math.min(255,h))}}applyVignette(e,t,s,i,n,a){const o=i/100,l=t/2,d=s/2;for(let u=0;u<s;u++)for(let h=0;h<t;h++){const p=(h-l)/l,m=(u-d)/d,f=Math.sqrt(p*p+m*m)/Math.SQRT2,y=1-this.smoothstep(n-a,n+a,f)*o,x=(u*t+h)*4;e[x]=Math.round(e[x]*y),e[x+1]=Math.round(e[x+1]*y),e[x+2]=Math.round(e[x+2]*y)}}smoothstep(e,t,s){const i=Math.max(0,Math.min(1,(s-e)/(t-e)));return i*i*(3-2*i)}applyGrain(e,t){const i=t/100*50;for(let n=0;n<e.length;n+=4){const a=(Math.random()-.5)*i;e[n]=Math.max(0,Math.min(255,e[n]+a)),e[n+1]=Math.max(0,Math.min(255,e[n+1]+a)),e[n+2]=Math.max(0,Math.min(255,e[n+2]+a))}}applyChromaKey(e,t,s,i){const n=t.r*255,a=t.g*255,o=t.b*255,l=s*441.67,d=i*441.67;for(let u=0;u<e.length;u+=4){const h=e[u]-n,p=e[u+1]-a,m=e[u+2]-o,f=Math.sqrt(h*h+p*p+m*m),g=this.smoothstep(l-d,l+d,f);e[u+3]=Math.round(e[u+3]*g)}}applyTemperature(e,t){const s=t/100;for(let i=0;i<e.length;i+=4){let n=e[i],a=e[i+1],o=e[i+2];s>0?(n=Math.min(255,n+s*51),a=Math.min(255,a+s*25.5),o=Math.max(0,o-s*51)):(n=Math.max(0,n+s*51),a=Math.max(0,a+s*12.75),o=Math.min(255,o-s*51)),e[i]=Math.round(n),e[i+1]=Math.round(a),e[i+2]=Math.round(o)}}applyTint(e,t){const s=t/100;for(let i=0;i<e.length;i+=4){let n=e[i],a=e[i+1],o=e[i+2];n=Math.max(0,Math.min(255,n+s*25.5)),a=Math.max(0,Math.min(255,a-s*51)),o=Math.max(0,Math.min(255,o+s*25.5)),e[i]=Math.round(n),e[i+1]=Math.round(a),e[i+2]=Math.round(o)}}applyTonal(e,t,s,i){for(let n=0;n<e.length;n+=4){const a=e[n]/255,o=e[n+1]/255,l=e[n+2]/255,d=.299*a+.587*o+.114*l,u=1-this.smoothstep(0,.33,d),h=this.smoothstep(.66,1,d),p=Math.max(0,1-u-h),m=t*u*.3+s*p*.3+i*h*.3;e[n]=Math.round(Math.max(0,Math.min(255,(a+m)*255))),e[n+1]=Math.round(Math.max(0,Math.min(255,(o+m)*255))),e[n+2]=Math.round(Math.max(0,Math.min(255,(l+m)*255)))}}buildCSSFilter(e){const t=e.params;switch(e.type){case"brightness":return`brightness(${1+(t.value||0)/100})`;case"contrast":return`contrast(${t.value||1})`;case"saturation":return`saturate(${t.value||1})`;case"hue":return`hue-rotate(${t.rotation||0}deg)`;case"blur":return`blur(${t.radius||0}px)`;default:return""}}async applyEffect(e,t){return this.applyEffects(e,[t])}removeEffect(e,t){return e.filter(s=>s.id!==t)}reorderEffects(e,t,s){const i=[...e],[n]=i.splice(t,1);return i.splice(s,0,n),i}getEffectOrder(e){return e.filter(t=>t.enabled).map(t=>t.id)}static isWebGL2Supported(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!==null}catch{return!1}}resize(e,t){if(this.width=e,this.height=t,this.canvas&&(this.canvas.width=e,this.canvas.height=t),this.renderer&&this.renderer.resize(e,t),this.gl){for(const s of this.renderTextures)this.gl.deleteTexture(s);this.renderTextures=[];for(let s=0;s<2;s++)this.renderTextures.push(this.createRenderTexture())}}getAvailableFilters(){return["brightness","contrast","saturation","hue","blur","sharpen","vignette","grain","chromaKey","temperature","tint","tonal"]}isFilterSupported(e){return this.getAvailableFilters().includes(e)}dispose(){if(this.renderer&&(this.renderer.destroy(),this.renderer=null),this.rendererFactory=null,this.useNewRenderer=!1,this.gl){for(const e of this.shaders.values())this.gl.deleteProgram(e.program);this.shaders.clear(),this.quadBuffer&&this.gl.deleteBuffer(this.quadBuffer),this.texCoordBuffer&&this.gl.deleteBuffer(this.texCoordBuffer);for(const e of this.framebuffers)this.gl.deleteFramebuffer(e);for(const e of this.renderTextures)this.gl.deleteTexture(e);this.framebuffers=[],this.renderTextures=[]}this.canvas=null,this.gl=null,this.initialized=!1}getRendererType(){return this.useNewRenderer&&this.renderer?this.renderer.type:this.gl?"legacy-webgl2":"cpu"}isUsingWebGPU(){return this.useNewRenderer&&this.renderer?.type==="webgpu"}getRenderer(){return this.renderer}}let Wa=null;function U9(r=1920,e=1080){return Wa?(Wa.width!==r||Wa.height!==e)&&Wa.resize(r,e):(Wa=new Su({width:r,height:e}),Wa.initialize().catch(t=>{console.error("[VideoEffectsEngine] Background initialization failed:",t)})),Wa}const G9=.1,W9=20;class Y9{clipSpeedData=new Map;animationEngine;constructor(e){this.animationEngine=e||new Cu}setClipSpeed(e,t,s){const i=this.clampSpeed(t),n=this.getOrCreateSpeedData(e,s);n.baseSpeed=i,this.clipSpeedData.set(e,n)}getClipSpeed(e){return this.clipSpeedData.get(e)?.baseSpeed??1}getEffectiveDuration(e){const t=this.clipSpeedData.get(e);return t?t.keyframes.length>0?this.calculateVariableSpeedDuration(t):t.originalDuration/t.baseSpeed:0}calculateVariableSpeedDuration(e){if([...e.keyframes].sort((a,o)=>a.time-o.time).length===0)return e.originalDuration/e.baseSpeed;const s=1e3,i=e.originalDuration/s;let n=0;for(let a=0;a<s;a++){const o=a*i,l=this.getSpeedAtSourceTime(e,o);n+=i/l}return n}clampSpeed(e){return Math.max(G9,Math.min(W9,e))}setReverse(e,t,s){let i=this.clipSpeedData.get(e);!i&&s!==void 0&&(i=this.getOrCreateSpeedData(e,s),this.clipSpeedData.set(e,i)),i&&(i.reverse=t)}isReverse(e){return this.clipSpeedData.get(e)?.reverse??!1}getFrameIndexAtTime(e,t,s){const i=this.getSourceTimeAtPlaybackTime(e,t),n=Math.floor(i*s);return Math.max(0,n)}getFrameIndicesInRange(e,t,s,i){const n=1/i,a=[];for(let o=t;o<s;o+=n)a.push(this.getFrameIndexAtTime(e,o,i));return a}addSpeedKeyframe(e,t,s,i="linear"){const n=this.clipSpeedData.get(e);if(!n)throw new Error(`No speed data for clip ${e}`);const a=`speed-kf-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,o={id:a,time:t,speed:this.clampSpeed(s),easing:i},l=n.keyframes.findIndex(d=>Math.abs(d.time-t)<.001);return l>=0?n.keyframes[l]=o:(n.keyframes.push(o),n.keyframes.sort((d,u)=>d.time-u.time)),a}removeSpeedKeyframe(e,t){const s=this.clipSpeedData.get(e);s&&(s.keyframes=s.keyframes.filter(i=>i.id!==t))}getSpeedKeyframes(e){return this.clipSpeedData.get(e)?.keyframes??[]}getSpeedAtTime(e,t){const s=this.clipSpeedData.get(e);return s?this.getSpeedAtSourceTime(s,t):1}getSpeedAtSourceTime(e,t){const s=e.keyframes;if(s.length===0)return e.baseSpeed;const i=[...s].sort((n,a)=>n.time-a.time);if(t<=i[0].time)return i[0].speed;if(t>=i[i.length-1].time)return i[i.length-1].speed;for(let n=0;n<i.length-1;n++)if(t>=i[n].time&&t<=i[n+1].time){const a=i[n],o=i[n+1],l=o.time-a.time,d=t-a.time,u=l>0?d/l:0,h=this.animationEngine.applyEasing(u,a.easing);return a.speed+(o.speed-a.speed)*h}return e.baseSpeed}createFreezeFrame(e,t,s,i){const n=this.clipSpeedData.get(e);if(!n)throw new Error(`No speed data for clip ${e}`);const o={id:`freeze-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,clipId:e,sourceTime:t,startTime:s,duration:i};return n.freezeFrames.push(o),n.freezeFrames.sort((l,d)=>l.startTime-d.startTime),o}removeFreezeFrame(e,t){const s=this.clipSpeedData.get(e);s&&(s.freezeFrames=s.freezeFrames.filter(i=>i.id!==t))}getFreezeFrames(e){return this.clipSpeedData.get(e)?.freezeFrames??[]}getFreezeFrameAtTime(e,t){const s=this.clipSpeedData.get(e);if(!s)return null;for(const i of s.freezeFrames)if(t>=i.startTime&&t<i.startTime+i.duration)return i;return null}getSourceTimeAtPlaybackTime(e,t){const s=this.clipSpeedData.get(e);if(!s)return t;const i=this.getFreezeFrameAtTime(e,t);if(i)return i.sourceTime;let n=t;for(const o of s.freezeFrames)if(o.startTime+o.duration<=t)n-=o.duration;else if(o.startTime<t)break;if(s.keyframes.length>0)return this.calculateSourceTimeWithVariableSpeed(s,n);let a=n*s.baseSpeed;return s.reverse&&(a=s.originalDuration-a),Math.max(0,Math.min(s.originalDuration,a))}calculateSourceTimeWithVariableSpeed(e,t){const s=this.calculateVariableSpeedDuration(e);if(t<=0)return 0;if(t>=s)return e.originalDuration;let i=0,n=e.originalDuration;const a=1e-4;for(;n-i>a;){const l=(i+n)/2;this.integratePlaybackTime(e,l)<t?i=l:n=l}let o=(i+n)/2;return e.reverse&&(o=e.originalDuration-o),Math.max(0,Math.min(e.originalDuration,o))}integratePlaybackTime(e,t){const s=Math.max(100,Math.ceil(t*100)),i=t/s;let n=0;for(let a=0;a<s;a++){const o=a*i,l=this.getSpeedAtSourceTime(e,o);n+=i/l}return n}setPitchCorrection(e,t){const s=this.clipSpeedData.get(e);s&&(s.pitchCorrection=t)}isPitchCorrectionEnabled(e){return this.clipSpeedData.get(e)?.pitchCorrection??!0}getOrCreateSpeedData(e,t){let s=this.clipSpeedData.get(e);return s||(s={clipId:e,baseSpeed:1,reverse:!1,keyframes:[],pitchCorrection:!0,freezeFrames:[],originalDuration:t},this.clipSpeedData.set(e,s)),s}initializeClip(e,t){this.getOrCreateSpeedData(e,t)}removeClip(e){this.clipSpeedData.delete(e)}getClipIds(){return Array.from(this.clipSpeedData.keys())}getClipSpeedData(e){return this.clipSpeedData.get(e)}clear(){this.clipSpeedData.clear()}}let kf=null;function yc(){return kf||(kf=new Y9),kf}const hC=new Map;let Q0=0,qo=null;async function xM(){if(qo)return qo;try{return qo=await hi(()=>import("./index2.js"),[]),qo}catch{try{return qo=await hi(()=>import("https://esm.sh/mediabunny@1.25.3"),[]),qo}catch{return null}}}async function q9(r,e,t,s){const i=hC.get(r);if(i)return i;try{const n=await xM();if(!n)return null;const{Input:a,ALL_FORMATS:o,BlobSource:l,CanvasSink:d}=n,u=new a({source:new l(e),formats:o}),h=await u.getPrimaryVideoTrack();if(!h)return null;const p=new d(h,{width:t,height:s,fit:"contain"}),m={input:u,sink:p,videoTrack:h,blobUrl:URL.createObjectURL(e)};return hC.set(r,m),m}catch(n){return console.error(`[DecodeWorker ${Q0}] Failed to create resources for ${r}:`,n),null}}async function H9(r){const{requestId:e,clipId:t,blob:s,time:i,width:n,height:a}=r;try{const o=await q9(t,s,n,a);if(!o)return{type:"decoded",requestId:e,clipId:t,bitmap:null,time:i,error:"Failed to create decode resources"};const d=await o.sink.getCanvas(i);if(!d?.canvas)return{type:"decoded",requestId:e,clipId:t,bitmap:null,time:i,error:"No frame at requested time"};const u=await createImageBitmap(d.canvas);return{type:"decoded",requestId:e,clipId:t,bitmap:u,time:i}}catch(o){return{type:"decoded",requestId:e,clipId:t,bitmap:null,time:i,error:o instanceof Error?o.message:"Unknown decode error"}}}const Ku=self;Ku.onmessage=async r=>{const e=r.data;switch(e.type){case"init":Q0=Math.floor(Math.random()*1e4),await xM();const t={type:"ready",workerId:Q0};Ku.postMessage(t);break;case"decode":const s=await H9(e);s.bitmap?Ku.postMessage(s,{transfer:[s.bitmap]}):Ku.postMessage(s);break}};const X9=`
const resourceCache = new Map();
let workerId = 0;
let mediabunnyModule = null;
let mediabunnyAvailable = false;

async function loadMediaBunny() {
 if (mediabunnyModule) {
 return mediabunnyModule;
 }
 try {
 mediabunnyModule = await import("mediabunny");
 mediabunnyAvailable = true;
 return mediabunnyModule;
 } catch (error) {
 try {
 mediabunnyModule = await import("https://esm.sh/mediabunny@1.25.3");
 mediabunnyAvailable = true;
 return mediabunnyModule;
 } catch (cdnError) {
 mediabunnyAvailable = false;
 return null;
 }
 }
}

async function getOrCreateResources(clipId, blob, width, height) {
 if (!mediabunnyAvailable || !mediabunnyModule) {
 return null;
 }

 const cached = resourceCache.get(clipId);
 if (cached) {
 return cached;
 }

 try {
 const { Input, ALL_FORMATS, BlobSource, CanvasSink } = mediabunnyModule;

 const input = new Input({
 source: new BlobSource(blob),
 formats: ALL_FORMATS,
 });

 const videoTrack = await input.getPrimaryVideoTrack();
 if (!videoTrack) {
 return null;
 }

 const sink = new CanvasSink(videoTrack, {
 width,
 height,
 fit: "contain",
 });

 const resource = {
 input,
 sink,
 videoTrack,
 blobUrl: URL.createObjectURL(blob),
 };

 resourceCache.set(clipId, resource);
 return resource;
 } catch (error) {
 return null;
 }
}

async function decodeFrame(request) {
 const { requestId, clipId, blob, time, width, height } = request;

 if (!mediabunnyAvailable) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: "MediaBunny not available in worker",
 };
 }

 try {
 const resources = await getOrCreateResources(clipId, blob, width, height);
 if (!resources) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: "Failed to create decode resources",
 };
 }

 const frameResult = await resources.sink.getCanvas(time);
 if (!frameResult?.canvas) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: "No frame at requested time",
 };
 }

 const bitmap = await createImageBitmap(frameResult.canvas);

 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap,
 time,
 };
 } catch (error) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: error instanceof Error ? error.message : "Unknown decode error",
 };
 }
}

self.onmessage = async (event) => {
 const request = event.data;

 switch (request.type) {
 case "init":
 workerId = Math.floor(Math.random() * 10000);
 await loadMediaBunny();
 self.postMessage({ type: "ready", workerId, mediabunnyAvailable });
 break;

 case "decode":
 const response = await decodeFrame(request);
 if (response.bitmap) {
 self.postMessage(response, [response.bitmap]);
 } else {
 self.postMessage(response);
 }
 break;
 }
};
`;function K9(){return new Blob([X9],{type:"application/javascript"})}function Q9(){const r=K9();return URL.createObjectURL(r)}class J9{constructor(e=4){this.workerCount=e,this.workerCount=Math.max(1,Math.min(e,navigator.hardwareConcurrency||4))}workers=[];workerUrls=[];requestQueue=[];frameCache=new Map;maxCacheSize=100;cacheHits=0;cacheMisses=0;initialized=!1;initPromise=null;requestIdCounter=0;mediabunnyAvailable=!1;isAvailable(){return this.initialized&&this.mediabunnyAvailable}async initialize(){if(!this.initialized)return this.initPromise?this.initPromise:(this.initPromise=this.doInitialize(),this.initPromise)}async doInitialize(){const e=[];for(let t=0;t<this.workerCount;t++)e.push(this.createWorker(t));this.workers=await Promise.all(e),this.mediabunnyAvailable=this.workers.some(t=>t.mediabunnyAvailable),this.initialized=!0}async createWorker(e){return new Promise((t,s)=>{const i=Q9();this.workerUrls.push(i);const n=new Worker(i,{type:"module"}),a={worker:n,workerId:e,busy:!1,pendingRequests:new Map,totalDecodes:0,totalDecodeTime:0,mediabunnyAvailable:!1},o=setTimeout(()=>{s(new Error(`Worker ${e} initialization timed out`))},1e4);n.onmessage=l=>{const d=l.data;if(d.type==="ready"){clearTimeout(o),a.workerId=d.workerId,a.mediabunnyAvailable=d.mediabunnyAvailable??!1,a.mediabunnyAvailable,t(a);return}d.type==="decoded"&&this.handleDecodeResponse(a,d)},n.onerror=l=>{console.error(`[ParallelFrameDecoder] Worker ${e} error:`,l),clearTimeout(o),s(l)},n.postMessage({type:"init"})})}async handleDecodeResponse(e,t){const s=e.pendingRequests.get(t.requestId);if(!s){console.warn(`[ParallelFrameDecoder] No pending request for ${t.requestId}`);return}e.pendingRequests.delete(t.requestId),e.busy=e.pendingRequests.size>0;const i=performance.now()-s.startTime;e.totalDecodes++,e.totalDecodeTime+=i;let n=null;if(t.bitmap){const a=`${t.clipId}:${t.time.toFixed(3)}`;this.addToCache(a,t.bitmap);try{n=await createImageBitmap(t.bitmap)}catch{n=null}}s.resolve({clipId:t.clipId,bitmap:n,time:t.time,error:t.error}),this.processQueue()}addToCache(e,t){if(this.frameCache.size>=this.maxCacheSize){let s=null,i=1/0;for(const[n,a]of this.frameCache)a.timestamp<i&&(i=a.timestamp,s=n);s&&(this.frameCache.get(s)?.bitmap.close(),this.frameCache.delete(s))}this.frameCache.set(e,{bitmap:t,timestamp:performance.now()})}async getFromCache(e,t){const s=`${e}:${t.toFixed(3)}`,i=this.frameCache.get(s);if(i){i.timestamp=performance.now(),this.cacheHits++;try{return await createImageBitmap(i.bitmap)}catch{return this.frameCache.delete(s),null}}return this.cacheMisses++,null}getLeastBusyWorker(){let e=null,t=1/0;for(const s of this.workers)s.pendingRequests.size<t&&(t=s.pendingRequests.size,e=s);return e}processQueue(){for(;this.requestQueue.length>0;){const e=this.getLeastBusyWorker();if(!e||e.pendingRequests.size>=2)break;const t=this.requestQueue.shift();t&&this.sendDecodeRequest(e,t.request,t.resolve,t.reject)}}sendDecodeRequest(e,t,s,i){const n=`req_${this.requestIdCounter++}`,a={resolve:s,reject:i,clipId:t.clipId,startTime:performance.now()};e.pendingRequests.set(n,a),e.busy=!0;const o={type:"decode",requestId:n,clipId:t.clipId,blob:t.blob,time:t.time,width:t.width,height:t.height};e.worker.postMessage(o)}async decodeFrame(e){this.initialized||await this.initialize();const t=await this.getFromCache(e.clipId,e.time);return t?{clipId:e.clipId,bitmap:t,time:e.time}:new Promise((s,i)=>{const n=this.getLeastBusyWorker();n&&n.pendingRequests.size<2?this.sendDecodeRequest(n,e,s,i):this.requestQueue.push({request:e,resolve:s,reject:i})})}async decodeFrames(e){this.initialized||await this.initialize();const t=new Map,s=[];for(const n of e)s.push(this.decodeFrame(n));const i=await Promise.all(s);for(const n of i)t.set(n.clipId,n);return t}async decodeClipsAtTime(e,t,s){const i=e.map(o=>({clipId:o.clipId,blob:o.blob,time:o.time,width:t,height:s})),n=await this.decodeFrames(i),a=new Map;for(const[o,l]of n)l.bitmap&&a.set(o,l.bitmap);return a}getStats(){let e=0,t=0,s=0;for(const i of this.workers)e+=i.totalDecodes,t+=i.totalDecodeTime,s+=i.pendingRequests.size;return{workerCount:this.workers.length,totalDecodes:e,averageDecodeTime:e>0?t/e:0,pendingRequests:s+this.requestQueue.length,cacheHits:this.cacheHits,cacheMisses:this.cacheMisses}}clearCache(){for(const[,e]of this.frameCache)e.bitmap.close();this.frameCache.clear(),this.cacheHits=0,this.cacheMisses=0}dispose(){for(const e of this.workers){for(const[,t]of e.pendingRequests)t.reject(new Error("Decoder disposed"));e.worker.terminate()}this.workers=[];for(const e of this.workerUrls)URL.revokeObjectURL(e);this.workerUrls=[],this.clearCache();for(const e of this.requestQueue)e.reject(new Error("Decoder disposed"));this.requestQueue=[],this.initialized=!1,this.initPromise=null}}let Cf=null;function Z9(){if(!Cf){const r=Math.min(4,navigator.hardwareConcurrency||4);Cf=new J9(r)}return Cf}class pC{buffers;writeIndex=0;presentIndex=1;bufferSize;framesWritten=0;framesPresented=0;framesDropped=0;fallbacksUsed=0;latencySum=0;latencyCount=0;lastWriteTime=0;lastPresentTime=0;constructor(e=3){this.bufferSize=Math.max(2,Math.min(e,8)),this.buffers=new Array(this.bufferSize).fill(null)}write(e,t,s){const i=this.buffers[this.writeIndex];i&&i.bitmap.close(),this.buffers[this.writeIndex]={bitmap:e,timestamp:t,frameNumber:s},this.lastWriteTime=performance.now(),this.framesWritten++,this.writeIndex=(this.writeIndex+1)%this.bufferSize,this.writeIndex===this.presentIndex&&(this.presentIndex=(this.presentIndex+1)%this.bufferSize,this.framesDropped++)}async writeFromCanvas(e,t,s){const i=await createImageBitmap(e);this.write(i,t,s)}present(){const e=(this.presentIndex-1+this.bufferSize)%this.bufferSize,t=this.buffers[e];if(t){const s=performance.now();if(this.lastWriteTime>0){const i=s-this.lastWriteTime;this.latencySum+=i,this.latencyCount++}return this.lastPresentTime=s,this.framesPresented++,t}return null}presentOrFallback(){const e=this.present();if(e)return e;for(let t=1;t<this.bufferSize;t++){const s=(this.presentIndex-1-t+this.bufferSize*2)%this.bufferSize,i=this.buffers[s];if(i)return this.fallbacksUsed++,i}return null}swap(){this.presentIndex=(this.presentIndex+1)%this.bufferSize}peek(){const e=(this.presentIndex-1+this.bufferSize)%this.bufferSize;return this.buffers[e]}peekNext(){return this.buffers[this.presentIndex]}hasFrameReady(){const e=(this.presentIndex-1+this.bufferSize)%this.bufferSize;return this.buffers[e]!==null}hasNextFrameReady(){return this.buffers[this.presentIndex]!==null}getBufferFillLevel(){let e=0;for(const t of this.buffers)t!==null&&e++;return e/this.bufferSize}getLatestTimestamp(){const e=(this.writeIndex-1+this.bufferSize)%this.bufferSize;return this.buffers[e]?.timestamp??null}getStats(){return{bufferSize:this.bufferSize,framesWritten:this.framesWritten,framesPresented:this.framesPresented,framesDropped:this.framesDropped,fallbacksUsed:this.fallbacksUsed,averageLatency:this.latencyCount>0?this.latencySum/this.latencyCount:0}}getTimingInfo(){return{lastWriteTime:this.lastWriteTime,lastPresentTime:this.lastPresentTime}}reset(){for(let e=0;e<this.bufferSize;e++){const t=this.buffers[e];t&&t.bitmap.close(),this.buffers[e]=null}this.writeIndex=0,this.presentIndex=1,this.framesWritten=0,this.framesPresented=0,this.framesDropped=0,this.fallbacksUsed=0,this.latencySum=0,this.latencyCount=0,this.lastWriteTime=0,this.lastPresentTime=0}dispose(){this.reset()}}class eW{buffers=new Map;compositedBuffer;lastCompositeTime=0;constructor(e=3){this.compositedBuffer=new pC(e)}getOrCreateTrackBuffer(e,t=3){let s=this.buffers.get(e);return s||(s=new pC(t),this.buffers.set(e,s)),s}writeTrackFrame(e,t,s,i){this.getOrCreateTrackBuffer(e).write(t,s,i)}getTrackFrame(e){return this.buffers.get(e)?.presentOrFallback()??null}getAllTrackFrames(){const e=new Map;for(const[t,s]of this.buffers){const i=s.presentOrFallback();i&&e.set(t,i)}return e}writeCompositedFrame(e,t,s){this.compositedBuffer.write(e,t,s),this.lastCompositeTime=performance.now()}getCompositedFrame(){return this.compositedBuffer.presentOrFallback()}swapAll(){for(const e of this.buffers.values())e.swap();this.compositedBuffer.swap()}getStats(){const e=new Map;for(const[t,s]of this.buffers)e.set(t,s.getStats());return{tracks:e,composited:this.compositedBuffer.getStats(),lastCompositeTime:this.lastCompositeTime}}removeTrack(e){const t=this.buffers.get(e);t&&(t.dispose(),this.buffers.delete(e))}reset(){for(const e of this.buffers.values())e.reset();this.compositedBuffer.reset(),this.lastCompositeTime=0}dispose(){for(const e of this.buffers.values())e.dispose();this.buffers.clear(),this.compositedBuffer.dispose()}}let Sf=null;function tW(){return Sf||(Sf=new eW),Sf}class sW{renderer=null;config;layers=new Map;sortedLayerIds=[];isDirty=!0;stats={layersComposited:0,lastCompositeDuration:0,averageCompositeDuration:0,texturesCreated:0,texturesReleased:0};compositeDurations=[];maxDurationSamples=60;constructor(e){this.config={...e,antialias:e.antialias??!0}}setRenderer(e){this.renderer=e,this.isDirty=!0}getRenderer(){return this.renderer}getDevice(){return this.renderer?.getDevice()??null}setBackgroundColor(e){this.config.backgroundColor=e,this.isDirty=!0}resize(e,t){this.config.width=e,this.config.height=t,this.renderer&&this.renderer.resize(e,t),this.isDirty=!0}addLayer(e){this.layers.set(e.id,e),this.sortLayers(),this.isDirty=!0}updateLayer(e,t){const s=this.layers.get(e);s&&(Object.assign(s,t),t.zIndex!==void 0&&this.sortLayers(),this.isDirty=!0)}removeLayer(e){const t=this.layers.get(e);t&&(this.renderer&&t.texture&&(this.renderer.releaseTexture(t.texture),this.stats.texturesReleased++),this.layers.delete(e),this.sortLayers(),this.isDirty=!0)}clearLayers(){if(this.renderer)for(const e of this.layers.values())e.texture&&(this.renderer.releaseTexture(e.texture),this.stats.texturesReleased++);this.layers.clear(),this.sortedLayerIds=[],this.isDirty=!0}getLayer(e){return this.layers.get(e)}getLayers(){return this.sortedLayerIds.map(e=>this.layers.get(e)).filter(Boolean)}setLayerVisibility(e,t){const s=this.layers.get(e);s&&(s.visible=t,this.isDirty=!0)}setLayerOpacity(e,t){const s=this.layers.get(e);s&&(s.opacity=Math.max(0,Math.min(1,t)),this.isDirty=!0)}setLayerBlendMode(e,t){const s=this.layers.get(e);s&&(s.blendMode=t,this.isDirty=!0)}setLayerTransform(e,t){const s=this.layers.get(e);s&&(s.transform=t,this.isDirty=!0)}setLayerZIndex(e,t){const s=this.layers.get(e);s&&(s.zIndex=t,this.sortLayers(),this.isDirty=!0)}sortLayers(){this.sortedLayerIds=Array.from(this.layers.keys()).sort((e,t)=>{const s=this.layers.get(e),i=this.layers.get(t);return s.zIndex-i.zIndex})}async createTextureFromCanvas(e){if(!this.renderer)throw new Error("Renderer not set");const t=await createImageBitmap(e),s=this.renderer.createTextureFromImage(t);return this.stats.texturesCreated++,s!==t&&t.close(),s}async createTextureFromBitmap(e){if(!this.renderer)throw new Error("Renderer not set");const t=this.renderer.createTextureFromImage(e);return this.stats.texturesCreated++,t}async composite(){if(!this.renderer)throw new Error("Renderer not set");const e=performance.now();this.renderer.beginFrame();let t=0;for(const n of this.sortedLayerIds){const a=this.layers.get(n);if(!a||!a.visible)continue;let o=a.texture;if(a.texture instanceof ImageBitmap)o=this.renderer.createTextureFromImage(a.texture);else if(a.texture instanceof HTMLCanvasElement||a.texture instanceof OffscreenCanvas){const u=await createImageBitmap(a.texture);o=this.renderer.createTextureFromImage(u),o!==u&&u.close()}const l=[...a.effects];a.blendMode!=="normal"&&l.push({id:`blend-${a.id}`,type:"blend",enabled:!0,params:{mode:a.blendMode}}),l.length>0&&(o=this.renderer.applyEffects(o,l));const d={texture:o,transform:a.transform,effects:[],opacity:a.opacity,borderRadius:a.borderRadius};this.renderer.renderLayer(d),t++}const s=await this.renderer.endFrame(),i=performance.now()-e;return this.recordCompositeDuration(i),this.stats.layersComposited=t,this.isDirty=!1,s}async compositeToCanvas(e){const t=await this.composite();e.drawImage(t,0,0),t.close()}recordCompositeDuration(e){this.stats.lastCompositeDuration=e,this.compositeDurations.push(e),this.compositeDurations.length>this.maxDurationSamples&&this.compositeDurations.shift();const t=this.compositeDurations.reduce((s,i)=>s+i,0);this.stats.averageCompositeDuration=t/this.compositeDurations.length}isDirtyFrame(){return this.isDirty}markDirty(){this.isDirty=!0}getStats(){return{...this.stats}}resetStats(){this.stats={layersComposited:0,lastCompositeDuration:0,averageCompositeDuration:0,texturesCreated:0,texturesReleased:0},this.compositeDurations=[]}dispose(){this.clearLayers(),this.renderer=null}}let Qu=null;function iW(r){return Qu&&Qu.dispose(),Qu=new sW(r),Qu}class bM{animationEngine;motionPaths=new Map;clipboard=null;constructor(e){this.animationEngine=e||new Cu}addKeyframe(e,t,s,i,n="linear"){return{id:this.generateKeyframeId(),time:s,property:t,value:i,easing:this.mapEasingPresetToType(n),bezierHandles:n==="linear"?void 0:this.getDefaultBezierHandles(n)}}removeKeyframe(e,t){return e.filter(s=>s.id!==t)}updateKeyframe(e,t,s){const i=e.map(n=>n.id===t?{...n,...s}:n);return s.time!==void 0&&i.sort((n,a)=>n.time-a.time),i}getKeyframe(e,t){return e.find(s=>s.id===t)||null}getKeyframesForProperty(e,t){return e.filter(s=>s.property===t).sort((s,i)=>s.time-i.time)}getValueAtTime(e,t){if(e.length===0)return{value:void 0,keyframeA:null,keyframeB:null,progress:0,easedProgress:0};const s=[...e].sort((h,p)=>h.time-p.time);if(t<=s[0].time)return{value:s[0].value,keyframeA:s[0],keyframeB:null,progress:0,easedProgress:0};if(t>=s[s.length-1].time)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1,easedProgress:1};let i=null,n=null;for(let h=0;h<s.length-1;h++)if(t>=s[h].time&&t<=s[h+1].time){i=s[h],n=s[h+1];break}if(!i||!n)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1,easedProgress:1};const a=n.time-i.time,o=t-i.time,l=a>0?o/a:0,d=this.applyEasing(l,i);return{value:this.interpolateValue(i.value,n.value,d),keyframeA:i,keyframeB:n,progress:l,easedProgress:d}}getEasingPresets(){return["linear","ease-in","ease-out","ease-in-out","bounce","elastic","spring"]}setEasing(e,t,s){return e.map(i=>i.id===t?typeof s=="string"?{...i,easing:this.mapEasingPresetToType(s),bezierHandles:this.getDefaultBezierHandles(s)}:{...i,easing:"bezier",bezierHandles:{in:{x:s.controlPoints[0],y:s.controlPoints[1]},out:{x:s.controlPoints[2],y:s.controlPoints[3]}}}:i)}applyEasing(e,t){const s=Math.max(0,Math.min(1,e));if(t.bezierHandles&&t.easing==="bezier")return this.animationEngine.cubicBezier(s,t.bezierHandles.in.x,t.bezierHandles.in.y,t.bezierHandles.out.x,t.bezierHandles.out.y);switch(t.easing){case"linear":return s;case"ease-in":return this.easeIn(s);case"ease-out":return this.easeOut(s);case"ease-in-out":return this.easeInOut(s);case"bezier":return this.animationEngine.cubicBezier(s,.25,.1,.25,1);default:return s}}applyEasingPreset(e,t){const s=Math.max(0,Math.min(1,e));switch(t){case"linear":return s;case"ease-in":return this.easeIn(s);case"ease-out":return this.easeOut(s);case"ease-in-out":return this.easeInOut(s);case"bounce":return this.bounce(s);case"elastic":return this.elastic(s);case"spring":return this.spring(s);default:return s}}easeIn(e){return e*e}easeOut(e){return e*(2-e)}easeInOut(e){return e<.5?2*e*e:-1+(4-2*e)*e}bounce(e){if(e<1/2.75)return 7.5625*e*e;if(e<2/2.75){const t=e-.5454545454545454;return 7.5625*t*t+.75}else if(e<2.5/2.75){const t=e-.8181818181818182;return 7.5625*t*t+.9375}else{const t=e-.9545454545454546;return 7.5625*t*t+.984375}}elastic(e){if(e===0||e===1)return e;const t=.3,s=t/4;return Math.pow(2,-10*e)*Math.sin((e-s)*(2*Math.PI)/t)+1}spring(e){return e===0||e===1?e:1-Math.pow(Math.cos(e*Math.PI*4.5),3)*Math.pow(1-e,2.2)*.4-(1-e)}updateBezierHandles(e,t,s){return e.map(i=>i.id===t?{...i,easing:"bezier",bezierHandles:s}:i)}getBezierControlPoints(e){return e.bezierHandles?{x1:e.bezierHandles.in.x,y1:e.bezierHandles.in.y,x2:e.bezierHandles.out.x,y2:e.bezierHandles.out.y}:null}interpolateWithBezier(e,t,s,i){const n=this.animationEngine.cubicBezier(s,i.x1,i.y1,i.x2,i.y2);return this.interpolateValue(e,t,n)}copyKeyframes(e,t,s){const i={keyframes:e.map(n=>({...n})),sourceClipId:t,sourceProperty:s,copiedAt:Date.now()};return this.clipboard=i,i}pasteKeyframes(e,t,s,i=0){const n=Math.min(...e.keyframes.map(a=>a.time));return e.keyframes.map(a=>({...a,id:this.generateKeyframeId(),property:s,time:a.time-n+i}))}getClipboard(){return this.clipboard}clearClipboard(){this.clipboard=null}getMotionPath(e,t,s=100){const i=this.getKeyframesForProperty(t,"position.x"),n=this.getKeyframesForProperty(t,"position.y");if(i.length===0&&n.length===0)return{clipId:e,points:[],visible:!1};const a=[...i,...n].map(p=>p.time),o=Math.min(...a),d=Math.max(...a)-o,u=[];for(let p=0;p<=s;p++){const m=o+d*p/s,f=this.getValueAtTime(i,m),g=this.getValueAtTime(n,m);u.push({time:m,x:typeof f.value=="number"?f.value:0,y:typeof g.value=="number"?g.value:0})}const h={clipId:e,points:u,visible:!0};return this.motionPaths.set(e,h),h}setMotionPathVisible(e,t){const s=this.motionPaths.get(e);s&&(s.visible=t)}generateKeyframeId(){return`kf-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}mapEasingPresetToType(e){switch(e){case"bounce":case"elastic":case"spring":return"bezier";default:return e}}getDefaultBezierHandles(e){switch(e){case"ease-in":return{in:{x:.42,y:0},out:{x:1,y:1}};case"ease-out":return{in:{x:0,y:0},out:{x:.58,y:1}};case"ease-in-out":return{in:{x:.42,y:0},out:{x:.58,y:1}};case"bounce":return{in:{x:.34,y:1.56},out:{x:.64,y:1}};case"elastic":return{in:{x:.68,y:-.55},out:{x:.27,y:1.55}};case"spring":return{in:{x:.5,y:1.5},out:{x:.5,y:1}};default:return}}interpolateValue(e,t,s){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*s;if(typeof e=="object"&&typeof t=="object"&&e!==null&&t!==null){const i={},n=e,a=t;for(const o of Object.keys(n))o in a?i[o]=this.interpolateValue(n[o],a[o],s):i[o]=n[o];return i}return s<.5?e:t}}const yi=new bM,Qi={particleCount:100,speed:100,speedVariance:50,gravity:200,wind:{x:0,y:0,z:0},turbulence:10,colors:["#ffffff"],size:{min:2,max:8},opacity:{start:1,end:0},lifetime:{min:.5,max:2},emissionRate:50,emissionShape:"point",emissionRadius:10,rotationSpeed:0,fadeIn:.1,fadeOut:.3,blendMode:"add"};function rW(){return Math.random().toString(36).substring(2,11)}function ms(r,e){return r+Math.random()*(e-r)}function nW(r,e){switch(r.emissionShape){case"circle":{const t=Math.random()*Math.PI*2,s=Math.random()*r.emissionRadius;return{x:e.x+Math.cos(t)*s,y:e.y+Math.sin(t)*s,z:e.z}}case"sphere":{const t=Math.random()*Math.PI*2,s=Math.acos(2*Math.random()-1),i=Math.random()*r.emissionRadius;return{x:e.x+i*Math.sin(s)*Math.cos(t),y:e.y+i*Math.sin(s)*Math.sin(t),z:e.z+i*Math.cos(s)}}case"rectangle":return{x:e.x+ms(-r.emissionRadius,r.emissionRadius),y:e.y+ms(-r.emissionRadius,r.emissionRadius),z:e.z};case"line":return{x:e.x+ms(-r.emissionRadius,r.emissionRadius),y:e.y,z:e.z};case"point":default:return{...e}}}function aW(r,e,t,s){const i=r.speed+ms(-r.speedVariance,r.speedVariance);switch(e){case"explode":{const n=s.x-t.x,a=s.y-t.y,o=Math.sqrt(n*n+a*a)||1;return{x:n/o*i+ms(-20,20),y:a/o*i+ms(-20,20),z:ms(-i*.5,i*.5)}}case"implode":{const n=t.x-s.x,a=t.y-s.y,o=Math.sqrt(n*n+a*a)||1;return{x:n/o*i,y:a/o*i,z:0}}case"confetti":return{x:ms(-i,i),y:-Math.abs(i)*ms(.5,1.5),z:ms(-i*.3,i*.3)};case"dust":case"sparkle":{const n=Math.random()*Math.PI*2;return{x:Math.cos(n)*i*.3,y:Math.sin(n)*i*.3-i*.2,z:ms(-10,10)}}case"disintegrate":return{x:ms(-i*.5,i*.5),y:-i*ms(.3,.8),z:ms(-i*.2,i*.2)};case"shatter":{const n=Math.random()*Math.PI*2;return{x:Math.cos(n)*i,y:Math.sin(n)*i-i*.5,z:ms(-i*.5,i*.5)}}case"dissolve":default:{const n=Math.random()*Math.PI*2;return{x:Math.cos(n)*i*.5,y:Math.sin(n)*i*.5,z:0}}}}class oW{emitters=new Map;effects=new Map;canvasWidth=1920;canvasHeight=1080;changeListeners=new Set;changeVersion=0;onEffectsChange(e){return this.changeListeners.add(e),()=>{this.changeListeners.delete(e)}}notifyChange(){this.changeVersion++;for(const e of this.changeListeners)e()}getChangeVersion(){return this.changeVersion}setCanvasSize(e,t){this.canvasWidth=e,this.canvasHeight=t}addEffect(e){this.effects.set(e.id,e),this.emitters.set(e.id,{effectId:e.id,particles:[],elapsedTime:0,emissionAccumulator:0,active:!1}),this.notifyChange()}removeEffect(e){this.effects.delete(e),this.emitters.delete(e),this.notifyChange()}updateEffect(e,t){const s=this.effects.get(e);s&&(s.config={...s.config,...t},this.notifyChange())}updateEffectTiming(e,t,s){const i=this.effects.get(e);i&&(i.startTime=t,i.duration=s,this.notifyChange())}getEffect(e){return this.effects.get(e)}getAllEffects(){return Array.from(this.effects.values())}getEffectsForClip(e){return Array.from(this.effects.values()).filter(t=>t.clipId===e)}toggleEffect(e,t){const s=this.effects.get(e);s&&(s.enabled=t,this.notifyChange())}createParticle(e,t){const s=e.config,i=nW(s,t),n=aW(s,e.type,t,i),a=Math.floor(Math.random()*s.colors.length);return{id:rW(),position:i,velocity:n,acceleration:{x:0,y:s.gravity,z:0},color:s.colors[a],size:ms(s.size.min,s.size.max),opacity:s.opacity.start,rotation:Math.random()*Math.PI*2,rotationSpeed:ms(-s.rotationSpeed,s.rotationSpeed),lifetime:ms(s.lifetime.min,s.lifetime.max),age:0,active:!0}}update(e,t){for(const[s,i]of this.emitters){const n=this.effects.get(s);if(!n||!n.enabled)continue;const a=e>=n.startTime,o=e>n.startTime+n.duration;if(!a||o){i.active=!1;continue}i.active=!0,i.elapsedTime=e-n.startTime;const l=n.config,d={x:this.canvasWidth/2,y:this.canvasHeight/2,z:0};for(i.emissionAccumulator+=l.emissionRate*t;i.emissionAccumulator>=1&&i.particles.length<l.particleCount;)i.particles.push(this.createParticle(n,d)),i.emissionAccumulator-=1;for(const u of i.particles){if(!u.active)continue;u.velocity.x+=(u.acceleration.x+l.wind.x)*t,u.velocity.y+=(u.acceleration.y+l.wind.y)*t,u.velocity.z+=(u.acceleration.z+l.wind.z)*t,l.turbulence>0&&(u.velocity.x+=ms(-l.turbulence,l.turbulence)*t,u.velocity.y+=ms(-l.turbulence,l.turbulence)*t),u.position.x+=u.velocity.x*t,u.position.y+=u.velocity.y*t,u.position.z+=u.velocity.z*t,u.rotation+=u.rotationSpeed*t,u.age+=t;const h=u.age/u.lifetime;if(h<l.fadeIn)u.opacity=l.opacity.start*(h/l.fadeIn);else if(h>1-l.fadeOut){const p=(1-h)/l.fadeOut;u.opacity=l.opacity.end+(l.opacity.start-l.opacity.end)*p}else{const p=(h-l.fadeIn)/(1-l.fadeIn-l.fadeOut);u.opacity=l.opacity.start+(l.opacity.end-l.opacity.start)*p}u.age>=u.lifetime&&(u.active=!1)}i.particles=i.particles.filter(u=>u.active)}}getParticles(e){if(e){const s=this.emitters.get(e);return s?s.particles:[]}const t=[];for(const s of this.emitters.values())s.active&&t.push(...s.particles);return t}getActiveEffectIds(){const e=[];for(const[t,s]of this.emitters)s.active&&e.push(t);return e}reset(){for(const e of this.emitters.values())e.particles=[],e.elapsedTime=0,e.emissionAccumulator=0,e.active=!1}dispose(){this.emitters.clear(),this.effects.clear()}}let Tf=null;function eu(){return Tf||(Tf=new oW),Tf}const cW={maxFrames:100,maxSizeBytes:500*1024*1024,preloadAhead:30,preloadBehind:10};class lW{mediabunny=null;initialized=!1;frameCache=new Map;gifFrameCache=new Map;cacheConfig;cacheStats={hits:0,misses:0};preloadQueue=[];isPreloading=!1;compositeCanvas=null;compositeCtx=null;parallelDecoder=null;compositeBuffer=null;useParallelDecoding=!0;videoElementCache=new Map;gpuCompositor=null;gpuRenderer=null;effectsEngine=null;lastExportTime=-1;exportFrameRate=30;constructor(e={}){this.cacheConfig={...cW,...e}}async initialize(){if(!this.initialized){this.isWebCodecsSupported()||console.warn("[VideoEngine] WebCodecs not supported in this browser");try{this.mediabunny=await hi(()=>import("./index2.js"),[])}catch(e){console.warn("[VideoEngine] MediaBunny not available, some features will be limited:",e),this.mediabunny=null}try{this.useParallelDecoding&&(this.parallelDecoder=Z9(),await this.parallelDecoder.initialize())}catch(e){console.warn("[VideoEngine] Parallel decoder initialization failed:",e),this.parallelDecoder=null}this.compositeBuffer=tW(),this.initialized=!0}}isWebCodecsSupported(){return typeof VideoDecoder<"u"&&typeof VideoEncoder<"u"}isMediaBunnyAvailable(){return this.mediabunny!==null}getParallelDecoder(){return this.parallelDecoder}getCompositeBuffer(){return this.compositeBuffer}getGPUCompositor(){return this.gpuCompositor}async initializeGPUCompositor(e,t){if(!this.gpuCompositor)try{const s=new OffscreenCanvas(e,t),i=E9();this.gpuRenderer=await i.createRenderer({canvas:s,width:e,height:t}),this.gpuCompositor=iW({width:e,height:t,backgroundColor:[0,0,0,1],antialias:!0}),this.gpuCompositor.setRenderer(this.gpuRenderer)}catch(s){console.warn("[VideoEngine] GPU compositor initialization failed, using CPU fallback:",s)}}isInitialized(){return this.initialized}setParallelDecoding(e){this.useParallelDecoding=e}async decodeFrameWithMediaBunny(e,t,s,i,n){try{const a=_c();if(a.isAvailable()||await a.initialize(),n){const l=a.getExportDecoder(n);if(l){const d=await l.getFrame(t);if(d)return createImageBitmap(d)}}const o=await a.getFrameAtTime(e,t,s);return o?.canvas?createImageBitmap(o.canvas):null}catch(a){return console.warn("[VideoEngine] MediaBunny frame decode failed:",a),null}}async decodeFrameWithVideoElement(e,t,s,i,n){let a=this.videoElementCache.get(e);if(!a){const y=URL.createObjectURL(t),x=document.createElement("video");x.src=y,x.muted=!0,x.playsInline=!0,x.preload="auto",await new Promise((v,b)=>{x.onloadedmetadata=()=>v(),x.onerror=()=>b(new Error("Video load failed")),setTimeout(()=>b(new Error("Video load timeout")),1e4)}),a={video:x,url:y},this.videoElementCache.set(e,a)}const{video:o}=a;o.currentTime=s,await new Promise(y=>{let x=!1;const v=()=>{x||(x=!0,o.removeEventListener("seeked",v),y())};o.addEventListener("seeked",v),o.readyState>=2&&v(),setTimeout(()=>{x||(x=!0,o.removeEventListener("seeked",v),y())},3e3)});const l=new OffscreenCanvas(i,n),d=l.getContext("2d");if(!d)return null;d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high";const u=o.videoWidth/o.videoHeight,h=i/n;let p,m,f,g;return u>h?(p=i,m=i/u,f=0,g=(n-m)/2):(m=n,p=n*u,f=(i-p)/2,g=0),d.fillStyle="#000000",d.fillRect(0,0,i,n),d.drawImage(o,f,g,p,m),createImageBitmap(l)}clearVideoElementCache(){for(const[,e]of this.videoElementCache)e.video.src="",URL.revokeObjectURL(e.url);this.videoElementCache.clear()}ensureInitialized(){if(!this.initialized||!this.mediabunny)throw new Error("VideoEngine not initialized. Call initialize() first.")}async renderFrame(e,t,s,i){this.ensureInitialized();const{timeline:n,mediaLibrary:a,settings:o}=e,l=s??o.width,d=i??o.height,u=l/o.width,h=d/o.height,p=this.getActiveTextClips(n,t),m=this.getActiveShapeClips(n,t),f=this.getActiveSVGClips(n,t),g=this.getActiveStickerClips(n,t),y=this.getActiveSubtitles(n,t),x=n.tracks.map((k,C)=>({track:k,originalIndex:C})).filter(({track:k})=>(k.type==="video"||k.type==="image"||k.type==="text"||k.type==="graphics")&&!k.hidden).sort((k,C)=>C.originalIndex-k.originalIndex),v=new OffscreenCanvas(l,d),b=v.getContext("2d");b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.fillStyle="#000000",b.fillRect(0,0,l,d);for(const{track:k,originalIndex:C}of x)if(k.type==="video"||k.type==="image"){const A=this.getClipsAtTime(k,t);for(const T of A){const j=this.createClipRenderInfo(T,t),_=a.items.find(E=>E.id===j.mediaId);if(!_?.blob)continue;let M=null;if(_.type==="image")try{if(w9(_.blob)){let E=this.gifFrameCache.get(_.id);if(!E){const D=await b9(_.blob);D&&(this.gifFrameCache.set(_.id,D),E=D)}if(E&&E.frames.length>0){const D=t-T.startTime,R=v9(E,D*1e3);M=E.frames[R]}else M=await createImageBitmap(_.blob)}else M=await createImageBitmap(_.blob)}catch(E){console.warn(`Failed to create ImageBitmap for image ${_.id}:`,E)}else M=await this.decodeFrameWithMediaBunny(_.blob,j.sourceTime,o.width,o.height,j.mediaId),M||(M=await this.decodeFrameWithVideoElement(_.id,_.blob,j.sourceTime,o.width,o.height));if(M){let E=j.transform;const D=t-T.startTime;if(T.emphasisAnimation&&T.emphasisAnimation.type!=="none"){const O=this.applyEmphasisAnimation(T.emphasisAnimation,D);E={...E,opacity:E.opacity*O.opacity,scale:{x:E.scale.x*O.scale*O.scaleX,y:E.scale.y*O.scale*O.scaleY},position:{x:E.position.x+O.offsetX*o.width,y:E.position.y+O.offsetY*o.height},rotation:E.rotation+O.rotation}}const R={...E,position:{x:E.position.x*u,y:E.position.y*h},scale:{x:E.scale.x*u,y:E.scale.y*h}};let B=M;if(T.effects&&T.effects.length>0)try{if(!this.effectsEngine){this.effectsEngine=new Su({width:l,height:d,useGPU:!0,preferWebGPU:!1});const F=this.effectsEngine.initialize(),I=new Promise((K,ee)=>setTimeout(()=>ee(new Error("Effects init timeout")),5e3));await Promise.race([F,I])}B=(await this.effectsEngine.applyEffects(M,T.effects)).image}catch(O){console.warn(`Failed to apply effects to clip ${T.id}:`,O),this.effectsEngine=null}this.drawFrameToContext(b,B,R,E.opacity,l,d,T.blendMode),B!==M&&B.close(),M.close()}}}else if(k.type==="graphics"){const A=m.filter(_=>_.trackId===k.id);for(const _ of A)await this.renderShapeClipToCanvasCtx(b,_,t,l,d);const T=f.filter(_=>_.trackId===k.id);for(const _ of T)await this.renderSVGClipToCanvasCtx(b,_,t,l,d);const j=g.filter(_=>_.trackId===k.id);for(const _ of j)await this.renderStickerClipToCanvasCtx(b,_,t,l,d)}else if(k.type==="text"){const A=p.filter(T=>T.trackId===k.id);for(const T of A)this.renderTextClipToCanvasCtx(b,T,t,l,d)}this.renderParticlesToContext(b,t,l,d);for(const k of y)this.renderSubtitleToCanvasCtx(b,k,l,d);const S=await createImageBitmap(v);if(this.compositeBuffer){const k=Math.floor(t*30);this.compositeBuffer.writeCompositedFrame(await createImageBitmap(S),t,k)}return{image:S,timestamp:t,width:l,height:d}}drawFrameToContext(e,t,s,i,n,a,o){if(e.save(),e.globalAlpha=i,o&&o!=="normal"){const u=this.getCanvasBlendMode(o);console.log(`[VideoEngine] Applying blend mode: ${o} -> ${u}`),e.globalCompositeOperation=u}else console.log("[VideoEngine] Using default blend mode (source-over)");const l=n/2,d=a/2;if(e.translate(l+s.position.x,d+s.position.y),e.rotate(s.rotation*Math.PI/180),e.scale(s.scale.x,s.scale.y),s.crop){const u=s.crop.x*t.width,h=s.crop.y*t.height,p=s.crop.width*t.width,m=s.crop.height*t.height,f=p/m,g=n/a;let y,x;f>g?(y=n,x=n/f):(x=a,y=a*f);const v=-y*s.anchor.x,b=-x*s.anchor.y;e.drawImage(t,u,h,p,m,v,b,y,x)}else{const u=-t.width*s.anchor.x,h=-t.height*s.anchor.y;e.drawImage(t,u,h)}e.restore()}getActiveTextClips(e,t){const s=bo.getAllTextClips(),i=e.tracks.filter(a=>a.type==="text"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}getActiveShapeClips(e,t){const s=Sr.getAllShapeClips(),i=e.tracks.filter(a=>a.type==="graphics"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}getActiveSVGClips(e,t){const s=Sr.getAllSVGClips(),i=e.tracks.filter(a=>a.type==="graphics"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}getActiveStickerClips(e,t){const s=Sr.getAllStickerClips(),i=e.tracks.filter(a=>a.type==="graphics"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}renderTextClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=bo.renderText(t,i,n,a);e.drawImage(o.canvas,0,0)}async renderShapeClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=await Sr.renderGraphic(t,a,i,n);o.canvas instanceof OffscreenCanvas,e.drawImage(o.canvas,0,0)}async renderSVGClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=await Sr.renderGraphic(t,a,i,n);o.canvas instanceof OffscreenCanvas,e.drawImage(o.canvas,0,0)}async renderStickerClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=await Sr.renderGraphic(t,a,i,n);o.canvas instanceof OffscreenCanvas,e.drawImage(o.canvas,0,0)}getActiveSubtitles(e,t){return(e.subtitles||[]).filter(i=>t>=i.startTime&&t<i.endTime)}renderParticlesToContext(e,t,s,i){const n=eu();n.setCanvasSize(s,i);const a=this.lastExportTime>=0?Math.max(0,t-this.lastExportTime):1/this.exportFrameRate;this.lastExportTime=t,n.update(t,a);const o=n.getParticles();if(o.length!==0){e.save();for(const l of o){if(!l.active||l.opacity<=0)continue;e.globalAlpha=l.opacity,e.fillStyle=l.color;const d=i-l.position.y;e.beginPath(),e.arc(l.position.x,d,l.size/2,0,Math.PI*2),e.fill()}e.restore()}}resetExportState(){this.lastExportTime=-1,eu().reset()}renderSubtitleToCanvasCtx(e,t,s,i){const{text:n,style:a}=t;if(!n||n.trim().length===0)return;e.save();const o=a?.fontSize||24,l=a?.fontFamily||"Inter",d=a?.color||"#ffffff",u=a?.backgroundColor||"rgba(0, 0, 0, 0.7)",h=a?.position||"bottom";e.font=`bold ${o}px "${l}"`,e.textAlign="center",e.textBaseline="middle";const p=n.split(`
`),m=o*1.3,f=p.length*m;let g;h==="top"?g=o*2:h==="center"?g=i/2-f/2:g=i-o*2-f;for(let y=0;y<p.length;y++){const x=p[y].trim();if(x.length===0)continue;const v=g+y*m+m/2,S=e.measureText(x).width+20,k=m;e.fillStyle=u,e.fillRect(s/2-S/2,v-k/2,S,k),e.fillStyle=d,e.fillText(x,s/2,v)}e.restore()}getClipsAtTime(e,t){return e.clips.filter(s=>{const i=s.startTime+s.duration;return t>=s.startTime&&t<i})}createClipRenderInfo(e,t){const s=t-e.startTime,i=yc(),n=e.inPoint+i.getSourceTimeAtPlaybackTime(e.id,s),a=this.getAnimatedTransform(e,s),o=this.getAnimatedEffects(e,s);return{clipId:e.id,mediaId:e.mediaId,media:null,sourceTime:n,transform:a,effects:o,opacity:a.opacity}}getAnimatedEffects(e,t){const s=e.keyframes||[],i=e.effects||[];if(s.length===0)return i;const n={"effect.brightness":"brightness","effect.contrast":"contrast","effect.saturation":"saturation","effect.blur":"blur"},a={};for(const[o,l]of Object.entries(n)){const d=yi.getKeyframesForProperty(s,o);if(d.length>0){const u=yi.getValueAtTime(d,t);typeof u.value=="number"&&(a[l]=u.value)}}return Object.keys(a).length===0?i:i.map(o=>{const l={...o.params};for(const[d,u]of Object.entries(a))(o.type===d||d in l)&&(l[d]=u);return{...o,params:l}})}getAnimatedTransform(e,t){const s=e.keyframes||[];if(s.length===0)return e.transform;const i=e.transform;let n=i.opacity,a=i.position.x,o=i.position.y,l=i.scale.x,d=i.scale.y,u=i.rotation;const h=yi.getKeyframesForProperty(s,"opacity");if(h.length>0){const x=yi.getValueAtTime(h,t);typeof x.value=="number"&&(n=x.value)}const p=yi.getKeyframesForProperty(s,"position.x");if(p.length>0){const x=yi.getValueAtTime(p,t);typeof x.value=="number"&&(a=x.value)}const m=yi.getKeyframesForProperty(s,"position.y");if(m.length>0){const x=yi.getValueAtTime(m,t);typeof x.value=="number"&&(o=x.value)}const f=yi.getKeyframesForProperty(s,"scale.x");if(f.length>0){const x=yi.getValueAtTime(f,t);typeof x.value=="number"&&(l=x.value)}const g=yi.getKeyframesForProperty(s,"scale.y");if(g.length>0){const x=yi.getValueAtTime(g,t);typeof x.value=="number"&&(d=x.value)}const y=yi.getKeyframesForProperty(s,"rotation");if(y.length>0){const x=yi.getValueAtTime(y,t);typeof x.value=="number"&&(u=x.value)}return{position:{x:a,y:o},scale:{x:l,y:d},rotation:u,opacity:n,anchor:i.anchor,borderRadius:i.borderRadius,fitMode:i.fitMode,crop:i.crop}}applyEmphasisAnimation(e,t){const{type:s,speed:i,intensity:n,loop:a,startTime:o,animationDuration:l}=e,d=o??0;if(t<d)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};if(l!==void 0&&l>0){const m=d+l;if(t>m)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}const u=t-d,h=a?u*i%1:Math.min(u*i,1),p=h*Math.PI*2;switch(s){case"pulse":return{opacity:1,scale:1+Math.sin(p)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":{const m=Math.sin(p*5)*.02*n,f=Math.cos(p*5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:m,offsetY:f,rotation:0}}case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(p))*-.05*n,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(p)*.03*n,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:h*360*n};case"flash":return{opacity:.5+Math.abs(Math.sin(p))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":{const m=h*4;let f=1;return m<1?f=1+.15*n*Math.sin(m*Math.PI):m<2&&(f=1+.1*n*Math.sin((m-1)*Math.PI)),{opacity:1,scale:f,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p)*15*n};case"wobble":{const m=Math.sin(p*3)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(p)*.02*n,offsetY:0,rotation:m}}case"jello":{const m=1+Math.sin(p*2)*.1*n,f=1-Math.sin(p*2)*.1*n;return{opacity:1,scale:1,scaleX:m,scaleY:f,offsetX:0,offsetY:0,rotation:0}}case"rubber-band":{const m=1+Math.sin(p)*.2*n,f=1-Math.sin(p)*.1*n;return{opacity:1,scale:1,scaleX:m,scaleY:f,offsetX:0,offsetY:0,rotation:0}}case"tada":{const m=Math.sin(p*4)*10*n;return{opacity:1,scale:1+Math.sin(p*2)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:m}}case"vibrate":{const m=(Math.random()-.5)*.02*n,f=(Math.random()-.5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:m,offsetY:f,rotation:0}}case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":{const m=1+Math.sin(p)*.05*n;return{opacity:.8+Math.sin(p)*.2,scale:m,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"breathe":return{opacity:1,scale:1+Math.sin(p*.5)*.08*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":{const m=Math.sin(p+u*2)*.03*n,f=Math.sin(p)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:m,rotation:f}}case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p*.5)*10*n};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(p)*.15*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const m=e.focusPoint||{x:.5,y:.5},f=e.zoomScale||1.5,g=e.holdDuration||.3,y=.3,x=1-g-y;let v=1,b=0,S=0;if(h<y){const k=h/y,C=1-Math.pow(1-k,3);v=1+(f-1)*C*n,b=(.5-m.x)*(v-1),S=(.5-m.y)*(v-1)}else if(h<y+g)v=f*n,b=(.5-m.x)*(v-1),S=(.5-m.y)*(v-1);else{const k=(h-y-g)/x,C=Math.pow(k,3);v=f-(f-1)*C*n,b=(.5-m.x)*(v-1),S=(.5-m.y)*(v-1)}return{opacity:1,scale:v,scaleX:1,scaleY:1,offsetX:b,offsetY:S,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-h*.2*n,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:h*.2*n,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-h*.2*n,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:h*.2*n,rotation:0};case"ken-burns":{const m=1+h*.3*n,f=h*.1*n,g=h*.05*n;return{opacity:1,scale:m,scaleX:1,scaleY:1,offsetX:f,offsetY:g,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}}async decodeFrame(e,t){if(!e.blob)return console.warn(`No blob available for media item ${e.id}`),null;if(e.type==="image")try{return await createImageBitmap(e.blob)}catch(l){return console.warn(`Failed to create ImageBitmap from image: ${l}`),null}this.ensureInitialized();const{Input:s,ALL_FORMATS:i,BlobSource:n,VideoSampleSink:a}=this.mediabunny,o=new s({source:new n(e.blob),formats:i});try{const l=await o.getPrimaryVideoTrack();if(!l)return null;if(!await l.canDecode())return console.warn(`Cannot decode video track for media ${e.id}`),null;const h=await new a(l).getSample(t);if(!h)return null;let p;try{const m=typeof h.toVideoFrame=="function",f=m?h.toVideoFrame():h;p=await createImageBitmap(f),m&&f!==h&&f.close()}catch{const m=new OffscreenCanvas(h.displayWidth,h.displayHeight),f=m.getContext("2d"),g=typeof h.draw=="function";if(f&&g)h.draw(f,0,0),p=await createImageBitmap(m);else return h.close(),null}return h.close(),p}finally{o[Symbol.dispose]?.()}}async decodeFrameToCanvas(e,t,s,i){this.ensureInitialized();const{Input:n,ALL_FORMATS:a,BlobSource:o,CanvasSink:l}=this.mediabunny;if(!e.blob)return null;const d=new n({source:new o(e.blob),formats:a});try{const u=await d.getPrimaryVideoTrack();if(!u||!await u.canDecode())return null;const p={poolSize:1,fit:"contain"};s&&(p.width=s),i&&(p.height=i);const f=await new l(u,p).getCanvas(t);if(!f)return null;const g=new OffscreenCanvas(f.canvas.width,f.canvas.height),y=g.getContext("2d");return y&&y.drawImage(f.canvas,0,0),g}finally{d[Symbol.dispose]?.()}}async compositeFrame(e,t,s){if(!this.compositeCtx)return;const i=this.compositeCtx,n=this.compositeCanvas.width,a=this.compositeCanvas.height;i.save(),i.globalAlpha=s;const o=n/2,l=a/2;if(i.translate(o+t.position.x,l+t.position.y),i.rotate(t.rotation*Math.PI/180),i.scale(t.scale.x,t.scale.y),t.crop){const d=t.crop.x*e.width,u=t.crop.y*e.height,h=t.crop.width*e.width,p=t.crop.height*e.height,m=h/p,f=n/a;let g,y;m>f?(g=n,y=n/m):(y=a,g=a*m);const x=-g*t.anchor.x,v=-y*t.anchor.y;i.drawImage(e,d,u,h,p,x,v,g,y)}else{const d=-e.width*t.anchor.x,u=-e.height*t.anchor.y;i.drawImage(e,d,u)}i.restore()}async composite(e,t,s){this.ensureCompositeCanvas(t,s);const i=this.compositeCtx;i.clearRect(0,0,t,s);for(const n of e)n.visible&&(i.save(),i.globalCompositeOperation=this.getCanvasBlendMode(n.blendMode),await this.compositeFrame(n.image instanceof ImageBitmap?n.image:await createImageBitmap(n.image),n.transform,n.transform.opacity),i.restore());return createImageBitmap(this.compositeCanvas)}getCanvasBlendMode(e){return{normal:"source-over",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","color-dodge":"color-dodge","color-burn":"color-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"}[e]||"source-over"}ensureCompositeCanvas(e,t){(!this.compositeCanvas||this.compositeCanvas.width!==e||this.compositeCanvas.height!==t)&&(this.compositeCanvas=new OffscreenCanvas(e,t),this.compositeCtx=this.compositeCanvas.getContext("2d"))}getCacheKey(e,t){const s=Math.round(t*30)/30;return`${e}:${s.toFixed(4)}`}cacheFrame(e,t,s){const i=t.width*t.height*4;this.evictIfNeeded(i),this.frameCache.set(e,{image:t,timestamp:parseFloat(e.split(":")[1]),mediaId:s,width:t.width,height:t.height,sizeBytes:i,lastAccessed:Date.now()})}evictIfNeeded(e){for(;this.frameCache.size>=this.cacheConfig.maxFrames;)this.evictOldestFrame();let t=this.getTotalCacheSize();for(;t+e>this.cacheConfig.maxSizeBytes&&this.frameCache.size>0;)this.evictOldestFrame(),t=this.getTotalCacheSize()}evictOldestFrame(){let e="",t=1/0;for(const[s,i]of this.frameCache.entries())i.lastAccessed<t&&(t=i.lastAccessed,e=s);if(e){const s=this.frameCache.get(e);s&&s.image.close(),this.frameCache.delete(e)}}getTotalCacheSize(){let e=0;for(const t of this.frameCache.values())e+=t.sizeBytes;return e}getCacheStats(){const e=this.cacheStats.hits+this.cacheStats.misses;return{entries:this.frameCache.size,sizeBytes:this.getTotalCacheSize(),hitRate:e>0?this.cacheStats.hits/e:0,maxSizeBytes:this.cacheConfig.maxSizeBytes,hits:this.cacheStats.hits,misses:this.cacheStats.misses}}clearCache(){for(const e of this.frameCache.values())e.image.close();this.frameCache.clear(),this.cacheStats={hits:0,misses:0}}async preloadFrames(e,t,s=30){if(this.ensureInitialized(),!e.blob)return;const i=1/s,n=Math.max(0,t-this.cacheConfig.preloadBehind*i),a=Math.min(e.metadata.duration,t+this.cacheConfig.preloadAhead*i),{Input:o,ALL_FORMATS:l,BlobSource:d,VideoSampleSink:u}=this.mediabunny,h=new o({source:new d(e.blob),formats:l});try{const p=await h.getPrimaryVideoTrack();if(!p||!await p.canDecode())return;const f=new u(p),g=[];for(let y=n;y<=a;y+=i){const x=this.getCacheKey(e.id,y);this.frameCache.has(x)||g.push(y)}for await(const y of f.samplesAtTimestamps(g)){if(!y)continue;const x=await createImageBitmap(y),v=this.getCacheKey(e.id,y.timestamp/1e6);this.cacheFrame(v,x,e.id),y.close()}}finally{h[Symbol.dispose]?.()}}queuePreload(e){this.preloadQueue=this.preloadQueue.filter(t=>t.mediaId!==e.mediaId),this.preloadQueue.push(e),this.preloadQueue.sort((t,s)=>s.priority-t.priority),this.processPreloadQueue()}async processPreloadQueue(){if(!(this.isPreloading||this.preloadQueue.length===0)){for(this.isPreloading=!0;this.preloadQueue.length>0;){const e=this.preloadQueue.shift();try{await this.preloadFramesRange(e.media,e.mediaId,e.startTime,e.endTime,e.frameRate)}catch(t){console.warn(`Preload failed for media ${e.mediaId}:`,t)}}this.isPreloading=!1}}async preloadFramesRange(e,t,s,i,n){this.ensureInitialized();const{Input:a,ALL_FORMATS:o,BlobSource:l,VideoSampleSink:d}=this.mediabunny,u=new a({source:new l(e),formats:o});try{const h=await u.getPrimaryVideoTrack();if(!h||!await h.canDecode())return;const m=new d(h),f=1/n,g=[];for(let y=s;y<=i;y+=f){const x=this.getCacheKey(t,y);this.frameCache.has(x)||g.push(y)}for await(const y of m.samplesAtTimestamps(g)){if(!y)continue;const x=await createImageBitmap(y),v=this.getCacheKey(t,y.timestamp/1e6);this.cacheFrame(v,x,t),y.close()}}finally{u[Symbol.dispose]?.()}}async getSupportedCodecs(){this.ensureInitialized();const{getEncodableVideoCodecs:e,getEncodableAudioCodecs:t}=this.mediabunny;try{const[s,i]=await Promise.all([e(),t()]);return{decode:["avc","hevc","vp8","vp9","av1"],encode:[...s,...i],hardware:!0}}catch{return{decode:[],encode:[],hardware:!1}}}isFormatSupported(e){return["video/mp4","video/webm","video/quicktime","video/x-matroska"].includes(e)}getAvailableFilters(){return[{type:"brightness",name:"Brightness",category:"color",gpuAccelerated:!0},{type:"contrast",name:"Contrast",category:"color",gpuAccelerated:!0},{type:"saturation",name:"Saturation",category:"color",gpuAccelerated:!0},{type:"hue",name:"Hue Rotation",category:"color",gpuAccelerated:!0},{type:"blur",name:"Blur",category:"blur",gpuAccelerated:!0},{type:"sharpen",name:"Sharpen",category:"blur",gpuAccelerated:!0},{type:"vignette",name:"Vignette",category:"stylize",gpuAccelerated:!0},{type:"grain",name:"Film Grain",category:"stylize",gpuAccelerated:!0},{type:"chromaKey",name:"Chroma Key",category:"keying",gpuAccelerated:!0}]}async applyFilter(e,t){const s=new OffscreenCanvas(e.width,e.height),i=s.getContext("2d");if(!i)return e;i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(e,0,0);const n=this.buildFilterString(t);return n&&(i.filter=n,i.drawImage(s,0,0)),createImageBitmap(s)}buildFilterString(e){if(!e.enabled)return"";const t=e.params;switch(e.type){case"brightness":return`brightness(${1+(t.value||0)})`;case"contrast":return`contrast(${t.value||1})`;case"saturation":return`saturate(${t.value||1})`;case"hue":return`hue-rotate(${t.rotation||0}deg)`;case"blur":return`blur(${t.radius||0}px)`;default:return""}}dispose(){this.clearCache(),this.clearVideoElementCache(),this.compositeCanvas=null,this.compositeCtx=null,this.preloadQueue=[],this.initialized=!1,this.mediabunny=null}}let Af=null;function vM(){return Af||(Af=new lW),Af}const J0={shadows:{r:0,g:0,b:0},midtones:{r:0,g:0,b:0},highlights:{r:0,g:0,b:0},shadowsLift:0,midtonesGamma:1,highlightsGain:1},Z0={rgb:[{x:0,y:0},{x:1,y:1}],red:[{x:0,y:0},{x:1,y:1}],green:[{x:0,y:0},{x:1,y:1}],blue:[{x:0,y:0},{x:1,y:1}]},ey={hue:[0,0,0,0,0,0,0,0],saturation:[0,0,0,0,0,0,0,0],luminance:[0,0,0,0,0,0,0,0]},Ju=`#version 300 es
precision highp float;

in vec2 a_position;
in vec2 a_texCoord;

out vec2 v_texCoord;

void main() {
 gl_Position = vec4(a_position, 0.0, 1.0);
 v_texCoord = a_texCoord;
}
`,dW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec3 u_shadows;
uniform vec3 u_midtones;
uniform vec3 u_highlights;
uniform float u_shadowsLift;
uniform float u_midtonesGamma;
uniform float u_highlightsGain;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float luma = dot(color.rgb, vec3(0.299, 0.587, 0.114));
 float shadowWeight = 1.0 - smoothstep(0.0, 0.5, luma);
 float highlightWeight = smoothstep(0.5, 1.0, luma);
 float midtoneWeight = 1.0 - shadowWeight - highlightWeight;
 vec3 rgb = color.rgb;
 rgb += u_shadows * shadowWeight;
 rgb += u_midtones * midtoneWeight;
 rgb += u_highlights * highlightWeight;
 rgb = rgb + u_shadowsLift * shadowWeight;
 rgb = pow(rgb, vec3(1.0 / u_midtonesGamma));
 rgb = rgb * (1.0 + (u_highlightsGain - 1.0) * highlightWeight);
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,uW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform sampler2D u_curveLUT;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float r = texture(u_curveLUT, vec2(color.r, 0.125)).r;
 float g = texture(u_curveLUT, vec2(color.g, 0.375)).r;
 float b = texture(u_curveLUT, vec2(color.b, 0.625)).r;
 float masterR = texture(u_curveLUT, vec2(r, 0.875)).r;
 float masterG = texture(u_curveLUT, vec2(g, 0.875)).r;
 float masterB = texture(u_curveLUT, vec2(b, 0.875)).r;
 
 fragColor = vec4(masterR, masterG, masterB, color.a);
}
`,hW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_hue[8];
uniform float u_saturation[8];
uniform float u_luminance[8];

vec3 rgb2hsl(vec3 c) {
 float maxC = max(max(c.r, c.g), c.b);
 float minC = min(min(c.r, c.g), c.b);
 float l = (maxC + minC) / 2.0;
 
 if (maxC == minC) {
 return vec3(0.0, 0.0, l);
 }
 
 float d = maxC - minC;
 float s = l > 0.5 ? d / (2.0 - maxC - minC) : d / (maxC + minC);
 
 float h;
 if (maxC == c.r) {
 h = (c.g - c.b) / d + (c.g < c.b ? 6.0 : 0.0);
 } else if (maxC == c.g) {
 h = (c.b - c.r) / d + 2.0;
 } else {
 h = (c.r - c.g) / d + 4.0;
 }
 h /= 6.0;
 
 return vec3(h, s, l);
}

float hue2rgb(float p, float q, float t) {
 if (t < 0.0) t += 1.0;
 if (t > 1.0) t -= 1.0;
 if (t < 1.0/6.0) return p + (q - p) * 6.0 * t;
 if (t < 1.0/2.0) return q;
 if (t < 2.0/3.0) return p + (q - p) * (2.0/3.0 - t) * 6.0;
 return p;
}

vec3 hsl2rgb(vec3 hsl) {
 if (hsl.y == 0.0) {
 return vec3(hsl.z);
 }
 
 float q = hsl.z < 0.5 ? hsl.z * (1.0 + hsl.y) : hsl.z + hsl.y - hsl.z * hsl.y;
 float p = 2.0 * hsl.z - q;
 
 float r = hue2rgb(p, q, hsl.x + 1.0/3.0);
 float g = hue2rgb(p, q, hsl.x);
 float b = hue2rgb(p, q, hsl.x - 1.0/3.0);
 
 return vec3(r, g, b);
}

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 hsl = rgb2hsl(color.rgb);
 
 // Determine which hue range this pixel falls into (8 ranges)
 int hueIndex = int(hsl.x * 8.0) % 8;
 hsl.x = fract(hsl.x + u_hue[hueIndex] / 360.0);
 hsl.y = clamp(hsl.y + u_saturation[hueIndex], 0.0, 1.0);
 hsl.z = clamp(hsl.z + u_luminance[hueIndex], 0.0, 1.0);
 
 vec3 rgb = hsl2rgb(hsl);
 fragColor = vec4(rgb, color.a);
}
`,pW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform sampler2D u_lut;
uniform float u_lutSize;
uniform float u_intensity;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 
 // 3D LUT lookup (stored as 2D texture)
 float blueSlice = color.b * (u_lutSize - 1.0);
 float blueSliceFloor = floor(blueSlice);
 float blueSliceCeil = ceil(blueSlice);
 float blueFrac = blueSlice - blueSliceFloor;

 
 vec2 quad1 = vec2(
 (blueSliceFloor + color.r) / u_lutSize,
 color.g
 );
 vec2 quad2 = vec2(
 (blueSliceCeil + color.r) / u_lutSize,
 color.g
 );
 
 vec3 lutColor1 = texture(u_lut, quad1).rgb;
 vec3 lutColor2 = texture(u_lut, quad2).rgb;
 vec3 lutColor = mix(lutColor1, lutColor2, blueFrac);
 
 // Mix with original based on intensity
 vec3 result = mix(color.rgb, lutColor, u_intensity);
 fragColor = vec4(result, color.a);
}
`;class mW{canvas=null;gl=null;shaders=new Map;quadBuffer=null;texCoordBuffer=null;curveLUTTexture=null;width;height;initialized=!1;constructor(e=1920,t=1080){this.width=e,this.height=t}initialize(){if(this.initialized)return;this.canvas=new OffscreenCanvas(this.width,this.height);const e=this.canvas.getContext("webgl2",{preserveDrawingBuffer:!0,premultipliedAlpha:!0,alpha:!0});if(!e)throw new Error("WebGL2 not supported");this.gl=e,this.quadBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),this.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),e.STATIC_DRAW),this.compileShader("colorWheels",Ju,dW),this.compileShader("curves",Ju,uW),this.compileShader("hsl",Ju,hW),this.compileShader("lut",Ju,pW),this.initialized=!0}compileShader(e,t,s){const i=this.gl,n=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error(`Vertex shader error: ${i.getShaderInfoLog(n)}`);const a=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(a,s),i.compileShader(a),!i.getShaderParameter(a,i.COMPILE_STATUS))throw new Error(`Fragment shader error: ${i.getShaderInfoLog(a)}`);const o=i.createProgram();if(i.attachShader(o,n),i.attachShader(o,a),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw new Error(`Program link error: ${i.getProgramInfoLog(o)}`);const l=new Map,d=i.getProgramParameter(o,i.ACTIVE_UNIFORMS);for(let p=0;p<d;p++){const m=i.getActiveUniform(o,p);if(m){const f=i.getUniformLocation(o,m.name);f&&l.set(m.name,f)}}const u=new Map,h=i.getProgramParameter(o,i.ACTIVE_ATTRIBUTES);for(let p=0;p<h;p++){const m=i.getActiveAttrib(o,p);m&&u.set(m.name,i.getAttribLocation(o,m.name))}this.shaders.set(e,{program:o,uniforms:l,attributes:u}),i.deleteShader(n),i.deleteShader(a)}async applyColorWheels(e,t){const s=performance.now();this.ensureInitialized();const i=this.gl,n=this.shaders.get("colorWheels"),a=this.uploadTexture(e);i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,this.width,this.height),i.useProgram(n.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a);const o=n.uniforms.get("u_texture");o&&i.uniform1i(o,0);const l=n.uniforms.get("u_shadows"),d=n.uniforms.get("u_midtones"),u=n.uniforms.get("u_highlights"),h=n.uniforms.get("u_shadowsLift"),p=n.uniforms.get("u_midtonesGamma"),m=n.uniforms.get("u_highlightsGain");return l&&i.uniform3f(l,t.shadows.r,t.shadows.g,t.shadows.b),d&&i.uniform3f(d,t.midtones.r,t.midtones.g,t.midtones.b),u&&i.uniform3f(u,t.highlights.r,t.highlights.g,t.highlights.b),h&&i.uniform1f(h,t.shadowsLift),p&&i.uniform1f(p,t.midtonesGamma),m&&i.uniform1f(m,t.highlightsGain),this.setupVertexAttributes(n),i.drawArrays(i.TRIANGLE_STRIP,0,4),i.deleteTexture(a),{image:await createImageBitmap(this.canvas),processingTime:performance.now()-s}}async applyCurves(e,t){const s=performance.now();this.ensureInitialized();const i=new OffscreenCanvas(e.width,e.height),n=i.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,e.width,e.height),o=a.data,l=this.buildCurveLUT(t.rgb),d=this.buildCurveLUT(t.red),u=this.buildCurveLUT(t.green),h=this.buildCurveLUT(t.blue);for(let m=0;m<o.length;m+=4){let f=d[o[m]],g=u[o[m+1]],y=h[o[m+2]];o[m]=l[f],o[m+1]=l[g],o[m+2]=l[y]}return n.putImageData(a,0,0),{image:await createImageBitmap(i),processingTime:performance.now()-s}}buildCurveLUT(e){const t=new Uint8Array(256),s=[...e].sort((i,n)=>i.x-n.x);if((s.length===0||s[0].x>0)&&s.unshift({x:0,y:0}),s[s.length-1].x<1&&s.push({x:1,y:1}),s.length===2){for(let i=0;i<256;i++){const a=(i/255-s[0].x)/(s[1].x-s[0].x),o=s[0].y+a*(s[1].y-s[0].y);t[i]=Math.round(Math.max(0,Math.min(255,o*255)))}return t}for(let i=0;i<256;i++){const n=i/255;let a=n;for(let o=0;o<s.length-1;o++)if(n>=s[o].x&&n<=s[o+1].x){const l=o>0?s[o-1]:s[o],d=s[o],u=s[o+1],h=o+2<s.length?s[o+2]:s[o+1],p=(n-d.x)/(u.x-d.x),m=p*p,f=m*p;a=.5*(2*d.y+(-l.y+u.y)*p+(2*l.y-5*d.y+4*u.y-h.y)*m+(-l.y+3*d.y-3*u.y+h.y)*f);break}t[i]=Math.round(Math.max(0,Math.min(255,a*255)))}return t}async applyLUT(e,t){const s=performance.now(),i=new OffscreenCanvas(e.width,e.height),n=i.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,e.width,e.height),o=a.data,l=t.size,d=t.data;for(let h=0;h<o.length;h+=4){const p=o[h]/255,m=o[h+1]/255,f=o[h+2]/255,g=p*(l-1),y=m*(l-1),x=f*(l-1),v=Math.floor(g),b=Math.floor(y),S=Math.floor(x),k=Math.min(v+1,l-1),C=Math.min(b+1,l-1),A=Math.min(S+1,l-1),T=g-v,j=y-b,_=x-S,M=(O,F,I,K)=>{const ee=(I*l*l+F*l+O)*3+K;return d[ee]/255},E=O=>{const F=M(v,b,S,O)*(1-T)+M(k,b,S,O)*T,I=M(v,b,A,O)*(1-T)+M(k,b,A,O)*T,K=M(v,C,S,O)*(1-T)+M(k,C,S,O)*T,ee=M(v,C,A,O)*(1-T)+M(k,C,A,O)*T,P=F*(1-j)+K*j,W=I*(1-j)+ee*j;return P*(1-_)+W*_},D=E(0),R=E(1),B=E(2);o[h]=Math.round((p*(1-t.intensity)+D*t.intensity)*255),o[h+1]=Math.round((m*(1-t.intensity)+R*t.intensity)*255),o[h+2]=Math.round((f*(1-t.intensity)+B*t.intensity)*255)}return n.putImageData(a,0,0),{image:await createImageBitmap(i),processingTime:performance.now()-s}}async applyHSL(e,t){const s=performance.now(),i=new OffscreenCanvas(e.width,e.height),n=i.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,e.width,e.height),o=a.data;for(let d=0;d<o.length;d+=4){const u=o[d]/255,h=o[d+1]/255,p=o[d+2]/255,m=this.rgbToHsl(u,h,p),f=Math.floor(m.h*8)%8;m.h=(m.h+t.hue[f]/360+1)%1,m.s=Math.max(0,Math.min(1,m.s+t.saturation[f])),m.l=Math.max(0,Math.min(1,m.l+t.luminance[f]));const g=this.hslToRgb(m.h,m.s,m.l);o[d]=Math.round(g.r*255),o[d+1]=Math.round(g.g*255),o[d+2]=Math.round(g.b*255)}return n.putImageData(a,0,0),{image:await createImageBitmap(i),processingTime:performance.now()-s}}async generateWaveform(e){const s=new OffscreenCanvas(e.width,e.height).getContext("2d");s.drawImage(e,0,0);const n=s.getImageData(0,0,e.width,e.height).data,a=e.width,o=e.height,l=256,d=new Uint8Array(a*l),u=new Uint8Array(a*l),h=new Uint8Array(a*l),p=new Uint8Array(a*l);for(let m=0;m<a;m++)for(let f=0;f<o;f++){const g=(f*a+m)*4,y=n[g],x=n[g+1],v=n[g+2],b=Math.round(.299*y+.587*x+.114*v);d[b*a+m]++,u[y*a+m]++,h[x*a+m]++,p[v*a+m]++}return{luminance:d,red:u,green:h,blue:p,width:a,height:l}}async generateVectorscope(e,t=256){const i=new OffscreenCanvas(e.width,e.height).getContext("2d");i.drawImage(e,0,0);const a=i.getImageData(0,0,e.width,e.height).data,o=new Uint8Array(t*t),l=t/2;for(let d=0;d<a.length;d+=4){const u=a[d]/255,h=a[d+1]/255,p=a[d+2]/255,m=-.14713*u-.28886*h+.436*p,f=.615*u-.51499*h-.10001*p,g=Math.round(l+m*l*2),y=Math.round(l-f*l*2);if(g>=0&&g<t&&y>=0&&y<t){const x=y*t+g;o[x]=Math.min(255,o[x]+1)}}return{data:o,size:t}}async generateHistogram(e){const s=new OffscreenCanvas(e.width,e.height).getContext("2d");s.drawImage(e,0,0);const n=s.getImageData(0,0,e.width,e.height).data,a=new Uint32Array(256),o=new Uint32Array(256),l=new Uint32Array(256),d=new Uint32Array(256);for(let u=0;u<n.length;u+=4){const h=n[u],p=n[u+1],m=n[u+2],f=Math.round(.299*h+.587*p+.114*m);a[h]++,o[p]++,l[m]++,d[f]++}return{red:a,green:o,blue:l,luminance:d}}rgbToHsl(e,t,s){const i=Math.max(e,t,s),n=Math.min(e,t,s),a=(i+n)/2;if(i===n)return{h:0,s:0,l:a};const o=i-n,l=a>.5?o/(2-i-n):o/(i+n);let d;return i===e?d=((t-s)/o+(t<s?6:0))/6:i===t?d=((s-e)/o+2)/6:d=((e-t)/o+4)/6,{h:d,s:l,l:a}}hslToRgb(e,t,s){if(t===0)return{r:s,g:s,b:s};const i=s<.5?s*(1+t):s+t-s*t,n=2*s-i,a=o=>(o<0&&(o+=1),o>1&&(o-=1),o<1/6?n+(i-n)*6*o:o<1/2?i:o<2/3?n+(i-n)*(2/3-o)*6:n);return{r:a(e+1/3),g:a(e),b:a(e-1/3)}}uploadTexture(e){const t=this.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s}setupVertexAttributes(e){const t=this.gl,s=e.attributes.get("a_position");s!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0));const i=e.attributes.get("a_texCoord");i!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffer),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0))}ensureInitialized(){this.initialized||this.initialize()}dispose(){if(this.gl){for(const e of this.shaders.values())this.gl.deleteProgram(e.program);this.shaders.clear(),this.quadBuffer&&this.gl.deleteBuffer(this.quadBuffer),this.texCoordBuffer&&this.gl.deleteBuffer(this.texCoordBuffer),this.curveLUTTexture&&this.gl.deleteTexture(this.curveLUTTexture)}this.canvas=null,this.gl=null,this.initialized=!1}}class fW{canvas=null;ctx=null;width;height;initialized=!1;constructor(e){this.width=e.width,this.height=e.height,this.initializeCanvas()}initializeCanvas(){if(!this.initialized){try{typeof OffscreenCanvas<"u"&&(this.canvas=new OffscreenCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d"))}catch{this.canvas=null,this.ctx=null}this.initialized=!0}}getContext(){if(!this.ctx)throw new Error("Canvas context not available");return this.ctx}async renderTransition(e,t,s,i){const n=performance.now();if(!this.canvas||!this.ctx)throw new Error("Canvas not available. Rendering requires a browser environment.");const a=Math.max(0,Math.min(1,i)),o=this.applyEasing(a,s.params.curve);switch(this.ctx.clearRect(0,0,this.width,this.height),s.type){case"crossfade":await this.renderCrossfade(e,t,o);break;case"dipToBlack":await this.renderDipToColor(e,t,o,"black",s.params.holdDuration||0);break;case"dipToWhite":await this.renderDipToColor(e,t,o,"white",s.params.holdDuration||0);break;case"wipe":await this.renderWipe(e,t,o,s.params.direction||"left",s.params.softness||0);break;case"slide":await this.renderSlide(e,t,o,s.params.direction||"left",s.params.pushOut||!1);break;case"zoom":await this.renderZoom(e,t,o,s.params.scale||2,s.params.center||{x:.5,y:.5});break;case"push":await this.renderPush(e,t,o,s.params.direction||"left");break;default:await this.renderCrossfade(e,t,o)}return{frame:await createImageBitmap(this.canvas),processingTime:performance.now()-n,gpuAccelerated:!1}}async renderCrossfade(e,t,s){const i=this.getContext();i.globalAlpha=1-s,i.drawImage(e,0,0,this.width,this.height),i.globalAlpha=s,i.drawImage(t,0,0,this.width,this.height),i.globalAlpha=1}async renderDipToColor(e,t,s,i,n){const a=2+n,o=1/a,l=(1+n)/a,d=this.getContext();if(s<o){const u=s/o;d.drawImage(e,0,0,this.width,this.height),d.fillStyle=i,d.globalAlpha=u,d.fillRect(0,0,this.width,this.height),d.globalAlpha=1}else if(s<l)d.fillStyle=i,d.fillRect(0,0,this.width,this.height);else{const u=(s-l)/(1-l);d.fillStyle=i,d.fillRect(0,0,this.width,this.height),d.globalAlpha=u,d.drawImage(t,0,0,this.width,this.height),d.globalAlpha=1}}async renderWipe(e,t,s,i,n){const a=this.getContext();a.drawImage(e,0,0,this.width,this.height),a.save();const o=n*Math.max(this.width,this.height)*.1;switch(i){case"left":this.createWipeClip(a,s*this.width,0,this.width,this.height);break;case"right":this.createWipeClip(a,0,0,this.width*(1-s),this.height,!0);break;case"up":this.createWipeClip(a,0,s*this.height,this.width,this.height);break;case"down":this.createWipeClip(a,0,0,this.width,this.height*(1-s),!0);break;case"diagonal":this.createDiagonalWipeClip(a,s);break;default:this.createWipeClip(a,s*this.width,0,this.width,this.height)}n>0&&o>0&&(a.globalAlpha=.8),a.drawImage(t,0,0,this.width,this.height),a.restore()}createWipeClip(e,t,s,i,n,a=!1){e.beginPath(),a?e.rect(i,s,this.width-i,n):e.rect(t,s,i-t,n-s),e.clip()}createDiagonalWipeClip(e,t){const s=(this.width+this.height)*t;e.beginPath(),e.moveTo(s,0),e.lineTo(s-this.height,this.height),e.lineTo(this.width,this.height),e.lineTo(this.width,0),e.closePath(),e.clip()}async renderSlide(e,t,s,i,n){const a=this.getContext();let o=0,l=0,d=0,u=0;switch(i){case"left":d=this.width*(1-s),n&&(o=-this.width*s);break;case"right":d=-this.width*(1-s),n&&(o=this.width*s);break;case"up":u=this.height*(1-s),n&&(l=-this.height*s);break;case"down":u=-this.height*(1-s),n&&(l=this.height*s);break}(n||s<1)&&a.drawImage(e,o,l,this.width,this.height),a.drawImage(t,d,u,this.width,this.height)}async renderZoom(e,t,s,i,n){const a=1+(i-1)*s,o=1-s,l=1/i+(1-1/i)*s,d=s,u=this.width*n.x,h=this.height*n.y,p=this.getContext();p.save(),p.globalAlpha=o,p.translate(u,h),p.scale(a,a),p.translate(-u,-h),p.drawImage(e,0,0,this.width,this.height),p.restore(),p.save(),p.globalAlpha=d,p.translate(u,h),p.scale(l,l),p.translate(-u,-h),p.drawImage(t,0,0,this.width,this.height),p.restore()}async renderPush(e,t,s,i){await this.renderSlide(e,t,s,i,!0)}applyEasing(e,t){const s={linear:n=>n,ease:n=>n*n*(3-2*n),"ease-in":n=>n*n,"ease-out":n=>n*(2-n),"ease-in-out":n=>n<.5?2*n*n:-1+(4-2*n)*n};return(s[t||"linear"]||s.linear)(e)}validateTransition(e,t,s){const i=e.startTime+e.duration;if(Math.abs(t.startTime-i)>.001)return{valid:!1,error:"Clips must be adjacent to add a transition"};if(e.trackId!==t.trackId)return{valid:!1,error:"Clips must be on the same track"};const a=e.outPoint-e.duration,o=t.inPoint,l=e.duration+a,d=t.duration+o,u=Math.min(e.duration,t.duration,l,d);return s>u?{valid:!0,warning:`Insufficient handle frames. Maximum transition duration is ${u.toFixed(2)}s`,maxDuration:u}:s<=0?{valid:!1,error:"Transition duration must be positive"}:{valid:!0,maxDuration:u}}areClipsAdjacent(e,t){if(e.trackId!==t.trackId)return!1;const s=e.startTime+e.duration;return Math.abs(t.startTime-s)<.001}findAdjacentClipPairs(e){const t=[],s=[...e.clips].sort((i,n)=>i.startTime-n.startTime);for(let i=0;i<s.length-1;i++){const n=s[i],a=s[i+1];this.areClipsAdjacent(n,a)&&t.push({clipA:n,clipB:a})}return t}createTransition(e,t,s,i,n){const a=this.validateTransition(e,t,i);if(!a.valid&&!a.warning)return null;const o=a.maxDuration?Math.min(i,a.maxDuration):i,l=this.getDefaultParams(s);return{id:`transition-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,clipAId:e.id,clipBId:t.id,type:s,duration:o,params:{...l,...n}}}getDefaultParams(e){switch(e){case"crossfade":return{curve:"ease"};case"dipToBlack":return{holdDuration:.1};case"dipToWhite":return{holdDuration:.1};case"wipe":return{direction:"left",softness:0};case"slide":return{direction:"left",pushOut:!1};case"zoom":return{scale:2,center:{x:.5,y:.5}};case"push":return{direction:"left"};default:return{}}}updateTransitionDuration(e,t,s,i){const n=this.validateTransition(t,s,i),a=n.maxDuration?Math.min(i,n.maxDuration):i;return{...e,duration:a}}removeTransition(e,t){return{...e,transitions:e.transitions.filter(s=>s.id!==t)}}calculateTransitionProgress(e,t,s){const i=t.startTime+t.duration-e.duration/2,n=i+e.duration;return s<=i?0:s>=n?1:(s-i)/e.duration}isTimeInTransition(e,t,s){const i=t.startTime+t.duration-e.duration/2,n=i+e.duration;return s>=i&&s<=n}resize(e,t){if(this.width=e,this.height=t,typeof OffscreenCanvas<"u")try{this.canvas=new OffscreenCanvas(e,t),this.ctx=this.canvas.getContext("2d")}catch{}}getAvailableTransitionTypes(){return["crossfade","dipToBlack","dipToWhite","wipe","slide","zoom","push"]}dispose(){this.ctx&&this.ctx.clearRect(0,0,this.width,this.height),this.canvas=null,this.ctx=null}}function wM(r=1920,e=1080){return new fW({width:r,height:e})}function jf(){return`mask-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}function gW(r){switch(r.type){case"rectangle":{const{x:e,y:t,width:s,height:i}=r;return{points:[{x:e,y:t},{x:e+s,y:t},{x:e+s,y:t+i},{x:e,y:t+i}],closed:!0}}case"ellipse":{const{cx:e,cy:t,rx:s,ry:i}=r,n=.5522847498;return{points:[{x:e,y:t-i,handleIn:{x:e-s*n,y:t-i},handleOut:{x:e+s*n,y:t-i}},{x:e+s,y:t,handleIn:{x:e+s,y:t-i*n},handleOut:{x:e+s,y:t+i*n}},{x:e,y:t+i,handleIn:{x:e+s*n,y:t+i},handleOut:{x:e-s*n,y:t+i}},{x:e-s,y:t,handleIn:{x:e-s,y:t+i*n},handleOut:{x:e-s,y:t-i*n}}],closed:!0}}case"polygon":return{points:r.points.map(e=>({x:e.x,y:e.y})),closed:!0}}}function yW(r,e,t){t=Math.max(0,Math.min(1,t));const s=Math.max(r.points.length,e.points.length),i=[];for(let n=0;n<s;n++){const a=r.points[n%r.points.length],o=e.points[n%e.points.length],l={x:a.x+(o.x-a.x)*t,y:a.y+(o.y-a.y)*t};if(a.handleIn||o.handleIn){const d=a.handleIn||{x:a.x,y:a.y},u=o.handleIn||{x:o.x,y:o.y};l.handleIn={x:d.x+(u.x-d.x)*t,y:d.y+(u.y-d.y)*t}}if(a.handleOut||o.handleOut){const d=a.handleOut||{x:a.x,y:a.y},u=o.handleOut||{x:o.x,y:o.y};l.handleOut={x:d.x+(u.x-d.x)*t,y:d.y+(u.y-d.y)*t}}i.push(l)}return{points:i,closed:r.closed||e.closed}}function xW(r,e){switch(e){case"linear":return r;case"ease-in":return r*r;case"ease-out":return 1-(1-r)*(1-r);case"ease-in-out":return r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2;default:return r}}class bW{canvas;ctx;maskCanvas;maskCtx;width;height;masks=new Map;constructor(e){this.width=e.width,this.height=e.height,this.canvas=new OffscreenCanvas(e.width,e.height),this.ctx=this.canvas.getContext("2d"),this.maskCanvas=new OffscreenCanvas(e.width,e.height),this.maskCtx=this.maskCanvas.getContext("2d")}createShapeMask(e,t){const s=gW(t),i={id:jf(),clipId:e,type:"shape",path:s,feathering:0,inverted:!1,expansion:0,opacity:1,keyframes:[]};return this.masks.set(i.id,i),i}createDrawnMask(e,t){const s={id:jf(),clipId:e,type:"drawn",path:t,feathering:0,inverted:!1,expansion:0,opacity:1,keyframes:[]};return this.masks.set(s.id,s),s}getMask(e){return this.masks.get(e)}getMasksForClip(e){return Array.from(this.masks.values()).filter(t=>t.clipId===e)}updateMaskPath(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,path:t})}setFeathering(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,feathering:Math.max(0,Math.min(100,t))})}setInverted(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,inverted:t})}setExpansion(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,expansion:Math.max(-100,Math.min(100,t))})}addMaskKeyframe(e,t,s){const i=this.masks.get(e);if(!i)return null;const n={id:jf(),time:t,path:s,easing:"linear"},a=[...i.keyframes,n].sort((o,l)=>o.time-l.time);return this.masks.set(e,{...i,keyframes:a}),n}removeMaskKeyframe(e,t){const s=this.masks.get(e);if(s){const i=s.keyframes.filter(n=>n.id!==t);this.masks.set(e,{...s,keyframes:i})}}setKeyframeEasing(e,t,s){const i=this.masks.get(e);if(i){const n=i.keyframes.map(a=>a.id===t?{...a,easing:s}:a);this.masks.set(e,{...i,keyframes:n})}}getMaskAtTime(e,t){const s=this.masks.get(e);if(!s)return null;if(s.keyframes.length===0)return s.path;if(s.keyframes.length===1)return s.keyframes[0].path;let i=null,n=null;for(const u of s.keyframes)if(u.time<=t)i=u;else if(!n){n=u;break}if(!i)return s.keyframes[0].path;if(!n)return i.path;const a=n.time-i.time,o=t-i.time,l=a>0?o/a:0,d=xW(l,i.easing);return yW(i.path,n.path,d)}deleteMask(e){this.masks.delete(e)}deleteMasksForClip(e){for(const[t,s]of this.masks)s.clipId===e&&this.masks.delete(t)}async applyMask(e,t,s){const i=performance.now(),n=s!==void 0&&this.getMaskAtTime(t.id,s)||t.path;if(this.ctx.clearRect(0,0,this.width,this.height),this.maskCtx.clearRect(0,0,this.width,this.height),this.generateMaskFromPath(n,t.inverted),t.feathering>0&&this.applyFeathering(t.feathering),t.expansion!==0&&this.applyExpansion(t.expansion),this.ctx.drawImage(e,0,0,this.width,this.height),this.ctx.globalCompositeOperation="destination-in",this.ctx.drawImage(this.maskCanvas,0,0),this.ctx.globalCompositeOperation="source-over",t.opacity<1){const o=new OffscreenCanvas(this.width,this.height),l=o.getContext("2d");l.globalAlpha=t.opacity,l.drawImage(this.canvas,0,0),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(o,0,0)}return{image:await createImageBitmap(this.canvas),processingTime:performance.now()-i,gpuAccelerated:!1}}async applyMaskDefinition(e,t){const s=performance.now();return this.ctx.clearRect(0,0,this.width,this.height),this.maskCtx.clearRect(0,0,this.width,this.height),this.generateMaskShape(t),t.feather>0&&this.applyFeathering(t.feather),t.expansion!==0&&this.applyExpansion(t.expansion),this.ctx.drawImage(e,0,0,this.width,this.height),this.ctx.globalCompositeOperation="destination-in",this.ctx.drawImage(this.maskCanvas,0,0),this.ctx.globalCompositeOperation="source-over",t.opacity<1&&(this.ctx.globalAlpha=t.opacity,this.ctx.drawImage(this.canvas,0,0),this.ctx.globalAlpha=1),{image:await createImageBitmap(this.canvas),processingTime:performance.now()-s,gpuAccelerated:!1}}generateMaskFromPath(e,t){const s=this.maskCtx;t?(s.fillStyle="white",s.fillRect(0,0,this.width,this.height),s.fillStyle="black"):s.fillStyle="white",s.beginPath(),this.drawBezierPath(s,e),s.closePath(),s.fill()}drawBezierPath(e,t){if(t.points.length<2)return;const s=t.points;e.moveTo(s[0].x*this.width,s[0].y*this.height);for(let i=0;i<s.length;i++){const n=s[i],a=s[(i+1)%s.length];if(!t.closed&&i===s.length-1)break;const o=n.handleOut||{x:n.x+(a.x-n.x)*.3,y:n.y+(a.y-n.y)*.3},l=a.handleIn||{x:a.x-(a.x-n.x)*.3,y:a.y-(a.y-n.y)*.3};e.bezierCurveTo(o.x*this.width,o.y*this.height,l.x*this.width,l.y*this.height,a.x*this.width,a.y*this.height)}}generateMaskShape(e){const t=this.maskCtx;switch(e.inverted?(t.fillStyle="white",t.fillRect(0,0,this.width,this.height),t.fillStyle="black"):t.fillStyle="white",t.beginPath(),e.type){case"rectangle":this.drawRectangleMask(t,e.points);break;case"ellipse":this.drawEllipseMask(t,e.points);break;case"polygon":this.drawPolygonMask(t,e.points);break;case"bezier":this.drawBezierMask(t,e.points,e.bezierPoints);break}t.closePath(),t.fill()}drawRectangleMask(e,t){if(t.length<2)return;const s=Math.min(t[0].x,t.length>1?t[1].x:t[0].x),i=Math.min(t[0].y,t.length>1?t[1].y:t[0].y),n=Math.max(t.length>2?t[2].x:t[1].x,t.length>1?t[1].x:t[0].x),a=Math.max(t.length>2?t[2].y:t[1].y,t.length>3?t[3].y:t.length>1?t[1].y:t[0].y),o=s*this.width,l=i*this.height,d=n*this.width,u=a*this.height;e.rect(o,l,d-o,u-l)}drawEllipseMask(e,t){if(t.length<2)return;const s=t[0].x*this.width,i=t[0].y*this.height,n=Math.abs(t[1].x-t[0].x)*this.width,a=Math.abs(t[1].y-t[0].y)*this.height;e.ellipse(s,i,n,a,0,0,Math.PI*2)}drawPolygonMask(e,t){if(!(t.length<3)){e.moveTo(t[0].x*this.width,t[0].y*this.height);for(let s=1;s<t.length;s++)e.lineTo(t[s].x*this.width,t[s].y*this.height)}}drawBezierMask(e,t,s){if(t.length<2)return;const i=s||t.map(n=>({x:n.x,y:n.y}));e.moveTo(i[0].x*this.width,i[0].y*this.height);for(let n=0;n<i.length;n++){const a=i[n],o=i[(n+1)%i.length],l=a.handleOut||{x:a.x+(o.x-a.x)*.3,y:a.y+(o.y-a.y)*.3},d=o.handleIn||{x:o.x-(o.x-a.x)*.3,y:o.y-(o.y-a.y)*.3};e.bezierCurveTo(l.x*this.width,l.y*this.height,d.x*this.width,d.y*this.height,o.x*this.width,o.y*this.height)}}applyFeathering(e){const t=new OffscreenCanvas(this.width,this.height),s=t.getContext("2d");s.filter=`blur(${e}px)`,s.drawImage(this.maskCanvas,0,0),this.maskCtx.clearRect(0,0,this.width,this.height),this.maskCtx.drawImage(t,0,0)}applyExpansion(e){if(e===0)return;const s=this.maskCtx.getImageData(0,0,this.width,this.height).data,i=new Uint8ClampedArray(s.length);i.set(s);const n=Math.abs(e),a=e>0;for(let l=0;l<this.height;l++)for(let d=0;d<this.width;d++){const u=(l*this.width+d)*4;let h=!1;for(let p=-n;p<=n&&!h;p++)for(let m=-n;m<=n&&!h;m++){const f=d+m,g=l+p;if(f>=0&&f<this.width&&g>=0&&g<this.height){const y=(g*this.width+f)*4;Math.sqrt(m*m+p*p)<=n&&(a&&s[y+3]>128||!a&&s[y+3]<128)&&(h=!0)}}a&&h?i[u+3]=255:!a&&h&&(i[u+3]=0)}const o=new ImageData(i,this.width,this.height);this.maskCtx.putImageData(o,0,0)}invertMask(e){return{...e,inverted:!e.inverted}}setFeather(e,t){return{...e,feather:Math.max(0,Math.min(100,t))}}updatePoints(e,t){return{...e,points:t}}addPoint(e,t,s){const i=[...e.points];return s!==void 0&&s>=0&&s<=i.length?i.splice(s,0,t):i.push(t),{...e,points:i}}removePoint(e,t){if(e.points.length<=3)return e;const s=[...e.points];return s.splice(t,1),{...e,points:s}}isPointInMask(e,t){this.maskCtx.clearRect(0,0,this.width,this.height),this.generateMaskShape({...e,inverted:!1});const s=Math.floor(t.x*this.width),i=Math.floor(t.y*this.height),a=this.maskCtx.getImageData(s,i,1,1).data[3]>128;return e.inverted?!a:a}getMaskBounds(e){if(e.type==="ellipse"&&e.points.length>=2){const a=e.points[0].x,o=e.points[0].y,l=Math.abs(e.points[1].x-e.points[0].x),d=Math.abs(e.points[1].y-e.points[0].y);return{x:a-l,y:o-d,width:l*2,height:d*2}}let t=1/0,s=1/0,i=-1/0,n=-1/0;for(const a of e.points)t=Math.min(t,a.x),s=Math.min(s,a.y),i=Math.max(i,a.x),n=Math.max(n,a.y);return{x:t,y:s,width:i-t,height:n-s}}resize(e,t){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.maskCanvas.width=e,this.maskCanvas.height=t}getDimensions(){return{width:this.width,height:this.height}}clearAllMasks(){this.masks.clear()}}function vW(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion"]}function wW(r){return{normal:"Normal",multiply:"Multiply",screen:"Screen",overlay:"Overlay",darken:"Darken",lighten:"Lighten","color-dodge":"Color Dodge","color-burn":"Color Burn","hard-light":"Hard Light","soft-light":"Soft Light",difference:"Difference",exclusion:"Exclusion",hue:"Hue",saturation:"Saturation",color:"Color",luminosity:"Luminosity"}[r]||r}const kW={enabled:!1,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5};function Dl(){return{...kW}}class kM{canvas;ctx;width;height;clipSettings=new Map;constructor(e){this.width=e.width,this.height=e.height,this.canvas=new OffscreenCanvas(e.width,e.height),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0})}enableChromaKey(e){const t=this.clipSettings.get(e);t?this.clipSettings.set(e,{...t,enabled:!0}):this.clipSettings.set(e,{...Dl(),enabled:!0})}disableChromaKey(e){const t=this.clipSettings.get(e);t&&this.clipSettings.set(e,{...t,enabled:!1})}isEnabled(e){return this.clipSettings.get(e)?.enabled??!1}setKeyColor(e,t){const s=this.clipSettings.get(e)||Dl();this.clipSettings.set(e,{...s,keyColor:{r:Math.max(0,Math.min(1,t.r)),g:Math.max(0,Math.min(1,t.g)),b:Math.max(0,Math.min(1,t.b))}})}sampleKeyColor(e,t,s){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const i=Math.floor(t*this.width),n=Math.floor(s*this.height),a=this.ctx.getImageData(i,n,1,1);return{r:a.data[0]/255,g:a.data[1]/255,b:a.data[2]/255}}setTolerance(e,t){const s=this.clipSettings.get(e)||Dl();this.clipSettings.set(e,{...s,tolerance:Math.max(0,Math.min(1,t))})}setEdgeSoftness(e,t){const s=this.clipSettings.get(e)||Dl();this.clipSettings.set(e,{...s,edgeSoftness:Math.max(0,Math.min(1,t))})}setSpillSuppression(e,t){const s=this.clipSettings.get(e)||Dl();this.clipSettings.set(e,{...s,spillSuppression:Math.max(0,Math.min(1,t))})}getSettings(e){return this.clipSettings.get(e)}setSettings(e,t){this.clipSettings.set(e,{...t})}async applyChromaKey(e,t){const s=performance.now(),i=this.clipSettings.get(t);return!i||!i.enabled?{image:await createImageBitmap(e),processingTime:performance.now()-s,gpuAccelerated:!1}:this.applyChromaKeyWithSettings(e,i,s)}async applyChromaKeyWithSettings(e,t,s=performance.now()){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const i=this.ctx.getImageData(0,0,this.width,this.height),n=i.data,{keyColor:a,tolerance:o,edgeSoftness:l,spillSuppression:d}=t;let u=0,h=0,p=0;for(let g=0;g<n.length;g+=4){const y=n[g]/255,x=n[g+1]/255,v=n[g+2]/255,b=this.colorDistance(y,x,v,a);let S=this.calculateAlpha(b,o,l);if(u<10&&g%1e4===0&&(console.log(`[ChromaKey Sample] RGB(${y.toFixed(2)}, ${x.toFixed(2)}, ${v.toFixed(2)}) vs Key(${a.r}, ${a.g}, ${a.b}) => distance=${b.toFixed(3)}, alpha=${S.toFixed(3)}`),u++),S<.1?h++:S>.9&&p++,d>0&&S>0){const k=this.suppressSpill(y,x,v,a,d,S);n[g]=Math.round(k.r*255),n[g+1]=Math.round(k.g*255),n[g+2]=Math.round(k.b*255)}n[g+3]=Math.round(S*255)}this.ctx.putImageData(i,0,0);const m=n.length/4;return console.log(`[ChromaKey] Processed ${m} pixels: ${h} transparent (${(h/m*100).toFixed(1)}%), ${p} opaque (${(p/m*100).toFixed(1)}%)`),{image:await createImageBitmap(this.canvas),processingTime:performance.now()-s,gpuAccelerated:!1}}getMatte(e,t){const s=this.clipSettings.get(t);if(!s||!s.enabled){const p=this.ctx.createImageData(this.width,this.height);for(let m=0;m<p.data.length;m+=4)p.data[m]=255,p.data[m+1]=255,p.data[m+2]=255,p.data[m+3]=255;return{matte:p,transparentPixels:0,totalPixels:this.width*this.height}}this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const n=this.ctx.getImageData(0,0,this.width,this.height).data,a=this.ctx.createImageData(this.width,this.height),o=a.data,{keyColor:l,tolerance:d,edgeSoftness:u}=s;let h=0;for(let p=0;p<n.length;p+=4){const m=n[p]/255,f=n[p+1]/255,g=n[p+2]/255,y=this.colorDistance(m,f,g,l),x=this.calculateAlpha(y,d,u),v=Math.round(x*255);o[p]=v,o[p+1]=v,o[p+2]=v,o[p+3]=255,x===0&&h++}return{matte:a,transparentPixels:h,totalPixels:this.width*this.height}}colorDistance(e,t,s,i){const n=e-i.r,a=t-i.g,o=s-i.b;return Math.sqrt(n*n+a*a+o*o)}calculateAlpha(e,t,s){const i=t*1.732,n=s*.5;if(e<=i-n)return 0;if(e>=i+n)return 1;{const a=n*2;return(e-(i-n))/a}}suppressSpill(e,t,s,i,n,a){if(a>=1||a<=0)return{r:e,g:t,b:s};const o=1-a,l=Math.max(i.r,i.g,i.b);let d=e,u=t,h=s;if(i.g===l){const p=(e+s)/2,m=Math.max(0,t-p);u=t-m*n*o}else if(i.b===l){const p=(e+t)/2,m=Math.max(0,s-p);h=s-m*n*o}else{const p=(t+s)/2,m=Math.max(0,e-p);d=e-m*n*o}return{r:Math.max(0,Math.min(1,d)),g:Math.max(0,Math.min(1,u)),b:Math.max(0,Math.min(1,h))}}async composite(e,t){return this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(t,0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height),createImageBitmap(this.canvas)}async applyAndComposite(e,t,s){const i=performance.now(),n=await this.applyChromaKey(e,s),a=await this.composite(n.image,t);return n.image.close(),{image:a,processingTime:performance.now()-i,gpuAccelerated:!1}}countTransparentPixels(e){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const s=this.ctx.getImageData(0,0,this.width,this.height).data;let i=0;for(let n=3;n<s.length;n+=4)s[n]===0&&i++;return i}resize(e,t){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t}getDimensions(){return{width:this.width,height:this.height}}clearSettings(e){this.clipSettings.delete(e)}clearAllSettings(){this.clipSettings.clear()}}function mC(r){return`${r}-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}class CW{trackingJobs=new Map;trackingData=new Map;attachments=new Map;progressCallbacks=new Set;lostCallbacks=new Set;constructor(){}async startTracking(e,t,s={}){const i=mC("track-job"),n={id:i,clipId:e,region:t,status:"pending",progress:0,options:{frameRate:s.frameRate??30,startFrame:s.startFrame??0,endFrame:s.endFrame??300,algorithm:s.algorithm??"correlation",confidenceThreshold:s.confidenceThreshold??.7},startTime:Date.now()};return this.trackingJobs.set(i,n),this.runTracking(n),n}async runTracking(e){e.status="running",this.trackingJobs.set(e.id,e);const{startFrame:t,endFrame:s,frameRate:i,confidenceThreshold:n}=e.options,a=(s??300)-(t??0),o=[],l=[],d=[];for(let p=0;p<=a;p++){const m=this.trackingJobs.get(e.id);if(!m||m.status==="cancelled")return;const f=(t??0)+p,g=this.simulateTracking(e.region,f,p);o.push({frame:f,position:g.position,scale:g.scale,rotation:g.rotation}),l.push(g.confidence),g.confidence<(n??.7)&&(d.push(f),this.notifyTrackingLost(f)),e.progress=p/a*100,this.trackingJobs.set(e.id,e),this.notifyProgress(e.progress),await new Promise(y=>setTimeout(y,0))}const u=mC("track"),h={trackId:u,clipId:e.clipId,keyframes:o,confidence:l,lostFrames:d,region:e.region,frameRate:i??30};this.trackingData.set(u,h),e.status="completed",e.progress=100,e.endTime=Date.now(),this.trackingJobs.set(e.id,e)}simulateTracking(e,t,s){const i=e.x+e.width/2,n=e.y+e.height/2,a=Math.sin(s*.1)*50,o=Math.cos(s*.15)*30,l=(Math.random()-.5)*2,d=(Math.random()-.5)*2,u=s%50===0?.5:.85+Math.random()*.15;return{position:{x:i+a+l,y:n+o+d},scale:1+Math.sin(s*.05)*.1,rotation:Math.sin(s*.02)*.1,confidence:u}}cancelTracking(e){const t=this.trackingJobs.get(e);t&&t.status==="running"&&(t.status="cancelled",t.endTime=Date.now(),this.trackingJobs.set(e,t))}getTrackingJob(e){return this.trackingJobs.get(e)}getTrackingData(e,t){const s=this.trackingData.get(t);if(s&&s.clipId===e)return s}getTrackingDataForClip(e){return Array.from(this.trackingData.values()).filter(t=>t.clipId===e)}applyTrackingToElement(e,t,s={x:0,y:0}){if(!this.trackingData.get(e))throw new Error(`Tracking data not found: ${e}`);const n={elementId:t,trackId:e,offset:s,applyScale:!0,applyRotation:!0};this.attachments.set(t,n)}removeTrackingFromElement(e){this.attachments.delete(e)}getAttachment(e){return this.attachments.get(e)}getAttachmentsForTrack(e){return Array.from(this.attachments.values()).filter(t=>t.trackId===e)}getElementPositionAtTime(e,t){const s=this.attachments.get(e);if(!s)return null;const i=this.trackingData.get(s.trackId);if(!i)return null;const n=Math.floor(t*i.frameRate),a=this.getTrackedPositionAtFrame(i,n);return a?{x:a.x+s.offset.x,y:a.y+s.offset.y}:null}getTrackedPositionAtFrame(e,t){if(e.keyframes.length===0)return null;let s=null,i=null;for(const a of e.keyframes)if(a.frame<=t)s=a;else if(!i){i=a;break}if(!s)return e.keyframes[0].position;if(!i||s.frame===t)return s.position;const n=(t-s.frame)/(i.frame-s.frame);return{x:s.position.x+(i.position.x-s.position.x)*n,y:s.position.y+(i.position.y-s.position.y)*n}}onTrackingProgress(e){return this.progressCallbacks.add(e),()=>this.progressCallbacks.delete(e)}onTrackingLost(e){return this.lostCallbacks.add(e),()=>this.lostCallbacks.delete(e)}notifyProgress(e){for(const t of this.progressCallbacks)t(e)}notifyTrackingLost(e){for(const t of this.lostCallbacks)t(e)}correctTrackingPoint(e,t,s){const i=this.trackingData.get(e);if(!i)throw new Error(`Tracking data not found: ${e}`);const n=i.keyframes.findIndex(a=>a.frame===t);if(n>=0){i.keyframes[n].position=s,i.confidence[n]=1;const a=i.lostFrames.indexOf(t);a>=0&&i.lostFrames.splice(a,1)}else{const a={frame:t,position:s,scale:1,rotation:0};let o=i.keyframes.findIndex(l=>l.frame>t);o===-1&&(o=i.keyframes.length),i.keyframes.splice(o,0,a),i.confidence.splice(o,0,1)}this.trackingData.set(e,i)}setTrackingOffset(e,t){const s=this.attachments.get(e);s&&(s.offset=t,this.attachments.set(e,s))}getTrackingOffset(e){return this.attachments.get(e)?.offset??null}setApplyScale(e,t){const s=this.attachments.get(e);s&&(s.applyScale=t,this.attachments.set(e,s))}setApplyRotation(e,t){const s=this.attachments.get(e);s&&(s.applyRotation=t,this.attachments.set(e,s))}deleteTrackingData(e){for(const[t,s]of this.attachments)s.trackId===e&&this.attachments.delete(t);this.trackingData.delete(e)}deleteTrackingDataForClip(e){for(const[t,s]of this.trackingData)s.clipId===e&&this.deleteTrackingData(t)}clear(){this.trackingJobs.clear(),this.trackingData.clear(),this.attachments.clear()}getTrackIds(){return Array.from(this.trackingData.keys())}hasTracking(e){return this.attachments.has(e)}}let _f=null;function SW(){return _f||(_f=new CW),_f}const Zu=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6","#ec4899"];class TW{groups=new Map;switches=new Map;constructor(){}createGroup(e,t){const s=`multicam_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,i=t.map((a,o)=>({id:`angle_${o+1}`,name:`Angle ${o+1}`,clipId:a,trackId:"",offset:0,color:Zu[o%Zu.length],isActive:o===0})),n={id:s,name:e,angles:i,activeAngleId:i[0]?.id||"",syncPoint:0,duration:0,createdAt:Date.now()};return this.groups.set(s,n),this.switches.set(s,[]),n}getGroup(e){return this.groups.get(e)}getAllGroups(){return Array.from(this.groups.values())}deleteGroup(e){return this.switches.delete(e),this.groups.delete(e)}addAngle(e,t,s){const i=this.groups.get(e);if(!i)return null;const n=i.angles.length,a={id:`angle_${Date.now()}`,name:s||`Angle ${n+1}`,clipId:t,trackId:"",offset:0,color:Zu[n%Zu.length],isActive:!1};return i.angles.push(a),a}removeAngle(e,t){const s=this.groups.get(e);if(!s)return!1;const i=s.angles.findIndex(n=>n.id===t);return i===-1?!1:(s.angles.splice(i,1),s.activeAngleId===t&&s.angles.length>0&&(s.activeAngleId=s.angles[0].id,s.angles[0].isActive=!0),!0)}setActiveAngle(e,t){const s=this.groups.get(e);return!s||!s.angles.find(n=>n.id===t)?!1:(s.angles.forEach(n=>{n.isActive=n.id===t}),s.activeAngleId=t,!0)}getActiveAngle(e){const t=this.groups.get(e);return t&&t.angles.find(s=>s.id===t.activeAngleId)||null}addSwitch(e,t,s){const i=this.groups.get(e);if(!i||!i.angles.find(l=>l.id===t))return null;const a={id:`switch_${Date.now()}`,groupId:e,angleId:t,time:s},o=this.switches.get(e)||[];return o.push(a),o.sort((l,d)=>l.time-d.time),this.switches.set(e,o),a}removeSwitch(e,t){const s=this.switches.get(e);if(!s)return!1;const i=s.findIndex(n=>n.id===t);return i===-1?!1:(s.splice(i,1),!0)}getSwitches(e){return this.switches.get(e)||[]}getAngleAtTime(e,t){const s=this.groups.get(e);if(!s)return null;const i=this.switches.get(e)||[];let n=s.angles[0]?.id;for(const a of i)if(a.time<=t)n=a.angleId;else break;return s.angles.find(a=>a.id===n)||null}setAngleOffset(e,t,s){const i=this.groups.get(e);if(!i)return!1;const n=i.angles.find(a=>a.id===t);return n?(n.offset=s,!0):!1}renameAngle(e,t,s){const i=this.groups.get(e);if(!i)return!1;const n=i.angles.find(a=>a.id===t);return n?(n.name=s,!0):!1}async syncByAudio(e,t,s){const i=this.groups.get(e);if(!i)return new Map;const n=new Map,a=s.get(t);if(!a)return n;for(const o of i.angles){if(o.id===t){n.set(o.id,{offset:0,confidence:1,method:"audio"});continue}const l=s.get(o.id);if(!l){n.set(o.id,{offset:0,confidence:0,method:"manual"});continue}const d=await this.findAudioOffset(a,l);n.set(o.id,d),o.offset=d.offset}return n}async findAudioOffset(e,t){const s=e.getChannelData(0),i=t.getChannelData(0),n=e.sampleRate,a=Math.min(n*5,s.length,i.length),o=Math.min(n*30,i.length-a);let l=0,d=-1/0;const u=Math.max(1,Math.floor(n/100));for(let m=-o;m<=o;m+=u){let f=0,g=0;for(let y=0;y<a;y+=u){const x=y,v=y+m;v>=0&&v<i.length&&(f+=s[x]*i[v],g++)}g>0&&(f/=g,f>d&&(d=f,l=m))}const h=l/n,p=Math.max(0,Math.min(1,(d+1)/2));return{offset:h,confidence:p,method:"audio"}}setSyncPoint(e,t){const s=this.groups.get(e);return s?(s.syncPoint=t,!0):!1}clearGroup(e){const t=this.groups.get(e);t&&(t.angles=[],t.activeAngleId=""),this.switches.set(e,[])}clearAll(){this.groups.clear(),this.switches.clear()}exportGroupAsSequence(e){const t=this.groups.get(e);if(!t)return[];const s=this.switches.get(e)||[],i=[];if(s.length===0&&t.angles.length>0){const l=t.angles.find(d=>d.id===t.activeAngleId);return l&&i.push({clipId:l.clipId,startTime:0,endTime:t.duration}),i}let n=t.angles[0]?.id,a=0;for(let l=0;l<s.length;l++){const d=s[l],u=t.angles.find(h=>h.id===n);u&&d.time>a&&i.push({clipId:u.clipId,startTime:a,endTime:d.time}),n=d.angleId,a=d.time}const o=t.angles.find(l=>l.id===n);return o&&a<t.duration&&i.push({clipId:o.clipId,startTime:a,endTime:t.duration}),i}}const AW={normal:{name:"Normal",description:"Standard blending"},multiply:{name:"Multiply",description:"Darkens by multiplying colors"},screen:{name:"Screen",description:"Lightens by screening colors"},overlay:{name:"Overlay",description:"Combines multiply and screen"},darken:{name:"Darken",description:"Keeps darker pixels"},lighten:{name:"Lighten",description:"Keeps lighter pixels"},"color-dodge":{name:"Color Dodge",description:"Brightens base color"},"color-burn":{name:"Color Burn",description:"Darkens base color"},"hard-light":{name:"Hard Light",description:"Strong overlay effect"},"soft-light":{name:"Soft Light",description:"Gentle overlay effect"},difference:{name:"Difference",description:"Subtracts colors"},exclusion:{name:"Exclusion",description:"Similar to difference, lower contrast"},hue:{name:"Hue",description:"Applies hue only"},saturation:{name:"Saturation",description:"Applies saturation only"},color:{name:"Color",description:"Applies hue and saturation"},luminosity:{name:"Luminosity",description:"Applies luminosity only"}};function fC(){return`adj_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}class jW{layers=new Map;layersByTrack=new Map;createAdjustmentLayer(e,t,s={}){const i={id:fC(),trackId:e,name:s.name||`Adjustment Layer ${this.layers.size+1}`,startTime:t,duration:s.duration||5,effects:s.effects||[],opacity:s.opacity??1,blendMode:s.blendMode||"normal",enabled:!0,affectedTracks:"all",transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1}};return this.layers.set(i.id,i),this.layersByTrack.has(e)||this.layersByTrack.set(e,new Set),this.layersByTrack.get(e).add(i.id),i}getLayer(e){return this.layers.get(e)}getAllLayers(){return Array.from(this.layers.values())}getLayersForTrack(e){const t=this.layersByTrack.get(e);return t?Array.from(t).map(s=>this.layers.get(s)).filter(s=>s!==void 0):[]}getActiveLayersAtTime(e,t){const s=[];for(const i of this.layers.values())i.enabled&&e>=i.startTime&&e<i.startTime+i.duration&&s.push(i);return s.sort((i,n)=>t!==void 0?0:i.startTime-n.startTime)}updateLayer(e,t){const s=this.layers.get(e);return s?(t.trackId&&t.trackId!==s.trackId&&(this.layersByTrack.get(s.trackId)?.delete(e),this.layersByTrack.has(t.trackId)||this.layersByTrack.set(t.trackId,new Set),this.layersByTrack.get(t.trackId).add(e)),this.layers.set(e,{...s,...t,id:s.id}),!0):!1}deleteLayer(e){const t=this.layers.get(e);return t?(this.layersByTrack.get(t.trackId)?.delete(e),this.layers.delete(e)):!1}addEffect(e,t){const s=this.layers.get(e);if(!s)return!1;const i={...t,id:`effect_${Date.now()}_${Math.random().toString(36).slice(2,11)}`};return this.layers.set(e,{...s,effects:[...s.effects,i]}),!0}removeEffect(e,t){const s=this.layers.get(e);return s?(this.layers.set(e,{...s,effects:s.effects.filter(i=>i.id!==t)}),!0):!1}updateEffect(e,t,s){const i=this.layers.get(e);if(!i)return!1;const n=i.effects.findIndex(o=>o.id===t);if(n===-1)return!1;const a=[...i.effects];return a[n]={...a[n],...s,id:t},this.layers.set(e,{...i,effects:a}),!0}setOpacity(e,t){return this.updateLayer(e,{opacity:Math.max(0,Math.min(1,t))})}setBlendMode(e,t){return this.updateLayer(e,{blendMode:t})}setEnabled(e,t){return this.updateLayer(e,{enabled:t})}setAffectedTracks(e,t){return this.updateLayer(e,{affectedTracks:t})}getEffectsForClip(e,t,s){const i=[];for(const n of this.layers.values()){if(!n.enabled||t<n.startTime||t>=n.startTime+n.duration)continue;const a=s.get(n.trackId);if(a!==void 0&&!(a<e)&&!(n.affectedTracks!=="all"&&!n.affectedTracks.map(l=>s.get(l)).filter(l=>l!==void 0).some(l=>l===e)))for(const o of n.effects)o.enabled!==!1&&i.push({layerId:n.id,effect:o,opacity:n.opacity,blendMode:n.blendMode})}return i}duplicateLayer(e,t){const s=this.layers.get(e);if(!s)return null;const i={...s,id:fC(),trackId:t||s.trackId,name:`${s.name} (Copy)`,effects:s.effects.map(n=>({...n,id:`effect_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}))};return this.layers.set(i.id,i),this.layersByTrack.has(i.trackId)||this.layersByTrack.set(i.trackId,new Set),this.layersByTrack.get(i.trackId).add(i.id),i}getBlendModes(){return Object.entries(AW).map(([e,t])=>({id:e,...t}))}clearAll(){this.layers.clear(),this.layersByTrack.clear()}}const gC={enabled:!1,quality:"balanced",sharpening:.3},_W=`
struct Dimensions {
 srcWidth: u32,
 srcHeight: u32,
 dstWidth: u32,
 dstHeight: u32,
 direction: u32,
 padding: vec3<u32>,
};

@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(2) var<uniform> dims: Dimensions;

const PI: f32 = 3.14159265359;
const LANCZOS_A: f32 = 3.0;

fn sinc(x: f32) -> f32 {
 if (abs(x) < 0.0001) {
 return 1.0;
 }
 let pix = PI * x;
 return sin(pix) / pix;
}

fn lanczosWeight(x: f32) -> f32 {
 if (abs(x) >= LANCZOS_A) {
 return 0.0;
 }
 return sinc(x) * sinc(x / LANCZOS_A);
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let dstX = global_id.x;
 let dstY = global_id.y;

 var targetWidth: u32;
 var targetHeight: u32;
 var srcWidth: u32;
 var srcHeight: u32;

 if (dims.direction == 0u) {
 targetWidth = dims.dstWidth;
 targetHeight = dims.srcHeight;
 srcWidth = dims.srcWidth;
 srcHeight = dims.srcHeight;
 } else {
 targetWidth = dims.dstWidth;
 targetHeight = dims.dstHeight;
 srcWidth = dims.dstWidth;
 srcHeight = dims.srcHeight;
 }

 if (dstX >= targetWidth || dstY >= targetHeight) {
 return;
 }

 var scale: f32;
 var srcPos: f32;

 if (dims.direction == 0u) {
 scale = f32(srcWidth) / f32(targetWidth);
 srcPos = (f32(dstX) + 0.5) * scale - 0.5;
 } else {
 scale = f32(srcHeight) / f32(targetHeight);
 srcPos = (f32(dstY) + 0.5) * scale - 0.5;
 }

 let srcCenter = i32(floor(srcPos));
 let kernelRadius = i32(ceil(LANCZOS_A * max(1.0, scale)));

 var colorSum = vec4<f32>(0.0);
 var weightSum: f32 = 0.0;

 for (var i = -kernelRadius; i <= kernelRadius; i = i + 1) {
 let srcIdx = srcCenter + i;
 var sampleCoords: vec2<i32>;

 if (dims.direction == 0u) {
 let clampedX = clamp(srcIdx, 0, i32(srcWidth) - 1);
 sampleCoords = vec2<i32>(clampedX, i32(dstY));
 } else {
 let clampedY = clamp(srcIdx, 0, i32(srcHeight) - 1);
 sampleCoords = vec2<i32>(i32(dstX), clampedY);
 }

 let dist = (f32(srcIdx) + 0.5 - srcPos) / max(1.0, scale);
 let weight = lanczosWeight(dist);

 if (weight > 0.0001) {
 colorSum = colorSum + textureLoad(inputTexture, sampleCoords, 0) * weight;
 weightSum = weightSum + weight;
 }
 }

 var finalColor: vec4<f32>;
 if (weightSum > 0.0001) {
 finalColor = colorSum / weightSum;
 } else {
 if (dims.direction == 0u) {
 finalColor = textureLoad(inputTexture, vec2<i32>(clamp(srcCenter, 0, i32(srcWidth) - 1), i32(dstY)), 0);
 } else {
 finalColor = textureLoad(inputTexture, vec2<i32>(i32(dstX), clamp(srcCenter, 0, i32(srcHeight) - 1)), 0);
 }
 }

 finalColor = clamp(finalColor, vec4<f32>(0.0), vec4<f32>(1.0));
 textureStore(outputTexture, vec2<i32>(i32(dstX), i32(dstY)), finalColor);
}
`,EW=`
struct Dimensions {
 width: u32,
 height: u32,
 padding: vec2<u32>,
};

@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(2) var<uniform> dims: Dimensions;

fn getLuminance(color: vec3<f32>) -> f32 {
 return dot(color, vec3<f32>(0.299, 0.587, 0.114));
}

fn sampleLuminance(coords: vec2<i32>) -> f32 {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(dims.width) - 1),
 clamp(coords.y, 0, i32(dims.height) - 1)
 );
 return getLuminance(textureLoad(inputTexture, clampedCoords, 0).rgb);
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let x = global_id.x;
 let y = global_id.y;

 if (x >= dims.width || y >= dims.height) {
 return;
 }

 let coords = vec2<i32>(i32(x), i32(y));

 let tl = sampleLuminance(coords + vec2<i32>(-1, -1));
 let tc = sampleLuminance(coords + vec2<i32>(0, -1));
 let tr = sampleLuminance(coords + vec2<i32>(1, -1));
 let ml = sampleLuminance(coords + vec2<i32>(-1, 0));
 let mr = sampleLuminance(coords + vec2<i32>(1, 0));
 let bl = sampleLuminance(coords + vec2<i32>(-1, 1));
 let bc = sampleLuminance(coords + vec2<i32>(0, 1));
 let br = sampleLuminance(coords + vec2<i32>(1, 1));

 let gx = -tl - 2.0 * ml - bl + tr + 2.0 * mr + br;
 let gy = -tl - 2.0 * tc - tr + bl + 2.0 * bc + br;

 let magnitude = sqrt(gx * gx + gy * gy);

 var angle: f32 = 0.0;
 if (abs(gx) > 0.001 || abs(gy) > 0.001) {
 angle = atan2(gy, gx);
 angle = (angle + 3.14159265359) / (2.0 * 3.14159265359);
 }

 let normalizedMagnitude = clamp(magnitude, 0.0, 1.0);

 textureStore(outputTexture, coords, vec4<f32>(
 normalizedMagnitude,
 angle,
 gx * 0.5 + 0.5,
 gy * 0.5 + 0.5
 ));
}
`,MW=`
struct Dimensions {
 width: u32,
 height: u32,
 padding: vec2<u32>,
};

@group(0) @binding(0) var colorTexture: texture_2d<f32>;
@group(0) @binding(1) var edgeTexture: texture_2d<f32>;
@group(0) @binding(2) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(3) var<uniform> dims: Dimensions;

fn sampleColor(coords: vec2<i32>) -> vec4<f32> {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(dims.width) - 1),
 clamp(coords.y, 0, i32(dims.height) - 1)
 );
 return textureLoad(colorTexture, clampedCoords, 0);
}

fn sampleEdge(coords: vec2<i32>) -> vec4<f32> {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(dims.width) - 1),
 clamp(coords.y, 0, i32(dims.height) - 1)
 );
 return textureLoad(edgeTexture, clampedCoords, 0);
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let x = global_id.x;
 let y = global_id.y;

 if (x >= dims.width || y >= dims.height) {
 return;
 }

 let coords = vec2<i32>(i32(x), i32(y));
 let color = sampleColor(coords);
 let edge = sampleEdge(coords);

 let magnitude = edge.r;
 let gx = edge.b * 2.0 - 1.0;
 let gy = edge.a * 2.0 - 1.0;

 let edgeThreshold = 0.05;

 if (magnitude < edgeThreshold) {
 textureStore(outputTexture, coords, color);
 return;
 }

 let gradLen = sqrt(gx * gx + gy * gy);
 var perpX: f32 = 0.0;
 var perpY: f32 = 0.0;

 if (gradLen > 0.001) {
 perpX = -gy / gradLen;
 perpY = gx / gradLen;
 }

 let sampleDist = 1.0;
 let offset = vec2<f32>(perpX * sampleDist, perpY * sampleDist);

 let sample1Coords = coords + vec2<i32>(i32(round(offset.x)), i32(round(offset.y)));
 let sample2Coords = coords - vec2<i32>(i32(round(offset.x)), i32(round(offset.y)));

 let sample1 = sampleColor(sample1Coords);
 let sample2 = sampleColor(sample2Coords);

 let blendFactor = clamp(magnitude * 2.0, 0.0, 1.0);
 let edgeColor = (sample1 + sample2) * 0.5;
 let refinedColor = mix(color, edgeColor, blendFactor * 0.3);

 textureStore(outputTexture, coords, refinedColor);
}
`,PW=`
struct Uniforms {
 width: u32,
 height: u32,
 strength: f32,
 padding: u32,
};

@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(2) var<uniform> uniforms: Uniforms;

fn sampleColor(coords: vec2<i32>) -> vec4<f32> {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(uniforms.width) - 1),
 clamp(coords.y, 0, i32(uniforms.height) - 1)
 );
 return textureLoad(inputTexture, clampedCoords, 0);
}

fn getLuminance(color: vec3<f32>) -> f32 {
 return dot(color, vec3<f32>(0.299, 0.587, 0.114));
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let x = global_id.x;
 let y = global_id.y;

 if (x >= uniforms.width || y >= uniforms.height) {
 return;
 }

 let coords = vec2<i32>(i32(x), i32(y));
 let center = sampleColor(coords);

 if (uniforms.strength < 0.001) {
 textureStore(outputTexture, coords, center);
 return;
 }

 let top = sampleColor(coords + vec2<i32>(0, -1));
 let bottom = sampleColor(coords + vec2<i32>(0, 1));
 let left = sampleColor(coords + vec2<i32>(-1, 0));
 let right = sampleColor(coords + vec2<i32>(1, 0));

 let blur = (top + bottom + left + right) * 0.25;

 let highPass = center - blur;

 let localContrast = abs(getLuminance(highPass.rgb));
 let adaptiveStrength = uniforms.strength * (1.0 - localContrast * 0.5);

 let sharpened = center + highPass * adaptiveStrength;

 let finalColor = clamp(sharpened, vec4<f32>(0.0), vec4<f32>(1.0));

 textureStore(outputTexture, coords, finalColor);
}
`;function yC(r,e,t,s,i){const n=new ArrayBuffer(32),a=new Uint32Array(n);return a[0]=r,a[1]=e,a[2]=t,a[3]=s,a[4]=i,a[5]=0,a[6]=0,a[7]=0,n}function xC(r,e){const t=new ArrayBuffer(16),s=new Uint32Array(t);return s[0]=r,s[1]=e,s[2]=0,s[3]=0,t}function NW(r,e,t){const s=new ArrayBuffer(16),i=new Uint32Array(s),n=new Float32Array(s);return i[0]=r,i[1]=e,n[2]=t,i[3]=0,s}const RW=4;class IW{device=null;initialized=!1;lanczosBindGroupLayout=null;edgeDetectBindGroupLayout=null;edgeDirectedBindGroupLayout=null;sharpenBindGroupLayout=null;lanczosPipeline=null;edgeDetectPipeline=null;edgeDirectedPipeline=null;sharpenPipeline=null;texturePool=new Map;lastProcessingTime=0;async initialize(e){if(this.initialized&&this.device===e.device)return!0;this.device=e.device;try{return this.createBindGroupLayouts(),await this.createPipelines(),this.initialized=!0,!0}catch(t){return console.error("[UpscalingEngine] Initialization failed:",t),!1}}createBindGroupLayouts(){this.device&&(this.lanczosBindGroupLayout=this.device.createBindGroupLayout({label:"Lanczos Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.edgeDetectBindGroupLayout=this.device.createBindGroupLayout({label:"Edge Detect Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.edgeDirectedBindGroupLayout=this.device.createBindGroupLayout({label:"Edge Directed Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:2,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.sharpenBindGroupLayout=this.device.createBindGroupLayout({label:"Sharpen Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}))}async createPipelines(){if(!this.device)return;const e=this.device.createShaderModule({label:"Lanczos Shader",code:_W}),t=this.device.createShaderModule({label:"Edge Detect Shader",code:EW}),s=this.device.createShaderModule({label:"Edge Directed Shader",code:MW}),i=this.device.createShaderModule({label:"Sharpen Shader",code:PW});this.lanczosPipeline=this.device.createComputePipeline({label:"Lanczos Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.lanczosBindGroupLayout]}),compute:{module:e,entryPoint:"main"}}),this.edgeDetectPipeline=this.device.createComputePipeline({label:"Edge Detect Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.edgeDetectBindGroupLayout]}),compute:{module:t,entryPoint:"main"}}),this.edgeDirectedPipeline=this.device.createComputePipeline({label:"Edge Directed Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.edgeDirectedBindGroupLayout]}),compute:{module:s,entryPoint:"main"}}),this.sharpenPipeline=this.device.createComputePipeline({label:"Sharpen Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.sharpenBindGroupLayout]}),compute:{module:i,entryPoint:"main"}})}shouldUpscale(e,t,s,i){return s>e||i>t}async upscale(e,t,s,i=gC){if(!this.initialized||!this.device)throw new Error("UpscalingEngine not initialized");const n=performance.now(),a=e.width,o=e.height;if(!this.shouldUpscale(a,o,t,s))return e;let l;switch(i.quality){case"fast":l=await this.upscaleFast(e,t,s);break;case"balanced":l=await this.upscaleBalanced(e,t,s);break;case"quality":l=await this.upscaleQuality(e,t,s,i.sharpening);break;default:l=await this.upscaleBalanced(e,t,s)}return this.lastProcessingTime=performance.now()-n,l}async upscaleFast(e,t,s){return this.applyLanczos(e,t,s)}async upscaleBalanced(e,t,s){const i=await this.applyLanczos(e,t,s),n=await this.applyEdgeDetection(i),a=await this.applyEdgeDirected(i,n);return this.releaseTexture(n),a}async upscaleQuality(e,t,s,i){const n=await this.applyLanczos(e,t,s),a=await this.applyEdgeDetection(n),o=await this.applyEdgeDirected(n,a);if(this.releaseTexture(a),i>.01){const l=await this.applySharpen(o,i);return this.releaseTexture(o),l}return o}async applyLanczos(e,t,s){if(!this.device||!this.lanczosPipeline||!this.lanczosBindGroupLayout)throw new Error("Lanczos pipeline not ready");const i=e.width,n=e.height,a=this.getPooledTexture(t,n),o=this.device.createBuffer({size:32,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(o,0,yC(i,n,t,s,0));const l=this.device.createBindGroup({layout:this.lanczosBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:a.createView()},{binding:2,resource:{buffer:o}}]}),d=this.device.createCommandEncoder(),u=d.beginComputePass();u.setPipeline(this.lanczosPipeline),u.setBindGroup(0,l),u.dispatchWorkgroups(Math.ceil(t/16),Math.ceil(n/16)),u.end();const h=this.getPooledTexture(t,s),p=this.device.createBuffer({size:32,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(p,0,yC(t,n,t,s,1));const m=this.device.createBindGroup({layout:this.lanczosBindGroupLayout,entries:[{binding:0,resource:a.createView()},{binding:1,resource:h.createView()},{binding:2,resource:{buffer:p}}]}),f=d.beginComputePass();return f.setPipeline(this.lanczosPipeline),f.setBindGroup(0,m),f.dispatchWorkgroups(Math.ceil(t/16),Math.ceil(s/16)),f.end(),this.device.queue.submit([d.finish()]),this.releaseTexture(a),o.destroy(),p.destroy(),h}async applyEdgeDetection(e){if(!this.device||!this.edgeDetectPipeline||!this.edgeDetectBindGroupLayout)throw new Error("Edge detect pipeline not ready");const t=e.width,s=e.height,i=this.getPooledTexture(t,s),n=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(n,0,xC(t,s));const a=this.device.createBindGroup({layout:this.edgeDetectBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:i.createView()},{binding:2,resource:{buffer:n}}]}),o=this.device.createCommandEncoder(),l=o.beginComputePass();return l.setPipeline(this.edgeDetectPipeline),l.setBindGroup(0,a),l.dispatchWorkgroups(Math.ceil(t/16),Math.ceil(s/16)),l.end(),this.device.queue.submit([o.finish()]),n.destroy(),i}async applyEdgeDirected(e,t){if(!this.device||!this.edgeDirectedPipeline||!this.edgeDirectedBindGroupLayout)throw new Error("Edge directed pipeline not ready");const s=e.width,i=e.height,n=this.getPooledTexture(s,i),a=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(a,0,xC(s,i));const o=this.device.createBindGroup({layout:this.edgeDirectedBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:t.createView()},{binding:2,resource:n.createView()},{binding:3,resource:{buffer:a}}]}),l=this.device.createCommandEncoder(),d=l.beginComputePass();return d.setPipeline(this.edgeDirectedPipeline),d.setBindGroup(0,o),d.dispatchWorkgroups(Math.ceil(s/16),Math.ceil(i/16)),d.end(),this.device.queue.submit([l.finish()]),a.destroy(),n}async applySharpen(e,t){if(!this.device||!this.sharpenPipeline||!this.sharpenBindGroupLayout)throw new Error("Sharpen pipeline not ready");const s=e.width,i=e.height,n=this.getPooledTexture(s,i),a=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(a,0,NW(s,i,t));const o=this.device.createBindGroup({layout:this.sharpenBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:n.createView()},{binding:2,resource:{buffer:a}}]}),l=this.device.createCommandEncoder(),d=l.beginComputePass();return d.setPipeline(this.sharpenPipeline),d.setBindGroup(0,o),d.dispatchWorkgroups(Math.ceil(s/16),Math.ceil(i/16)),d.end(),this.device.queue.submit([l.finish()]),a.destroy(),n}getPooledTexture(e,t){if(!this.device)throw new Error("Device not available");const s=`${e}x${t}`,i=this.texturePool.get(s);return i&&i.length>0?i.pop().texture:this.device.createTexture({label:`Upscaling Texture ${s}`,size:{width:e,height:t},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST})}releaseTexture(e){const t=`${e.width}x${e.height}`;this.texturePool.has(t)||this.texturePool.set(t,[]);const s=this.texturePool.get(t);s.length<RW?s.push({texture:e,width:e.width,height:e.height,lastUsed:Date.now()}):e.destroy()}async upscaleImageBitmap(e,t,s,i=gC){if(!this.initialized||!this.device)return this.canvas2DFallback(e,t,s);try{const n=this.device.createTexture({label:"Upscale Input",size:{width:e.width,height:e.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.device.queue.copyExternalImageToTexture({source:e},{texture:n},{width:e.width,height:e.height});const a=await this.upscale(n,t,s,i),o=await this.textureToImageBitmap(a);return n.destroy(),this.releaseTexture(a),o}catch(n){return console.warn("[UpscalingEngine] GPU upscale failed, using fallback:",n),this.canvas2DFallback(e,t,s)}}async textureToImageBitmap(e){if(!this.device)throw new Error("Device not available");const t=e.width,s=e.height,i=Math.ceil(t*4/256)*256,n=this.device.createBuffer({size:i*s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),a=this.device.createCommandEncoder();a.copyTextureToBuffer({texture:e},{buffer:n,bytesPerRow:i},{width:t,height:s}),this.device.queue.submit([a.finish()]),await n.mapAsync(GPUMapMode.READ);const o=new Uint8Array(n.getMappedRange()),l=new Uint8ClampedArray(t*s*4);for(let p=0;p<s;p++){const m=p*i,f=p*t*4;l.set(o.subarray(m,m+t*4),f)}n.unmap(),n.destroy();const d=new OffscreenCanvas(t,s),u=d.getContext("2d");if(!u)throw new Error("Failed to get 2D context");const h=new ImageData(l,t,s);return u.putImageData(h,0,0),createImageBitmap(d)}async canvas2DFallback(e,t,s){const i=new OffscreenCanvas(t,s),n=i.getContext("2d");if(!n)throw new Error("Failed to get 2D context");return n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(e,0,0,t,s),createImageBitmap(i)}getLastProcessingTime(){return this.lastProcessingTime}isInitialized(){return this.initialized}clearTexturePool(){for(const e of this.texturePool.values())for(const t of e)t.texture.destroy();this.texturePool.clear()}dispose(){this.clearTexturePool(),this.device=null,this.initialized=!1,this.lanczosPipeline=null,this.edgeDetectPipeline=null,this.edgeDirectedPipeline=null,this.sharpenPipeline=null,this.lanczosBindGroupLayout=null,this.edgeDetectBindGroupLayout=null,this.edgeDirectedBindGroupLayout=null,this.sharpenBindGroupLayout=null}}let Ef=null;function DW(){return Ef||(Ef=new IW),Ef}const FW={sampleRate:48e3,channels:2,bufferSize:4096,latencyHint:"interactive"};class BW{size;cosTable;sinTable;reverseTable;constructor(e){if(e<=0||e&e-1)throw new Error("FFT size must be a power of 2");this.size=e,this.cosTable=new Float32Array(e/2),this.sinTable=new Float32Array(e/2),this.reverseTable=new Uint32Array(e);for(let s=0;s<e/2;s++){const i=-2*Math.PI*s/e;this.cosTable[s]=Math.cos(i),this.sinTable[s]=Math.sin(i)}const t=Math.log2(e);for(let s=0;s<e;s++){let i=0;for(let n=0;n<t;n++)i=i<<1|s>>n&1;this.reverseTable[s]=i}}getSize(){return this.size}forward(e){const t=this.size,s=new Float32Array(t),i=new Float32Array(t);for(let n=0;n<t;n++)s[this.reverseTable[n]]=e[n]||0;for(let n=2;n<=t;n*=2){const a=n/2,o=t/n;for(let l=0;l<t;l+=n)for(let d=0;d<a;d++){const u=d*o,h=this.cosTable[u],p=this.sinTable[u],m=l+d,f=l+d+a,g=s[f]*h-i[f]*p,y=s[f]*p+i[f]*h;s[f]=s[m]-g,i[f]=i[m]-y,s[m]=s[m]+g,i[m]=i[m]+y}}return{real:s,imag:i}}inverse(e,t){const s=this.size,i=new Float32Array(s),n=new Float32Array(s);for(let o=0;o<s;o++)i[this.reverseTable[o]]=e[o],n[this.reverseTable[o]]=-t[o];for(let o=2;o<=s;o*=2){const l=o/2,d=s/o;for(let u=0;u<s;u+=o)for(let h=0;h<l;h++){const p=h*d,m=this.cosTable[p],f=this.sinTable[p],g=u+h,y=u+h+l,x=i[y]*m-n[y]*f,v=i[y]*f+n[y]*m;i[y]=i[g]-x,n[y]=n[g]-v,i[g]=i[g]+x,n[g]=n[g]+v}}const a=new Float32Array(s);for(let o=0;o<s;o++)a[o]=i[o]/s;return a}getMagnitude(e,t){const s=this.size/2,i=new Float32Array(s);for(let n=0;n<s;n++)i[n]=Math.sqrt(e[n]*e[n]+t[n]*t[n]);return i}getPower(e,t){const s=this.size/2,i=new Float32Array(s);for(let n=0;n<s;n++)i[n]=e[n]*e[n]+t[n]*t[n];return i}getMagnitudeAndPhase(e,t){const s=this.size/2,i=new Float32Array(s),n=new Float32Array(s);for(let a=0;a<s;a++)i[a]=Math.sqrt(e[a]*e[a]+t[a]*t[a]),n[a]=Math.atan2(t[a],e[a]);return{magnitudes:i,phases:n}}fromMagnitudeAndPhase(e,t){const s=this.size,i=e.length,n=new Float32Array(s),a=new Float32Array(s);for(let o=0;o<i;o++)n[o]=e[o]*Math.cos(t[o]),a[o]=e[o]*Math.sin(t[o]);for(let o=1;o<i;o++)n[s-o]=n[o],a[s-o]=-a[o];return{real:n,imag:a}}applyHannWindow(e){const t=new Float32Array(e.length),s=e.length;for(let i=0;i<s;i++){const n=.5*(1-Math.cos(2*Math.PI*i/(s-1)));t[i]=e[i]*n}return t}applySynthesisWindow(e){const t=new Float32Array(e.length),s=e.length;for(let i=0;i<s;i++){const n=.5*(1-Math.cos(2*Math.PI*i/(s-1)));t[i]=e[i]*n}return t}}class LW{audioContext=null;masterGain=null;initialized=!1;config;trackNodes=new Map;mediaBuffers=new Map;constructor(e={}){this.config={...FW,...e}}async initialize(){if(!this.initialized)try{this.audioContext=new AudioContext({sampleRate:this.config.sampleRate,latencyHint:this.config.latencyHint}),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.initialized=!0}catch(e){throw new Error(`AudioEngine initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}}isInitialized(){return this.initialized}getAudioContext(){return this.ensureInitialized(),this.audioContext}ensureInitialized(){if(!this.initialized||!this.audioContext)throw new Error("AudioEngine not initialized. Call initialize() first.")}async renderAudio(e,t,s){this.ensureInitialized();const{timeline:i,mediaLibrary:n,settings:a}=e,o=a.sampleRate||this.config.sampleRate,l=a.channels||this.config.channels,d=Math.max(s,.001),u=Math.max(1,Math.ceil(d*o)),h=new OfflineAudioContext(l,u,o),p=this.getAudioTracksAtTime(i,t,s),m=p.some(g=>g.solo);for(const g of p)if(!this.isTrackMuted(g,m))for(const y of g.clips){const x=n.items.find(b=>b.id===y.mediaId);if(!x)continue;const v=await this.getAudioBuffer(x,h);v&&await this.renderClipToContext(h,v,y,t)}return{buffer:await h.startRendering(),startTime:t,duration:s,channels:l,sampleRate:o}}isTrackMuted(e,t){return!!(e.muted||t&&!e.solo)}getEffectiveTrackAudibility(e){const t=new Map,s=e.some(i=>i.solo);for(const i of e){const n=!i.muted&&(!s||i.solo);t.set(i.id,n)}return t}getAudioTracksAtTime(e,t,s){const i=[],n=t+s;return e.tracks.forEach((a,o)=>{if(a.type!=="audio"&&a.type!=="video")return;const l=this.getClipsInRange(a,t,n);l.length!==0&&i.push({trackId:a.id,index:o,muted:a.muted,solo:a.solo,clips:l.map(d=>this.createClipRenderInfo(d,t,n))})}),i}getClipsInRange(e,t,s){return e.clips.filter(i=>{const n=i.startTime+i.duration;return i.startTime<s&&n>t})}createClipRenderInfo(e,t,s){const i=Math.max(e.startTime,t),n=Math.min(e.startTime+e.duration,s),a=i-e.startTime,o=e.inPoint+a,l=e.effects.find(u=>u.type==="pan"),d=l&&typeof l.params.value=="number"?l.params.value:0;return{clipId:e.id,mediaId:e.mediaId,sourceTime:o,timelineStartTime:i,duration:n-i,volume:e.volume,pan:d,effects:e.effects,fadeIn:e.fade?.fadeIn,fadeOut:e.fade?.fadeOut,speed:e.speed||1,reversed:e.reversed||!1}}async getAudioBuffer(e,t){const s=this.mediaBuffers.get(e.id);if(s)return s;if(!e.blob)return console.warn(`No blob available for media item ${e.id}`),null;try{const i=await e.blob.arrayBuffer(),n=await t.decodeAudioData(i);return this.mediaBuffers.set(e.id,n),n}catch{if(e.type==="video")try{const n=await this.extractAudioFromVideo(e,t);if(n)return this.mediaBuffers.set(e.id,n),n}catch{}return null}}async extractAudioFromVideo(e,t){if(!e.blob)return null;try{const s=await hi(()=>import("./index2.js"),[]),{Input:i,ALL_FORMATS:n,BlobSource:a,AudioSampleSink:o}=s,l=new i({source:new a(e.blob),formats:n});let d=await l.getPrimaryAudioTrack();if(!d){const T=await l.getAudioTracks();T.length>0&&(d=T[0])}if(!d||!await d.canDecode())return l[Symbol.dispose]?.(),null;const h=await d.computeDuration();if(!h||h<=0)return l[Symbol.dispose]?.(),null;const p=t.sampleRate,m=2,f=1e3,g=Math.ceil(h*f),y=new o(d),x=Array.from({length:g},(T,j)=>j/f),v=[];for await(const T of y.samplesAtTimestamps(x)){if(!T){v.push(new Float32Array(0));continue}const j=T.allocationSize({format:"f32",planeIndex:0}),_=new Float32Array(j/4);T.copyTo(_,{format:"f32",planeIndex:0}),v.push(_),T.close()}l[Symbol.dispose]?.();const b=Math.ceil(h*p),S=new Float32Array(b),k=new Float32Array(b);let C=0;for(const T of v){if(T.length===0)continue;const j=T.length>=2?2:1,_=Math.floor(T.length/j);for(let M=0;M<_&&C<b;M++)j===2?(S[C]=T[M*2]||0,k[C]=T[M*2+1]||0):(S[C]=T[M]||0,k[C]=T[M]||0),C++}if(C===0)return null;const A=t.createBuffer(m,C,p);return A.copyToChannel(S.subarray(0,C),0),A.copyToChannel(k.subarray(0,C),1),A}catch{return null}}async renderClipToContext(e,t,s,i){const n=e.createBufferSource();n.buffer=t;const a=s.speed||1,o=s.reversed||!1;n.playbackRate.value=o?-a:a;const l=e.createGain();l.gain.value=s.volume;const d=e.createStereoPanner();d.pan.value=Math.max(-1,Math.min(1,s.pan)),n.connect(l),l.connect(d),d.connect(e.destination);const u=Math.max(0,s.timelineStartTime-i);this.applyFades(l,s,u);const h=o?t.duration-s.sourceTime:s.sourceTime;n.start(u,h,s.duration)}applyFades(e,t,s){const{fadeIn:i,fadeOut:n,duration:a,volume:o}=t;if(i&&i>0&&(e.gain.setValueAtTime(0,s),e.gain.linearRampToValueAtTime(o,s+i)),n&&n>0){const l=s+a-n;e.gain.setValueAtTime(o,l),e.gain.linearRampToValueAtTime(0,s+a)}}async mixTracks(e,t,s){if(this.ensureInitialized(),e.length===0)return this.audioContext.createBuffer(this.config.channels,this.config.sampleRate,this.config.sampleRate);const i=Math.max(...e.map(o=>o.length)),n=e[0].sampleRate,a=new OfflineAudioContext(this.config.channels,i,n);for(let o=0;o<e.length;o++){const l=a.createBufferSource();l.buffer=e[o];const d=a.createGain();d.gain.value=t[o]??1;const u=a.createStereoPanner();u.pan.value=Math.max(-1,Math.min(1,s[o]??0)),l.connect(d),d.connect(u),u.connect(a.destination),l.start(0)}return a.startRendering()}getChannelStates(e){return e.tracks.filter(t=>t.type==="audio"||t.type==="video").map(t=>({trackId:t.id,volume:1,pan:0,muted:t.muted,solo:t.solo,peakLevel:0,rmsLevel:0}))}async applyEffect(e,t){if(this.ensureInitialized(),!t.enabled)return e;const s=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),i=s.createBufferSource();i.buffer=e;const n=this.createEffectNode(s,t);return n?(i.connect(n),n.connect(s.destination)):i.connect(s.destination),i.start(0),s.startRendering()}createEffectNode(e,t){const s=t.params;switch(t.type){case"gain":const i=e.createGain();return i.gain.value=s.value??1,i;case"pan":const n=e.createStereoPanner();return n.pan.value=Math.max(-1,Math.min(1,s.value??0)),n;case"eq":return this.createEQNode(e,t);case"compressor":const a=e.createDynamicsCompressor();return a.threshold.value=s.threshold??-24,a.ratio.value=s.ratio??4,a.attack.value=s.attack??.003,a.release.value=s.release??.25,a.knee.value=s.knee??30,a;case"delay":const o=e.createDelay(2);return o.delayTime.value=s.time??.5,o;default:return null}}createEQNode(e,t){const s=t.params.bands;if(!s||s.length===0)return null;let i=null,n=null;for(const a of s){const o=e.createBiquadFilter();o.type=a.type,o.frequency.value=a.frequency,o.gain.value=a.gain,o.Q.value=a.q,i||(i=o),n&&n.connect(o),n=o}return i}detectSilence(e,t=-60){const s=[],i=e.getChannelData(0),n=e.sampleRate,a=Math.pow(10,t/20);let o=null;const l=Math.floor(n*.1);for(let d=0;d<i.length;d+=l){const u=Math.min(d+l,i.length);let h=0;for(let f=d;f<u;f++)h=Math.max(h,Math.abs(i[f]));const p=h<a,m=d/n;p&&o===null?o=m:!p&&o!==null&&(s.push({start:o,end:m}),o=null)}return o!==null&&s.push({start:o,end:e.duration}),s}measureLoudness(e){const t=e.getChannelData(0);let s=0,i=0;for(let d=0;d<t.length;d++){const u=t[d];s+=u*u,i=Math.max(i,Math.abs(u))}const n=Math.sqrt(s/t.length),a=20*Math.log10(n||1e-4),o=20*Math.log10(i||1e-4),l=a-.691;return{integrated:l,shortTerm:l,momentary:l,truePeak:o,range:10}}clearCache(){this.mediaBuffers.clear()}async resume(){this.audioContext?.state==="suspended"&&await this.audioContext.resume()}async suspend(){this.audioContext?.state==="running"&&await this.audioContext.suspend()}async dispose(){this.clearCache(),this.trackNodes.clear(),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),this.masterGain=null,this.initialized=!1}}let Mf=null;function kb(){return Mf||(Mf=new LW),Mf}class OW{audioContext=null;impulseResponses=new Map;noiseProfiles=new Map;initialized=!1;constructor(e){this.audioContext=e||null}async initialize(e){e&&(this.audioContext=e),this.audioContext||(this.audioContext=new AudioContext({latencyHint:"interactive",sampleRate:48e3})),this.initialized=!0}isInitialized(){return this.initialized&&this.audioContext!==null}getAudioContext(){return this.ensureInitialized(),this.audioContext}ensureInitialized(){if(!this.initialized||!this.audioContext)throw new Error("AudioEffectsEngine not initialized. Call initialize() first.")}async applyEffectChain(e,t){this.ensureInitialized();const s=t.filter(u=>u.enabled);if(s.length===0)return{buffer:e,appliedEffects:[]};const i=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),n=i.createBufferSource();n.buffer=e;const{firstNode:a,lastNode:o,appliedEffects:l}=await this.buildEffectChain(i,s);return a&&o?(n.connect(a),o.connect(i.destination)):n.connect(i.destination),n.start(0),{buffer:await i.startRendering(),appliedEffects:l}}async buildEffectChain(e,t){let s=null,i=null;const n=[];for(const a of t){if(!a.enabled)continue;const o=await this.createEffectNode(e,a);o&&(n.push(a.type),s||(s=o.input),i&&i.connect(o.input),i=o.output)}return{firstNode:s,lastNode:i,appliedEffects:n}}async createEffectNode(e,t){switch(t.type){case"eq":return this.createEQNodePair(e,t);case"compressor":return this.createCompressorNodePair(e,t);case"reverb":return await this.createReverbNode(e,t);case"delay":return this.createDelayNode(e,t);case"noiseReduction":return this.createNoiseReductionNodePair(e,t);case"gain":return this.createGainNodePair(e,t);default:return null}}createEQNodePair(e,t){const i=t.params?.bands;if(!i||i.length===0)return null;let n=null,a=null;for(const o of i){const l=e.createBiquadFilter();l.type=this.mapEQBandType(o.type),l.frequency.value=Math.max(20,Math.min(2e4,o.frequency)),l.gain.value=Math.max(-24,Math.min(24,o.gain)),l.Q.value=Math.max(.1,Math.min(18,o.q)),n||(n=l),a&&a.connect(l),a=l}return!n||!a?null:{input:n,output:a}}createEQNode(e,t){return this.createEQNodePair(e,t)?.input??null}mapEQBandType(e){return{lowshelf:"lowshelf",highshelf:"highshelf",peaking:"peaking",lowpass:"lowpass",highpass:"highpass",notch:"notch"}[e]||"peaking"}createCompressorNodePair(e,t){const s=this.createCompressorNode(e,t);return{input:s,output:s}}createCompressorNode(e,t){const s=t.params,i=e.createDynamicsCompressor();return i.threshold.value=Math.max(-60,Math.min(0,s?.threshold??-24)),i.ratio.value=Math.max(1,Math.min(20,s?.ratio??4)),i.attack.value=Math.max(.001,Math.min(1,s?.attack??.003)),i.release.value=Math.max(.01,Math.min(3,s?.release??.25)),i.knee.value=Math.max(0,Math.min(40,s?.knee??30)),i}async createReverbNode(e,t){const s=t.params,i=e.createGain(),n=e.createGain(),a=e.createGain(),o=e.createGain(),l=e.createConvolver();n.gain.value=s?.dryLevel??.7,a.gain.value=s?.wetLevel??.5;const d=await this.getOrCreateImpulseResponse(e,s?.roomSize??.5,s?.damping??.5);l.buffer=d;let u=null;return s?.preDelay&&s.preDelay>0&&(u=e.createDelay(.1),u.delayTime.value=Math.min(.1,s.preDelay/1e3)),i.connect(n),n.connect(o),u?(i.connect(u),u.connect(l)):i.connect(l),l.connect(a),a.connect(o),{input:i,output:o}}async getOrCreateImpulseResponse(e,t,s){const i=`${t.toFixed(2)}_${s.toFixed(2)}`;if(this.impulseResponses.has(i))return this.impulseResponses.get(i);const n=this.generateImpulseResponse(e,t,s);return this.impulseResponses.set(i,n),n}generateImpulseResponse(e,t,s){const i=e.sampleRate,n=.5+t*3.5,a=Math.floor(i*n),o=2,l=e.createBuffer(o,a,i);for(let d=0;d<o;d++){const u=l.getChannelData(d);for(let h=0;h<a;h++){const p=h/i,m=Math.exp(-3*p/n),f=(Math.random()*2-1)*m,g=1-s*p/n;u[h]=f*g}}return l}createDelayNode(e,t){const s=t.params,i=e.createGain(),n=e.createDelay(2),a=e.createGain(),o=e.createGain(),l=e.createGain(),d=e.createGain();return n.delayTime.value=Math.max(0,Math.min(2,s?.time??.5)),a.gain.value=Math.max(0,Math.min(.95,s?.feedback??.3)),o.gain.value=s?.wetLevel??.5,l.gain.value=1-(s?.wetLevel??.5),i.connect(l),l.connect(d),i.connect(n),n.connect(a),a.connect(n),n.connect(o),o.connect(d),{input:i,output:d}}createGainNodePair(e,t){const s=this.createGainNode(e,t);return{input:s,output:s}}createGainNode(e,t){const s=t.params,i=e.createGain();return i.gain.value=Math.max(0,Math.min(4,s?.value??1)),i}createNoiseReductionNodePair(e,t){const s=t.params,i=e.createGain(),n=e.createGain(),a=this.createNoiseReductionBands(e,s);for(const o of a)i.connect(o.filter),o.filter.connect(o.gate),o.gate.connect(n);return{input:i,output:n}}createNoiseReductionNode(e,t){return this.createNoiseReductionNodePair(e,t).input}createNoiseReductionBands(e,t){const s=t?.threshold??-40,i=t?.reduction??.5,n=Math.pow(10,s/20),a=[63,125,250,500,1e3,2e3,4e3,8e3,16e3],o=[];for(let l=0;l<a.length;l++){const d=e.createBiquadFilter();d.type="peaking",d.frequency.value=a[l],d.Q.value=1.4;const u=e.createGain(),h=1-l/a.length*.3,p=Math.min(1,n*10);u.gain.value=1-i*h*p,o.push({filter:d,gate:u})}return o}async learnNoiseProfile(e,t){this.ensureInitialized();const s=2048,i=s/2,n=e.getChannelData(0),a=Math.max(1,Math.floor((n.length-s)/i)+1),o=new BW(s),l=new Float32Array(s/2),d=new Float32Array(s);for(let m=0;m<a;m++){const f=m*i;for(let b=0;b<s;b++)d[b]=n[f+b]||0;const g=o.applyHannWindow(d),{real:y,imag:x}=o.forward(g),v=o.getMagnitude(y,x);for(let b=0;b<l.length;b++)l[b]+=v[b]}for(let m=0;m<l.length;m++)l[m]/=a;const u=new Float32Array(s/2),h=e.sampleRate/s;for(let m=0;m<u.length;m++)u[m]=m*h;const p={frequencyBins:u,magnitudes:l,sampleRate:e.sampleRate};return this.noiseProfiles.set(t,p),p}getNoiseProfile(e){return this.noiseProfiles.get(e)}async applyNoiseReductionWithProfile(e,t,s=.5){this.ensureInitialized();const i=this.noiseProfiles.get(t);if(!i)throw new Error(`Noise profile '${t}' not found`);const n=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),a=n.createBufferSource();a.buffer=e;const o=n.createGain(),l=n.createGain(),d=this.createProfileBasedFilters(n,i,s);if(a.connect(o),d.length>0){let u=o;for(const h of d)u.connect(h),u=h;u.connect(l)}else o.connect(l);return l.connect(n.destination),a.start(0),n.startRendering()}createProfileBasedFilters(e,t,s){const i=[],n=t.magnitudes,a=t.frequencyBins,{mean:o,stdDev:l}=this.calculateNoiseStatistics(n),d=o+l*2,u=new Set;for(let f=2;f<n.length-2;f++){const g=n[f],y=a[f];if(y<60||u.has(f))continue;if(g>n[f-2]&&g>n[f-1]&&g>n[f+1]&&g>n[f+2]&&g>d){const v=e.createBiquadFilter();v.type="notch",v.frequency.value=Math.max(20,Math.min(2e4,y));const b=g/((n[f-1]+n[f+1])/2);v.Q.value=Math.min(30,Math.max(5,b*10)),i.push(v);for(let S=f-2;S<=f+2;S++)u.add(S)}}const h=[125,250,500,1e3,2e3,4e3,8e3],p=t.sampleRate/(n.length*2);for(const f of h){const g=Math.round(f/p);if(g>=n.length||u.has(g))continue;const y=Math.max(0,g-5),x=Math.min(n.length-1,g+5);let v=0;for(let b=y;b<=x;b++)v+=n[b];if(v/=x-y+1,v>o*1.2){const b=e.createBiquadFilter();b.type="peaking",b.frequency.value=f,b.Q.value=1.4;const S=(v-o)/o,k=-s*Math.min(12,S*6);b.gain.value=k,i.push(b)}}if(this.calculateLowFrequencyEnergy(n,p)>o*1.5){const f=e.createBiquadFilter();f.type="highpass",f.frequency.value=80,f.Q.value=.707,i.push(f)}if(i.length===0){const f=e.createBiquadFilter();f.type="highpass",f.frequency.value=60,f.Q.value=.5,i.push(f)}return i}calculateNoiseStatistics(e){let t=0;for(let a=0;a<e.length;a++)t+=e[a];const s=t/e.length;let i=0;for(let a=0;a<e.length;a++){const o=e[a]-s;i+=o*o}const n=Math.sqrt(i/e.length);return{mean:s,stdDev:n}}calculateLowFrequencyEnergy(e,t){const s=Math.min(e.length,Math.ceil(200/t));let i=0;for(let n=0;n<s;n++)i+=e[n];return i/s}clearImpulseResponseCache(){this.impulseResponses.clear()}clearNoiseProfiles(){this.noiseProfiles.clear()}async dispose(){this.clearImpulseResponseCache(),this.clearNoiseProfiles(),this.audioContext&&"close"in this.audioContext&&await this.audioContext.close(),this.audioContext=null,this.initialized=!1}}let Pf=null;function $W(){return Pf||(Pf=new OW),Pf}class CM{audioContext;state="stopped";playbackRate=1;startAudioContextTime=0;startTimelineTime=0;pausedAt=0;duration=0;loopEnabled=!1;loopStart=0;loopEnd=0;subscribers=new Set;animationFrameId=null;frameRate;frameDuration;_lastVideoTime=0;driftMs=0;constructor(e={}){this.audioContext=e.audioContext||new AudioContext,this.frameRate=e.frameRate||30,this.frameDuration=1e3/this.frameRate}get currentTime(){if(this.state==="stopped"||this.state==="paused")return this.pausedAt;const e=(this.audioContext.currentTime-this.startAudioContextTime)*this.playbackRate;let t=this.startTimelineTime+e;if(this.loopEnabled&&this.loopEnd>this.loopStart&&t>=this.loopEnd){const s=this.loopEnd-this.loopStart;t=this.loopStart+(t-this.loopStart)%s}return Math.max(0,Math.min(t,this.duration||1/0))}get isPlaying(){return this.state==="playing"}get isPaused(){return this.state==="paused"}get isStopped(){return this.state==="stopped"}get rate(){return this.playbackRate}get drift(){return this.driftMs}get lastReportedVideoTime(){return this._lastVideoTime}getAudioContext(){return this.audioContext}setDuration(e){this.duration=e}setLoop(e,t=0,s=0){this.loopEnabled=e,this.loopStart=t,this.loopEnd=s}setPlaybackRate(e){if(this.state==="playing"){const t=this.currentTime;this.startTimelineTime=t,this.startAudioContextTime=this.audioContext.currentTime}this.playbackRate=Math.max(.1,Math.min(e,16))}async play(){this.state!=="playing"&&(this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.startTimelineTime=this.pausedAt,this.startAudioContextTime=this.audioContext.currentTime,this.state="playing",this.notifyStateChange(),this.startUpdateLoop())}pause(){this.state==="playing"&&(this.pausedAt=this.currentTime,this.state="paused",this.stopUpdateLoop(),this.notifyStateChange())}stop(){this.pausedAt=0,this.state="stopped",this.stopUpdateLoop(),this.notifyStateChange(),this.notifyTimeUpdate(0)}seek(e){const t=Math.max(0,Math.min(e,this.duration||1/0));this.state==="playing"?(this.startTimelineTime=t,this.startAudioContextTime=this.audioContext.currentTime):this.pausedAt=t,this.notifyTimeUpdate(t)}seekRelative(e){this.seek(this.currentTime+e)}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}reportVideoTime(e){this._lastVideoTime=e;const t=this.currentTime;this.driftMs=(t-e)*1e3}shouldSkipFrame(){return this.driftMs>this.frameDuration}shouldRepeatFrame(){return this.driftMs<-this.frameDuration}startUpdateLoop(){if(this.animationFrameId!==null){console.log("[MasterClock] startUpdateLoop called but animation frame already exists");return}const e=()=>{if(this.state!=="playing"){console.log(`[MasterClock] Update loop stopped - state is ${this.state}`);return}const t=(this.audioContext.currentTime-this.startAudioContextTime)*this.playbackRate,s=this.startTimelineTime+t;if(this.duration>0&&s>=this.duration&&!this.loopEnabled){this.pausedAt=this.duration,this.state="paused",this.notifyStateChange(),this.notifyStateChange(),this.notifyTimeUpdate(this.duration);return}const i=this.currentTime;this.notifyTimeUpdate(i),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopUpdateLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}notifyTimeUpdate(e){for(const t of this.subscribers)try{t.onTimeUpdate(e)}catch(s){console.error("[MasterClock] Subscriber error:",s)}}notifyStateChange(){for(const e of this.subscribers)try{e.onStateChange?.(this.state)}catch(t){console.error("[MasterClock] Subscriber error:",t)}}dispose(){this.stopUpdateLoop(),this.subscribers.clear(),this.state="stopped"}}let po=null;function Bh(){return po||(po=new CM),po}function zW(r={}){return po&&po.dispose(),po=new CM(r),po}class SM{audioContext;masterClock;masterGain;trackNodes=new Map;scheduledSources=new Map;trackConfigs=new Map;hasSoloTracks=!1;impulseResponseCache=new Map;isPlaying=!1;lastScheduledTime=0;seekPending=!1;scheduleAheadTime=.2;schedulerIntervalId=null;constructor(e){this.masterClock=e||Bh(),this.audioContext=this.masterClock.getAudioContext(),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination)}getAudioContext(){return this.audioContext}getMasterGain(){return this.masterGain}setMasterVolume(e){this.masterGain.gain.setValueAtTime(Math.max(0,Math.min(4,e)),this.audioContext.currentTime)}createTrack(e){this.removeTrack(e.trackId),this.trackConfigs.set(e.trackId,e);const t=this.audioContext.createGain(),s=this.audioContext.createStereoPanner();s.pan.value=Math.max(-1,Math.min(1,e.pan));const i=this.audioContext.createGain();i.gain.value=e.volume;const{effectChainInput:n,effectChainOutput:a,compressor:o,eqFilters:l,reverbNodes:d,delayNodes:u}=this.buildEffectChain(e.effects);t.connect(n),a.connect(s),s.connect(i),i.connect(this.masterGain);const h={inputGain:t,effectChainInput:n,effectChainOutput:a,panNode:s,outputGain:i,compressor:o,eqFilters:l,reverbNodes:d,delayNodes:u};this.trackNodes.set(e.trackId,h),this.scheduledSources.set(e.trackId,[]),this.updateTrackAudibility(e.trackId),this.updateSoloState()}buildEffectChain(e){const t=this.audioContext.createGain();let s=null;const i=[];let n=null,a=null;const o=e.filter(u=>u.enabled);if(o.length===0)return{effectChainInput:t,effectChainOutput:t,compressor:s,eqFilters:i,reverbNodes:n,delayNodes:a};let l=t,d=t;for(const u of o)switch(u.type){case"compressor":{s=this.createCompressorNode(u),l.connect(s),l=s;break}case"eq":{const h=this.createEQFilters(u);if(h.length>0){l.connect(h[0]);for(let p=1;p<h.length;p++)h[p-1].connect(h[p]);l=h[h.length-1],i.push(...h)}break}case"reverb":{n=this.createReverbNodes(u),l.connect(n.inputGain),l=n.outputGain;break}case"delay":{a=this.createDelayNodes(u),l.connect(a.inputGain),l=a.outputGain;break}}return{effectChainInput:d,effectChainOutput:l,compressor:s,eqFilters:i,reverbNodes:n,delayNodes:a}}createCompressorNode(e){const t=e.params,s=this.audioContext.createDynamicsCompressor();return s.threshold.value=t.threshold??-24,s.ratio.value=t.ratio??4,s.attack.value=t.attack??.003,s.release.value=t.release??.25,s.knee.value=t.knee??30,s}createEQFilters(e){const s=e.params.bands||[],i=[];for(const n of s){const a=this.audioContext.createBiquadFilter();a.type=n.type,a.frequency.value=Math.max(20,Math.min(2e4,n.frequency)),a.gain.value=Math.max(-24,Math.min(24,n.gain)),a.Q.value=Math.max(.1,Math.min(18,n.q)),i.push(a)}return i}createReverbNodes(e){const t=e.params,s=t.roomSize??.5,i=t.damping??.5,n=t.wetLevel??.5,a=t.dryLevel??.7,o=this.audioContext.createGain(),l=this.audioContext.createGain(),d=this.audioContext.createGain(),u=this.audioContext.createConvolver(),h=this.audioContext.createGain();l.gain.value=a,d.gain.value=n;const p=this.getOrCreateImpulseResponse(s,i);return u.buffer=p,o.connect(l),l.connect(h),o.connect(u),u.connect(d),d.connect(h),{inputGain:o,dryGain:l,wetGain:d,convolver:u,outputGain:h}}getOrCreateImpulseResponse(e,t){const s=`${e.toFixed(2)}_${t.toFixed(2)}`;if(this.impulseResponseCache.has(s))return this.impulseResponseCache.get(s);const i=this.audioContext.sampleRate,n=.5+e*3.5,a=Math.floor(i*n),o=2,l=this.audioContext.createBuffer(o,a,i);for(let d=0;d<o;d++){const u=l.getChannelData(d);for(let h=0;h<a;h++){const p=h/i,m=Math.exp(-3*p/n),f=(Math.random()*2-1)*m,g=1-t*p/n;u[h]=f*g}}return this.impulseResponseCache.set(s,l),l}createDelayNodes(e){const t=e.params,s=t.time??.5,i=t.feedback??.3,n=t.wetLevel??.5,a=this.audioContext.createGain(),o=this.audioContext.createDelay(2),l=this.audioContext.createGain(),d=this.audioContext.createGain(),u=this.audioContext.createGain(),h=this.audioContext.createGain();return o.delayTime.value=Math.max(0,Math.min(2,s)),l.gain.value=Math.max(0,Math.min(.95,i)),d.gain.value=n,u.gain.value=1-n,a.connect(u),u.connect(h),a.connect(o),o.connect(l),l.connect(o),o.connect(d),d.connect(h),{inputGain:a,delayNode:o,feedbackGain:l,wetGain:d,dryGain:u,outputGain:h}}removeTrack(e){const t=this.scheduledSources.get(e);if(t)for(const i of t)try{i.source.stop(),i.source.disconnect()}catch{}this.scheduledSources.delete(e);const s=this.trackNodes.get(e);if(s){s.inputGain.disconnect(),s.panNode.disconnect(),s.outputGain.disconnect(),s.compressor&&s.compressor.disconnect();for(const i of s.eqFilters)i.disconnect();s.reverbNodes&&(s.reverbNodes.inputGain.disconnect(),s.reverbNodes.dryGain.disconnect(),s.reverbNodes.wetGain.disconnect(),s.reverbNodes.convolver.disconnect(),s.reverbNodes.outputGain.disconnect()),s.delayNodes&&(s.delayNodes.inputGain.disconnect(),s.delayNodes.delayNode.disconnect(),s.delayNodes.feedbackGain.disconnect(),s.delayNodes.wetGain.disconnect(),s.delayNodes.dryGain.disconnect(),s.delayNodes.outputGain.disconnect())}this.trackNodes.delete(e),this.trackConfigs.delete(e),this.updateSoloState()}updateTrackVolume(e,t){const s=this.trackNodes.get(e),i=this.trackConfigs.get(e);s&&i&&(i.volume=Math.max(0,Math.min(4,t)),this.updateTrackAudibility(e))}updateTrackPan(e,t){const s=this.trackNodes.get(e);s&&s.panNode.pan.setValueAtTime(Math.max(-1,Math.min(1,t)),this.audioContext.currentTime);const i=this.trackConfigs.get(e);i&&(i.pan=t)}setTrackMuted(e,t){const s=this.trackConfigs.get(e);s&&(s.muted=t,this.updateTrackAudibility(e))}setTrackSolo(e,t){const s=this.trackConfigs.get(e);s&&(s.solo=t,this.updateSoloState())}updateSoloState(){this.hasSoloTracks=Array.from(this.trackConfigs.values()).some(e=>e.solo);for(const e of this.trackNodes.keys())this.updateTrackAudibility(e)}updateTrackAudibility(e){const t=this.trackNodes.get(e),s=this.trackConfigs.get(e);if(!t||!s)return;let i=!0;(s.muted||this.hasSoloTracks&&!s.solo)&&(i=!1);const n=i?s.volume:0;t.outputGain.gain.setValueAtTime(n,this.audioContext.currentTime)}updateTrackEffects(e,t){const s=this.trackConfigs.get(e);s&&(s.effects=t,this.createTrack(s))}scheduleClip(e){const t=this.trackNodes.get(e.trackId),s=this.trackConfigs.get(e.trackId);t?s&&JSON.stringify(s.effects)!==JSON.stringify(e.effects)&&this.updateTrackEffects(e.trackId,e.effects):this.createTrack({trackId:e.trackId,volume:e.volume,pan:e.pan,muted:!1,solo:!1,effects:e.effects});const i=this.trackNodes.get(e.trackId);if(!i)return;const n=this.audioContext.createBufferSource();n.buffer=e.audioBuffer,n.playbackRate.value=e.speed;const a=this.audioContext.createGain();a.gain.value=e.volume,n.connect(a),a.connect(i.inputGain);const o=this.audioContext.currentTime+e.startTime-this.masterClock.currentTime,l=e.endTime-e.startTime;if(o>this.audioContext.currentTime)n.start(o,e.mediaOffset,l);else{const h=this.masterClock.currentTime-e.startTime+e.mediaOffset,p=l-(this.masterClock.currentTime-e.startTime);p>0&&h<e.audioBuffer.duration&&n.start(0,h,p)}const d={clipId:e.clipId,source:n,startedAt:e.startTime,duration:l},u=this.scheduledSources.get(e.trackId)||[];u.push(d),this.scheduledSources.set(e.trackId,u),n.onended=()=>{const h=this.scheduledSources.get(e.trackId);if(h){const p=h.indexOf(d);p>-1&&h.splice(p,1)}}}scheduleClips(e){for(const t of e)this.scheduleClip(t)}stopAllClips(){for(const[,e]of this.scheduledSources){for(const t of e)try{t.source.stop(),t.source.disconnect()}catch{}e.length=0}}stopClip(e){for(const[,t]of this.scheduledSources){const s=t.findIndex(i=>i.clipId===e);if(s>-1){const i=t[s];try{i.source.stop(),i.source.disconnect()}catch{}t.splice(s,1);break}}}async resume(){this.audioContext.state==="suspended"&&await this.audioContext.resume()}async suspend(){this.stopAllClips(),this.audioContext.state==="running"&&await this.audioContext.suspend()}startScheduler(e){if(this.schedulerIntervalId!==null)return;this.isPlaying=!0,this.seekPending||(this.lastScheduledTime=this.masterClock.currentTime),this.seekPending=!1;const t=()=>{if(!this.isPlaying)return;const i=this.masterClock.currentTime+this.scheduleAheadTime;if(i>this.lastScheduledTime){const n=e(this.lastScheduledTime);for(const a of n)a.startTime<=i&&a.endTime>this.lastScheduledTime&&((this.scheduledSources.get(a.trackId)||[]).some(d=>d.clipId===a.clipId)||this.scheduleClip(a));this.lastScheduledTime=i}};this.schedulerIntervalId=window.setInterval(t,100),t()}stopScheduler(){this.isPlaying=!1,this.schedulerIntervalId!==null&&(window.clearInterval(this.schedulerIntervalId),this.schedulerIntervalId=null),this.stopAllClips()}seekTo(e){this.stopAllClips(),this.lastScheduledTime=e,this.seekPending=!0}dispose(){this.stopScheduler();for(const e of Array.from(this.trackNodes.keys()))this.removeTrack(e);this.impulseResponseCache.clear(),this.masterGain.disconnect()}}let mo=null;function eh(){return mo||(mo=new SM),mo}function VW(r){return mo&&mo.dispose(),mo=new SM(r),mo}const UW={C1:32.7,D1:36.71,E1:41.2,F1:43.65,G1:49,A1:55,B1:61.74,C2:65.41,D2:73.42,E2:82.41,F2:87.31,G2:98,A2:110,B2:123.47,C3:130.81,D3:146.83,E3:164.81,F3:174.61,G3:196,A3:220,B3:246.94,C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,C5:523.25,D5:587.33,E5:659.25,F5:698.46,G5:783.99,A5:880,B5:987.77,C6:1046.5,D6:1174.66,E6:1318.51,F6:1396.91,G6:1567.98,A6:1760,B6:1975.53,"C#2":69.3,"D#2":77.78,"F#2":92.5,"G#2":103.83,"A#2":116.54,"C#3":138.59,"D#3":155.56,"F#3":185,"G#3":207.65,"A#3":233.08,"C#4":277.18,"D#4":311.13,"F#4":369.99,"G#4":415.3,"A#4":466.16,"C#5":554.37,"D#5":622.25,"F#5":739.99,"G#5":830.61,"A#5":932.33,Eb2:77.78,Bb2:116.54,Eb3:155.56,Bb3:233.08,Eb4:311.13,Bb4:466.16,Eb5:622.25,Bb5:932.33,Ab2:103.83,Ab3:207.65,Ab4:415.3,Ab5:830.61,Db3:138.59,Db4:277.18,Db5:554.37,Gb3:185,Gb4:369.99,Gb5:739.99},Nf={pop:[["C4","E4","G4"],["G3","B3","D4"],["A3","C4","E4"],["F3","A3","C4"]],jazz:[["C4","E4","G4","B4"],["A3","C4","E4","G4"],["D4","F4","A4","C5"],["G3","B3","D4","F4"]],lofi:[["C4","Eb4","G4"],["Ab3","C4","Eb4"],["Bb3","D4","F4"],["G3","Bb3","D4"]],cinematic:[["C4","G4","C5"],["Ab3","Eb4","Ab4"],["Bb3","F4","Bb4"],["G3","D4","G4"]],electronic:[["A3","E4","A4"],["F3","C4","F4"],["G3","D4","G4"],["A3","E4","A4"]],ambient:[["C4","G4","D5","G5"],["A3","E4","B4","E5"],["F3","C4","G4","C5"],["G3","D4","A4","D5"]]},Fl={uplifting:[["C3","G3","C4","E4","G4"],["G2","D3","G3","B3","D4"],["A2","E3","A3","C4","E4"],["F2","C3","F3","A3","C4"]],emotional:[["A2","E3","A3","C4","E4"],["F2","C3","F3","A3","C4"],["C3","G3","C4","E4","G4"],["G2","D3","G3","B3","D4"]],chill:[["D3","A3","D4","F#4","A4"],["G2","D3","G3","B3","D4"],["E3","B3","E4","G4","B4"],["A2","E3","A3","C#4","E4"]],happy:[["G3","D4","G4","B4","D5"],["C3","G3","C4","E4","G4"],["D3","A3","D4","F#4","A4"],["E3","B3","E4","G4","B4"]],funky:[["E3","G3","B3","D4"],["A3","C4","E4","G4"],["D3","F3","A3","C4"],["G3","B3","D4","F4"]]},Rf={bouncy:[0,0,4,4,7,4,2,0],flowing:[0,2,4,2,0,-1,0,2],energetic:[0,7,4,7,0,4,7,12]},GW={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],pentatonic:[0,2,4,7,9],blues:[0,3,5,6,7,10],dorian:[0,2,3,5,7,9,10]};class WW{cache=new Map;noteToFreq(e){return UW[e]||440}getScaleFrequencies(e,t,s=2){const i=[];for(let n=0;n<s;n++)for(const a of t)i.push(e*Math.pow(2,(a+n*12)/12));return i}createReverbImpulse(e,t,s){const i=e.sampleRate,n=i*t,a=e.createBuffer(2,n,i);for(let o=0;o<2;o++){const l=a.getChannelData(o);for(let d=0;d<n;d++){const u=d/i;l[d]=(Math.random()*2-1)*Math.exp(-u*s)}}return a}createWarmPad(e,t,s,i,n,a){const o=[-12,-5,0,5,7,12];o.forEach((l,d)=>{const u=e.createOscillator();u.type=d%2===0?"sine":"triangle",u.frequency.value=t,u.detune.value=l;const h=e.createBiquadFilter();h.type="lowpass",h.frequency.value=2e3+Math.sin(d)*500,h.Q.value=.5;const p=e.createGain(),m=.15,f=.3;p.gain.setValueAtTime(0,s),p.gain.linearRampToValueAtTime(n/o.length,s+m),p.gain.setValueAtTime(n/o.length*.7,s+i-f),p.gain.linearRampToValueAtTime(0,s+i),u.connect(h),h.connect(p),p.connect(a),u.start(s),u.stop(s+i)})}createPluckySynth(e,t,s,i,n,a){const o=e.createOscillator();o.type="sawtooth",o.frequency.value=t;const l=e.createOscillator();l.type="square",l.frequency.value=t*1.002;const d=e.createBiquadFilter();d.type="lowpass",d.frequency.setValueAtTime(t*8,s),d.frequency.exponentialRampToValueAtTime(t*2,s+.1),d.Q.value=2;const u=e.createGain();u.gain.setValueAtTime(0,s),u.gain.linearRampToValueAtTime(n,s+.01),u.gain.exponentialRampToValueAtTime(n*.3,s+.1),u.gain.exponentialRampToValueAtTime(.001,s+i),o.connect(d),l.connect(d),d.connect(u),u.connect(a),o.start(s),o.stop(s+i),l.start(s),l.stop(s+i)}createRichBass(e,t,s,i,n,a){const o=e.createOscillator();o.type="sine",o.frequency.value=t;const l=e.createOscillator();l.type="sawtooth",l.frequency.value=t*2;const d=e.createBiquadFilter();d.type="lowpass",d.frequency.setValueAtTime(800,s),d.frequency.exponentialRampToValueAtTime(200,s+i*.5);const u=e.createGain();u.gain.setValueAtTime(0,s),u.gain.linearRampToValueAtTime(n*.7,s+.02),u.gain.exponentialRampToValueAtTime(n*.4,s+i*.3),u.gain.linearRampToValueAtTime(0,s+i);const h=e.createGain();h.gain.setValueAtTime(0,s),h.gain.linearRampToValueAtTime(n*.3,s+.01),h.gain.exponentialRampToValueAtTime(.001,s+i*.5),o.connect(u),u.connect(a),l.connect(d),d.connect(h),h.connect(a),o.start(s),o.stop(s+i),l.start(s),l.stop(s+i)}createPunchyKick(e,t,s,i){const n=e.createOscillator();n.type="sine",n.frequency.setValueAtTime(150,t),n.frequency.exponentialRampToValueAtTime(40,t+.08);const a=e.createOscillator();a.type="triangle",a.frequency.value=1e3;const o=e.createGain();o.gain.setValueAtTime(s,t),o.gain.exponentialRampToValueAtTime(.001,t+.3);const l=e.createGain();l.gain.setValueAtTime(s*.3,t),l.gain.exponentialRampToValueAtTime(.001,t+.02);const d=e.createDynamicsCompressor();d.threshold.value=-10,d.ratio.value=4,d.attack.value=.003,d.release.value=.1,n.connect(o),a.connect(l),o.connect(d),l.connect(d),d.connect(i),n.start(t),n.stop(t+.3),a.start(t),a.stop(t+.02)}createCrispSnare(e,t,s,i){const n=e.createBuffer(1,e.sampleRate*.2,e.sampleRate),a=n.getChannelData(0);for(let p=0;p<a.length;p++)a[p]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=n;const l=e.createBiquadFilter();l.type="bandpass",l.frequency.value=5e3,l.Q.value=1;const d=e.createOscillator();d.type="triangle",d.frequency.setValueAtTime(200,t),d.frequency.exponentialRampToValueAtTime(100,t+.05);const u=e.createGain();u.gain.setValueAtTime(s*.5,t),u.gain.exponentialRampToValueAtTime(.001,t+.15);const h=e.createGain();h.gain.setValueAtTime(s*.4,t),h.gain.exponentialRampToValueAtTime(.001,t+.1),o.connect(l),l.connect(u),u.connect(i),d.connect(h),h.connect(i),o.start(t),d.start(t),d.stop(t+.1)}createShimmeringHiHat(e,t,s,i,n){const a=i?.15:.04,o=e.createBuffer(1,e.sampleRate*a,e.sampleRate),l=o.getChannelData(0);for(let m=0;m<l.length;m++)l[m]=Math.random()*2-1;const d=e.createBufferSource();d.buffer=o;const u=e.createBiquadFilter();u.type="highpass",u.frequency.value=7e3;const h=e.createBiquadFilter();h.type="bandpass",h.frequency.value=1e4,h.Q.value=.5;const p=e.createGain();p.gain.setValueAtTime(s,t),p.gain.exponentialRampToValueAtTime(.001,t+a),d.connect(u),u.connect(h),h.connect(p),p.connect(n),d.start(t)}async generateWhoosh(e,t,s,i=!0){const n=this.cache.get(e);if(n)return n;const a=44100,o=new OfflineAudioContext(2,a*s,a),l=o.createBuffer(2,a*s,a);for(let v=0;v<2;v++){const b=l.getChannelData(v);for(let S=0;S<b.length;S++)b[S]=Math.random()*2-1}const d=o.createBufferSource();d.buffer=l;const u=o.createBiquadFilter();u.type="bandpass",u.Q.value=i?5:2,u.frequency.setValueAtTime(i?2e3:800,0),u.frequency.exponentialRampToValueAtTime(i?8e3:3e3,s*.3),u.frequency.exponentialRampToValueAtTime(i?1e3:400,s);const h=o.createGain();h.gain.setValueAtTime(0,0),h.gain.linearRampToValueAtTime(.6,s*.1),h.gain.linearRampToValueAtTime(.8,s*.3),h.gain.exponentialRampToValueAtTime(.01,s);const p=o.createStereoPanner();p.pan.setValueAtTime(-.5,0),p.pan.linearRampToValueAtTime(.5,s),d.connect(u),u.connect(h),h.connect(p),p.connect(o.destination),d.start();const m=await o.startRendering(),f=await this.audioBufferToBlob(m),g=URL.createObjectURL(f),x={item:{id:e,name:t,category:"sfx",subcategory:"whoosh",duration:s,tags:["transition","movement",i?"quick":"gentle"],previewUrl:g,downloadUrl:g,isBuiltin:!0,license:"royalty-free"},blob:f,dataUrl:g};return this.cache.set(e,x),x}async generateImpact(e,t,s=!0){const i=this.cache.get(e);if(i)return i;const n=s?1.2:.6,a=44100,o=new OfflineAudioContext(2,a*n,a),l=o.createOscillator();l.type="sine",l.frequency.setValueAtTime(s?80:150,0),l.frequency.exponentialRampToValueAtTime(s?30:50,n);const d=o.createBuffer(2,a*.1,a);for(let S=0;S<2;S++){const k=d.getChannelData(S);for(let C=0;C<k.length;C++)k[C]=Math.random()*2-1}const u=o.createBufferSource();u.buffer=d;const h=o.createBiquadFilter();h.type="lowpass",h.frequency.value=s?500:1e3;const p=o.createGain();p.gain.setValueAtTime(.8,0),p.gain.exponentialRampToValueAtTime(.01,.1),u.connect(h),h.connect(p),p.connect(o.destination);const m=o.createGain();m.gain.setValueAtTime(1,0),m.gain.exponentialRampToValueAtTime(.01,n);const f=o.createDynamicsCompressor();f.threshold.value=-20,f.ratio.value=12,l.connect(m),m.connect(f),f.connect(o.destination),l.start(),u.start();const g=await o.startRendering(),y=await this.audioBufferToBlob(g),x=URL.createObjectURL(y),b={item:{id:e,name:t,category:"sfx",subcategory:"impacts",duration:n,tags:[s?"heavy":"light","punch","hit"],previewUrl:x,downloadUrl:x,isBuiltin:!0,license:"royalty-free"},blob:y,dataUrl:x};return this.cache.set(e,b),b}async generateClick(e,t){const s=this.cache.get(e);if(s)return s;const i=.08,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(2e3,0),o.frequency.exponentialRampToValueAtTime(800,i);const l=a.createGain();l.gain.setValueAtTime(.5,0),l.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(a.destination),o.start();const d=await a.startRendering(),u=await this.audioBufferToBlob(d),h=URL.createObjectURL(u),m={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["button","interface","tap"],previewUrl:h,downloadUrl:h,isBuiltin:!0,license:"royalty-free"},blob:u,dataUrl:h};return this.cache.set(e,m),m}async generateNotification(e,t){const s=this.cache.get(e);if(s)return s;const i=.5,n=44100,a=new OfflineAudioContext(2,n*i,n);[880,1100,1320].forEach((m,f)=>{const g=a.createOscillator();g.type="sine",g.frequency.value=m;const y=a.createGain(),x=f*.08;y.gain.setValueAtTime(0,x),y.gain.linearRampToValueAtTime(.3,x+.02),y.gain.exponentialRampToValueAtTime(.01,x+.15),g.connect(y),y.connect(a.destination),g.start(x),g.stop(x+.15)});const l=await a.startRendering(),d=await this.audioBufferToBlob(l),u=URL.createObjectURL(d),p={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["alert","bell","message"],previewUrl:u,downloadUrl:u,isBuiltin:!0,license:"royalty-free"},blob:d,dataUrl:u};return this.cache.set(e,p),p}async generateSuccess(e,t){const s=this.cache.get(e);if(s)return s;const i=.6,n=44100,a=new OfflineAudioContext(2,n*i,n);[523.25,659.25,783.99,1046.5].forEach((m,f)=>{const g=a.createOscillator();g.type="triangle",g.frequency.value=m;const y=a.createGain(),x=f*.1;y.gain.setValueAtTime(0,x),y.gain.linearRampToValueAtTime(.25,x+.03),y.gain.exponentialRampToValueAtTime(.01,x+.25),g.connect(y),y.connect(a.destination),g.start(x),g.stop(x+.25)});const l=await a.startRendering(),d=await this.audioBufferToBlob(l),u=URL.createObjectURL(d),p={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["complete","achievement","positive"],previewUrl:u,downloadUrl:u,isBuiltin:!0,license:"royalty-free"},blob:d,dataUrl:u};return this.cache.set(e,p),p}async generatePop(e,t){const s=this.cache.get(e);if(s)return s;const i=.15,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(400,0),o.frequency.exponentialRampToValueAtTime(100,i);const l=a.createGain();l.gain.setValueAtTime(.6,0),l.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(a.destination),o.start();const d=await a.startRendering(),u=await this.audioBufferToBlob(d),h=URL.createObjectURL(u),m={item:{id:e,name:t,category:"sfx",subcategory:"cartoon",duration:i,tags:["bubble","appear","fun"],previewUrl:h,downloadUrl:h,isBuiltin:!0,license:"royalty-free"},blob:u,dataUrl:h};return this.cache.set(e,m),m}async generateBoing(e,t){const s=this.cache.get(e);if(s)return s;const i=.4,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine";const l=a.createOscillator();l.type="sine",l.frequency.value=12;const d=a.createGain();d.gain.setValueAtTime(200,0),d.gain.exponentialRampToValueAtTime(1,i),l.connect(d),d.connect(o.frequency),o.frequency.setValueAtTime(300,0),o.frequency.exponentialRampToValueAtTime(100,i);const u=a.createGain();u.gain.setValueAtTime(.5,0),u.gain.exponentialRampToValueAtTime(.01,i),o.connect(u),u.connect(a.destination),o.start(),l.start();const h=await a.startRendering(),p=await this.audioBufferToBlob(h),m=URL.createObjectURL(p),g={item:{id:e,name:t,category:"sfx",subcategory:"cartoon",duration:i,tags:["bounce","spring","funny"],previewUrl:m,downloadUrl:m,isBuiltin:!0,license:"royalty-free"},blob:p,dataUrl:m};return this.cache.set(e,g),g}async generateGlitch(e,t){const s=this.cache.get(e);if(s)return s;const i=.5,n=44100,a=new OfflineAudioContext(2,n*i,n);for(let p=0;p<8;p++){const m=p*.05+Math.random()*.02,f=.02+Math.random()*.03,g=a.createBuffer(2,n*f,n);for(let b=0;b<2;b++){const S=g.getChannelData(b);for(let k=0;k<S.length;k++)S[k]=(Math.random()*2-1)*(Math.random()>.5?1:0)}const y=a.createBufferSource();y.buffer=g;const x=a.createBiquadFilter();x.type="bandpass",x.frequency.value=1e3+Math.random()*3e3,x.Q.value=10;const v=a.createGain();v.gain.value=.3+Math.random()*.3,y.connect(x),x.connect(v),v.connect(a.destination),y.start(m)}const o=await a.startRendering(),l=await this.audioBufferToBlob(o),d=URL.createObjectURL(l),h={item:{id:e,name:t,category:"sfx",subcategory:"transitions",duration:i,tags:["digital","error","tech"],previewUrl:d,downloadUrl:d,isBuiltin:!0,license:"royalty-free"},blob:l,dataUrl:d};return this.cache.set(e,h),h}async generateRiser(e,t){const s=this.cache.get(e);if(s)return s;const i=2,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createBuffer(2,n*i,n);for(let y=0;y<2;y++){const x=o.getChannelData(y);for(let v=0;v<x.length;v++)x[v]=Math.random()*2-1}const l=a.createBufferSource();l.buffer=o;const d=a.createBiquadFilter();d.type="highpass",d.frequency.setValueAtTime(100,0),d.frequency.exponentialRampToValueAtTime(8e3,i),d.Q.value=5;const u=a.createGain();u.gain.setValueAtTime(.1,0),u.gain.linearRampToValueAtTime(.6,i*.9),u.gain.linearRampToValueAtTime(0,i),l.connect(d),d.connect(u),u.connect(a.destination),l.start();const h=await a.startRendering(),p=await this.audioBufferToBlob(h),m=URL.createObjectURL(p),g={item:{id:e,name:t,category:"sfx",subcategory:"transitions",duration:i,tags:["build-up","riser","tension"],previewUrl:m,downloadUrl:m,isBuiltin:!0,license:"royalty-free"},blob:p,dataUrl:m};return this.cache.set(e,g),g}async generateLaser(e,t){const s=this.cache.get(e);if(s)return s;const i=.25,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sawtooth",o.frequency.setValueAtTime(2e3,0),o.frequency.exponentialRampToValueAtTime(100,i);const l=a.createBiquadFilter();l.type="lowpass",l.frequency.setValueAtTime(5e3,0),l.frequency.exponentialRampToValueAtTime(500,i);const d=a.createGain();d.gain.setValueAtTime(.4,0),d.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(d),d.connect(a.destination),o.start();const u=await a.startRendering(),h=await this.audioBufferToBlob(u),p=URL.createObjectURL(h),f={item:{id:e,name:t,category:"sfx",subcategory:"sci-fi",duration:i,tags:["weapon","space","shoot"],previewUrl:p,downloadUrl:p,isBuiltin:!0,license:"royalty-free"},blob:h,dataUrl:p};return this.cache.set(e,f),f}async generatePowerUp(e,t){const s=this.cache.get(e);if(s)return s;const i=1.2,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(200,0),o.frequency.exponentialRampToValueAtTime(1200,i);const l=a.createOscillator();l.type="triangle",l.frequency.setValueAtTime(400,0),l.frequency.exponentialRampToValueAtTime(2400,i);const d=a.createGain();d.gain.setValueAtTime(0,0),d.gain.linearRampToValueAtTime(.3,i*.1),d.gain.linearRampToValueAtTime(.4,i*.8),d.gain.linearRampToValueAtTime(0,i);const u=a.createGain();u.gain.setValueAtTime(0,0),u.gain.linearRampToValueAtTime(.15,i*.1),u.gain.linearRampToValueAtTime(.2,i*.8),u.gain.linearRampToValueAtTime(0,i),o.connect(d),l.connect(u),d.connect(a.destination),u.connect(a.destination),o.start(),l.start();const h=await a.startRendering(),p=await this.audioBufferToBlob(h),m=URL.createObjectURL(p),g={item:{id:e,name:t,category:"sfx",subcategory:"sci-fi",duration:i,tags:["energy","charge","activate"],previewUrl:m,downloadUrl:m,isBuiltin:!0,license:"royalty-free"},blob:p,dataUrl:m};return this.cache.set(e,g),g}async generateSimpleBeat(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=8,l=44100,d=new OfflineAudioContext(2,l*o,l),u=60/s,h=Math.floor(o/u);for(let x=0;x<h;x++){const v=x*u,b=x%4===0,S=x%4===2,k=d.createOscillator();k.type="sine",k.frequency.setValueAtTime(b?150:100,v),k.frequency.exponentialRampToValueAtTime(40,v+.1);const C=d.createGain();if(C.gain.setValueAtTime(b?.8:.5,v),C.gain.exponentialRampToValueAtTime(.01,v+.15),k.connect(C),C.connect(d.destination),k.start(v),k.stop(v+.15),S||x%4===2){const A=d.createBuffer(1,l*.1,l),T=A.getChannelData(0);for(let E=0;E<T.length;E++)T[E]=Math.random()*2-1;const j=d.createBufferSource();j.buffer=A;const _=d.createBiquadFilter();_.type="highpass",_.frequency.value=7e3;const M=d.createGain();M.gain.setValueAtTime(.3,v),M.gain.exponentialRampToValueAtTime(.01,v+.05),j.connect(_),_.connect(M),M.connect(d.destination),j.start(v)}}const p=await d.startRendering(),m=await this.audioBufferToBlob(p),f=URL.createObjectURL(m),y={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"C Major",tags:["beat","loop",i],mood:n,previewUrl:f,downloadUrl:f,isBuiltin:!0,license:"royalty-free"},blob:m,dataUrl:f};return this.cache.set(e,y),y}async generateAmbientPad(e,t,s,i){const n=this.cache.get(e);if(n)return n;const a=10,o=44100,l=new OfflineAudioContext(2,o*a,o);[261.63,329.63,392,523.25].forEach(g=>{const y=l.createOscillator();y.type="sine",y.frequency.value=g;const x=l.createOscillator();x.type="sine",x.frequency.value=g*1.002;const v=l.createBiquadFilter();v.type="lowpass",v.frequency.setValueAtTime(800,0),v.frequency.linearRampToValueAtTime(2e3,a*.5),v.frequency.linearRampToValueAtTime(600,a);const b=l.createGain();b.gain.setValueAtTime(0,0),b.gain.linearRampToValueAtTime(.08,a*.3),b.gain.setValueAtTime(.08,a*.7),b.gain.linearRampToValueAtTime(0,a),y.connect(v),x.connect(v),v.connect(b),b.connect(l.destination),y.start(),x.start()});const u=await l.startRendering(),h=await this.audioBufferToBlob(u),p=URL.createObjectURL(h),f={item:{id:e,name:t,category:"music",subcategory:s,duration:a,bpm:60,key:"C Major",tags:["ambient","pad","atmospheric"],mood:i,previewUrl:p,downloadUrl:p,isBuiltin:!0,license:"royalty-free"},blob:h,dataUrl:p};return this.cache.set(e,f),f}async generateChordProgression(e,t,s,i,n,a="pop"){const o=this.cache.get(e);if(o)return o;const l=16,d=44100,u=new OfflineAudioContext(2,d*l,d),h=Nf[a]||Nf.pop,p=4,m=60/s,f=p*m;h.forEach((S,k)=>{const C=k*f;S.forEach(A=>{const T=this.noteToFreq(A),j=u.createOscillator();j.type=i==="electronic"?"sawtooth":"triangle",j.frequency.value=T;const _=u.createOscillator();_.type="sine",_.frequency.value=T*1.001;const M=u.createBiquadFilter();M.type="lowpass",M.frequency.setValueAtTime(2e3,C),M.frequency.linearRampToValueAtTime(800,C+f),M.Q.value=1;const E=u.createGain();E.gain.setValueAtTime(0,C),E.gain.linearRampToValueAtTime(.12,C+.1),E.gain.setValueAtTime(.1,C+f-.2),E.gain.linearRampToValueAtTime(0,C+f),j.connect(M),_.connect(M),M.connect(E),E.connect(u.destination),j.start(C),j.stop(C+f),_.start(C),_.stop(C+f)})});const g=await u.startRendering(),y=await this.audioBufferToBlob(g),x=URL.createObjectURL(y),b={item:{id:e,name:t,category:"music",subcategory:i,duration:l,bpm:s,key:"C Major",tags:["chords","progression",i],mood:n,previewUrl:x,downloadUrl:x,isBuiltin:!0,license:"royalty-free"},blob:y,dataUrl:x};return this.cache.set(e,b),b}async generateMelody(e,t,s,i,n,a="pentatonic"){const o=this.cache.get(e);if(o)return o;const l=8,d=44100,u=new OfflineAudioContext(2,d*l,d),h=GW[a],m=this.getScaleFrequencies(261.63,h,2),y=60/s/2,x=Math.floor(l/y);let v=Math.floor(m.length/2);for(let T=0;T<x;T++){const j=T*y,_=Math.floor(Math.random()*5)-2;let M=v+_;M=Math.max(0,Math.min(m.length-1,M)),v=M;const E=m[M],D=u.createOscillator();D.type=i==="lofi"?"triangle":"sine",D.frequency.value=E;const R=u.createOscillator();R.type="sine",R.frequency.value=5;const B=u.createGain();B.gain.value=E*.01,R.connect(B),B.connect(D.frequency);const O=u.createBiquadFilter();O.type="lowpass",O.frequency.value=3e3;const F=u.createGain();F.gain.setValueAtTime(0,j),F.gain.linearRampToValueAtTime(.2,j+.02),F.gain.exponentialRampToValueAtTime(.01,j+y*.9),D.connect(O),O.connect(F),F.connect(u.destination),D.start(j),D.stop(j+y),R.start(j),R.stop(j+y)}const b=await u.startRendering(),S=await this.audioBufferToBlob(b),k=URL.createObjectURL(S),A={item:{id:e,name:t,category:"music",subcategory:i,duration:l,bpm:s,key:"C Major",tags:["melody","lead",i],mood:n,previewUrl:k,downloadUrl:k,isBuiltin:!0,license:"royalty-free"},blob:S,dataUrl:k};return this.cache.set(e,A),A}async generateArpeggio(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=8,l=44100,d=new OfflineAudioContext(2,l*o,l),u=Nf.electronic,h=60/s,m=h/4;u.forEach((b,S)=>{const k=S*2*h;for(let C=0;C<8;C++){const A=C%b.length,T=k+C*m;if(T>=o)break;const j=this.noteToFreq(b[A]),_=d.createOscillator();_.type="sawtooth",_.frequency.value=j;const M=d.createBiquadFilter();M.type="lowpass",M.frequency.setValueAtTime(4e3,T),M.frequency.exponentialRampToValueAtTime(500,T+m),M.Q.value=5;const E=d.createGain();E.gain.setValueAtTime(0,T),E.gain.linearRampToValueAtTime(.15,T+.01),E.gain.exponentialRampToValueAtTime(.01,T+m*.8),_.connect(M),M.connect(E),E.connect(d.destination),_.start(T),_.stop(T+m)}});const f=await d.startRendering(),g=await this.audioBufferToBlob(f),y=URL.createObjectURL(g),v={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"A Minor",tags:["arpeggio","synth",i],mood:n,previewUrl:y,downloadUrl:y,isBuiltin:!0,license:"royalty-free"},blob:g,dataUrl:y};return this.cache.set(e,v),v}async generateBassline(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=8,l=44100,d=new OfflineAudioContext(2,l*o,l),u=["C2","C2","G2","G2","A2","A2","F2","F2"],h=60/s;u.forEach((x,v)=>{const b=v*h,S=this.noteToFreq(x),k=d.createOscillator();k.type="sawtooth",k.frequency.value=S;const C=d.createOscillator();C.type="sine",C.frequency.value=S/2;const A=d.createBiquadFilter();A.type="lowpass",A.frequency.setValueAtTime(800,b),A.frequency.exponentialRampToValueAtTime(200,b+h),A.Q.value=8;const T=d.createGain();T.gain.setValueAtTime(0,b),T.gain.linearRampToValueAtTime(.4,b+.02),T.gain.exponentialRampToValueAtTime(.1,b+h*.8);const j=d.createGain();j.gain.value=.3,k.connect(A),A.connect(T),C.connect(j),j.connect(T),T.connect(d.destination),k.start(b),k.stop(b+h),C.start(b),C.stop(b+h)});const p=await d.startRendering(),m=await this.audioBufferToBlob(p),f=URL.createObjectURL(m),y={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"C Minor",tags:["bass","groove",i],mood:n,previewUrl:f,downloadUrl:f,isBuiltin:!0,license:"royalty-free"},blob:m,dataUrl:f};return this.cache.set(e,y),y}async generateDrumLoop(e,t,s,i,n,a="basic"){const o=this.cache.get(e);if(o)return o;const l=8,d=44100,u=new OfflineAudioContext(2,d*l,d),h=60/s,p=h/4,m=Math.floor(l/(h*4));for(let b=0;b<m;b++){const S=b*h*4;for(let k=0;k<16;k++){const C=S+k*p;if(C>=l)break;const A=k===0||k===8||a==="complex"&&(k===6||k===14),T=k===4||k===12,j=a!=="minimal"||k%4===0,_=k===2||k===10;if(A){const M=u.createOscillator();M.type="sine",M.frequency.setValueAtTime(150,C),M.frequency.exponentialRampToValueAtTime(30,C+.15);const E=u.createGain();E.gain.setValueAtTime(.8,C),E.gain.exponentialRampToValueAtTime(.01,C+.2);const D=u.createOscillator();D.type="triangle",D.frequency.setValueAtTime(1e3,C),D.frequency.exponentialRampToValueAtTime(100,C+.03);const R=u.createGain();R.gain.setValueAtTime(.3,C),R.gain.exponentialRampToValueAtTime(.01,C+.03),M.connect(E),E.connect(u.destination),D.connect(R),R.connect(u.destination),M.start(C),M.stop(C+.2),D.start(C),D.stop(C+.03)}if(T){const M=u.createBuffer(1,d*.15,d),E=M.getChannelData(0);for(let I=0;I<E.length;I++)E[I]=Math.random()*2-1;const D=u.createBufferSource();D.buffer=M;const R=u.createBiquadFilter();R.type="highpass",R.frequency.value=1e3;const B=u.createGain();B.gain.setValueAtTime(.5,C),B.gain.exponentialRampToValueAtTime(.01,C+.15);const O=u.createOscillator();O.type="triangle",O.frequency.setValueAtTime(200,C),O.frequency.exponentialRampToValueAtTime(100,C+.05);const F=u.createGain();F.gain.setValueAtTime(.3,C),F.gain.exponentialRampToValueAtTime(.01,C+.1),D.connect(R),R.connect(B),B.connect(u.destination),O.connect(F),F.connect(u.destination),D.start(C),O.start(C),O.stop(C+.1)}if(j&&a!=="minimal"){const M=u.createBuffer(1,d*.05,d),E=M.getChannelData(0);for(let F=0;F<E.length;F++)E[F]=Math.random()*2-1;const D=u.createBufferSource();D.buffer=M;const R=u.createBiquadFilter();R.type="highpass",R.frequency.value=8e3;const B=u.createGain(),O=_?.1:.03;B.gain.setValueAtTime(_?.25:.15,C),B.gain.exponentialRampToValueAtTime(.01,C+O),D.connect(R),R.connect(B),B.connect(u.destination),D.start(C)}}}const f=await u.startRendering(),g=await this.audioBufferToBlob(f),y=URL.createObjectURL(g),v={item:{id:e,name:t,category:"music",subcategory:i,duration:l,bpm:s,tags:["drums","loop","beat",i],mood:n,previewUrl:y,downloadUrl:y,isBuiltin:!0,license:"royalty-free"},blob:g,dataUrl:y};return this.cache.set(e,v),v}async generateFullTrack(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=16,l=44100,d=new OfflineAudioContext(2,l*o,l),u=60/s,h=u*4,p=this.createReverbImpulse(d,2.5,3),m=d.createConvolver();m.buffer=p;const f=d.createGain();f.gain.value=.25;const g=d.createGain();g.gain.value=.8;const y=d.createDynamicsCompressor();y.threshold.value=-6,y.ratio.value=3,y.attack.value=.003,y.release.value=.25,m.connect(f),f.connect(y),g.connect(y),y.connect(d.destination);const x=n.includes("happy")||n.includes("bright")||n.includes("playful"),v=n.includes("energetic")||n.includes("inspiring"),b=n.includes("calm")||n.includes("nostalgic");let S;x?S=Fl.happy:v?S=Fl.uplifting:b?S=Fl.chill:i==="hip-hop"?S=Fl.funky:S=Fl.emotional;const k=Math.floor(o/h);for(let E=0;E<k;E++){const D=E%S.length,R=S[D],B=E*h;R.forEach((ee,P)=>{const W=this.noteToFreq(ee);P<2?(this.createWarmPad(d,W,B,h,.12,m),this.createWarmPad(d,W,B,h,.08,g)):this.createWarmPad(d,W,B,h,.06,m)});const O=R[0],F=this.noteToFreq(O);if(i==="hip-hop"||i==="electronic")for(let ee=0;ee<4;ee++){const P=B+ee*u;(ee===0||ee===2)&&this.createRichBass(d,F,P,u*.8,.4,g)}else for(let ee=0;ee<4;ee++){const P=B+ee*u;this.createRichBass(d,F,P,u*.7,.3,g)}const I=x?Rf.bouncy:v?Rf.energetic:Rf.flowing,K=this.noteToFreq(R[2]||R[1]);E%2===0&&I.forEach((ee,P)=>{const W=B+P*u/2;if(W<B+h-.1){const z=K*Math.pow(2,ee/12);this.createPluckySynth(d,z,W,u*.4,.15,m)}})}const C=Math.floor(o/u);for(let E=0;E<C;E++){const D=E*u,R=E%4,B=Math.floor(E/4);(R===0||R===2)&&this.createPunchyKick(d,D,.5,g),(R===1||R===3)&&this.createCrispSnare(d,D,.35,m),i==="electronic"||i==="pop"||v?(this.createShimmeringHiHat(d,D,.08,!1,m),R===2&&this.createShimmeringHiHat(d,D+u/2,.06,!0,m)):R%2===0&&this.createShimmeringHiHat(d,D,.07,!1,m),i==="hip-hop"&&B%2===1&&R===0&&(this.createShimmeringHiHat(d,D+u*.25,.04,!1,g),this.createShimmeringHiHat(d,D+u*.75,.04,!1,g))}const A=await d.startRendering(),T=await this.audioBufferToBlob(A),j=URL.createObjectURL(T),M={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"C Major",tags:["full","track","complete",i],mood:n,previewUrl:j,downloadUrl:j,isBuiltin:!0,license:"royalty-free"},blob:T,dataUrl:j};return this.cache.set(e,M),M}async generateStinger(e,t,s){const i=this.cache.get(e);if(i)return i;const n=3,a=44100,o=new OfflineAudioContext(2,a*n,a);["C4","E4","G4","C5"].forEach((f,g)=>{const y=this.noteToFreq(f),x=g*.05,v=o.createOscillator();v.type="triangle",v.frequency.value=y;const b=o.createOscillator();b.type="sine",b.frequency.value=y*2;const S=o.createGain();S.gain.setValueAtTime(0,x),S.gain.linearRampToValueAtTime(.2,x+.05),S.gain.setValueAtTime(.15,x+.5),S.gain.exponentialRampToValueAtTime(.01,n);const k=o.createGain();k.gain.setValueAtTime(0,x),k.gain.linearRampToValueAtTime(.08,x+.05),k.gain.exponentialRampToValueAtTime(.01,x+1.5),v.connect(S),b.connect(k),S.connect(o.destination),k.connect(o.destination),v.start(x),v.stop(n),b.start(x),b.stop(x+1.5)});const d=await o.startRendering(),u=await this.audioBufferToBlob(d),h=URL.createObjectURL(u),m={item:{id:e,name:t,category:"sfx",subcategory:"musical",duration:n,tags:["stinger","logo","intro"],mood:s,previewUrl:h,downloadUrl:h,isBuiltin:!0,license:"royalty-free"},blob:u,dataUrl:h};return this.cache.set(e,m),m}async generateCinematicHit(e,t){const s=this.cache.get(e);if(s)return s;const i=4,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(60,0),o.frequency.exponentialRampToValueAtTime(20,i);const l=a.createGain();l.gain.setValueAtTime(.8,0),l.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(a.destination),o.start(0),o.stop(i);const d=a.createBuffer(2,n*.5,n);for(let b=0;b<2;b++){const S=d.getChannelData(b);for(let k=0;k<S.length;k++)S[k]=Math.random()*2-1}const u=a.createBufferSource();u.buffer=d;const h=a.createBiquadFilter();h.type="lowpass",h.frequency.setValueAtTime(2e3,0),h.frequency.exponentialRampToValueAtTime(100,.5);const p=a.createGain();p.gain.setValueAtTime(.6,0),p.gain.exponentialRampToValueAtTime(.01,.5),u.connect(h),h.connect(p),p.connect(a.destination),u.start(0),[65.41,130.81,261.63].forEach(b=>{const S=a.createOscillator();S.type="sawtooth",S.frequency.value=b;const k=a.createBiquadFilter();k.type="lowpass",k.frequency.setValueAtTime(1e3,0),k.frequency.exponentialRampToValueAtTime(100,2);const C=a.createGain();C.gain.setValueAtTime(.15,0),C.gain.exponentialRampToValueAtTime(.01,3),S.connect(k),k.connect(C),C.connect(a.destination),S.start(0),S.stop(3)});const f=await a.startRendering(),g=await this.audioBufferToBlob(f),y=URL.createObjectURL(g),v={item:{id:e,name:t,category:"sfx",subcategory:"impacts",duration:i,tags:["cinematic","hit","epic","trailer"],mood:["tense","dark"],previewUrl:y,downloadUrl:y,isBuiltin:!0,license:"royalty-free"},blob:g,dataUrl:y};return this.cache.set(e,v),v}async generateTypingSound(e,t){const s=this.cache.get(e);if(s)return s;const i=.08,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="square",o.frequency.setValueAtTime(800+Math.random()*400,0),o.frequency.exponentialRampToValueAtTime(200,i);const l=a.createBiquadFilter();l.type="bandpass",l.frequency.value=2e3,l.Q.value=2;const d=a.createGain();d.gain.setValueAtTime(.2,0),d.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(d),d.connect(a.destination),o.start();const u=await a.startRendering(),h=await this.audioBufferToBlob(u),p=URL.createObjectURL(h),f={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["keyboard","typing","click"],previewUrl:p,downloadUrl:p,isBuiltin:!0,license:"royalty-free"},blob:h,dataUrl:p};return this.cache.set(e,f),f}async generateErrorSound(e,t){const s=this.cache.get(e);if(s)return s;const i=.4,n=44100,a=new OfflineAudioContext(2,n*i,n);[0,.15].forEach(p=>{const m=a.createOscillator();m.type="square",m.frequency.value=220;const f=a.createGain();f.gain.setValueAtTime(0,p),f.gain.linearRampToValueAtTime(.25,p+.02),f.gain.linearRampToValueAtTime(0,p+.12),m.connect(f),f.connect(a.destination),m.start(p),m.stop(p+.12)});const o=await a.startRendering(),l=await this.audioBufferToBlob(o),d=URL.createObjectURL(l),h={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["error","warning","alert"],previewUrl:d,downloadUrl:d,isBuiltin:!0,license:"royalty-free"},blob:l,dataUrl:d};return this.cache.set(e,h),h}async generateCountdown(e,t){const s=this.cache.get(e);if(s)return s;const i=4,n=44100,a=new OfflineAudioContext(2,n*i,n);for(let p=0;p<4;p++){const m=p,f=p===3,g=f?880:440,y=a.createOscillator();y.type="sine",y.frequency.value=g;const x=a.createGain();x.gain.setValueAtTime(0,m),x.gain.linearRampToValueAtTime(f?.4:.3,m+.02),x.gain.exponentialRampToValueAtTime(.01,m+(f?.8:.15)),y.connect(x),x.connect(a.destination),y.start(m),y.stop(m+(f?.8:.15))}const o=await a.startRendering(),l=await this.audioBufferToBlob(o),d=URL.createObjectURL(l),h={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["countdown","timer","beep"],previewUrl:d,downloadUrl:d,isBuiltin:!0,license:"royalty-free"},blob:l,dataUrl:d};return this.cache.set(e,h),h}async audioBufferToBlob(e){const t=e.numberOfChannels,s=e.sampleRate,i=1,n=16,a=n/8,o=t*a,l=s*o,d=e.length*o,h=44+d,p=new ArrayBuffer(h),m=new DataView(p),f=(x,v)=>{for(let b=0;b<v.length;b++)m.setUint8(x+b,v.charCodeAt(b))};f(0,"RIFF"),m.setUint32(4,h-8,!0),f(8,"WAVE"),f(12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,i,!0),m.setUint16(22,t,!0),m.setUint32(24,s,!0),m.setUint32(28,l,!0),m.setUint16(32,o,!0),m.setUint16(34,n,!0),f(36,"data"),m.setUint32(40,d,!0);const g=[];for(let x=0;x<t;x++)g.push(e.getChannelData(x));let y=44;for(let x=0;x<e.length;x++)for(let v=0;v<t;v++){const b=Math.max(-1,Math.min(1,g[v][x])),S=b<0?b*32768:b*32767;m.setInt16(y,S,!0),y+=2}return new Blob([p],{type:"audio/wav"})}dispose(){for(const{dataUrl:e}of this.cache.values())URL.revokeObjectURL(e);this.cache.clear()}}let If=null;function YW(){return If||(If=new WW),If}class qW{sounds=new Map;soundBlobs=new Map;audioContext=null;previewSource=null;previewGain=null;initialized=!1;initPromise=null;constructor(){this.initPromise=this.loadBuiltinSounds()}async ensureInitialized(){this.initPromise&&await this.initPromise}async loadBuiltinSounds(){if(this.initialized)return;const e=YW();try{const t=[e.generateWhoosh("sfx-whoosh-fast-1","Fast Whoosh",.5,!0),e.generateWhoosh("sfx-whoosh-slow-1","Slow Whoosh",1.2,!1),e.generateWhoosh("sfx-whoosh-medium-1","Medium Swoosh",.8,!0),e.generateImpact("sfx-impact-heavy-1","Heavy Impact",!0),e.generateImpact("sfx-impact-light-1","Light Hit",!1),e.generateImpact("sfx-impact-punch-1","Punch",!0),e.generateClick("sfx-ui-click-1","Click"),e.generateClick("sfx-ui-tap-1","Tap"),e.generateNotification("sfx-ui-notification-1","Notification"),e.generateNotification("sfx-ui-alert-1","Alert Ding"),e.generateSuccess("sfx-ui-success-1","Success Chime"),e.generateSuccess("sfx-ui-complete-1","Complete"),e.generatePop("sfx-cartoon-pop-1","Pop"),e.generatePop("sfx-cartoon-bubble-1","Bubble"),e.generateBoing("sfx-cartoon-boing-1","Boing"),e.generateBoing("sfx-cartoon-spring-1","Spring"),e.generateGlitch("sfx-transition-glitch-1","Glitch"),e.generateGlitch("sfx-transition-digital-1","Digital Error"),e.generateRiser("sfx-transition-riser-1","Riser"),e.generateRiser("sfx-transition-buildup-1","Build Up"),e.generateLaser("sfx-scifi-laser-1","Laser Blast"),e.generateLaser("sfx-scifi-zap-1","Zap"),e.generatePowerUp("sfx-scifi-powerup-1","Power Up"),e.generatePowerUp("sfx-scifi-charge-1","Charge"),e.generateStinger("sfx-musical-stinger-1","Logo Stinger",["inspiring","bright"]),e.generateStinger("sfx-musical-stinger-2","Intro Sting",["happy","playful"]),e.generateCinematicHit("sfx-cinematic-hit-1","Epic Hit"),e.generateCinematicHit("sfx-cinematic-hit-2","Trailer Impact"),e.generateTypingSound("sfx-ui-typing-1","Key Press"),e.generateTypingSound("sfx-ui-typing-2","Keyboard Click"),e.generateErrorSound("sfx-ui-error-1","Error Beep"),e.generateErrorSound("sfx-ui-error-2","Warning Tone"),e.generateCountdown("sfx-ui-countdown-1","Countdown Beeps"),e.generateCountdown("sfx-ui-countdown-2","Timer Beeps")],s=[e.generateSimpleBeat("music-electronic-beat-1","Electronic Beat",128,"electronic",["energetic","happy"]),e.generateSimpleBeat("music-hiphop-beat-1","Hip-Hop Groove",90,"hip-hop",["energetic"]),e.generateSimpleBeat("music-pop-beat-1","Pop Rhythm",110,"pop",["happy","playful"]),e.generateSimpleBeat("music-lofi-beat-1","Lo-Fi Chill",85,"lofi",["calm","nostalgic"]),e.generateSimpleBeat("music-upbeat-beat-1","Upbeat Energy",120,"upbeat",["energetic","inspiring"]),e.generateSimpleBeat("music-corporate-beat-1","Corporate",100,"corporate",["inspiring","bright"]),e.generateSimpleBeat("music-trap-beat-1","Trap Banger",140,"hip-hop",["energetic","dark"]),e.generateSimpleBeat("music-house-beat-1","House Groove",124,"electronic",["energetic","happy"]),e.generateSimpleBeat("music-dance-beat-1","Dance Floor",130,"electronic",["energetic","playful"]),e.generateSimpleBeat("music-funk-beat-1","Funky Fresh",105,"upbeat",["happy","playful"]),e.generateSimpleBeat("music-edm-beat-1","EDM Drop",150,"electronic",["energetic"]),e.generateSimpleBeat("music-party-beat-1","Party Mode",128,"upbeat",["energetic","happy"]),e.generateSimpleBeat("music-summer-beat-1","Summer Vibes",115,"pop",["happy","bright"]),e.generateSimpleBeat("music-club-beat-1","Club Night",126,"electronic",["energetic","dark"]),e.generateAmbientPad("music-ambient-pad-1","Ambient Pad","ambient",["calm","mysterious"]),e.generateAmbientPad("music-cinematic-pad-1","Cinematic Atmosphere","cinematic",["tense","inspiring"]),e.generateAmbientPad("music-dramatic-pad-1","Dramatic Tension","dramatic",["tense","dark"]),e.generateChordProgression("music-pop-chords-1","Pop Chord Progression",120,"pop",["happy","bright"],"pop"),e.generateChordProgression("music-jazz-chords-1","Jazz Chords",100,"jazz",["calm","nostalgic"],"jazz"),e.generateChordProgression("music-lofi-chords-1","Lo-Fi Chords",80,"lofi",["calm","nostalgic"],"lofi"),e.generateChordProgression("music-cinematic-chords-1","Cinematic Chords",90,"cinematic",["tense","inspiring"],"cinematic"),e.generateChordProgression("music-electronic-chords-1","Electronic Chords",128,"electronic",["energetic","dark"],"electronic"),e.generateChordProgression("music-ambient-chords-1","Ambient Chords",70,"ambient",["calm","mysterious"],"ambient"),e.generateChordProgression("music-uplifting-chords-1","Uplifting Anthem",138,"electronic",["energetic","inspiring"],"pop"),e.generateChordProgression("music-future-chords-1","Future Bass Chords",150,"electronic",["energetic","happy"],"electronic"),e.generateMelody("music-pop-melody-1","Pop Melody",120,"pop",["happy","playful"],"major"),e.generateMelody("music-lofi-melody-1","Lo-Fi Melody",85,"lofi",["calm","nostalgic"],"pentatonic"),e.generateMelody("music-electronic-melody-1","Synth Lead",128,"electronic",["energetic"],"minor"),e.generateMelody("music-blues-melody-1","Blues Melody",95,"jazz",["nostalgic"],"blues"),e.generateMelody("music-euphoric-melody-1","Euphoric Lead",140,"electronic",["energetic","inspiring"],"major"),e.generateMelody("music-catchy-melody-1","Catchy Hook",118,"pop",["happy","playful"],"pentatonic"),e.generateMelody("music-tropical-melody-1","Tropical Vibes",100,"pop",["happy","bright"],"major"),e.generateArpeggio("music-electronic-arp-1","Synth Arpeggio",128,"electronic",["energetic","dark"]),e.generateArpeggio("music-ambient-arp-1","Ambient Arpeggio",100,"ambient",["calm","mysterious"]),e.generateArpeggio("music-trance-arp-1","Trance Arpeggio",140,"electronic",["energetic","inspiring"]),e.generateArpeggio("music-edm-arp-1","EDM Pluck",150,"electronic",["energetic","happy"]),e.generateBassline("music-electronic-bass-1","Electronic Bass",128,"electronic",["energetic","dark"]),e.generateBassline("music-hiphop-bass-1","Hip-Hop Bass",90,"hip-hop",["energetic"]),e.generateBassline("music-lofi-bass-1","Lo-Fi Bass",85,"lofi",["calm"]),e.generateBassline("music-dubstep-bass-1","Wobble Bass",140,"electronic",["energetic","dark"]),e.generateBassline("music-funk-bass-1","Funky Slap Bass",110,"upbeat",["happy","playful"]),e.generateDrumLoop("music-electronic-drums-1","Electronic Drums",128,"electronic",["energetic"],"complex"),e.generateDrumLoop("music-hiphop-drums-1","Hip-Hop Drums",90,"hip-hop",["energetic"],"basic"),e.generateDrumLoop("music-lofi-drums-1","Lo-Fi Drums",85,"lofi",["calm"],"minimal"),e.generateDrumLoop("music-pop-drums-1","Pop Drums",120,"pop",["happy"],"basic"),e.generateDrumLoop("music-cinematic-drums-1","Cinematic Drums",100,"cinematic",["tense"],"complex"),e.generateDrumLoop("music-trap-drums-1","Trap Hi-Hats",145,"hip-hop",["energetic","dark"],"complex"),e.generateDrumLoop("music-house-drums-1","Four on Floor",125,"electronic",["energetic","happy"],"basic"),e.generateDrumLoop("music-breakbeat-drums-1","Breakbeat",135,"electronic",["energetic"],"complex"),e.generateFullTrack("music-summer-vibes","Summer Vibes",118,"pop",["happy","bright"]),e.generateFullTrack("music-golden-hour","Golden Hour",110,"pop",["happy","nostalgic"]),e.generateFullTrack("music-feel-good","Feel Good",120,"upbeat",["happy","energetic"]),e.generateFullTrack("music-good-times","Good Times",124,"upbeat",["happy","playful"]),e.generateFullTrack("music-sunshine","Sunshine",116,"upbeat",["happy","bright"]),e.generateFullTrack("music-celebration","Celebration",128,"upbeat",["energetic","happy"]),e.generateFullTrack("music-victory-lap","Victory Lap",130,"upbeat",["energetic","inspiring"]),e.generateFullTrack("music-on-top","On Top",126,"upbeat",["inspiring","energetic"]),e.generateFullTrack("music-rise-up","Rise Up",122,"upbeat",["happy","inspiring"]),e.generateFullTrack("music-lets-go","Let's Go",132,"upbeat",["energetic"]),e.generateFullTrack("music-party-time","Party Time",128,"electronic",["energetic","happy"]),e.generateFullTrack("music-dance-floor","Dance Floor",126,"electronic",["energetic","playful"]),e.generateFullTrack("music-electric-nights","Electric Nights",130,"electronic",["energetic"]),e.generateFullTrack("music-neon-dreams","Neon Dreams",125,"electronic",["energetic","dark"]),e.generateFullTrack("music-future-wave","Future Wave",135,"electronic",["energetic","inspiring"]),e.generateFullTrack("music-beat-drop","Beat Drop",140,"electronic",["energetic"]),e.generateFullTrack("music-bounce","Bounce",95,"hip-hop",["energetic","playful"]),e.generateFullTrack("music-smooth-flow","Smooth Flow",90,"hip-hop",["calm","playful"]),e.generateFullTrack("music-fresh-start","Fresh Start",98,"hip-hop",["happy","energetic"]),e.generateFullTrack("music-street-groove","Street Groove",92,"hip-hop",["energetic"]),e.generateFullTrack("music-hype-mode","Hype Mode",105,"hip-hop",["energetic","happy"]),e.generateFullTrack("music-chill-wave","Chill Wave",85,"lofi",["calm","nostalgic"]),e.generateFullTrack("music-peaceful-mind","Peaceful Mind",80,"lofi",["calm"]),e.generateFullTrack("music-cozy-vibes","Cozy Vibes",82,"lofi",["calm","happy"]),e.generateFullTrack("music-epic-moment","Epic Moment",90,"cinematic",["inspiring","tense"]),e.generateFullTrack("music-new-beginning","New Beginning",95,"cinematic",["inspiring","bright"])],i=await Promise.all([...t,...s]);for(const n of i)this.sounds.set(n.item.id,n.item),this.soundBlobs.set(n.item.id,n.blob);this.initialized=!0}catch(t){console.error("[SoundLibrary] Failed to generate sounds:",t)}}getSoundBlob(e){return this.soundBlobs.get(e)||null}getAllSounds(){return Array.from(this.sounds.values())}getMusic(){return this.getAllSounds().filter(e=>e.category==="music")}getSFX(){return this.getAllSounds().filter(e=>e.category==="sfx")}getByCategory(e){return this.getAllSounds().filter(t=>t.category===e)}getBySubcategory(e){return this.getAllSounds().filter(t=>t.subcategory===e)}search(e){let t=this.getAllSounds();if(e.category&&(t=t.filter(s=>s.category===e.category)),e.subcategory&&(t=t.filter(s=>s.subcategory===e.subcategory)),e.mood&&e.mood.length>0&&(t=t.filter(s=>s.mood?.some(i=>e.mood.includes(i)))),e.minDuration!==void 0&&(t=t.filter(s=>s.duration>=e.minDuration)),e.maxDuration!==void 0&&(t=t.filter(s=>s.duration<=e.maxDuration)),e.minBpm!==void 0&&(t=t.filter(s=>s.bpm&&s.bpm>=e.minBpm)),e.maxBpm!==void 0&&(t=t.filter(s=>s.bpm&&s.bpm<=e.maxBpm)),e.searchQuery){const s=e.searchQuery.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(s)||i.tags.some(n=>n.toLowerCase().includes(s)))}return t}getSound(e){return this.sounds.get(e)||null}async previewSound(e){if(this.stopPreview(),!!e.previewUrl)try{this.audioContext||(this.audioContext=new AudioContext);const s=await(await fetch(e.previewUrl)).arrayBuffer(),i=await this.audioContext.decodeAudioData(s);this.previewSource=this.audioContext.createBufferSource(),this.previewSource.buffer=i,this.previewGain=this.audioContext.createGain(),this.previewGain.gain.value=.7,this.previewSource.connect(this.previewGain),this.previewGain.connect(this.audioContext.destination),this.previewSource.start()}catch(t){console.error("[SoundLibrary] Preview failed:",t)}}stopPreview(){if(this.previewSource){try{this.previewSource.stop()}catch{}this.previewSource.disconnect(),this.previewSource=null}this.previewGain&&(this.previewGain.disconnect(),this.previewGain=null)}async analyzeAudio(e){const t=e.getChannelData(0),s=e.sampleRate,i=this.generateWaveform(t,200),{bpm:n,beats:a}=this.detectBeats(t,s),o=this.detectKey(t,s);return{bpm:n,key:o,beats:a,waveform:i}}generateWaveform(e,t){const s=[],i=Math.floor(e.length/t);for(let n=0;n<t;n++){const a=n*i,o=a+i;let l=0;for(let d=a;d<o&&d<e.length;d++){const u=Math.abs(e[d]);u>l&&(l=u)}s.push(l)}return s}detectBeats(e,t){const s=[],i=Math.floor(t*.02),n=Math.floor(t*.01),a=[];for(let h=0;h<e.length-i;h+=n){let p=0;for(let m=0;m<i;m++)p+=e[h+m]*e[h+m];a.push(p/i)}const o=a.reduce((h,p)=>h+p,0)/a.length,l=o*1.5;let d=-.5;for(let h=1;h<a.length-1;h++){const p=h*n/t;a[h]>l&&a[h]>a[h-1]&&a[h]>a[h+1]&&p-d>.2&&(s.push({time:p,strength:Math.min(a[h]/o,2),type:s.length%4===0?"downbeat":"beat"}),d=p)}let u=120;if(s.length>=4){const h=[];for(let m=1;m<Math.min(s.length,20);m++)h.push(s[m].time-s[m-1].time);const p=h.reduce((m,f)=>m+f,0)/h.length;u=Math.round(60/p),u=Math.max(60,Math.min(200,u))}return{bpm:u,beats:s}}detectKey(e,t){const s=["C Major","G Major","D Major","A Major","E Major","A Minor","E Minor","D Minor","B Minor","F Major"];return s[Math.floor(Math.random()*s.length)]}addCustomSound(e){const t={...e,isBuiltin:!1};return this.sounds.set(t.id,t),t}removeSound(e){const t=this.sounds.get(e);return t&&!t.isBuiltin?(this.sounds.delete(e),!0):!1}dispose(){this.stopPreview(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.sounds.clear()}}let Ks=null,Df=null;async function HW(){if(typeof WebAssembly>"u")return null;try{const r=new URL("data:application/wasm;base64,AGFzbQEAAAABNwlgBH9/f38AYAJ/fwF/YAF/AX1gAX8Bf2ADf39/AGAEf39/fwF9YAR/fX9/AX9gAn99AX1gAAACDQEDZW52BWFib3J0AAADDQwABAEBBQIGAgcDAwgFAwEAAQYGAX8BQQALB4kBCRJjb21wdXRlUk1TRW5lcmdpZXMAAQtzbW9vdGhBcnJheQACD2NhbGN1bGF0ZU1lZGlhbgAGCWZpbmRQZWFrcwAHDWNhbGN1bGF0ZU1lYW4ACA9jYWxjdWxhdGVTdGREZXYACQthbGxvY2F0ZUYzMgAKC2FsbG9jYXRlSTMyAAsGbWVtb3J5AgAIAQwMAQgK5gsMmAICAn0JfyAAKAIIQQJ2IQggAygCCEECdiEKQwAAgD8gAbKVIQUDQCAHIApIBEAgAiAHbCEJQwAAAAAhBEEAIQYgAUEEayELA0AgBiALSARAIAYgCWoiDUEDaiIMIAhIBEAgBCAAKAIEIg4gDUECdGoqAgAiBCAElCANQQFqQQJ0IA5qKgIAIgQgBJSSIA1BAmpBAnQgDmoqAgAiBCAElJIgDEECdCAOaioCACIEIASUkpIhBAsgBkEEaiEGDAELCwNAIAEgBkoEQCAGIAlqIgsgCEgEQCAEIAAoAgQgC0ECdGoqAgAiBCAElJIhBAsgBkEBaiEGDAELCyADKAIEIAdBAnRqIAQgBZSROAIAIAdBAWohBwwBCwsLmwECBH8CfSAAKAIIQQJ2IQQgAkEBdSEFQwAAgD8gArKVIQgDQCADIARIBEBDAAAAACEHIAMgBWpBAWohBiADIAVrIQIDQCACIAZIBEAgByAAKAIEIARBAWsgAiACIAROG0EAIAJBAE4bQQJ0aioCAJIhByACQQFqIQIMAQsLIAEoAgQgA0ECdGogByAIlDgCACADQQFqIQMMAQsLC8oBAQZ/IABB7P///wNLBEBBkAlB0AlB1gBBHhAAAAsgAEEQaiIEQfz///8DSwRAQZAJQdAJQSFBHRAAAAsjACEDIwBBBGoiAiAEQRNqQXBxQQRrIgRqIgU/ACIGQRB0QQ9qQXBxIgdLBEAgBiAFIAdrQf//A2pBgIB8cUEQdiIHIAYgB0obQABBAEgEQCAHQABBAEgEQAALCwsgBSQAIAMgBDYCACACQQRrIgNBADYCBCADQQA2AgggAyABNgIMIAMgADYCECACQRBqC2sBAX8gAEUEQEEMQQMQAyEACyAAQQA2AgAgAEEANgIEIABBADYCCCABQf////8ASwRAQaAIQdAIQRNBORAAAAsgAUECdCIBQQEQAyICQQAgAfwLACAAIAI2AgAgACACNgIEIAAgATYCCCAAC4ACAgR/A30gASACRgRAIAAoAgQgAUECdGoqAgAPCyAAKAIEIAJBAnRqKgIAIQkgAUEBayEFIAEhBANAIAIgBEoEQCAAKAIEIgcgBEECdCIGaioCACIKIAlfBEAgBUEBaiIFQQJ0IAdqIgcqAgAhCCAHIAo4AgAgACgCBCAGaiAIOAIACyAEQQFqIQQMAQsLIAAoAgQiBCAFQQFqIgVBAnRqIgYqAgAhCCAGIAJBAnQiBiAEaioCADgCACAAKAIEIAZqIAg4AgAgAyAFRgR9IAAoAgQgA0ECdGoqAgAFIAMgBUgEfSAAIAEgBUEBayADEAUFIAAgBUEBaiACIAMQBQsLC5MBAQR/IAAoAghBAnYiBEUEQEMAAAAADwtBDEEEEAMgBBAEIQEDQCACIARIBEAgAkECdCIDIAEoAgRqIAMgACgCBGoqAgA4AgAgAkEBaiECDAELCyAEQQF2IQAgBEEBcQR9IAFBACAEQQFrIAAQBQUgAUEAIARBAWsiAiAAQQFrEAUgAUEAIAIgABAFkkMAAAA/lAsLogECBX8BfSAAKAIIQQJ2IQZBACACayEEQQEhBQNAIAUgBkEBa0gEQCAAKAIEIgcgBUECdGoqAgAiCSAFQQFqQQJ0IAdqKgIAXiAJIAVBAWtBAnQgB2oqAgBecSABIAldcSAFIARrIAJOcQRAIAggAygCCEECdkgEQCADKAIEIAhBAnRqIAU2AgAgCEEBaiEIIAUhBAsLIAVBAWohBQwBCwsgCAtHAgJ/AX0gACgCCEECdiICRQRAQwAAAAAPCwNAIAEgAkgEQCADIAAoAgQgAUECdGoqAgCSIQMgAUEBaiEBDAELCyADIAKylQtQAgF9An8gACgCCEECdiIERQRAQwAAAAAPCwNAIAMgBEgEQCACIAAoAgQgA0ECdGoqAgAgAZMiAiAClJIhAiADQQFqIQMMAQsLIAIgBLKVkQsMAEEMQQQQAyAAEAQLDABBDEEFEAMgABAECwcAQfwJJAALC9kBCABBjAgLASwAQZgICyMCAAAAHAAAAEkAbgB2AGEAbABpAGQAIABsAGUAbgBnAHQAaABBvAgLATwAQcgICy0CAAAAJgAAAH4AbABpAGIALwBhAHIAcgBhAHkAYgB1AGYAZgBlAHIALgB0AHMAQfwICwE8AEGICQsvAgAAACgAAABBAGwAbABvAGMAYQB0AGkAbwBuACAAdABvAG8AIABsAGEAcgBnAGUAQbwJCwE8AEHICQslAgAAAB4AAAB+AGwAaQBiAC8AcgB0AC8AcwB0AHUAYgAuAHQAcw==",import.meta.url),e=await fetch(r);if(!e.ok)return null;const t=await e.arrayBuffer(),{instance:s}=await WebAssembly.instantiate(t,{env:{abort:()=>{throw new Error("WASM abort")}}});return s.exports}catch{return null}}async function TM(){return Ks?!0:(Df||(Df=HW()),Ks=await Df,Ks!==null)}function XW(r,e,t,s){const i=r.length,n=s.length,a=1/e;for(let o=0;o<n;o++){const l=o*t;let d=0;for(let u=0;u<e&&l+u<i;u++){const h=r[l+u];d+=h*h}s[o]=Math.sqrt(d*a)}}function KW(r,e,t){const s=r.length,i=t>>1,n=1/t;for(let a=0;a<s;a++){let o=0;const l=a-i,d=a+i+1;for(let u=l;u<d;u++){const h=Math.max(0,Math.min(s-1,u));o+=r[h]}e[a]=o*n}}function QW(r){if(r.length===0)return 0;const e=Float32Array.from(r).sort((s,i)=>s-i),t=r.length>>1;return(r.length&1)===1?e[t]:(e[t-1]+e[t])*.5}function JW(r,e,t,s){const i=r.length;let n=0,a=-t;for(let o=1;o<i-1;o++){const l=r[o],d=r[o-1],u=r[o+1];l>d&&l>u&&l>e&&o-a>=t&&n<s.length&&(s[n]=o,n++,a=o)}return n}function ZW(r){if(r.length===0)return 0;let e=0;for(let t=0;t<r.length;t++)e+=r[t];return e/r.length}function eY(r,e){if(r.length===0)return 0;let t=0;for(let s=0;s<r.length;s++){const i=r[s]-e;t+=i*i}return Math.sqrt(t/r.length)}class tY{useWasm;constructor(){this.useWasm=Ks!==null}async ensureWasm(){return this.useWasm?!0:(await TM()&&(this.useWasm=!0),this.useWasm)}computeRMSEnergies(e,t,s,i){this.useWasm&&Ks?Ks.computeRMSEnergies(e,t,s,i):XW(e,t,s,i)}smoothArray(e,t,s){this.useWasm&&Ks?Ks.smoothArray(e,t,s):KW(e,t,s)}calculateMedian(e){return this.useWasm&&Ks?Ks.calculateMedian(e):QW(e)}findPeaks(e,t,s,i){return this.useWasm&&Ks?Ks.findPeaks(e,t,s,i):JW(e,t,s,i)}calculateMean(e){return this.useWasm&&Ks?Ks.calculateMean(e):ZW(e)}calculateStdDev(e,t){return this.useWasm&&Ks?Ks.calculateStdDev(e,t):eY(e,t)}}let Ff=null;function sY(){return Ff||(Ff=new tY),Ff}const iY={minBpm:60,maxBpm:200,sensitivity:.5,windowSize:2048,hopSize:512};class rY{config;audioContext=null;wasmProcessor;wasmInitialized=!1;constructor(e={}){this.config={...iY,...e},this.wasmProcessor=sY(),this.initWasm()}async initWasm(){if(!this.wasmInitialized)try{await TM(),await this.wasmProcessor.ensureWasm(),this.wasmInitialized=!0}catch{this.wasmInitialized=!1}}async analyzeAudioBuffer(e){const t=e.getChannelData(0),s=e.sampleRate,i=e.duration,n=this.detectOnsets(t,s),{bpm:a,confidence:o}=this.calculateBpm(n,i),l=this.generateBeats(a,i,n),d=this.detectDownbeats(l);return{bpm:a,confidence:o,beats:l,duration:i,downbeats:d}}async analyzeFromBlob(e){this.audioContext||(this.audioContext=new AudioContext);const t=await e.arrayBuffer(),s=await this.audioContext.decodeAudioData(t);return this.analyzeAudioBuffer(s)}async analyzeFromUrl(e){const s=await(await fetch(e)).blob();return this.analyzeFromBlob(s)}detectOnsets(e,t){const{windowSize:s,hopSize:i,sensitivity:n}=this.config,a=[],o=Math.floor((e.length-s)/i),l=new Float32Array(o);this.wasmProcessor.computeRMSEnergies(e,s,i,l);const d=new Float32Array(o);this.wasmProcessor.smoothArray(l,d,5);const u=Array.from(d),h=this.calculateAdaptiveThreshold(u,n);let p=-10;const m=Math.floor(t/i*.1);for(let f=1;f<u.length-1;f++){const g=u[f],y=u[f-1],x=h[f],v=g>u[f-1]&&g>=u[f+1],b=g>x,S=g-y>x*.3,k=f-p>=m;if(v&&b&&S&&k){const C=f*i/t;a.push(C),p=f}}return a}calculateAdaptiveThreshold(e,t){const i=[];for(let n=0;n<e.length;n++){const a=Math.max(0,n-50),o=Math.min(e.length,n+50),l=new Float32Array(e.slice(a,o)),d=this.wasmProcessor.calculateMedian(l),u=this.wasmProcessor.calculateMean(l),h=d+(u-d)*(1-t);i.push(h*(1.5-t*.5))}return i}calculateBpm(e,t){if(e.length<4)return{bpm:120,confidence:0};const s=[];for(let y=1;y<e.length;y++)s.push(e[y]-e[y-1]);const{minBpm:i,maxBpm:n}=this.config,a=60/n,o=60/i,l=s.filter(y=>y>=a&&y<=o);if(l.length<3)return{bpm:120,confidence:0};const d=new Map,u=1;for(const y of l){const x=Math.round(60/y/u)*u;x>=i&&x<=n&&d.set(x,(d.get(x)||0)+1);const v=Math.round(120/y/u)*u;v>=i&&v<=n&&d.set(v,(d.get(v)||0)+.5);const b=Math.round(30/y/u)*u;b>=i&&b<=n&&d.set(b,(d.get(b)||0)+.3)}let h=120,p=0;for(const[y,x]of d)x>p&&(p=x,h=y);const m=t*h/60,f=e.length,g=Math.min(1,Math.max(0,1-Math.abs(m-f)/m));return{bpm:h,confidence:g}}generateBeats(e,t,s){const i=60/e,n=[];let a=0;if(s.length>0){const l=s[0],d=Math.round(l/i);for(a=l-d*i;a<0;)a+=i}let o=0;for(let l=a;l<t;l+=i){const d=this.findNearestOnset(l,s,i*.3),u=d!==null?1:.5;n.push({time:d!==null?d:l,strength:u,index:o}),o++}return n}findNearestOnset(e,t,s){let i=null,n=s;for(const a of t){const o=Math.abs(a-e);o<n&&(n=o,i=a)}return i}detectDownbeats(e){if(e.length<4)return e.filter((i,n)=>n%4===0).map(i=>i.time);const t=[],s=e.filter(i=>i.strength>.7);if(s.length>0){const i=s[0],n=e.findIndex(a=>a.time===i.time);for(let a=n;a<e.length;a+=4)t.push(e[a].time)}else for(let i=0;i<e.length;i+=4)t.push(e[i].time);return t}generateBeatMarkersAtInterval(e,t,s=0,i=4){const n=60/e,a=[];let o=0;for(let l=s;l<t;l+=n){const d=o%i===0;a.push({time:l,strength:d?1:.7,index:o}),o++}return a}snapTimeToNearestBeat(e,t,s=.1){if(t.length===0)return e;let i=t[0],n=Math.abs(t[0].time-e);for(const a of t){const o=Math.abs(a.time-e);o<n&&(n=o,i=a)}return n<=s?i.time:e}getBeatsInRange(e,t,s){return e.filter(i=>i.time>=t&&i.time<=s)}dispose(){this.audioContext&&this.audioContext instanceof AudioContext&&(this.audioContext.close(),this.audioContext=null)}}let Bf=null;function AM(){return Bf||(Bf=new rY),Bf}const nY={frameRate:30,audioBufferSize:4096,frameBufferAhead:5,audioLookahead:.1,frameRenderTimeout:100,enableAudio:!0,enableVideo:!0};class aY{videoEngine=null;audioEngine=null;project=null;config;masterClock;clockUnsubscribe=null;realtimeAudioGraph;state="stopped";playbackRate=1;useRealtimeAudio=!0;currentFrame=null;frameRenderTimes=[];droppedFrames=0;scrubDebounceTimer=null;isScrubbing=!1;isRenderingFrame=!1;eventListeners=new Map;displayCanvas=null;displayCtx=null;constructor(e={}){this.config={...nY,...e},this.masterClock=zW({frameRate:this.config.frameRate}),this.realtimeAudioGraph=VW(this.masterClock)}async initialize(e,t){this.videoEngine=e,this.audioEngine=t,this.setupClockSubscription()}getRealtimeAudioGraph(){return this.realtimeAudioGraph}setupClockSubscription(){this.clockUnsubscribe&&this.clockUnsubscribe();const e={onTimeUpdate:t=>{this.handleClockTimeUpdate(t)},onStateChange:t=>{this.handleClockStateChange(t)}};this.clockUnsubscribe=this.masterClock.subscribe(e)}handleClockTimeUpdate(e){if(!(this.state!=="playing"||this.isRenderingFrame)){if(this.project&&this.project.timeline.duration>0&&e>=this.project.timeline.duration){this.pause();return}if(this.masterClock.shouldSkipFrame()){this.droppedFrames++;return}if(this.masterClock.shouldRepeatFrame()){this.emitEvent({type:"timeupdate",time:e,state:this.state});return}this.renderFrameAtTime(e),this.emitEvent({type:"timeupdate",time:e,state:this.state})}}handleClockStateChange(e){const t=this.state;e==="stopped"&&(this.state="stopped",this.stopAudioPlayback(),t!=="stopped"&&(this.emitEvent({type:"stop",time:0,state:this.state}),this.emitEvent({type:"statechange",time:0,state:this.state})))}getMasterClock(){return this.masterClock}setProject(e){this.project=e,this.state="stopped";const t=e.timeline.duration;this.masterClock.setDuration(t),this.clearAudioBuffer()}setDisplayCanvas(e){this.displayCanvas=e,this.displayCtx=e.getContext("2d")}getState(){return this.state}getCurrentTime(){return this.masterClock.currentTime}getCurrentFrame(){return this.currentFrame}isPlaying(){return this.state==="playing"}getIsScrubbing(){return this.isScrubbing}async play(){if(!this.project||!this.videoEngine)throw new Error("PlaybackController not properly initialized");if(this.state==="playing")return;const e=this.project.timeline.duration;this.masterClock.currentTime>=e&&this.masterClock.seek(0),this.state="playing",await this.preloadAudioBuffers(),await this.masterClock.play(),await this.startAudioPlayback();const t=this.masterClock.currentTime;this.emitEvent({type:"play",time:t,state:this.state}),this.emitEvent({type:"statechange",time:t,state:this.state})}pause(){if(this.state!=="playing")return;this.state="paused",this.masterClock.pause(),this.stopAudioPlayback();const e=this.masterClock.currentTime;this.emitEvent({type:"pause",time:e,state:this.state}),this.emitEvent({type:"statechange",time:e,state:this.state})}stop(){const e=this.state;this.state="stopped",this.masterClock.stop(),this.stopAudioPlayback(),this.emitEvent({type:"stop",time:0,state:this.state}),e!==this.state&&this.emitEvent({type:"statechange",time:0,state:this.state})}async togglePlayback(){this.state==="playing"?this.pause():await this.play()}async seek(e){if(!this.project)return;const t=this.state==="playing",s=this.project.timeline.duration,i=Math.max(0,Math.min(e,s));this.masterClock.seek(i),this.realtimeAudioGraph.seekTo(i),t&&(this.stopAudioPlayback(),await this.startAudioPlayback()),await this.renderFrameAtTime(i),this.emitEvent({type:"seek",time:i,state:this.state})}startScrubbing(){this.isScrubbing=!0,this.state==="playing"&&this.pause()}async scrubTo(e){if(!this.project||!this.videoEngine)return{frame:null,renderTime:0,fromCache:!1,timedOut:!1};const t=this.project.timeline.duration,s=Math.max(0,Math.min(e,t));return this.masterClock.seek(s),this.realtimeAudioGraph.seekTo(s),this.emitEvent({type:"timeupdate",time:s,state:this.state}),this.renderFrameWithTimeout(s)}endScrubbing(){this.isScrubbing=!1,this.scrubDebounceTimer&&(clearTimeout(this.scrubDebounceTimer),this.scrubDebounceTimer=null)}setPlaybackRate(e){this.playbackRate=Math.max(.1,Math.min(4,e)),this.masterClock.setPlaybackRate(this.playbackRate)}getPlaybackRate(){return this.playbackRate}getStats(){const e=this.frameRenderTimes.length>0?this.frameRenderTimes.reduce((t,s)=>t+s,0)/this.frameRenderTimes.length:0;return{currentTime:this.masterClock.currentTime,duration:this.project?.timeline.duration??0,state:this.state,fps:this.calculateFPS(),droppedFrames:this.droppedFrames,audioBufferHealth:this.calculateAudioBufferHealth(),videoBufferHealth:1,avgFrameRenderTime:e}}addEventListener(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}removeEventListener(e,t){this.eventListeners.get(e)?.delete(t)}dispose(){this.stop(),this.clockUnsubscribe&&(this.clockUnsubscribe(),this.clockUnsubscribe=null),this.masterClock.dispose(),this.realtimeAudioGraph.dispose(),this.clearAudioBuffer(),this.eventListeners.clear(),this.currentFrame?.image.close(),this.currentFrame=null,this.displayCanvas=null,this.displayCtx=null,this.videoEngine=null,this.audioEngine=null,this.project=null}async renderFrameAtTime(e){if(!this.project||!this.videoEngine||this.isRenderingFrame)return;this.isRenderingFrame=!0;const t=performance.now();try{const s=await this.videoEngine.renderFrame(this.project,e),i=performance.now()-t;this.trackFrameRenderTime(i),this.masterClock.reportVideoTime(e),this.currentFrame&&this.currentFrame!==s&&this.currentFrame.image.close(),this.currentFrame=s,this.drawFrameToCanvas(s),this.emitEvent({type:"framerendered",time:e,state:this.state,frame:s})}catch(s){console.error("Frame render error:",s),this.droppedFrames++}finally{this.isRenderingFrame=!1}}async renderFrameWithTimeout(e){if(!this.project||!this.videoEngine)return{frame:null,renderTime:0,fromCache:!1,timedOut:!1};const t=performance.now();try{const s=new Promise((a,o)=>{setTimeout(()=>{o(new Error("Frame render timeout"))},this.config.frameRenderTimeout)}),i=await Promise.race([this.videoEngine.renderFrame(this.project,e),s]),n=performance.now()-t;return this.trackFrameRenderTime(n),this.currentFrame&&this.currentFrame!==i&&this.currentFrame.image.close(),this.currentFrame=i,this.drawFrameToCanvas(i),{frame:i,renderTime:n,fromCache:!1,timedOut:!1}}catch(s){const i=performance.now()-t;return s instanceof Error&&s.message==="Frame render timeout"?{frame:null,renderTime:i,fromCache:!1,timedOut:!0}:(console.error("Frame render error:",s),{frame:null,renderTime:i,fromCache:!1,timedOut:!1})}}drawFrameToCanvas(e){!this.displayCanvas||!this.displayCtx||((this.displayCanvas.width!==e.width||this.displayCanvas.height!==e.height)&&(this.displayCanvas.width=e.width,this.displayCanvas.height=e.height),this.displayCtx.drawImage(e.image,0,0))}async startAudioPlayback(){!this.config.enableAudio||!this.project||this.useRealtimeAudio&&(await this.realtimeAudioGraph.resume(),this.setupTracksInAudioGraph(),this.realtimeAudioGraph.startScheduler(e=>this.getAudioClipsAtTime(e)))}setupTracksInAudioGraph(){if(!this.project)return;const e=this.project.timeline.tracks.some(t=>t.solo);for(const t of this.project.timeline.tracks)t.type!=="audio"&&t.type!=="video"||(this.realtimeAudioGraph.createTrack({trackId:t.id,volume:1,pan:0,muted:t.muted,solo:t.solo,effects:[]}),e&&this.realtimeAudioGraph.setTrackSolo(t.id,t.solo))}getAudioClipsAtTime(e){if(!this.project||!this.audioEngine)return[];const t=[],{timeline:s,mediaLibrary:i}=this.project;for(const n of s.tracks)if(!(n.type!=="audio"&&n.type!=="video"))for(const a of n.clips){const o=a.startTime+a.duration;if(o<=e||a.startTime>e+1)continue;const l=i.items.find(u=>u.id===a.mediaId);if(!l?.blob)continue;const d=this.getOrDecodeAudioBuffer(l);d&&t.push({clipId:a.id,trackId:n.id,audioBuffer:d,startTime:a.startTime,endTime:o,mediaOffset:a.inPoint,volume:a.volume,pan:0,effects:a.audioEffects||[],speed:a.speed??1})}return t}audioBufferCache=new Map;audioDecodePromises=new Map;async preloadAudioBuffers(){if(!this.project)return;const{timeline:e,mediaLibrary:t}=this.project,s=new Set;for(const n of e.tracks)if(!(n.type!=="audio"&&n.type!=="video"))for(const a of n.clips){const o=t.items.find(l=>l.id===a.mediaId);o?.blob&&!this.audioBufferCache.has(o.id)&&s.add(o.id)}const i=[];for(const n of s){const a=t.items.find(o=>o.id===n);a?.blob&&i.push(this.decodeAudioBuffer(a))}await Promise.all(i)}async decodeAudioBuffer(e){if(this.audioBufferCache.has(e.id))return this.audioBufferCache.get(e.id)||null;if(this.audioDecodePromises.has(e.id))return this.audioDecodePromises.get(e.id)||null;if(!e.blob)return null;const t=this.masterClock.getAudioContext(),s=e.blob.arrayBuffer().then(i=>t.decodeAudioData(i)).then(i=>(this.audioBufferCache.set(e.id,i),this.audioDecodePromises.delete(e.id),i)).catch(()=>(this.audioDecodePromises.delete(e.id),null));return this.audioDecodePromises.set(e.id,s),s}getOrDecodeAudioBuffer(e){const t=this.audioBufferCache.get(e.id);return t||(e.blob&&this.decodeAudioBuffer(e),null)}stopAudioPlayback(){this.useRealtimeAudio&&this.realtimeAudioGraph.stopScheduler()}clearAudioBuffer(){this.stopAudioPlayback(),this.audioBufferCache.clear()}trackFrameRenderTime(e){this.frameRenderTimes.push(e),this.frameRenderTimes.length>60&&this.frameRenderTimes.shift()}calculateFPS(){if(this.frameRenderTimes.length<2)return 0;const e=this.frameRenderTimes.reduce((t,s)=>t+s,0)/this.frameRenderTimes.length;return e>0?1e3/e:0}calculateAudioBufferHealth(){return 1}emitEvent(e){const t=this.eventListeners.get(e.type);if(t)for(const i of t)try{i(e)}catch(n){console.error("Event listener error:",n)}const s=this.eventListeners.get("all");if(s)for(const i of s)try{i(e)}catch(n){console.error("Event listener error:",n)}}}let Lf=null;function oY(){return Lf||(Lf=new aY),Lf}const Cb={fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"bottom"},Of={default:Cb,classic:{fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"bottom"},modern:{fontFamily:"Helvetica Neue",fontSize:28,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.5)",position:"bottom"},cinematic:{fontFamily:"Georgia",fontSize:26,color:"#f0f0f0",backgroundColor:"transparent",position:"bottom"},bold:{fontFamily:"Impact",fontSize:32,color:"#ffff00",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"bottom"},minimal:{fontFamily:"Roboto",fontSize:22,color:"#ffffff",backgroundColor:"transparent",position:"bottom"},topCenter:{fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"top"},centered:{fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"center"}};function ty(){return`subtitle-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}function bC(r){const e=r.trim().match(/^(\d{1,2}):(\d{2}):(\d{2})[,.](\d{3})$/);if(!e)return null;const t=parseInt(e[1],10),s=parseInt(e[2],10),i=parseInt(e[3],10),n=parseInt(e[4],10);return s>=60||i>=60?null:t*3600+s*60+i+n/1e3}function vC(r){(r<0||!isFinite(r))&&(r=0);const e=Math.round(r*1e3),t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4),i=Math.floor(e%6e4/1e3),n=e%1e3;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")},${n.toString().padStart(3,"0")}`}function cY(r){const e=[],t=[],i=r.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(/\n\n+/).filter(a=>a.trim());let n=1;for(let a=0;a<i.length;a++){const o=i[a].trim(),l=o.split(`
`);if(l.length<2){t.push({line:n,message:"Invalid subtitle block: insufficient lines",segment:a+1}),n+=o.split(`
`).length+1;continue}const d=l[0].trim(),u=parseInt(d,10);if(isNaN(u)){t.push({line:n,message:`Invalid subtitle index: "${d}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}const h=l[1].trim(),p=h.match(/^(.+?)\s*-->\s*(.+?)(?:\s+.*)?$/);if(!p){t.push({line:n+1,message:`Invalid timestamp format: "${h}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}const m=bC(p[1]),f=bC(p[2]);if(m===null){t.push({line:n+1,message:`Invalid start timestamp: "${p[1]}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}if(f===null){t.push({line:n+1,message:`Invalid end timestamp: "${p[2]}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}if(f<=m){t.push({line:n+1,message:"End time must be greater than start time",segment:a+1}),n+=o.split(`
`).length+1;continue}const g=l.slice(2).join(`
`).trim();if(!g){t.push({line:n+2,message:"Empty subtitle text",segment:a+1}),n+=o.split(`
`).length+1;continue}e.push({id:ty(),text:g,startTime:m,endTime:f,style:Cb}),n+=o.split(`
`).length+1}return{success:t.length===0,subtitles:e,errors:t}}function lY(r){const e=[...r].sort((s,i)=>s.startTime-i.startTime),t=[];for(let s=0;s<e.length;s++){const i=e[s],n=s+1,a=vC(i.startTime),o=vC(i.endTime);t.push(`${n}
${a} --> ${o}
${i.text}`)}return t.join(`

`)}class dY{importSRT(e,t){const s=cY(t);return{timeline:{...e,subtitles:[...e.subtitles,...s.subtitles]},result:s}}exportSRT(e){return lY(e.subtitles)}addSubtitle(e,t,s,i,n){if(i<=s)return{error:"End time must be greater than start time"};if(s<0)return{error:"Start time cannot be negative"};const a={id:ty(),text:t,startTime:s,endTime:i,style:n||Cb};return{timeline:{...e,subtitles:[...e.subtitles,a]},subtitle:a}}updateSubtitle(e,t,s){const i=e.subtitles.findIndex(h=>h.id===t);if(i===-1)return{error:"Subtitle not found"};const n=e.subtitles[i],a=s.startTime??n.startTime,o=s.endTime??n.endTime;if(o<=a)return{error:"End time must be greater than start time"};if(a<0)return{error:"Start time cannot be negative"};const l={...n,text:s.text??n.text,startTime:a,endTime:o},d=[...e.subtitles];return d[i]=l,{timeline:{...e,subtitles:d},subtitle:l}}removeSubtitle(e,t){return e.subtitles.findIndex(n=>n.id===t)===-1?{error:"Subtitle not found"}:{timeline:{...e,subtitles:e.subtitles.filter(n=>n.id!==t)}}}setGlobalStyle(e,t){return{...e,subtitles:e.subtitles.map(s=>({...s,style:t}))}}setSubtitleStyle(e,t,s){const i=e.subtitles.findIndex(a=>a.id===t);if(i===-1)return{error:"Subtitle not found"};const n=[...e.subtitles];return n[i]={...n[i],style:s},{timeline:{...e,subtitles:n}}}getSubtitleAtTime(e,t){return e.subtitles.find(s=>t>=s.startTime&&t<s.endTime)||null}getSubtitlesInRange(e,t,s){return e.subtitles.filter(i=>i.endTime>t&&i.startTime<s)}getSortedSubtitles(e){return[...e.subtitles].sort((t,s)=>t.startTime-s.startTime)}shiftAllSubtitles(e,t){return{...e,subtitles:e.subtitles.map(s=>({...s,startTime:Math.max(0,s.startTime+t),endTime:Math.max(.001,s.endTime+t)}))}}applyStylePreset(e,t){const s=Of[t];return s?{timeline:this.setGlobalStyle(e,s)}:{error:`Unknown style preset: ${t}`}}mergeAdjacentSubtitles(e,t=.1){const s=this.getSortedSubtitles(e);if(s.length<=1)return e;const i=[];let n={...s[0]};for(let a=1;a<s.length;a++){const o=s[a];o.startTime<=n.endTime+t?n={...n,text:n.text+`
`+o.text,endTime:Math.max(n.endTime,o.endTime)}:(i.push(n),n={...o})}return i.push(n),{...e,subtitles:i}}splitSubtitle(e,t,s){const i=e.subtitles.find(l=>l.id===t);if(!i)return{error:"Subtitle not found"};if(s<=i.startTime||s>=i.endTime)return{error:"Split time must be within subtitle duration"};const n={...i,endTime:s},a={...i,id:ty(),startTime:s},o=e.subtitles.filter(l=>l.id!==t);return o.push(n,a),{timeline:{...e,subtitles:o},subtitles:[n,a]}}clearAllSubtitles(e){return{...e,subtitles:[]}}getStylePresets(){return Object.keys(Of)}getStylePreset(e){return Of[e]}}const uY=[{code:"en-US",name:"English (US)"},{code:"en-GB",name:"English (UK)"},{code:"es-ES",name:"Spanish (Spain)"},{code:"es-MX",name:"Spanish (Mexico)"},{code:"fr-FR",name:"French"},{code:"de-DE",name:"German"},{code:"it-IT",name:"Italian"},{code:"pt-BR",name:"Portuguese (Brazil)"},{code:"pt-PT",name:"Portuguese (Portugal)"},{code:"ja-JP",name:"Japanese"},{code:"ko-KR",name:"Korean"},{code:"zh-CN",name:"Chinese (Simplified)"},{code:"zh-TW",name:"Chinese (Traditional)"},{code:"ru-RU",name:"Russian"},{code:"ar-SA",name:"Arabic"},{code:"hi-IN",name:"Hindi"},{code:"nl-NL",name:"Dutch"},{code:"pl-PL",name:"Polish"},{code:"sv-SE",name:"Swedish"},{code:"da-DK",name:"Danish"},{code:"fi-FI",name:"Finnish"},{code:"no-NO",name:"Norwegian"},{code:"tr-TR",name:"Turkish"},{code:"th-TH",name:"Thai"},{code:"vi-VN",name:"Vietnamese"},{code:"id-ID",name:"Indonesian"},{code:"ms-MY",name:"Malay"},{code:"el-GR",name:"Greek"},{code:"cs-CZ",name:"Czech"},{code:"ro-RO",name:"Romanian"},{code:"hu-HU",name:"Hungarian"},{code:"uk-UA",name:"Ukrainian"},{code:"he-IL",name:"Hebrew"}],hY={language:"en-US",continuous:!0,interimResults:!1,maxAlternatives:1},pY={fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.7)",position:"bottom"};class Sb{recognition=null;audioContext=null;mediaSource=null;segments=[];isTranscribing=!1;currentOptions=hY;progressCallback=null;segmentCallback=null;startTime=0;segmentStartTime=0;static isSupported(){return typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)}static getSupportedLanguages(){return[...uY]}constructor(){this.initRecognition()}initRecognition(){if(!Sb.isSupported())return;const e=window.SpeechRecognition||window.webkitSpeechRecognition;e&&(this.recognition=new e,this.setupRecognitionHandlers())}setupRecognitionHandlers(){this.recognition&&(this.recognition.onresult=e=>{const t=e.results[e.results.length-1];if(!t.isFinal)return;const s=t[0].transcript.trim();if(!s)return;const i=this.getCurrentTime(),n={text:s,startTime:this.segmentStartTime,endTime:i,confidence:t[0].confidence};this.segments.push(n),this.segmentStartTime=i,this.segmentCallback&&this.segmentCallback(n),this.reportProgress("transcribing")},this.recognition.onerror=e=>{e.error==="no-speech"||e.error==="aborted"||console.error("Speech recognition error:",e.error)},this.recognition.onend=()=>{if(this.isTranscribing&&this.recognition)try{this.recognition.start()}catch{this.isTranscribing=!1,this.reportProgress("completed")}})}getCurrentTime(){return(performance.now()-this.startTime)/1e3}reportProgress(e){this.progressCallback&&this.progressCallback({status:e,progress:e==="completed"?100:50,currentTime:this.getCurrentTime(),totalDuration:0,segmentsFound:this.segments.length})}setOptions(e){this.currentOptions={...this.currentOptions,...e},this.applyOptions()}applyOptions(){this.recognition&&(this.recognition.lang=this.currentOptions.language,this.recognition.continuous=this.currentOptions.continuous,this.recognition.interimResults=this.currentOptions.interimResults,this.recognition.maxAlternatives=this.currentOptions.maxAlternatives)}onProgress(e){this.progressCallback=e}onSegment(e){this.segmentCallback=e}async startLiveTranscription(){if(!this.recognition)throw new Error("Speech recognition not supported in this browser");if(!this.isTranscribing){this.segments=[],this.isTranscribing=!0,this.startTime=performance.now(),this.segmentStartTime=0,this.applyOptions(),this.reportProgress("transcribing");try{this.recognition.start()}catch(e){throw this.isTranscribing=!1,e}}}stopTranscription(){if(!this.isTranscribing)return{success:!0,segments:this.segments,language:this.currentOptions.language};if(this.isTranscribing=!1,this.recognition)try{this.recognition.stop()}catch{}return this.reportProgress("completed"),{success:!0,segments:[...this.segments],language:this.currentOptions.language}}async transcribeAudioElement(e,t=0,s){return this.recognition?new Promise(i=>{this.segments=[],this.isTranscribing=!0,this.startTime=performance.now(),this.segmentStartTime=t;const n=()=>{o(),i(this.stopTranscription())},a=()=>{s&&e.currentTime>=t+s&&n()},o=()=>{e.removeEventListener("ended",n),e.removeEventListener("timeupdate",a)};if(e.addEventListener("ended",n),e.addEventListener("timeupdate",a),this.applyOptions(),this.reportProgress("transcribing"),e.currentTime=t,e.play().catch(()=>{o(),i({success:!1,segments:[],error:"Failed to play audio for transcription"})}),!this.recognition){o(),i({success:!1,segments:[],error:"Speech recognition not available"});return}try{this.recognition.start()}catch{o(),i({success:!1,segments:[],error:"Failed to start speech recognition"})}}):{success:!1,segments:[],error:"Speech recognition not supported. Try Chrome or Edge browser."}}segmentsToSubtitles(e,t){const s={...pY,...t};return e.map((i,n)=>({id:`auto-caption-${Date.now()}-${n}`,text:i.text,startTime:i.startTime,endTime:i.endTime,style:s}))}getSegments(){return[...this.segments]}clearSegments(){this.segments=[]}isActive(){return this.isTranscribing}dispose(){this.stopTranscription(),this.mediaSource&&(this.mediaSource.disconnect(),this.mediaSource=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.recognition=null,this.progressCallback=null,this.segmentCallback=null}}const wC={fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.7)",position:"bottom"};class mY{config;audioContext=null;constructor(e){this.config={maxSegmentDuration:5,maxWordsPerSegment:10,...e}}async transcribeClip(e,t,s){try{s?.({phase:"extracting",progress:0,message:"Extracting audio from video..."});const i=await this.extractAudioFromClip(e,t);s?.({phase:"uploading",progress:25,message:"Uploading audio for transcription..."});const n=await this.sendToWhisper(i,s);s?.({phase:"processing",progress:90,message:"Processing transcription..."});const a=this.convertToSubtitles(n,e);return s?.({phase:"complete",progress:100,message:`Generated ${a.length} subtitles`}),a}catch(i){throw s?.({phase:"error",progress:0,message:i instanceof Error?i.message:"Transcription failed"}),i}}async extractAudioFromClip(e,t){this.audioContext||(this.audioContext=new AudioContext);let s;if(t.blob)s=await t.blob.arrayBuffer();else if(t.fileHandle)s=await(await t.fileHandle.getFile()).arrayBuffer();else throw new Error("No media source available for audio extraction");const i=await this.audioContext.decodeAudioData(s),n=e.inPoint||0,a=e.outPoint||i.duration,o=Math.min(a-n,e.duration),l=i.sampleRate,d=Math.floor(n*l),h=Math.floor((n+o)*l)-d,p=new OfflineAudioContext(1,h,l),m=p.createBufferSource(),f=p.createBuffer(1,h,l),g=f.getChannelData(0),y=i.getChannelData(0);for(let v=0;v<h;v++)g[v]=y[d+v]||0;m.buffer=f,m.connect(p.destination),m.start(0);const x=await p.startRendering();return this.audioBufferToWav(x)}audioBufferToWav(e){const t=e.numberOfChannels,s=e.sampleRate,i=1,n=16,a=n/8,o=t*a,l=s*o,d=e.length*o,h=44+d,p=new ArrayBuffer(h),m=new DataView(p),f=(x,v)=>{for(let b=0;b<v.length;b++)m.setUint8(x+b,v.charCodeAt(b))};f(0,"RIFF"),m.setUint32(4,h-8,!0),f(8,"WAVE"),f(12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,i,!0),m.setUint16(22,t,!0),m.setUint32(24,s,!0),m.setUint32(28,l,!0),m.setUint16(32,o,!0),m.setUint16(34,n,!0),f(36,"data"),m.setUint32(40,d,!0);const g=e.getChannelData(0);let y=44;for(let x=0;x<e.length;x++){const v=Math.max(-1,Math.min(1,g[x])),b=v<0?v*32768:v*32767;m.setInt16(y,b,!0),y+=2}return new Blob([p],{type:"audio/wav"})}async sendToWhisper(e,t){const s=new FormData;s.append("audio",e,"audio.wav"),t?.({phase:"transcribing",progress:50,message:"Transcribing audio..."});const i=await fetch(this.config.apiEndpoint,{method:"POST",body:s});if(!i.ok){if(i.status===429)throw new Error("Rate limit reached. Please wait a minute before transcribing more audio. This free service is limited to 10 requests per minute.");const n=await i.text();throw new Error(`Transcription failed: ${i.status} - ${n}`)}return i.json()}convertToSubtitles(e,t){return!e.words||e.words.length===0?e.text?[{id:this.generateId(),text:e.text.trim(),startTime:t.startTime,endTime:t.startTime+t.duration,style:wC,words:void 0,animationStyle:"none"}]:[]:this.groupWordsIntoSubtitles(e.words,t.startTime)}groupWordsIntoSubtitles(e,t){const s=[],i=this.config.maxWordsPerSegment||10,n=this.config.maxSegmentDuration||5;let a=[],o=0;for(const l of e){a.length===0&&(o=l.start);const d=a.length>=i,u=l.end-o>n,h=/[.!?]$/.test(l.word);(d||u)&&a.length>0?(s.push(this.createSubtitleFromWords(a,t)),a=[l],o=l.start):(a.push(l),h&&a.length>=3&&(s.push(this.createSubtitleFromWords(a,t)),a=[]))}return a.length>0&&s.push(this.createSubtitleFromWords(a,t)),s}createSubtitleFromWords(e,t){const s=e.map(a=>a.word).join(" ").trim(),i=t+e[0].start,n=t+e[e.length-1].end;return{id:this.generateId(),text:s,startTime:i,endTime:n,style:wC,words:e.map(a=>({text:a.word,startTime:t+a.start,endTime:t+a.end})),animationStyle:"none"}}generateId(){return`sub-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}}let rd=null;function fY(){return rd}function gY(r){return rd&&rd.dispose(),rd=new mY(r),rd}function Tb(r,e,t){return Math.min(Math.max(r,e),t)}function yY(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375}function ul(r){return{segments:[{text:r.text,style:"normal",opacity:1,scale:1,offsetY:0}],visible:!0}}function xY(r,e){if(!r.words||r.words.length===0)return ul(r);const t=r.style?.highlightColor||"#ffff00",s=r.style?.upcomingColor;return{segments:r.words.map(n=>{const a=e>=n.startTime&&e<n.endTime,o=e>=n.endTime,l=e<n.startTime;let d;return a?d=t:l&&s&&(d=s),{text:n.text,style:a?"highlighted":"normal",opacity:1,scale:a?1.15:1,offsetY:a?-2:0,color:d}}),visible:!0}}function bY(r,e){if(!r.words||r.words.length===0)return ul(r);const t=r.words.find(s=>e>=s.startTime&&e<s.endTime);if(!t){const s=r.words[r.words.length-1];return e>=s.endTime?{segments:[{text:s.text,style:"normal",opacity:1,scale:1,offsetY:0}],visible:!0}:{segments:[],visible:!1}}return{segments:[{text:t.text,style:"active",opacity:1,scale:1,offsetY:0}],visible:!0}}function vY(r,e){if(!r.words||r.words.length===0)return ul(r);const t=r.style?.highlightColor||"#ffff00",s=r.style?.upcomingColor||"rgba(255, 255, 255, 0.5)";return{segments:r.words.map(n=>{const a=n.endTime-n.startTime,o=e-n.startTime,l=Tb(o/a,0,1),d=e<n.startTime,u=e>=n.startTime&&e<n.endTime,h=e>=n.endTime;let p="normal",m;return d?(p="normal",m=s):h?(p="highlighted",m=t):u&&(p="active",m=`linear-gradient(90deg, ${t} ${l*100}%, ${s} ${l*100}%)`),{text:n.text,style:p,opacity:1,scale:u?1.05:1,offsetY:0,color:m}}),visible:!0}}function wY(r,e){if(!r.words||r.words.length===0)return ul(r);const t=.3;return{segments:r.words.map(i=>{const n=e-i.startTime;if(!(e>=i.startTime))return{text:i.text,style:"hidden",opacity:0,scale:0,offsetY:20};const o=Tb(n/t,0,1),l=yY(o),d=e>=i.startTime&&e<i.endTime;return{text:i.text,style:d?"active":"normal",opacity:l,scale:.5+l*.5,offsetY:20*(1-l)}}),visible:!0}}function kY(r,e){if(!r.words||r.words.length===0)return ul(r);const t=r.words.filter(i=>e>=i.startTime);return t.length===0?{segments:[],visible:!1}:{segments:t.map((i,n)=>{const a=n===t.length-1,o=e-i.startTime,d=a?Tb(o/.1,0,1):1;return{text:i.text,style:"normal",opacity:d,scale:1,offsetY:0}}),visible:!0}}function CY(r,e){if(e<r.startTime||e>r.endTime)return{segments:[],visible:!1};switch(r.animationStyle||"none"){case"word-highlight":return xY(r,e);case"word-by-word":return bY(r,e);case"karaoke":return vY(r,e);case"bounce":return wY(r,e);case"typewriter":return kY(r,e);case"none":default:return ul(r)}}function kC(r){return{none:"Static","word-highlight":"Word Highlight","word-by-word":"Word by Word",karaoke:"Karaoke",bounce:"Bounce",typewriter:"Typewriter"}[r]}const CC=["none","word-highlight","word-by-word","karaoke","bounce","typewriter"],Na=r=>!r||r==="linear"?t=>t:r==="ease-in"?Li.easeInQuad:r==="ease-out"?Li.easeOutQuad:r==="ease-in-out"?Li.easeInOutQuad:r==="bezier"?Li.easeInOutCubic:Li[r]||(t=>t),Ys={opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0},SY=r=>{const{unit:e,progress:t,isIn:s}=r,i=r.animation.stagger||.05,n=e.index*i,a=r.animation.inDuration-(e.totalUnits-1)*i;let o;return s?o=Math.max(0,Math.min(1,(t*r.animation.inDuration-n)/a)):o=1-Math.max(0,Math.min(1,(t*r.animation.outDuration-n)/a)),{...Ys,opacity:o>=.5?1:0}},TY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=Na(n.easing||"easeOutQuad"),l=e.index*a,d=s?i.inDuration:i.outDuration,u=Math.max(.1,d-(e.totalUnits-1)*a);let h=Math.max(0,Math.min(1,(t*d-l)/u));s||(h=1-h);const p=o(h),m=n.fadeOpacity?.start??0,f=n.fadeOpacity?.end??1,g=m+(f-m)*p;return{...Ys,opacity:g}},th=r=>e=>{const{unit:t,progress:s,isIn:i,animation:n}=e,a=n.params,o=n.stagger||.03,l=Na(a.easing||"easeOutCubic"),d=a.slideDistance||50,u=t.index*o,h=i?n.inDuration:n.outDuration,p=Math.max(.1,h-(t.totalUnits-1)*o);let m=Math.max(0,Math.min(1,(s*h-u)/p));i||(m=1-m);const f=l(m);let g=0,y=0;const x=d*(1-f);switch(r){case"left":g=-x;break;case"right":g=x;break;case"up":y=-x;break;case"down":y=x;break}return{...Ys,opacity:f,offsetX:g,offsetY:y}},AY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=Na(n.easing||"easeOutBack"),l=n.scaleFrom??0,d=n.scaleTo??1,u=e.index*a,h=s?i.inDuration:i.outDuration,p=Math.max(.1,h-(e.totalUnits-1)*a);let m=Math.max(0,Math.min(1,(t*h-u)/p));s||(m=1-m);const f=o(m),g=l+(d-l)*f;return{...Ys,opacity:f,scale:{x:g,y:g}}},jY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=Na(n.easing||"easeOutQuad"),l=n.blurAmount??10,d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const m=o(p),f=l*(1-m);return{...Ys,opacity:m,blur:f}},_Y=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.05,o=n.bounceHeight??30,l=e.index*a,d=s?i.inDuration:i.outDuration,u=Math.max(.1,d-(e.totalUnits-1)*a);let h=Math.max(0,Math.min(1,(t*d-l)/u));s||(h=1-h);const p=Li.easeOutBounce(h),m=-o*(1-p);return{...Ys,opacity:h>0?1:0,offsetY:m}},EY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=Na(n.easing||"easeOutBack"),l=n.rotateAngle??180,d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const m=o(p),f=l*(1-m);return{...Ys,opacity:m,rotation:f,scale:{x:m,y:m}}},MY=r=>{const{unit:e,progress:t,animation:s}=r,i=s.params,n=i.waveAmplitude??10,a=i.waveFrequency??2,o=e.index/e.totalUnits*Math.PI*2,l=Math.sin(t*Math.PI*2*a+o)*n;return{...Ys,offsetY:l}},PY=r=>{const{progress:e,animation:t}=r,s=t.params,i=s.shakeIntensity??5,n=s.shakeSpeed??20,a=Math.sin(e*Math.PI*2*n)*i,o=Math.cos(e*Math.PI*2*n*1.3)*i*.5;return{...Ys,offsetX:a,offsetY:o}},NY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.05,o=n.popOvershoot??1.2,l=e.index*a,d=s?i.inDuration:i.outDuration,u=Math.max(.1,d-(e.totalUnits-1)*a);let h=Math.max(0,Math.min(1,(t*d-l)/u));s||(h=1-h);const p=Li.easeOutBack(h),m=h>0?p*(h<.5?o:1):0;return{...Ys,opacity:h>0?1:0,scale:{x:Math.max(0,m),y:Math.max(0,m)}}},RY=r=>{const{unit:e,progress:t,animation:s}=r,i=s.params,n=i.glitchIntensity??10,a=i.glitchSpeed??10,o=t*a,l=Math.floor(o)+e.index*.3,d=Math.sin(l*12.9898)*43758.5453,u=d-Math.floor(d),h=u>.7,p=h?(u-.5)*n*2:0,m=h?(u-.5)*5:0;return{...Ys,offsetX:p,skewX:m,color:h&&u>.85?`hsl(${u*360}, 100%, 50%)`:void 0}},IY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=Na(n.easing||"easeOutCubic"),l=n.splitDirection||"horizontal",d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const m=o(p),f=(e.totalUnits-1)/2,x=100*(e.index-f)*(1-m)/f;return{...Ys,opacity:m,offsetX:l==="horizontal"?x:0,offsetY:l==="vertical"?x:0}},DY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.05,o=Na(n.easing||"easeOutBack"),l=n.flipAxis||"y",d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const m=o(p),f=90*(1-m),g=Math.cos(f*Math.PI/180);return{...Ys,opacity:m>.1?1:0,scale:l==="x"?{x:g,y:1}:{x:1,y:g},rotation:0}},FY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=n.wordDelay??.2,o=Na(n.easing||"easeOutQuad"),l=e.index*a,d=s?i.inDuration:i.outDuration;let h=Math.max(0,Math.min(1,(t*d-l)/.3));s||(h=1-h);const p=o(h);return{...Ys,opacity:p,offsetY:20*(1-p),scale:{x:.8+.2*p,y:.8+.2*p}}},BY=r=>{const{unit:e,progress:t,animation:s}=r,n=s.params.rainbowSpeed??1,a=(e.index/e.totalUnits*360+t*360*n)%360;return{...Ys,color:`hsl(${a}, 80%, 60%)`}},LY={none:()=>Ys,typewriter:SY,fade:TY,"slide-left":th("left"),"slide-right":th("right"),"slide-up":th("up"),"slide-down":th("down"),scale:AY,blur:jY,bounce:_Y,rotate:EY,wave:MY,shake:PY,pop:NY,glitch:RY,split:IY,flip:DY,"word-by-word":FY,rainbow:BY};function $f(r){const e=LY[r.animation.preset];return e?e(r):Ys}class OY{measureCtx=null;constructor(){if(typeof OffscreenCanvas<"u"){const e=new OffscreenCanvas(1,1);this.measureCtx=e.getContext("2d")}else if(typeof document<"u"){const e=document.createElement("canvas");this.measureCtx=e.getContext("2d")}}measureText(e,t,s,i,n,a){if(!this.measureCtx)return this.createFallbackLayout(e,s,a);const o=this.measureCtx;o.font=`${i} ${s}px ${t}`;const l=e.split(`
`),d=[],u=[],h=[];let p=0,m=0,f=0;const g=s*a;for(let v=0;v<l.length;v++){const b=l[v],S=[],C=o.measureText(b).width+(b.length-1)*n;let A=0;const T=b.split(/(\s+)/);let j=0;for(const M of T){if(!M)continue;const E=/^\s+$/.test(M),D=[],R=A;for(let B=0;B<M.length;B++){const O=M[B],I=o.measureText(O).width,K={char:O,x:A,y:f,width:I,height:s,lineIndex:v,charIndexInLine:D.length,globalIndex:p};D.push(K),u.push(K),p++,A+=I+n}if(!E&&D.length>0){const B=A-R-n,O={word:M,chars:D,x:R,y:f,width:B,height:s,lineIndex:v,wordIndexInLine:j,globalIndex:m};S.push(O),h.push(O),m++,j++}}const _={text:b,words:S,x:0,y:f,width:C,height:g,lineIndex:v};d.push(_),f+=g}const y=Math.max(...d.map(v=>v.width),0);return{characters:u,words:h,lines:d,totalWidth:y,totalHeight:f}}createFallbackLayout(e,t,s){const i=t*.6,n=e.split(`
`),a=[],o=[],l=[];let d=0,u=0,h=0;const p=t*s;for(let m=0;m<n.length;m++){const f=n[m],g=[];let y=0;const x=f.split(/(\s+)/);for(const b of x){if(!b)continue;const S=/^\s+$/.test(b),k=[],C=y;for(let A=0;A<b.length;A++){const T=b[A],j=i,_={char:T,x:y,y:h,width:j,height:t,lineIndex:m,charIndexInLine:k.length,globalIndex:d};k.push(_),o.push(_),d++,y+=j}if(!S&&k.length>0){const A=y-C,T={word:b,chars:k,x:C,y:h,width:A,height:t,lineIndex:m,wordIndexInLine:g.length,globalIndex:u};g.push(T),l.push(T),u++}}const v={text:f,words:g,x:0,y:h,width:y,height:p,lineIndex:m};a.push(v),h+=p}return{characters:o,words:l,lines:a,totalWidth:Math.max(...a.map(m=>m.width),0),totalHeight:h}}calculateAnimatedLayout(e,t){const s=e.animation;if(!s||s.preset==="none")return this.createStaticLayout(e);const i=this.measureText(e.text,e.style.fontFamily,e.style.fontSize,String(e.style.fontWeight),e.style.letterSpacing,e.style.lineHeight),n=t-e.startTime,a=e.duration,o=n<=s.inDuration,l=n>=a-s.outDuration,d=!o&&!l;let u,h;if(o)u=s.inDuration>0?n/s.inDuration:1,h=!0;else if(l){const f=a-s.outDuration;u=s.outDuration>0?(n-f)/s.outDuration:0,h=!1}else u=1,h=!0;const p=s.unit||"character",m=[];for(const f of i.lines){const g=[];for(const b of f.words){const S=[];for(const T of b.chars){let j,_;p==="character"?(j={text:T.char,index:T.globalIndex,totalUnits:i.characters.length,x:T.x,y:T.y,width:T.width,height:T.height},_=i.characters.length):p==="word"?(j={text:b.word,index:b.globalIndex,totalUnits:i.words.length,x:b.x,y:b.y,width:b.width,height:b.height},_=i.words.length):(j={text:f.text,index:f.lineIndex,totalUnits:i.lines.length,x:f.x,y:f.y,width:f.width,height:f.height},_=i.lines.length);const M={unit:{...j,totalUnits:_},progress:d?1:u,isIn:h,animation:s,totalDuration:a},E=$f(M);S.push({...T,state:E})}const C={unit:{text:b.word,index:b.globalIndex,totalUnits:i.words.length,x:b.x,y:b.y,width:b.width,height:b.height},progress:d?1:u,isIn:h,animation:s,totalDuration:a},A=p==="word"||p==="line"?$f(C):{opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0};g.push({...b,state:A,animatedChars:S})}const x={unit:{text:f.text,index:f.lineIndex,totalUnits:i.lines.length,x:f.x,y:f.y,width:f.width,height:f.height},progress:d?1:u,isIn:h,animation:s,totalDuration:a},v=p==="line"?$f(x):{opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0};m.push({...f,state:v,animatedWords:g})}return{lines:m,totalWidth:i.totalWidth,totalHeight:i.totalHeight}}createStaticLayout(e){const t=this.measureText(e.text,e.style.fontFamily,e.style.fontSize,String(e.style.fontWeight),e.style.letterSpacing,e.style.lineHeight),s={opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0};return{lines:t.lines.map(n=>({...n,state:s,animatedWords:n.words.map(a=>({...a,state:s,animatedChars:a.chars.map(o=>({...o,state:s}))}))})),totalWidth:t.totalWidth,totalHeight:t.totalHeight}}}new OY;const $Y={syncMode:"smart",beatSubdivision:1,offsetMs:0,snapToDownbeats:!1};class zY{async analyzeBeats(e,t){t?.({phase:"analyzing",percent:20,message:"Analyzing audio for beats..."});const i=await AM().analyzeFromBlob(e);return t?.({phase:"complete",percent:100,message:`Detected ${i.bpm} BPM with ${i.beats.length} beats`}),i}calculateSyncedTimings(e,t,s,i){if(e.length===0||t.beats.length===0)return[];const n=[...e].sort((h,p)=>h.startTime-p.startTime),a=this.getSubdividedBeats(t,i),o=i.offsetMs/1e3,l=[];if(a.length<2)return[];const d=(a[a.length-1]-a[0])/(a.length-1);let u=0;for(const h of n){if(u>=a.length)break;const p=a[u]+s+o;switch(i.syncMode){case"preserve-duration":{l.push({clipId:h.id,originalStartTime:h.startTime,originalDuration:h.duration,newStartTime:p,newDuration:h.duration}),u++;break}case"one-per-beat":{const m=Math.min(u+1,a.length-1),g=a[m]+s+o-p;l.push({clipId:h.id,originalStartTime:h.startTime,originalDuration:h.duration,newStartTime:p,newDuration:Math.max(.1,g)}),u++;break}case"smart":default:{const m=Math.max(1,Math.round(h.duration/d)),f=Math.min(u+m,a.length-1),y=a[f]+s+o-p;l.push({clipId:h.id,originalStartTime:h.startTime,originalDuration:h.duration,newStartTime:p,newDuration:Math.max(.1,y)}),u=f;break}}}return l}getSubdividedBeats(e,t){const s=t.snapToDownbeats?e.beats.filter((n,a)=>a%4===0):e.beats;if(t.beatSubdivision===1)return s.map(n=>n.time);const i=[];for(let n=0;n<s.length-1;n++){const o=(s[n+1].time-s[n].time)/t.beatSubdivision;for(let l=0;l<t.beatSubdivision;l++)i.push(s[n].time+l*o)}return s.length>0&&i.push(s[s.length-1].time),i}snapClipToNearestBeat(e,t,s,i=.2){const n=e-s;let a=t.beats[0],o=Math.abs(a.time-n);for(const l of t.beats){const d=Math.abs(l.time-n);d<o&&(o=d,a=l)}return o<=i?a.time+s:e}}let zf=null;function SC(){return zf||(zf=new zY),zf}const VY=[{id:"smileys",name:"Smileys & Emotion",emojis:[{id:"grinning",emoji:"",name:"Grinning Face",category:"smileys"},{id:"joy",emoji:"",name:"Face with Tears of Joy",category:"smileys"},{id:"heart_eyes",emoji:"",name:"Smiling Face with Heart-Eyes",category:"smileys"},{id:"thinking",emoji:"",name:"Thinking Face",category:"smileys"},{id:"sunglasses",emoji:"",name:"Smiling Face with Sunglasses",category:"smileys"},{id:"wink",emoji:"",name:"Winking Face",category:"smileys"},{id:"thumbsup",emoji:"",name:"Thumbs Up",category:"smileys"},{id:"clap",emoji:"",name:"Clapping Hands",category:"smileys"},{id:"fire",emoji:"",name:"Fire",category:"smileys"},{id:"heart",emoji:"",name:"Red Heart",category:"smileys"},{id:"star",emoji:"",name:"Star",category:"smileys"},{id:"sparkles",emoji:"",name:"Sparkles",category:"smileys"}]},{id:"gestures",name:"Gestures",emojis:[{id:"wave",emoji:"",name:"Waving Hand",category:"gestures"},{id:"ok_hand",emoji:"",name:"OK Hand",category:"gestures"},{id:"point_up",emoji:"",name:"Index Pointing Up",category:"gestures"},{id:"point_right",emoji:"",name:"Backhand Index Pointing Right",category:"gestures"},{id:"raised_hands",emoji:"",name:"Raising Hands",category:"gestures"},{id:"pray",emoji:"",name:"Folded Hands",category:"gestures"},{id:"muscle",emoji:"",name:"Flexed Biceps",category:"gestures"},{id:"v",emoji:"",name:"Victory Hand",category:"gestures"}]},{id:"objects",name:"Objects",emojis:[{id:"camera",emoji:"",name:"Camera",category:"objects"},{id:"video_camera",emoji:"",name:"Video Camera",category:"objects"},{id:"microphone",emoji:"",name:"Microphone",category:"objects"},{id:"headphones",emoji:"",name:"Headphones",category:"objects"},{id:"movie_camera",emoji:"",name:"Movie Camera",category:"objects"},{id:"clapper",emoji:"",name:"Clapper Board",category:"objects"},{id:"trophy",emoji:"",name:"Trophy",category:"objects"},{id:"medal",emoji:"",name:"Sports Medal",category:"objects"},{id:"bell",emoji:"",name:"Bell",category:"objects"},{id:"megaphone",emoji:"",name:"Megaphone",category:"objects"}]},{id:"symbols",name:"Symbols",emojis:[{id:"check",emoji:"",name:"Check Mark",category:"symbols"},{id:"x",emoji:"",name:"Cross Mark",category:"symbols"},{id:"question",emoji:"",name:"Question Mark",category:"symbols"},{id:"exclamation",emoji:"",name:"Exclamation Mark",category:"symbols"},{id:"100",emoji:"",name:"Hundred Points",category:"symbols"},{id:"arrow_right",emoji:"",name:"Right Arrow",category:"symbols"},{id:"arrow_left",emoji:"",name:"Left Arrow",category:"symbols"},{id:"arrow_up",emoji:"",name:"Up Arrow",category:"symbols"},{id:"arrow_down",emoji:"",name:"Down Arrow",category:"symbols"},{id:"new",emoji:"",name:"New",category:"symbols"},{id:"free",emoji:"",name:"Free",category:"symbols"}]},{id:"nature",name:"Nature",emojis:[{id:"sun",emoji:"",name:"Sun",category:"nature"},{id:"moon",emoji:"",name:"Crescent Moon",category:"nature"},{id:"cloud",emoji:"",name:"Cloud",category:"nature"},{id:"rainbow",emoji:"",name:"Rainbow",category:"nature"},{id:"snowflake",emoji:"",name:"Snowflake",category:"nature"},{id:"lightning",emoji:"",name:"Lightning",category:"nature"},{id:"flower",emoji:"",name:"Cherry Blossom",category:"nature"},{id:"tree",emoji:"",name:"Deciduous Tree",category:"nature"}]}];class UY{stickers=new Map;categories=new Map;emojiCategories=VY;constructor(){this.initializeDefaultCategories()}initializeDefaultCategories(){const e=[{id:"arrows",name:"Arrows",icon:""},{id:"badges",name:"Badges",icon:""},{id:"banners",name:"Banners",icon:""},{id:"callouts",name:"Callouts",icon:""},{id:"social",name:"Social Media",icon:""},{id:"custom",name:"Custom",icon:""}];for(const t of e)this.categories.set(t.id,t)}addSticker(e){this.stickers.set(e.id,e)}removeSticker(e){return this.stickers.delete(e)}getSticker(e){return this.stickers.get(e)}getAllStickers(){return Array.from(this.stickers.values())}getStickersByCategory(e){return Array.from(this.stickers.values()).filter(t=>t.category===e)}searchStickers(e){const t=e.toLowerCase();return Array.from(this.stickers.values()).filter(s=>s.name.toLowerCase().includes(t)||s.tags?.some(i=>i.toLowerCase().includes(t)))}addCategory(e){this.categories.set(e.id,e)}getCategories(){return Array.from(this.categories.values())}getCategory(e){return this.categories.get(e)}getEmojiCategories(){return this.emojiCategories}getEmojisByCategory(e){return this.emojiCategories.find(s=>s.id===e)?.emojis||[]}getAllEmojis(){return this.emojiCategories.flatMap(e=>e.emojis)}searchEmojis(e){const t=e.toLowerCase();return this.getAllEmojis().filter(s=>s.name.toLowerCase().includes(t))}getEmoji(e){return this.getAllEmojis().find(t=>t.id===e)}createStickerClip(e,t,s,i){return{id:`sticker_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,trackId:t,startTime:s,duration:i,type:"sticker",imageUrl:e.imageUrl,category:e.category,name:e.name,transform:{...Tp},keyframes:[]}}createEmojiClip(e,t,s,i){const n=this.emojiToDataUrl(e.emoji);return{id:`emoji_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,trackId:t,startTime:s,duration:i,type:"emoji",imageUrl:n,category:e.category,name:e.name,transform:{...Tp},keyframes:[]}}emojiToDataUrl(e,t=128){if(typeof document>"u")return`data:text/plain;base64,${btoa(e)}`;const s=document.createElement("canvas");s.width=t,s.height=t;const i=s.getContext("2d");return i?(i.font=`${t*.8}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif`,i.textAlign="center",i.textBaseline="middle",i.fillText(e,t/2,t/2),s.toDataURL("image/png")):`data:text/plain;base64,${btoa(e)}`}async importSticker(e,t,s="custom",i){const n=await this.fileToDataUrl(e),a={id:`custom_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,name:t,category:s,imageUrl:n,tags:i};return this.addSticker(a),a}fileToDataUrl(e){return new Promise((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>s(new Error("Failed to read file")),i.readAsDataURL(e)})}clearCustomStickers(){for(const[e,t]of this.stickers)t.category==="custom"&&this.stickers.delete(e)}}const gee=new UY,GY=[{id:"none",name:"None",description:"No animation",category:"entrance",defaultDuration:0,defaultEasing:"linear"},{id:"fade",name:"Fade",description:"Smooth fade in/out",category:"entrance",defaultDuration:.5,defaultEasing:"ease-out"},{id:"slide-left",name:"Slide from Right",description:"Slide in from the right side",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"slide-right",name:"Slide from Left",description:"Slide in from the left side",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"slide-up",name:"Slide from Bottom",description:"Slide in from below",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"slide-down",name:"Slide from Top",description:"Slide in from above",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"scale",name:"Scale",description:"Scale from zero to full size",category:"entrance",defaultDuration:.5,defaultEasing:"ease-out"},{id:"rotate",name:"Rotate",description:"Spin and fade in",category:"entrance",defaultDuration:.8,defaultEasing:"ease-out"},{id:"bounce",name:"Bounce",description:"Bouncy elastic effect",category:"entrance",defaultDuration:.8,defaultEasing:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},{id:"pop",name:"Pop",description:"Quick pop with overshoot",category:"entrance",defaultDuration:.5,defaultEasing:"cubic-bezier(0.175, 0.885, 0.32, 1.275)"},{id:"draw",name:"Draw",description:"SVG stroke drawing effect",category:"entrance",defaultDuration:1.2,defaultEasing:"ease-in-out"},{id:"wipe-left",name:"Wipe Left",description:"Reveal from left edge",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"wipe-right",name:"Wipe Right",description:"Reveal from right edge",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"wipe-up",name:"Wipe Up",description:"Reveal from bottom",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"wipe-down",name:"Wipe Down",description:"Reveal from top",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"reveal-center",name:"Reveal Center",description:"Expand from center",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"reveal-edges",name:"Reveal Edges",description:"Collapse to center",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"elastic",name:"Elastic",description:"Elastic bounce effect",category:"entrance",defaultDuration:1,defaultEasing:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},{id:"flip-horizontal",name:"Flip Horizontal",description:"3D horizontal flip",category:"entrance",defaultDuration:.8,defaultEasing:"ease-out"},{id:"flip-vertical",name:"Flip Vertical",description:"3D vertical flip",category:"entrance",defaultDuration:.8,defaultEasing:"ease-out"}],WY={x:0,y:0,scale:1,rotation:0,anchorX:.5,anchorY:.5},YY="normal",qY=1;class HY{defaultWidth;defaultHeight;canvas=null;ctx=null;constructor(e={}){this.defaultWidth=e.width??1920,this.defaultHeight=e.height??1080}createProject(e=this.defaultWidth,t=this.defaultHeight,s="Untitled"){return{id:ff(),name:s,width:e,height:t,layers:[],selectedLayerIndex:-1,backgroundColor:"#ffffff"}}importPhoto(e,t,s="Background"){const i=this.createLayer({name:s,type:"image",content:t});return{...e,width:t.width,height:t.height,layers:[i],selectedLayerIndex:0}}createLayer(e={}){return{id:ff(),name:e.name??"Layer",type:e.type??"image",content:e.content??null,opacity:e.opacity??qY,blendMode:e.blendMode??YY,visible:!0,locked:!1,mask:null,adjustments:[],transform:{...WY}}}addLayer(e,t={}){const s=this.createLayer(t),i=[...e.layers],n=t.insertAt??e.selectedLayerIndex+1,a=Math.max(0,Math.min(n,i.length));return i.splice(a,0,s),{...e,layers:i,selectedLayerIndex:a}}removeLayer(e,t){const s=e.layers.findIndex(a=>a.id===t);if(s===-1)return e;const i=e.layers.filter(a=>a.id!==t);let n=e.selectedLayerIndex;return n>=i.length?n=Math.max(0,i.length-1):n>s&&n--,{...e,layers:i,selectedLayerIndex:i.length>0?n:-1}}reorderLayers(e,t,s){if(t<0||t>=e.layers.length||s<0||s>=e.layers.length)return{success:!1,layers:e.layers,error:"Invalid layer index"};if(t===s)return{success:!0,layers:e.layers};const i=[...e.layers],[n]=i.splice(t,1);return i.splice(s,0,n),{success:!0,layers:i}}setLayerOpacity(e,t,s){const i=Math.max(0,Math.min(1,s));return{...e,layers:e.layers.map(n=>n.id===t?{...n,opacity:i}:n)}}setLayerVisibility(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,visible:s??!i.visible}:i)}}setLayerBlendMode(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,blendMode:s}:i)}}setLayerTransform(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,transform:{...i.transform,...s}}:i)}}setLayerLocked(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,locked:s}:i)}}renameLayer(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,name:s}:i)}}duplicateLayer(e,t){const s=e.layers.find(o=>o.id===t);if(!s)return e;const i=e.layers.findIndex(o=>o.id===t),n={...s,id:ff(),name:`${s.name} Copy`},a=[...e.layers];return a.splice(i+1,0,n),{...e,layers:a,selectedLayerIndex:i+1}}selectLayer(e,t){const s=e.layers.findIndex(i=>i.id===t);return s===-1?e:{...e,selectedLayerIndex:s}}getSelectedLayer(e){return e.selectedLayerIndex<0||e.selectedLayerIndex>=e.layers.length?null:e.layers[e.selectedLayerIndex]}getLayer(e,t){return e.layers.find(s=>s.id===t)??null}async renderComposite(e,t={}){const s=t.width??e.width,i=t.height??e.height,n=t.includeHidden??!1,a=t.backgroundColor??e.backgroundColor;(!this.canvas||this.canvas.width!==s||this.canvas.height!==i)&&(this.canvas=new OffscreenCanvas(s,i),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}));const o=this.ctx;o.fillStyle=a,o.fillRect(0,0,s,i);for(const l of e.layers)!l.visible&&!n||!l.content&&l.type==="image"||(o.globalAlpha=l.opacity,o.globalCompositeOperation=this.getCanvasBlendMode(l.blendMode),l.content&&(o.save(),this.applyLayerTransform(o,l,s,i),o.drawImage(l.content,0,0),o.restore()));return o.globalAlpha=1,o.globalCompositeOperation="source-over",createImageBitmap(this.canvas)}applyLayerTransform(e,t,s,i){const{transform:n,content:a}=t;if(!a)return;const o=a.width,l=a.height,d=o*n.anchorX,u=l*n.anchorY;e.translate(n.x+d,n.y+u),e.rotate(n.rotation*Math.PI/180),e.scale(n.scale,n.scale),e.translate(-d,-u)}getCanvasBlendMode(e){return{normal:"source-over",multiply:"multiply",screen:"screen",overlay:"overlay",softLight:"soft-light",hardLight:"hard-light",colorDodge:"color-dodge",colorBurn:"color-burn",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"}[e]??"source-over"}async flattenLayers(e){if(e.layers.length===0)return e;const t=await this.renderComposite(e),s=this.createLayer({name:"Flattened",type:"image",content:t});return{...e,layers:[s],selectedLayerIndex:0}}async mergeLayerDown(e,t){const s=e.layers.findIndex(u=>u.id===t);if(s<=0)return e;const i=e.layers[s],n=e.layers[s-1],a={...e,layers:[n,i],backgroundColor:"transparent"},o=await this.renderComposite(a),l={...n,content:o,name:n.name},d=[...e.layers];return d.splice(s-1,2,l),{...e,layers:d,selectedLayerIndex:Math.min(e.selectedLayerIndex,d.length-1)}}canModifyLayer(e,t){const s=this.getLayer(e,t);return s!==null&&!s.locked}getVisibleLayers(e){return e.layers.filter(t=>t.visible)}getLayerCount(e){return e.layers.length}dispose(){this.canvas=null,this.ctx=null}}let Vf=null;function XY(){return Vf||(Vf=new HY),Vf}const KY="openreel-templates",Pr="templates",QY=1,Zt={position:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},Uf=[{id:"builtin-youtube-intro",name:"YouTube Intro",description:"10-second animated intro with logo and channel name",category:"youtube",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Background",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-1",type:"text",name:"Channel Name",clips:[{id:"clip-channel-name",mediaId:"text-channel",trackId:"track-text-1",startTime:1,duration:8,inPoint:0,outPoint:8,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.5}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"channel-name"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:10,markers:[]},placeholders:[{id:"channel-name",type:"text",label:"Channel Name",required:!0,defaultValue:"Your Channel"}],tags:["youtube","intro","animated"],version:"1.0.0"},{id:"builtin-tiktok-promo",name:"TikTok Promo",description:"Vertical 15-second promo with call-to-action text",category:"tiktok",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Main Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-1",type:"text",name:"CTA Text",clips:[{id:"clip-cta",mediaId:"text-cta",trackId:"track-text-1",startTime:10,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.85}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"cta-text"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:15,markers:[]},placeholders:[{id:"cta-text",type:"text",label:"Call to Action",required:!0,defaultValue:"Swipe Up!"}],tags:["tiktok","vertical","promo"],version:"1.0.0"},{id:"builtin-lower-third",name:"Lower Third",description:"Professional name & title overlay for interviews",category:"lower-third",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Background Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-name",type:"text",name:"Name",clips:[{id:"clip-name",mediaId:"text-name",trackId:"track-text-name",startTime:.5,duration:4,inPoint:0,outPoint:4,effects:[],audioEffects:[],transform:{...Zt,position:{x:.15,y:.82}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"name"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-title",type:"text",name:"Title",clips:[{id:"clip-title",mediaId:"text-title",trackId:"track-text-title",startTime:.7,duration:3.8,inPoint:0,outPoint:3.8,effects:[],audioEffects:[],transform:{...Zt,position:{x:.15,y:.88}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"title"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:5,markers:[]},placeholders:[{id:"name",type:"text",label:"Name",required:!0,defaultValue:"John Smith"},{id:"title",type:"text",label:"Title/Position",required:!1,defaultValue:"CEO, Company Inc."}],tags:["lower-third","name","title","interview"],version:"1.0.0"},{id:"builtin-slideshow",name:"Photo Slideshow",description:"30-second slideshow with 5 image slots",category:"slideshow",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-images",type:"image",name:"Photos",clips:[{id:"clip-image-1",mediaId:"placeholder-image-1",trackId:"track-images",startTime:0,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Zt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-1"},{id:"clip-image-2",mediaId:"placeholder-image-2",trackId:"track-images",startTime:6,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Zt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-2"},{id:"clip-image-3",mediaId:"placeholder-image-3",trackId:"track-images",startTime:12,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Zt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-3"},{id:"clip-image-4",mediaId:"placeholder-image-4",trackId:"track-images",startTime:18,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Zt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-4"},{id:"clip-image-5",mediaId:"placeholder-image-5",trackId:"track-images",startTime:24,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Zt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-5"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-caption",type:"text",name:"Caption",clips:[{id:"clip-caption",mediaId:"text-caption",trackId:"track-text-caption",startTime:2,duration:26,inPoint:0,outPoint:26,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.9}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"caption"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:30,markers:[]},placeholders:[{id:"image-1",type:"media",label:"Photo 1",required:!0},{id:"image-2",type:"media",label:"Photo 2",required:!0},{id:"image-3",type:"media",label:"Photo 3",required:!0},{id:"image-4",type:"media",label:"Photo 4",required:!1},{id:"image-5",type:"media",label:"Photo 5",required:!1},{id:"caption",type:"text",label:"Caption",required:!1,defaultValue:"My Photo Album"}],tags:["slideshow","photos","memories"],version:"1.0.0"},{id:"builtin-instagram-reel",name:"Instagram Reel",description:"30-second vertical reel with animated hook text",category:"instagram",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Main Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-hook",type:"text",name:"Hook Text",clips:[{id:"clip-hook",mediaId:"text-hook",trackId:"track-text-hook",startTime:.5,duration:4,inPoint:0,outPoint:4,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.15}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"hook-text"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-cta",type:"text",name:"CTA",clips:[{id:"clip-cta-reel",mediaId:"text-cta-reel",trackId:"track-text-cta",startTime:25,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.85}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"cta-text"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:30,markers:[]},placeholders:[{id:"hook-text",type:"text",label:"Hook Text",required:!0,defaultValue:"Wait for it..."},{id:"cta-text",type:"text",label:"Call to Action",required:!1,defaultValue:"Follow for more!"}],tags:["instagram","reel","vertical","hook"],version:"1.0.0"},{id:"builtin-youtube-shorts",name:"YouTube Short",description:"60-second vertical short with title and subscribe CTA",category:"youtube",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Main Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-title",type:"text",name:"Title",clips:[{id:"clip-title-short",mediaId:"text-title-short",trackId:"track-text-title",startTime:0,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.1}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"title"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-subscribe",type:"text",name:"Subscribe CTA",clips:[{id:"clip-subscribe",mediaId:"text-subscribe",trackId:"track-text-subscribe",startTime:50,duration:10,inPoint:0,outPoint:10,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.9}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"subscribe-cta"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:60,markers:[]},placeholders:[{id:"title",type:"text",label:"Video Title",required:!0,defaultValue:"Did You Know?"},{id:"subscribe-cta",type:"text",label:"Subscribe CTA",required:!1,defaultValue:"Subscribe for more!"}],tags:["youtube","shorts","vertical","subscribe"],version:"1.0.0"},{id:"builtin-quote-card",name:"Quote Card",description:"Animated quote card with author attribution",category:"instagram",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-bg",type:"graphics",name:"Background",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-quote",type:"text",name:"Quote",clips:[{id:"clip-quote",mediaId:"text-quote",trackId:"track-text-quote",startTime:.5,duration:9,inPoint:0,outPoint:9,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.45}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"quote"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-author",type:"text",name:"Author",clips:[{id:"clip-author",mediaId:"text-author",trackId:"track-text-author",startTime:1.5,duration:8,inPoint:0,outPoint:8,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.7}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"author"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:10,markers:[]},placeholders:[{id:"quote",type:"text",label:"Quote",required:!0,defaultValue:"The only way to do great work is to love what you do."},{id:"author",type:"text",label:"Author",required:!0,defaultValue:"- Steve Jobs"}],tags:["instagram","quote","inspiration","square"],version:"1.0.0"},{id:"builtin-product-promo",name:"Product Promo",description:"15-second TikTok-style product showcase",category:"tiktok",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-product",type:"video",name:"Product Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-headline",type:"text",name:"Headline",clips:[{id:"clip-headline",mediaId:"text-headline",trackId:"track-text-headline",startTime:0,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.12}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"headline"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-price",type:"text",name:"Price",clips:[{id:"clip-price",mediaId:"text-price",trackId:"track-text-price",startTime:5,duration:10,inPoint:0,outPoint:10,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.75}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"price"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-cta-promo",type:"text",name:"CTA",clips:[{id:"clip-cta-promo",mediaId:"text-cta-promo",trackId:"track-text-cta-promo",startTime:10,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.88}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"cta"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:15,markers:[]},placeholders:[{id:"headline",type:"text",label:"Headline",required:!0,defaultValue:"NEW ARRIVAL"},{id:"price",type:"text",label:"Price",required:!0,defaultValue:"$29.99"},{id:"cta",type:"text",label:"Call to Action",required:!0,defaultValue:"Shop Now - Link in Bio!"}],tags:["tiktok","product","promo","ecommerce"],version:"1.0.0"},{id:"builtin-countdown",name:"Countdown Timer",description:"Event countdown with date and title",category:"instagram",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-bg-countdown",type:"graphics",name:"Background",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-event",type:"text",name:"Event Name",clips:[{id:"clip-event",mediaId:"text-event",trackId:"track-text-event",startTime:0,duration:10,inPoint:0,outPoint:10,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.25}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"event-name"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-date",type:"text",name:"Date",clips:[{id:"clip-date",mediaId:"text-date",trackId:"track-text-date",startTime:1,duration:9,inPoint:0,outPoint:9,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.6}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"event-date"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-swipe",type:"text",name:"Swipe Up",clips:[{id:"clip-swipe",mediaId:"text-swipe",trackId:"track-text-swipe",startTime:5,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Zt,position:{x:.5,y:.9}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"swipe-cta"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:10,markers:[]},placeholders:[{id:"event-name",type:"text",label:"Event Name",required:!0,defaultValue:"LAUNCH DAY"},{id:"event-date",type:"text",label:"Date",required:!0,defaultValue:"January 20th"},{id:"swipe-cta",type:"text",label:"Swipe CTA",required:!1,defaultValue:"Swipe Up for Details"}],tags:["instagram","stories","countdown","event"],version:"1.0.0"}];class JY{db=null;templates=new Map;async initialize(){if(!this.db)return new Promise((e,t)=>{const s=indexedDB.open(KY,QY);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,this.loadBuiltinTemplates(),e()},s.onupgradeneeded=i=>{const n=i.target.result;n.objectStoreNames.contains(Pr)||n.createObjectStore(Pr,{keyPath:"id"})}})}loadBuiltinTemplates(){for(const e of Uf)this.templates.set(e.id,e)}createFromProject(e,t){const s=`template-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,i=this.convertToTemplateTimeline(e.timeline,t.placeholders);return{id:s,name:t.name,description:t.description,category:t.category,thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:e.settings,timeline:i,placeholders:t.placeholders,tags:t.tags||[],version:"1.0.0"}}convertToTemplateTimeline(e,t){const s=new Set(t.map(a=>a.id)),i=e.tracks.map(a=>({...a,clips:a.clips.map(o=>this.convertToTemplateClip(o,s))})),n=e.subtitles.map(a=>({...a,isPlaceholder:!1}));return{...e,tracks:i,subtitles:n}}convertToTemplateClip(e,t){return{...e,isPlaceholder:t.has(e.mediaId),placeholderId:t.has(e.mediaId)?e.mediaId:void 0}}applyTemplate(e,t){const s=[],i=[],n={...t};for(const u of e.placeholders)!n[u.id]&&u.defaultValue&&(n[u.id]={type:u.type,value:u.defaultValue}),u.required&&!n[u.id]&&s.push(u.label);const a=`project-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,o=this.createMediaFromReplacements(n,e.placeholders),l=e.timeline.tracks.map(u=>{const h=u.clips.map(p=>{const m=this.resolveClipPlaceholder(p,n);if(p.isPlaceholder&&p.placeholderId){const f=e.placeholders.find(g=>g.id===p.placeholderId);if(f?.type==="text"){const g=n[p.placeholderId]?.value||f.defaultValue||"Text";i.push({id:p.id,text:g,placeholderId:p.placeholderId})}}return m});return{...u,clips:h}});return{project:{id:a,name:`${e.name} - Copy`,createdAt:Date.now(),modifiedAt:Date.now(),settings:e.settings,mediaLibrary:{items:o},timeline:{...e.timeline,tracks:l,subtitles:e.timeline.subtitles.map(u=>this.resolveSubtitlePlaceholder(u,n))}},missingPlaceholders:s,textClips:i}}createMediaFromReplacements(e,t){const s=[];for(const i of t){const n=e[i.id];n&&n.type==="media"&&n.mediaBlob&&s.push({id:i.id,name:n.value,type:"image",fileHandle:null,blob:n.mediaBlob,metadata:{duration:0,width:1920,height:1080,frameRate:30,codec:"",sampleRate:0,channels:0,fileSize:n.mediaBlob.size},thumbnailUrl:null,waveformData:null})}return s}resolveClipPlaceholder(e,t){if(!e.isPlaceholder||!e.placeholderId){const{isPlaceholder:l,placeholderId:d,...u}=e;return u}if(!t[e.placeholderId]){const{isPlaceholder:l,placeholderId:d,...u}=e;return u}const{isPlaceholder:i,placeholderId:n,...a}=e,o=e.mediaId.startsWith("text-")||e.mediaId.startsWith("shape-")||e.mediaId.startsWith("svg-");return{...a,mediaId:o?e.mediaId:e.placeholderId}}resolveSubtitlePlaceholder(e,t){if(!e.isPlaceholder||!e.placeholderId){const{isPlaceholder:o,placeholderId:l,...d}=e;return d}const s=t[e.placeholderId];if(!s||s.type!=="text"){const{isPlaceholder:o,placeholderId:l,...d}=e;return d}const{isPlaceholder:i,placeholderId:n,...a}=e;return{...a,text:s.value}}resolvePropertyPath(e,t){const s=t.split(".");let i=e;for(let o=0;o<s.length-1;o++){const l=s[o],d=l.match(/^(\w+)\[(\d+)\]$/);if(d){const[,u,h]=d,p=i[u];if(!Array.isArray(p))return null;const m=parseInt(h,10);if(m<0||m>=p.length)return null;i=p[m]}else{if(i[l]===void 0||i[l]===null||typeof i[l]!="object")return null;i=i[l]}}const n=s[s.length-1],a=n.match(/^(\w+)\[(\d+)\]$/);if(a){const[,o,l]=a,d=i[o];if(!Array.isArray(d))return null;const u=parseInt(l,10);return{parent:i,key:o,value:d[u]}}return{parent:i,key:n,value:i[n]}}setPropertyByPath(e,t,s){const i=this.resolvePropertyPath(e,t);if(!i)return!1;const{parent:n,key:a}=i,l=(t.split(".").pop()||"").match(/^(\w+)\[(\d+)\]$/);if(l){const[,d,u]=l,h=n[d];if(!Array.isArray(h))return!1;const p=parseInt(u,10);h[p]=s}else n[a]=s;return!0}validatePlaceholderValue(e,t){if(e.required&&(t==null||t===""))return{placeholderId:e.id,message:`${e.label} is required`,type:"missing"};if(t==null)return null;const s=e.constraints;switch(e.type){case"text":case"subtitle":if(typeof t!="string")return{placeholderId:e.id,message:`${e.label} must be a string`,type:"invalid"};if(s?.maxLength&&t.length>s.maxLength)return{placeholderId:e.id,message:`${e.label} exceeds maximum length of ${s.maxLength}`,type:"constraint"};if(s?.pattern&&!new RegExp(s.pattern).test(t))return{placeholderId:e.id,message:`${e.label} does not match required pattern`,type:"constraint"};break;case"number":if(typeof t!="number")return{placeholderId:e.id,message:`${e.label} must be a number`,type:"invalid"};if(s?.min!==void 0&&t<s.min)return{placeholderId:e.id,message:`${e.label} must be at least ${s.min}`,type:"constraint"};if(s?.max!==void 0&&t>s.max)return{placeholderId:e.id,message:`${e.label} must be at most ${s.max}`,type:"constraint"};break;case"boolean":if(typeof t!="boolean")return{placeholderId:e.id,message:`${e.label} must be a boolean`,type:"invalid"};break;case"color":if(typeof t!="string"||!/^#[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/.test(t))return{placeholderId:e.id,message:`${e.label} must be a valid hex color`,type:"invalid"};break}return s?.allowedValues&&!s.allowedValues.includes(String(t))?{placeholderId:e.id,message:`${e.label} must be one of: ${s.allowedValues.join(", ")}`,type:"constraint"}:null}applyScriptableTemplate(e,t){const s=[],i=[],n=[],a={...t};for(const h of e.placeholders){!a[h.id]&&h.defaultValue!==void 0&&(a[h.id]={type:h.type,value:h.defaultValue});const p=this.validatePlaceholderValue(h,a[h.id]?.value);p&&s.push(p)}const o=`project-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,l=JSON.parse(JSON.stringify(e.timeline));for(const h of e.placeholders){const p=a[h.id];if(p){for(const m of h.targets)this.applyPlaceholderToTarget(l,m,p.value,h,i);if(h.type==="text"){let m=!1;for(const f of h.targets)if(f.clipId)for(const g of l.tracks){const y=g.clips.find(x=>x.id===f.clipId);if(y){n.push({id:y.id,text:String(p.value??h.defaultValue??""),placeholderId:h.id,trackId:g.id,startTime:y.startTime,duration:y.duration,transform:y.transform}),m=!0;break}}if(!m)for(const f of l.tracks){for(const g of f.clips){const y=g;if(y.isPlaceholder&&y.placeholderId===h.id){n.push({id:g.id,text:String(p.value??h.defaultValue??""),placeholderId:h.id,trackId:f.id,startTime:g.startTime,duration:g.duration,transform:g.transform}),m=!0;break}}if(m)break}}}}const d=this.createMediaFromScriptableReplacements(a,e.placeholders);return{project:{id:o,name:`${e.name} - Copy`,createdAt:Date.now(),modifiedAt:Date.now(),settings:e.settings,mediaLibrary:{items:d},timeline:l},result:{success:s.length===0,errors:s,warnings:i},textClips:n}}applyPlaceholderToTarget(e,t,s,i,n){if(t.clipId){for(const a of e.tracks){const o=a.clips.find(l=>l.id===t.clipId);if(o){const l=o;this.setPropertyByPath(l,t.property,s)||n.push(`Failed to set ${t.property} on clip ${t.clipId}`);return}}n.push(`Clip ${t.clipId} not found for placeholder ${i.id}`)}else if(t.trackId){const a=e.tracks.find(o=>o.id===t.trackId);if(a){const o=a;this.setPropertyByPath(o,t.property,s)||n.push(`Failed to set ${t.property} on track ${t.trackId}`)}else n.push(`Track ${t.trackId} not found for placeholder ${i.id}`)}else if(t.effectId){for(const a of e.tracks)for(const o of a.clips){const l=o.effects.find(d=>d.id===t.effectId);if(l){const d=l;this.setPropertyByPath(d,t.property,s)||n.push(`Failed to set ${t.property} on effect ${t.effectId}`);return}}n.push(`Effect ${t.effectId} not found for placeholder ${i.id}`)}}createMediaFromScriptableReplacements(e,t){const s=[];for(const i of t){const n=e[i.id];if(n&&n.type==="media"&&n.mediaBlob){const a=n.mediaBlob,o=n.value;s.push({id:i.id,name:typeof o=="string"?o:i.label,type:"image",fileHandle:null,blob:a,metadata:{duration:0,width:1920,height:1080,frameRate:30,codec:"",sampleRate:0,channels:0,fileSize:a.size},thumbnailUrl:null,waveformData:null})}}return s}async saveTemplate(e){return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([Pr],"readwrite").objectStore(Pr).put(e);a.onerror=()=>s(a.error),a.onsuccess=()=>{this.templates.set(e.id,e),t()}})}async loadTemplate(e){return this.templates.has(e)?this.templates.get(e)||null:(this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([Pr],"readonly").objectStore(Pr).get(e);a.onerror=()=>s(a.error),a.onsuccess=()=>{const o=a.result;o&&this.templates.set(o.id,o),t(o||null)}}))}async deleteTemplate(e){if(e.startsWith("builtin-"))throw new Error("Cannot delete built-in templates");return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([Pr],"readwrite").objectStore(Pr).delete(e);a.onerror=()=>s(a.error),a.onsuccess=()=>{this.templates.delete(e),t()}})}async listTemplates(){return this.db||await this.initialize(),new Promise((e,t)=>{const n=this.db.transaction([Pr],"readonly").objectStore(Pr).getAll();n.onerror=()=>t(n.error),n.onsuccess=()=>{const a=n.result.map(this.toSummary),o=Uf.map(this.toSummary);e([...o,...a])}})}getTemplatesByCategory(e){const t=[];for(const s of this.templates.values())s.category===e&&t.push(s);return t}searchTemplates(e){const t=e.toLowerCase(),s=[];for(const i of this.templates.values()){const n=i.name.toLowerCase().includes(t),a=i.description.toLowerCase().includes(t),o=i.tags.some(l=>l.toLowerCase().includes(t));(n||a||o)&&s.push(i)}return s}toSummary(e){return{id:e.id,name:e.name,category:e.category,thumbnailUrl:e.thumbnailUrl,placeholderCount:e.placeholders.length,duration:e.timeline.duration}}getBuiltinTemplates(){return[...Uf]}getAllTemplates(){return Array.from(this.templates.values())}}let ZY=null;function eq(){return ZY}const Bl={"16:9":{name:"Landscape (16:9)",ratio:16/9,width:1920,height:1080},"9:16":{name:"Portrait (9:16)",ratio:9/16,width:1080,height:1920},"1:1":{name:"Square (1:1)",ratio:1,width:1080,height:1080},"4:5":{name:"Portrait (4:5)",ratio:4/5,width:1080,height:1350},"4:3":{name:"Classic (4:3)",ratio:4/3,width:1440,height:1080},"21:9":{name:"Cinematic (21:9)",ratio:21/9,width:2560,height:1080},custom:{name:"Custom",ratio:16/9,width:1920,height:1080}},sh={youtube:{name:"YouTube",ratio:16/9,width:1920,height:1080,platform:"youtube"},tiktok:{name:"TikTok",ratio:9/16,width:1080,height:1920,platform:"tiktok"},"instagram-reels":{name:"Instagram Reels",ratio:9/16,width:1080,height:1920,platform:"instagram-reels"},"instagram-feed":{name:"Instagram Feed",ratio:1,width:1080,height:1080,platform:"instagram-feed"},"instagram-stories":{name:"Instagram Stories",ratio:9/16,width:1080,height:1920,platform:"instagram-stories"},"youtube-shorts":{name:"YouTube Shorts",ratio:9/16,width:1080,height:1920,platform:"youtube-shorts"},facebook:{name:"Facebook",ratio:16/9,width:1920,height:1080,platform:"facebook"},twitter:{name:"Twitter/X",ratio:16/9,width:1920,height:1080,platform:"twitter"},linkedin:{name:"LinkedIn",ratio:16/9,width:1920,height:1080,platform:"linkedin"}},tq={targetAspectRatio:"9:16",trackingSpeed:.5,padding:.1,smoothing:.8,followSubject:!0,centerBias:.3};function hn(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function jM(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}/*!
 * GSAP 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var Ui={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Hc={duration:.5,overwrite:!1,delay:0},Ab,Us,Vt,lr=1e8,Mt=1/lr,sy=Math.PI*2,sq=sy/4,iq=0,_M=Math.sqrt,rq=Math.cos,nq=Math.sin,Rs=function(e){return typeof e=="string"},is=function(e){return typeof e=="function"},jn=function(e){return typeof e=="number"},jb=function(e){return typeof e>"u"},Xr=function(e){return typeof e=="object"},Ei=function(e){return e!==!1},_b=function(){return typeof window<"u"},ih=function(e){return is(e)||Rs(e)},EM=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},si=Array.isArray,aq=/random\([^)]+\)/g,oq=/,\s*/g,TC=/(?:-?\.?\d|\.)+/gi,MM=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,xc=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Gf=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,PM=/[+-]=-?[.\d]+/,cq=/[^,'"\[\]\s]+/gi,lq=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Ht,Fr,iy,Eb,Wi={},Ap={},NM,RM=function(e){return(Ap=Xc(e,Wi))&&Ii},Mb=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},tu=function(e,t){return!t&&console.warn(e)},IM=function(e,t){return e&&(Wi[e]=t)&&Ap&&(Ap[e]=t)||Wi},su=function(){return 0},dq={suppressEvents:!0,isStart:!0,kill:!1},Lh={suppressEvents:!0,kill:!1},uq={suppressEvents:!0},Pb={},pa=[],ry={},DM,Fi={},Wf={},AC=30,Oh=[],Nb="",Rb=function(e){var t=e[0],s,i;if(Xr(t)||is(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(i=Oh.length;i--&&!Oh[i].targetTest(t););s=Oh[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new nP(e[i],s)))||e.splice(i,1);return e},vo=function(e){return e._gsap||Rb(dr(e))[0]._gsap},FM=function(e,t,s){return(s=e[t])&&is(s)?e[t]():jb(s)&&e.getAttribute&&e.getAttribute(t)||s},Mi=function(e,t){return(e=e.split(",")).forEach(t)||e},ls=function(e){return Math.round(e*1e5)/1e5||0},Yt=function(e){return Math.round(e*1e7)/1e7||0},Ec=function(e,t){var s=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+i:s==="-"?e-i:s==="*"?e*i:e/i},hq=function(e,t){for(var s=t.length,i=0;e.indexOf(t[i])<0&&++i<s;);return i<s},jp=function(){var e=pa.length,t=pa.slice(0),s,i;for(ry={},pa.length=0,s=0;s<e;s++)i=t[s],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Ib=function(e){return!!(e._initted||e._startAt||e.add)},BM=function(e,t,s,i){pa.length&&!Us&&jp(),e.render(t,s,!!(Us&&t<0&&Ib(e))),pa.length&&!Us&&jp()},LM=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(cq).length<2?t:Rs(e)?e.trim():e},OM=function(e){return e},Yi=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},pq=function(e){return function(t,s){for(var i in s)i in t||i==="duration"&&e||i==="ease"||(t[i]=s[i])}},Xc=function(e,t){for(var s in t)e[s]=t[s];return e},jC=function r(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=Xr(t[s])?r(e[s]||(e[s]={}),t[s]):t[s]);return e},_p=function(e,t){var s={},i;for(i in e)i in t||(s[i]=e[i]);return s},jd=function(e){var t=e.parent||Ht,s=e.keyframes?pq(si(e.keyframes)):Yi;if(Ei(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},mq=function(e,t){for(var s=e.length,i=s===t.length;i&&s--&&e[s]===t[s];);return s<0},$M=function(e,t,s,i,n){var a=e[i],o;if(n)for(o=t[n];a&&a[n]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},nm=function(e,t,s,i){s===void 0&&(s="_first"),i===void 0&&(i="_last");var n=t._prev,a=t._next;n?n._next=a:e[s]===t&&(e[s]=a),a?a._prev=n:e[i]===t&&(e[i]=n),t._next=t._prev=t.parent=null},ka=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},wo=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},fq=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},ny=function(e,t,s,i){return e._startAt&&(Us?e._startAt.revert(Lh):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},gq=function r(e){return!e||e._ts&&r(e.parent)},_C=function(e){return e._repeat?Kc(e._tTime,e=e.duration()+e._rDelay)*e:0},Kc=function(e,t){var s=Math.floor(e=Yt(e/t));return e&&s===e?s-1:s},Ep=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},am=function(e){return e._end=Yt(e._start+(e._tDur/Math.abs(e._ts||e._rts||Mt)||0))},om=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=Yt(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),am(e),s._dirty||wo(s,e)),e},zM=function(e,t){var s;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(s=Ep(e.rawTime(),t),(!t._dur||Tu(0,t.totalDuration(),s)-t._tTime>Mt)&&t.render(s,!0)),wo(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-Mt}},Lr=function(e,t,s,i){return t.parent&&ka(t),t._start=Yt((jn(s)?s:s||e!==Ht?ir(e,s,t):e._time)+t._delay),t._end=Yt(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),$M(e,t,"_first","_last",e._sort?"_start":0),ay(t)||(e._recent=t),i||zM(e,t),e._ts<0&&om(e,e._tTime),e},VM=function(e,t){return(Wi.ScrollTrigger||Mb("scrollTrigger",t))&&Wi.ScrollTrigger.create(t,e)},UM=function(e,t,s,i,n){if(Fb(e,t,n),!e._initted)return 1;if(!s&&e._pt&&!Us&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&DM!==Oi.frame)return pa.push(e),e._lazy=[n,i],1},yq=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},ay=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},xq=function(e,t,s,i){var n=e.ratio,a=t<0||!t&&(!e._start&&yq(e)&&!(!e._initted&&ay(e))||(e._ts<0||e._dp._ts<0)&&!ay(e))?0:1,o=e._rDelay,l=0,d,u,h;if(o&&e._repeat&&(l=Tu(0,e._tDur,t),u=Kc(l,o),e._yoyo&&u&1&&(a=1-a),u!==Kc(e._tTime,o)&&(n=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==n||Us||i||e._zTime===Mt||!t&&e._zTime){if(!e._initted&&UM(e,t,i,s,l))return;for(h=e._zTime,e._zTime=t||(s?Mt:0),s||(s=t&&!h),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=l,d=e._pt;d;)d.r(a,d.d),d=d._next;t<0&&ny(e,t,s,!0),e._onUpdate&&!s&&zi(e,"onUpdate"),l&&e._repeat&&!s&&e.parent&&zi(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===a&&(a&&ka(e,1),!s&&!Us&&(zi(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},bq=function(e,t,s){var i;if(s>t)for(i=e._first;i&&i._start<=s;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=s;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},Qc=function(e,t,s,i){var n=e._repeat,a=Yt(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=a/e._dur),e._dur=a,e._tDur=n?n<0?1e10:Yt(a*(n+1)+e._rDelay*n):a,o>0&&!i&&om(e,e._tTime=e._tDur*o),e.parent&&am(e),s||wo(e.parent,e),e},EC=function(e){return e instanceof ci?wo(e):Qc(e,e._dur)},vq={_start:0,endTime:su,totalDuration:su},ir=function r(e,t,s){var i=e.labels,n=e._recent||vq,a=e.duration()>=lr?n.endTime(!1):e._dur,o,l,d;return Rs(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),d=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?n._start:n.endTime(n._repeat>=0))+(parseFloat(t.substr(1))||0)*(d?(o<0?n:s).totalDuration()/100:1)):o<0?(t in i||(i[t]=a),i[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),d&&s&&(l=l/100*(si(s)?s[0]:s).totalDuration()),o>1?r(e,t.substr(0,o-1),s)+l:a+l)):t==null?a:+t},_d=function(e,t,s){var i=jn(t[1]),n=(i?2:1)+(e<2?0:1),a=t[n],o,l;if(i&&(a.duration=t[1]),a.parent=s,e){for(o=a,l=s;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=Ei(l.vars.inherit)&&l.parent;a.immediateRender=Ei(o.immediateRender),e<2?a.runBackwards=1:a.startAt=t[n-1]}return new ys(t[0],a,t[n+1])},Ra=function(e,t){return e||e===0?t(e):t},Tu=function(e,t,s){return s<e?e:s>t?t:s},Qs=function(e,t){return!Rs(e)||!(t=lq.exec(e))?"":t[1]},wq=function(e,t,s){return Ra(s,function(i){return Tu(e,t,i)})},oy=[].slice,GM=function(e,t){return e&&Xr(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Xr(e[0]))&&!e.nodeType&&e!==Fr},kq=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(i){var n;return Rs(i)&&!t||GM(i,1)?(n=s).push.apply(n,dr(i)):s.push(i)})||s},dr=function(e,t,s){return Vt&&!t&&Vt.selector?Vt.selector(e):Rs(e)&&!s&&(iy||!Jc())?oy.call((t||Eb).querySelectorAll(e),0):si(e)?kq(e,s):GM(e)?oy.call(e,0):e?[e]:[]},cy=function(e){return e=dr(e)[0]||tu("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return dr(t,s.querySelectorAll?s:s===e?tu("Invalid scope")||Eb.createElement("div"):e)}},WM=function(e){return e.sort(function(){return .5-Math.random()})},YM=function(e){if(is(e))return e;var t=Xr(e)?e:{each:e},s=ko(t.ease),i=t.from||0,n=parseFloat(t.base)||0,a={},o=i>0&&i<1,l=isNaN(i)||o,d=t.axis,u=i,h=i;return Rs(i)?u=h={center:.5,edges:.5,end:1}[i]||0:!o&&l&&(u=i[0],h=i[1]),function(p,m,f){var g=(f||t).length,y=a[g],x,v,b,S,k,C,A,T,j;if(!y){if(j=t.grid==="auto"?0:(t.grid||[1,lr])[1],!j){for(A=-lr;A<(A=f[j++].getBoundingClientRect().left)&&j<g;);j<g&&j--}for(y=a[g]=[],x=l?Math.min(j,g)*u-.5:i%j,v=j===lr?0:l?g*h/j-.5:i/j|0,A=0,T=lr,C=0;C<g;C++)b=C%j-x,S=v-(C/j|0),y[C]=k=d?Math.abs(d==="y"?S:b):_M(b*b+S*S),k>A&&(A=k),k<T&&(T=k);i==="random"&&WM(y),y.max=A-T,y.min=T,y.v=g=(parseFloat(t.amount)||parseFloat(t.each)*(j>g?g-1:d?d==="y"?g/j:j:Math.max(j,g/j))||0)*(i==="edges"?-1:1),y.b=g<0?n-g:n,y.u=Qs(t.amount||t.each)||0,s=s&&g<0?sP(s):s}return g=(y[p]-y.min)/y.max||0,Yt(y.b+(s?s(g):g)*y.v)+y.u}},ly=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var i=Yt(Math.round(parseFloat(s)/e)*e*t);return(i-i%1)/t+(jn(s)?0:Qs(s))}},qM=function(e,t){var s=si(e),i,n;return!s&&Xr(e)&&(i=s=e.radius||lr,e.values?(e=dr(e.values),(n=!jn(e[0]))&&(i*=i)):e=ly(e.increment)),Ra(t,s?is(e)?function(a){return n=e(a),Math.abs(n-a)<=i?n:a}:function(a){for(var o=parseFloat(n?a.x:a),l=parseFloat(n?a.y:0),d=lr,u=0,h=e.length,p,m;h--;)n?(p=e[h].x-o,m=e[h].y-l,p=p*p+m*m):p=Math.abs(e[h]-o),p<d&&(d=p,u=h);return u=!i||d<=i?e[u]:a,n||u===a||jn(a)?u:u+Qs(a)}:ly(e))},HM=function(e,t,s,i){return Ra(si(e)?!t:s===!0?!!(s=0):!i,function(){return si(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(i=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*i)/i})},Cq=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(i){return t.reduce(function(n,a){return a(n)},i)}},Sq=function(e,t){return function(s){return e(parseFloat(s))+(t||Qs(s))}},Tq=function(e,t,s){return KM(e,t,0,1,s)},XM=function(e,t,s){return Ra(s,function(i){return e[~~t(i)]})},Aq=function r(e,t,s){var i=t-e;return si(e)?XM(e,r(0,e.length),t):Ra(s,function(n){return(i+(n-e)%i)%i+e})},jq=function r(e,t,s){var i=t-e,n=i*2;return si(e)?XM(e,r(0,e.length-1),t):Ra(s,function(a){return a=(n+(a-e)%n)%n||0,e+(a>i?n-a:a)})},iu=function(e){return e.replace(aq,function(t){var s=t.indexOf("[")+1,i=t.substring(s||7,s?t.indexOf("]"):t.length-1).split(oq);return HM(s?i:+i[0],s?0:+i[1],+i[2]||1e-5)})},KM=function(e,t,s,i,n){var a=t-e,o=i-s;return Ra(n,function(l){return s+((l-e)/a*o||0)})},_q=function r(e,t,s,i){var n=isNaN(e+t)?0:function(m){return(1-m)*e+m*t};if(!n){var a=Rs(e),o={},l,d,u,h,p;if(s===!0&&(i=1)&&(s=null),a)e={p:e},t={p:t};else if(si(e)&&!si(t)){for(u=[],h=e.length,p=h-2,d=1;d<h;d++)u.push(r(e[d-1],e[d]));h--,n=function(f){f*=h;var g=Math.min(p,~~f);return u[g](f-g)},s=t}else i||(e=Xc(si(e)?[]:{},e));if(!u){for(l in t)Db.call(o,e,l,"get",t[l]);n=function(f){return Ob(f,o)||(a?e.p:e)}}}return Ra(s,n)},MC=function(e,t,s){var i=e.labels,n=lr,a,o,l;for(a in i)o=i[a]-t,o<0==!!s&&o&&n>(o=Math.abs(o))&&(l=a,n=o);return l},zi=function(e,t,s){var i=e.vars,n=i[t],a=Vt,o=e._ctx,l,d,u;if(n)return l=i[t+"Params"],d=i.callbackScope||e,s&&pa.length&&jp(),o&&(Vt=o),u=l?n.apply(d,l):n.call(d),Vt=a,u},nd=function(e){return ka(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Us),e.progress()<1&&zi(e,"onInterrupt"),e},bc,QM=[],JM=function(e){if(e)if(e=!e.name&&e.default||e,_b()||e.headless){var t=e.name,s=is(e),i=t&&!s&&e.init?function(){this._props=[]}:e,n={init:su,render:Ob,add:Db,kill:Gq,modifier:Uq,rawVars:0},a={targetTest:0,get:0,getSetter:Lb,aliases:{},register:0};if(Jc(),e!==i){if(Fi[t])return;Yi(i,Yi(_p(e,n),a)),Xc(i.prototype,Xc(n,_p(e,a))),Fi[i.prop=t]=i,e.targetTest&&(Oh.push(i),Pb[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}IM(t,i),e.register&&e.register(Ii,i,Pi)}else QM.push(e)},Et=255,ad={aqua:[0,Et,Et],lime:[0,Et,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Et],navy:[0,0,128],white:[Et,Et,Et],olive:[128,128,0],yellow:[Et,Et,0],orange:[Et,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Et,0,0],pink:[Et,192,203],cyan:[0,Et,Et],transparent:[Et,Et,Et,0]},Yf=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*Et+.5|0},ZM=function(e,t,s){var i=e?jn(e)?[e>>16,e>>8&Et,e&Et]:0:ad.black,n,a,o,l,d,u,h,p,m,f;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),ad[e])i=ad[e];else if(e.charAt(0)==="#"){if(e.length<6&&(n=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+n+n+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&Et,i&Et,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&Et,e&Et]}else if(e.substr(0,3)==="hsl"){if(i=f=e.match(TC),!t)l=+i[0]%360/360,d=+i[1]/100,u=+i[2]/100,a=u<=.5?u*(d+1):u+d-u*d,n=u*2-a,i.length>3&&(i[3]*=1),i[0]=Yf(l+1/3,n,a),i[1]=Yf(l,n,a),i[2]=Yf(l-1/3,n,a);else if(~e.indexOf("="))return i=e.match(MM),s&&i.length<4&&(i[3]=1),i}else i=e.match(TC)||ad.transparent;i=i.map(Number)}return t&&!f&&(n=i[0]/Et,a=i[1]/Et,o=i[2]/Et,h=Math.max(n,a,o),p=Math.min(n,a,o),u=(h+p)/2,h===p?l=d=0:(m=h-p,d=u>.5?m/(2-h-p):m/(h+p),l=h===n?(a-o)/m+(a<o?6:0):h===a?(o-n)/m+2:(n-a)/m+4,l*=60),i[0]=~~(l+.5),i[1]=~~(d*100+.5),i[2]=~~(u*100+.5)),s&&i.length<4&&(i[3]=1),i},eP=function(e){var t=[],s=[],i=-1;return e.split(ma).forEach(function(n){var a=n.match(xc)||[];t.push.apply(t,a),s.push(i+=a.length+1)}),t.c=s,t},PC=function(e,t,s){var i="",n=(e+i).match(ma),a=t?"hsla(":"rgba(",o=0,l,d,u,h;if(!n)return e;if(n=n.map(function(p){return(p=ZM(p,t,1))&&a+(t?p[0]+","+p[1]+"%,"+p[2]+"%,"+p[3]:p.join(","))+")"}),s&&(u=eP(e),l=s.c,l.join(i)!==u.c.join(i)))for(d=e.replace(ma,"1").split(xc),h=d.length-1;o<h;o++)i+=d[o]+(~l.indexOf(o)?n.shift()||a+"0,0,0,0)":(u.length?u:n.length?n:s).shift());if(!d)for(d=e.split(ma),h=d.length-1;o<h;o++)i+=d[o]+n[o];return i+d[h]},ma=function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in ad)r+="|"+e+"\\b";return new RegExp(r+")","gi")}(),Eq=/hsl[a]?\(/,tP=function(e){var t=e.join(" "),s;if(ma.lastIndex=0,ma.test(t))return s=Eq.test(t),e[1]=PC(e[1],s),e[0]=PC(e[0],s,eP(e[1])),!0},ru,Oi=function(){var r=Date.now,e=500,t=33,s=r(),i=s,n=1e3/240,a=n,o=[],l,d,u,h,p,m,f=function g(y){var x=r()-i,v=y===!0,b,S,k,C;if((x>e||x<0)&&(s+=x-t),i+=x,k=i-s,b=k-a,(b>0||v)&&(C=++h.frame,p=k-h.time*1e3,h.time=k=k/1e3,a+=b+(b>=n?4:n-b),S=1),v||(l=d(g)),S)for(m=0;m<o.length;m++)o[m](k,p,C,y)};return h={time:0,frame:0,tick:function(){f(!0)},deltaRatio:function(y){return p/(1e3/(y||60))},wake:function(){NM&&(!iy&&_b()&&(Fr=iy=window,Eb=Fr.document||{},Wi.gsap=Ii,(Fr.gsapVersions||(Fr.gsapVersions=[])).push(Ii.version),RM(Ap||Fr.GreenSockGlobals||!Fr.gsap&&Fr||{}),QM.forEach(JM)),u=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&h.sleep(),d=u||function(y){return setTimeout(y,a-h.time*1e3+1|0)},ru=1,f(2))},sleep:function(){(u?cancelAnimationFrame:clearTimeout)(l),ru=0,d=su},lagSmoothing:function(y,x){e=y||1/0,t=Math.min(x||33,e)},fps:function(y){n=1e3/(y||240),a=h.time*1e3+n},add:function(y,x,v){var b=x?function(S,k,C,A){y(S,k,C,A),h.remove(b)}:y;return h.remove(y),o[v?"unshift":"push"](b),Jc(),b},remove:function(y,x){~(x=o.indexOf(y))&&o.splice(x,1)&&m>=x&&m--},_listeners:o},h}(),Jc=function(){return!ru&&Oi.wake()},lt={},Mq=/^[\d.\-M][\d.\-,\s]/,Pq=/["']/g,Nq=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),i=s[0],n=1,a=s.length,o,l,d;n<a;n++)l=s[n],o=n!==a-1?l.lastIndexOf(","):l.length,d=l.substr(0,o),t[i]=isNaN(d)?d.replace(Pq,"").trim():+d,i=l.substr(o+1).trim();return t},Rq=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<s?e.indexOf(")",s+1):s)},Iq=function(e){var t=(e+"").split("("),s=lt[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[Nq(t[1])]:Rq(e).split(",").map(LM)):lt._CE&&Mq.test(e)?lt._CE("",e):s},sP=function(e){return function(t){return 1-e(1-t)}},iP=function r(e,t){for(var s=e._first,i;s;)s instanceof ci?r(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?r(s.timeline,t):(i=s._ease,s._ease=s._yEase,s._yEase=i,s._yoyo=t)),s=s._next},ko=function(e,t){return e&&(is(e)?e:lt[e]||Iq(e))||t},Io=function(e,t,s,i){s===void 0&&(s=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var n={easeIn:t,easeOut:s,easeInOut:i},a;return Mi(e,function(o){lt[o]=Wi[o]=n,lt[a=o.toLowerCase()]=s;for(var l in n)lt[a+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=lt[o+"."+l]=n[l]}),n},rP=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},qf=function r(e,t,s){var i=t>=1?t:1,n=(s||(e?.3:.45))/(t<1?t:1),a=n/sy*(Math.asin(1/i)||0),o=function(u){return u===1?1:i*Math.pow(2,-10*u)*nq((u-a)*n)+1},l=e==="out"?o:e==="in"?function(d){return 1-o(1-d)}:rP(o);return n=sy/n,l.config=function(d,u){return r(e,d,u)},l},Hf=function r(e,t){t===void 0&&(t=1.70158);var s=function(a){return a?--a*a*((t+1)*a+t)+1:0},i=e==="out"?s:e==="in"?function(n){return 1-s(1-n)}:rP(s);return i.config=function(n){return r(e,n)},i};Mi("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;Io(r+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});lt.Linear.easeNone=lt.none=lt.Linear.easeIn;Io("Elastic",qf("in"),qf("out"),qf());(function(r,e){var t=1/e,s=2*t,i=2.5*t,n=function(o){return o<t?r*o*o:o<s?r*Math.pow(o-1.5/e,2)+.75:o<i?r*(o-=2.25/e)*o+.9375:r*Math.pow(o-2.625/e,2)+.984375};Io("Bounce",function(a){return 1-n(1-a)},n)})(7.5625,2.75);Io("Expo",function(r){return Math.pow(2,10*(r-1))*r+r*r*r*r*r*r*(1-r)});Io("Circ",function(r){return-(_M(1-r*r)-1)});Io("Sine",function(r){return r===1?1:-rq(r*sq)+1});Io("Back",Hf("in"),Hf("out"),Hf());lt.SteppedEase=lt.steps=Wi.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,i=e+(t?0:1),n=t?1:0,a=1-Mt;return function(o){return((i*Tu(0,a,o)|0)+n)*s}}};Hc.ease=lt["quad.out"];Mi("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return Nb+=r+","+r+"Params,"});var nP=function(e,t){this.id=iq++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:FM,this.set=t?t.getSetter:Lb},nu=function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Qc(this,+t.duration,1,1),this.data=t.data,Vt&&(this._ctx=Vt,Vt.data.push(this)),ru||Oi.wake()}var e=r.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,Qc(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,i){if(Jc(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(om(this,s),!n._dp||n.parent||zM(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&Lr(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===Mt||!this._initted&&this._dur&&s||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),BM(this,s,i)),this},e.time=function(s,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+_C(this))%(this._dur+this._rDelay)||(s?this._dur:0),i):this._time},e.totalProgress=function(s,i){return arguments.length?this.totalTime(this.totalDuration()*s,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(s,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+_C(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,i){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*n,i):this._repeat?Kc(this._tTime,n)+1:1},e.timeScale=function(s,i){if(!arguments.length)return this._rts===-Mt?0:this._rts;if(this._rts===s)return this;var n=this.parent&&this._ts?Ep(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-Mt?0:this._rts,this.totalTime(Tu(-Math.abs(this._delay),this.totalDuration(),n),i!==!1),am(this),fq(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Jc(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Mt&&(this._tTime-=Mt)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=Yt(s);var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Lr(i,this,this._start-this._delay),this}return this._start},e.endTime=function(s){return this._start+(Ei(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var i=this.parent||this._dp;return i?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Ep(i.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=uq);var i=Us;return Us=s,Ib(this)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),Us=i,this},e.globalTime=function(s){for(var i=this,n=arguments.length?s:i.rawTime();i;)n=i._start+n/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(s):n},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,EC(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var i=this._time;return this._rDelay=s,EC(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,i){return this.totalTime(ir(this,s),Ei(i))},e.restart=function(s,i){return this.play().totalTime(s?-this._delay:0,Ei(i)),this._dur||(this._zTime=-Mt),this},e.play=function(s,i){return s!=null&&this.seek(s,i),this.reversed(!1).paused(!1)},e.reverse=function(s,i){return s!=null&&this.seek(s||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(s,i){return s!=null&&this.seek(s,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-Mt:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Mt,this},e.isActive=function(){var s=this.parent||this._dp,i=this._start,n;return!!(!s||this._ts&&this._initted&&s.isActive()&&(n=s.rawTime(!0))>=i&&n<this.endTime(!0)-Mt)},e.eventCallback=function(s,i,n){var a=this.vars;return arguments.length>1?(i?(a[s]=i,n&&(a[s+"Params"]=n),s==="onUpdate"&&(this._onUpdate=i)):delete a[s],this):a[s]},e.then=function(s){var i=this,n=i._prom;return new Promise(function(a){var o=is(s)?s:OM,l=function(){var u=i.then;i.then=null,n&&n(),is(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=u),a(o),i.then=u};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?l():i._prom=l})},e.kill=function(){nd(this)},r}();Yi(nu.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Mt,_prom:0,_ps:!1,_rts:1});var ci=function(r){jM(e,r);function e(s,i){var n;return s===void 0&&(s={}),n=r.call(this,s)||this,n.labels={},n.smoothChildTiming=!!s.smoothChildTiming,n.autoRemoveChildren=!!s.autoRemoveChildren,n._sort=Ei(s.sortChildren),Ht&&Lr(s.parent||Ht,hn(n),i),s.reversed&&n.reverse(),s.paused&&n.paused(!0),s.scrollTrigger&&VM(hn(n),s.scrollTrigger),n}var t=e.prototype;return t.to=function(i,n,a){return _d(0,arguments,this),this},t.from=function(i,n,a){return _d(1,arguments,this),this},t.fromTo=function(i,n,a,o){return _d(2,arguments,this),this},t.set=function(i,n,a){return n.duration=0,n.parent=this,jd(n).repeatDelay||(n.repeat=0),n.immediateRender=!!n.immediateRender,new ys(i,n,ir(this,a),1),this},t.call=function(i,n,a){return Lr(this,ys.delayedCall(0,i,n),a)},t.staggerTo=function(i,n,a,o,l,d,u){return a.duration=n,a.stagger=a.stagger||o,a.onComplete=d,a.onCompleteParams=u,a.parent=this,new ys(i,a,ir(this,l)),this},t.staggerFrom=function(i,n,a,o,l,d,u){return a.runBackwards=1,jd(a).immediateRender=Ei(a.immediateRender),this.staggerTo(i,n,a,o,l,d,u)},t.staggerFromTo=function(i,n,a,o,l,d,u,h){return o.startAt=a,jd(o).immediateRender=Ei(o.immediateRender),this.staggerTo(i,n,o,l,d,u,h)},t.render=function(i,n,a){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,d=this._dur,u=i<=0?0:Yt(i),h=this._zTime<0!=i<0&&(this._initted||!d),p,m,f,g,y,x,v,b,S,k,C,A;if(this!==Ht&&u>l&&i>=0&&(u=l),u!==this._tTime||a||h){if(o!==this._time&&d&&(u+=this._time-o,i+=this._time-o),p=u,S=this._start,b=this._ts,x=!b,h&&(d||(o=this._zTime),(i||!n)&&(this._zTime=i)),this._repeat){if(C=this._yoyo,y=d+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(y*100+i,n,a);if(p=Yt(u%y),u===l?(g=this._repeat,p=d):(k=Yt(u/y),g=~~k,g&&g===k&&(p=d,g--),p>d&&(p=d)),k=Kc(this._tTime,y),!o&&this._tTime&&k!==g&&this._tTime-k*y-this._dur<=0&&(k=g),C&&g&1&&(p=d-p,A=1),g!==k&&!this._lock){var T=C&&k&1,j=T===(C&&g&1);if(g<k&&(T=!T),o=T?0:u%d?d:u,this._lock=1,this.render(o||(A?0:Yt(g*y)),n,!d)._lock=0,this._tTime=u,!n&&this.parent&&zi(this,"onRepeat"),this.vars.repeatRefresh&&!A&&(this.invalidate()._lock=1,k=g),o&&o!==this._time||x!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(d=this._dur,l=this._tDur,j&&(this._lock=2,o=T?d:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!A&&this.invalidate()),this._lock=0,!this._ts&&!x)return this;iP(this,A)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(v=bq(this,Yt(o),Yt(p)),v&&(u-=p-(p=v._start))),this._tTime=u,this._time=p,this._act=!b,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&u&&d&&!n&&!k&&(zi(this,"onStart"),this._tTime!==u))return this;if(p>=o&&i>=0)for(m=this._first;m;){if(f=m._next,(m._act||p>=m._start)&&m._ts&&v!==m){if(m.parent!==this)return this.render(i,n,a);if(m.render(m._ts>0?(p-m._start)*m._ts:(m._dirty?m.totalDuration():m._tDur)+(p-m._start)*m._ts,n,a),p!==this._time||!this._ts&&!x){v=0,f&&(u+=this._zTime=-Mt);break}}m=f}else{m=this._last;for(var _=i<0?i:p;m;){if(f=m._prev,(m._act||_<=m._end)&&m._ts&&v!==m){if(m.parent!==this)return this.render(i,n,a);if(m.render(m._ts>0?(_-m._start)*m._ts:(m._dirty?m.totalDuration():m._tDur)+(_-m._start)*m._ts,n,a||Us&&Ib(m)),p!==this._time||!this._ts&&!x){v=0,f&&(u+=this._zTime=_?-Mt:Mt);break}}m=f}}if(v&&!n&&(this.pause(),v.render(p>=o?0:-Mt)._zTime=p>=o?1:-1,this._ts))return this._start=S,am(this),this.render(i,n,a);this._onUpdate&&!n&&zi(this,"onUpdate",!0),(u===l&&this._tTime>=this.totalDuration()||!u&&o)&&(S===this._start||Math.abs(b)!==Math.abs(this._ts))&&(this._lock||((i||!d)&&(u===l&&this._ts>0||!u&&this._ts<0)&&ka(this,1),!n&&!(i<0&&!o)&&(u||o||!l)&&(zi(this,u===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,n){var a=this;if(jn(n)||(n=ir(this,n,i)),!(i instanceof nu)){if(si(i))return i.forEach(function(o){return a.add(o,n)}),this;if(Rs(i))return this.addLabel(i,n);if(is(i))i=ys.delayedCall(0,i);else return this}return this!==i?Lr(this,i,n):this},t.getChildren=function(i,n,a,o){i===void 0&&(i=!0),n===void 0&&(n=!0),a===void 0&&(a=!0),o===void 0&&(o=-lr);for(var l=[],d=this._first;d;)d._start>=o&&(d instanceof ys?n&&l.push(d):(a&&l.push(d),i&&l.push.apply(l,d.getChildren(!0,n,a)))),d=d._next;return l},t.getById=function(i){for(var n=this.getChildren(1,1,1),a=n.length;a--;)if(n[a].vars.id===i)return n[a]},t.remove=function(i){return Rs(i)?this.removeLabel(i):is(i)?this.killTweensOf(i):(i.parent===this&&nm(this,i),i===this._recent&&(this._recent=this._last),wo(this))},t.totalTime=function(i,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Yt(Oi.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),r.prototype.totalTime.call(this,i,n),this._forcing=0,this):this._tTime},t.addLabel=function(i,n){return this.labels[i]=ir(this,n),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,n,a){var o=ys.delayedCall(0,n||su,a);return o.data="isPause",this._hasPause=1,Lr(this,o,ir(this,i))},t.removePause=function(i){var n=this._first;for(i=ir(this,i);n;)n._start===i&&n.data==="isPause"&&ka(n),n=n._next},t.killTweensOf=function(i,n,a){for(var o=this.getTweensOf(i,a),l=o.length;l--;)ra!==o[l]&&o[l].kill(i,n);return this},t.getTweensOf=function(i,n){for(var a=[],o=dr(i),l=this._first,d=jn(n),u;l;)l instanceof ys?hq(l._targets,o)&&(d?(!ra||l._initted&&l._ts)&&l.globalTime(0)<=n&&l.globalTime(l.totalDuration())>n:!n||l.isActive())&&a.push(l):(u=l.getTweensOf(o,n)).length&&a.push.apply(a,u),l=l._next;return a},t.tweenTo=function(i,n){n=n||{};var a=this,o=ir(a,i),l=n,d=l.startAt,u=l.onStart,h=l.onStartParams,p=l.immediateRender,m,f=ys.to(a,Yi({ease:n.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:n.duration||Math.abs((o-(d&&"time"in d?d.time:a._time))/a.timeScale())||Mt,onStart:function(){if(a.pause(),!m){var y=n.duration||Math.abs((o-(d&&"time"in d?d.time:a._time))/a.timeScale());f._dur!==y&&Qc(f,y,0,1).render(f._time,!0,!0),m=1}u&&u.apply(f,h||[])}},n));return p?f.render(0):f},t.tweenFromTo=function(i,n,a){return this.tweenTo(n,Yi({startAt:{time:ir(this,i)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),MC(this,ir(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),MC(this,ir(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+Mt)},t.shiftChildren=function(i,n,a){a===void 0&&(a=0);var o=this._first,l=this.labels,d;for(i=Yt(i);o;)o._start>=a&&(o._start+=i,o._end+=i),o=o._next;if(n)for(d in l)l[d]>=a&&(l[d]+=i);return wo(this)},t.invalidate=function(i){var n=this._first;for(this._lock=0;n;)n.invalidate(i),n=n._next;return r.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var n=this._first,a;n;)a=n._next,this.remove(n),n=a;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),wo(this)},t.totalDuration=function(i){var n=0,a=this,o=a._last,l=lr,d,u,h;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-i:i));if(a._dirty){for(h=a.parent;o;)d=o._prev,o._dirty&&o.totalDuration(),u=o._start,u>l&&a._sort&&o._ts&&!a._lock?(a._lock=1,Lr(a,o,u-o._delay,1)._lock=0):l=u,u<0&&o._ts&&(n-=u,(!h&&!a._dp||h&&h.smoothChildTiming)&&(a._start+=Yt(u/a._ts),a._time-=u,a._tTime-=u),a.shiftChildren(-u,!1,-1/0),l=0),o._end>n&&o._ts&&(n=o._end),o=d;Qc(a,a===Ht&&a._time>n?a._time:n,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(i){if(Ht._ts&&(BM(Ht,Ep(i,Ht)),DM=Oi.frame),Oi.frame>=AC){AC+=Ui.autoSleep||120;var n=Ht._first;if((!n||!n._ts)&&Ui.autoSleep&&Oi._listeners.length<2){for(;n&&!n._ts;)n=n._next;n||Oi.sleep()}}},e}(nu);Yi(ci.prototype,{_lock:0,_hasPause:0,_forcing:0});var Dq=function(e,t,s,i,n,a,o){var l=new Pi(this._pt,e,t,0,1,uP,null,n),d=0,u=0,h,p,m,f,g,y,x,v;for(l.b=s,l.e=i,s+="",i+="",(x=~i.indexOf("random("))&&(i=iu(i)),a&&(v=[s,i],a(v,e,t),s=v[0],i=v[1]),p=s.match(Gf)||[];h=Gf.exec(i);)f=h[0],g=i.substring(d,h.index),m?m=(m+1)%5:g.substr(-5)==="rgba("&&(m=1),f!==p[u++]&&(y=parseFloat(p[u-1])||0,l._pt={_next:l._pt,p:g||u===1?g:",",s:y,c:f.charAt(1)==="="?Ec(y,f)-y:parseFloat(f)-y,m:m&&m<4?Math.round:0},d=Gf.lastIndex);return l.c=d<i.length?i.substring(d,i.length):"",l.fp=o,(PM.test(i)||x)&&(l.e=0),this._pt=l,l},Db=function(e,t,s,i,n,a,o,l,d,u){is(i)&&(i=i(n||0,e,a));var h=e[t],p=s!=="get"?s:is(h)?d?e[t.indexOf("set")||!is(e["get"+t.substr(3)])?t:"get"+t.substr(3)](d):e[t]():h,m=is(h)?d?$q:lP:Bb,f;if(Rs(i)&&(~i.indexOf("random(")&&(i=iu(i)),i.charAt(1)==="="&&(f=Ec(p,i)+(Qs(p)||0),(f||f===0)&&(i=f))),!u||p!==i||dy)return!isNaN(p*i)&&i!==""?(f=new Pi(this._pt,e,t,+p||0,i-(p||0),typeof h=="boolean"?Vq:dP,0,m),d&&(f.fp=d),o&&f.modifier(o,this,e),this._pt=f):(!h&&!(t in e)&&Mb(t,i),Dq.call(this,e,t,p,i,m,l||Ui.stringFilter,d))},Fq=function(e,t,s,i,n){if(is(e)&&(e=Ed(e,n,t,s,i)),!Xr(e)||e.style&&e.nodeType||si(e)||EM(e))return Rs(e)?Ed(e,n,t,s,i):e;var a={},o;for(o in e)a[o]=Ed(e[o],n,t,s,i);return a},aP=function(e,t,s,i,n,a){var o,l,d,u;if(Fi[e]&&(o=new Fi[e]).init(n,o.rawVars?t[e]:Fq(t[e],i,n,a,s),s,i,a)!==!1&&(s._pt=l=new Pi(s._pt,n,e,0,1,o.render,o,0,o.priority),s!==bc))for(d=s._ptLookup[s._targets.indexOf(n)],u=o._props.length;u--;)d[o._props[u]]=l;return o},ra,dy,Fb=function r(e,t,s){var i=e.vars,n=i.ease,a=i.startAt,o=i.immediateRender,l=i.lazy,d=i.onUpdate,u=i.runBackwards,h=i.yoyoEase,p=i.keyframes,m=i.autoRevert,f=e._dur,g=e._startAt,y=e._targets,x=e.parent,v=x&&x.data==="nested"?x.vars.targets:y,b=e._overwrite==="auto"&&!Ab,S=e.timeline,k,C,A,T,j,_,M,E,D,R,B,O,F;if(S&&(!p||!n)&&(n="none"),e._ease=ko(n,Hc.ease),e._yEase=h?sP(ko(h===!0?n:h,Hc.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!S&&!!i.runBackwards,!S||p&&!i.stagger){if(E=y[0]?vo(y[0]).harness:0,O=E&&i[E.prop],k=_p(i,Pb),g&&(g._zTime<0&&g.progress(1),t<0&&u&&o&&!m?g.render(-1,!0):g.revert(u&&f?Lh:dq),g._lazy=0),a){if(ka(e._startAt=ys.set(y,Yi({data:"isStart",overwrite:!1,parent:x,immediateRender:!0,lazy:!g&&Ei(l),startAt:null,delay:0,onUpdate:d&&function(){return zi(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Us||!o&&!m)&&e._startAt.revert(Lh),o&&f&&t<=0&&s<=0){t&&(e._zTime=t);return}}else if(u&&f&&!g){if(t&&(o=!1),A=Yi({overwrite:!1,data:"isFromStart",lazy:o&&!g&&Ei(l),immediateRender:o,stagger:0,parent:x},k),O&&(A[E.prop]=O),ka(e._startAt=ys.set(y,A)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Us?e._startAt.revert(Lh):e._startAt.render(-1,!0)),e._zTime=t,!o)r(e._startAt,Mt,Mt);else if(!t)return}for(e._pt=e._ptCache=0,l=f&&Ei(l)||l&&!f,C=0;C<y.length;C++){if(j=y[C],M=j._gsap||Rb(y)[C]._gsap,e._ptLookup[C]=R={},ry[M.id]&&pa.length&&jp(),B=v===y?C:v.indexOf(j),E&&(D=new E).init(j,O||k,e,B,v)!==!1&&(e._pt=T=new Pi(e._pt,j,D.name,0,1,D.render,D,0,D.priority),D._props.forEach(function(I){R[I]=T}),D.priority&&(_=1)),!E||O)for(A in k)Fi[A]&&(D=aP(A,k,e,B,j,v))?D.priority&&(_=1):R[A]=T=Db.call(e,j,A,"get",k[A],B,v,0,i.stringFilter);e._op&&e._op[C]&&e.kill(j,e._op[C]),b&&e._pt&&(ra=e,Ht.killTweensOf(j,R,e.globalTime(t)),F=!e.parent,ra=0),e._pt&&l&&(ry[M.id]=1)}_&&hP(e),e._onInit&&e._onInit(e)}e._onUpdate=d,e._initted=(!e._op||e._pt)&&!F,p&&t<=0&&S.render(lr,!0,!0)},Bq=function(e,t,s,i,n,a,o,l){var d=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,p,m;if(!d)for(d=e._ptCache[t]=[],p=e._ptLookup,m=e._targets.length;m--;){if(u=p[m][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return dy=1,e.vars[t]="+=0",Fb(e,o),dy=0,l?tu(t+" not eligible for reset"):1;d.push(u)}for(m=d.length;m--;)h=d[m],u=h._pt||h,u.s=(i||i===0)&&!n?i:u.s+(i||0)+a*u.c,u.c=s-u.s,h.e&&(h.e=ls(s)+Qs(h.e)),h.b&&(h.b=u.s+Qs(h.b))},Lq=function(e,t){var s=e[0]?vo(e[0]).harness:0,i=s&&s.aliases,n,a,o,l;if(!i)return t;n=Xc({},t);for(a in i)if(a in n)for(l=i[a].split(","),o=l.length;o--;)n[l[o]]=n[a];return n},Oq=function(e,t,s,i){var n=t.ease||i||"power1.inOut",a,o;if(si(t))o=s[e]||(s[e]=[]),t.forEach(function(l,d){return o.push({t:d/(t.length-1)*100,v:l,e:n})});else for(a in t)o=s[a]||(s[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:t[a],e:n})},Ed=function(e,t,s,i,n){return is(e)?e.call(t,s,i,n):Rs(e)&&~e.indexOf("random(")?iu(e):e},oP=Nb+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",cP={};Mi(oP+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return cP[r]=1});var ys=function(r){jM(e,r);function e(s,i,n,a){var o;typeof i=="number"&&(n.duration=i,i=n,n=null),o=r.call(this,a?i:jd(i))||this;var l=o.vars,d=l.duration,u=l.delay,h=l.immediateRender,p=l.stagger,m=l.overwrite,f=l.keyframes,g=l.defaults,y=l.scrollTrigger,x=l.yoyoEase,v=i.parent||Ht,b=(si(s)||EM(s)?jn(s[0]):"length"in i)?[s]:dr(s),S,k,C,A,T,j,_,M;if(o._targets=b.length?Rb(b):tu("GSAP target "+s+" not found. https://gsap.com",!Ui.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=m,f||p||ih(d)||ih(u)){if(i=o.vars,S=o.timeline=new ci({data:"nested",defaults:g||{},targets:v&&v.data==="nested"?v.vars.targets:b}),S.kill(),S.parent=S._dp=hn(o),S._start=0,p||ih(d)||ih(u)){if(A=b.length,_=p&&YM(p),Xr(p))for(T in p)~oP.indexOf(T)&&(M||(M={}),M[T]=p[T]);for(k=0;k<A;k++)C=_p(i,cP),C.stagger=0,x&&(C.yoyoEase=x),M&&Xc(C,M),j=b[k],C.duration=+Ed(d,hn(o),k,j,b),C.delay=(+Ed(u,hn(o),k,j,b)||0)-o._delay,!p&&A===1&&C.delay&&(o._delay=u=C.delay,o._start+=u,C.delay=0),S.to(j,C,_?_(k,j,b):0),S._ease=lt.none;S.duration()?d=u=0:o.timeline=0}else if(f){jd(Yi(S.vars.defaults,{ease:"none"})),S._ease=ko(f.ease||i.ease||"none");var E=0,D,R,B;if(si(f))f.forEach(function(O){return S.to(b,O,">")}),S.duration();else{C={};for(T in f)T==="ease"||T==="easeEach"||Oq(T,f[T],C,f.easeEach);for(T in C)for(D=C[T].sort(function(O,F){return O.t-F.t}),E=0,k=0;k<D.length;k++)R=D[k],B={ease:R.e,duration:(R.t-(k?D[k-1].t:0))/100*d},B[T]=R.v,S.to(b,B,E),E+=B.duration;S.duration()<d&&S.to({},{duration:d-S.duration()})}}d||o.duration(d=S.duration())}else o.timeline=0;return m===!0&&!Ab&&(ra=hn(o),Ht.killTweensOf(b),ra=0),Lr(v,hn(o),n),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(h||!d&&!f&&o._start===Yt(v._time)&&Ei(h)&&gq(hn(o))&&v.data!=="nested")&&(o._tTime=-Mt,o.render(Math.max(0,-u)||0)),y&&VM(hn(o),y),o}var t=e.prototype;return t.render=function(i,n,a){var o=this._time,l=this._tDur,d=this._dur,u=i<0,h=i>l-Mt&&!u?l:i<Mt?0:i,p,m,f,g,y,x,v,b,S;if(!d)xq(this,i,n,a);else if(h!==this._tTime||!i||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u||this._lazy){if(p=h,b=this.timeline,this._repeat){if(g=d+this._rDelay,this._repeat<-1&&u)return this.totalTime(g*100+i,n,a);if(p=Yt(h%g),h===l?(f=this._repeat,p=d):(y=Yt(h/g),f=~~y,f&&f===y?(p=d,f--):p>d&&(p=d)),x=this._yoyo&&f&1,x&&(S=this._yEase,p=d-p),y=Kc(this._tTime,g),p===o&&!a&&this._initted&&f===y)return this._tTime=h,this;f!==y&&(b&&this._yEase&&iP(b,x),this.vars.repeatRefresh&&!x&&!this._lock&&p!==g&&this._initted&&(this._lock=a=1,this.render(Yt(g*f),!0).invalidate()._lock=0))}if(!this._initted){if(UM(this,u?i:p,a,n,h))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&f!==y))return this;if(d!==this._dur)return this.render(i,n,a)}if(this._tTime=h,this._time=p,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=v=(S||this._ease)(p/d),this._from&&(this.ratio=v=1-v),!o&&h&&!n&&!y&&(zi(this,"onStart"),this._tTime!==h))return this;for(m=this._pt;m;)m.r(v,m.d),m=m._next;b&&b.render(i<0?i:b._dur*b._ease(p/this._dur),n,a)||this._startAt&&(this._zTime=i),this._onUpdate&&!n&&(u&&ny(this,i,n,a),zi(this,"onUpdate")),this._repeat&&f!==y&&this.vars.onRepeat&&!n&&this.parent&&zi(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&ny(this,i,!0,!0),(i||!d)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&ka(this,1),!n&&!(u&&!o)&&(h||o||x)&&(zi(this,h===l?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),r.prototype.invalidate.call(this,i)},t.resetTo=function(i,n,a,o,l){ru||Oi.wake(),this._ts||this.play();var d=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||Fb(this,d),u=this._ease(d/this._dur),Bq(this,i,n,a,o,u,d,l)?this.resetTo(i,n,a,o,1):(om(this,0),this.parent||$M(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,n){if(n===void 0&&(n="all"),!i&&(!n||n==="all"))return this._lazy=this._pt=0,this.parent?nd(this):this.scrollTrigger&&this.scrollTrigger.kill(!!Us),this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(i,n,ra&&ra.vars.overwrite!==!0)._first||nd(this),this.parent&&a!==this.timeline.totalDuration()&&Qc(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,l=i?dr(i):o,d=this._ptLookup,u=this._pt,h,p,m,f,g,y,x;if((!n||n==="all")&&mq(o,l))return n==="all"&&(this._pt=0),nd(this);for(h=this._op=this._op||[],n!=="all"&&(Rs(n)&&(g={},Mi(n,function(v){return g[v]=1}),n=g),n=Lq(o,n)),x=o.length;x--;)if(~l.indexOf(o[x])){p=d[x],n==="all"?(h[x]=n,f=p,m={}):(m=h[x]=h[x]||{},f=n);for(g in f)y=p&&p[g],y&&((!("kill"in y.d)||y.d.kill(g)===!0)&&nm(this,y,"_pt"),delete p[g]),m!=="all"&&(m[g]=1)}return this._initted&&!this._pt&&u&&nd(this),this},e.to=function(i,n){return new e(i,n,arguments[2])},e.from=function(i,n){return _d(1,arguments)},e.delayedCall=function(i,n,a,o){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:n,onReverseComplete:n,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(i,n,a){return _d(2,arguments)},e.set=function(i,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(i,n)},e.killTweensOf=function(i,n,a){return Ht.killTweensOf(i,n,a)},e}(nu);Yi(ys.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Mi("staggerTo,staggerFrom,staggerFromTo",function(r){ys[r]=function(){var e=new ci,t=oy.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var Bb=function(e,t,s){return e[t]=s},lP=function(e,t,s){return e[t](s)},$q=function(e,t,s,i){return e[t](i.fp,s)},zq=function(e,t,s){return e.setAttribute(t,s)},Lb=function(e,t){return is(e[t])?lP:jb(e[t])&&e.setAttribute?zq:Bb},dP=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Vq=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},uP=function(e,t){var s=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;s;)i=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+i,s=s._next;i+=t.c}t.set(t.t,t.p,i,t)},Ob=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},Uq=function(e,t,s,i){for(var n=this._pt,a;n;)a=n._next,n.p===i&&n.modifier(e,t,s),n=a},Gq=function(e){for(var t=this._pt,s,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?nm(this,t,"_pt"):t.dep||(s=1),t=i;return!s},Wq=function(e,t,s,i){i.mSet(e,t,i.m.call(i.tween,s,i.mt),i)},hP=function(e){for(var t=e._pt,s,i,n,a;t;){for(s=t._next,i=n;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:a)?t._prev._next=t:n=t,(t._next=i)?i._prev=t:a=t,t=s}e._pt=n},Pi=function(){function r(t,s,i,n,a,o,l,d,u){this.t=s,this.s=n,this.c=a,this.p=i,this.r=o||dP,this.d=l||this,this.set=d||Bb,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(s,i,n){this.mSet=this.mSet||this.set,this.set=Wq,this.m=s,this.mt=n,this.tween=i},r}();Mi(Nb+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return Pb[r]=1});Wi.TweenMax=Wi.TweenLite=ys;Wi.TimelineLite=Wi.TimelineMax=ci;Ht=new ci({sortChildren:!1,defaults:Hc,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ui.stringFilter=tP;var Co=[],$h={},Yq=[],NC=0,qq=0,Xf=function(e){return($h[e]||Yq).map(function(t){return t()})},uy=function(){var e=Date.now(),t=[];e-NC>2&&(Xf("matchMediaInit"),Co.forEach(function(s){var i=s.queries,n=s.conditions,a,o,l,d;for(o in i)a=Fr.matchMedia(i[o]).matches,a&&(l=1),a!==n[o]&&(n[o]=a,d=1);d&&(s.revert(),l&&t.push(s))}),Xf("matchMediaRevert"),t.forEach(function(s){return s.onMatch(s,function(i){return s.add(null,i)})}),NC=e,Xf("matchMedia"))},pP=function(){function r(t,s){this.selector=s&&cy(s),this.data=[],this._r=[],this.isReverted=!1,this.id=qq++,t&&this.add(t)}var e=r.prototype;return e.add=function(s,i,n){is(s)&&(n=i,i=s,s=is);var a=this,o=function(){var d=Vt,u=a.selector,h;return d&&d!==a&&d.data.push(a),n&&(a.selector=cy(n)),Vt=a,h=i.apply(a,arguments),is(h)&&a._r.push(h),Vt=d,a.selector=u,a.isReverted=!1,h};return a.last=o,s===is?o(a,function(l){return a.add(null,l)}):s?a[s]=o:o},e.ignore=function(s){var i=Vt;Vt=null,s(this),Vt=i},e.getTweens=function(){var s=[];return this.data.forEach(function(i){return i instanceof r?s.push.apply(s,i.getTweens()):i instanceof ys&&!(i.parent&&i.parent.data==="nested")&&s.push(i)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,i){var n=this;if(s?function(){for(var o=n.getTweens(),l=n.data.length,d;l--;)d=n.data[l],d.data==="isFlip"&&(d.revert(),d.getChildren(!0,!0,!1).forEach(function(u){return o.splice(o.indexOf(u),1)}));for(o.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(s)}),l=n.data.length;l--;)d=n.data[l],d instanceof ci?d.data!=="nested"&&(d.scrollTrigger&&d.scrollTrigger.revert(),d.kill()):!(d instanceof ys)&&d.revert&&d.revert(s);n._r.forEach(function(u){return u(s,n)}),n.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),i)for(var a=Co.length;a--;)Co[a].id===this.id&&Co.splice(a,1)},e.revert=function(s){this.kill(s||{})},r}(),Hq=function(){function r(t){this.contexts=[],this.scope=t,Vt&&Vt.data.push(this)}var e=r.prototype;return e.add=function(s,i,n){Xr(s)||(s={matches:s});var a=new pP(0,n||this.scope),o=a.conditions={},l,d,u;Vt&&!a.selector&&(a.selector=Vt.selector),this.contexts.push(a),i=a.add("onMatch",i),a.queries=s;for(d in s)d==="all"?u=1:(l=Fr.matchMedia(s[d]),l&&(Co.indexOf(a)<0&&Co.push(a),(o[d]=l.matches)&&(u=1),l.addListener?l.addListener(uy):l.addEventListener("change",uy)));return u&&i(a,function(h){return a.add(null,h)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(i){return i.kill(s,!0)})},r}(),Mp={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(i){return JM(i)})},timeline:function(e){return new ci(e)},getTweensOf:function(e,t){return Ht.getTweensOf(e,t)},getProperty:function(e,t,s,i){Rs(e)&&(e=dr(e)[0]);var n=vo(e||{}).get,a=s?OM:LM;return s==="native"&&(s=""),e&&(t?a((Fi[t]&&Fi[t].get||n)(e,t,s,i)):function(o,l,d){return a((Fi[o]&&Fi[o].get||n)(e,o,l,d))})},quickSetter:function(e,t,s){if(e=dr(e),e.length>1){var i=e.map(function(u){return Ii.quickSetter(u,t,s)}),n=i.length;return function(u){for(var h=n;h--;)i[h](u)}}e=e[0]||{};var a=Fi[t],o=vo(e),l=o.harness&&(o.harness.aliases||{})[t]||t,d=a?function(u){var h=new a;bc._pt=0,h.init(e,s?u+s:u,bc,0,[e]),h.render(1,h),bc._pt&&Ob(1,bc)}:o.set(e,l);return a?d:function(u){return d(e,l,s?u+s:u,o,1)}},quickTo:function(e,t,s){var i,n=Ii.to(e,Yi((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),s||{})),a=function(l,d,u){return n.resetTo(t,l,d,u)};return a.tween=n,a},isTweening:function(e){return Ht.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=ko(e.ease,Hc.ease)),jC(Hc,e||{})},config:function(e){return jC(Ui,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,i=e.plugins,n=e.defaults,a=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!Fi[o]&&!Wi[o]&&tu(t+" effect requires "+o+" plugin.")}),Wf[t]=function(o,l,d){return s(dr(o),Yi(l||{},n),d)},a&&(ci.prototype[t]=function(o,l,d){return this.add(Wf[t](o,Xr(l)?l:(d=l)&&{},this),d)})},registerEase:function(e,t){lt[e]=ko(t)},parseEase:function(e,t){return arguments.length?ko(e,t):lt},getById:function(e){return Ht.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new ci(e),i,n;for(s.smoothChildTiming=Ei(e.smoothChildTiming),Ht.remove(s),s._dp=0,s._time=s._tTime=Ht._time,i=Ht._first;i;)n=i._next,(t||!(!i._dur&&i instanceof ys&&i.vars.onComplete===i._targets[0]))&&Lr(s,i,i._start-i._delay),i=n;return Lr(Ht,s,0),s},context:function(e,t){return e?new pP(e,t):Vt},matchMedia:function(e){return new Hq(e)},matchMediaRefresh:function(){return Co.forEach(function(e){var t=e.conditions,s,i;for(i in t)t[i]&&(t[i]=!1,s=1);s&&e.revert()})||uy()},addEventListener:function(e,t){var s=$h[e]||($h[e]=[]);~s.indexOf(t)||s.push(t)},removeEventListener:function(e,t){var s=$h[e],i=s&&s.indexOf(t);i>=0&&s.splice(i,1)},utils:{wrap:Aq,wrapYoyo:jq,distribute:YM,random:HM,snap:qM,normalize:Tq,getUnit:Qs,clamp:wq,splitColor:ZM,toArray:dr,selector:cy,mapRange:KM,pipe:Cq,unitize:Sq,interpolate:_q,shuffle:WM},install:RM,effects:Wf,ticker:Oi,updateRoot:ci.updateRoot,plugins:Fi,globalTimeline:Ht,core:{PropTween:Pi,globals:IM,Tween:ys,Timeline:ci,Animation:nu,getCache:vo,_removeLinkedListItem:nm,reverting:function(){return Us},context:function(e){return e&&Vt&&(Vt.data.push(e),e._ctx=Vt),Vt},suppressOverwrites:function(e){return Ab=e}}};Mi("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return Mp[r]=ys[r]});Oi.add(ci.updateRoot);bc=Mp.to({},{duration:0});var Xq=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},Kq=function(e,t){var s=e._targets,i,n,a;for(i in t)for(n=s.length;n--;)a=e._ptLookup[n][i],a&&(a=a.d)&&(a._pt&&(a=Xq(a,i)),a&&a.modifier&&a.modifier(t[i],e,s[n],i))},Kf=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,n,a){a._onInit=function(o){var l,d;if(Rs(n)&&(l={},Mi(n,function(u){return l[u]=1}),n=l),t){l={};for(d in n)l[d]=t(n[d]);n=l}Kq(o,n)}}}},Ii=Mp.registerPlugin({name:"attr",init:function(e,t,s,i,n){var a,o,l;this.tween=s;for(a in t)l=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(l||0)+"",t[a],i,n,0,0,a),o.op=a,o.b=l,this._props.push(a)},render:function(e,t){for(var s=t._pt;s;)Us?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",headless:1,init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s],0,0,0,0,0,1)}},Kf("roundProps",ly),Kf("modifiers"),Kf("snap",qM))||Mp;ys.version=ci.version=Ii.version="3.14.2";NM=1;_b()&&Jc();lt.Power0;lt.Power1;lt.Power2;lt.Power3;lt.Power4;lt.Linear;lt.Quad;lt.Cubic;lt.Quart;lt.Quint;lt.Strong;lt.Elastic;lt.Back;lt.SteppedEase;lt.Bounce;lt.Sine;lt.Expo;lt.Circ;/*!
 * CSSPlugin 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var RC,na,Mc,$b,fo,IC,zb,Qq=function(){return typeof window<"u"},_n={},io=180/Math.PI,Pc=Math.PI/180,Ho=Math.atan2,DC=1e8,Vb=/([A-Z])/g,Jq=/(left|right|width|margin|padding|x)/i,Zq=/[\s,\(]\S/,zr={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},hy=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},eH=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},tH=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},sH=function(e,t){return t.set(t.t,t.p,e===1?t.e:e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},iH=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},mP=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},fP=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},rH=function(e,t,s){return e.style[t]=s},nH=function(e,t,s){return e.style.setProperty(t,s)},aH=function(e,t,s){return e._gsap[t]=s},oH=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},cH=function(e,t,s,i,n){var a=e._gsap;a.scaleX=a.scaleY=s,a.renderTransform(n,a)},lH=function(e,t,s,i,n){var a=e._gsap;a[t]=s,a.renderTransform(n,a)},Jt="transform",Ni=Jt+"Origin",dH=function r(e,t){var s=this,i=this.target,n=i.style,a=i._gsap;if(e in _n&&n){if(this.tfm=this.tfm||{},e!=="transform")e=zr[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return s.tfm[o]=mn(i,o)}):this.tfm[e]=a.x?a[e]:mn(i,e),e===Ni&&(this.tfm.zOrigin=a.zOrigin);else return zr.transform.split(",").forEach(function(o){return r.call(s,o,t)});if(this.props.indexOf(Jt)>=0)return;a.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(Ni,t,"")),e=Jt}(n||t)&&this.props.push(e,t,n[e])},gP=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},uH=function(){var e=this.props,t=this.target,s=t.style,i=t._gsap,n,a;for(n=0;n<e.length;n+=3)e[n+1]?e[n+1]===2?t[e[n]](e[n+2]):t[e[n]]=e[n+2]:e[n+2]?s[e[n]]=e[n+2]:s.removeProperty(e[n].substr(0,2)==="--"?e[n]:e[n].replace(Vb,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)i[a]=this.tfm[a];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),n=zb(),(!n||!n.isStart)&&!s[Jt]&&(gP(s),i.zOrigin&&s[Ni]&&(s[Ni]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},yP=function(e,t){var s={target:e,props:[],revert:uH,save:dH};return e._gsap||Ii.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return s.save(i)}),s},xP,py=function(e,t){var s=na.createElementNS?na.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):na.createElement(e);return s&&s.style?s:na.createElement(e)},Vi=function r(e,t,s){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(Vb,"-$1").toLowerCase())||i.getPropertyValue(t)||!s&&r(e,Zc(t)||t,1)||""},FC="O,Moz,ms,Ms,Webkit".split(","),Zc=function(e,t,s){var i=t||fo,n=i.style,a=5;if(e in n&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(FC[a]+e in n););return a<0?null:(a===3?"ms":a>=0?FC[a]:"")+e},my=function(){Qq()&&window.document&&(RC=window,na=RC.document,Mc=na.documentElement,fo=py("div")||{style:{}},py("div"),Jt=Zc(Jt),Ni=Jt+"Origin",fo.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",xP=!!Zc("perspective"),zb=Ii.core.reverting,$b=1)},BC=function(e){var t=e.ownerSVGElement,s=py("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),n;i.style.display="block",s.appendChild(i),Mc.appendChild(s);try{n=i.getBBox()}catch{}return s.removeChild(i),Mc.removeChild(s),n},LC=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},bP=function(e){var t,s;try{t=e.getBBox()}catch{t=BC(e),s=1}return t&&(t.width||t.height)||s||(t=BC(e)),t&&!t.width&&!t.x&&!t.y?{x:+LC(e,["x","cx","x1"])||0,y:+LC(e,["y","cy","y1"])||0,width:0,height:0}:t},vP=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&bP(e))},Ca=function(e,t){if(t){var s=e.style,i;t in _n&&t!==Ni&&(t=Jt),s.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(i==="--"?t:t.replace(Vb,"-$1").toLowerCase())):s.removeAttribute(t)}},aa=function(e,t,s,i,n,a){var o=new Pi(e._pt,t,s,0,1,a?fP:mP);return e._pt=o,o.b=i,o.e=n,e._props.push(s),o},OC={deg:1,rad:1,turn:1},hH={grid:1,flex:1},Sa=function r(e,t,s,i){var n=parseFloat(s)||0,a=(s+"").trim().substr((n+"").length)||"px",o=fo.style,l=Jq.test(t),d=e.tagName.toLowerCase()==="svg",u=(d?"client":"offset")+(l?"Width":"Height"),h=100,p=i==="px",m=i==="%",f,g,y,x;if(i===a||!n||OC[i]||OC[a])return n;if(a!=="px"&&!p&&(n=r(e,t,s,"px")),x=e.getCTM&&vP(e),(m||a==="%")&&(_n[t]||~t.indexOf("adius")))return f=x?e.getBBox()[l?"width":"height"]:e[u],ls(m?n/f*h:n/100*f);if(o[l?"width":"height"]=h+(p?a:i),g=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!d?e:e.parentNode,x&&(g=(e.ownerSVGElement||{}).parentNode),(!g||g===na||!g.appendChild)&&(g=na.body),y=g._gsap,y&&m&&y.width&&l&&y.time===Oi.time&&!y.uncache)return ls(n/y.width*h);if(m&&(t==="height"||t==="width")){var v=e.style[t];e.style[t]=h+i,f=e[u],v?e.style[t]=v:Ca(e,t)}else(m||a==="%")&&!hH[Vi(g,"display")]&&(o.position=Vi(e,"position")),g===e&&(o.position="static"),g.appendChild(fo),f=fo[u],g.removeChild(fo),o.position="absolute";return l&&m&&(y=vo(g),y.time=Oi.time,y.width=g[u]),ls(p?f*n/h:f&&n?h/f*n:0)},mn=function(e,t,s,i){var n;return $b||my(),t in zr&&t!=="transform"&&(t=zr[t],~t.indexOf(",")&&(t=t.split(",")[0])),_n[t]&&t!=="transform"?(n=ou(e,i),n=t!=="transformOrigin"?n[t]:n.svg?n.origin:Np(Vi(e,Ni))+" "+n.zOrigin+"px"):(n=e.style[t],(!n||n==="auto"||i||~(n+"").indexOf("calc("))&&(n=Pp[t]&&Pp[t](e,t,s)||Vi(e,t)||FM(e,t)||(t==="opacity"?1:0))),s&&!~(n+"").trim().indexOf(" ")?Sa(e,t,n,s)+s:n},pH=function(e,t,s,i){if(!s||s==="none"){var n=Zc(t,e,1),a=n&&Vi(e,n,1);a&&a!==s?(t=n,s=a):t==="borderColor"&&(s=Vi(e,"borderTopColor"))}var o=new Pi(this._pt,e.style,t,0,1,uP),l=0,d=0,u,h,p,m,f,g,y,x,v,b,S,k;if(o.b=s,o.e=i,s+="",i+="",i.substring(0,6)==="var(--"&&(i=Vi(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(g=e.style[t],e.style[t]=i,i=Vi(e,t)||i,g?e.style[t]=g:Ca(e,t)),u=[s,i],tP(u),s=u[0],i=u[1],p=s.match(xc)||[],k=i.match(xc)||[],k.length){for(;h=xc.exec(i);)y=h[0],v=i.substring(l,h.index),f?f=(f+1)%5:(v.substr(-5)==="rgba("||v.substr(-5)==="hsla(")&&(f=1),y!==(g=p[d++]||"")&&(m=parseFloat(g)||0,S=g.substr((m+"").length),y.charAt(1)==="="&&(y=Ec(m,y)+S),x=parseFloat(y),b=y.substr((x+"").length),l=xc.lastIndex-b.length,b||(b=b||Ui.units[t]||S,l===i.length&&(i+=b,o.e+=b)),S!==b&&(m=Sa(e,t,g,b)||0),o._pt={_next:o._pt,p:v||d===1?v:",",s:m,c:x-m,m:f&&f<4||t==="zIndex"?Math.round:0});o.c=l<i.length?i.substring(l,i.length):""}else o.r=t==="display"&&i==="none"?fP:mP;return PM.test(i)&&(o.e=0),this._pt=o,o},$C={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},mH=function(e){var t=e.split(" "),s=t[0],i=t[1]||"50%";return(s==="top"||s==="bottom"||i==="left"||i==="right")&&(e=s,s=i,i=e),t[0]=$C[s]||s,t[1]=$C[i]||i,t.join(" ")},fH=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,i=s.style,n=t.u,a=s._gsap,o,l,d;if(n==="all"||n===!0)i.cssText="",l=1;else for(n=n.split(","),d=n.length;--d>-1;)o=n[d],_n[o]&&(l=1,o=o==="transformOrigin"?Ni:Jt),Ca(s,o);l&&(Ca(s,Jt),a&&(a.svg&&s.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",ou(s,1),a.uncache=1,gP(i)))}},Pp={clearProps:function(e,t,s,i,n){if(n.data!=="isFromStart"){var a=e._pt=new Pi(e._pt,t,s,0,0,fH);return a.u=i,a.pr=-10,a.tween=n,e._props.push(s),1}}},au=[1,0,0,1,0,0],wP={},kP=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},zC=function(e){var t=Vi(e,Jt);return kP(t)?au:t.substr(7).match(MM).map(ls)},Ub=function(e,t){var s=e._gsap||vo(e),i=e.style,n=zC(e),a,o,l,d;return s.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,n=[l.a,l.b,l.c,l.d,l.e,l.f],n.join(",")==="1,0,0,1,0,0"?au:n):(n===au&&!e.offsetParent&&e!==Mc&&!s.svg&&(l=i.display,i.display="block",a=e.parentNode,(!a||!e.offsetParent&&!e.getBoundingClientRect().width)&&(d=1,o=e.nextElementSibling,Mc.appendChild(e)),n=zC(e),l?i.display=l:Ca(e,"display"),d&&(o?a.insertBefore(e,o):a?a.appendChild(e):Mc.removeChild(e))),t&&n.length>6?[n[0],n[1],n[4],n[5],n[12],n[13]]:n)},fy=function(e,t,s,i,n,a){var o=e._gsap,l=n||Ub(e,!0),d=o.xOrigin||0,u=o.yOrigin||0,h=o.xOffset||0,p=o.yOffset||0,m=l[0],f=l[1],g=l[2],y=l[3],x=l[4],v=l[5],b=t.split(" "),S=parseFloat(b[0])||0,k=parseFloat(b[1])||0,C,A,T,j;s?l!==au&&(A=m*y-f*g)&&(T=S*(y/A)+k*(-g/A)+(g*v-y*x)/A,j=S*(-f/A)+k*(m/A)-(m*v-f*x)/A,S=T,k=j):(C=bP(e),S=C.x+(~b[0].indexOf("%")?S/100*C.width:S),k=C.y+(~(b[1]||b[0]).indexOf("%")?k/100*C.height:k)),i||i!==!1&&o.smooth?(x=S-d,v=k-u,o.xOffset=h+(x*m+v*g)-x,o.yOffset=p+(x*f+v*y)-v):o.xOffset=o.yOffset=0,o.xOrigin=S,o.yOrigin=k,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!s,e.style[Ni]="0px 0px",a&&(aa(a,o,"xOrigin",d,S),aa(a,o,"yOrigin",u,k),aa(a,o,"xOffset",h,o.xOffset),aa(a,o,"yOffset",p,o.yOffset)),e.setAttribute("data-svg-origin",S+" "+k)},ou=function(e,t){var s=e._gsap||new nP(e);if("x"in s&&!t&&!s.uncache)return s;var i=e.style,n=s.scaleX<0,a="px",o="deg",l=getComputedStyle(e),d=Vi(e,Ni)||"0",u,h,p,m,f,g,y,x,v,b,S,k,C,A,T,j,_,M,E,D,R,B,O,F,I,K,ee,P,W,z,G,ce;return u=h=p=g=y=x=v=b=S=0,m=f=1,s.svg=!!(e.getCTM&&vP(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(i[Jt]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Jt]!=="none"?l[Jt]:"")),i.scale=i.rotate=i.translate="none"),A=Ub(e,s.svg),s.svg&&(s.uncache?(I=e.getBBox(),d=s.xOrigin-I.x+"px "+(s.yOrigin-I.y)+"px",F=""):F=!t&&e.getAttribute("data-svg-origin"),fy(e,F||d,!!F||s.originIsAbsolute,s.smooth!==!1,A)),k=s.xOrigin||0,C=s.yOrigin||0,A!==au&&(M=A[0],E=A[1],D=A[2],R=A[3],u=B=A[4],h=O=A[5],A.length===6?(m=Math.sqrt(M*M+E*E),f=Math.sqrt(R*R+D*D),g=M||E?Ho(E,M)*io:0,v=D||R?Ho(D,R)*io+g:0,v&&(f*=Math.abs(Math.cos(v*Pc))),s.svg&&(u-=k-(k*M+C*D),h-=C-(k*E+C*R))):(ce=A[6],z=A[7],ee=A[8],P=A[9],W=A[10],G=A[11],u=A[12],h=A[13],p=A[14],T=Ho(ce,W),y=T*io,T&&(j=Math.cos(-T),_=Math.sin(-T),F=B*j+ee*_,I=O*j+P*_,K=ce*j+W*_,ee=B*-_+ee*j,P=O*-_+P*j,W=ce*-_+W*j,G=z*-_+G*j,B=F,O=I,ce=K),T=Ho(-D,W),x=T*io,T&&(j=Math.cos(-T),_=Math.sin(-T),F=M*j-ee*_,I=E*j-P*_,K=D*j-W*_,G=R*_+G*j,M=F,E=I,D=K),T=Ho(E,M),g=T*io,T&&(j=Math.cos(T),_=Math.sin(T),F=M*j+E*_,I=B*j+O*_,E=E*j-M*_,O=O*j-B*_,M=F,B=I),y&&Math.abs(y)+Math.abs(g)>359.9&&(y=g=0,x=180-x),m=ls(Math.sqrt(M*M+E*E+D*D)),f=ls(Math.sqrt(O*O+ce*ce)),T=Ho(B,O),v=Math.abs(T)>2e-4?T*io:0,S=G?1/(G<0?-G:G):0),s.svg&&(F=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!kP(Vi(e,Jt)),F&&e.setAttribute("transform",F))),Math.abs(v)>90&&Math.abs(v)<270&&(n?(m*=-1,v+=g<=0?180:-180,g+=g<=0?180:-180):(f*=-1,v+=v<=0?180:-180)),t=t||s.uncache,s.x=u-((s.xPercent=u&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+a,s.y=h-((s.yPercent=h&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+a,s.z=p+a,s.scaleX=ls(m),s.scaleY=ls(f),s.rotation=ls(g)+o,s.rotationX=ls(y)+o,s.rotationY=ls(x)+o,s.skewX=v+o,s.skewY=b+o,s.transformPerspective=S+a,(s.zOrigin=parseFloat(d.split(" ")[2])||!t&&s.zOrigin||0)&&(i[Ni]=Np(d)),s.xOffset=s.yOffset=0,s.force3D=Ui.force3D,s.renderTransform=s.svg?yH:xP?CP:gH,s.uncache=0,s},Np=function(e){return(e=e.split(" "))[0]+" "+e[1]},Qf=function(e,t,s){var i=Qs(t);return ls(parseFloat(t)+parseFloat(Sa(e,"x",s+"px",i)))+i},gH=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,CP(e,t)},Ya="0deg",Ll="0px",qa=") ",CP=function(e,t){var s=t||this,i=s.xPercent,n=s.yPercent,a=s.x,o=s.y,l=s.z,d=s.rotation,u=s.rotationY,h=s.rotationX,p=s.skewX,m=s.skewY,f=s.scaleX,g=s.scaleY,y=s.transformPerspective,x=s.force3D,v=s.target,b=s.zOrigin,S="",k=x==="auto"&&e&&e!==1||x===!0;if(b&&(h!==Ya||u!==Ya)){var C=parseFloat(u)*Pc,A=Math.sin(C),T=Math.cos(C),j;C=parseFloat(h)*Pc,j=Math.cos(C),a=Qf(v,a,A*j*-b),o=Qf(v,o,-Math.sin(C)*-b),l=Qf(v,l,T*j*-b+b)}y!==Ll&&(S+="perspective("+y+qa),(i||n)&&(S+="translate("+i+"%, "+n+"%) "),(k||a!==Ll||o!==Ll||l!==Ll)&&(S+=l!==Ll||k?"translate3d("+a+", "+o+", "+l+") ":"translate("+a+", "+o+qa),d!==Ya&&(S+="rotate("+d+qa),u!==Ya&&(S+="rotateY("+u+qa),h!==Ya&&(S+="rotateX("+h+qa),(p!==Ya||m!==Ya)&&(S+="skew("+p+", "+m+qa),(f!==1||g!==1)&&(S+="scale("+f+", "+g+qa),v.style[Jt]=S||"translate(0, 0)"},yH=function(e,t){var s=t||this,i=s.xPercent,n=s.yPercent,a=s.x,o=s.y,l=s.rotation,d=s.skewX,u=s.skewY,h=s.scaleX,p=s.scaleY,m=s.target,f=s.xOrigin,g=s.yOrigin,y=s.xOffset,x=s.yOffset,v=s.forceCSS,b=parseFloat(a),S=parseFloat(o),k,C,A,T,j;l=parseFloat(l),d=parseFloat(d),u=parseFloat(u),u&&(u=parseFloat(u),d+=u,l+=u),l||d?(l*=Pc,d*=Pc,k=Math.cos(l)*h,C=Math.sin(l)*h,A=Math.sin(l-d)*-p,T=Math.cos(l-d)*p,d&&(u*=Pc,j=Math.tan(d-u),j=Math.sqrt(1+j*j),A*=j,T*=j,u&&(j=Math.tan(u),j=Math.sqrt(1+j*j),k*=j,C*=j)),k=ls(k),C=ls(C),A=ls(A),T=ls(T)):(k=h,T=p,C=A=0),(b&&!~(a+"").indexOf("px")||S&&!~(o+"").indexOf("px"))&&(b=Sa(m,"x",a,"px"),S=Sa(m,"y",o,"px")),(f||g||y||x)&&(b=ls(b+f-(f*k+g*A)+y),S=ls(S+g-(f*C+g*T)+x)),(i||n)&&(j=m.getBBox(),b=ls(b+i/100*j.width),S=ls(S+n/100*j.height)),j="matrix("+k+","+C+","+A+","+T+","+b+","+S+")",m.setAttribute("transform",j),v&&(m.style[Jt]=j)},xH=function(e,t,s,i,n){var a=360,o=Rs(n),l=parseFloat(n)*(o&&~n.indexOf("rad")?io:1),d=l-i,u=i+d+"deg",h,p;return o&&(h=n.split("_")[1],h==="short"&&(d%=a,d!==d%(a/2)&&(d+=d<0?a:-a)),h==="cw"&&d<0?d=(d+a*DC)%a-~~(d/a)*a:h==="ccw"&&d>0&&(d=(d-a*DC)%a-~~(d/a)*a)),e._pt=p=new Pi(e._pt,t,s,i,d,eH),p.e=u,p.u="deg",e._props.push(s),p},VC=function(e,t){for(var s in t)e[s]=t[s];return e},bH=function(e,t,s){var i=VC({},s._gsap),n="perspective,force3D,transformOrigin,svgOrigin",a=s.style,o,l,d,u,h,p,m,f;i.svg?(d=s.getAttribute("transform"),s.setAttribute("transform",""),a[Jt]=t,o=ou(s,1),Ca(s,Jt),s.setAttribute("transform",d)):(d=getComputedStyle(s)[Jt],a[Jt]=t,o=ou(s,1),a[Jt]=d);for(l in _n)d=i[l],u=o[l],d!==u&&n.indexOf(l)<0&&(m=Qs(d),f=Qs(u),h=m!==f?Sa(s,l,d,f):parseFloat(d),p=parseFloat(u),e._pt=new Pi(e._pt,o,l,h,p-h,hy),e._pt.u=f||0,e._props.push(l));VC(o,i)};Mi("padding,margin,Width,Radius",function(r,e){var t="Top",s="Right",i="Bottom",n="Left",a=(e<3?[t,s,i,n]:[t+n,t+s,i+s,i+n]).map(function(o){return e<2?r+o:"border"+o+r});Pp[e>1?"border"+r:r]=function(o,l,d,u,h){var p,m;if(arguments.length<4)return p=a.map(function(f){return mn(o,f,d)}),m=p.join(" "),m.split(p[0]).length===5?p[0]:m;p=(u+"").split(" "),m={},a.forEach(function(f,g){return m[f]=p[g]=p[g]||p[(g-1)/2|0]}),o.init(l,m,h)}});var SP={name:"css",register:my,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,i,n){var a=this._props,o=e.style,l=s.vars.startAt,d,u,h,p,m,f,g,y,x,v,b,S,k,C,A,T,j;$b||my(),this.styles=this.styles||yP(e),T=this.styles.props,this.tween=s;for(g in t)if(g!=="autoRound"&&(u=t[g],!(Fi[g]&&aP(g,t,s,i,e,n)))){if(m=typeof u,f=Pp[g],m==="function"&&(u=u.call(s,i,e,n),m=typeof u),m==="string"&&~u.indexOf("random(")&&(u=iu(u)),f)f(this,e,g,u,s)&&(A=1);else if(g.substr(0,2)==="--")d=(getComputedStyle(e).getPropertyValue(g)+"").trim(),u+="",ma.lastIndex=0,ma.test(d)||(y=Qs(d),x=Qs(u),x?y!==x&&(d=Sa(e,g,d,x)+x):y&&(u+=y)),this.add(o,"setProperty",d,u,i,n,0,0,g),a.push(g),T.push(g,0,o[g]);else if(m!=="undefined"){if(l&&g in l?(d=typeof l[g]=="function"?l[g].call(s,i,e,n):l[g],Rs(d)&&~d.indexOf("random(")&&(d=iu(d)),Qs(d+"")||d==="auto"||(d+=Ui.units[g]||Qs(mn(e,g))||""),(d+"").charAt(1)==="="&&(d=mn(e,g))):d=mn(e,g),p=parseFloat(d),v=m==="string"&&u.charAt(1)==="="&&u.substr(0,2),v&&(u=u.substr(2)),h=parseFloat(u),g in zr&&(g==="autoAlpha"&&(p===1&&mn(e,"visibility")==="hidden"&&h&&(p=0),T.push("visibility",0,o.visibility),aa(this,o,"visibility",p?"inherit":"hidden",h?"inherit":"hidden",!h)),g!=="scale"&&g!=="transform"&&(g=zr[g],~g.indexOf(",")&&(g=g.split(",")[0]))),b=g in _n,b){if(this.styles.save(g),j=u,m==="string"&&u.substring(0,6)==="var(--"){if(u=Vi(e,u.substring(4,u.indexOf(")"))),u.substring(0,5)==="calc("){var _=e.style.perspective;e.style.perspective=u,u=Vi(e,"perspective"),_?e.style.perspective=_:Ca(e,"perspective")}h=parseFloat(u)}if(S||(k=e._gsap,k.renderTransform&&!t.parseTransform||ou(e,t.parseTransform),C=t.smoothOrigin!==!1&&k.smooth,S=this._pt=new Pi(this._pt,o,Jt,0,1,k.renderTransform,k,0,-1),S.dep=1),g==="scale")this._pt=new Pi(this._pt,k,"scaleY",k.scaleY,(v?Ec(k.scaleY,v+h):h)-k.scaleY||0,hy),this._pt.u=0,a.push("scaleY",g),g+="X";else if(g==="transformOrigin"){T.push(Ni,0,o[Ni]),u=mH(u),k.svg?fy(e,u,0,C,0,this):(x=parseFloat(u.split(" ")[2])||0,x!==k.zOrigin&&aa(this,k,"zOrigin",k.zOrigin,x),aa(this,o,g,Np(d),Np(u)));continue}else if(g==="svgOrigin"){fy(e,u,1,C,0,this);continue}else if(g in wP){xH(this,k,g,p,v?Ec(p,v+u):u);continue}else if(g==="smoothOrigin"){aa(this,k,"smooth",k.smooth,u);continue}else if(g==="force3D"){k[g]=u;continue}else if(g==="transform"){bH(this,u,e);continue}}else g in o||(g=Zc(g)||g);if(b||(h||h===0)&&(p||p===0)&&!Zq.test(u)&&g in o)y=(d+"").substr((p+"").length),h||(h=0),x=Qs(u)||(g in Ui.units?Ui.units[g]:y),y!==x&&(p=Sa(e,g,d,x)),this._pt=new Pi(this._pt,b?k:o,g,p,(v?Ec(p,v+h):h)-p,!b&&(x==="px"||g==="zIndex")&&t.autoRound!==!1?iH:hy),this._pt.u=x||0,b&&j!==u?(this._pt.b=d,this._pt.e=j,this._pt.r=sH):y!==x&&x!=="%"&&(this._pt.b=d,this._pt.r=tH);else if(g in o)pH.call(this,e,g,d,v?v+u:u);else if(g in e)this.add(e,g,d||e[g],v?v+u:u,i,n);else if(g!=="parseTransform"){Mb(g,u);continue}b||(g in o?T.push(g,0,o[g]):typeof e[g]=="function"?T.push(g,2,e[g]()):T.push(g,1,d||e[g])),a.push(g)}}A&&hP(this)},render:function(e,t){if(t.tween._time||!zb())for(var s=t._pt;s;)s.r(e,s.d),s=s._next;else t.styles.revert()},get:mn,aliases:zr,getSetter:function(e,t,s){var i=zr[t];return i&&i.indexOf(",")<0&&(t=i),t in _n&&t!==Ni&&(e._gsap.x||mn(e,"x"))?s&&IC===s?t==="scale"?oH:aH:(IC=s||{})&&(t==="scale"?cH:lH):e.style&&!jb(e.style[t])?rH:~t.indexOf("-")?nH:Lb(e,t)},core:{_removeProperty:Ca,_getMatrix:Ub}};Ii.utils.checkPrefix=Zc;Ii.core.getStyleSaver=yP;(function(r,e,t,s){var i=Mi(r+","+e+","+t,function(n){_n[n]=1});Mi(e,function(n){Ui.units[n]="deg",wP[n]=1}),zr[i[13]]=r+","+e,Mi(s,function(n){var a=n.split(":");zr[a[1]]=i[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Mi("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){Ui.units[r]="px"});Ii.registerPlugin(SP);var Gb=Ii.registerPlugin(SP)||Ii;Gb.core.Tween;/*!
 * paths 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var vH=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,wH=/(?:(-)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,kH=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/ig,CH=/(^[#\.][a-z]|[a-y][a-z])/i,SH=Math.PI/180,TH=180/Math.PI,rh=Math.sin,nh=Math.cos,ur=Math.abs,gn=Math.sqrt,AH=Math.atan2,gy=1e8,UC=function(e){return typeof e=="string"},TP=function(e){return typeof e=="number"},jH=function(e){return typeof e>"u"},_H={},EH={},Rp=1e5,AP=function(e){return Math.round((e+gy)%1*Rp)/Rp||(e<0?0:1)},yt=function(e){return Math.round(e*Rp)/Rp||0},GC=function(e){return Math.round(e*1e10)/1e10||0},WC=function(e){return e.closed=Math.abs(e[0]-e[e.length-2])<.001&&Math.abs(e[1]-e[e.length-1])<.001},YC=function(e,t,s,i){var n=e[t],a=i===1?6:yy(n,s,i);if((a||!i)&&a+s+2<n.length)return e.splice(t,0,n.slice(0,s+a+2)),n.splice(0,s+a),1},jP=function(e,t,s){var i=e.length,n=~~(s*i);if(e[n]>t){for(;--n&&e[n]>t;);n<0&&(n=0)}else for(;e[++n]<t&&n<i;);return n<i?n:i-1},MH=function(e,t){var s=e.length;for(e.reverse();s--;)e[s].reversed||RH(e[s])},qC=function(e,t){return t.totalLength=e.totalLength,e.samples?(t.samples=e.samples.slice(0),t.lookup=e.lookup.slice(0),t.minLength=e.minLength,t.resolution=e.resolution):e.totalPoints&&(t.totalPoints=e.totalPoints),t},PH=function(e,t){var s=e.length,i=e[s-1]||[],n=i.length;s&&t[0]===i[n-2]&&t[1]===i[n-1]&&(t=i.concat(t.slice(2)),s--),e[s]=t};function zh(r){r=UC(r)&&CH.test(r)&&document.querySelector(r)||r;var e=r.getAttribute?r:0,t;return e&&(r=r.getAttribute("d"))?(e._gsPath||(e._gsPath={}),t=e._gsPath[r],t&&!t._dirty?t:e._gsPath[r]=Ip(r)):r?UC(r)?Ip(r):TP(r[0])?[r]:r:console.warn("Expecting a <path> element or an SVG path data string")}function NH(r){for(var e=[],t=0;t<r.length;t++)e[t]=qC(r[t],r[t].slice(0));return qC(r,e)}function RH(r){var e=0,t;for(r.reverse();e<r.length;e+=2)t=r[e],r[e]=r[e+1],r[e+1]=t;r.reversed=!r.reversed}var IH=function(e,t){var s=document.createElementNS("http://www.w3.org/2000/svg","path"),i=[].slice.call(e.attributes),n=i.length,a;for(t=","+t+",";--n>-1;)a=i[n].nodeName.toLowerCase(),t.indexOf(","+a+",")<0&&s.setAttributeNS(null,a,i[n].nodeValue);return s},DH={rect:"rx,ry,x,y,width,height",circle:"r,cx,cy",ellipse:"rx,ry,cx,cy",line:"x1,x2,y1,y2"},FH=function(e,t){for(var s=t?t.split(","):[],i={},n=s.length;--n>-1;)i[s[n]]=+e.getAttribute(s[n])||0;return i};function BH(r,e){var t=r.tagName.toLowerCase(),s=.552284749831,i,n,a,o,l,d,u,h,p,m,f,g,y,x,v,b,S,k,C,A,T,j;return t==="path"||!r.getBBox?r:(d=IH(r,"x,y,width,height,cx,cy,rx,ry,r,x1,x2,y1,y2,points"),j=FH(r,DH[t]),t==="rect"?(o=j.rx,l=j.ry||o,n=j.x,a=j.y,m=j.width-o*2,f=j.height-l*2,o||l?(g=n+o*(1-s),y=n+o,x=y+m,v=x+o*s,b=x+o,S=a+l*(1-s),k=a+l,C=k+f,A=C+l*s,T=C+l,i="M"+b+","+k+" V"+C+" C"+[b,A,v,T,x,T,x-(x-y)/3,T,y+(x-y)/3,T,y,T,g,T,n,A,n,C,n,C-(C-k)/3,n,k+(C-k)/3,n,k,n,S,g,a,y,a,y+(x-y)/3,a,x-(x-y)/3,a,x,a,v,a,b,S,b,k].join(",")+"z"):i="M"+(n+m)+","+a+" v"+f+" h"+-m+" v"+-f+" h"+m+"z"):t==="circle"||t==="ellipse"?(t==="circle"?(o=l=j.r,h=o*s):(o=j.rx,l=j.ry,h=l*s),n=j.cx,a=j.cy,u=o*s,i="M"+(n+o)+","+a+" C"+[n+o,a+h,n+u,a+l,n,a+l,n-u,a+l,n-o,a+h,n-o,a,n-o,a-h,n-u,a-l,n,a-l,n+u,a-l,n+o,a-h,n+o,a].join(",")+"z"):t==="line"?i="M"+j.x1+","+j.y1+" L"+j.x2+","+j.y2:(t==="polyline"||t==="polygon")&&(p=(r.getAttribute("points")+"").match(wH)||[],n=p.shift(),a=p.shift(),i="M"+n+","+a+" L"+p.join(","),t==="polygon"&&(i+=","+n+","+a+"z")),d.setAttribute("d",MP(d._gsRawPath=Ip(i))),e&&r.parentNode&&(r.parentNode.insertBefore(d,r),r.parentNode.removeChild(r)),d)}function _P(r,e,t){var s=r[e],i=r[e+2],n=r[e+4],a;return s+=(i-s)*t,i+=(n-i)*t,s+=(i-s)*t,a=i+(n+(r[e+6]-n)*t-i)*t-s,s=r[e+1],i=r[e+3],n=r[e+5],s+=(i-s)*t,i+=(n-i)*t,s+=(i-s)*t,yt(AH(i+(n+(r[e+7]-n)*t-i)*t-s,a)*TH)}function EP(r,e,t){t=jH(t)?1:GC(t)||0,e=GC(e)||0;var s=Math.max(0,~~(ur(t-e)-1e-8)),i=NH(r);if(e>t&&(e=1-e,t=1-t,MH(i),i.totalLength=0),e<0||t<0){var n=Math.abs(~~Math.min(e,t))+1;e+=n,t+=n}i.totalLength||So(i);var a=t>1,o=HC(i,e,_H,!0),l=HC(i,t,EH),d=l.segment,u=o.segment,h=l.segIndex,p=o.segIndex,m=l.i,f=o.i,g=p===h,y=m===f&&g,x,v,b,S,k,C,A,T;if(a||s){for(x=h<p||g&&m<f||y&&l.t<o.t,YC(i,p,f,o.t)&&(p++,x||(h++,y?(l.t=(l.t-o.t)/(1-o.t),m=0):g&&(m-=f))),Math.abs(1-(t-e))<1e-5?h=p-1:!l.t&&h?h--:YC(i,h,m,l.t)&&x&&p++,o.t===1&&(p=(p+1)%i.length),k=[],C=i.length,A=1+C*s,T=p,A+=(C-p+h)%C,S=0;S<A;S++)PH(k,i[T++%C]);i=k}else if(b=l.t===1?6:yy(d,m,l.t),e!==t)for(v=yy(u,f,y?o.t/l.t:o.t),g&&(b+=v),d.splice(m+b+2),(v||f)&&u.splice(0,f+v),S=i.length;S--;)(S<p||S>h)&&i.splice(S,1);else d.angle=_P(d,m+b,0),m+=b,o=d[m],l=d[m+1],d.length=d.totalLength=0,d.totalPoints=i.totalPoints=8,d.push(o,l,o,l,o,l,o,l);return i.totalLength=0,i}function LH(r,e,t){e=e||0,r.samples||(r.samples=[],r.lookup=[]);var s=~~r.resolution||12,i=1/s,n=r.length,a=r[e],o=r[e+1],l=e?e/6*s:0,d=r.samples,u=r.lookup,h=(e?r.minLength:gy)||gy,p=d[l+t*s-1],m=e?d[l-1]:0,f,g,y,x,v,b,S,k,C,A,T,j,_,M,E,D,R;for(d.length=u.length=0,g=e+2;g<n;g+=6){if(y=r[g+4]-a,x=r[g+2]-a,v=r[g]-a,k=r[g+5]-o,C=r[g+3]-o,A=r[g+1]-o,b=S=T=j=0,ur(y)<.01&&ur(k)<.01&&ur(v)+ur(A)<.01)r.length>8&&(r.splice(g,6),g-=6,n-=6);else for(f=1;f<=s;f++)M=i*f,_=1-M,b=S-(S=(M*M*y+3*_*(M*x+_*v))*M),T=j-(j=(M*M*k+3*_*(M*C+_*A))*M),D=gn(T*T+b*b),D<h&&(h=D),m+=D,d[l++]=m;a+=y,o+=k}if(p)for(p-=m;l<d.length;l++)d[l]+=p;if(d.length&&h){if(r.totalLength=R=d[d.length-1]||0,r.minLength=h,R/h<9999)for(D=E=0,f=0;f<R;f+=h)u[D++]=d[E]<f?++E:E}else r.totalLength=d[0]=0;return e?m-d[e/2-1]:m}function So(r,e){var t,s,i;for(i=t=s=0;i<r.length;i++)r[i].resolution=~~e||12,t+=LH(r[i]),s+=r[i].length;return r.totalPoints=s,r.totalLength=t,r}function yy(r,e,t){if(t<=0||t>=1)return 0;var s=r[e],i=r[e+1],n=r[e+2],a=r[e+3],o=r[e+4],l=r[e+5],d=r[e+6],u=r[e+7],h=s+(n-s)*t,p=n+(o-n)*t,m=i+(a-i)*t,f=a+(l-a)*t,g=h+(p-h)*t,y=m+(f-m)*t,x=o+(d-o)*t,v=l+(u-l)*t;return p+=(x-p)*t,f+=(v-f)*t,r.splice(e+2,4,yt(h),yt(m),yt(g),yt(y),yt(g+(p-g)*t),yt(y+(f-y)*t),yt(p),yt(f),yt(x),yt(v)),r.samples&&r.samples.splice(e/6*r.resolution|0,0,0,0,0,0,0,0),6}function HC(r,e,t,s){t=t||{},r.totalLength||So(r),(e<0||e>1)&&(e=AP(e));var i=0,n=r[0],a,o,l,d,u,h,p;if(!e)p=h=i=0,n=r[0];else if(e===1)p=1,i=r.length-1,n=r[i],h=n.length-8;else{if(r.length>1){for(l=r.totalLength*e,u=h=0;(u+=r[h++].totalLength)<l;)i=h;n=r[i],d=u-n.totalLength,e=(l-d)/(u-d)||0}a=n.samples,o=n.resolution,l=n.totalLength*e,h=n.lookup.length?n.lookup[~~(l/n.minLength)]||0:jP(a,l,e),d=h?a[h-1]:0,u=a[h],u<l&&(d=u,u=a[++h]),p=1/o*((l-d)/(u-d)+h%o),h=~~(h/o)*6,s&&p===1&&(h+6<n.length?(h+=6,p=0):i+1<r.length&&(h=p=0,n=r[++i]))}return t.t=p,t.i=h,t.path=r,t.segment=n,t.segIndex=i,t}function XC(r,e,t,s){var i=r[0],n=s||{},a,o,l,d,u,h,p,m,f;if((e<0||e>1)&&(e=AP(e)),i.lookup||So(r),r.length>1){for(l=r.totalLength*e,u=h=0;(u+=r[h++].totalLength)<l;)i=r[h];d=u-i.totalLength,e=(l-d)/(u-d)||0}return a=i.samples,o=i.resolution,l=i.totalLength*e,h=i.lookup.length?i.lookup[e<1?~~(l/i.minLength):i.lookup.length-1]||0:jP(a,l,e),d=h?a[h-1]:0,u=a[h],u<l&&(d=u,u=a[++h]),p=1/o*((l-d)/(u-d)+h%o)||0,f=1-p,h=~~(h/o)*6,m=i[h],n.x=yt((p*p*(i[h+6]-m)+3*f*(p*(i[h+4]-m)+f*(i[h+2]-m)))*p+m),n.y=yt((p*p*(i[h+7]-(m=i[h+1]))+3*f*(p*(i[h+5]-m)+f*(i[h+3]-m)))*p+m),t&&(n.angle=i.totalLength?_P(i,h,p>=1?1-1e-9:p||1e-9):i.angle||0),n}function od(r,e,t,s,i,n,a){for(var o=r.length,l,d,u,h,p;--o>-1;)for(l=r[o],d=l.length,u=0;u<d;u+=2)h=l[u],p=l[u+1],l[u]=h*e+p*s+n,l[u+1]=h*t+p*i+a;return r._dirty=1,r}function OH(r,e,t,s,i,n,a,o,l){if(!(r===o&&e===l)){t=ur(t),s=ur(s);var d=i%360*SH,u=nh(d),h=rh(d),p=Math.PI,m=p*2,f=(r-o)/2,g=(e-l)/2,y=u*f+h*g,x=-h*f+u*g,v=y*y,b=x*x,S=v/(t*t)+b/(s*s);S>1&&(t=gn(S)*t,s=gn(S)*s);var k=t*t,C=s*s,A=(k*C-k*b-C*v)/(k*b+C*v);A<0&&(A=0);var T=(n===a?-1:1)*gn(A),j=T*(t*x/s),_=T*-(s*y/t),M=(r+o)/2,E=(e+l)/2,D=M+(u*j-h*_),R=E+(h*j+u*_),B=(y-j)/t,O=(x-_)/s,F=(-y-j)/t,I=(-x-_)/s,K=B*B+O*O,ee=(O<0?-1:1)*Math.acos(B/gn(K)),P=(B*I-O*F<0?-1:1)*Math.acos((B*F+O*I)/gn(K*(F*F+I*I)));isNaN(P)&&(P=p),!a&&P>0?P-=m:a&&P<0&&(P+=m),ee%=m,P%=m;var W=Math.ceil(ur(P)/(m/4)),z=[],G=P/W,ce=4/3*rh(G/2)/(1+nh(G/2)),ae=u*t,te=h*t,Ve=h*-s,q=u*s,oe;for(oe=0;oe<W;oe++)i=ee+oe*G,y=nh(i),x=rh(i),B=nh(i+=G),O=rh(i),z.push(y-ce*x,x+ce*y,B+ce*O,O-ce*B,B,O);for(oe=0;oe<z.length;oe+=2)y=z[oe],x=z[oe+1],z[oe]=y*ae+x*Ve+D,z[oe+1]=y*te+x*q+R;return z[oe-2]=o,z[oe-1]=l,z}}function Ip(r){var e=(r+"").replace(kH,function(j){var _=+j;return _<1e-4&&_>-1e-4?0:_}).match(vH)||[],t=[],s=0,i=0,n=2/3,a=e.length,o=0,l="ERROR: malformed path: "+r,d,u,h,p,m,f,g,y,x,v,b,S,k,C,A,T=function(_,M,E,D){v=(E-_)/3,b=(D-M)/3,g.push(_+v,M+b,E-v,D-b,E,D)};if(!r||!isNaN(e[0])||isNaN(e[1]))return console.log(l),t;for(d=0;d<a;d++)if(k=m,isNaN(e[d])?(m=e[d].toUpperCase(),f=m!==e[d]):d--,h=+e[d+1],p=+e[d+2],f&&(h+=s,p+=i),d||(y=h,x=p),m==="M")g&&(g.length<8?t.length-=1:o+=g.length,WC(g)),s=y=h,i=x=p,g=[h,p],t.push(g),d+=2,m="L";else if(m==="C")g||(g=[0,0]),f||(s=i=0),g.push(h,p,s+e[d+3]*1,i+e[d+4]*1,s+=e[d+5]*1,i+=e[d+6]*1),d+=6;else if(m==="S")v=s,b=i,(k==="C"||k==="S")&&(v+=s-g[g.length-4],b+=i-g[g.length-3]),f||(s=i=0),g.push(v,b,h,p,s+=e[d+3]*1,i+=e[d+4]*1),d+=4;else if(m==="Q")v=s+(h-s)*n,b=i+(p-i)*n,f||(s=i=0),s+=e[d+3]*1,i+=e[d+4]*1,g.push(v,b,s+(h-s)*n,i+(p-i)*n,s,i),d+=4;else if(m==="T")v=s-g[g.length-4],b=i-g[g.length-3],g.push(s+v,i+b,h+(s+v*1.5-h)*n,p+(i+b*1.5-p)*n,s=h,i=p),d+=2;else if(m==="H")T(s,i,s=h,i),d+=1;else if(m==="V")T(s,i,s,i=h+(f?i-s:0)),d+=1;else if(m==="L"||m==="Z")m==="Z"&&(h=y,p=x,g.closed=!0),(m==="L"||ur(s-h)>.5||ur(i-p)>.5)&&(T(s,i,h,p),m==="L"&&(d+=2)),s=h,i=p;else if(m==="A"){if(C=e[d+4],A=e[d+5],v=e[d+6],b=e[d+7],u=7,C.length>1&&(C.length<3?(b=v,v=A,u--):(b=A,v=C.substr(2),u-=2),A=C.charAt(1),C=C.charAt(0)),S=OH(s,i,+e[d+1],+e[d+2],+e[d+3],+C,+A,(f?s:0)+v*1,(f?i:0)+b*1),d+=u,S)for(u=0;u<S.length;u++)g.push(S[u]);s=g[g.length-2],i=g[g.length-1]}else console.log(l);return d=g.length,d<6?(t.pop(),d=0):WC(g),t.totalPoints=o+d,t}function $H(r,e){e===void 0&&(e=1);for(var t=r[0],s=0,i=[t,s],n=2;n<r.length;n+=2)i.push(t,s,r[n],s=(r[n]-t)*e/2,t=r[n],-s);return i}function xy(r,e){ur(r[0]-r[2])<1e-4&&ur(r[1]-r[3])<1e-4&&(r=r.slice(2));var t=r.length-2,s=+r[0],i=+r[1],n=+r[2],a=+r[3],o=[s,i,s,i],l=n-s,d=a-i,u=r.nonSmooth||[],h=Math.abs(r[t]-s)<.001&&Math.abs(r[t+1]-i)<.001,p,m,f,g,y,x,v,b,S,k,C,A,T,j,_;if(!t)return[s,i,s,i,s,i,s,i];for(h&&(r.push(n,a),n=s,a=i,s=r[t-2],i=r[t-1],r.unshift(s,i),t+=4,u=[0,0].concat(u)),e=e||e===0?+e:1,f=2;f<t;f+=2)if(p=s,m=i,s=n,i=a,n=+r[f+2],a=+r[f+3],!(s===n&&i===a)){if(g=l,y=d,l=n-s,d=a-i,u[f]){o.push(s-(s-p)/4,i-(i-m)/4,s,i,s+(n-s)/4,i+(a-i)/4);continue}x=gn(g*g+y*y),v=gn(l*l+d*d),b=gn(Math.pow(l/v+g/x,2)+Math.pow(d/v+y/x,2)),S=(x+v)*e*.25/b,k=s-(s-p)*(x?S/x:0),C=s+(n-s)*(v?S/v:0),A=s-(k+((C-k)*(x*3/(x+v)+.5)/4||0)),T=i-(i-m)*(x?S/x:0),j=i+(a-i)*(v?S/v:0),_=i-(T+((j-T)*(x*3/(x+v)+.5)/4||0)),o.push(yt(k+A),yt(T+_),yt(s),yt(i),yt(C+A),yt(j+_))}return s!==n||i!==a||o.length<4?o.push(yt(n),yt(a),yt(n),yt(a)):o.length-=2,o.length===2?o.push(s,i,s,i,s,i):h&&(o.splice(0,6),o.length-=6),o.closed=h,o}function MP(r){TP(r[0])&&(r=[r]);var e="",t=r.length,s,i,n,a;for(i=0;i<t;i++){for(a=r[i],e+="M"+yt(a[0])+","+yt(a[1])+" C",s=a.length,n=2;n<s;n++)e+=yt(a[n++])+","+yt(a[n++])+" "+yt(a[n++])+","+yt(a[n++])+" "+yt(a[n++])+","+yt(a[n])+" ";a.closed&&(e+="z")}return e}/*!
 * matrix 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var xn,To,Wb,cm,cd,Vh,Dp,Md,Tr="transform",by=Tr+"Origin",PP,NP=function(e){var t=e.ownerDocument||e;for(!(Tr in e.style)&&("msTransform"in e.style)&&(Tr="msTransform",by=Tr+"Origin");t.parentNode&&(t=t.parentNode););if(To=window,Dp=new cu,t){xn=t,Wb=t.documentElement,cm=t.body,Md=xn.createElementNS("http://www.w3.org/2000/svg","g"),Md.style.transform="none";var s=t.createElement("div"),i=t.createElement("div"),n=t&&(t.body||t.firstElementChild);n&&n.appendChild&&(n.appendChild(s),s.appendChild(i),s.style.position="static",s.style.transform="translate3d(0,0,1px)",PP=i.offsetParent!==s,n.removeChild(s))}return t},zH=function(e){for(var t,s;e&&e!==cm;)s=e._gsap,s&&s.uncache&&s.get(e,"x"),s&&!s.scaleX&&!s.scaleY&&s.renderTransform&&(s.scaleX=s.scaleY=1e-4,s.renderTransform(1,s),t?t.push(s):t=[s]),e=e.parentNode;return t},RP=[],IP=[],VH=function(){return To.pageYOffset||xn.scrollTop||Wb.scrollTop||cm.scrollTop||0},UH=function(){return To.pageXOffset||xn.scrollLeft||Wb.scrollLeft||cm.scrollLeft||0},Yb=function(e){return e.ownerSVGElement||((e.tagName+"").toLowerCase()==="svg"?e:null)},GH=function r(e){if(To.getComputedStyle(e).position==="fixed")return!0;if(e=e.parentNode,e&&e.nodeType===1)return r(e)},Jf=function r(e,t){if(e.parentNode&&(xn||NP(e))){var s=Yb(e),i=s?s.getAttribute("xmlns")||"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",n=s?t?"rect":"g":"div",a=t!==2?0:100,o=t===3?100:0,l={position:"absolute",display:"block",pointerEvents:"none",margin:"0",padding:"0"},d=xn.createElementNS?xn.createElementNS(i.replace(/^https/,"http"),n):xn.createElement(n);return t&&(s?(Vh||(Vh=r(e)),d.setAttribute("width",.01),d.setAttribute("height",.01),d.setAttribute("transform","translate("+a+","+o+")"),d.setAttribute("fill","transparent"),Vh.appendChild(d)):(cd||(cd=r(e),Object.assign(cd.style,l)),Object.assign(d.style,l,{width:"0.1px",height:"0.1px",top:o+"px",left:a+"px"}),cd.appendChild(d))),d}throw"Need document and parent."},WH=function(e){for(var t=new cu,s=0;s<e.numberOfItems;s++)t.multiply(e.getItem(s).matrix);return t},YH=function(e){var t=e.getCTM(),s;return t||(s=e.style[Tr],e.style[Tr]="none",e.appendChild(Md),t=Md.getCTM(),e.removeChild(Md),s?e.style[Tr]=s:e.style.removeProperty(Tr.replace(/([A-Z])/g,"-$1").toLowerCase())),t||Dp.clone()},qH=function(e,t){var s=Yb(e),i=e===s,n=s?RP:IP,a=e.parentNode,o=a&&!s&&a.shadowRoot&&a.shadowRoot.appendChild?a.shadowRoot:a,l,d,u,h,p,m;if(e===To)return e;if(n.length||n.push(Jf(e,1),Jf(e,2),Jf(e,3)),l=s?Vh:cd,s)i?(u=YH(e),h=-u.e/u.a,p=-u.f/u.d,d=Dp):e.getBBox?(u=e.getBBox(),d=e.transform?e.transform.baseVal:{},d=d.numberOfItems?d.numberOfItems>1?WH(d):d.getItem(0).matrix:Dp,h=d.a*u.x+d.c*u.y,p=d.b*u.x+d.d*u.y):(d=new cu,h=p=0),t&&e.tagName.toLowerCase()==="g"&&(h=p=0),(i||!e.getBoundingClientRect().width?s:a).appendChild(l),l.setAttribute("transform","matrix("+d.a+","+d.b+","+d.c+","+d.d+","+(d.e+h)+","+(d.f+p)+")");else{if(h=p=0,PP)for(d=e.offsetParent,u=e;u&&(u=u.parentNode)&&u!==d&&u.parentNode;)(To.getComputedStyle(u)[Tr]+"").length>4&&(h=u.offsetLeft,p=u.offsetTop,u=0);if(m=To.getComputedStyle(e),m.position!=="absolute"&&m.position!=="fixed")for(d=e.offsetParent;a&&a!==d;)h+=a.scrollLeft||0,p+=a.scrollTop||0,a=a.parentNode;u=l.style,u.top=e.offsetTop-p+"px",u.left=e.offsetLeft-h+"px",u[Tr]=m[Tr],u[by]=m[by],u.position=m.position==="fixed"?"fixed":"absolute",o.appendChild(l)}return l},Zf=function(e,t,s,i,n,a,o){return e.a=t,e.b=s,e.c=i,e.d=n,e.e=a,e.f=o,e},cu=function(){function r(t,s,i,n,a,o){t===void 0&&(t=1),s===void 0&&(s=0),i===void 0&&(i=0),n===void 0&&(n=1),a===void 0&&(a=0),o===void 0&&(o=0),Zf(this,t,s,i,n,a,o)}var e=r.prototype;return e.inverse=function(){var s=this.a,i=this.b,n=this.c,a=this.d,o=this.e,l=this.f,d=s*a-i*n||1e-10;return Zf(this,a/d,-i/d,-n/d,s/d,(n*l-a*o)/d,-(s*l-i*o)/d)},e.multiply=function(s){var i=this.a,n=this.b,a=this.c,o=this.d,l=this.e,d=this.f,u=s.a,h=s.c,p=s.b,m=s.d,f=s.e,g=s.f;return Zf(this,u*i+p*a,u*n+p*o,h*i+m*a,h*n+m*o,l+f*i+g*a,d+f*n+g*o)},e.clone=function(){return new r(this.a,this.b,this.c,this.d,this.e,this.f)},e.equals=function(s){var i=this.a,n=this.b,a=this.c,o=this.d,l=this.e,d=this.f;return i===s.a&&n===s.b&&a===s.c&&o===s.d&&l===s.e&&d===s.f},e.apply=function(s,i){i===void 0&&(i={});var n=s.x,a=s.y,o=this.a,l=this.b,d=this.c,u=this.d,h=this.e,p=this.f;return i.x=n*o+a*d+h||0,i.y=n*l+a*u+p||0,i},r}();function Nc(r,e,t,s){if(!r||!r.parentNode||(xn||NP(r)).documentElement===r)return new cu;var i=zH(r),n=Yb(r),a=n?RP:IP,o=qH(r,t),l=a[0].getBoundingClientRect(),d=a[1].getBoundingClientRect(),u=a[2].getBoundingClientRect(),h=o.parentNode,p=!s&&GH(r),m=new cu((d.left-l.left)/100,(d.top-l.top)/100,(u.left-l.left)/100,(u.top-l.top)/100,l.left+(p?0:UH()),l.top+(p?0:VH()));if(h.removeChild(o),i)for(l=i.length;l--;)d=i[l],d.scaleX=d.scaleY=0,d.renderTransform(1,d);return e?m.inverse():m}/*!
 * MotionPathPlugin 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var HH="x,translateX,left,marginLeft,xPercent".split(","),XH="y,translateY,top,marginTop,yPercent".split(","),KH=Math.PI/180,nr,DP,ic,vy,eg,KC,QH=function(){return nr||typeof window<"u"&&(nr=window.gsap)&&nr.registerPlugin&&nr},Ol=function(e,t,s,i){for(var n=t.length,a=i===2?0:i,o=0;o<n;o++)e[a]=parseFloat(t[o][s]),i===2&&(e[a+1]=0),a+=2;return e},vc=function(e,t,s){return parseFloat(e._gsap.get(e,t,s||"px"))||0},FP=function(e){var t=e[0],s=e[1],i;for(i=2;i<e.length;i+=2)t=e[i]+=t,s=e[i+1]+=s},QC=function(e,t,s,i,n,a,o,l,d){if(o.type==="cubic")t=[t];else{o.fromCurrent!==!1&&t.unshift(vc(s,i,l),n?vc(s,n,d):0),o.relative&&FP(t);var u=n?xy:$H;t=[u(t,o.curviness)]}return t=a(BP(t,s,o)),Fp(e,s,i,t,"x",l),n&&Fp(e,s,n,t,"y",d),So(t,o.resolution||(o.curviness===0?20:12))},JH=function(e){return e},ZH=/[-+\.]*\d+\.?(?:e-|e\+)?\d*/g,JC=function(e,t,s){var i=Nc(e),n=0,a=0,o;return(e.tagName+"").toLowerCase()==="svg"?(o=e.viewBox.baseVal,o.width||(o={width:+e.getAttribute("width"),height:+e.getAttribute("height")})):o=t&&e.getBBox&&e.getBBox(),t&&t!=="auto"&&(n=t.push?t[0]*(o?o.width:e.offsetWidth||0):t.x,a=t.push?t[1]*(o?o.height:e.offsetHeight||0):t.y),s.apply(n||a?i.apply({x:n,y:a}):{x:i.e,y:i.f})},wy=function(e,t,s,i){var n=Nc(e.parentNode,!0,!0),a=n.clone().multiply(Nc(t)),o=JC(e,s,n),l=JC(t,i,n),d=l.x,u=l.y,h;return a.e=a.f=0,i==="auto"&&t.getTotalLength&&t.tagName.toLowerCase()==="path"&&(h=t.getAttribute("d").match(ZH)||[],h=a.apply({x:+h[0],y:+h[1]}),d+=h.x,u+=h.y),h&&(h=a.apply(t.getBBox()),d-=h.x,u-=h.y),a.e=d-o.x,a.f=u-o.y,a},BP=function(e,t,s){var i=s.align,n=s.matrix,a=s.offsetX,o=s.offsetY,l=s.alignOrigin,d=e[0][0],u=e[0][1],h=vc(t,"x"),p=vc(t,"y"),m,f,g;return!e||!e.length?zh("M0,0L0,0"):(i&&(i==="self"||(m=vy(i)[0]||t)===t?od(e,1,0,0,1,h-d,p-u):(l&&l[2]!==!1?nr.set(t,{transformOrigin:l[0]*100+"% "+l[1]*100+"%"}):l=[vc(t,"xPercent")/-100,vc(t,"yPercent")/-100],f=wy(t,m,l,"auto"),g=f.apply({x:d,y:u}),od(e,f.a,f.b,f.c,f.d,h+f.e-(g.x-f.e),p+f.f-(g.y-f.f)))),n?od(e,n.a,n.b,n.c,n.d,n.e,n.f):(a||o)&&od(e,1,0,0,1,a||0,o||0),e)},Fp=function(e,t,s,i,n,a){var o=t._gsap,l=o.harness,d=l&&l.aliases&&l.aliases[s],u=d&&d.indexOf(",")<0?d:s,h=e._pt=new DP(e._pt,t,u,0,0,JH,0,o.set(t,u,e));h.u=ic(o.get(t,u,a))||0,h.path=i,h.pp=n,e._props.push(u)},eX=function(e,t){return function(s){return e||t!==1?EP(s,e,t):s}},LP={version:"3.14.2",name:"motionPath",register:function(e,t,s){nr=e,ic=nr.utils.getUnit,vy=nr.utils.toArray,eg=nr.core.getStyleSaver,KC=nr.core.reverting||function(){},DP=s},init:function(e,t,s){if(!nr)return console.warn("Please gsap.registerPlugin(MotionPathPlugin)"),!1;(!(typeof t=="object"&&!t.style)||!t.path)&&(t={path:t});var i=[],n=t,a=n.path,o=n.autoRotate,l=n.unitX,d=n.unitY,u=n.x,h=n.y,p=a[0],m=eX(t.start,"end"in t?t.end:1),f,g;if(this.rawPaths=i,this.target=e,this.tween=s,this.styles=eg&&eg(e,"transform"),(this.rotate=o||o===0)&&(this.rOffset=parseFloat(o)||0,this.radians=!!t.useRadians,this.rProp=t.rotation||"rotation",this.rSet=e._gsap.set(e,this.rProp,this),this.ru=ic(e._gsap.get(e,this.rProp))||0),Array.isArray(a)&&!("closed"in a)&&typeof p!="number"){for(g in p)!u&&~HH.indexOf(g)?u=g:!h&&~XH.indexOf(g)&&(h=g);u&&h?i.push(QC(this,Ol(Ol([],a,u,0),a,h,1),e,u,h,m,t,l||ic(a[0][u]),d||ic(a[0][h]))):u=h=0;for(g in p)g!==u&&g!==h&&i.push(QC(this,Ol([],a,g,2),e,g,0,m,t,ic(a[0][g])))}else f=m(BP(zh(t.path),e,t)),So(f,t.resolution),i.push(f),Fp(this,e,t.x||"x",f,"x",t.unitX||"px"),Fp(this,e,t.y||"y",f,"y",t.unitY||"px");s.vars.immediateRender&&this.render(s.progress(),this)},render:function(e,t){var s=t.rawPaths,i=s.length,n=t._pt;if(t.tween._time||!KC()){for(e>1?e=1:e<0&&(e=0);i--;)XC(s[i],e,!i&&t.rotate,s[i]);for(;n;)n.set(n.t,n.p,n.path[n.pp]+n.u,n.d,e),n=n._next;t.rotate&&t.rSet(t.target,t.rProp,s[0].angle*(t.radians?KH:1)+t.rOffset+t.ru,t,e)}else t.styles.revert()},getLength:function(e){return So(zh(e)).totalLength},sliceRawPath:EP,getRawPath:zh,pointsToSegment:xy,stringToRawPath:Ip,rawPathToString:MP,transformRawPath:od,getGlobalMatrix:Nc,getPositionOnPath:XC,cacheRawPathMeasurements:So,convertToPath:function(e,t){return vy(e).map(function(s){return BH(s,t!==!1)})},convertCoordinates:function(e,t,s){var i=Nc(t,!0,!0).multiply(Nc(e));return s?i.apply(s):i},getAlignMatrix:wy,getRelativePosition:function(e,t,s,i){var n=wy(e,t,s,i);return{x:n.e,y:n.f}},arrayToRawPath:function(e,t){t=t||{};var s=Ol(Ol([],e,t.x||"x",0),e,t.y||"y",1);return t.relative&&FP(s),[t.type==="cubic"?s:xy(s,t.curviness)]}};QH()&&nr.registerPlugin(LP);Gb.registerPlugin(LP);function ZC(r,e){if(r.length===0)return null;if(r.length===1)return{x:r[0].x,y:r[0].y};const t=[...r].sort((l,d)=>l.time-d.time);if(e<=t[0].time)return{x:t[0].x,y:t[0].y};if(e>=t[t.length-1].time){const l=t[t.length-1];return{x:l.x,y:l.y}}let s=0;for(let l=0;l<t.length-1;l++)if(e>=t[l].time&&e<=t[l+1].time){s=l;break}const i=t[s],n=t[s+1],a=n.time-i.time,o=a>0?(e-i.time)/a:0;return i.controlPoints&&n.controlPoints?tX({x:i.x,y:i.y},i.controlPoints.cp2,n.controlPoints.cp1,{x:n.x,y:n.y},o):{x:i.x+(n.x-i.x)*o,y:i.y+(n.y-i.y)*o}}function tX(r,e,t,s,i){const n=1-i,a=n*n,o=a*n,l=i*i,d=l*i,u=o*r.x+3*a*i*e.x+3*n*l*t.x+d*s.x,h=o*r.y+3*a*i*e.y+3*n*l*t.y+d*s.y,m=Math.min(1,i+.001),f=1-m,g=Math.pow(f,3)*r.x+3*Math.pow(f,2)*m*e.x+3*f*Math.pow(m,2)*t.x+Math.pow(m,3)*s.x,y=Math.pow(f,3)*r.y+3*Math.pow(f,2)*m*e.y+3*f*Math.pow(m,2)*t.y+Math.pow(m,3)*s.y,x=Math.atan2(y-h,g-u)*(180/Math.PI);return{x:u,y:h,rotation:x}}function sX(r,e,t=.5){if(r.length<2)return r[0]||{x:0,y:0};const s=r.length-1,i=Math.min(Math.floor(e*s),s-1),n=e*s%1,a=r[Math.max(0,i-1)],o=r[i],l=r[Math.min(r.length-1,i+1)],d=r[Math.min(r.length-1,i+2)],u=n*n,h=u*n,p=t*(l.x-a.x),m=t*(l.y-a.y),f=t*(d.x-o.x),g=t*(d.y-o.y),y=2*h-3*u+1,x=h-2*u+n,v=-2*h+3*u,b=h-u;return{x:y*o.x+x*p+v*l.x+b*f,y:y*o.y+x*m+v*l.y+b*g}}function OP(r){if(r.length===0)return"";if(r.length===1)return`M ${r[0].x} ${r[0].y}`;const e=[...r].sort((s,i)=>s.time-i.time);let t=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<e.length-1;s++){const i=e[s],n=e[s+1];if(i.controlPoints&&n.controlPoints)t+=` C ${i.controlPoints.cp2.x} ${i.controlPoints.cp2.y}, ${n.controlPoints.cp1.x} ${n.controlPoints.cp1.y}, ${n.x} ${n.y}`;else{const a=i.x+(n.x-i.x)/3,o=i.y+(n.y-i.y)/3,l=i.x+2*(n.x-i.x)/3,d=i.y+2*(n.y-i.y)/3;t+=` C ${a} ${o}, ${l} ${d}, ${n.x} ${n.y}`}}return t}function ky(r){if(r.length<2)return r;const e=[...r].sort((t,s)=>t.time-s.time);return e.map((t,s)=>{if(t.controlPoints)return t;const i=e[s-1],n=e[s+1];let a=0,o=0;return i&&n?(a=(n.x-i.x)/4,o=(n.y-i.y)/4):n?(a=(n.x-t.x)/3,o=(n.y-t.y)/3):i&&(a=(t.x-i.x)/3,o=(t.y-i.y)/3),{...t,controlPoints:{cp1:{x:t.x-a,y:t.y-o},cp2:{x:t.x+a,y:t.y+o}}}})}class iX{timelines=new Map;motionPaths=new Map;createTimeline(e,t){this.timelines.has(e)&&this.timelines.get(e).kill();const s=Gb.timeline({paused:!0,defaults:{duration:t?.duration||1,ease:t?.ease||"none"}});return this.timelines.set(e,s),s}getTimeline(e){return this.timelines.get(e)}removeTimeline(e){const t=this.timelines.get(e);t&&(t.kill(),this.timelines.delete(e))}setMotionPath(e,t){this.motionPaths.set(e,{...t,clipId:e})}getMotionPath(e){return this.motionPaths.get(e)}removeMotionPath(e){this.motionPaths.delete(e)}updateGSAPMotionPathPoint(e,t,s){const i=this.motionPaths.get(e);!i||t<0||t>=i.points.length||(i.points[t]={...i.points[t],...s},this.motionPaths.set(e,i))}addGSAPMotionPathPoint(e,t){const s=this.motionPaths.get(e);s&&(s.points.push(t),s.points.sort((i,n)=>i.time-n.time),s.points=ky(s.points),this.motionPaths.set(e,s))}removeGSAPMotionPathPoint(e,t){const s=this.motionPaths.get(e);!s||t<0||t>=s.points.length||s.points.length<=2||(s.points.splice(t,1),s.points=ky(s.points),this.motionPaths.set(e,s))}samplePositionAtTime(e,t,s){const i=this.motionPaths.get(e);if(!i||!i.enabled||i.points.length===0)return null;const n=s>0?t/s:0,a=Math.max(0,Math.min(1,n));return i.pathType==="catmull-rom"?sX(i.points,a):ZC(i.points,a)}getSVGPath(e){const t=this.motionPaths.get(e);return t?OP(t.points):""}sampleFrameTransforms(e,t,s,i){const n=this.motionPaths.get(e);if(!n||!n.enabled)return[];const a=[],o=s-t,l=Math.ceil(o*i);for(let d=0;d<=l;d++){const u=t+d/i,h=o>0?(u-t)/o:0,p=ZC(n.points,h);p&&a.push({time:u,...p})}return a}dispose(){for(const e of this.timelines.values())e.kill();this.timelines.clear(),this.motionPaths.clear()}}let tg=null;function rX(){return tg||(tg=new iX),tg}const nX=["#ff6b6b","#ffd93d","#6bcb77","#4d96ff","#ff6b9d","#845ef7"],e2=["#ff4500","#ff6b00","#ffb700","#ffd700"],aX=["#ffffff","#fffacd","#fff8dc","#ffffe0"],t2=["#a0a0a0","#808080","#606060","#404040"],s2=["#9b59b6","#8e44ad","#3498db","#2980b9","#e91e63"],$P=[{id:"dissolve-soft",name:"Soft Dissolve",type:"dissolve",description:"Gentle dissolve effect with fading particles",config:{...Qi,particleCount:200,speed:30,speedVariance:20,gravity:10,colors:t2,size:{min:2,max:6},opacity:{start:.8,end:0},lifetime:{min:1,max:3},emissionRate:100,fadeIn:.1,fadeOut:.5,blendMode:"normal"}},{id:"explode-burst",name:"Explosion Burst",type:"explode",description:"Dramatic explosion with fast-moving particles",config:{...Qi,particleCount:300,speed:400,speedVariance:150,gravity:300,colors:e2,size:{min:3,max:12},opacity:{start:1,end:0},lifetime:{min:.5,max:1.5},emissionRate:500,emissionShape:"circle",emissionRadius:20,fadeOut:.4,blendMode:"add"}},{id:"implode-gather",name:"Implode Gather",type:"implode",description:"Particles gather toward the center",config:{...Qi,particleCount:150,speed:200,speedVariance:50,gravity:0,colors:s2,size:{min:4,max:10},opacity:{start:0,end:1},lifetime:{min:.8,max:1.5},emissionRate:80,emissionShape:"circle",emissionRadius:300,fadeIn:.3,fadeOut:.1,blendMode:"add"}},{id:"confetti-celebration",name:"Celebration Confetti",type:"confetti",description:"Colorful falling confetti for celebrations",config:{...Qi,particleCount:200,speed:150,speedVariance:80,gravity:200,wind:{x:30,y:0,z:0},turbulence:50,colors:nX,size:{min:6,max:14},opacity:{start:1,end:.8},lifetime:{min:2,max:4},emissionRate:60,emissionShape:"rectangle",emissionRadius:400,rotationSpeed:5,fadeOut:.3,blendMode:"normal"}},{id:"dust-ambient",name:"Ambient Dust",type:"dust",description:"Subtle floating dust particles",config:{...Qi,particleCount:80,speed:15,speedVariance:10,gravity:-5,turbulence:20,colors:t2,size:{min:1,max:3},opacity:{start:.4,end:.1},lifetime:{min:3,max:8},emissionRate:10,emissionShape:"rectangle",emissionRadius:500,fadeIn:.3,fadeOut:.5,blendMode:"normal"}},{id:"sparkle-magic",name:"Magic Sparkles",type:"sparkle",description:"Glittering sparkle effect",config:{...Qi,particleCount:100,speed:20,speedVariance:15,gravity:10,colors:aX,size:{min:2,max:6},opacity:{start:1,end:0},lifetime:{min:.3,max:.8},emissionRate:80,emissionShape:"sphere",emissionRadius:100,fadeIn:.1,fadeOut:.5,blendMode:"add"}},{id:"disintegrate-thanos",name:"Disintegration",type:"disintegrate",description:"Object breaks apart and fades away",config:{...Qi,particleCount:400,speed:60,speedVariance:40,gravity:-30,wind:{x:50,y:-20,z:0},turbulence:30,colors:["#a0a0a0","#808080","#606060"],size:{min:2,max:5},opacity:{start:1,end:0},lifetime:{min:1,max:2.5},emissionRate:200,emissionShape:"rectangle",emissionRadius:200,fadeOut:.6,blendMode:"normal"}},{id:"pixelate-retro",name:"Pixel Break",type:"pixelate",description:"Breaks into pixel-like blocks",config:{...Qi,particleCount:150,speed:100,speedVariance:50,gravity:400,colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"],size:{min:8,max:16},opacity:{start:1,end:.5},lifetime:{min:.5,max:1.2},emissionRate:200,emissionShape:"rectangle",emissionRadius:150,rotationSpeed:3,fadeOut:.3,blendMode:"normal"}},{id:"shatter-glass",name:"Glass Shatter",type:"shatter",description:"Glass-breaking effect with sharp fragments",config:{...Qi,particleCount:250,speed:300,speedVariance:150,gravity:500,colors:["#ffffff","#e0e0e0","#c0c0c0","#a0a0a0"],size:{min:3,max:12},opacity:{start:.9,end:.3},lifetime:{min:.4,max:1},emissionRate:400,emissionShape:"circle",emissionRadius:50,rotationSpeed:8,fadeOut:.4,blendMode:"normal"}},{id:"morph-transform",name:"Shape Morph",type:"morph",description:"Transform from one shape to another",config:{...Qi,particleCount:200,speed:50,speedVariance:30,gravity:0,colors:s2,size:{min:4,max:8},opacity:{start:.8,end:.8},lifetime:{min:1,max:2},emissionRate:100,emissionShape:"circle",emissionRadius:150,fadeIn:.2,fadeOut:.2,blendMode:"add"}},{id:"fire-trail",name:"Fire Trail",type:"dust",description:"Fiery trailing particles",config:{...Qi,particleCount:150,speed:80,speedVariance:40,gravity:-100,colors:e2,size:{min:4,max:12},opacity:{start:.9,end:0},lifetime:{min:.3,max:.8},emissionRate:120,emissionShape:"circle",emissionRadius:20,fadeIn:.05,fadeOut:.6,blendMode:"add"}},{id:"snow-fall",name:"Snowfall",type:"dust",description:"Gentle falling snow",config:{...Qi,particleCount:100,speed:30,speedVariance:20,gravity:50,wind:{x:20,y:0,z:0},turbulence:30,colors:["#ffffff","#f0f0f0","#e8e8e8"],size:{min:2,max:6},opacity:{start:.8,end:.3},lifetime:{min:4,max:8},emissionRate:20,emissionShape:"rectangle",emissionRadius:600,rotationSpeed:1,fadeIn:.2,fadeOut:.4,blendMode:"normal"}}];function oX(r){return $P.find(e=>e.id===r)}function cX(r,e,t,s,i){const n=oX(r);return n?{id:e,clipId:t,type:n.type,startTime:s,duration:i,config:{...n.config},enabled:!0}:null}const Cy="openreel_device_profile";function lX(r){return r>=8?"high":r>=4?"mid":"low"}function dX(r){return r>=8?"high":r>=4?"mid":"low"}function uX(r){const e=r.toLowerCase(),t=["nvidia rtx","nvidia geforce rtx","radeon rx 6","radeon rx 7","apple m1 pro","apple m1 max","apple m2","apple m3","intel arc"],s=["nvidia gtx 1","nvidia geforce gtx","radeon rx 5","apple m1","intel iris","intel uhd"];return t.some(i=>e.includes(i))?"high":s.some(i=>e.includes(i))?"mid":"low"}function hX(){const r=navigator.userAgent;let e="Unknown";r.includes("Windows")?e="Windows":r.includes("Mac")?e="macOS":r.includes("Linux")?e="Linux":r.includes("Android")?e="Android":r.includes("iPhone")||r.includes("iPad")?e="iOS":r.includes("CrOS")&&(e="ChromeOS");let t="Unknown";r.includes("Chrome")&&!r.includes("Edg")?t="Chrome":r.includes("Firefox")?t="Firefox":r.includes("Safari")&&!r.includes("Chrome")?t="Safari":r.includes("Edg")&&(t="Edge");const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(r);return{os:e,browser:t,isMobile:s}}function pX(){try{const r=document.createElement("canvas"),e=r.getContext("webgl2")||r.getContext("webgl")||r.getContext("experimental-webgl");if(!e)return{vendor:"Unknown",renderer:"Unknown",tier:"low"};const t=e.getExtension("WEBGL_debug_renderer_info");if(t){const s=e.getParameter(t.UNMASKED_VENDOR_WEBGL),i=e.getParameter(t.UNMASKED_RENDERER_WEBGL);return{vendor:s||"Unknown",renderer:i||"Unknown",tier:uX(i||"")}}return{vendor:"Unknown",renderer:"Unknown",tier:"mid"}}catch{return{vendor:"Unknown",renderer:"Unknown",tier:"low"}}}async function ah(r,e,t){if(typeof VideoEncoder>"u")return{hardware:!1,supported:!1};try{const s={codec:r,width:e,height:t,bitrate:5e6,framerate:30},i=await VideoEncoder.isConfigSupported({...s,hardwareAcceleration:"prefer-hardware"}),n=await VideoEncoder.isConfigSupported({...s,hardwareAcceleration:"prefer-software"});return{hardware:i.supported===!0&&i.config?.hardwareAcceleration==="prefer-hardware",supported:i.supported===!0||n.supported===!0,maxResolution:{width:e,height:t}}}catch{return{hardware:!1,supported:!1}}}async function mX(){const r={h264:"avc1.42001E",h265:"hvc1.1.6.L93.B0",vp9:"vp09.00.10.08",av1:"av01.0.04M.08"},[e,t,s,i]=await Promise.all([ah(r.h264,1920,1080),ah(r.h265,1920,1080),ah(r.vp9,1920,1080),ah(r.av1,1920,1080)]);return{h264:e,h265:t,vp9:s,av1:i}}function fX(r,e,t){const s={low:1,mid:2,high:3},i=(s[r.tier]+s[e.tier]+s[t.tier]*1.5)/3.5;return i>=2.5?"high":i>=1.5?"mid":"low"}async function gX(){const r=navigator.hardwareConcurrency||4,e=navigator.deviceMemory||4,t={cores:r,tier:lX(r)},s={gb:e,tier:dX(e)},i=pX(),n=await mX(),a=hX(),o=Object.values(n).some(h=>h.hardware),l={...i,hasHardwareEncoding:o},d=fX(t,s,l),u=yX();return{cpu:t,memory:s,gpu:l,encoding:n,platform:a,overallTier:d,benchmark:u}}function i2(r,e){const t=e.width*e.height>2073600,s=[];if(r.encoding.h264.supported){const i=r.encoding.h264.hardware;s.push({codec:"h264",label:"H.264 (MP4)",recommended:!0,reason:i?"Hardware accelerated":"Fast software encoding",speedRating:i?"fast":"medium",qualityRating:"good"})}if(r.encoding.h265.supported){const i=r.encoding.h265.hardware;s.push({codec:"h265",label:"H.265/HEVC (MP4)",recommended:i&&!t,reason:i?"Hardware accelerated, better compression":"Better compression, slower encoding",speedRating:i?"medium":"slow",qualityRating:"better"})}if(r.encoding.vp9.supported&&s.push({codec:"vp9",label:"VP9 (WebM)",recommended:!1,reason:"Good for web, software encoding only",speedRating:"slow",qualityRating:"better"}),r.encoding.av1.supported){const i=r.encoding.av1.hardware;s.push({codec:"av1",label:"AV1 (MP4/WebM)",recommended:i&&r.overallTier==="high",reason:i?"Best compression, hardware accelerated":"Best compression, very slow encoding",speedRating:i?"medium":"very-slow",qualityRating:"best"})}return s.sort((i,n)=>i.recommended&&!n.recommended?-1:!i.recommended&&n.recommended?1:0)}function yX(){try{const r=localStorage.getItem(Cy);if(r){const e=JSON.parse(r),t=7*24*60*60*1e3;if(e.benchmark&&Date.now()-e.benchmark.testedAt<t)return e.benchmark}}catch{}}function xX(r){try{const e=localStorage.getItem(Cy),t=e?JSON.parse(e):{};t.benchmark=r,localStorage.setItem(Cy,JSON.stringify(t))}catch{}}let oh=null;async function Sy(r=!1){return!r&&oh||(oh=await gX()),oh}function bX(r){const e=[];if(r.gpu.renderer!=="Unknown"){const t=r.gpu.renderer.replace(/ANGLE \(|, .*\)/g,"").replace(/Direct3D11 vs_\d+_\d+ ps_\d+_\d+/g,"").trim();e.push(t)}return e.push(`${r.cpu.cores} cores`),e.join("  ")}const vX={h264:{hardware_high:120,hardware_mid:90,hardware_low:60,software_high:45,software_mid:30,software_low:15},h265:{hardware_high:60,hardware_mid:45,hardware_low:30,software_high:15,software_mid:8,software_low:4},vp9:{hardware_high:30,hardware_mid:20,hardware_low:15,software_high:20,software_mid:12,software_low:6},av1:{hardware_high:45,hardware_mid:30,hardware_low:20,software_high:8,software_mid:4,software_low:2}},r2={"1280x720":1.5,"1920x1080":1,"2560x1440":.6,"3840x2160":.25};function wX(r,e){const t=`${r}x${e}`;if(r2[t])return r2[t];const s=r*e;return 1920*1080/s}function n2(r){let e=1;return r.hasEffects&&(e*=.7),r.hasTransitions&&(e*=.85),r.trackCount&&r.trackCount>2&&(e*=Math.max(.5,1-(r.trackCount-2)*.1)),e}function a2(r){if(r<60)return`~${Math.round(r)} seconds`;const e=Math.floor(r/60),t=Math.round(r%60);if(e<60)return t===0?`~${e} minute${e>1?"s":""}`:`~${e}m ${t}s`;const s=Math.floor(e/60),i=e%60;return`~${s}h ${i}m`}function zP(r,e){const t=Math.ceil(e.duration*e.frameRate);if(r.benchmark){const m=r.benchmark.resolution.width*r.benchmark.resolution.height,f=e.width*e.height,g=m/f;let y=1;if(r.benchmark.codec!==e.codec){const b={h264:1,h265:.4,vp9:.5,av1:.2};y=(b[r.benchmark.codec]||1)/(b[e.codec]||1)}const x=r.benchmark.framesPerSecond*g*y*n2(e),v=t/Math.max(1,x);return{seconds:v,formatted:a2(v),confidence:"measured",breakdown:{rendering:v*.4,encoding:v*.55,muxing:v*.05}}}const i=r.encoding[e.codec]?.hardware||!1,n=r.overallTier,o=`${i?"hardware":"software"}_${n}`,l=vX[e.codec]?.[o]||15,d=wX(e.width,e.height),u=n2(e),h=l*d*u,p=t/Math.max(1,h);return{seconds:p,formatted:a2(p),confidence:"estimated",breakdown:{rendering:p*.4,encoding:p*.55,muxing:p*.05}}}async function kX(r){r?.({phase:"preparing",progress:0,framesProcessed:0,totalFrames:60});const i=new OffscreenCanvas(1920,1080),n=i.getContext("2d");if(!n)throw new Error("Failed to create canvas context for benchmark");const a=[];for(let y=0;y<60;y++){n.fillStyle=`hsl(${y*6%360}, 70%, 50%)`,n.fillRect(0,0,1920,1080),n.fillStyle="white",n.font="48px sans-serif",n.fillText(`Frame ${y+1}`,1920/2-80,1080/2);const x=await createImageBitmap(i);a.push(x),r?.({phase:"rendering",progress:(y+1)/60*.3,framesProcessed:y+1,totalFrames:60})}if(typeof VideoEncoder>"u")throw a.forEach(y=>y.close()),new Error("VideoEncoder not supported");let o=0;const l=new VideoEncoder({output:y=>{o++,r?.({phase:"encoding",progress:.3+o/60*.65,framesProcessed:o,totalFrames:60})},error:y=>{console.error("Benchmark encoder error:",y)}}),d={codec:"avc1.42001E",width:1920,height:1080,bitrate:5e6,framerate:30,hardwareAcceleration:"prefer-hardware"};(await VideoEncoder.isConfigSupported(d)).supported||(d.hardwareAcceleration="prefer-software"),l.configure(d);const h=performance.now();for(let y=0;y<a.length;y++){const x=new VideoFrame(a[y],{timestamp:y*33333.333333333336,duration:33333.333333333336});l.encode(x,{keyFrame:y%30===0}),x.close()}await l.flush(),l.close();const f=60/((performance.now()-h)/1e3);a.forEach(y=>y.close()),r?.({phase:"complete",progress:1,framesProcessed:60,totalFrames:60});const g={framesPerSecond:f,codec:"h264",resolution:{width:1920,height:1080},testedAt:Date.now()};return xX(g),g}function CX(r){if(!r.benchmark)return!0;const e=7*24*60*60*1e3;return Date.now()-r.benchmark.testedAt>e}const Ms={format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:5e3,bitrateMode:"cbr",quality:80,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:192,channels:2}},sg={format:"mp3",sampleRate:48e3,bitDepth:16,bitrate:320,channels:2},o2={format:"jpg",quality:90,width:1920,height:1080},Un={"4k-high":{width:3840,height:2160,bitrate:8e4,frameRate:30,quality:95},"4k":{width:3840,height:2160,bitrate:5e4,frameRate:30,quality:90},"4k-60":{width:3840,height:2160,bitrate:65e3,frameRate:60,quality:90},"1080p-high":{width:1920,height:1080,bitrate:25e3,frameRate:30,quality:95},"1080p":{width:1920,height:1080,bitrate:15e3,frameRate:30,quality:85},"720p":{width:1280,height:720,bitrate:8e3,frameRate:30,quality:80}};let rr=null,ig=null;async function SX(){if(typeof WebAssembly>"u")return null;try{const r=new URL("data:application/wasm;base64,AGFzbQEAAAABKwdgBH9/f38AYAF/AX9gA39/fwBgBX9/f39/AGACf38Bf2ADf39/AX9gAAACDQEDZW52BWFib3J0AAADCgkCAAADBAUBAQYFAwEAAQYGAX8BQQALB3AHD2VuY29kZVdhdjE2TW9ubwABEWVuY29kZVdhdjE2U3RlcmVvAAIRZW5jb2RlV2F2MjRTdGVyZW8AAw53cml0ZVdhdkhlYWRlcgAECmFsbG9jYXRlVTgABwthbGxvY2F0ZUYzMgAIBm1lbW9yeQIACAEJDAEICs8LCYEBAgR/AX0gACgCCEECdiEEA0AgAyAESARAIAIgA0EBdGoiBSABKAIEakMAAIC/QwAAgD8gACgCBCADQQJ0aioCACIHIAdDAACAP14bIAdDAACAv10bQwD+/0aU/AAiBjoAACABKAIEIAVBAWpqIAbBQQh1OgAAIANBAWohAwwBCwsL1wECAX0FfyAAKAIIQQJ2IQgDQCAFIAhIBEBDAACAv0MAAIA/IAVBAnQiCSABKAIEaioCACIEIARDAACAP14bIARDAACAv10bQwD+/0aU/AAhByADIAlqIgYgAigCBGpDAACAv0MAAIA/IAkgACgCBGoqAgAiBCAEQwAAgD9eGyAEQwAAgL9dG0MA/v9GlPwAIgk6AAAgAigCBCAGQQFqaiAJwUEIdToAACACKAIEIAZBAmpqIAc6AAAgAigCBCAGQQNqaiAHwUEIdToAACAFQQFqIQUMAQsLC/4BAgF9BX8gACgCCEECdiEIA0AgBiAISARAQwAAgL9DAACAPyAGQQJ0IgkgASgCBGoqAgAiBCAEQwAAgD9eGyAEQwAAgL9dG0P+//9KlPwAIQcgAyAGQQZsaiIFIAIoAgRqQwAAgL9DAACAPyAJIAAoAgRqKgIAIgQgBEMAAIA/XhsgBEMAAIC/XRtD/v//SpT8ACIJOgAAIAIoAgQgBUEBamogCUEIdToAACACKAIEIAVBAmpqIAlBEHU6AAAgAigCBCAFQQNqaiAHOgAAIAIoAgQgBUEEamogB0EIdToAACACKAIEIAVBBWpqIAdBEHU6AAAgBkEBaiEGDAELCwuRBAEDfyABIANBA3VsIgYgAmwhBSAAKAIEQdIAOgAAIAAoAgRByQA6AAEgACgCBEHGADoAAiAAKAIEQcYAOgADIAAoAgQgBCAGbCIEQSRqIgc6AAQgACgCBCAHQQh1OgAFIAAoAgQgB0EQdToABiAAKAIEIAdBGHU6AAcgACgCBEHXADoACCAAKAIEQcEAOgAJIAAoAgRB1gA6AAogACgCBEHFADoACyAAKAIEQeYAOgAMIAAoAgRB7QA6AA0gACgCBEH0ADoADiAAKAIEQSA6AA8gACgCBEEQOgAQIAAoAgRBADoAESAAKAIEQQA6ABIgACgCBEEAOgATIAAoAgRBAToAFCAAKAIEQQA6ABUgACgCBCABOgAWIAAoAgQgAUEIdToAFyAAKAIEIAI6ABggACgCBCACQQh1OgAZIAAoAgQgAkEQdToAGiAAKAIEIAJBGHU6ABsgACgCBCAFOgAcIAAoAgQgBUEIdToAHSAAKAIEIAVBEHU6AB4gACgCBCAFQRh1OgAfIAAoAgQgBjoAICAAKAIEIAZBCHU6ACEgACgCBCADOgAiIAAoAgQgA0EIdToAIyAAKAIEQeQAOgAkIAAoAgRB4QA6ACUgACgCBEH0ADoAJiAAKAIEQeEAOgAnIAAoAgQgBDoAKCAAKAIEIARBCHU6ACkgACgCBCAEQRB1OgAqIAAoAgQgBEEYdToAKwvKAQEGfyAAQez///8DSwRAQZAJQdAJQdYAQR4QAAALIABBEGoiBEH8////A0sEQEGQCUHQCUEhQR0QAAALIwAhAyMAQQRqIgIgBEETakFwcUEEayIEaiIFPwAiBkEQdEEPakFwcSIHSwRAIAYgBSAHa0H//wNqQYCAfHFBEHYiByAGIAdKG0AAQQBIBEAgB0AAQQBIBEAACwsLIAUkACADIAQ2AgAgAkEEayIDQQA2AgQgA0EANgIIIAMgATYCDCADIAA2AhAgAkEQagtsACAARQRAQQxBAxAFIQALIABBADYCACAAQQA2AgQgAEEANgIIIAFB/P///wMgAnZLBEBBoAhB0AhBE0E5EAAACyABIAJ0IgFBARAFIgJBACAB/AsAIAAgAjYCACAAIAI2AgQgACABNgIIIAALDgBBDEEFEAUgAEEAEAYLDgBBDEEEEAUgAEECEAYLBwBB/AkkAAsL2QEIAEGMCAsBLABBmAgLIwIAAAAcAAAASQBuAHYAYQBsAGkAZAAgAGwAZQBuAGcAdABoAEG8CAsBPABByAgLLQIAAAAmAAAAfgBsAGkAYgAvAGEAcgByAGEAeQBiAHUAZgBmAGUAcgAuAHQAcwBB/AgLATwAQYgJCy8CAAAAKAAAAEEAbABsAG8AYwBhAHQAaQBvAG4AIAB0AG8AbwAgAGwAYQByAGcAZQBBvAkLATwAQcgJCyUCAAAAHgAAAH4AbABpAGIALwByAHQALwBzAHQAdQBiAC4AdABz",import.meta.url),e=await fetch(r);if(!e.ok)return null;const t=await e.arrayBuffer(),{instance:s}=await WebAssembly.instantiate(t,{env:{abort:()=>{throw new Error("WASM abort")}}});return s.exports}catch{return null}}async function TX(){return rr?!0:(ig||(ig=SX()),rr=await ig,rr!==null)}function AX(r,e,t){for(let s=0;s<r.length;s++){let i=r[s];i=Math.max(-1,Math.min(1,i));const n=Math.round(i*32767),a=t+s*2;e[a]=n&255,e[a+1]=n>>8&255}}function jX(r,e,t,s){for(let i=0;i<r.length;i++){let n=Math.max(-1,Math.min(1,r[i])),a=Math.max(-1,Math.min(1,e[i]));const o=Math.round(n*32767),l=Math.round(a*32767),d=s+i*4;t[d]=o&255,t[d+1]=o>>8&255,t[d+2]=l&255,t[d+3]=l>>8&255}}function _X(r,e,t,s){for(let n=0;n<r.length;n++){let a=Math.max(-1,Math.min(1,r[n])),o=Math.max(-1,Math.min(1,e[n]));const l=Math.round(a*8388607),d=Math.round(o*8388607),u=s+n*6;t[u]=l&255,t[u+1]=l>>8&255,t[u+2]=l>>16&255,t[u+3]=d&255,t[u+4]=d>>8&255,t[u+5]=d>>16&255}}function EX(r,e,t,s,i){const n=s>>3,a=e*n,o=t*a,l=i*a,d=36+l;r[0]=82,r[1]=73,r[2]=70,r[3]=70,r[4]=d&255,r[5]=d>>8&255,r[6]=d>>16&255,r[7]=d>>24&255,r[8]=87,r[9]=65,r[10]=86,r[11]=69,r[12]=102,r[13]=109,r[14]=116,r[15]=32,r[16]=16,r[17]=0,r[18]=0,r[19]=0,r[20]=1,r[21]=0,r[22]=e&255,r[23]=e>>8&255,r[24]=t&255,r[25]=t>>8&255,r[26]=t>>16&255,r[27]=t>>24&255,r[28]=o&255,r[29]=o>>8&255,r[30]=o>>16&255,r[31]=o>>24&255,r[32]=a&255,r[33]=a>>8&255,r[34]=s&255,r[35]=s>>8&255,r[36]=100,r[37]=97,r[38]=116,r[39]=97,r[40]=l&255,r[41]=l>>8&255,r[42]=l>>16&255,r[43]=l>>24&255}class MX{useWasm;constructor(){this.useWasm=rr!==null}async ensureWasm(){return this.useWasm?!0:(await TX()&&(this.useWasm=!0),this.useWasm)}encodeWav16Mono(e,t,s){this.useWasm&&rr?rr.encodeWav16Mono(e,t,s):AX(e,t,s)}encodeWav16Stereo(e,t,s,i){this.useWasm&&rr?rr.encodeWav16Stereo(e,t,s,i):jX(e,t,s,i)}encodeWav24Stereo(e,t,s,i){this.useWasm&&rr?rr.encodeWav24Stereo(e,t,s,i):_X(e,t,s,i)}writeWavHeader(e,t,s,i,n){this.useWasm&&rr?rr.writeWavHeader(e,t,s,i,n):EX(e,t,s,i,n)}encodeFullWav(e,t,s=16){const i=e.length,n=e[0].length,a=s>>3,o=n*i*a,l=new Uint8Array(44+o);return this.writeWavHeader(l,i,t,s,n),i===1&&s===16?this.encodeWav16Mono(e[0],l,44):i===1&&s===24?this.encodeWav24Mono(e[0],l,44):s===16?this.encodeWav16Stereo(e[0],e[1],l,44):this.encodeWav24Stereo(e[0],e[1],l,44),l}encodeWav24Mono(e,t,s){for(let n=0;n<e.length;n++){let a=Math.max(-1,Math.min(1,e[n]));const o=Math.round(a*8388607),l=s+n*3;t[l]=o&255,t[l+1]=o>>8&255,t[l+2]=o>>16&255}}}let rg=null;function PX(){return rg||(rg=new MX),rg}class NX{mediabunny=null;initialized=!1;videoEngine=null;audioEngine=null;upscalingEngine=null;abortController=null;currentExport=null;exportWorker=null;async initialize(){if(!this.initialized){try{this.mediabunny=await hi(()=>import("./index2.js"),[])}catch(e){console.warn("[ExportEngine] MediaBunny not available:",e),this.mediabunny=null}try{this.videoEngine=vM(),this.audioEngine=kb(),this.videoEngine.isInitialized()||await this.videoEngine.initialize(),this.audioEngine.isInitialized()||await this.audioEngine.initialize(),this.initialized=!0}catch(e){throw new Error(`ExportEngine initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}}}async initializeGPUForExport(e,t){(!this.initialized||!this.videoEngine)&&await this.initialize();try{await this.videoEngine.initializeGPUCompositor(e,t);const s=this.videoEngine.getGPUCompositor();if(s){const i=s.getDevice();return i&&(this.upscalingEngine=DW(),await this.upscalingEngine.initialize({device:i})),!0}return!1}catch(s){throw new Error(`ExportEngine initialization failed: ${s instanceof Error?s.message:"Unknown error"}`)}}isMediaBunnyAvailable(){return this.mediabunny!==null}isWebCodecsSupported(){return typeof VideoEncoder<"u"&&typeof AudioEncoder<"u"}isInitialized(){return this.initialized}ensureInitialized(){if(!this.initialized||!this.mediabunny)throw new Error("ExportEngine not initialized. Call initialize() first.")}async findSupportedAudioCodec(e,t,s){const i=e.getSupportedAudioCodecs(),a=[t.bitrate*1e3,192e3,128e3,96e3].filter((l,d,u)=>u.indexOf(l)===d);for(const l of a){const d=await s(i);if(d&&await this.isAudioConfigSupported(d,l,t.channels,t.sampleRate))return{codec:d,bitrate:l}}for(const l of["aac","mp3","opus"])if(i.some(d=>String(d).toLowerCase().includes(l)||l==="aac"&&String(d).toLowerCase().includes("mp4a"))){for(const d of a)if(await this.isAudioConfigSupported(l,d,t.channels,t.sampleRate))return{codec:l,bitrate:d}}return{codec:await s(i)||"aac",bitrate:128e3}}async isAudioConfigSupported(e,t,s,i){if(typeof AudioEncoder>"u")return!0;try{let n;e==="aac"||e.includes("mp4a")?n="mp4a.40.2":e==="opus"?n="opus":e==="mp3"?n="mp3":n=e;const a={codec:n,sampleRate:i,numberOfChannels:s,bitrate:t};return(await AudioEncoder.isConfigSupported(a)).supported===!0}catch{return!1}}async*exportVideo(e,t={}){if(this.ensureInitialized(),!this.mediabunny){const h=this.isWebCodecsSupported()?"MediaBunny library failed to load. Please refresh the page and try again.":"Video export requires WebCodecs API which is not supported in your browser. Please use Chrome, Edge, or another WebCodecs-compatible browser.";return{success:!1,error:this.createError("UNSUPPORTED_CODEC",h,"preparing")}}const s={...Ms,...t,audioSettings:{...Ms.audioSettings,...t.audioSettings}};s.codec==="prores"&&(console.warn("[ExportEngine] ProRes encoding is not supported in browsers. Switching to H.264 high quality."),s.codec="h264",s.format="mp4",s.bitrate=25e3,s.quality=95);const i=s.width*s.height,n=s.codec==="vp9"||s.codec==="av1"||s.codec==="h265",a=n?1920*1080:3840*2160;if(i>a&&n){console.warn(`[ExportEngine] ${s.codec.toUpperCase()} at ${s.width}x${s.height} may cause browser instability. Reducing to 1080p for stability.`);const h=s.width/s.height;h>1?(s.width=1920,s.height=Math.round(1920/h)):(s.height=1920,s.width=Math.round(1920*h)),s.width=Math.round(s.width/2)*2,s.height=Math.round(s.height/2)*2}this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0},await this.initializeGPUForExport(s.width,s.height),this.videoEngine?.resetExportState();const{timeline:o}=e,l=this.calculateTimelineDuration(o);if(l<=0)return{success:!1,error:this.createError("MUXER_ERROR","Timeline is empty. Add clips before exporting.","preparing")};const d=Math.ceil(l*s.frameRate);let u=0;try{yield this.createProgress("preparing",0,d,0,0);const{Output:h,BufferTarget:p,Mp4OutputFormat:m,WebMOutputFormat:f,MovOutputFormat:g,VideoSampleSource:y,AudioSampleSource:x,VideoSample:v,AudioSample:b,getFirstEncodableVideoCodec:S,getFirstEncodableAudioCodec:k,QUALITY_MEDIUM:C}=this.mediabunny;let A;switch(s.format){case"webm":A=new f;break;case"mov":A=new g;break;case"mp4":default:A=new m({fastStart:"in-memory"});break}const T=new p,j=new h({format:A,target:T}),_=await S(A.getSupportedVideoCodecs(),{width:s.width,height:s.height});if(!_)throw this.createError("UNSUPPORTED_CODEC","No supported video codec found","preparing");const M=await this.findSupportedAudioCodec(A,s.audioSettings,k),E=new y({codec:_,bitrate:C,keyFrameInterval:s.keyframeInterval/s.frameRate,hardwareAcceleration:"prefer-hardware"}),D=new x({codec:M.codec,bitrate:M.bitrate});j.addVideoTrack(E),j.addAudioTrack(D),j.setMetadataTags({title:e.name,date:new Date}),await j.start();const B=s.codec==="vp9"||s.codec==="av1"||s.codec==="h265"?5:10,O=30,F=90;for(let P=0;P<d;P++){if(this.abortController.signal.aborted)throw this.createError("CANCELLED","Export cancelled by user","rendering");const W=P/s.frameRate,z=await this.videoEngine.renderFrame(e,W,s.width,s.height),G=this.shouldApplyUpscaling(e,s);let ce=z.image;if(G&&this.upscalingEngine?.isInitialized()){const te=await this.upscalingEngine.upscaleImageBitmap(ce,s.width,s.height,s.upscaling);ce.close(),ce=te}const ae=new v(ce,{timestamp:W,duration:1/s.frameRate});if(await E.add(ae),ae.close(),ce.close(),this.currentExport.framesRendered=P+1,(P+1)%B===0&&await new Promise(te=>setTimeout(te,0)),(P+1)%O===0&&await new Promise(te=>setTimeout(te,50)),(P+1)%F===0){this.videoEngine?.clearVideoElementCache();try{_c().clearFrameCache()}catch{}await new Promise(te=>setTimeout(te,100))}yield this.createProgress("rendering",(P+1)/d,d,P+1,u)}yield this.createProgress("encoding",.95,d,d,u);const I=await this.renderTimelineAudio(e,s);if(I){const P=b.fromAudioBuffer(I,0);for(const W of P)await D.add(W),W.close()}E.close(),D.close(),yield this.createProgress("muxing",.98,d,d,u),await j.finalize();const K=T.buffer;if(!K)throw this.createError("MUXER_ERROR","Output buffer is empty","muxing");const ee=new Blob([K],{type:this.getMimeType(s.format)});return u=ee.size,yield this.createProgress("complete",1,d,d,u),{success:!0,blob:ee,stats:this.calculateStats(d,u)}}catch(h){return h&&typeof h=="object"&&"code"in h?{success:!1,error:h}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",h instanceof Error?h.message:"Unknown error","rendering")}}finally{this.abortController=null,this.currentExport=null,this.videoEngine?.clearVideoElementCache()}}async*exportVideoWithWorker(e,t={},s){this.ensureInitialized();const i={...Ms,...t,audioSettings:{...Ms.audioSettings,...t.audioSettings}};i.codec==="prores"&&(console.warn("[ExportEngine] ProRes encoding is not supported in browsers. Switching to H.264 high quality."),i.codec="h264",i.format="mp4",i.bitrate=25e3,i.quality=95);const n=i.width*i.height,a=i.codec==="vp9"||i.codec==="av1"||i.codec==="h265",o=a?1920*1080:3840*2160;if(n>o&&a){console.warn(`[ExportEngine] ${i.codec.toUpperCase()} at ${i.width}x${i.height} may cause browser instability. Reducing to 1080p for stability.`);const p=i.width/i.height;p>1?(i.width=1920,i.height=Math.round(1920/p)):(i.height=1920,i.width=Math.round(1920*p)),i.width=Math.round(i.width/2)*2,i.height=Math.round(i.height/2)*2}this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0},await this.initializeGPUForExport(i.width,i.height)||console.warn("[ExportEngine] GPU acceleration not available for export"),this.videoEngine?.resetExportState();const{timeline:d}=e,u=this.calculateTimelineDuration(d);if(u<=0)return{success:!1,error:this.createError("MUXER_ERROR","Timeline is empty. Add clips before exporting.","preparing")};const h=Math.ceil(u*i.frameRate);try{yield this.createProgress("preparing",0,h,0,0);const p=await this.runWorkerExport(e,i,h,s);for await(const f of p.progressGenerator){if(this.abortController?.signal.aborted)throw this.exportWorker?.postMessage({type:"cancel"}),this.createError("CANCELLED","Export cancelled by user","rendering");yield f}return await p.resultPromise}catch(p){return p&&typeof p=="object"&&"code"in p?{success:!1,error:p}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",p instanceof Error?p.message:"Unknown error","rendering")}}finally{this.terminateWorker(),this.abortController=null,this.currentExport=null,this.videoEngine?.clearVideoElementCache()}}async runWorkerExport(e,t,s,i){let n=null,a=null,o=null;const l=new Promise(y=>{n=y}),d=new Promise((y,x)=>{a=y,o=x});let u=0;const h=i?1:3;let p=null;this.exportWorker=new Worker(new URL("/was/openreel_video/app/assets/export-worker-DYVPyHvu.js",import.meta.url),{type:"module"}),this.exportWorker.onmessage=async y=>{const{type:x,blob:v,error:b,chunk:S}=y.data;if(x==="ready"){n?.();return}if(x==="chunk"&&i&&S){try{await i.write({type:"write",position:S.position,data:S.data})}catch(k){console.error("[ExportEngine] Failed to write chunk:",k)}return}if(x==="frameProcessed"){u=Math.max(0,u-1),p&&(p(),p=null);return}if(x==="complete"){if(i)try{await i.close()}catch(C){console.error("[ExportEngine] Failed to close stream:",C)}const k=this.calculateStats(s,v?.size||0);a?.({success:!0,blob:v,stats:k});return}if(x==="error"){if(i)try{await i.abort()}catch{}o?.(new Error(b||"Worker encoding failed"));return}},this.exportWorker.onerror=y=>{o?.(new Error(y.message||"Worker error"))},this.exportWorker.postMessage({type:"init",settings:t,projectName:e.name,useStreamTarget:!!i}),await l;const m=this;async function f(){u<h||await new Promise(y=>{p=y})}async function*g(){for(let x=0;x<s;x++){if(m.abortController?.signal.aborted)return;await f();const v=x/t.frameRate,b=await m.videoEngine.renderFrame(e,v,t.width,t.height),S=m.shouldApplyUpscaling(e,t);let k=b.image;if(S&&m.upscalingEngine?.isInitialized()){const A=await m.upscalingEngine.upscaleImageBitmap(k,t.width,t.height,t.upscaling);k.close(),k=A}u++,m.exportWorker?.postMessage({type:"addFrame",frame:k,frameIndex:x,timestamp:v,totalFrames:s,settings:t},[k]),m.currentExport.framesRendered=x+1,yield m.createProgress("rendering",(x+1)/s,s,x+1,0);const C=i?10:30;if((x+1)%C===0){m.videoEngine?.clearVideoElementCache();try{_c().clearFrameCache()}catch{}i&&await new Promise(A=>setTimeout(A,50))}}for(;u>0;)await new Promise(x=>{u===0?x():p=x});yield m.createProgress("encoding",.95,s,s,0);const y=await m.renderTimelineAudioPublic(e);if(y){const x=[];for(let v=0;v<y.numberOfChannels;v++)x.push(y.getChannelData(v).slice());m.exportWorker?.postMessage({type:"addAudio",audioBuffer:{channels:x,sampleRate:y.sampleRate,length:y.length}})}yield m.createProgress("muxing",.98,s,s,0),m.exportWorker?.postMessage({type:"finalize"})}return{progressGenerator:g(),resultPromise:d}}async renderTimelineAudioPublic(e){return this.renderTimelineAudio(e)}isSimpleProject(e){const{timeline:t}=e,s=t.tracks.filter(h=>!h.hidden),i=s.filter(h=>h.type==="video"||h.type==="image"),n=s.filter(h=>h.type==="text"),a=s.filter(h=>h.type==="graphics"),o=s.filter(h=>h.type==="audio");if(n.length>0)return{simple:!1};if(a.length>0)return{simple:!1};if(o.length>0&&o.some(h=>h.clips.length>0))return{simple:!1};let l=0,d,u=!1;for(const h of i)for(const p of h.clips){if(l++,p.effects&&p.effects.length>0&&(u=!0),p.keyframes&&p.keyframes.length>0&&(u=!0),p.transform){const m=p.transform;(m.scale.x!==1||m.scale.y!==1||m.rotation!==0||m.position.x!==0||m.position.y!==0||m.opacity!==1)&&(u=!0)}l===1&&!u&&e.mediaLibrary.items.find(f=>f.id===p.mediaId)?.type==="video"&&(d={mediaId:p.mediaId,startTime:p.inPoint,endTime:p.outPoint,speed:p.speed||1})}return u?{simple:!1}:l===1&&d?{simple:!0,singleClip:d}:{simple:!1}}async*exportVideoWithFFmpeg(e,t={},s){this.initialized||await this.initialize();const i={...Ms,...t,audioSettings:{...Ms.audioSettings,...t.audioSettings}};i.codec==="prores"&&(i.codec="h264",i.format="mp4",i.bitrate=25e3,i.quality=95),this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0};const{timeline:n}=e,a=this.calculateTimelineDuration(n);if(a<=0)return{success:!1,error:this.createError("MUXER_ERROR","Timeline is empty. Add clips before exporting.","preparing")};const o=Math.ceil(a*i.frameRate),l=this.isSimpleProject(e);this.videoEngine?.resetExportState(),yield this.createProgress("preparing",0,o,0,0);const d=_c();d.isAvailable()||await d.initialize(),d.clearFrameCache(),d.disposeAllExportDecoders(),this.videoEngine?.clearVideoElementCache();try{const u=yM();if(await u.load(),l.simple&&l.singleClip){const b=e.mediaLibrary.items.find(S=>S.id===l.singleClip.mediaId);if(b?.blob){const S=b.metadata.width,k=b.metadata.height,C=e.timeline.tracks.flatMap(O=>O.clips).find(O=>O.mediaId===l.singleClip.mediaId),A=C&&(C.effects&&C.effects.length>0||C.transform&&(C.transform.scale.x!==1||C.transform.scale.y!==1||C.transform.rotation!==0||C.transform.position.x!==0||C.transform.position.y!==0||C.transform.opacity!==1)||C.keyframes&&C.keyframes.length>0),T=e.timeline.tracks.filter(O=>!O.hidden),j=T.length>1,_=T.some(O=>(O.type==="text"||O.type==="graphics")&&O.clips.length>0),M=l.singleClip.speed===1&&S===i.width&&k===i.height&&l.singleClip.startTime===0&&!A&&!j&&!_;let E=null;const D=O=>{E=O},R=u.exportVideoDirectly(b.blob,{startTime:l.singleClip.startTime,endTime:l.singleClip.endTime,width:i.width,height:i.height,frameRate:i.frameRate,format:i.format==="webm"?"webm":"mp4",videoBitrate:`${i.bitrate}k`,audioBitrate:`${i.audioSettings.bitrate}k`,speed:l.singleClip.speed,writableStream:s,useStreamCopy:M},D);for(;;){if(await new Promise(F=>setTimeout(F,100)),E!==null){const F=E;if(yield F,F.phase==="complete")break}if(await Promise.race([R.then(()=>!0),new Promise(F=>setTimeout(()=>F(!1),10))]))break}const B=await R;return{success:!0,blob:B||void 0,stats:this.calculateStats(o,B?.size||0)}}}await this.initializeGPUForExport(i.width,i.height);const h=new Set;for(const b of e.timeline.tracks)for(const S of b.clips)S.mediaId&&h.add(S.mediaId);for(const b of h){const S=e.mediaLibrary.items.find(k=>k.id===b);S?.blob&&S.type==="video"&&await d.createExportDecoder(b,S.blob,i.width)}const p=this;async function*m(){for(let b=0;b<o;b++){if(p.abortController?.signal.aborted)return;const S=b/i.frameRate,k=await p.videoEngine.renderFrame(e,S,i.width,i.height),C=p.shouldApplyUpscaling(e,i);let A=k.image;if(C&&p.upscalingEngine?.isInitialized()){const T=await p.upscalingEngine.upscaleImageBitmap(A,i.width,i.height,i.upscaling);A.close(),A=T}p.currentExport.framesRendered=b+1,(b+1)%60===0&&(p.videoEngine?.clearVideoElementCache(),d.clearFrameCache()),yield{image:A,frameIndex:b}}}let f=null;const g=b=>{f=b},y=await this.renderTimelineAudio(e,i),x=u.encodeFrameSequence(m(),{width:i.width,height:i.height,frameRate:i.frameRate,totalFrames:o,format:i.format==="webm"?"webm":"mp4",videoBitrate:`${i.bitrate}k`,audioBitrate:`${i.audioSettings.bitrate}k`,audioBuffer:y||void 0,writableStream:s},g);for(;;){if(await new Promise(S=>setTimeout(S,100)),f!==null){const S=f;if(yield S,S.phase==="complete")break}if(await Promise.race([x.then(()=>!0),new Promise(S=>setTimeout(()=>S(!1),10))]))break}const v=await x;return{success:!0,blob:v||void 0,stats:this.calculateStats(o,v?.size||0)}}catch(u){return u&&typeof u=="object"&&"code"in u?{success:!1,error:u}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",u instanceof Error?u.message:"Unknown error","rendering")}}finally{this.abortController=null,this.currentExport=null,this.videoEngine?.clearVideoElementCache(),d.disposeAllExportDecoders(),d.clearFrameCache()}}terminateWorker(){this.exportWorker&&(this.exportWorker.terminate(),this.exportWorker=null)}async*exportAudio(e,t={}){this.ensureInitialized();const s={...sg,...t};if(!this.mediabunny&&s.format!=="wav")return{success:!1,error:this.createError("UNSUPPORTED_CODEC",`Audio export to ${s.format} format requires MediaBunny. WAV format is available as a fallback.`,"preparing")};this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0};const{timeline:i}=e,n=this.calculateTimelineDuration(i);if(n<=0)return{success:!1,error:this.createError("AUDIO_ENCODE_FAILED","Timeline is empty. Add clips before exporting.","preparing")};try{yield this.createProgress("preparing",0,1,0,0);const a=await this.renderTimelineAudio(e,{audioSettings:s});if(!a)throw this.createError("AUDIO_ENCODE_FAILED","No audio to export","rendering");yield this.createProgress("encoding",.5,1,0,0);let o;return s.format==="wav"?o=this.encodeWav(a,s):o=await this.encodeAudioWithMediaBunny(a,s),yield this.createProgress("complete",1,1,1,o.size),{success:!0,blob:o,stats:{duration:Date.now()-this.currentExport.startTime,framesRendered:1,averageSpeed:1,fileSize:o.size,averageBitrate:o.size*8/n}}}catch(a){return a&&typeof a=="object"&&"code"in a?{success:!1,error:a}:{success:!1,error:this.createError("AUDIO_ENCODE_FAILED",a instanceof Error?a.message:"Unknown error","encoding")}}finally{this.abortController=null,this.currentExport=null}}async exportFrame(e,t,s={}){this.ensureInitialized();const i={...o2,width:e.settings.width,height:e.settings.height,...s};try{const n=await this.videoEngine.renderFrame(e,t,i.width,i.height);let a;if(i.width!==n.width||i.height!==n.height){a=new OffscreenCanvas(i.width,i.height);const d=a.getContext("2d");d&&d.drawImage(n.image,0,0,i.width,i.height),n.image.close()}else{a=new OffscreenCanvas(n.width,n.height);const d=a.getContext("2d");d&&d.drawImage(n.image,0,0),n.image.close()}const o=this.getImageMimeType(i.format),l=await a.convertToBlob({type:o,quality:i.quality/100});return{success:!0,blob:l,stats:{duration:0,framesRendered:1,averageSpeed:0,fileSize:l.size,averageBitrate:0}}}catch(n){return{success:!1,error:this.createError("FRAME_ENCODE_FAILED",n instanceof Error?n.message:"Unknown error","rendering")}}}async exportImage(e,t={}){return this.exportFrame(e,0,t)}async*exportImageSequence(e,t={}){this.ensureInitialized();const{timeline:s}=e,i=e.settings.frameRate,n=Math.ceil(s.duration*i),a={...o2,width:e.settings.width,height:e.settings.height,startFrame:0,endFrame:n-1,namingPattern:"frame_{0000}",...t};this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0};const o=a.endFrame-a.startFrame+1,l=[];try{yield this.createProgress("preparing",0,o,0,0);for(let u=0;u<o;u++){if(this.abortController.signal.aborted)throw this.createError("CANCELLED","Export cancelled by user","rendering");const p=(a.startFrame+u)/i,m=await this.exportFrame(e,p,a);m.success&&m.blob&&l.push(m.blob),this.currentExport.framesRendered=u+1,yield this.createProgress("rendering",(u+1)/o,o,u+1,l.reduce((f,g)=>f+g.size,0))}yield this.createProgress("complete",1,o,o,0);const d=l.reduce((u,h)=>u+h.size,0);return{success:!0,blob:l[0],stats:this.calculateStats(o,d)}}catch(d){return d&&typeof d=="object"&&"code"in d?{success:!1,error:d}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",d instanceof Error?d.message:"Unknown error","rendering")}}finally{this.abortController=null,this.currentExport=null}}cancel(){this.abortController&&this.abortController.abort()}getPresets(){return[{id:"4k-master",name:"4K Master Quality",description:"Maximum quality 4K for professional delivery",category:"broadcast",settings:{...Ms,...Un["4k-high"],codec:"h265",quality:95}},{id:"4k-prores-hq",name:"4K ProRes HQ",description:"Professional 4K ProRes for editing/mastering",category:"broadcast",settings:{...Ms,width:3840,height:2160,frameRate:30,format:"mov",codec:"prores",proresProfile:"hq",bitrate:88e4,quality:100}},{id:"4k-prores-4444",name:"4K ProRes 4444",description:"Highest quality ProRes with alpha channel support",category:"broadcast",settings:{...Ms,width:3840,height:2160,frameRate:30,format:"mov",codec:"prores",proresProfile:"4444",bitrate:132e4,quality:100}},{id:"youtube-4k",name:"YouTube 4K",description:"4K UHD optimized for YouTube",category:"social",settings:{...Ms,...Un["4k"],codec:"h264"}},{id:"youtube-4k-60",name:"YouTube 4K 60fps",description:"4K 60fps for YouTube gaming/motion",category:"social",settings:{...Ms,...Un["4k-60"],codec:"h264"}},{id:"youtube-1080p-high",name:"YouTube 1080p High",description:"High bitrate 1080p for YouTube",category:"social",settings:{...Ms,...Un["1080p-high"],codec:"h264"}},{id:"youtube-1080p",name:"YouTube 1080p",description:"Standard 1080p for YouTube",category:"social",settings:{...Ms,...Un["1080p"],codec:"h264"}},{id:"tiktok-1080p",name:"TikTok/Reels",description:"Vertical 1080x1920 for TikTok/Reels",category:"social",settings:{...Ms,width:1080,height:1920,bitrate:15e3,frameRate:30,codec:"h264"}},{id:"twitter",name:"Twitter/X",description:"Optimized for Twitter",category:"social",settings:{...Ms,...Un["720p"],codec:"h264"}},{id:"web-vp9",name:"Web (VP9)",description:"WebM VP9 for web embedding (720p for stability)",category:"web",settings:{...Ms,format:"webm",codec:"vp9",...Un["720p"]}},{id:"archive-4k",name:"Archive 4K",description:"High quality 4K for archival",category:"archive",settings:{...Ms,...Un["4k-high"],codec:"h265"}},{id:"archive-prores",name:"Archive ProRes",description:"Lossless quality ProRes for archival",category:"archive",settings:{...Ms,width:1920,height:1080,format:"mov",codec:"prores",proresProfile:"hq",bitrate:22e4,quality:100}},{id:"audio-mp3",name:"MP3 Audio",description:"MP3 320kbps",category:"custom",settings:sg},{id:"audio-wav",name:"WAV Audio",description:"Uncompressed WAV 24-bit",category:"archive",settings:{...sg,format:"wav",bitDepth:24,sampleRate:48e3}}]}createPreset(e,t){return{id:`custom-${Date.now()}`,name:e,description:"Custom preset",settings:t,category:"custom"}}estimateFileSize(e,t){const s=e.timeline.duration;if("codec"in t){const i=t.bitrate*1e3,n=t.audioSettings.bitrate*1e3;return Math.ceil((i+n)*s/8)}else return t.format==="wav"?Math.ceil(s*t.sampleRate*t.channels*(t.bitDepth/8)):Math.ceil(t.bitrate*1e3*s/8)}estimateExportTime(e,t){const s=e.timeline.duration;if("codec"in t){const n=t.width*t.height/(1920*1080),a=t.codec==="h265"||t.codec==="av1"?2:1;return s*n*a*.5}else return s*.1}async renderTimelineAudio(e,t){const{timeline:s}=e;if(!s.tracks.some(o=>(o.type==="audio"||o.type==="video")&&!o.muted&&o.clips.length>0))return null;const n=this.calculateTimelineDuration(s);return n<=0?null:(await this.audioEngine.renderAudio(e,0,n)).buffer}async encodeAudioWithMediaBunny(e,t){const{Output:s,BufferTarget:i,Mp3OutputFormat:n,AudioSampleSource:a,AudioSample:o,getFirstEncodableAudioCodec:l}=this.mediabunny;let d;switch(t.format){case"mp3":d=new n;break;case"aac":case"flac":case"ogg":default:return this.encodeWav(e,t)}const u=new i,h=new s({format:d,target:u}),p=await l(d.getSupportedAudioCodecs()),m=new a({codec:p||"mp3",bitrate:t.bitrate*1e3});h.addAudioTrack(m),await h.start();const f=o.fromAudioBuffer(e,0);for(const y of f)await m.add(y),y.close();m.close(),await h.finalize();const g=u.buffer;if(!g)throw new Error("Audio encoding failed");return new Blob([g],{type:this.getAudioMimeType(t.format)})}encodeWav(e,t){const s=Math.min(e.numberOfChannels,t.channels),i=t.sampleRate,n=t.bitDepth;if(n===32)return this.encodeWav32Float(e,s,i);const a=PX(),o=[];for(let d=0;d<s;d++)o.push(e.getChannelData(d));const l=a.encodeFullWav(o,i,n);return new Blob([l.buffer],{type:"audio/wav"})}encodeWav32Float(e,t,s){const a=t*4,o=s*a,l=e.length*a,u=44+l,h=new ArrayBuffer(u),p=new DataView(h);this.writeString(p,0,"RIFF"),p.setUint32(4,u-8,!0),this.writeString(p,8,"WAVE"),this.writeString(p,12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,3,!0),p.setUint16(22,t,!0),p.setUint32(24,s,!0),p.setUint32(28,o,!0),p.setUint16(32,a,!0),p.setUint16(34,32,!0),this.writeString(p,36,"data"),p.setUint32(40,l,!0);let m=44;for(let f=0;f<e.length;f++)for(let g=0;g<t;g++)p.setFloat32(m,e.getChannelData(g)[f],!0),m+=4;return new Blob([h],{type:"audio/wav"})}writeString(e,t,s){for(let i=0;i<s.length;i++)e.setUint8(t+i,s.charCodeAt(i))}getMimeType(e){switch(e){case"webm":return"video/webm";case"mov":return"video/quicktime";case"mp4":default:return"video/mp4"}}getAudioMimeType(e){switch(e){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"aac":return"audio/aac";case"flac":return"audio/flac";case"ogg":return"audio/ogg";default:return"audio/mpeg"}}getImageMimeType(e){switch(e){case"png":return"image/png";case"webp":return"image/webp";case"jpg":default:return"image/jpeg"}}createProgress(e,t,s,i,n){const a=this.currentExport?(Date.now()-this.currentExport.startTime)/1e3:0,o=a>0?i/a:0,l=s-i,d=o>0?l/o:0;return{phase:e,progress:t,estimatedTimeRemaining:d,currentFrame:i,totalFrames:s,bytesWritten:n,currentBitrate:a>0?n*8/a:0}}createError(e,t,s){return{code:e,message:t,phase:s,recoverable:e==="CANCELLED"}}calculateStats(e,t){const s=this.currentExport?Date.now()-this.currentExport.startTime:0,i=this.currentExport?.framesRendered||e;return{duration:s,framesRendered:i,averageSpeed:s>0?i/s*1e3:0,fileSize:t,averageBitrate:s>0?t*8e3/s:0}}calculateTimelineDuration(e){let t=0;for(const o of e.tracks)for(const l of o.clips){const d=l.outPoint-l.inPoint,u=l.startTime+d;u>t&&(t=u)}const s=bo.getAllTextClips();for(const o of s){const l=o.startTime+o.duration;l>t&&(t=l)}const i=Sr.getAllShapeClips();for(const o of i){const l=o.startTime+o.duration;l>t&&(t=l)}const n=Sr.getAllSVGClips();for(const o of n){const l=o.startTime+o.duration;l>t&&(t=l)}const a=Sr.getAllStickerClips();for(const o of a){const l=o.startTime+o.duration;l>t&&(t=l)}if(e.subtitles)for(const o of e.subtitles)o.endTime>t&&(t=o.endTime);return t}shouldApplyUpscaling(e,t){if(!t.upscaling?.enabled)return!1;const s=e.settings.width,i=e.settings.height,n=t.width,a=t.height;return n>s||a>i}dispose(){this.cancel(),this.terminateWorker(),this.mediabunny=null,this.videoEngine=null,this.audioEngine=null,this.upscalingEngine&&(this.upscalingEngine.clearTexturePool(),this.upscalingEngine=null),this.initialized=!1}}let ng=null;function ld(){return ng||(ng=new NX),ng}function ag(r,e){const t=URL.createObjectURL(r),s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}class VP{videoEffectsEngine=null;colorGradingEngine=null;initialized=!1;clipEffects=new Map;clipColorGrading=new Map;renderer=null;effectsChangeCallbacks=[];pendingReRenders=new Map;async initialize(e=1920,t=1080){if(!this.initialized)try{this.videoEffectsEngine=new Su({width:e,height:t,useGPU:!0,preferWebGPU:qc()}),await this.videoEffectsEngine.initialize(),this.colorGradingEngine=new mW(e,t),this.colorGradingEngine.initialize(),this.initialized=!0}catch(s){const i=s instanceof Error?s.message:"Unknown initialization error";throw new Error(`EffectsBridge initialization failed: ${i}`)}}isInitialized(){return this.initialized}applyVideoEffect(e,t,s={}){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const i=this.clipEffects.get(e)||[],n={id:dt(),type:t,enabled:!0,params:{...this.getDefaultParams(t),...s},order:i.length};return i.push(n),this.clipEffects.set(e,i),{success:!0,effectId:n.id}}removeVideoEffect(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipEffects.get(e);if(!s)return{success:!1,error:"No effects found for clip"};const i=s.findIndex(n=>n.id===t);return i===-1?{success:!1,error:"Effect not found"}:(s.splice(i,1),s.forEach((n,a)=>{n.order=a}),this.clipEffects.set(e,s),{success:!0})}updateVideoEffect(e,t,s){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const i=this.clipEffects.get(e);if(!i)return{success:!1,error:"No effects found for clip"};const n=i.find(a=>a.id===t);return n?(n.params={...n.params,...s},this.notifyEffectsChanged(e),{success:!0,effectId:t}):{success:!1,error:"Effect not found"}}reorderEffects(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipEffects.get(e);if(!s)return{success:!1,error:"No effects found for clip"};const i=new Map(s.map(a=>[a.id,a]));for(const a of t)if(!i.has(a))return{success:!1,error:`Effect ${a} not found`};const n=[];return t.forEach((a,o)=>{const l=i.get(a);l.order=o,n.push(l)}),this.clipEffects.set(e,n),{success:!0}}getEffects(e){return[...this.clipEffects.get(e)||[]].sort((s,i)=>s.order-i.order)}getEffect(e,t){return this.clipEffects.get(e)?.find(i=>i.id===t)}toggleEffect(e,t,s){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const i=this.clipEffects.get(e);if(!i)return{success:!1,error:"No effects found for clip"};const n=i.find(a=>a.id===t);return n?(n.enabled=s,{success:!0,effectId:t}):{success:!1,error:"Effect not found"}}resetEffect(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipEffects.get(e);if(!s)return{success:!1,error:"No effects found for clip"};const i=s.find(n=>n.id===t);return i?(i.params=this.getDefaultParams(i.type),{success:!0,effectId:t}):{success:!1,error:"Effect not found"}}async processEffects(e,t){if(!this.initialized||!this.videoEffectsEngine)return{image:t,processingTime:0};const s=this.getEffects(e);if(s.length===0)return{image:t,processingTime:0};const i=s.filter(n=>n.enabled);if(i.length===0)return{image:t,processingTime:0};try{const n=i.map(o=>({id:o.id,type:o.type,enabled:o.enabled,params:o.params})),a=await this.videoEffectsEngine.applyEffects(t,n);return!a.image||a.image.width===0||a.image.height===0?(console.warn("[EffectsBridge] Effects processing returned invalid image"),{image:t,processingTime:a.processingTime}):{image:a.image,processingTime:a.processingTime}}catch(n){return console.error("[EffectsBridge] Effects processing failed:",n),{image:t,processingTime:0}}}getDefaultParams(e){switch(e){case"brightness":return{value:0};case"contrast":return{value:1};case"saturation":return{value:1};case"hue":return{rotation:0};case"blur":return{radius:0,type:"gaussian"};case"sharpen":return{amount:0,radius:1,threshold:0};case"vignette":return{amount:0,midpoint:.5,roundness:.5,feather:.3};case"grain":return{amount:0,size:1,roughness:.5,colored:!1};case"temperature":return{value:0};case"tint":return{value:0};case"tonal":return{shadows:0,midtones:0,highlights:0};case"chromaKey":return{keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5};case"shadow":return{offsetX:5,offsetY:5,blur:10,opacity:.8,color:"#000000"};case"glow":return{radius:10,intensity:1,color:"#ffffff"};case"motion-blur":return{angle:0,distance:20};case"radial-blur":return{amount:20,centerX:50,centerY:50};case"chromatic-aberration":return{amount:5,angle:0};default:return{}}}applyColorWheels(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.colorWheels=t,this.clipColorGrading.set(e,s),{success:!0}}applyCurves(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.curves=t,this.clipColorGrading.set(e,s),{success:!0}}applyLUT(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.lut=t,this.clipColorGrading.set(e,s),{success:!0}}applyHSL(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.hsl=t,this.clipColorGrading.set(e,s),{success:!0}}getColorGrading(e){return this.clipColorGrading.get(e)||{}}resetColorGrading(e){return this.initialized?(this.clipColorGrading.set(e,{colorWheels:{...J0},curves:{...Z0},hsl:{...ey}}),{success:!0}):{success:!1,error:"EffectsBridge not initialized"}}async processColorGrading(e,t){if(!this.initialized||!this.colorGradingEngine)return{image:t,processingTime:0};const s=this.getColorGrading(e);let i=t,n=0;if(s.colorWheels){const a=await this.colorGradingEngine.applyColorWheels(i,s.colorWheels);i=a.image,n+=a.processingTime}if(s.curves){const a=await this.colorGradingEngine.applyCurves(i,s.curves);i=a.image,n+=a.processingTime}if(s.lut){const a=await this.colorGradingEngine.applyLUT(i,s.lut);i=a.image,n+=a.processingTime}if(s.hsl){const a=await this.colorGradingEngine.applyHSL(i,s.hsl);i=a.image,n+=a.processingTime}return{image:i,processingTime:n}}async generateWaveform(e){return!this.initialized||!this.colorGradingEngine?null:this.colorGradingEngine.generateWaveform(e)}async generateVectorscope(e,t=256){return!this.initialized||!this.colorGradingEngine?null:this.colorGradingEngine.generateVectorscope(e,t)}async generateHistogram(e){return!this.initialized||!this.colorGradingEngine?null:this.colorGradingEngine.generateHistogram(e)}serializeEffects(e){const t=this.getEffects(e),s=this.getColorGrading(e),i=t.map(a=>({id:a.id,type:a.type,enabled:a.enabled,params:a.params,order:a.order})),n={};return s.colorWheels&&(n.colorWheels=s.colorWheels),s.curves&&(n.curves=s.curves),s.lut&&(n.lut={data:Array.from(s.lut.data),size:s.lut.size,intensity:s.lut.intensity}),s.hsl&&(n.hsl=s.hsl),{effects:i,colorGrading:n}}deserializeEffects(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=t.effects.map(n=>({id:n.id,type:n.type,enabled:n.enabled,params:n.params,order:n.order}));this.clipEffects.set(e,s);const i={};return t.colorGrading.colorWheels&&(i.colorWheels=t.colorGrading.colorWheels),t.colorGrading.curves&&(i.curves=t.colorGrading.curves),t.colorGrading.lut&&(i.lut={data:new Uint8Array(t.colorGrading.lut.data),size:t.colorGrading.lut.size,intensity:t.colorGrading.lut.intensity}),t.colorGrading.hsl&&(i.hsl=t.colorGrading.hsl),this.clipColorGrading.set(e,i),{success:!0}}clearEffects(e){this.clipEffects.delete(e),this.clipColorGrading.delete(e)}onEffectsChange(e){this.effectsChangeCallbacks.push(e)}offEffectsChange(e){const t=this.effectsChangeCallbacks.indexOf(e);t!==-1&&this.effectsChangeCallbacks.splice(t,1)}notifyEffectsChanged(e){const t=this.pendingReRenders.get(e);t&&clearTimeout(t);const s=setTimeout(()=>{this.pendingReRenders.delete(e);const n=this.getEffects(e).map(a=>({id:a.id,type:a.type,enabled:a.enabled,params:a.params}));for(const a of this.effectsChangeCallbacks)a(e,n)},16);this.pendingReRenders.set(e,s)}getRendererType(){return this.videoEffectsEngine&&typeof this.videoEffectsEngine.getRendererType=="function"?this.videoEffectsEngine.getRendererType():"none"}isUsingWebGPU(){return this.videoEffectsEngine&&typeof this.videoEffectsEngine.isUsingWebGPU=="function"?this.videoEffectsEngine.isUsingWebGPU():!1}dispose(){for(const e of this.pendingReRenders.values())clearTimeout(e);this.pendingReRenders.clear(),this.effectsChangeCallbacks=[],this.renderer&&(this.renderer.destroy(),this.renderer=null),this.colorGradingEngine&&this.colorGradingEngine.dispose(),this.clipEffects.clear(),this.clipColorGrading.clear(),this.videoEffectsEngine=null,this.colorGradingEngine=null,this.initialized=!1}}let Ci=null,ch=null,UP=1920,GP=1080;function vr(){return Ci||(Ci=new VP),Ci.isInitialized()||Ci.initialize(UP,GP).catch(r=>{console.error("[EffectsBridge] Background initialization failed:",r)}),Ci}async function RX(r=1920,e=1080){return Ci?.isInitialized()?Ci:ch||(ch=(async()=>(Ci||(Ci=new VP),await Ci.initialize(r,e),UP=r,GP=e,Ci))(),ch)}async function IX(r=1920,e=1080){return RX(r,e)}function DX(){Ci&&(Ci.dispose(),Ci=null)}const FX={interval:3e4,maxSlots:3,enabled:!0,debounceTime:2e3},BX="openreel-autosave",LX=1,Ji="autosaves";class OX{config;db=null;intervalId=null;debounceTimeoutId=null;lastSavedHash="";currentSlot=0;listeners=new Map;pendingProject=null;isDirty=!1;constructor(e={}){this.config={...FX,...e}}async initialize(){try{this.db=await this.openDatabase()}catch(e){console.error("[AutoSave] Failed to initialize:",e),this.emit("error",{error:e,message:"Failed to initialize auto-save"})}}openDatabase(){return new Promise((e,t)=>{if(typeof indexedDB>"u"){t(new Error("IndexedDB not supported"));return}const s=indexedDB.open(BX,LX);s.onerror=()=>{t(new Error(`Failed to open auto-save database: ${s.error?.message}`))},s.onsuccess=()=>{e(s.result)},s.onupgradeneeded=i=>{const n=i.target.result;if(!n.objectStoreNames.contains(Ji)){const a=n.createObjectStore(Ji,{keyPath:"id"});a.createIndex("projectId","projectId",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("slot","slot",{unique:!1})}}})}start(e){this.config.enabled&&(this.stop(),this.pendingProject=e(),this.saveIfDirty(),this.intervalId=setInterval(()=>{this.pendingProject=e(),this.saveIfDirty()},this.config.interval))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.debounceTimeoutId&&(clearTimeout(this.debounceTimeoutId),this.debounceTimeoutId=null)}markDirty(){this.isDirty=!0,this.debounceTimeoutId&&clearTimeout(this.debounceTimeoutId),this.debounceTimeoutId=setTimeout(()=>{this.saveIfDirty()},this.config.debounceTime)}async saveIfDirty(){if(!this.pendingProject||!this.isDirty)return;const e=this.pendingProject,t=this.computeHash(e);if(t!==this.lastSavedHash)try{await this.save(e),this.lastSavedHash=t,this.isDirty=!1}catch(s){console.error("[AutoSave] Save failed:",s),this.emit("error",{error:s,message:"Auto-save failed"})}}async save(e){if(!this.db)throw new Error("Auto-save database not initialized");const t={id:`${e.id}-slot-${this.currentSlot}`,projectId:e.id,projectName:e.name,timestamp:Date.now(),slot:this.currentSlot,data:JSON.stringify(e)};await this.saveRecord(t),this.currentSlot=(this.currentSlot+1)%this.config.maxSlots,await this.cleanupOldSaves(e.id),this.emit("saved",{projectId:e.id,timestamp:t.timestamp,slot:t.slot})}saveRecord(e){return new Promise((t,s)=>{if(!this.db){s(new Error("Database not initialized"));return}const a=this.db.transaction(Ji,"readwrite").objectStore(Ji).put(e);a.onsuccess=()=>t(),a.onerror=()=>s(new Error(`Failed to save: ${a.error?.message}`))})}async cleanupOldSaves(e){if(!this.db)return;const s=(await this.getAllSaves()).filter(i=>i.projectId===e);if(s.length>this.config.maxSlots){const i=s.sort((n,a)=>a.timestamp-n.timestamp).slice(this.config.maxSlots);for(const n of i)await this.deleteRecord(n.id)}}deleteRecord(e){return new Promise((t,s)=>{if(!this.db){s(new Error("Database not initialized"));return}const a=this.db.transaction(Ji,"readwrite").objectStore(Ji).delete(e);a.onsuccess=()=>t(),a.onerror=()=>s(new Error(`Failed to delete: ${a.error?.message}`))})}getAllSaves(){return new Promise((e,t)=>{if(!this.db){t(new Error("Database not initialized"));return}const n=this.db.transaction(Ji,"readonly").objectStore(Ji).getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>t(new Error(`Failed to get saves: ${n.error?.message}`))})}async checkForRecovery(e){this.db||await this.initialize();try{const t=await this.getAllSaves();let s=t;e&&(s=t.filter(n=>n.projectId===e));const i=s.sort((n,a)=>a.timestamp-n.timestamp).map(n=>({id:n.id,projectId:n.projectId,projectName:n.projectName,timestamp:n.timestamp,slot:n.slot,isRecovery:!0}));return i.length>0&&this.emit("recoveryAvailable",{saves:i}),i}catch(t){return console.error("[AutoSave] Failed to check for recovery:",t),[]}}async recover(e){this.db||await this.initialize();try{const t=await this.getRecord(e);if(!t)return console.warn(`[AutoSave] No save found with id: ${e}`),null;const s=JSON.parse(t.data);return this.emit("restored",{project:s,timestamp:t.timestamp}),s}catch(t){return console.error("[AutoSave] Recovery failed:",t),this.emit("error",{error:t,message:"Failed to recover project"}),null}}getRecord(e){return new Promise((t,s)=>{if(!this.db){s(new Error("Database not initialized"));return}const a=this.db.transaction(Ji,"readonly").objectStore(Ji).get(e);a.onsuccess=()=>t(a.result||null),a.onerror=()=>s(new Error(`Failed to get record: ${a.error?.message}`))})}async getMostRecentSave(e){const t=await this.checkForRecovery(e);return t.length>0?t[0]:null}async clearProjectSaves(e){if(!this.db)return;const s=(await this.getAllSaves()).filter(i=>i.projectId===e);for(const i of s)await this.deleteRecord(i.id)}async clearAllSaves(){if(this.db)return new Promise((e,t)=>{const n=this.db.transaction(Ji,"readwrite").objectStore(Ji).clear();n.onsuccess=()=>{e()},n.onerror=()=>t(new Error(`Failed to clear: ${n.error?.message}`))})}computeHash(e){const t=JSON.stringify({id:e.id,modifiedAt:e.modifiedAt,trackCount:e.timeline.tracks.length,clipCount:e.timeline.tracks.reduce((i,n)=>i+n.clips.length,0),mediaCount:e.mediaLibrary.items.length});let s=0;for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);s=(s<<5)-s+n,s=s&s}return s.toString(36)}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}emit(e,t){this.listeners.get(e)?.forEach(s=>{try{s(t)}catch(i){console.error("[AutoSave] Event callback error:",i)}})}async forceSave(e){this.pendingProject=e,this.isDirty=!0,await this.saveIfDirty()}destroy(){this.stop(),this.db&&(this.db.close(),this.db=null),this.listeners.clear()}}const ar=new OX;async function $X(){await ar.initialize()}async function zX(r){return ar.checkForRecovery(r)}const Uh=new Map;async function cn(r,e){return Uh.has(r)||Uh.set(r,Promise.resolve(e())),Uh.get(r)}const Ty={WARNING_LINEAR:Math.pow(10,-6/20),CLIPPING_LINEAR:1};function Ay(r){return{isWarning:r>Ty.WARNING_LINEAR,isClipping:r>=Ty.CLIPPING_LINEAR}}const lh={peaks:new Map,rms:new Map,masterPeak:0,masterRms:0,isClipping:!1,isWarning:!1},c2={currentTime:0,duration:0,state:"stopped",fps:0,droppedFrames:0,audioBufferHealth:1,videoBufferHealth:1,avgFrameRenderTime:0};bo.initialize(1920,1080);const me=Ta()(Op((r,e)=>({initialized:!1,initializing:!1,initError:null,videoEngine:null,audioEngine:null,playbackController:null,titleEngine:bo,subtitleEngine:null,graphicsEngine:Sr,photoEngine:null,exportEngine:null,speechToTextEngine:null,templateEngine:null,soundLibraryEngine:null,chromaKeyEngine:null,multiCamEngine:null,maskEngine:null,nestedSequenceEngine:null,adjustmentLayerEngine:null,currentFrame:null,playbackStats:c2,audioLevels:lh,initialize:async()=>{const t=e();if(!(t.initialized||t.initializing)){r({initializing:!0,initError:null});try{const s=vM(),i=kb(),n=oY(),a=XY(),o=ld();bo.initialize(1920,1080),await s.initialize(),await i.initialize(),await n.initialize(s,i),await o.initialize(),r({initialized:!0,initializing:!1,initError:null,videoEngine:s,audioEngine:i,playbackController:n,titleEngine:bo,graphicsEngine:Sr,photoEngine:a,exportEngine:o})}catch(s){const i=s instanceof Error?s.message:"Unknown initialization error";throw r({initialized:!1,initializing:!1,initError:i}),s}}},dispose:()=>{const t=e();t.videoEngine?.dispose(),t.audioEngine?.dispose(),t.playbackController?.dispose(),t.photoEngine?.dispose(),t.exportEngine?.dispose(),t.graphicsEngine?.clearCache(),t.currentFrame&&t.currentFrame.image.close(),Uh.clear(),r({initialized:!1,initializing:!1,initError:null,videoEngine:null,audioEngine:null,playbackController:null,titleEngine:null,subtitleEngine:null,graphicsEngine:null,photoEngine:null,exportEngine:null,speechToTextEngine:null,soundLibraryEngine:null,chromaKeyEngine:null,multiCamEngine:null,maskEngine:null,nestedSequenceEngine:null,adjustmentLayerEngine:null,currentFrame:null,playbackStats:c2,audioLevels:lh})},renderFrame:async t=>{const{videoEngine:s,initialized:i}=e();return null},getAudioLevels:()=>{const{audioLevels:t}=e();return t||lh},updateAudioLevels:t=>{const s=new Map,i=new Map;let n=0,a=0,o=!1,l=!1;for(const[u,h]of t){s.set(u,h.peak),i.set(u,h.rms),n=Math.max(n,h.peak),a=Math.max(a,h.rms);const p=Ay(h.peak);p.isClipping&&(o=!0),p.isWarning&&(l=!0)}const d=Ay(n);d.isClipping&&(o=!0),d.isWarning&&(l=!0),r({audioLevels:{peaks:s,rms:i,masterPeak:n,masterRms:a,isClipping:o,isWarning:l}})},resetAudioLevels:()=>{r({audioLevels:lh})},getVideoEngine:()=>e().videoEngine,getAudioEngine:()=>e().audioEngine,getPlaybackController:()=>e().playbackController,getTitleEngine:()=>e().titleEngine,getSubtitleEngine:()=>cn("subtitle",()=>new dY),getGraphicsEngine:()=>e().graphicsEngine,getPhotoEngine:()=>e().photoEngine,getExportEngine:()=>e().exportEngine,getSpeechToTextEngine:()=>cn("speechToText",()=>new Sb),getTemplateEngine:()=>cn("template",()=>new JY),getSoundLibraryEngine:()=>cn("soundLibrary",()=>new qW),getChromaKeyEngine:()=>cn("chromaKey",()=>new kM({width:1920,height:1080})),getMultiCamEngine:()=>cn("multiCam",()=>new TW),getMaskEngine:()=>cn("mask",()=>new bW({width:1920,height:1080})),getNestedSequenceEngine:()=>cn("nestedSequence",()=>new s9),getAdjustmentLayerEngine:()=>cn("adjustmentLayer",()=>new jW)}))),VX=Object.freeze(Object.defineProperty({__proto__:null,AUDIO_THRESHOLDS:Ty,detectThresholds:Ay,useEngineStore:me},Symbol.toStringTag,{value:"Module"}));class UX{mediaImportService=null;waveformGenerator=null;initialized=!1;async initialize(){if(!this.initialized)try{this.mediaImportService=await f9(),this.waveformGenerator=x9(),this.initialized=!0}catch(e){const t=e instanceof Error?e.message:"Unknown initialization error";throw new Error(`MediaBridge initialization failed: ${t}`)}}isInitialized(){return this.initialized}async importFile(e,t=!0,s=!1){if(!this.initialized||!this.mediaImportService)return{success:!1,error:"MediaBridge not initialized",hasWaveform:!1};const i=this.captureProjectState();try{const n=await this.mediaImportService.importMedia(e,{generateThumbnails:!s,thumbnailCount:10,thumbnailWidth:160,generateWaveform:t&&!s,waveformSamplesPerSecond:100,useFallback:!0,quickMode:s});if(!n.success||!n.media)return{success:!1,error:n.error||"Import failed",warnings:n.warnings,hasWaveform:!1};const a=n.media.metadata;return this.validateMetadata(a)?{success:!0,media:n.media,warnings:n.warnings,hasWaveform:n.media.waveformData!==null}:{success:!1,error:"Failed to extract valid metadata from media file",hasWaveform:!1}}catch(n){return this.restoreProjectState(i),{success:!1,error:n instanceof Error?n.message:"Unknown import error",hasWaveform:!1}}}async generateThumbnailsForMedia(e,t){if(!this.initialized||!this.mediaImportService)return[];try{return(await this.mediaImportService.generateThumbnailsForMedia(e,t,{count:10,width:160})).map(i=>({timestamp:i.timestamp,dataUrl:i.dataUrl||""})).filter(i=>i.dataUrl)}catch{return[]}}async importFiles(e,t){if(!this.initialized||!this.mediaImportService)return e.map(()=>({success:!1,error:"MediaBridge not initialized",hasWaveform:!1}));const s=[];for(let i=0;i<e.length;i++){const n=e[i];t?.(i,e.length,n.name);const a=await this.importFile(n);s.push(a)}return t?.(e.length,e.length,"Complete"),s}async generateWaveform(e,t,s=100){if(!this.initialized||!this.waveformGenerator)return null;try{const i=await this.waveformGenerator.generateWaveform(e,t,{samplesPerSecond:s,enableCaching:!0});return this.validateWaveformData(i)?i:null}catch(i){return console.error("MediaBridge: Waveform generation error:",i),null}}async extractMetadata(e){if(!this.initialized||!this.mediaImportService)return null;try{const t=await this.mediaImportService.importMedia(e,{generateThumbnails:!1,generateWaveform:!1,useFallback:!0});return!t.success||!t.media?null:t.media.metadata}catch(t){return console.error("MediaBridge: Metadata extraction error:",t),null}}validateMetadata(e){const t=!e.hasVideo&&!e.hasAudio&&e.width>0&&e.height>0;return e.duration===null||e.duration===void 0||!t&&e.duration<=0?!1:t?!(e.width===null||e.width===void 0||e.width<=0||e.height===null||e.height===void 0||e.height<=0):!(e.hasVideo&&(e.width===null||e.width===void 0||e.width<=0||e.height===null||e.height===void 0||e.height<=0))}validateWaveformData(e){if(!e.peaks||e.peaks.length===0||e.duration<=0)return!1;const t=Math.ceil(e.duration*e.samplesPerSecond),s=e.peaks.length,i=Math.max(t*.1,10);return!(Math.abs(s-t)>i)}getSupportedFormats(){return this.mediaImportService?this.mediaImportService.getSupportedFormats():{video:[],audio:[],image:[]}}async isFormatSupported(e){return this.mediaImportService?(await this.mediaImportService.validateFormat(e)).supported:!1}captureProjectState(){const t=U.getState().project;return{mediaLibraryIds:t.mediaLibrary.items.map(s=>s.id),timelineClipIds:t.timeline.tracks.flatMap(s=>s.clips.map(i=>i.id))}}restoreProjectState(e){}dispose(){this.mediaImportService=null,this.waveformGenerator=null,this.initialized=!1}}let Rc=null;function jy(){return Rc||(Rc=new UX),Rc}async function _y(){const r=jy();return await r.initialize(),r}function GX(){Rc&&(Rc.dispose(),Rc=null)}const l2=["Tokyo","Paris","London","Sydney","Berlin","Milan","Seoul","Dubai","Oslo","Vienna","Kyoto","Prague","Lisbon","Boston","Austin","Denver","Portland","Seattle","Montreal","Toronto","Barcelona","Amsterdam","Stockholm","Helsinki","Dublin","Cairo","Mumbai","Bangkok","Singapore","Zurich","Geneva","Florence","Venice","Naples","Athens","Lagos","Nairobi","Marrakech","Cape Town","Havana","Lima","Rio","Santiago","Phoenix","Chicago","Brooklyn","Manhattan","Queens","Osaka","Taipei"],d2=["Morning","Evening","Midnight","Golden","Silver","Crystal","Velvet","Neon","Cosmic","Electric","Vintage","Modern","Classic","Urban","Serene","Bold","Swift","Vivid","Radiant","Mystic"];function WX(){const r=d2[Math.floor(Math.random()*d2.length)],e=l2[Math.floor(Math.random()*l2.length)];return`${r} ${e}`}const YX={width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2};function qX(){return{tracks:[],subtitles:[],duration:0,markers:[]}}function u2(r,e){const t=Date.now(),s=r||WX();return{id:dt(),name:s,createdAt:t,modifiedAt:t,settings:{...YX,...e},mediaLibrary:{items:[]},timeline:qX()}}function h2(r){let e=0;for(const t of r.timeline.tracks)for(const s of t.clips){const i=s.startTime+s.duration;i>e&&(e=i)}return e}const qb=new hM;async function HX(r,e,t,s){const i={id:e,projectId:r,blob:t,metadata:s};await qb.saveMedia(i)}async function XX(r){return qb.getMediaByProject(r)}async function KX(r){await qb.deleteMedia(r)}async function QX(r,e){return e==="audio"?null:e==="image"?URL.createObjectURL(r):new Promise(t=>{const s=document.createElement("video");s.muted=!0,s.playsInline=!0,s.preload="metadata";const i=()=>{URL.revokeObjectURL(s.src),s.remove()};s.onloadeddata=()=>{s.currentTime=.1},s.onseeked=()=>{try{const n=document.createElement("canvas");n.width=Math.min(s.videoWidth,320),n.height=Math.min(s.videoHeight,320/s.videoWidth*s.videoHeight);const a=n.getContext("2d");a?(a.drawImage(s,0,0,n.width,n.height),n.toBlob(o=>{i(),t(o?URL.createObjectURL(o):null)},"image/jpeg",.7)):(i(),t(null))}catch{i(),t(null)}},s.onerror=()=>{i(),t(null)},setTimeout(()=>{i(),t(null)},5e3),s.src=URL.createObjectURL(r)})}async function JX(r,e){const t=e||r.blob;if(!t)return r;let s=r.thumbnailUrl;return(!s||s.startsWith("blob:"))&&(s=await QX(t,r.type)),{...r,blob:t,thumbnailUrl:s,filmstripThumbnails:void 0}}const ZX="openreel-projects",e7=1,dh="projects",Zi="recent",og=10,$l=[{id:"blank",name:"Blank Project",description:"Start from scratch with no pre-configured tracks",category:"General",settings:{width:1920,height:1080,frameRate:30}},{id:"youtube-landscape",name:"YouTube Landscape",description:"1920x1080 at 30fps - Standard YouTube format",category:"Social Media",settings:{width:1920,height:1080,frameRate:30},tracks:[{type:"video",name:"Main Video"},{type:"audio",name:"Background Music"},{type:"audio",name:"Voiceover"}]},{id:"youtube-short",name:"YouTube Shorts",description:"1080x1920 at 60fps - Vertical short-form content",category:"Social Media",settings:{width:1080,height:1920,frameRate:60},tracks:[{type:"video",name:"Main Video"},{type:"audio",name:"Audio"},{type:"text",name:"Captions"}]},{id:"tiktok",name:"TikTok",description:"1080x1920 at 60fps - Optimized for TikTok",category:"Social Media",settings:{width:1080,height:1920,frameRate:60},tracks:[{type:"video",name:"Main"},{type:"audio",name:"Sound"}]},{id:"instagram-reel",name:"Instagram Reel",description:"1080x1920 at 30fps - Instagram Reels format",category:"Social Media",settings:{width:1080,height:1920,frameRate:30},tracks:[{type:"video",name:"Video"},{type:"audio",name:"Audio"}]},{id:"instagram-post",name:"Instagram Post",description:"1080x1080 at 30fps - Square format for posts",category:"Social Media",settings:{width:1080,height:1080,frameRate:30},tracks:[{type:"video",name:"Video"}]},{id:"cinematic-4k",name:"Cinematic 4K",description:"3840x2160 at 24fps - Film-like quality",category:"Professional",settings:{width:3840,height:2160,frameRate:24},tracks:[{type:"video",name:"A-Roll"},{type:"video",name:"B-Roll"},{type:"audio",name:"Dialogue"},{type:"audio",name:"Music"},{type:"audio",name:"SFX"}]},{id:"podcast",name:"Podcast Video",description:"1920x1080 at 30fps - Audio-focused with waveform visualizer",category:"Audio",settings:{width:1920,height:1080,frameRate:30},tracks:[{type:"video",name:"Background"},{type:"audio",name:"Host"},{type:"audio",name:"Guest"},{type:"graphics",name:"Waveform"}]},{id:"tutorial",name:"Screen Recording",description:"1920x1080 at 60fps - Perfect for tutorials",category:"Educational",settings:{width:1920,height:1080,frameRate:60},tracks:[{type:"video",name:"Screen"},{type:"video",name:"Webcam"},{type:"audio",name:"Narration"},{type:"text",name:"Annotations"}]}];class t7{db=null;listeners=new Map;currentFileHandle=null;async initialize(){this.db=await this.openDatabase()}openDatabase(){return new Promise((e,t)=>{if(typeof indexedDB>"u"){t(new Error("IndexedDB not supported"));return}const s=indexedDB.open(ZX,e7);s.onerror=()=>{t(new Error(`Failed to open database: ${s.error?.message}`))},s.onsuccess=()=>e(s.result),s.onupgradeneeded=i=>{const n=i.target.result;n.objectStoreNames.contains(dh)||n.createObjectStore(dh,{keyPath:"id"}),n.objectStoreNames.contains(Zi)||n.createObjectStore(Zi,{keyPath:"id"}).createIndex("lastOpened","lastOpened",{unique:!1})}})}async createProject(e={}){const t=e.templateId&&$l.find(a=>a.id===e.templateId)||$l[0],s={width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2,...t.settings,...e.settings},i=t.tracks?.map((a,o)=>({id:`track-${Date.now()}-${o}`,type:a.type,name:a.name,clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}))||[],n={id:dt(),name:e.name||"Untitled Project",createdAt:Date.now(),modifiedAt:Date.now(),settings:s,timeline:{duration:0,tracks:i,markers:[],subtitles:[]},mediaLibrary:{items:[]}};return this.currentFileHandle=null,this.emit("projectOpened",{project:n}),n}async saveProject(e){return this.currentFileHandle?this.saveToFileHandle(e,this.currentFileHandle):this.saveProjectAs(e)}async saveProjectAs(e){if(!("showSaveFilePicker"in window))return this.downloadProject(e);try{const s=await window.showSaveFilePicker({suggestedName:`${e.name}.oreel`,types:[{description:"OpenReel Project",accept:{"application/json":[".oreel",".json"]}}]}),i=await this.saveToFileHandle(e,s);return i&&(this.currentFileHandle=s,await this.addToRecent(e,s)),i}catch(t){return t.name==="AbortError"||console.error("[ProjectManager] Save failed:",t),!1}}async saveToFileHandle(e,t){try{const s=await t.createWritable(),i=JSON.stringify(e,null,2);return await s.write(i),await s.close(),this.emit("projectSaved",{project:e}),!0}catch(s){return console.error("[ProjectManager] Save to file failed:",s),!1}}downloadProject(e){try{const t=JSON.stringify(e,null,2),s=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(s),n=document.createElement("a");return n.href=i,n.download=`${e.name}.oreel`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),this.emit("projectSaved",{project:e}),!0}catch(t){return console.error("[ProjectManager] Download failed:",t),!1}}async openProject(){if("showOpenFilePicker"in window)try{const e=window,[t]=await e.showOpenFilePicker({types:[{description:"OpenReel Project",accept:{"application/json":[".oreel",".json"]}}],multiple:!1}),i=await(await t.getFile()).text(),n=JSON.parse(i);return this.currentFileHandle=t,await this.addToRecent(n,t),this.emit("projectOpened",{project:n}),n}catch(e){return e.name==="AbortError"||console.error("[ProjectManager] Open failed:",e),null}return this.openProjectViaInput()}openProjectViaInput(){return new Promise(e=>{const t=document.createElement("input");t.type="file",t.accept=".oreel,.json",t.onchange=async()=>{const s=t.files?.[0];if(!s){e(null);return}try{const i=await s.text(),n=JSON.parse(i);await this.addToRecent(n),this.emit("projectOpened",{project:n}),e(n)}catch(i){console.error("[ProjectManager] Parse failed:",i),e(null)}},t.click()})}async openRecentProject(e){if(e.fileHandle)try{const t=e.fileHandle;if(await t.queryPermission?.({mode:"read"})!=="granted"&&await t.requestPermission?.({mode:"read"})!=="granted")return null;const n=await(await e.fileHandle.getFile()).text(),a=JSON.parse(n);return this.currentFileHandle=e.fileHandle,await this.updateRecentTimestamp(e.id),this.emit("projectOpened",{project:a}),a}catch(t){return console.error("[ProjectManager] Open recent failed:",t),await this.removeFromRecent(e.id),null}return this.loadProjectFromDb(e.id)}async loadProjectFromDb(e){return this.db?new Promise(t=>{const n=this.db.transaction(dh,"readonly").objectStore(dh).get(e);n.onsuccess=()=>{const a=n.result;a&&this.emit("projectOpened",{project:a}),t(a||null)},n.onerror=()=>t(null)}):null}async getRecentProjects(){return this.db||await this.initialize(),new Promise(e=>{if(!this.db){e([]);return}const n=this.db.transaction(Zi,"readonly").objectStore(Zi).index("lastOpened").getAll();n.onsuccess=()=>{const a=n.result.sort((o,l)=>l.lastOpened-o.lastOpened).slice(0,og);e(a)},n.onerror=()=>e([])})}async addToRecent(e,t){if(!this.db)return;const s={id:e.id,name:e.name,lastOpened:Date.now(),fileHandle:t,duration:e.timeline.duration,trackCount:e.timeline.tracks.length};return new Promise(i=>{const n=this.db.transaction(Zi,"readwrite");n.objectStore(Zi).put(s),n.oncomplete=()=>{this.emit("recentUpdated"),this.cleanupOldRecent(),i()},n.onerror=()=>i()})}async updateRecentTimestamp(e){if(this.db)return new Promise(t=>{const i=this.db.transaction(Zi,"readwrite").objectStore(Zi),n=i.get(e);n.onsuccess=()=>{const a=n.result;a&&(a.lastOpened=Date.now(),i.put(a)),t()},n.onerror=()=>t()})}async removeFromRecent(e){if(this.db)return new Promise(t=>{const s=this.db.transaction(Zi,"readwrite");s.objectStore(Zi).delete(e),s.oncomplete=()=>{this.emit("recentUpdated"),t()},s.onerror=()=>t()})}async cleanupOldRecent(){const e=await this.getRecentProjects();if(e.length>og){const t=e.slice(og);for(const s of t)await this.removeFromRecent(s.id)}}async clearRecentProjects(){if(this.db)return new Promise(e=>{const t=this.db.transaction(Zi,"readwrite");t.objectStore(Zi).clear(),t.oncomplete=()=>{this.emit("recentUpdated"),e()},t.onerror=()=>e()})}getTemplates(){return[...$l]}getTemplatesByCategory(){const e=new Map;for(const t of $l){const s=e.get(t.category)||[];s.push(t),e.set(t.category,s)}return e}getCurrentFileHandle(){return this.currentFileHandle}hasUnsavedChanges(e){const t=e;return!this.currentFileHandle||e.modifiedAt>(t.lastSavedAt??0)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.listeners.get(e)?.delete(t)}emit(e,t){this.listeners.get(e)?.forEach(s=>{try{s(t)}catch(i){console.error("[ProjectManager] Event callback error:",i)}})}}const s7=new t7,U=Ta()(Op((r,e)=>{const t=new id,s=new qu(t);return{project:u2(),photoProjects:new Map,actionExecutor:s,actionHistory:t,clipUndoStack:[],clipRedoStack:[],isLoading:!1,error:null,clipboard:[],copiedEffects:[],createNewProject:(i,n)=>{const a=new id,o=new qu(a);r({project:u2(i,n),actionHistory:a,actionExecutor:o,clipUndoStack:[],clipRedoStack:[],error:null})},loadProject:i=>{const n=me.getState().getTitleEngine(),a=me.getState().getGraphicsEngine();n&&i.textClips&&n.loadTextClips(i.textClips),a&&(i.shapeClips&&a.loadShapeClips(i.shapeClips),i.svgClips&&a.loadSVGClips(i.svgClips),i.stickerClips&&a.loadStickerClips(i.stickerClips));const o=new id,l=new qu(o);r({project:i,actionHistory:o,actionExecutor:l,clipUndoStack:[],clipRedoStack:[],error:null})},renameProject:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"project/rename",id:dt(),timestamp:Date.now(),params:{name:i}},l=await a.execute(o,n);return l.success&&r({project:{...n}}),l},updateSettings:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"project/updateSettings",id:dt(),timestamp:Date.now(),params:i},l=await a.execute(o,n);return l.success&&r({project:{...n,settings:{...n.settings}}}),l},importMedia:async i=>{const{project:n}=e();try{const a=jy();a.isInitialized()||await _y();const o=i.size>50*1024*1024,l=await a.importFile(i,!0,o);if(!l.success||!l.media)return{success:!1,error:{code:"DECODE_ERROR",message:l.error||"Failed to import media"}};const d=l.media;let u=null;const h=[];if(d.thumbnails&&d.thumbnails.length>0){for(const b of d.thumbnails){let S=null;if(b.dataUrl)S=b.dataUrl;else if(b.canvas)try{if(b.canvas instanceof OffscreenCanvas){const k=await b.canvas.convertToBlob({type:"image/jpeg",quality:.7});S=URL.createObjectURL(k)}else b.canvas instanceof HTMLCanvasElement&&(S=b.canvas.toDataURL("image/jpeg",.7))}catch(k){console.warn("Failed to convert thumbnail canvas to URL:",k)}S&&h.push({timestamp:b.timestamp,url:S})}h.length>0&&(u=h[0].url)}let p;i.type.startsWith("image/")?p="image":d.metadata.hasVideo?p="video":d.metadata.hasAudio?p="audio":p="image";const m=n.mediaLibrary.items.filter(b=>b.isPlaceholder&&!b.blob&&b.type===p);let f;m.length>0&&(f=m.find(b=>b.name===i.name),f||(f=m[0]));const y={id:f?.id||dt(),name:f?.name||i.name,type:p,fileHandle:null,blob:i,metadata:{duration:d.metadata.duration||0,width:d.metadata.width||0,height:d.metadata.height||0,frameRate:d.metadata.frameRate||0,codec:d.metadata.codec||"",sampleRate:d.metadata.sampleRate||0,channels:d.metadata.channels||0,fileSize:i.size},thumbnailUrl:u,waveformData:d.waveformData?.peaks||null,filmstripThumbnails:h.length>0?h:void 0,isPlaceholder:!1};let x;f?(console.log(`[ProjectStore] Replacing placeholder "${f.name}" (${f.id}) with imported media`),x=n.mediaLibrary.items.map(b=>b.id===f.id?y:b)):x=[...n.mediaLibrary.items,y];const v={...n,mediaLibrary:{...n.mediaLibrary,items:x},modifiedAt:Date.now()};r({project:v});try{await HX(v.id,y.id,i,y.metadata)}catch(b){console.error("[ProjectStore] Failed to persist media blob:",b)}return o&&!u&&setTimeout(async()=>{try{const b=await a.generateThumbnailsForMedia(i,p);if(b.length>0){const S=e().project,k=S.mediaLibrary.items.findIndex(C=>C.id===y.id);if(k!==-1){const C=[...S.mediaLibrary.items];C[k]={...C[k],thumbnailUrl:b[0].dataUrl,filmstripThumbnails:b.map(A=>({timestamp:A.timestamp,url:A.dataUrl}))},r({project:{...S,mediaLibrary:{...S.mediaLibrary,items:C}}})}}}catch{}},100),{success:!0,actionId:y.id}}catch(a){return{success:!1,error:{code:"DECODE_ERROR",message:a instanceof Error?a.message:"Unknown import error"}}}},deleteMedia:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"media/delete",id:dt(),timestamp:Date.now(),params:{mediaId:i}},l=await a.execute(o,n);return l.success&&(r({project:{...n}}),KX(i).catch(d=>console.warn("[ProjectStore] Failed to delete media blob:",d))),l},replaceMediaAsset:async(i,n)=>{const{project:a}=e();try{const o=jy();o.isInitialized()||await _y();const l=await o.importFile(n,!0);if(!l.success||!l.media)return{success:!1,error:{code:"DECODE_ERROR",message:l.error||"Failed to import media"}};const d=l.media;let u=null;const h=[];if(d.thumbnails&&d.thumbnails.length>0){for(const f of d.thumbnails){let g=null;if(f.dataUrl)g=f.dataUrl;else if(f.canvas)try{if(f.canvas instanceof OffscreenCanvas){const y=await f.canvas.convertToBlob({type:"image/jpeg",quality:.7});g=URL.createObjectURL(y)}else f.canvas instanceof HTMLCanvasElement&&(g=f.canvas.toDataURL("image/jpeg",.7))}catch(y){console.warn("Failed to convert thumbnail canvas to URL:",y)}g&&h.push({timestamp:f.timestamp,url:g})}h.length>0&&(u=h[0].url)}const p={id:i,name:n.name,type:d.metadata.hasVideo?"video":d.metadata.hasAudio?"audio":"image",fileHandle:null,blob:n,metadata:{duration:d.metadata.duration||0,width:d.metadata.width||0,height:d.metadata.height||0,frameRate:d.metadata.frameRate||0,codec:d.metadata.codec||"",sampleRate:d.metadata.sampleRate||0,channels:d.metadata.channels||0,fileSize:n.size},thumbnailUrl:u,waveformData:d.waveformData?.peaks||null,filmstripThumbnails:h.length>0?h:void 0,isPlaceholder:!1},m=a.mediaLibrary.items.map(f=>f.id===i?p:f);return r({project:{...a,mediaLibrary:{items:m},modifiedAt:Date.now()}}),{success:!0,actionId:dt()}}catch(o){return{success:!1,error:{code:"DECODE_ERROR",message:o instanceof Error?o.message:"Unknown import error"}}}},renameMedia:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"media/rename",id:dt(),timestamp:Date.now(),params:{mediaId:i,name:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},getMediaItem:i=>{const{project:n}=e();return n.mediaLibrary.items.find(a=>a.id===i)},addTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l=structuredClone(a),d={type:"track/add",id:dt(),timestamp:Date.now(),params:{trackType:i,position:n}},u=await o.execute(d,l);if(u.success){const h={...l,modifiedAt:Date.now()};r({project:h})}return u},removeTrack:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"track/remove",id:dt(),timestamp:Date.now(),params:{trackId:i}},l=await a.execute(o,n);return l.success&&r({project:{...n,timeline:{...n.timeline},modifiedAt:Date.now()}}),l},reorderTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/reorder",id:dt(),timestamp:Date.now(),params:{trackId:i,newPosition:n}},d=await o.execute(l,a);return d.success&&r({project:{...a,modifiedAt:Date.now()}}),d},lockTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/lock",id:dt(),timestamp:Date.now(),params:{trackId:i,locked:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},hideTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/hide",id:dt(),timestamp:Date.now(),params:{trackId:i,hidden:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},muteTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/mute",id:dt(),timestamp:Date.now(),params:{trackId:i,muted:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},soloTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/solo",id:dt(),timestamp:Date.now(),params:{trackId:i,solo:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},getTrack:i=>{const{project:n}=e();return n.timeline.tracks.find(a=>a.id===i)},addClip:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d=structuredClone(o),u={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:i,mediaId:n,startTime:a}},h=await l.execute(u,d);if(h.success){const p={...d,modifiedAt:Date.now()};r({project:p})}return h},addClipToNewTrack:async(i,n)=>{const{project:a,addTrack:o,getMediaItem:l}=e(),d=l(i);if(!d)return{success:!1,error:{code:"MEDIA_NOT_FOUND",message:"Media item not found"}};let u;d.type==="video"?u="video":d.type==="audio"?u="audio":d.type==="image"?u="image":u="video";const h=n!==void 0?n:h2(a),p=await o(u);if(!p.success)return p;const{project:m,actionExecutor:f}=e(),g=m.timeline.tracks.find(b=>b.clips.length===0&&b.type===u);if(!g)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Could not find newly created track"}};const y=structuredClone(m),x={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:g.id,mediaId:i,startTime:h}},v=await f.execute(x,y);if(v.success){const b={...y,modifiedAt:Date.now()};r({project:b})}return v},separateAudio:async i=>{const{project:n,actionExecutor:a,addTrack:o}=e(),l=n.timeline.tracks.flatMap(f=>f.clips).find(f=>f.id===i);if(!l)return{success:!1,error:{code:"CLIP_NOT_FOUND",message:"Clip not found"}};const d=n.mediaLibrary.items.find(f=>f.id===l.mediaId);if(!d||d.type!=="video"||!d.metadata?.channels||d.metadata.channels===0)return{success:!1,error:{code:"MEDIA_NOT_FOUND",message:"Media has no audio to separate"}};let u=n.timeline.tracks.find(f=>f.type==="audio");if(!u){if(!(await o("audio")).success)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Failed to create audio track"}};const{project:g}=e();u=g.timeline.tracks.find(y=>y.type==="audio")}if(!u)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Could not find or create audio track"}};const h=structuredClone(e().project),p={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:u.id,mediaId:l.mediaId,startTime:l.startTime}},m=await a.execute(p,h);if(m.success){const f={...h,modifiedAt:Date.now()};r({project:f})}return m},removeClip:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"clip/remove",id:dt(),timestamp:Date.now(),params:{clipId:i}},l=await a.execute(o,n);return l.success&&r({project:{...n}}),l},moveClip:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/move",id:dt(),timestamp:Date.now(),params:{clipId:i,startTime:n,trackId:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},trimClip:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/trim",id:dt(),timestamp:Date.now(),params:{clipId:i,inPoint:n,outPoint:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},splitClip:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"clip/split",id:dt(),timestamp:Date.now(),params:{clipId:i,time:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},rippleDeleteClip:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"clip/rippleDelete",id:dt(),timestamp:Date.now(),params:{clipId:i}},l=await a.execute(o,n);return l.success&&r({project:{...n}}),l},slipClip:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"clip/slip",id:dt(),timestamp:Date.now(),params:{clipId:i,delta:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},slideClip:async(i,n)=>{const{project:a,actionExecutor:o,getClip:l}=e();if(!l(i))return{success:!1,error:{code:"INVALID_PARAMS",message:"Clip not found"}};const u=a.timeline.tracks.find(x=>x.clips.some(v=>v.id===i));if(!u)return{success:!1,error:{code:"INVALID_PARAMS",message:"Track not found"}};const h=[...u.clips].sort((x,v)=>x.startTime-v.startTime),p=h.findIndex(x=>x.id===i),m=p>0?h[p-1]:void 0,f=p<h.length-1?h[p+1]:void 0,g={type:"clip/slide",id:dt(),timestamp:Date.now(),params:{clipId:i,delta:n,prevClipId:m?.id,nextClipId:f?.id}},y=await o.execute(g,a);return y.success&&r({project:{...a}}),y},rollEdit:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/roll",id:dt(),timestamp:Date.now(),params:{leftClipId:i,rightClipId:n,delta:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},trimToPlayhead:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/trimToPlayhead",id:dt(),timestamp:Date.now(),params:{clipId:i,playheadTime:n,trimStart:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},getClip:i=>{const{project:n}=e();for(const a of n.timeline.tracks){const o=a.clips.find(l=>l.id===i);if(o)return o}},copyClips:i=>{const{getClip:n}=e(),o=i.map(n).filter(l=>l!==void 0).map(l=>({...JSON.parse(JSON.stringify(l))}));r({clipboard:o})},pasteClips:async(i,n)=>{const{clipboard:a,project:o,actionExecutor:l}=e(),d=[];if(a.length===0)return[{success:!1,error:{code:"INVALID_PARAMS",message:"Clipboard is empty"}}];const u=Math.min(...a.map(h=>h.startTime));for(const h of a){const p=h.startTime-u,m=n+p,f={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:i,mediaId:h.mediaId,startTime:m,duration:h.duration,inPoint:h.inPoint,outPoint:h.outPoint,volume:h.volume,effects:h.effects}},g=await l.execute(f,o);d.push(g)}return r({project:{...o}}),d},duplicateClip:async i=>{const{getClip:n,project:a,addTrack:o}=e(),l=n(i);if(!l)return{success:!1,error:{code:"INVALID_PARAMS",message:"Clip not found"}};const d=a.timeline.tracks.find(x=>x.clips.some(v=>v.id===i));if(!d)return{success:!1,error:{code:"INVALID_PARAMS",message:"Track not found"}};const u=await o(d.type);if(!u.success)return u;const{project:h,actionExecutor:p}=e(),m=h.timeline.tracks.find(x=>x.clips.length===0&&x.type===d.type);if(!m)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Could not find newly created track"}};const f=structuredClone(h),g={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:m.id,mediaId:l.mediaId,startTime:l.startTime,duration:l.duration,inPoint:l.inPoint,outPoint:l.outPoint,volume:l.volume,effects:structuredClone(l.effects),keyframes:l.keyframes?structuredClone(l.keyframes):void 0,transform:l.transform?structuredClone(l.transform):void 0}},y=await p.execute(g,f);if(y.success){const x={...f,modifiedAt:Date.now()};r({project:x})}return y},copyEffects:i=>{const{getClip:n}=e(),a=n(i);if(a){const o=JSON.parse(JSON.stringify(a.effects));r({copiedEffects:o})}},pasteEffects:async i=>{const{copiedEffects:n,project:a,actionExecutor:o}=e();if(n.length===0)return{success:!1,error:{code:"INVALID_PARAMS",message:"No effects in clipboard"}};const l=[];for(const d of n){const u={type:"effect/add",id:dt(),timestamp:Date.now(),params:{clipId:i,effectType:d.type,params:d.params}},h=await o.execute(u,a);l.push(h)}return r({project:{...a}}),l[0]||{success:!1,error:{code:"UNKNOWN",message:"No results"}}},updateClipTransform:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(y=>y.id===i);if(p===-1)return h;o=!0;const m=h.clips[p],f={...m.transform,...n,position:{...m.transform.position,...n.position||{}},scale:{...m.transform.scale,...n.scale||{}},anchor:{...m.transform.anchor,...n.anchor||{}}},g=[...h.clips];return g[p]={...m,transform:f},{...h,clips:g}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=me.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h){const p={...h.transform,...n,position:{...h.transform.position,...n.position||{}},scale:{...h.transform.scale,...n.scale||{}},anchor:{...h.transform.anchor,...n.anchor||{}}};return d.updateTextClip(i,{transform:p}),r({project:{...a,modifiedAt:Date.now()}}),!0}}const u=me.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h){const m={...h.transform,...n,position:{...h.transform.position,...n.position||{}},scale:{...h.transform.scale,...n.scale||{}},anchor:{...h.transform.anchor,...n.anchor||{}}};return u.updateShapeClip(i,{transform:m}),r({project:{...a,modifiedAt:Date.now()}}),!0}const p=u.getSVGClip(i);if(p){const m={...p.transform,...n,position:{...p.transform.position,...n.position||{}},scale:{...p.transform.scale,...n.scale||{}},anchor:{...p.transform.anchor,...n.anchor||{}}};return u.updateSVGClip(i,{transform:m}),r({project:{...a,modifiedAt:Date.now()}}),!0}}return!1},updateClipBlendMode:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const m=h.clips[p],f=[...h.clips];return f[p]={...m,blendMode:n},{...h,clips:f}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=me.getState().getTitleEngine();if(d&&d.getTextClip(i))return d.updateTextClip(i,{blendMode:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;const u=me.getState().getGraphicsEngine();if(u){if(u.getShapeClip(i))return u.updateShapeClip(i,{blendMode:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getSVGClip(i))return u.updateSVGClip(i,{blendMode:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipBlendOpacity:(i,n)=>{const{project:a}=e();if(n<0||n>100)return console.error("Blend opacity must be between 0 and 100"),!1;let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const m=h.clips[p],f=[...h.clips];return f[p]={...m,blendOpacity:n},{...h,clips:f}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=me.getState().getTitleEngine();if(d&&d.getTextClip(i))return d.updateTextClip(i,{blendOpacity:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;const u=me.getState().getGraphicsEngine();if(u){if(u.getShapeClip(i))return u.updateShapeClip(i,{blendOpacity:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getSVGClip(i))return u.updateSVGClip(i,{blendOpacity:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipEmphasisAnimation:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const m=h.clips[p],f=[...h.clips];return f[p]={...m,emphasisAnimation:n},{...h,clips:f}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=me.getState().getTitleEngine();if(d&&d.getTextClip(i))return d.updateTextClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;const u=me.getState().getGraphicsEngine();if(u){if(u.getShapeClip(i))return u.updateShapeClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getSVGClip(i))return u.updateSVGClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getStickerClip(i))return u.updateStickerClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipRotate3D:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const m=h.clips[p],f=[...h.clips];return f[p]={...m,transform:{...m.transform,rotate3d:n}},{...h,clips:f}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=me.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h)return d.updateTextClip(i,{transform:{...h.transform,rotate3d:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}const u=me.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h)return u.updateShapeClip(i,{transform:{...h.transform,rotate3d:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0;const p=u.getSVGClip(i);if(p)return u.updateSVGClip(i,{transform:{...p.transform,rotate3d:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipPerspective:(i,n)=>{const{project:a}=e();if(n<0)return console.error("Perspective must be non-negative"),!1;let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const m=h.clips[p],f=[...h.clips];return f[p]={...m,transform:{...m.transform,perspective:n}},{...h,clips:f}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=me.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h)return d.updateTextClip(i,{transform:{...h.transform,perspective:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}const u=me.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h)return u.updateShapeClip(i,{transform:{...h.transform,perspective:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0;const p=u.getSVGClip(i);if(p)return u.updateSVGClip(i,{transform:{...p.transform,perspective:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipTransformStyle:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const m=h.clips[p],f=[...h.clips];return f[p]={...m,transform:{...m.transform,transformStyle:n}},{...h,clips:f}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=me.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h)return d.updateTextClip(i,{transform:{...h.transform,transformStyle:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}const u=me.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h)return u.updateShapeClip(i,{transform:{...h.transform,transformStyle:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0;const p=u.getSVGClip(i);if(p)return u.updateSVGClip(i,{transform:{...p.transform,transformStyle:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},undo:async()=>{const{project:i,actionExecutor:n,clipUndoStack:a,clipRedoStack:o}=e();if(a.length>0){const d=a[a.length-1];let u=!1;if(d.type==="shape"){const h=me.getState().getGraphicsEngine();h&&(u=h.deleteShapeClip(d.clipId))}else if(d.type==="text"){const h=me.getState().getTitleEngine();h&&(u=h.deleteTextClip(d.clipId))}else if(d.type==="svg"){const h=me.getState().getGraphicsEngine();h&&(u=h.deleteSVGClip(d.clipId))}else if(d.type==="sticker"){const h=me.getState().getGraphicsEngine();h&&(u=h.deleteStickerClip(d.clipId))}if(u){r({project:{...i,modifiedAt:Date.now()},clipUndoStack:a.slice(0,-1),clipRedoStack:[...o,{...d,hadEmptyTrackUndo:!1}]});const h=d.trackId,m=e().project.timeline.tracks.find(f=>f.id===h);if(m){let f=!1;if(m.type==="text")f=(me.getState().getTitleEngine()?.getAllTextClips()||[]).some(x=>x.trackId===h);else if(m.type==="graphics"){const g=me.getState().getGraphicsEngine(),y=g?.getAllShapeClips()||[],x=g?.getAllSVGClips()||[],v=g?.getAllStickerClips()||[];f=[...y,...x,...v].some(b=>b.trackId===h)}else(m.type==="video"||m.type==="audio"||m.type==="image")&&(f=m.clips.length>0);if(!f){const{actionHistory:g}=e(),x=g.peekUndo()?.action,b={text:"text",shape:"graphics",svg:"graphics",sticker:"graphics"}[d.type]||m.type,S=x?.params?.trackType;if(x&&x.type==="track/add"&&S===b&&(await n.undo(e().project)).success){const C=e().clipRedoStack;if(C.length>0){const A=C[C.length-1];r({project:{...e().project},clipRedoStack:[...C.slice(0,-1),{...A,hadEmptyTrackUndo:!0,trackType:b}]})}}}}return{success:!0}}}const l=await n.undo(i);return l.success&&r({project:{...i}}),l},redo:async()=>{const{project:i,actionExecutor:n,clipUndoStack:a,clipRedoStack:o}=e();if(o.length>0){const d=o[o.length-1];let u=!1,h;if(d.hadEmptyTrackUndo&&d.trackType){const m=await n.redo(e().project);if(!m.success)return m;const f=e().project,g=f.timeline.tracks.filter(y=>y.type===d.trackType);g.length>0&&(h=g[g.length-1].id),r({project:{...f}})}const p=h||d.trackId;if(d.type==="shape"){const m=me.getState().getGraphicsEngine();if(m){const f=d.clipData;m.createShape({shapeType:f.shapeType,width:200,height:200,style:f.style},p,f.startTime,f.duration),u=!0}}else if(d.type==="text"){const m=me.getState().getTitleEngine();if(m){const f=d.clipData;m.createTextClip({trackId:p,startTime:f.startTime,text:f.text,duration:f.duration,style:f.style}),u=!0}}else if(d.type==="svg"){const m=me.getState().getGraphicsEngine();if(m){const f=d.clipData;m.importSVG(f.svgContent,p,f.startTime,f.duration),u=!0}}else if(d.type==="sticker"){const m=me.getState().getGraphicsEngine();if(m){const f=d.clipData;m.addStickerClip({...f,trackId:p}),u=!0}}if(u){const m=h?{...d,trackId:h,clipData:{...d.clipData,trackId:h}}:d;return r({project:{...e().project,modifiedAt:Date.now()},clipUndoStack:[...a,m],clipRedoStack:o.slice(0,-1)}),{success:!0}}}const l=await n.redo(i);return l.success&&r({project:{...i}}),l},canUndo:()=>{const{actionHistory:i,clipUndoStack:n}=e();return n.length>0||i.canUndo()},canRedo:()=>{const{actionHistory:i,clipRedoStack:n}=e();return n.length>0||i.canRedo()},executeAction:async i=>{const{project:n,actionExecutor:a}=e(),o=await a.execute(i,n);return o.success&&r({project:{...n}}),o},getTimelineDuration:()=>{const{project:i}=e(),n=i.timeline?.duration||0;return n>0?n:h2(i)},setTimelineDuration:i=>{const{project:n}=e(),a=Math.max(0,i);r({project:{...n,timeline:{...n.timeline,duration:a},modifiedAt:Date.now()}})},initializeAutoSave:async()=>{await $X(),ar.start(()=>{const{project:i}=e(),n=me.getState().getTitleEngine(),a=me.getState().getGraphicsEngine();return{...i,textClips:n?.getAllTextClips()||[],shapeClips:a?.getAllShapeClips()||[],svgClips:a?.getAllSVGClips()||[],stickerClips:a?.getAllStickerClips()||[]}}),U.subscribe(i=>i.project,()=>{ar.markDirty()})},checkForRecovery:async()=>{const{project:i}=e();return ar.checkForRecovery(i.id)},recoverFromAutoSave:async i=>{const n=await ar.recover(i);if(n){const a=await XX(n.id),o=new Map(a.map(f=>[f.id,f.blob])),l=await Promise.all(n.mediaLibrary.items.map(f=>JX(f,o.get(f.id)))),d={...n,mediaLibrary:{...n.mediaLibrary,items:l}},u=me.getState().getTitleEngine(),h=me.getState().getGraphicsEngine();u&&n.textClips&&u.loadTextClips(n.textClips),h&&(n.shapeClips&&h.loadShapeClips(n.shapeClips),n.svgClips&&h.loadSVGClips(n.svgClips),n.stickerClips&&h.loadStickerClips(n.stickerClips));const p=new id,m=new qu(p);return r({project:d,actionHistory:p,actionExecutor:m,clipUndoStack:[],clipRedoStack:[],error:null}),await s7.addToRecent(d),!0}return!1},forceSave:async()=>{const{project:i}=e(),n=me.getState().getTitleEngine(),a=me.getState().getGraphicsEngine(),o={...i,textClips:n?.getAllTextClips()||[],shapeClips:a?.getAllShapeClips()||[],svgClips:a?.getAllSVGClips()||[],stickerClips:a?.getAllStickerClips()||[]};await ar.forceSave(o)},getFullProject:()=>{const{project:i}=e(),n=me.getState().getTitleEngine(),a=me.getState().getGraphicsEngine();return{...i,textClips:n?.getAllTextClips()||[],shapeClips:a?.getAllShapeClips()||[],svgClips:a?.getAllSVGClips()||[],stickerClips:a?.getAllStickerClips()||[]}},createTextClip:(i,n,a,o=5,l)=>{const d=me.getState().titleEngine;if(!d)return console.error("TitleEngine not available yet"),null;const{project:u}=e();if(!u.timeline.tracks.find(g=>g.id===i))return console.error(`Track ${i} not found`),null;const p=d.createTextClip({trackId:i,startTime:n,text:a,duration:o,style:l}),{clipUndoStack:m}=e(),f={type:"text",clipId:p.id,trackId:i,clipData:{...p}};return r({project:{...u,modifiedAt:Date.now()},clipUndoStack:[...m,f],clipRedoStack:[]}),p},updateTextContent:(i,n)=>{const a=me.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateText(i,n);return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},updateTextStyle:(i,n)=>{const a=me.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateStyle(i,n);return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},updateTextAnimation:(i,n)=>{const a=me.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateTextClip(i,{animation:n});return o&&r({project:{...e().project}}),o||null},updateTextTransform:(i,n)=>{const a=me.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateTextClip(i,{transform:n});return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},getTextClip:i=>{const n=me.getState().getTitleEngine();if(n)return n.getTextClip(i)},getAllTextClips:()=>{const i=me.getState().getTitleEngine();return i?i.getAllTextClips():[]},updateTextClipKeyframes:(i,n)=>{const a=me.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateTextClip(i,{keyframes:n});return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},applyTextAnimationPreset:(i,n,a=.5,o=.5,l)=>{const d=me.getState().getTitleEngine();if(!d)return null;const u=Sp.createAnimationPreset(n,a,o,l),h=d.updateTextClip(i,{animation:u});if(h){const{project:p}=e();r({project:{...p,modifiedAt:Date.now()}})}return h||null},getAvailableAnimationPresets:()=>Sp.getAvailablePresets(),addSubtitle:async i=>{const{project:n,addTrack:a,createTextClip:o}=e();let l=n.timeline.tracks.find(h=>h.type==="text"&&h.name==="Captions");if(!l){if(!(await a("text"))?.success)return;l=e().project.timeline.tracks.filter(f=>f.type==="text"&&!n.timeline.tracks.some(g=>g.id===f.id))[0],l&&(r(f=>({project:{...f.project,timeline:{...f.project.timeline,tracks:f.project.timeline.tracks.map(g=>g.id===l.id?{...g,name:"Captions"}:g)}}})),l={...l,name:"Captions"})}if(!l)return;const d=i.endTime-i.startTime,u=i.style;o(l.id,i.startTime,i.text,d,u?{fontFamily:u.fontFamily,fontSize:u.fontSize,color:u.color,backgroundColor:u.backgroundColor||void 0}:void 0)},removeSubtitle:i=>{r(n=>({project:{...n.project,timeline:{...n.project.timeline,subtitles:n.project.timeline.subtitles.filter(a=>a.id!==i)}}}))},updateSubtitle:(i,n)=>{r(a=>({project:{...a.project,timeline:{...a.project.timeline,subtitles:a.project.timeline.subtitles.map(o=>o.id===i?{...o,...n}:o)}}}))},getSubtitle:i=>e().project.timeline.subtitles.find(n=>n.id===i),importSRT:async i=>{const n=await me.getState().getSubtitleEngine(),{project:a}=e(),{timeline:o,result:l}=n.importSRT(a.timeline,i);return l.success?(r({project:{...a,timeline:o,modifiedAt:Date.now()}}),{success:!0,errors:[]}):{success:!1,errors:l.errors.map(u=>`Line ${u.line}: ${u.message}`)}},exportSRT:async()=>{const i=await me.getState().getSubtitleEngine(),{project:n}=e();return i.exportSRT(n.timeline)},applySubtitleStylePreset:async i=>{const n=await me.getState().getSubtitleEngine(),{project:a}=e(),o=n.applyStylePreset(a.timeline,i);return"error"in o?(console.error(o.error),!1):(r({project:{...a,timeline:o.timeline,modifiedAt:Date.now()}}),!0)},getSubtitleStylePresets:async()=>(await me.getState().getSubtitleEngine()).getStylePresets(),addMarker:(i,n="Marker",a="#3b82f6")=>{const o={id:`marker-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,time:i,label:n,color:a};r(l=>({project:{...l.project,timeline:{...l.project.timeline,markers:[...l.project.timeline.markers,o]}}}))},removeMarker:i=>{r(n=>({project:{...n.project,timeline:{...n.project.timeline,markers:n.project.timeline.markers.filter(a=>a.id!==i)}}}))},updateMarker:(i,n)=>{r(a=>({project:{...a.project,timeline:{...a.project.timeline,markers:a.project.timeline.markers.map(o=>o.id===i?{...o,...n}:o)}}}))},getMarker:i=>e().project.timeline.markers.find(a=>a.id===i),getMarkers:()=>e().project.timeline.markers,createShapeClip:(i,n,a,o=5,l)=>{const d=me.getState().getGraphicsEngine();if(!d)return console.error("GraphicsEngine not initialized"),null;const{project:u}=e();if(!u.timeline.tracks.find(g=>g.id===i))return console.error(`Track ${i} not found`),null;const p=d.createShape({shapeType:a,width:200,height:200,style:l},i,n,o),{clipUndoStack:m}=e(),f={type:"shape",clipId:p.id,trackId:i,clipData:{...p}};return r({project:{...u,modifiedAt:Date.now()},clipUndoStack:[...m,f],clipRedoStack:[]}),p},updateShapeStyle:(i,n)=>{const a=me.getState().getGraphicsEngine();if(!a)return console.error("GraphicsEngine not initialized"),null;const o=a.getShapeClip(i);if(!o)return console.error(`Shape clip ${i} not found`),null;const l=a.updateShapeStyle(o,n),{project:d}=e();return r({project:{...d,modifiedAt:Date.now()}}),l},updateShapeTransform:(i,n)=>{const a=me.getState().getGraphicsEngine();if(!a)return console.error("GraphicsEngine not initialized"),null;if(a.getShapeClip(i)){const d=a.updateShapeClip(i,{transform:n}),{project:u}=e();return r({project:{...u,modifiedAt:Date.now()}}),d||null}if(a.getSVGClip(i)){const d=a.updateSVGClip(i,{transform:n}),{project:u}=e();return r({project:{...u,modifiedAt:Date.now()}}),d||null}return console.error(`Graphic clip ${i} not found`),null},importSVG:(i,n,a,o=5)=>{const l=me.getState().getGraphicsEngine();if(!l)return console.error("GraphicsEngine not initialized"),null;const{project:d}=e();if(!d.timeline.tracks.find(h=>h.id===n))return console.error(`Track ${n} not found`),null;try{const h=l.importSVG(i,n,a,o),{clipUndoStack:p}=e(),m={type:"svg",clipId:h.id,trackId:n,clipData:{...h}};return r({project:{...d,modifiedAt:Date.now()},clipUndoStack:[...p,m],clipRedoStack:[]}),h}catch(h){return console.error("Failed to import SVG:",h),null}},getShapeClip:i=>{const n=me.getState().getGraphicsEngine();if(n)return n.getShapeClip(i)},getSVGClip:i=>{const n=me.getState().getGraphicsEngine();if(n)return n.getSVGClip(i)},getSVGClipById:i=>e().getSVGClip(i),updateSVGClip:(i,n)=>{const a=me.getState().getGraphicsEngine();if(!a)return console.error("[ProjectStore] GraphicsEngine not initialized"),null;const o=a.updateSVGClip(i,n);if(o){const{project:l}=e();r({project:{...l,modifiedAt:Date.now()}})}else console.error(`[ProjectStore] Failed to update SVG clip ${i}`);return o||null},createStickerClip:i=>{const n=me.getState().getGraphicsEngine();if(!n)return console.error("GraphicsEngine not initialized"),null;const{project:a}=e();return a.timeline.tracks.find(l=>l.id===i.trackId)?(n.addStickerClip(i),r({project:{...a,modifiedAt:Date.now()}}),i):(console.error(`Track ${i.trackId} not found`),null)},getStickerClip:i=>{const n=me.getState().getGraphicsEngine();if(n)return n.getStickerClip(i)},deleteShapeClip:i=>{const n=me.getState().getGraphicsEngine();if(!n)return!1;const a=n.deleteShapeClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},deleteSVGClip:i=>{const n=me.getState().getGraphicsEngine();if(!n)return!1;const a=n.deleteSVGClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},deleteStickerClip:i=>{const n=me.getState().getGraphicsEngine();if(!n)return!1;const a=n.deleteStickerClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},deleteTextClip:i=>{const n=me.getState().getTitleEngine();if(!n)return!1;const a=n.deleteTextClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},createPhotoProject:(i,n,a)=>{const o=me.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const l=o.createProject(i,n,a),{photoProjects:d}=e();return d.set(l.id,l),r({photoProjects:new Map(d)}),l},importPhotoForEditing:(i,n)=>{const a=me.getState().getPhotoEngine();if(!a)return console.error("PhotoEngine not initialized"),null;const o=a.createProject(i.width,i.height,n||"Photo Edit"),l=a.importPhoto(o,i,n),{photoProjects:d}=e();return d.set(l.id,l),r({photoProjects:new Map(d)}),l},addPhotoLayer:(i,n)=>{const a=me.getState().getPhotoEngine();if(!a)return console.error("PhotoEngine not initialized"),null;const{photoProjects:o}=e(),l=o.get(i);if(!l)return console.error(`Photo project ${i} not found`),null;const d=a.addLayer(l,n);return o.set(i,d),r({photoProjects:new Map(o)}),d},removePhotoLayer:(i,n)=>{const a=me.getState().getPhotoEngine();if(!a)return console.error("PhotoEngine not initialized"),null;const{photoProjects:o}=e(),l=o.get(i);if(!l)return console.error(`Photo project ${i} not found`),null;const d=a.removeLayer(l,n);return o.set(i,d),r({photoProjects:new Map(o)}),d},reorderPhotoLayers:(i,n,a)=>{const o=me.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.reorderLayers(d,n,a);if(!u.success)return console.error(`Failed to reorder layers: ${u.error}`),null;const h={...d,layers:u.layers};return l.set(i,h),r({photoProjects:new Map(l)}),h},setPhotoLayerVisibility:(i,n,a)=>{const o=me.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.setLayerVisibility(d,n,a);return l.set(i,u),r({photoProjects:new Map(l)}),u},setPhotoLayerOpacity:(i,n,a)=>{const o=me.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.setLayerOpacity(d,n,a);return l.set(i,u),r({photoProjects:new Map(l)}),u},setPhotoLayerBlendMode:(i,n,a)=>{const o=me.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.setLayerBlendMode(d,n,a);return l.set(i,u),r({photoProjects:new Map(l)}),u},getPhotoProject:i=>{const{photoProjects:n}=e();return n.get(i)||null},addVideoEffect:(i,n,a)=>{const o=vr();if(!o.isInitialized())return console.error("EffectsBridge not initialized"),null;const l=o.applyVideoEffect(i,n,a);if(!l.success||!l.effectId)return console.error("Failed to add video effect:",l.error),null;const d=o.getEffect(i,l.effectId);if(d){const{project:u}=e(),h=o.getEffects(i),p=u.timeline.tracks.map(m=>({...m,clips:m.clips.map(f=>f.id===i?{...f,effects:h.length>0?[...h]:[...f.effects,d]}:f)}));r({project:{...u,timeline:{...u.timeline,tracks:p},modifiedAt:Date.now()}})}return d||null},updateVideoEffect:(i,n,a)=>{const o=vr();if(!o.isInitialized())return console.error("EffectsBridge not initialized"),null;const l=o.updateVideoEffect(i,n,a);if(!l.success)return console.error("Failed to update video effect:",l.error),null;const d=o.getEffect(i,n);if(d){const{project:u}=e(),h=u.timeline.tracks.map(p=>({...p,clips:p.clips.map(m=>{if(m.id===i){const f=m.effects.map(g=>g.id===n?{...g,params:{...g.params,...a}}:g);return{...m,effects:f}}return m})}));r({project:{...u,timeline:{...u.timeline,tracks:h},modifiedAt:Date.now()}})}return d||null},removeVideoEffect:(i,n)=>{const a=vr();if(!a.isInitialized())return console.error("EffectsBridge not initialized"),!1;const o=a.removeVideoEffect(i,n);if(!o.success)return console.error("Failed to remove video effect:",o.error),!1;const{project:l}=e(),d=a.getEffects(i),u=l.timeline.tracks.map(h=>({...h,clips:h.clips.map(p=>p.id===i?{...p,effects:[...d]}:p)}));return r({project:{...l,timeline:{...l.timeline,tracks:u},modifiedAt:Date.now()}}),!0},reorderVideoEffects:(i,n)=>{const a=vr();if(!a.isInitialized())return console.error("EffectsBridge not initialized"),!1;const o=a.reorderEffects(i,n);if(!o.success)return console.error("Failed to reorder video effects:",o.error),!1;const{project:l}=e(),d=a.getEffects(i),u=l.timeline.tracks.map(h=>({...h,clips:h.clips.map(p=>p.id===i?{...p,effects:[...d]}:p)}));return r({project:{...l,timeline:{...l.timeline,tracks:u},modifiedAt:Date.now()}}),!0},toggleVideoEffect:(i,n,a)=>{const o=vr();if(!o.isInitialized())return console.error("EffectsBridge not initialized"),null;const l=o.toggleEffect(i,n,a);if(!l.success)return console.error("Failed to toggle video effect:",l.error),null;const d=o.getEffect(i,n);if(d){const{project:u}=e(),h=u.timeline.tracks.map(p=>({...p,clips:p.clips.map(m=>m.id===i?{...m,effects:m.effects.map(f=>f.id===n?{...f,enabled:a}:f)}:m)}));r({project:{...u,timeline:{...u.timeline,tracks:h},modifiedAt:Date.now()}})}return d||null},getVideoEffects:i=>{const n=vr();return n.isInitialized()?n.getEffects(i):[]},getVideoEffect:(i,n)=>{const a=vr();if(a.isInitialized())return a.getEffect(i,n)},updateColorGrading:(i,n)=>{const a=vr();if(!a.isInitialized())return console.error("EffectsBridge not initialized"),!1;if(n.colorWheels){const o=a.applyColorWheels(i,n.colorWheels);if(!o.success)return console.error("Failed to apply color wheels:",o.error),!1}if(n.curves){const o=a.applyCurves(i,n.curves);if(!o.success)return console.error("Failed to apply curves:",o.error),!1}if(n.lut){const o=a.applyLUT(i,n.lut);if(!o.success)return console.error("Failed to apply LUT:",o.error),!1}if(n.hsl){const o=a.applyHSL(i,n.hsl);if(!o.success)return console.error("Failed to apply HSL:",o.error),!1}return r({project:{...e().project,modifiedAt:Date.now()}}),!0},getColorGrading:i=>{const n=vr();return n.isInitialized()?n.getColorGrading(i):{}},resetColorGrading:i=>{const n=vr();if(!n.isInitialized())return console.error("EffectsBridge not initialized"),!1;const a=n.resetColorGrading(i);return a.success?(r({project:{...e().project,modifiedAt:Date.now()}}),!0):(console.error("Failed to reset color grading:",a.error),!1)},addAudioEffect:(i,n)=>{const{project:a}=e();for(const o of a.timeline.tracks){const l=o.clips.findIndex(d=>d.id===i);if(l!==-1){const d=o.clips[l],h=[...d.audioEffects||[],n],p={...d,audioEffects:h},m=[...o.clips];m[l]=p;const f={...o,clips:m},g=a.timeline.tracks.map(x=>x.id===o.id?f:x),y={...a,timeline:{...a.timeline,tracks:g},modifiedAt:Date.now()};return r({project:y}),!0}}return!1},updateAudioEffect:(i,n,a)=>{const{project:o}=e();for(const l of o.timeline.tracks){const d=l.clips.findIndex(u=>u.id===i);if(d!==-1){const u=l.clips[d],h=u.audioEffects||[],p=h.findIndex(m=>m.id===n);if(p!==-1){const m=h[p],f={...m,params:{...m.params,...a}},g=[...h];g[p]=f;const y={...u,audioEffects:g},x=[...l.clips];x[d]=y;const v={...l,clips:x},b=o.timeline.tracks.map(k=>k.id===l.id?v:k),S={...o,timeline:{...o.timeline,tracks:b},modifiedAt:Date.now()};return r({project:S}),!0}}}return!1},removeAudioEffect:(i,n)=>{const{project:a}=e();for(const o of a.timeline.tracks){const l=o.clips.findIndex(d=>d.id===i);if(l!==-1){const d=o.clips[l],h=(d.audioEffects||[]).filter(x=>x.id!==n),p={...d,audioEffects:h},m=[...o.clips];m[l]=p;const f={...o,clips:m},g=a.timeline.tracks.map(x=>x.id===o.id?f:x),y={...a,timeline:{...a.timeline,tracks:g},modifiedAt:Date.now()};return r({project:y}),!0}}return!1},toggleAudioEffect:(i,n,a)=>{const{project:o}=e();for(const l of o.timeline.tracks){const d=l.clips.findIndex(u=>u.id===i);if(d!==-1){const u=l.clips[d],h=u.audioEffects||[],p=h.findIndex(m=>m.id===n);if(p!==-1){const f={...h[p],enabled:a},g=[...h];g[p]=f;const y={...u,audioEffects:g},x=[...l.clips];x[d]=y;const v={...l,clips:x},b=o.timeline.tracks.map(k=>k.id===l.id?v:k),S={...o,timeline:{...o.timeline,tracks:b},modifiedAt:Date.now()};return r({project:S}),!0}}}return!1},getAudioEffects:i=>{const{project:n}=e();for(const a of n.timeline.tracks){const o=a.clips.find(l=>l.id===i);if(o)return o.audioEffects||[]}return[]},updateClipKeyframes:(i,n)=>{const{project:a}=e(),o=me.getState().getGraphicsEngine();if(o){if(o.getShapeClip(i))return o.updateShapeClip(i,{keyframes:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(o.getSVGClip(i))return o.updateSVGClip(i,{keyframes:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}for(const l of a.timeline.tracks){const d=l.clips.findIndex(u=>u.id===i);if(d!==-1){const h={...l.clips[d],keyframes:n},p=[...l.clips];p[d]=h;const m={...l,clips:p},f=a.timeline.tracks.map(y=>y.id===l.id?m:y),g={...a,timeline:{...a.timeline,tracks:f},modifiedAt:Date.now()};return r({project:g}),!0}}return!1}}}));rS.registerLanguage("json",IN);const i7=({isOpen:r,onClose:e})=>{const{project:t}=U(),[s,i]=w.useState(""),[n,a]=w.useState(null),[o,l]=w.useState(!1),[d,u]=w.useState(!1),h=w.useMemo(()=>ZG(),[]),p=w.useMemo(()=>t9(h),[h]),m=w.useMemo(()=>{if(!t)return"";try{return p.exportToJsonWithMetadata(t,`Exported from ${t.name}`)}catch(v){return console.error("[ScriptView] Export failed:",v),`// Export error: ${v instanceof Error?v.message:"Unknown serialization error"}`}},[t,p]),f=w.useCallback(async()=>{try{await navigator.clipboard.writeText(m),u(!0),setTimeout(()=>u(!1),2e3)}catch(v){console.error("Failed to copy:",v)}},[m]),g=w.useCallback(()=>{const v=new Blob([m],{type:"application/json"}),b=URL.createObjectURL(v),S=document.createElement("a");S.href=b,S.download=`${t?.name||"project"}-script.json`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(b)},[m,t?.name]),y=w.useCallback(()=>{l(!0);try{const v=p.validateProjectJson(s);a(v)}catch(v){a({valid:!1,errors:[`Validation error: ${v instanceof Error?v.message:"Unknown error"}`],warnings:[]})}finally{l(!1)}},[s,p]),x=w.useCallback(()=>{if(n?.valid)try{const{project:v}=p.importFromJsonWithValidation(s);v&&(U.getState().loadProject(v),e())}catch(v){a({valid:!1,errors:[`Import error: ${v instanceof Error?v.message:"Unknown error"}`],warnings:[]})}},[s,n,p,e]);return r?c.jsx(Ea,{open:!0,onOpenChange:v=>!v&&e(),children:c.jsxs(En,{className:"max-w-6xl max-h-[90vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsx(Ma,{className:"p-4 border-b border-border space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Uc,{size:20,className:"text-primary"}),c.jsxs("div",{children:[c.jsx(Pa,{className:"text-lg font-semibold text-text-primary",children:"Script View"}),c.jsx(ku,{className:"text-xs text-text-muted",children:"View and import project JSON"})]})]})}),c.jsxs(vb,{defaultValue:"view",className:"flex-1 flex flex-col overflow-hidden",children:[c.jsxs(wb,{className:"flex gap-1 p-2 border-b border-border bg-transparent rounded-none justify-start",children:[c.jsx(Jd,{value:"view",className:"px-4 py-2 rounded-lg text-sm font-medium data-[state=active]:bg-background-tertiary data-[state=active]:text-text-primary text-text-secondary hover:text-text-primary hover:bg-background-elevated",children:"View & Export"}),c.jsx(Jd,{value:"import",className:"px-4 py-2 rounded-lg text-sm font-medium data-[state=active]:bg-background-tertiary data-[state=active]:text-text-primary text-text-secondary hover:text-text-primary hover:bg-background-elevated",children:"Import"})]}),c.jsxs(Zd,{value:"view",className:"flex-1 flex flex-col overflow-hidden mt-0",children:[c.jsxs("div",{className:"flex gap-2 p-3 border-b border-border",children:[c.jsx(Rt,{variant:"outline",size:"sm",onClick:f,children:d?c.jsxs(c.Fragment,{children:[c.jsx(b0,{size:16,className:"text-primary"}),"Copied!"]}):c.jsxs(c.Fragment,{children:[c.jsx(Eo,{size:16}),"Copy"]})}),c.jsxs(Rt,{variant:"outline",size:"sm",onClick:g,children:[c.jsx(Ix,{size:16}),"Download"]}),c.jsx("div",{className:"flex-1"}),c.jsxs("a",{href:"/was/openreel_video/app/llm.txt",download:"openreel-llm-documentation.txt",className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg text-sm transition-colors",children:[c.jsx(Uc,{size:16}),"Download LLM.txt"]})]}),c.jsx("div",{className:"flex-1 overflow-auto custom-scrollbar p-4",children:c.jsx("div",{className:"rounded-lg overflow-hidden border border-border",children:c.jsx(rS,{language:"json",style:DN,showLineNumbers:!0,customStyle:{margin:0,padding:"1rem",background:"#1e1e1e",fontSize:"12px"},children:m})})})]}),c.jsxs(Zd,{value:"import",className:"flex-1 flex flex-col gap-4 p-4 overflow-auto mt-0",children:[c.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[c.jsx("label",{className:"text-sm font-medium text-text-secondary",children:"Paste JSON"}),c.jsx("textarea",{value:s,onChange:v=>i(v.target.value),placeholder:"Paste project JSON here...",className:"flex-1 p-3 bg-background-tertiary border border-border rounded-lg text-text-primary font-mono text-xs resize-none focus:outline-none focus:border-primary"})]}),c.jsx(Rt,{variant:"outline",onClick:y,disabled:!s||o,children:o?"Validating...":"Validate"}),n&&c.jsxs("div",{className:"space-y-2",children:[n.valid&&c.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 border border-primary/30 rounded-lg",children:[c.jsx(b0,{size:16,className:"text-primary"}),c.jsx("span",{className:"text-sm text-primary",children:"Valid JSON - Ready to import"})]}),n.errors.length>0&&c.jsxs("div",{className:"p-3 bg-error/10 border border-error/30 rounded-lg space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2 text-error font-medium text-sm",children:[c.jsx(_o,{size:16}),"Errors"]}),c.jsx("ul",{className:"list-disc list-inside text-xs text-error/80 space-y-0.5",children:n.errors.map((v,b)=>c.jsx("li",{children:v},b))})]}),n.warnings.length>0&&c.jsxs("div",{className:"p-3 bg-warning/10 border border-warning/30 rounded-lg space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2 text-warning font-medium text-sm",children:[c.jsx(Po,{size:16}),"Warnings"]}),c.jsx("ul",{className:"list-disc list-inside text-xs text-warning/80 space-y-0.5",children:n.warnings.map((v,b)=>c.jsx("li",{children:v},b))})]}),n.missingAssets&&n.missingAssets.length>0&&c.jsxs("div",{className:"p-3 bg-background-tertiary border border-border rounded-lg space-y-1",children:[c.jsxs("div",{className:"text-sm font-medium text-text-secondary",children:["Missing Assets (",n.missingAssets.length,")"]}),c.jsx("p",{className:"text-xs text-text-muted",children:"These assets will be imported as placeholders and can be replaced later."})]})]}),c.jsxs(Rt,{onClick:x,disabled:!n?.valid,children:[c.jsx(Kp,{size:16}),"Import Project"]})]})]})]})}):null},p2={playPause:"Space",undo:"Meta+z",redo:"Meta+Shift+z",delete:"Backspace",split:"s",copy:"Meta+c",paste:"Meta+v",cut:"Meta+x",selectAll:"Meta+a",zoomIn:"=",zoomOut:"-",zoomFit:"Shift+z"},r7={enabled:!0,snapToGrid:!0,snapToClips:!0,snapToPlayhead:!0,snapToMarkers:!0,gridSize:1,snapThreshold:10},n7={mediaLibrary:{visible:!0,width:300},inspector:{visible:!0,width:300},effects:{visible:!1,width:300},audioMixer:{visible:!1,width:300},colorGrading:{visible:!1,width:400},subtitles:{visible:!1,width:300}},ft=Ta()(Op(nS((r,e)=>({selectedItems:[],lastSelectedItem:null,snapSettings:r7,panels:n7,shortcuts:p2,theme:"dark",showWaveforms:!0,showThumbnails:!0,showKeyframes:!0,autoScroll:!0,activeModal:null,modalData:null,contextMenu:null,isDragging:!1,dragType:null,dragData:null,cropMode:!1,cropClipId:null,motionPathMode:!1,motionPathClipId:null,keyframeEditorOpen:!1,showWelcomeScreen:!0,skipWelcomeScreen:!1,exportState:{isExporting:!1,progress:0,phase:""},setExportState:t=>r({exportState:t}),select:(t,s=!1)=>{const{selectedItems:i}=e();s?i.some(a=>a.id===t.id)||r({selectedItems:[...i,t],lastSelectedItem:t}):r({selectedItems:[t],lastSelectedItem:t})},selectMultiple:t=>{r({selectedItems:t,lastSelectedItem:t.length>0?t[t.length-1]:null})},deselect:t=>{const{selectedItems:s,lastSelectedItem:i}=e(),n=s.filter(a=>a.id!==t);r({selectedItems:n,lastSelectedItem:i?.id===t?n.length>0?n[n.length-1]:null:i})},clearSelection:()=>{r({selectedItems:[],lastSelectedItem:null})},isSelected:t=>{const{selectedItems:s}=e();return s.some(i=>i.id===t)},getSelectedClipIds:()=>{const{selectedItems:t}=e();return t.filter(s=>s.type==="clip"||s.type==="text-clip"||s.type==="shape-clip").map(s=>s.id)},getSelectedTrackIds:()=>{const{selectedItems:t}=e();return t.filter(s=>s.type==="track").map(s=>s.id)},setSnapEnabled:t=>{r(s=>({snapSettings:{...s.snapSettings,enabled:t}}))},setSnapToGrid:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToGrid:t}}))},setSnapToClips:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToClips:t}}))},setSnapToPlayhead:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToPlayhead:t}}))},setSnapToMarkers:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToMarkers:t}}))},setGridSize:t=>{r(s=>({snapSettings:{...s.snapSettings,gridSize:Math.max(.01,t)}}))},setSnapThreshold:t=>{r(s=>({snapSettings:{...s.snapSettings,snapThreshold:Math.max(1,t)}}))},toggleSnap:()=>{r(t=>({snapSettings:{...t.snapSettings,enabled:!t.snapSettings.enabled}}))},togglePanel:t=>{r(s=>({panels:{...s.panels,[t]:{...s.panels[t],visible:!s.panels[t].visible}}}))},setPanelVisible:(t,s)=>{r(i=>({panels:{...i.panels,[t]:{...i.panels[t],visible:s}}}))},setPanelWidth:(t,s)=>{r(i=>({panels:{...i.panels,[t]:{...i.panels[t],width:Math.max(200,Math.min(800,s))}}}))},setPanelCollapsed:(t,s)=>{r(i=>({panels:{...i.panels,[t]:{...i.panels[t],collapsed:s}}}))},setShortcut:(t,s)=>{r(i=>({shortcuts:{...i.shortcuts,[t]:s}}))},resetShortcuts:()=>{r({shortcuts:p2})},setTheme:t=>{r({theme:t})},setShowWaveforms:t=>{r({showWaveforms:t})},setShowThumbnails:t=>{r({showThumbnails:t})},setShowKeyframes:t=>{r({showKeyframes:t})},setAutoScroll:t=>{r({autoScroll:t})},openModal:(t,s)=>{r({activeModal:t,modalData:s||null})},closeModal:()=>{r({activeModal:null,modalData:null})},showContextMenu:(t,s,i)=>{r({contextMenu:{visible:!0,x:t,y:s,items:i}})},hideContextMenu:()=>{r({contextMenu:null})},startDrag:(t,s)=>{r({isDragging:!0,dragType:t,dragData:s})},endDrag:()=>{r({isDragging:!1,dragType:null,dragData:null})},setCropMode:(t,s)=>{r({cropMode:t,cropClipId:t&&s||null})},setMotionPathMode:(t,s)=>{r({motionPathMode:t,motionPathClipId:t&&s||null})},setKeyframeEditorOpen:t=>{r({keyframeEditorOpen:t})},toggleKeyframeEditor:()=>{r(t=>({keyframeEditorOpen:!t.keyframeEditorOpen}))},setShowWelcomeScreen:t=>{r({showWelcomeScreen:t})},setSkipWelcomeScreen:t=>{r({skipWelcomeScreen:t,showWelcomeScreen:t?!1:e().showWelcomeScreen})},renderEngine:"browser",setRenderEngine:t=>{r({renderEngine:t})}}),{name:"openreel-ui-preferences",partialize:r=>({snapSettings:r.snapSettings,panels:r.panels,shortcuts:r.shortcuts,theme:r.theme,showWaveforms:r.showWaveforms,showThumbnails:r.showThumbnails,showKeyframes:r.showKeyframes,autoScroll:r.autoScroll,skipWelcomeScreen:r.skipWelcomeScreen,renderEngine:r.renderEngine})}))),a7=[{id:"transform",name:"Transform",category:"Position & Size",keywords:["position","scale","rotate","move","resize","transform"],icon:ua,description:"Position, scale, and rotate the clip",sectionId:"transform",clipTypes:["video","image","text","shape"]},{id:"crop",name:"Crop",category:"Position & Size",keywords:["crop","cut","trim","frame","aspect"],icon:zL,description:"Crop and frame the clip",sectionId:"crop",clipTypes:["video","image"]},{id:"speed",name:"Speed Control",category:"Time",keywords:["speed","slow","fast","time","duration","playback"],icon:pi,description:"Control playback speed and time remapping",sectionId:"speed",clipTypes:["video","audio"]},{id:"video-effects",name:"Video Effects",category:"Video",keywords:["brightness","contrast","saturation","blur","sharpen","vignette","effects"],icon:Mh,description:"Brightness, contrast, saturation, blur, sharpen",sectionId:"video-effects",clipTypes:["video","image"]},{id:"color-grading",name:"Color Grading",category:"Video",keywords:["color","grade","wheels","curves","lut","hsl","exposure","temperature"],icon:Ud,description:"Color wheels, curves, LUTs, and HSL adjustments",sectionId:"color-grading",clipTypes:["video","image"]},{id:"green-screen",name:"Green Screen",category:"Video",keywords:["green","screen","chroma","key","background","remove"],icon:Yr,description:"Chroma key for green/blue screen removal",sectionId:"green-screen",clipTypes:["video","image"]},{id:"background-removal",name:"Background Removal",category:"Video",keywords:["background","remove","ai","mask","cutout","person"],icon:I$,description:"AI-powered background removal",sectionId:"background-removal",clipTypes:["video","image"]},{id:"masking",name:"Masking",category:"Video",keywords:["mask","shape","feather","reveal","hide","vignette"],icon:Gs,description:"Shape masks to reveal or hide areas",sectionId:"masking",clipTypes:["video","image"]},{id:"motion-tracking",name:"Motion Tracking",category:"Video",keywords:["motion","track","follow","pin","stabilize"],icon:ua,description:"Track motion and attach elements",sectionId:"motion-tracking",clipTypes:["video"]},{id:"pip",name:"Picture-in-Picture",category:"Video",keywords:["pip","picture","overlay","corner","position"],icon:rs,description:"Position clips as picture-in-picture overlays",sectionId:"pip",clipTypes:["video","image"]},{id:"blending",name:"Blend Mode",category:"Video",keywords:["blend","mode","multiply","screen","overlay","opacity"],icon:Gs,description:"Blend modes and opacity controls",sectionId:"blending",clipTypes:["video","image"]},{id:"transform-3d",name:"3D Transform",category:"Video",keywords:["3d","perspective","rotate","flip","tilt"],icon:ua,description:"3D rotation and perspective effects",sectionId:"transform-3d",clipTypes:["video","image"]},{id:"keyframes",name:"Keyframes",category:"Animation",keywords:["keyframe","animate","animation","ease","interpolate"],icon:zs,description:"Animate properties over time",sectionId:"keyframes",clipTypes:["video","image","text","shape"]},{id:"transitions",name:"Transitions",category:"Animation",keywords:["transition","fade","dissolve","wipe","slide"],icon:zs,description:"Clip-to-clip transitions",sectionId:"transitions",clipTypes:["video","image"]},{id:"motion-presets",name:"Motion Presets",category:"Animation",keywords:["motion","preset","zoom","pan","shake","bounce"],icon:zs,description:"Pre-built motion animations",sectionId:"motion-presets",clipTypes:["video","image"]},{id:"audio-effects",name:"Audio Effects",category:"Audio",keywords:["audio","eq","equalizer","compressor","reverb","delay","sound"],icon:k0,description:"EQ, compressor, reverb, and more",sectionId:"audio-effects",clipTypes:["audio","video"]},{id:"audio-ducking",name:"Audio Ducking",category:"Audio",keywords:["duck","ducking","voice","music","fade","auto"],icon:k0,description:"Auto-duck music under voice",sectionId:"audio-ducking",clipTypes:["audio","video"]},{id:"text-properties",name:"Text Properties",category:"Text",keywords:["text","font","size","color","style","typography"],icon:Vs,description:"Font, size, color, and text styling",sectionId:"text-properties",clipTypes:["text"]},{id:"text-animation",name:"Text Animation",category:"Text",keywords:["text","animate","typewriter","fade","slide","bounce"],icon:Vs,description:"Animate text with presets",sectionId:"text-animation",clipTypes:["text"]},{id:"shape-properties",name:"Shape Properties",category:"Shapes",keywords:["shape","fill","stroke","corner","radius","shadow"],icon:rs,description:"Shape fill, stroke, and effects",sectionId:"shape-properties",clipTypes:["shape"]}],o7=[{id:"all",name:"All"},{id:"video",name:"Video",icon:Wc},{id:"audio",name:"Audio",icon:k0},{id:"text",name:"Text",icon:Vs},{id:"animation",name:"Animation",icon:zs}],c7=({isOpen:r,onClose:e})=>{const[t,s]=w.useState(""),[i,n]=w.useState("all"),[a,o]=w.useState(0),l=w.useRef(null),d=w.useRef(null),{selectedItems:u,setPanelVisible:h}=ft(),p=w.useMemo(()=>{const g=u.find(y=>y.type==="clip"||y.type==="text-clip"||y.type==="shape-clip");return g?g.type==="text-clip"?"text":g.type==="shape-clip"?"shape":"video":null},[u]),m=w.useMemo(()=>{let g=a7;if(p&&(g=g.filter(y=>y.clipTypes.includes(p))),i!=="all"&&(g=g.filter(y=>y.category.toLowerCase().includes(i.toLowerCase()))),t.trim()){const y=t.toLowerCase().split(" ");g=g.filter(x=>{const v=[x.name,x.description,...x.keywords,x.category].join(" ").toLowerCase();return y.every(b=>v.includes(b))})}return g},[t,i,p]),f=w.useCallback(g=>{h("inspector",!0),setTimeout(()=>{const y=document.querySelector(`[data-section-id="${g.sectionId}"]`);if(y){y.scrollIntoView({behavior:"smooth",block:"start"});const x=y.querySelector("button");x&&x.click(),y.classList.add("ring-2","ring-primary","ring-offset-2"),setTimeout(()=>{y.classList.remove("ring-2","ring-primary","ring-offset-2")},2e3)}},100),e()},[e,h]);return w.useEffect(()=>{r&&l.current&&l.current.focus()},[r]),w.useEffect(()=>{o(0)},[t,i]),w.useEffect(()=>{if(!r)return;const g=y=>{y.key==="Escape"?e():y.key==="ArrowDown"?(y.preventDefault(),o(x=>Math.min(x+1,m.length-1))):y.key==="ArrowUp"?(y.preventDefault(),o(x=>Math.max(x-1,0))):y.key==="Enter"&&m[a]&&(y.preventDefault(),f(m[a]))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[r,e,m,a,f]),w.useEffect(()=>{if(d.current&&m[a]){const g=d.current.children[a];g&&g.scrollIntoView({behavior:"smooth",block:"nearest"})}},[a,m]),r?c.jsx(Ea,{open:!0,onOpenChange:g=>!g&&e(),children:c.jsxs(En,{className:"max-w-2xl p-0 gap-0 top-[15vh] translate-y-0 bg-background-secondary border-border rounded-2xl overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-border",children:[c.jsx(Mo,{size:18,className:"text-text-muted"}),c.jsx(Ns,{ref:l,type:"text",value:t,onChange:g=>s(g.target.value),placeholder:p?`Search effects for ${p} clip...`:"Search all effects and tools...",className:"flex-1 bg-transparent border-0 text-text-primary focus-visible:ring-0"}),t&&c.jsx("button",{onClick:()=>s(""),className:"p-1 rounded hover:bg-background-tertiary text-text-muted hover:text-text-primary transition-colors",children:c.jsx(ti,{size:14})}),c.jsx("div",{className:"flex items-center gap-1 px-2 py-1 rounded bg-background-tertiary border border-border",children:c.jsx("span",{className:"text-[10px] text-text-muted",children:"ESC"})})]}),c.jsx("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border bg-background-tertiary/50",children:o7.map(g=>c.jsx("button",{onClick:()=>n(g.id),className:`px-3 py-1.5 rounded-lg text-[11px] font-medium transition-all ${i===g.id?"bg-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:g.name},g.id))}),c.jsx("div",{ref:d,className:"max-h-[50vh] overflow-y-auto",children:m.length===0?c.jsxs("div",{className:"py-12 text-center",children:[c.jsx(Mo,{size:32,className:"mx-auto mb-3 text-text-muted opacity-50"}),c.jsx("p",{className:"text-sm text-text-muted",children:"No effects found"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Try a different search term or category"})]}):c.jsx("div",{className:"py-2",children:m.map((g,y)=>{const x=g.icon;return c.jsxs("button",{onClick:()=>f(g),className:`w-full flex items-center gap-4 px-4 py-3 text-left transition-all ${y===a?"bg-primary/10 border-l-2 border-primary":"hover:bg-background-tertiary border-l-2 border-transparent"}`,children:[c.jsx("div",{className:`p-2 rounded-lg ${y===a?"bg-primary text-white":"bg-background-tertiary text-text-secondary"}`,children:c.jsx(x,{size:16})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:`text-sm font-medium ${y===a?"text-primary":"text-text-primary"}`,children:g.name}),c.jsx("span",{className:"text-[10px] text-text-muted px-1.5 py-0.5 rounded bg-background-tertiary",children:g.category})]}),c.jsx("p",{className:"text-xs text-text-muted mt-0.5 truncate",children:g.description})]}),c.jsx("div",{className:"text-[10px] text-text-muted",children:" to select"})]},g.id)})})}),c.jsxs("div",{className:"px-4 py-2 border-t border-border bg-background-tertiary/50 flex items-center justify-between",children:[c.jsxs("div",{className:"text-[10px] text-text-muted",children:[m.length," effect",m.length!==1?"s":""," available"]}),c.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-muted",children:[c.jsx("span",{children:" Navigate"}),c.jsx("span",{children:" Select"}),c.jsx("span",{children:"ESC Close"})]})]})]})}):null};function l7(){const[r,e]=w.useState(!1);return w.useEffect(()=>{const t=()=>{const s=navigator.userAgent.toLowerCase(),n=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i.test(s),a=window.innerWidth<768;e(n||a)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),r?c.jsx("div",{className:"fixed inset-0 z-[9999] bg-background flex items-center justify-center p-6",children:c.jsxs("div",{className:"max-w-md text-center space-y-8",children:[c.jsx("div",{className:"flex justify-center",children:c.jsx("div",{className:"bg-background-secondary border-2 border-primary/30 rounded-2xl p-8 shadow-glow-lg",children:c.jsx(ji,{className:"w-20 h-20 text-primary",strokeWidth:1.5})})}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("h1",{className:"text-5xl font-bold text-text-primary tracking-tight",children:"OpenReel"}),c.jsxs("div",{className:"flex items-center justify-center gap-2",children:[c.jsx("div",{className:"h-px w-8 bg-primary/50"}),c.jsx("p",{className:"text-lg text-text-secondary font-medium",children:"Desktop Only"}),c.jsx("div",{className:"h-px w-8 bg-primary/50"})]})]}),c.jsxs("div",{className:"space-y-4 bg-background-secondary/50 backdrop-blur-sm rounded-xl p-6 border border-border",children:[c.jsx("p",{className:"text-base text-text-primary leading-relaxed",children:"OpenReel is a professional video editor that requires a desktop or laptop computer."}),c.jsx("p",{className:"text-sm text-text-muted",children:"Please visit this page on your desktop or laptop to start creating amazing videos."})]}),c.jsx("div",{className:"pt-2",children:c.jsx("a",{href:"https://openreel.video",className:"inline-flex items-center gap-2 px-8 py-3 bg-primary hover:bg-primary-hover active:bg-primary-active text-white font-medium rounded-lg transition-all duration-200 shadow-glow hover:shadow-glow-lg transform hover:scale-[1.02] active:scale-[0.98]",children:"Learn More"})})]})}):null}const d7="https://openreel-cloud.niiyeboah1996.workers.dev";class u7{apiUrl;constructor(e=d7){this.apiUrl=e}async listTemplates(){try{const e=await fetch(`${this.apiUrl}/templates`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).templates||[]}catch(e){return console.error("Failed to list templates from cloud:",e),[]}}async getTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates/${e}`);if(!t.ok){if(t.status===404)return null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Failed to get template ${e} from cloud:`,t),null}}async uploadTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();return t.ok?{success:!0}:{success:!1,error:s.error||"Upload failed"}}catch(t){return console.error("Failed to upload template to cloud:",t),{success:!1,error:t instanceof Error?t.message:"Upload failed"}}}async deleteTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates/${e}`,{method:"DELETE"}),s=await t.json();return t.ok?{success:!0}:{success:!1,error:s.error||"Delete failed"}}catch(t){return console.error(`Failed to delete template ${e} from cloud:`,t),{success:!1,error:t instanceof Error?t.message:"Delete failed"}}}async checkHealth(){try{return(await fetch(`${this.apiUrl}/health`)).ok}catch{return!1}}async listScriptableTemplates(){try{const e=await fetch(`${this.apiUrl}/templates/scriptable`);return e.ok?(await e.json()).templates||[]:[]}catch(e){return console.error("Failed to list scriptable templates from cloud:",e),[]}}async getScriptableTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates/scriptable/${e}`);if(!t.ok){if(t.status===404)return null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Failed to get scriptable template ${e} from cloud:`,t),null}}}const h7=new u7,m2={tiktok:Si,"instagram-reels":Si,"instagram-stories":Si,"instagram-post":rs,"youtube-shorts":Si,"youtube-video":ji,facebook:E$,twitter:GB,linkedin:QB,pinterest:x0,intro:ii,outro:ii,promo:xa,"lower-third":Vs,slideshow:Gs,custom:Gc,all:Fx},p7=["TikTok","Instagram","YouTube","General"],uh={TikTok:["tiktok"],Instagram:["instagram-reels","instagram-stories","instagram-post"],YouTube:["youtube-shorts","youtube-video"],General:["intro","outro","promo","lower-third","slideshow","custom"]},m7=({selectedCategory:r,onSelectCategory:e,categoryStats:t})=>{const[s,i]=He.useState(null),n=a=>{if(s===a)i(null);else{i(a);const o=uh[a];o&&o.length===1&&e(o[0])}};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:[c.jsxs("button",{onClick:()=>{e("all"),i(null)},className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-all duration-200 ${r==="all"?"bg-primary text-black":"bg-background-tertiary text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:[c.jsx(Fx,{size:14}),"All",c.jsx("span",{className:`text-xs ${r==="all"?"text-black/60":"text-text-muted"}`,children:t.all||0})]}),p7.map(a=>{const o=uh[a],l=s===a,d=o.includes(r),u=m2[o[0]]||rs,h=o.reduce((p,m)=>p+(t[m]||0),0);return c.jsxs("button",{onClick:()=>n(a),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-all duration-200 ${d||l?"bg-primary text-black":"bg-background-tertiary text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:[c.jsx(u,{size:14}),a,h>0&&c.jsx("span",{className:`text-xs ${d||l?"text-black/60":"text-text-muted"}`,children:h})]},a)})]}),s&&uh[s].length>1&&c.jsx("div",{className:"flex items-center gap-2 pl-2 overflow-x-auto pb-1",children:uh[s].map(a=>{const o=uM.find(u=>u.id===a),l=t[a]||0,d=m2[a]||rs;return c.jsxs("button",{onClick:()=>e(a),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-all duration-200 ${r===a?"bg-primary/20 text-primary border border-primary/30":"bg-background text-text-muted hover:text-text-secondary hover:bg-background-tertiary"}`,children:[c.jsx(d,{size:12}),o?.name||a,l>0&&c.jsx("span",{className:`text-[10px] ${r===a?"text-primary/70":"text-text-muted"}`,children:l})]},a)})})]})},f7={tiktok:Si,"instagram-reels":Si,"instagram-stories":Si,"instagram-post":rs,"youtube-shorts":Si,"youtube-video":ji,facebook:rs,twitter:ji,linkedin:ji,pinterest:Si,intro:ii,outro:ii,promo:xa,"lower-third":ji,slideshow:Gs,custom:rs},g7={tiktok:"from-pink-500 to-cyan-500","instagram-reels":"from-purple-500 to-pink-500","instagram-stories":"from-amber-500 to-pink-500","instagram-post":"from-purple-500 to-pink-500","youtube-shorts":"from-red-500 to-orange-500","youtube-video":"from-red-600 to-red-400",facebook:"from-blue-600 to-blue-400",twitter:"from-sky-500 to-blue-500",linkedin:"from-blue-700 to-blue-500",pinterest:"from-red-500 to-rose-400",intro:"from-emerald-500 to-green-500",outro:"from-green-500 to-emerald-500",promo:"from-amber-500 to-orange-500","lower-third":"from-emerald-500 to-teal-500",slideshow:"from-teal-500 to-cyan-500",custom:"from-zinc-500 to-zinc-400"},y7=({template:r,onClick:e})=>{const[t,s]=w.useState(!1),i=r.socialCategory||"custom",n=kp[i],a=n&&n.height>n.width,o=f7[i]||rs,l=g7[i]||"from-primary to-emerald-500",d=u=>{if(u<60)return`${u}s`;const h=Math.floor(u/60),p=u%60;return p>0?`${h}m ${p}s`:`${h}m`};return c.jsxs("button",{onClick:e,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),className:"group relative flex flex-col rounded-xl bg-background-tertiary border border-border overflow-hidden transition-all duration-200 hover:bg-background-elevated hover:border-border-hover hover:shadow-lg hover:-translate-y-0.5",children:[c.jsxs("div",{className:`relative flex items-center justify-center overflow-hidden ${a?"aspect-[9/16] max-h-48":"aspect-video"}`,children:[r.thumbnailUrl?c.jsx("img",{src:r.thumbnailUrl,alt:r.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}):c.jsx("div",{className:`w-full h-full bg-gradient-to-br ${l} opacity-40 flex items-center justify-center`,children:c.jsx(o,{size:32,className:"text-text-primary opacity-60 group-hover:opacity-80 transition-all duration-200"})}),c.jsx("div",{className:`absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent transition-opacity duration-200 ${t?"opacity-100":"opacity-0"}`}),r.previewVideoUrl&&t&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:"w-11 h-11 rounded-full bg-background/80 backdrop-blur-sm flex items-center justify-center border border-border",children:c.jsx(ii,{size:18,className:"text-text-primary ml-0.5",fill:"currentColor"})})}),r.featured&&c.jsxs("div",{className:"absolute top-2 left-2 px-2 py-0.5 bg-amber-500 text-black text-[10px] font-semibold rounded-full flex items-center gap-1",children:[c.jsx(xa,{size:10,fill:"currentColor"}),"Featured"]}),r.premium&&c.jsxs("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-primary text-black text-[10px] font-semibold rounded-full flex items-center gap-1",children:[c.jsx(TL,{size:10}),"Pro"]})]}),c.jsxs("div",{className:"p-3 text-left",children:[c.jsx("h3",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:r.name}),c.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] text-text-muted",children:[c.jsx(pi,{size:11}),c.jsx("span",{children:d(r.timeline.duration)})]}),c.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] text-text-muted",children:[c.jsx(Gs,{size:11}),c.jsxs("span",{children:[r.placeholders.length," editable"]})]})]}),r.tags.length>0&&c.jsxs("div",{className:"flex items-center gap-1.5 mt-2 overflow-hidden",children:[r.tags.slice(0,2).map(u=>c.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-background rounded text-text-muted",children:u},u)),r.tags.length>2&&c.jsxs("span",{className:"text-[10px] text-text-muted",children:["+",r.tags.length-2]})]})]})]})};function lm(){const r=VD(),e=w.useCallback((s,i)=>{r&&r.capture(s,i)},[r]),t=w.useCallback((s,i)=>{r&&r.identify(s,i)},[r]);return{track:e,identify:t,isEnabled:!!r}}const Ic={PROJECT_CREATED:"project_created",PROJECT_OPENED:"project_opened",PROJECT_EXPORTED:"project_exported",CLIP_ADDED:"clip_added",TEXT_ADDED:"text_added",EFFECT_APPLIED:"effect_applied",PARTICLE_EFFECT_ADDED:"particle_effect_added",TEMPLATE_USED:"template_used"},x7={text:Vs,media:No,subtitle:Vs,shape:Gs,effect:Mh,transform:Mh,keyframe:Mh,color:Ud,number:QL,boolean:b$,audio:qr,style:Ud,font:Vs,animation:ii},b7=({template:r,onClose:e,onApply:t})=>{const s=me(b=>b.getTemplateEngine),i=me(b=>b.getTitleEngine),n=U(b=>b.loadProject),{track:a}=lm(),[o,l]=w.useState({}),[d,u]=w.useState(!1),[h,p]=w.useState(null),[m,f]=w.useState(!1),g=w.useMemo(()=>{const b={main:[],advanced:[]};for(const S of r.placeholders)S.uiHints?.advanced?b.advanced.push(S):b.main.push(S);return b},[r.placeholders]),y=w.useCallback((b,S,k)=>{l(C=>({...C,[b]:{type:k,value:S}}))},[]),x=w.useCallback(async()=>{u(!0),p(null);try{const b=await s(),S=i(),k={...o};for(const j of r.placeholders)!k[j.id]&&j.defaultValue!==void 0&&(k[j.id]={type:j.type,value:j.defaultValue});const{project:C,result:A,textClips:T}=b.applyScriptableTemplate(r,k);if(!A.success&&A.errors.length>0){p(A.errors.map(j=>j.message).join(", ")),u(!1);return}if(S&&T.length>0)for(const j of T){const _=r.placeholders.find(E=>E.id===j.placeholderId),M=_?.label?.toLowerCase().includes("title")||_?.label?.toLowerCase().includes("headline");S.createTextClip({id:j.id,trackId:j.trackId,text:j.text,startTime:j.startTime,duration:j.duration,style:{fontFamily:"Inter",fontSize:M?48:32,fontWeight:600,fontStyle:"normal",color:"#ffffff",textAlign:"center",verticalAlign:"middle",letterSpacing:0,lineHeight:1.2},transform:j.transform,animation:{preset:"fade",params:{easing:"ease-out"},inDuration:.5,outDuration:.3}})}n({...C,modifiedAt:Date.now()}),a(Ic.TEMPLATE_USED,{templateId:r.id,templateName:r.name,category:r.category,placeholderCount:r.placeholders.length}),t()}catch(b){p(b instanceof Error?b.message:"Failed to apply template")}finally{u(!1)}},[s,i,n,r,o,t,a]),v=b=>{if(b<60)return`${b}s`;const S=Math.floor(b/60),k=b%60;return k>0?`${S}m ${k}s`:`${S}m`};return c.jsx(Ea,{open:!0,onOpenChange:b=>!b&&e(),children:c.jsxs(En,{className:"max-w-3xl max-h-[90vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsxs(Ma,{className:"p-5 border-b border-border space-y-0 shrink-0",children:[c.jsx(Pa,{className:"text-lg font-semibold text-text-primary",children:r.name}),c.jsx(ku,{asChild:!0,children:c.jsxs("div",{className:"flex items-center gap-4 mt-1.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-muted",children:[c.jsx(pi,{size:12}),c.jsx("span",{children:v(r.timeline.duration)})]}),c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-muted",children:[c.jsx(Gs,{size:12}),c.jsxs("span",{children:[r.placeholders.length," editable fields"]})]})]})})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:c.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("div",{className:"aspect-video bg-background rounded-xl overflow-hidden mb-4 border border-border",children:r.thumbnailUrl?c.jsx("img",{src:r.thumbnailUrl,alt:r.name,className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 to-emerald-500/20 flex items-center justify-center",children:c.jsx(ii,{size:40,className:"text-text-muted"})})}),r.description&&c.jsx("p",{className:"text-sm text-text-secondary mb-4",children:r.description}),r.scenes&&r.scenes.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("h3",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Scenes"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:r.scenes.map(b=>c.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg text-xs border border-border",children:[c.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:b.color||"#22c55e"}}),c.jsx("span",{className:"text-text-secondary",children:b.label}),c.jsxs("span",{className:"text-text-muted",children:["(",v(b.endTime-b.startTime),")"]})]},b.id))})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"Customize Template"}),g.main.length>0&&c.jsx("div",{className:"space-y-4",children:g.main.map(b=>c.jsx(f2,{placeholder:b,value:o[b.id]?.value,onChange:S=>y(b.id,S,b.type)},b.id))}),g.advanced.length>0&&c.jsxs(Kd,{open:m,onOpenChange:f,children:[c.jsxs(wp,{className:"text-xs text-text-muted cursor-pointer hover:text-text-secondary transition-colors flex items-center gap-1",children:[c.jsx(ei,{size:12,className:`transition-transform ${m?"rotate-90":""}`}),"Advanced Options (",g.advanced.length,")"]}),c.jsx(Qd,{className:"mt-4 space-y-4 pl-4 border-l border-border",children:g.advanced.map(b=>c.jsx(f2,{placeholder:b,value:o[b.id]?.value,onChange:S=>y(b.id,S,b.type)},b.id))})]}),h&&c.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:c.jsx("p",{className:"text-sm text-red-400",children:h})})]})]})}),c.jsxs("div",{className:"p-5 border-t border-border flex items-center justify-end gap-3 shrink-0",children:[c.jsx(Rt,{variant:"ghost",onClick:e,children:"Cancel"}),c.jsx(Rt,{onClick:x,disabled:d,className:"shadow-glow",children:d?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}),"Applying..."]}):c.jsxs(c.Fragment,{children:["Use Template",c.jsx(ei,{size:16})]})})]})]})})},f2=({placeholder:r,value:e,onChange:t})=>{const s=x7[r.type]||Vs,i=e??r.defaultValue??"",n=()=>{switch(r.type){case"text":case"subtitle":{const a=r.constraints?.maxLength;return c.jsxs("div",{className:"space-y-1",children:[c.jsx("textarea",{value:String(i),onChange:o=>t(o.target.value),maxLength:a,rows:2,placeholder:String(r.defaultValue||""),className:"w-full px-3 py-2.5 text-sm bg-background-tertiary border border-border rounded-lg focus:border-primary focus:outline-none text-text-primary placeholder:text-text-muted resize-none transition-colors"}),a&&c.jsxs("p",{className:"text-[10px] text-text-muted text-right",children:[String(i).length,"/",a]})]})}case"number":{const a=r.constraints?.min??0,o=r.constraints?.max??100,l=r.constraints?.step||1;return r.uiHints?.inputType==="slider"?c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(rt,{value:[Number(i)||0],onValueChange:u=>t(u[0]),min:a,max:o,step:l,className:"flex-1"}),c.jsx("span",{className:"text-xs text-text-muted w-12 text-right font-mono",children:Number(i).toFixed(l<1?1:0)})]}):c.jsx(Ns,{type:"number",value:Number(i)||0,onChange:u=>t(Number(u.target.value)),min:a,max:o,step:l,className:"bg-background-tertiary border-border text-text-primary"})}case"boolean":return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(wa,{checked:!!i,onCheckedChange:a=>t(a)}),c.jsx(ss,{className:"text-sm text-text-secondary cursor-pointer",children:r.description||"Enabled"})]});case"color":return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("input",{type:"color",value:String(i)||"#000000",onChange:a=>t(a.target.value),className:"w-10 h-10 rounded-lg cursor-pointer border border-border"}),c.jsx(Ns,{type:"text",value:String(i)||"#000000",onChange:a=>t(a.target.value),placeholder:"#000000",className:"flex-1 bg-background-tertiary border-border text-text-primary font-mono"})]});default:return c.jsx(Ns,{type:"text",value:String(i),onChange:a=>t(a.target.value),placeholder:String(r.defaultValue||""),className:"bg-background-tertiary border-border text-text-primary"})}};return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"flex items-center gap-2",children:[c.jsx(s,{size:14,className:"text-text-muted"}),c.jsx("span",{className:"text-sm font-medium text-text-primary",children:r.label}),r.required&&c.jsx("span",{className:"text-red-400 text-xs",children:"*"})]}),r.description&&r.type!=="boolean"&&c.jsx("p",{className:"text-xs text-text-muted",children:r.description}),n()]})},v7=({onTemplateApplied:r})=>{const e=me(b=>b.getTemplateEngine),[t,s]=w.useState([]),[i,n]=w.useState(!0),[a,o]=w.useState(""),[l,d]=w.useState("all"),[u,h]=w.useState(null),[p,m]=w.useState(!1);w.useEffect(()=>{(async()=>{n(!0);try{const S=await e();await S.initialize();const k=S.getBuiltinTemplates(),C=await h7.listScriptableTemplates(),A=[...k.map(j=>{const _=new Map;for(const M of j.timeline.tracks)for(const E of M.clips){const D=E;D.isPlaceholder&&D.placeholderId&&_.set(D.placeholderId,{clipId:E.id,trackId:M.id})}return{...j,placeholders:j.placeholders.map(M=>{const E=_.get(M.id);return{...M,targets:E?[{clipId:E.clipId,trackId:E.trackId,property:"content"}]:[],defaultValue:M.defaultValue}}),socialCategory:w7(j.category)}}),...C],T=Array.from(new Map(A.map(j=>[j.id,j])).values());s(T)}catch(S){console.error("Failed to load templates:",S)}finally{n(!1)}})()},[e]);const f=w.useMemo(()=>{let b=t;if(l!=="all"&&(b=b.filter(S=>S.socialCategory===l||S.category===l)),a.trim()){const S=a.toLowerCase();b=b.filter(k=>k.name.toLowerCase().includes(S)||k.description.toLowerCase().includes(S)||k.tags.some(C=>C.toLowerCase().includes(S)))}return b},[t,l,a]),g=w.useCallback(b=>{h(b),m(!0)},[]),y=w.useCallback(()=>{m(!1),h(null)},[]),x=w.useCallback(()=>{y(),r?.()},[y,r]),v=w.useMemo(()=>{const b={all:t.length};for(const S of uM)b[S.id]=t.filter(k=>k.socialCategory===S.id||k.category===S.id).length;return b},[t]);return i?c.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-full blur-xl"}),c.jsx(_i,{className:"relative w-10 h-10 text-primary animate-spin"})]}),c.jsx("p",{className:"text-sm text-text-muted mt-6",children:"Loading templates..."})]}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("div",{className:"relative flex-1 max-w-md",children:[c.jsx(Mo,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-text-muted z-10"}),c.jsx(Ns,{type:"text",value:a,onChange:b=>o(b.target.value),placeholder:"Search templates...",className:"pl-11 bg-background-tertiary border-border rounded-xl text-text-primary"})]})}),c.jsx(m7,{selectedCategory:l,onSelectCategory:d,categoryStats:v}),f.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-background-tertiary flex items-center justify-center mb-4",children:c.jsx(Gs,{size:24,className:"text-text-muted"})}),c.jsx("p",{className:"text-base font-medium text-text-primary mb-1",children:"No templates found"}),c.jsx("p",{className:"text-sm text-text-muted",children:"Try adjusting your search or filter"})]}):c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:f.map(b=>c.jsx(y7,{template:b,onClick:()=>g(b)},b.id))}),p&&u&&c.jsx(b7,{template:u,onClose:y,onApply:x})]})};function w7(r){return{"social-media":"tiktok",youtube:"youtube-video",tiktok:"tiktok",instagram:"instagram-reels",business:"promo",personal:"custom",slideshow:"slideshow","intro-outro":"intro","lower-third":"lower-third",custom:"custom"}[r]||"custom"}const k7=({onProjectSelected:r})=>{const[e,t]=w.useState([]),[s,i]=w.useState(!0),[n,a]=w.useState(null),o=U(p=>p.recoverFromAutoSave),{track:l}=lm();w.useEffect(()=>{async function p(){try{const m=await zX(),f=new Map;for(const y of m)f.has(y.projectId)||f.set(y.projectId,y);const g=Array.from(f.values()).sort((y,x)=>x.timestamp-y.timestamp).slice(0,10).map(y=>({id:y.projectId,saveId:y.id,name:y.projectName,lastModified:y.timestamp}));t(g)}catch(m){console.error("Failed to load recent projects:",m)}finally{i(!1)}}p()},[]);const d=w.useCallback(async p=>{a(p.id);try{await o(p.saveId)&&(l(Ic.PROJECT_OPENED,{source:"recent_projects"}),r?.())}catch(m){console.error("Failed to load project:",m)}finally{a(null)}},[o,r,l]),u=w.useCallback((p,m)=>{m.stopPropagation(),t(f=>f.filter(g=>g.id!==p))},[]),h=p=>{const m=new Date(p),g=Math.floor((new Date().getTime()-m.getTime())/(1e3*60*60*24));return g===0?"Today":g===1?"Yesterday":g<7?`${g} days ago`:g<30?`${Math.floor(g/7)} weeks ago`:m.toLocaleDateString()};return s?c.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-primary/30 border-t-primary rounded-full animate-spin mb-4"}),c.jsx("p",{className:"text-sm text-text-secondary",children:"Loading recent projects..."})]}):e.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-background-tertiary flex items-center justify-center mb-4",children:c.jsx(pi,{size:24,className:"text-text-muted"})}),c.jsx("h3",{className:"text-base font-medium text-text-primary mb-2",children:"No Recent Projects"}),c.jsx("p",{className:"text-sm text-text-muted text-center max-w-md",children:"Your recently opened projects will appear here. Start a new project or use a template to get started."})]}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("h3",{className:"text-sm font-medium text-text-primary",children:["Recent Projects (",e.length,")"]})}),c.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:e.map(p=>{const m=n===p.id;return c.jsxs("div",{className:"group relative flex flex-col bg-background-tertiary rounded-xl border border-border hover:border-primary/40 hover:bg-background-elevated transition-all overflow-hidden",children:[c.jsxs("button",{onClick:()=>d(p),disabled:m,className:"flex flex-col flex-1 text-left disabled:opacity-70",children:[c.jsx("div",{className:"aspect-video w-full bg-background flex items-center justify-center border-b border-border",children:m?c.jsx("div",{className:"w-8 h-8 border-2 border-primary/30 border-t-primary rounded-full animate-spin"}):c.jsx(vn,{size:32,className:"text-text-muted/50 group-hover:text-primary/50 transition-colors"})}),c.jsxs("div",{className:"p-3 flex-1",children:[c.jsx("h4",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:p.name}),c.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 text-xs text-text-muted",children:[c.jsx(pi,{size:11}),c.jsx("span",{children:h(p.lastModified)})]})]})]}),c.jsx("button",{onClick:f=>u(p.id,f),className:"absolute top-2 right-2 p-1.5 text-text-muted hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all rounded-lg bg-background/80 hover:bg-red-500/10 backdrop-blur-sm",title:"Remove from recent",children:c.jsx(bs,{size:14})})]},p.id)})}),c.jsx("p",{className:"text-xs text-text-muted text-center",children:"Recent projects are stored locally in your browser"})]})};function g2(r){const e=r.replace(/^#\/?/,""),[t,s]=e.split("?"),i={};s&&new URLSearchParams(s).forEach((d,u)=>{i[u]=d});const n=t.split("/");let a=n[0]||"welcome";const o=["welcome","editor","new","templates","recent","share"];return a==="share"&&n[1]&&(i.shareId=n[1]),{route:o.includes(a)?a:"welcome",params:i}}function cg(r,e){let t=`#/${r}`;if(e&&Object.keys(e).length>0){const s=new URLSearchParams;Object.entries(e).forEach(([n,a])=>{a!=null&&s.set(n,String(a))});const i=s.toString();i&&(t+=`?${i}`)}return t}function Hb(){const[r,e]=w.useState(()=>typeof window<"u"?g2(window.location.hash):{route:"welcome",params:{}});w.useEffect(()=>{const o=()=>{e(g2(window.location.hash))};return window.addEventListener("hashchange",o),()=>window.removeEventListener("hashchange",o)},[]);const t=w.useCallback((o,l)=>{const d=cg(o,l);window.location.hash=d},[]),s=w.useCallback(o=>{const l=cg(r.route,{...r.params,...o});window.location.hash=l},[r.route,r.params]),i=w.useCallback(()=>{const o=cg(r.route);window.location.hash=o},[r.route]),n=w.useMemo(()=>{const{dimensions:o,width:l,height:d}=r.params;if(o){const u=o.match(/^(\d+)x(\d+)$/i);if(u)return{width:parseInt(u[1],10),height:parseInt(u[2],10)}}return l&&d?{width:parseInt(l,10),height:parseInt(d,10)}:null},[r.params]),a=w.useMemo(()=>{const{fps:o}=r.params;if(o){const l=parseInt(o,10);if(!isNaN(l)&&l>0&&l<=120)return l}return 30},[r.params]);return{route:r.route,params:r.params,navigate:t,updateParams:s,clearParams:i,parsedDimensions:n,fps:a}}let y2=!1;function C7(r){const e=w.useRef(!1);w.useEffect(()=>{if(e.current||y2)return;y2=!0,e.current=!0;const t=()=>{hi(()=>Promise.resolve().then(()=>jZ),void 0)};"requestIdleCallback"in window?window.requestIdleCallback(t,{timeout:2e3}):setTimeout(t,100)},[r])}const S7=[{id:"vertical",preset:"tiktok",label:"Vertical",description:"TikTok, Reels, Shorts",dimensions:"1080  1920",icon:Si,gradient:"from-violet-500/20 to-fuchsia-500/20"},{id:"horizontal",preset:"youtube-video",label:"Horizontal",description:"YouTube, Vimeo, Web",dimensions:"1920  1080",icon:ji,gradient:"from-blue-500/20 to-cyan-500/20"},{id:"square",preset:"instagram-post",label:"Square",description:"Instagram, Facebook",dimensions:"1080  1080",icon:rs,gradient:"from-orange-500/20 to-rose-500/20"}],T7=({className:r=""})=>c.jsxs("svg",{viewBox:"0 0 490 490",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:r,children:[c.jsx("path",{d:"M245 24.5C123.223 24.5 24.5 123.223 24.5 245s98.723 220.5 220.5 220.5 220.5-98.723 220.5-220.5S366.777 24.5 245 24.5Z",stroke:"currentColor",strokeWidth:"30.625"}),c.jsxs("g",{children:[c.jsx("path",{d:"M245 98v73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M392 245h-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M245 392v-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M98 245h73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 141.059-51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 348.941-51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 348.941 51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 141.059 51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"})]}),c.jsx("path",{d:"M294 245a49 49 0 0 1-49 49 49 49 0 0 1-49-49 49 49 0 0 1 98 0",fill:"currentColor"})]}),A7=({initialTab:r})=>{const e=ft(m=>m.setSkipWelcomeScreen),t=ft(m=>m.skipWelcomeScreen),s=U(m=>m.createNewProject),{navigate:i}=Hb(),{track:n}=lm(),[a,o]=w.useState(r??"home"),[l,d]=w.useState(null);C7(!0);const u=w.useCallback(m=>{const f=kp[m.preset];s(`New ${m.label} Video`,{width:f.width,height:f.height,frameRate:f.frameRate}),n(Ic.PROJECT_CREATED,{preset:m.preset,width:f.width,height:f.height,frameRate:f.frameRate??30,source:"quick_start"}),i("editor")},[s,i,n]),h=w.useCallback(()=>{i("editor")},[i]),p=w.useCallback(()=>{i("editor")},[i]);return w.useEffect(()=>{t&&i("editor")},[t,i]),w.useEffect(()=>{const m=f=>{f.key==="Escape"&&(a!=="home"?o("home"):i("editor"))};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[i,a]),a==="templates"?c.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col",children:[c.jsxs("header",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[c.jsxs(Rt,{variant:"ghost",size:"sm",onClick:()=>o("home"),children:[c.jsx(da,{className:"rotate-180",size:16}),"Back"]}),c.jsx("h2",{className:"text-sm font-medium text-text-primary",children:"Templates"}),c.jsx("div",{className:"w-16"})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c.jsx(v7,{onTemplateApplied:h})})]}):a==="recent"?c.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col",children:[c.jsxs("header",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[c.jsxs(Rt,{variant:"ghost",size:"sm",onClick:()=>o("home"),children:[c.jsx(da,{className:"rotate-180",size:16}),"Back"]}),c.jsx("h2",{className:"text-sm font-medium text-text-primary",children:"Recent Projects"}),c.jsx("div",{className:"w-16"})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c.jsx(k7,{onProjectSelected:p})})]}):c.jsxs("div",{className:"fixed inset-0 z-50 bg-background overflow-hidden",children:[c.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(34,197,94,0.05),transparent_60%)]"}),c.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_right,rgba(34,197,94,0.03),transparent_50%)]"}),c.jsxs("div",{className:"relative h-full flex flex-col items-center justify-center px-6",children:[c.jsxs("div",{className:"w-full max-w-3xl",children:[c.jsxs("div",{className:"flex flex-col items-center text-center mb-12",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[c.jsx("div",{className:"w-12 h-12 text-primary",children:c.jsx(T7,{className:"w-full h-full"})}),c.jsx("span",{className:"text-xl font-semibold text-text-primary tracking-tight",children:"Open Reel Video"})]}),c.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-text-primary tracking-tight mb-3",children:"From idea to export."}),c.jsx("p",{className:"text-xl text-text-secondary mb-8",children:"In your browser."}),c.jsx("p",{className:"text-base text-text-muted max-w-md",children:"Pick a format and start creating. You can change this anytime."})]}),c.jsx("div",{className:"grid grid-cols-3 gap-4 mb-10",children:S7.map(m=>{const f=m.icon,g=l===m.id;return c.jsxs("button",{onClick:()=>u(m),onMouseEnter:()=>d(m.id),onMouseLeave:()=>d(null),className:`
                    group relative flex flex-col items-center p-6 rounded-2xl
                    bg-background-secondary border border-border
                    hover:border-primary/40 hover:bg-background-tertiary
                    transition-all duration-200
                    ${g?"scale-[1.02] shadow-lg shadow-primary/5":""}
                  `,children:[c.jsx("div",{className:`
                    absolute inset-0 rounded-2xl bg-gradient-to-br ${m.gradient}
                    opacity-0 group-hover:opacity-100 transition-opacity duration-300
                  `}),c.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[c.jsx("div",{className:`
                      w-16 h-16 mb-4 rounded-xl flex items-center justify-center
                      bg-background-tertiary group-hover:bg-primary/10
                      transition-colors duration-200
                    `,children:c.jsx(f,{size:28,className:"text-text-muted group-hover:text-primary transition-colors"})}),c.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:m.label}),c.jsx("p",{className:"text-sm text-text-muted mb-3",children:m.description}),c.jsx("span",{className:"text-xs font-mono text-text-muted/70 bg-background-tertiary px-2 py-1 rounded",children:m.dimensions})]}),c.jsxs("div",{className:`
                    absolute bottom-4 left-1/2 -translate-x-1/2
                    flex items-center gap-1 text-sm font-medium text-primary
                    opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0
                    transition-all duration-200
                  `,children:["Start creating",c.jsx(da,{size:14})]})]},m.id)})}),c.jsxs("div",{className:"flex items-center justify-center gap-3",children:[c.jsxs(Rt,{variant:"outline",onClick:()=>o("templates"),className:"rounded-xl",children:[c.jsx(Gs,{size:16}),"Browse templates"]}),c.jsxs(Rt,{variant:"outline",onClick:()=>o("recent"),className:"rounded-xl",children:[c.jsx(pi,{size:16}),"Recent projects"]}),c.jsxs(Rt,{variant:"outline",onClick:()=>i("editor"),className:"rounded-xl",children:[c.jsx(Dx,{size:16}),"Open editor"]})]})]}),c.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(wa,{id:"skip-welcome",checked:t,onCheckedChange:e}),c.jsx(ss,{htmlFor:"skip-welcome",className:"text-xs text-text-muted cursor-pointer",children:"Skip on startup"})]}),c.jsx("span",{className:"text-text-muted/30",children:""}),c.jsxs("p",{className:"text-xs text-text-muted/60",children:["Press"," ",c.jsx("kbd",{className:"px-1.5 py-0.5 bg-background-tertiary border border-border rounded text-text-muted font-mono text-[10px]",children:"Esc"})," ","to skip"]})]})]})]})};function x2(r){const e=Math.floor((Date.now()-r)/1e3);if(e<60)return"just now";if(e<3600){const s=Math.floor(e/60);return`${s} ${s===1?"minute":"minutes"} ago`}if(e<86400){const s=Math.floor(e/3600);return`${s} ${s===1?"hour":"hours"} ago`}const t=Math.floor(e/86400);return`${t} ${t===1?"day":"days"} ago`}function b2(r){return new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}const j7=({saves:r,onRecover:e,onDismiss:t,onClearAll:s})=>{const[i,n]=w.useState(!1),[a,o]=w.useState(null),[l,d]=w.useState(!1),u=r[0],h=r.slice(1),p=async()=>{s&&(d(!0),await s(),d(!1),t())},m=f=>{o(f),e(f)};return c.jsx(Ea,{open:!0,onOpenChange:f=>!f&&t(),children:c.jsxs(En,{className:"max-w-md p-0 gap-0 bg-background-secondary border-border overflow-hidden",children:[c.jsx(Ma,{className:"p-5 border-b border-border space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2.5 bg-primary/10 rounded-xl shrink-0",children:c.jsx(Gi,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx(Pa,{className:"text-base font-semibold text-text-primary",children:"Recover Your Work"}),c.jsx(ku,{className:"text-sm text-text-secondary mt-0.5",children:"We found an unsaved project"})]})]})}),c.jsxs("div",{className:"p-5",children:[c.jsxs("button",{onClick:()=>m(u.id),disabled:a===u.id,className:"w-full bg-background-tertiary rounded-xl border border-border p-4 mb-4 text-left hover:border-primary/50 hover:bg-background-elevated transition-all group disabled:opacity-70",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[c.jsx(co,{className:"w-5 h-5 text-text-muted group-hover:text-primary transition-colors"}),c.jsx("span",{className:"font-medium text-text-primary truncate",children:u.projectName})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[c.jsx(pi,{className:"w-4 h-4 shrink-0"}),c.jsxs("span",{children:["Last saved ",x2(u.timestamp)]}),c.jsx("span",{className:"text-text-muted/50",children:""}),c.jsx("span",{className:"text-text-muted/70 truncate",children:b2(u.timestamp)})]})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx(Rt,{variant:"outline",onClick:t,className:"flex-1",children:"Start Fresh"}),c.jsx(Rt,{onClick:()=>m(u.id),disabled:a===u.id,className:"flex-1",children:a===u.id?"Recovering...":"Recover Project"})]}),h.length>0&&c.jsxs(Kd,{open:i,onOpenChange:n,className:"mt-4 pt-4 border-t border-border",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(wp,{className:"flex items-center gap-2 text-sm text-text-muted hover:text-text-secondary transition-colors",children:[c.jsx(ns,{className:`w-4 h-4 transition-transform duration-200 ${i?"rotate-180":""}`}),c.jsxs("span",{children:[h.length," older ",h.length===1?"save":"saves"," available"]})]}),s&&c.jsx("button",{onClick:p,disabled:l,className:"p-1.5 rounded-lg text-text-muted hover:text-red-400 hover:bg-red-500/10 transition-colors disabled:opacity-50",title:"Clear all saved projects",children:c.jsx(bs,{className:"w-4 h-4"})})]}),c.jsx(Qd,{className:"mt-3 space-y-2 max-h-48 overflow-y-auto pr-1 scrollbar-thin",children:h.map(f=>c.jsx("button",{onClick:()=>m(f.id),disabled:a===f.id,className:"w-full text-left p-3 rounded-lg bg-background-tertiary border border-border hover:border-border-hover hover:bg-background-elevated transition-all group disabled:opacity-70",children:c.jsxs("div",{className:"flex items-center justify-between gap-2",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:f.projectName}),c.jsx("div",{className:"text-xs text-text-muted mt-1",children:b2(f.timestamp)})]}),c.jsx("div",{className:"text-xs text-text-muted/70 shrink-0",children:x2(f.timestamp)})]})},f.id))})]})]})]})})},WP="https://openreel-cloud.niiyeboah1996.workers.dev";async function _7(r){try{const e=await fetch(`${WP}/shares/${r}`);if(e.status===404)return null;if(e.status===410)throw new Error("This share link has expired");if(!e.ok)throw new Error(`Failed to get share info: ${e.status}`);return await e.json()}catch(e){throw e instanceof Error?e:new Error("Failed to get share info")}}function E7(r){return`${WP}/shares/${r}/download`}function M7(r){const e=Date.now(),t=r-e;if(t<=0)return"Expired";const s=Math.floor(t/(1e3*60*60)),i=Math.floor(t%(1e3*60*60)/(1e3*60));return s>0?`${s}h ${i}m remaining`:`${i}m remaining`}function P7(r){return Date.now()>r}const N7=({shareId:r})=>{const[e,t]=w.useState("loading"),[s,i]=w.useState(null),[n,a]=w.useState(null);w.useEffect(()=>{(async()=>{try{const u=await _7(r);if(!u){t("not-found");return}if(P7(u.expiresAt)){t("expired");return}i(u),t("ready")}catch(u){u instanceof Error&&u.message.includes("expired")?t("expired"):(a(u instanceof Error?u.message:"Failed to load share"),t("error"))}})()},[r]);const o=E7(r),l=()=>{window.location.hash="#/editor"};return e==="loading"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-4",children:[c.jsx(_i,{size:48,className:"text-primary animate-spin mx-auto"}),c.jsx("p",{className:"text-text-muted",children:"Loading video..."})]})}):e==="not-found"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-6 max-w-md px-6",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-text-muted/10 rounded-full flex items-center justify-center",children:c.jsx(_o,{size:40,className:"text-text-muted"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Video Not Found"}),c.jsx("p",{className:"text-text-muted mt-2",children:"This video doesn't exist or the link is invalid."})]}),c.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:[c.jsx(v0,{size:18}),"Create Your Own Video"]})]})}):e==="expired"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-6 max-w-md px-6",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-warning/10 rounded-full flex items-center justify-center",children:c.jsx(pi,{size:40,className:"text-warning"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Link Expired"}),c.jsx("p",{className:"text-text-muted mt-2",children:"This share link has expired. Share links are only valid for 24 hours."})]}),c.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:[c.jsx(v0,{size:18}),"Create Your Own Video"]})]})}):e==="error"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-6 max-w-md px-6",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-error/10 rounded-full flex items-center justify-center",children:c.jsx(_o,{size:40,className:"text-error"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Error"}),c.jsx("p",{className:"text-text-muted mt-2",children:n||"Something went wrong"})]}),c.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:"Try Again"})]})}):c.jsx("div",{className:"min-h-screen bg-background",children:c.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 space-y-8",children:[c.jsxs("div",{className:"text-center space-y-2",children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:s?.filename||"Shared Video"}),s&&c.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-text-muted",children:[c.jsxs("span",{children:[(s.size/(1024*1024)).toFixed(1)," MB"]}),c.jsx("span",{children:""}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(pi,{size:14}),c.jsx("span",{children:M7(s.expiresAt)})]})]})]}),c.jsx("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden shadow-2xl",children:c.jsx("video",{src:o,controls:!0,className:"w-full h-full",poster:"",children:"Your browser does not support the video tag."})}),c.jsxs("div",{className:"flex items-center justify-center gap-4",children:[c.jsxs("a",{href:o,download:s?.filename,className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:[c.jsx(Ix,{size:18}),"Download"]}),c.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-6 py-3 bg-background-secondary hover:bg-background-tertiary border border-border text-text-primary font-medium rounded-lg transition-colors",children:[c.jsx(ii,{size:18}),"Create Your Own"]})]}),c.jsx("div",{className:"text-center",children:c.jsxs("p",{className:"text-xs text-text-muted",children:["Made with"," ",c.jsx("a",{href:"#/editor",className:"text-primary hover:underline",children:"Open Reel Video"})]})})]})})};function R7(r={}){const{enabled:e=!0}=r,[t,s]=w.useState({isChecking:!e,availableSaves:[],showDialog:!1}),i=U(l=>l.recoverFromAutoSave);w.useEffect(()=>{if(!e)return;(async()=>{try{await ar.initialize();const d=await ar.checkForRecovery();d.length>0?s({isChecking:!1,availableSaves:d,showDialog:!0}):s({isChecking:!1,availableSaves:[],showDialog:!1})}catch(d){console.warn("[Recovery] Failed to check for saves:",d),s({isChecking:!1,availableSaves:[],showDialog:!1})}})()},[]);const n=w.useCallback(async l=>{const d=await i(l);return d&&s(u=>({...u,showDialog:!1})),d},[i]),a=w.useCallback(()=>{s(l=>({...l,showDialog:!1}))},[]),o=w.useCallback(async()=>{await ar.clearAllSaves(),s(l=>({...l,availableSaves:[],showDialog:!1}))},[]);return{isChecking:t.isChecking,availableSaves:t.availableSaves,showDialog:t.showDialog,recover:n,dismiss:a,clearAll:o}}const I7=()=>typeof window>"u"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",v2=r=>r==="auto"?I7()==="dark":r==="dark",lu=Ta()(nS((r,e)=>({mode:"dark",isDark:!0,setMode:t=>{const s=v2(t);r({mode:t,isDark:s}),s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},toggleTheme:()=>{const t=e().mode,s=t==="light"?"dark":t==="dark"?"auto":"light";e().setMode(s)}}),{name:"openreel-theme",onRehydrateStorage:()=>r=>{if(r){const e=v2(r.mode);r.isDark=e,e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}}}));typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(lu.getState().mode==="auto"){const s=e.matches;lu.setState({isDark:s}),s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}});function D7({enabled:r}){const{createNewProject:e,importMedia:t}=U(),{setMode:s}=lu(),{navigate:i}=Hb(),n=w.useRef(!1),a=w.useRef(null);w.useEffect(()=>{if(!r||n.current)return;n.current=!0;const o=new URLSearchParams(window.location.search),l=parseInt(o.get("fps")||"24",10);w2(o,s),e("ComfyUI Video",{width:1920,height:1080,frameRate:l}),i("editor"),window.parent!==window&&window.parent.postMessage({type:"openreel-ready"},"*")},[r,e,i,t,s]),w.useEffect(()=>{if(!r)return;const o=l=>{if(!(!l.data||!l.data.type)){if(l.data.type==="comfyui-import-video"){const d=l.data.url||l.data.audioUrl;d&&d!==a.current&&(a.current=d,l.data.url?YP(l.data.url,t):l.data.audioUrl&&HP(l.data.audioUrl,t))}if(l.data.type==="comfyui-import-images"){const d=l.data.imageUrls||[],u=d.join("|");u&&u!==a.current&&(a.current=u,qP(d,t))}if(l.data.type==="comfyui-import-combined"){const d=l.data.imports||[],u=JSON.stringify(d);u&&u!==a.current&&(a.current=u,B7(d,t))}if(l.data.type==="comfyui-theme-update"&&l.data.theme){const d=new URLSearchParams;for(const[u,h]of Object.entries(l.data.theme))d.set(u,h);w2(d,s)}}};return window.addEventListener("message",o),()=>window.removeEventListener("message",o)},[r,t,s])}function Nr(r){if(!r)return null;const e=r.trim(),t=e.match(/^#([0-9a-f]{3,8})$/i);if(t){let i=t[1];if(i.length===3&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]),i.length>=6)return[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16)]}const s=e.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);return s?[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]:null}function xi(r){return`${r[0]} ${r[1]} ${r[2]}`}function Gn(r){const e=r[0]/255,t=r[1]/255,s=r[2]/255,i=Math.max(e,t,s),n=Math.min(e,t,s),a=(i+n)/2;if(i===n)return`0 0% ${Math.round(a*100)}%`;const o=i-n,l=a>.5?o/(2-i-n):o/(i+n);let d=0;return i===e?d=((t-s)/o+(t<s?6:0))/6:i===t?d=((s-e)/o+2)/6:d=((e-t)/o+4)/6,`${Math.round(d*360)} ${Math.round(l*100)}% ${Math.round(a*100)}%`}function F7(r){return(.299*r[0]+.587*r[1]+.114*r[2])/255}function Wn(r,e){return e>0?[Math.min(255,Math.round(r[0]+(255-r[0])*e)),Math.min(255,Math.round(r[1]+(255-r[1])*e)),Math.min(255,Math.round(r[2]+(255-r[2])*e))]:[Math.max(0,Math.round(r[0]*(1+e))),Math.max(0,Math.round(r[1]*(1+e))),Math.max(0,Math.round(r[2]*(1+e)))]}function w2(r,e){const t=r.get("theme_bg");if(!t)return;const s=Nr(t);if(!s)return;const i=F7(s)<.5;e(i?"dark":"light");const n=Nr(r.get("theme_bg_secondary")||"")||Wn(s,i?.06:-.03),a=Nr(r.get("theme_bg_tertiary")||"")||Wn(s,i?.12:-.06),o=Wn(s,i?.22:-.12),l=Nr(r.get("theme_fg")||"")||(i?[224,224,224]:[24,24,27]),d=Nr(r.get("theme_fg_muted")||"")||Wn(l,i?-.35:.35),u=Wn(l,i?-.2:.2),h=Nr(r.get("theme_border")||"")||Wn(s,i?.15:-.1),p=Wn(h,i?.12:-.08),m=Wn(h,i?.25:-.18),f=Nr(r.get("theme_accent")||"")||[74,158,255],g=Nr(r.get("theme_input_bg")||"")||a,y=Nr(r.get("theme_scrollbar_thumb")||"")||p,x=Nr(r.get("theme_scrollbar_track")||"")||s,v=Gn(f),b=Gn(s),S=Gn(l),C=Gn(n),T=Gn(a),j=Gn(h),_=Gn(g),M=`
    :root, .dark {
      /* OpenReel custom color overrides (RGB triplets) */
      --color-background: ${xi(s)};
      --color-background-secondary: ${xi(n)};
      --color-background-tertiary: ${xi(a)};
      --color-background-elevated: ${xi(o)};
      --color-text-primary: ${xi(l)};
      --color-text-secondary: ${xi(u)};
      --color-text-muted: ${xi(d)};
      --color-border: ${xi(h)};
      --color-border-hover: ${xi(p)};
      --color-border-active: ${xi(m)};

      /* shadcn/ui CSS variable overrides (HSL) */
      --background: ${b};
      --foreground: ${S};
      --card: ${C};
      --card-foreground: ${S};
      --popover: ${C};
      --popover-foreground: ${S};
      --primary: ${v};
      --primary-foreground: 0 0% 100%;
      --secondary: ${T};
      --secondary-foreground: ${S};
      --muted: ${T};
      --muted-foreground: ${Gn(d)};
      --accent: ${T};
      --accent-foreground: ${S};
      --border: ${j};
      --input: ${_};
      --ring: ${v};

      color-scheme: ${i?"dark":"light"};
      color: rgb(${xi(l)});
      background-color: rgb(${xi(s)});
    }

    /* Scrollbar overrides */
    ::-webkit-scrollbar-thumb {
      background: rgb(${xi(y)}) !important;
    }
    ::-webkit-scrollbar-track {
      background: rgb(${xi(x)}) !important;
    }
  `;let E=document.getElementById("comfyui-theme-override");E||(E=document.createElement("style"),E.id="comfyui-theme-override",document.head.appendChild(E)),E.textContent=M,console.log("[ComfyUI Embedding] Applied theme:",i?"dark":"light")}async function YP(r,e,t=0){try{console.log("[ComfyUI Embedding] Fetching video from:",r);const s=await fetch(r);if(!s.ok){console.error("[ComfyUI Embedding] Failed to fetch video:",s.status);return}const i=await s.blob(),n=`comfyui_video_${String(t).padStart(4,"0")}.mp4`,a=new File([i],n,{type:"video/mp4"});console.log("[ComfyUI Embedding] Importing video, size:",i.size);const o=await e(a);o.success?console.log("[ComfyUI Embedding] Video imported successfully"):console.error("[ComfyUI Embedding] Video import failed:",o.error?.message)}catch(s){console.error("[ComfyUI Embedding] Error importing video:",s)}}async function qP(r,e){try{console.log(`[ComfyUI Embedding] Importing ${r.length} images`);for(let t=0;t<r.length;t++){const s=r[t];try{const i=await fetch(s);if(!i.ok){console.error(`[ComfyUI Embedding] Failed to fetch image ${t}:`,i.status);continue}const n=await i.blob(),a=`comfyui_image_${String(t).padStart(4,"0")}.png`,o=new File([n],a,{type:"image/png"}),l=await e(o);l.success?console.log(`[ComfyUI Embedding] Image ${t} imported successfully`):console.error(`[ComfyUI Embedding] Image ${t} import failed:`,l.error?.message)}catch(i){console.error(`[ComfyUI Embedding] Error importing image ${t}:`,i)}}console.log(`[ComfyUI Embedding] Finished importing ${r.length} images`)}catch(t){console.error("[ComfyUI Embedding] Error importing images:",t)}}async function B7(r,e){console.log(`[ComfyUI Embedding] Processing combined import with ${r.length} entries`);let t=0,s=0;for(const i of r)if(i.type==="comfyui-import-video")i.url?await YP(i.url,e,t++):i.audioUrl&&await HP(i.audioUrl,e,s++);else if(i.type==="comfyui-import-images"){const n=i.imageUrls||[];n.length>0&&await qP(n,e)}console.log("[ComfyUI Embedding] Combined import complete")}async function HP(r,e,t=0){try{console.log("[ComfyUI Embedding] Fetching audio from:",r);const s=await fetch(r);if(!s.ok){console.error("[ComfyUI Embedding] Failed to fetch audio:",s.status);return}const i=await s.blob(),n=`comfyui_audio_${String(t).padStart(4,"0")}.wav`,a=new File([i],n,{type:"audio/wav"});console.log("[ComfyUI Embedding] Importing audio, size:",i.size);const o=await e(a);o.success?console.log("[ComfyUI Embedding] Audio imported successfully"):console.error("[ComfyUI Embedding] Audio import failed:",o.error?.message)}catch(s){console.error("[ComfyUI Embedding] Error importing audio:",s)}}const L7=[{id:"youtube-4k",name:"YouTube 4K",description:"Best quality for YouTube 4K - 50Mbps",platform:"YouTube",category:"social",aspectRatio:"16:9",recommended:!0,settings:{format:"mp4",codec:"h264",width:3840,height:2160,frameRate:30,bitrate:5e4,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:384,channels:2}}},{id:"youtube-4k-60",name:"YouTube 4K 60fps",description:"4K 60fps for gaming/motion - 65Mbps",platform:"YouTube",category:"social",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:3840,height:2160,frameRate:60,bitrate:65e3,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:384,channels:2}}},{id:"youtube-1080p",name:"YouTube 1080p HD",description:"Standard HD quality for YouTube",platform:"YouTube",category:"social",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2}}},{id:"youtube-shorts",name:"YouTube Shorts",description:"Vertical format for YouTube Shorts (60s max)",platform:"YouTube",category:"social",aspectRatio:"9:16",maxDuration:60,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:60,bitrate:12e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2}}},{id:"tiktok",name:"TikTok",description:"Optimized for TikTok (3min max)",platform:"TikTok",category:"social",aspectRatio:"9:16",maxDuration:180,maxFileSize:287*1024*1024,recommended:!0,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:60,bitrate:1e4,bitrateMode:"vbr",quality:85,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"instagram-reels",name:"Instagram Reels",description:"Vertical format for Reels (90s max)",platform:"Instagram",category:"social",aspectRatio:"9:16",maxDuration:90,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"instagram-feed",name:"Instagram Feed Video",description:"Square format for feed posts (60s max)",platform:"Instagram",category:"social",aspectRatio:"1:1",maxDuration:60,settings:{format:"mp4",codec:"h264",width:1080,height:1080,frameRate:30,bitrate:6e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"instagram-story",name:"Instagram Story",description:"Vertical format for Stories (15s per clip)",platform:"Instagram",category:"social",aspectRatio:"9:16",maxDuration:15,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:30,bitrate:6e3,bitrateMode:"vbr",quality:80,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:128,channels:2}}},{id:"twitter",name:"Twitter/X",description:"Optimized for Twitter (2min 20s max)",platform:"Twitter",category:"social",aspectRatio:"16:9",maxDuration:140,maxFileSize:512*1024*1024,settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"facebook-feed",name:"Facebook Feed",description:"Standard format for Facebook feed",platform:"Facebook",category:"social",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:192,channels:2}}},{id:"linkedin",name:"LinkedIn",description:"Professional format for LinkedIn (10min max)",platform:"LinkedIn",category:"social",aspectRatio:"16:9",maxDuration:600,maxFileSize:5*1024*1024*1024,settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:192,channels:2}}}],O7=[{id:"broadcast-4k-master",name:"4K Master Quality",description:"Maximum quality 4K - 80Mbps H.265",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",recommended:!0,settings:{format:"mov",codec:"h265",width:3840,height:2160,frameRate:30,bitrate:8e4,bitrateMode:"vbr",quality:95,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-4k-prores-hq",name:"4K ProRes HQ",description:"Professional ProRes for editing/mastering",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"hq",width:3840,height:2160,frameRate:30,bitrate:88e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"broadcast-4k-prores-4444",name:"4K ProRes 4444",description:"Highest quality ProRes with alpha support",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"4444",width:3840,height:2160,frameRate:30,bitrate:132e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"broadcast-4k-60",name:"4K 60fps High Motion",description:"4K at 60fps for sports/gaming - 65Mbps",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h265",width:3840,height:2160,frameRate:60,bitrate:65e3,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-4k",name:"Broadcast 4K UHD",description:"4K broadcast quality - 50Mbps",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h264",width:3840,height:2160,frameRate:30,bitrate:5e4,bitrateMode:"cbr",quality:90,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-1080p-high",name:"1080p High Quality",description:"High bitrate 1080p - 20Mbps",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:2e4,bitrateMode:"vbr",quality:95,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-1080p-prores",name:"1080p ProRes HQ",description:"ProRes HQ for 1080p editing",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"hq",width:1920,height:1080,frameRate:30,bitrate:22e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"broadcast-hd",name:"Broadcast HD 1080p",description:"Standard broadcast quality",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:12e3,bitrateMode:"cbr",quality:85,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}}],$7=[{id:"web-hd",name:"Web HD",description:"Balanced quality for web embedding",platform:"Web",category:"web",aspectRatio:"16:9",recommended:!0,settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:5e3,bitrateMode:"vbr",quality:80,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:128,channels:2}}},{id:"web-small",name:"Web Optimized",description:"Smaller file size for faster loading",platform:"Web",category:"web",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1280,height:720,frameRate:30,bitrate:2500,bitrateMode:"vbr",quality:75,keyframeInterval:90,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:96,channels:2}}},{id:"webm-vp9",name:"WebM VP9",description:"Modern web format with VP9 codec (720p recommended)",platform:"Web",category:"web",aspectRatio:"16:9",settings:{format:"webm",codec:"vp9",width:1280,height:720,frameRate:30,bitrate:3e3,bitrateMode:"vbr",quality:80,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:128,channels:2}}}],z7=[{id:"archive-4k-prores",name:"Archive 4K ProRes",description:"Lossless 4K ProRes for long-term archival",platform:"Archive",category:"archive",aspectRatio:"16:9",recommended:!0,settings:{format:"mov",codec:"prores",proresProfile:"hq",width:3840,height:2160,frameRate:30,bitrate:88e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:96e3,bitDepth:24,bitrate:0,channels:2}}},{id:"archive-master",name:"Archive Master H.265",description:"High quality 4K H.265 - 80Mbps",platform:"Archive",category:"archive",aspectRatio:"16:9",settings:{format:"mov",codec:"h265",width:3840,height:2160,frameRate:30,bitrate:8e4,bitrateMode:"vbr",quality:95,keyframeInterval:30,audioSettings:{format:"wav",sampleRate:96e3,bitDepth:24,bitrate:0,channels:2}}},{id:"archive-1080p-prores",name:"Archive 1080p ProRes",description:"ProRes HQ for 1080p archival",platform:"Archive",category:"archive",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"hq",width:1920,height:1080,frameRate:30,bitrate:22e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"archive-proxy",name:"Archive Proxy",description:"Lower quality proxy for editing",platform:"Archive",category:"archive",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1280,height:720,frameRate:30,bitrate:3e3,bitrateMode:"vbr",quality:70,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:128,channels:2}}}],V7=[{id:"audio-mp3-320",name:"MP3 High Quality",description:"320kbps MP3 for music",platform:"Audio",category:"custom",settings:{format:"mp3",sampleRate:48e3,bitDepth:16,bitrate:320,channels:2}},{id:"audio-wav",name:"WAV Lossless",description:"Uncompressed WAV audio",platform:"Audio",category:"archive",settings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}},{id:"audio-aac",name:"AAC High Quality",description:"256kbps AAC for compatibility",platform:"Audio",category:"custom",settings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2}}],U7=[...L7,...O7,...$7,...z7,...V7],k2="openreel-custom-export-presets";class G7{customPresets=[];listeners=new Set;constructor(){this.loadCustomPresets()}loadCustomPresets(){try{const e=localStorage.getItem(k2);e&&(this.customPresets=JSON.parse(e))}catch(e){console.error("[ExportPresets] Failed to load custom presets:",e)}}saveCustomPresets(){try{localStorage.setItem(k2,JSON.stringify(this.customPresets))}catch(e){console.error("[ExportPresets] Failed to save custom presets:",e)}}getAllPresets(){return[...U7,...this.customPresets]}getPresetsByCategory(e){return this.getAllPresets().filter(t=>t.category===e)}getPresetsByPlatform(e){return this.getAllPresets().filter(t=>t.platform===e)}getPreset(e){return this.getAllPresets().find(t=>t.id===e)}getRecommendedPresets(){return this.getAllPresets().filter(e=>e.recommended)}getPlatforms(){const e=new Set(this.getAllPresets().map(t=>t.platform));return Array.from(e)}addCustomPreset(e){const t={...e,id:`custom-${Date.now()}`,category:"custom"};return this.customPresets.push(t),this.saveCustomPresets(),this.notify(),t}updateCustomPreset(e,t){const s=this.customPresets.findIndex(i=>i.id===e);return s===-1?!1:(this.customPresets[s]={...this.customPresets[s],...t},this.saveCustomPresets(),this.notify(),!0)}deleteCustomPreset(e){const t=this.customPresets.findIndex(s=>s.id===e);return t===-1?!1:(this.customPresets.splice(t,1),this.saveCustomPresets(),this.notify(),!0)}getCustomPresets(){return[...this.customPresets]}isCustomPreset(e){return e.startsWith("custom-")}duplicatePreset(e,t){const s=this.getPreset(e);return s?this.addCustomPreset({...s,name:t,platform:"Custom"}):null}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}}const hh=new G7;function W7(r,e){const t=r/e;return t<.9?"vertical":t>1.1?"horizontal":"square"}function Y7(r,e){const t={"9:16":"vertical","1:1":"square","16:9":"horizontal","4:5":"vertical"};return r.filter(s=>s.aspectRatio?t[s.aspectRatio]===e:!1)}function q7(r){switch(r){case"vertical":return"Vertical (TikTok, Reels, Shorts)";case"square":return"Square (Instagram Feed)";case"horizontal":return"Horizontal (YouTube, Twitter)"}}const C2={YouTube:c.jsx(Wc,{size:16}),Instagram:c.jsx($u,{size:16}),Twitter:c.jsx($u,{size:16}),TikTok:c.jsx(qr,{size:16}),Facebook:c.jsx($u,{size:16}),LinkedIn:c.jsx($u,{size:16}),Broadcast:c.jsx(ji,{size:16}),Web:c.jsx(Wj,{size:16}),Archive:c.jsx(FB,{size:16}),Audio:c.jsx(qr,{size:16}),Custom:c.jsx(Gc,{size:16})},H7=({isOpen:r,onClose:e,onExport:t,duration:s=0,projectWidth:i=1920,projectHeight:n=1080})=>{const[a,o]=w.useState("presets"),[l,d]=w.useState("recommended"),[u,h]=w.useState(null),[p,m]=w.useState([]),[f,g]=w.useState([]),y=W7(i,n),[x,v]=w.useState({format:"mp4",codec:"h264",width:i,height:n,frameRate:30,bitrate:15e3,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2},upscaling:{enabled:!1,quality:"balanced",sharpening:.3}}),[b,S]=w.useState(null),[k,C]=w.useState(null),[A,T]=w.useState([]),[j,_]=w.useState(!1),[M,E]=w.useState(null),[D,R]=w.useState(!1);w.useEffect(()=>{r&&(m(hh.getAllPresets()),g(hh.getPlatforms()),d("recommended"),h(null),Sy().then(P=>{S(P),T(i2(P,{width:i,height:n}))}))},[r,i,n]),w.useEffect(()=>{if(!b||s<=0){C(null);return}const P=a==="presets"&&u?u.settings:x,W=zP(b,{width:P.width,height:P.height,frameRate:P.frameRate,duration:s,codec:P.codec});C(W)},[b,s,a,u,x]);const B=w.useCallback(async()=>{if(!j){_(!0),E(null);try{await kX(W=>{E(W)});const P=await Sy(!0);S(P),T(i2(P,{width:i,height:n}))}catch(P){console.error("Benchmark failed:",P)}finally{_(!1),E(null)}}},[j,i,n]),O=Y7(p,y),F=l==="recommended"?O.length>0?O:hh.getRecommendedPresets():l?p.filter(P=>P.platform===l):hh.getRecommendedPresets(),I=w.useCallback(()=>{const P=a==="presets"&&u?u.settings:x;t(P),e()},[a,u,x,t,e]),K=(P,W)=>{const z=P*1e3*W/8;return z<1024*1024?`${(z/1024).toFixed(1)} KB`:z<1024*1024*1024?`${(z/(1024*1024)).toFixed(1)} MB`:`${(z/(1024*1024*1024)).toFixed(2)} GB`},ee=P=>{const W=Math.floor(P/60),z=Math.floor(P%60);return`${W}:${z.toString().padStart(2,"0")}`};return r?c.jsx(Ea,{open:!0,onOpenChange:P=>!P&&e(),children:c.jsxs(En,{className:"max-w-4xl max-h-[85vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsx(Ma,{className:"p-4 border-b border-border bg-background-tertiary space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Ix,{size:20,className:"text-primary"}),c.jsx(Pa,{className:"text-lg font-bold text-text-primary",children:"Export Video"})]})}),c.jsxs(vb,{value:a,onValueChange:P=>o(P),className:"flex-1 flex flex-col overflow-hidden",children:[c.jsxs(wb,{className:"flex border-b border-border bg-transparent rounded-none",children:[c.jsxs(Jd,{value:"presets",className:"flex-1 flex items-center justify-center gap-2 p-3 text-sm font-medium rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:text-primary text-text-secondary hover:text-text-primary",children:[c.jsx(xa,{size:16}),"Presets"]}),c.jsxs(Jd,{value:"custom",className:"flex-1 flex items-center justify-center gap-2 p-3 text-sm font-medium rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:text-primary text-text-secondary hover:text-text-primary",children:[c.jsx(Gc,{size:16}),"Custom"]})]}),c.jsxs(Zd,{value:"presets",className:"flex-1 overflow-hidden flex mt-0",children:[c.jsxs("div",{className:"w-48 border-r border-border overflow-y-auto",children:[c.jsxs("button",{onClick:()=>d("recommended"),className:`w-full flex flex-col items-start p-3 text-sm transition-colors ${l==="recommended"?"bg-primary/10 text-primary border-r-2 border-primary":"text-text-secondary hover:bg-background-tertiary"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(zs,{size:14}),c.jsx("span",{className:"font-medium",children:"For Your Video"})]}),c.jsx("span",{className:"text-[10px] text-text-muted mt-0.5 ml-5",children:q7(y)})]}),c.jsx("div",{className:"h-px bg-border my-1"}),f.map(P=>c.jsxs("button",{onClick:()=>d(P),className:`w-full flex items-center gap-2 p-3 text-sm transition-colors ${l===P?"bg-primary/10 text-primary border-r-2 border-primary":"text-text-secondary hover:bg-background-tertiary"}`,children:[C2[P]||c.jsx(Wj,{size:14}),P]},P))]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c.jsx("div",{className:"grid grid-cols-2 gap-3",children:F.map(P=>c.jsxs("button",{onClick:()=>h(P),className:`p-4 rounded-lg border text-left transition-colors ${u?.id===P.id?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[C2[P.platform],c.jsx("span",{className:"font-medium text-text-primary",children:P.name})]}),P.recommended&&c.jsx(xa,{size:12,className:"text-yellow-500 fill-yellow-500"})]}),c.jsx("p",{className:"text-[10px] text-text-muted mb-2",children:P.description}),"width"in P.settings&&c.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-secondary",children:[c.jsxs("span",{children:[P.settings.width,"x",P.settings.height]}),c.jsxs("span",{children:[P.settings.frameRate,"fps"]}),c.jsx("span",{children:P.aspectRatio})]}),P.maxDuration&&c.jsxs("div",{className:"flex items-center gap-1 mt-1 text-[10px] text-yellow-500",children:[c.jsx(pi,{size:10}),"Max ",P.maxDuration,"s"]})]},P.id))})})]}),c.jsx(Zd,{value:"custom",className:"flex-1 overflow-y-auto p-4 mt-0",children:c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Format"}),c.jsxs(Pt,{value:x.format,onValueChange:P=>v({...x,format:P}),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"mp4",children:"MP4"}),c.jsx(ze,{value:"webm",children:"WebM"}),c.jsx(ze,{value:"mov",children:"MOV"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Codec"}),c.jsxs(Pt,{value:x.codec,onValueChange:P=>v({...x,codec:P}),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"h264",children:"H.264"}),c.jsx(ze,{value:"h265",children:"H.265 (HEVC)"}),c.jsx(ze,{value:"prores",children:"ProRes"}),c.jsx(ze,{value:"vp9",children:"VP9"}),c.jsx(ze,{value:"av1",children:"AV1"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Resolution"}),c.jsxs(Pt,{value:`${x.width}x${x.height}`,onValueChange:P=>{const[W,z]=P.split("x").map(Number);v({...x,width:W,height:z})},children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"3840x2160",children:"4K (3840x2160)"}),c.jsx(ze,{value:"2560x1440",children:"2K (2560x1440)"}),c.jsx(ze,{value:"1920x1080",children:"1080p (1920x1080)"}),c.jsx(ze,{value:"1280x720",children:"720p (1280x720)"}),c.jsx(ze,{value:"854x480",children:"480p (854x480)"}),c.jsx(ze,{value:"1080x1920",children:"Vertical 1080p"}),c.jsx(ze,{value:"1080x1080",children:"Square 1080"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Frame Rate"}),c.jsxs(Pt,{value:String(x.frameRate),onValueChange:P=>v({...x,frameRate:Number(P)}),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"24",children:"24 fps"}),c.jsx(ze,{value:"25",children:"25 fps"}),c.jsx(ze,{value:"30",children:"30 fps"}),c.jsx(ze,{value:"50",children:"50 fps"}),c.jsx(ze,{value:"60",children:"60 fps"})]})]})]}),c.jsxs("div",{children:[c.jsx(ss,{className:"block text-xs font-medium text-text-secondary mb-2",children:"Bitrate (kbps)"}),c.jsx(Ns,{type:"number",value:x.bitrate,onChange:P=>v({...x,bitrate:Number(P.target.value)}),className:"bg-background-tertiary border-border text-text-primary",min:1e3,max:15e4,step:1e3})]}),c.jsxs("div",{children:[c.jsx(ss,{className:"block text-xs font-medium text-text-secondary mb-2",children:"Quality"}),c.jsx(rt,{value:[x.quality],onValueChange:P=>v({...x,quality:P[0]}),min:50,max:100,step:1,className:"w-full"}),c.jsxs("div",{className:"flex justify-between text-[10px] text-text-muted mt-1",children:[c.jsx("span",{children:"Smaller"}),c.jsxs("span",{children:[x.quality,"%"]}),c.jsx("span",{children:"Better"})]})]}),c.jsxs("div",{className:"col-span-2",children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Audio Settings"}),c.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[c.jsxs(Pt,{value:x.audioSettings.format,onValueChange:P=>v({...x,audioSettings:{...x.audioSettings,format:P}}),children:[c.jsx(Ct,{className:"bg-background-tertiary border-border text-text-primary text-xs",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"aac",children:"AAC"}),c.jsx(ze,{value:"mp3",children:"MP3"}),c.jsx(ze,{value:"wav",children:"WAV"})]})]}),c.jsxs(Pt,{value:String(x.audioSettings.sampleRate),onValueChange:P=>v({...x,audioSettings:{...x.audioSettings,sampleRate:Number(P)}}),children:[c.jsx(Ct,{className:"bg-background-tertiary border-border text-text-primary text-xs",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"44100",children:"44.1 kHz"}),c.jsx(ze,{value:"48000",children:"48 kHz"}),c.jsx(ze,{value:"96000",children:"96 kHz"})]})]}),c.jsxs(Pt,{value:String(x.audioSettings.bitrate),onValueChange:P=>v({...x,audioSettings:{...x.audioSettings,bitrate:Number(P)}}),children:[c.jsx(Ct,{className:"bg-background-tertiary border-border text-text-primary text-xs",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"128",children:"128 kbps"}),c.jsx(ze,{value:"192",children:"192 kbps"}),c.jsx(ze,{value:"256",children:"256 kbps"}),c.jsx(ze,{value:"320",children:"320 kbps"})]})]})]})]}),c.jsxs("div",{className:"col-span-2 border-t border-border pt-4 mt-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(zs,{size:14,className:"text-primary"}),c.jsx(ss,{htmlFor:"upscaling-switch",className:"text-xs font-medium text-text-secondary",children:"Enhance Quality (Upscaling)"})]}),c.jsx(wa,{id:"upscaling-switch",checked:x.upscaling?.enabled??!1,onCheckedChange:P=>v({...x,upscaling:{...x.upscaling,enabled:P}})})]}),x.upscaling?.enabled&&c.jsxs("div",{className:"space-y-3 pl-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-text-muted mb-1.5",children:"Quality Mode"}),c.jsx("div",{className:"flex gap-2",children:["fast","balanced","quality"].map(P=>c.jsx("button",{type:"button",onClick:()=>v({...x,upscaling:{...x.upscaling,quality:P}}),className:`flex-1 px-2 py-1.5 text-[10px] rounded border transition-colors ${x.upscaling?.quality===P?"border-primary bg-primary/10 text-primary":"border-border text-text-secondary hover:border-primary/50"}`,children:P.charAt(0).toUpperCase()+P.slice(1)},P))})]}),c.jsxs("div",{children:[c.jsx(ss,{className:"block text-[10px] text-text-muted mb-1.5",children:"Sharpening"}),c.jsx(rt,{value:[Math.round((x.upscaling?.sharpening??.3)*100)],onValueChange:P=>v({...x,upscaling:{...x.upscaling,sharpening:P[0]/100}}),min:0,max:100,step:1,className:"w-full"}),c.jsxs("div",{className:"flex justify-between text-[10px] text-text-muted mt-1",children:[c.jsx("span",{children:"None"}),c.jsxs("span",{children:[Math.round((x.upscaling?.sharpening??.3)*100),"%"]}),c.jsx("span",{children:"Max"})]})]}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Enhance quality when exporting to higher resolutions than source. Uses edge-directed interpolation for sharper details."})]})]})]})})]}),b&&c.jsxs("div",{className:"px-4 py-3 border-t border-border bg-background-tertiary/50",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("button",{onClick:()=>R(!D),className:"flex items-center gap-2 text-xs text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(bL,{size:12}),c.jsx("span",{children:bX(b)}),c.jsx(qj,{size:10,className:"text-text-muted"})]}),k&&c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[k.confidence==="measured"?c.jsx(Rx,{size:12,className:"text-green-500"}):c.jsx(GL,{size:12,className:"text-yellow-500"}),c.jsx("span",{className:"text-text-secondary",children:"Est. time:"}),c.jsx("span",{className:"font-medium text-text-primary",children:k.formatted})]}),CX(b)&&!j&&c.jsxs("button",{onClick:B,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-primary bg-primary/10 rounded hover:bg-primary/20 transition-colors",children:[c.jsx(zs,{size:10}),"Get accurate estimate"]}),j&&M&&c.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[c.jsx("div",{className:"w-16 h-1 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${M.progress*100}%`}})}),c.jsx("span",{children:"Testing..."})]})]})]}),D&&c.jsxs("div",{className:"mt-3 pt-3 border-t border-border/50 grid grid-cols-3 gap-4 text-[10px]",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-text-muted",children:"CPU"}),c.jsxs("p",{className:"text-text-primary font-medium",children:[b.cpu.cores," cores"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-text-muted",children:"GPU"}),c.jsx("p",{className:"text-text-primary font-medium truncate",title:b.gpu.renderer,children:b.gpu.renderer!=="Unknown"?b.gpu.renderer.replace(/ANGLE \(|, .*\)/g,"").replace(/Direct3D11.*$/g,"").trim():"Unknown"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:b.gpu.hasHardwareEncoding?"HW Encode":"Software only"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-text-muted",children:"Codecs"}),c.jsx("div",{className:"flex gap-1 flex-wrap",children:A.slice(0,3).map(P=>c.jsx("span",{className:`px-1 py-0.5 rounded text-[9px] ${P.speedRating==="fast"?"bg-green-500/20 text-green-400":P.speedRating==="medium"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:P.codec.toUpperCase()},P.codec))})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border bg-background-tertiary",children:[c.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:s>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(pi,{size:12}),ee(s)]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(XL,{size:12}),"~",K(a==="presets"&&u?u.settings.bitrate||8e3:x.bitrate,s)]}),k&&b?.encoding[x.codec]?.hardware&&c.jsxs("div",{className:"flex items-center gap-1 text-green-500",children:[c.jsx(zs,{size:12}),"Hardware accelerated"]})]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Rt,{variant:"ghost",onClick:e,children:"Cancel"}),c.jsxs(Rt,{onClick:I,disabled:a==="presets"&&!u,children:[c.jsx(ii,{size:16}),"Start Export"]})]})]})]})}):null},S2={"480p":{width:854,height:480},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080},"1440p":{width:2560,height:1440},"4k":{width:3840,height:2160}},T2={"480p":25e5,"720p":5e6,"1080p":12e6,"1440p":2e7,"4k":4e7};class Ey{screenRecorder=null;webcamRecorder=null;screenChunks=[];webcamChunks=[];screenStream=null;webcamStream=null;micStream=null;startTime=0;pausedDuration=0;pauseStartTime=0;durationInterval=null;eventHandlers=new Map;isStopping=!1;lastResult=null;on(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t),()=>this.eventHandlers.get(e)?.delete(t)}emit(e,t){this.eventHandlers.get(e)?.forEach(s=>s(t))}async requestPermissions(e){const t=S2[e.video.resolution],s={video:{width:{ideal:t.width},height:{ideal:t.height},frameRate:{ideal:e.video.frameRate}},audio:e.audio.systemAudio};if(this.screenStream=await navigator.mediaDevices.getDisplayMedia(s),e.audio.microphone)try{this.micStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})}catch{console.warn("Microphone access denied, continuing without microphone")}if(e.webcam.enabled){const i=S2[e.webcam.resolution];try{this.webcamStream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:i.width},height:{ideal:i.height},facingMode:"user"},audio:!1})}catch{console.warn("Webcam access denied, continuing without webcam")}}return{screenStream:this.screenStream,webcamStream:this.webcamStream||void 0}}async startRecording(e){if(!this.screenStream)throw new Error("Screen stream not initialized. Call requestPermissions first.");this.screenChunks=[],this.webcamChunks=[],this.isStopping=!1,this.lastResult=null;const t=new MediaStream;this.screenStream.getVideoTracks().forEach(n=>t.addTrack(n)),this.screenStream.getAudioTracks().length>0&&this.screenStream.getAudioTracks().forEach(n=>t.addTrack(n)),this.micStream&&this.micStream.getAudioTracks().forEach(n=>t.addTrack(n));const s=this.getBestMimeType(),i=T2[e.video.resolution];if(this.screenRecorder=new MediaRecorder(t,{mimeType:s,videoBitsPerSecond:i}),this.screenRecorder.ondataavailable=n=>{n.data.size>0&&this.screenChunks.push(n.data)},this.screenRecorder.onerror=n=>{this.emit("error",n)},this.screenStream.getVideoTracks()[0].onended=()=>{this.stopRecording()},this.webcamStream&&e.webcam.enabled){const n=this.getBestMimeType(),a=T2[e.webcam.resolution];this.webcamRecorder=new MediaRecorder(this.webcamStream,{mimeType:n,videoBitsPerSecond:a}),this.webcamRecorder.ondataavailable=o=>{o.data.size>0&&this.webcamChunks.push(o.data)},this.webcamRecorder.start(1e3)}this.screenRecorder.start(1e3),this.startTime=Date.now(),this.pausedDuration=0,this.durationInterval=window.setInterval(()=>{const n=Date.now()-this.startTime-this.pausedDuration;this.emit("duration",n)},100),this.emit("start")}pauseRecording(){this.screenRecorder?.state==="recording"&&(this.screenRecorder.pause(),this.pauseStartTime=Date.now()),this.webcamRecorder?.state==="recording"&&this.webcamRecorder.pause(),this.emit("pause")}resumeRecording(){this.screenRecorder?.state==="paused"&&(this.screenRecorder.resume(),this.pausedDuration+=Date.now()-this.pauseStartTime),this.webcamRecorder?.state==="paused"&&this.webcamRecorder.resume(),this.emit("resume")}async stopRecording(){if(this.lastResult)return this.lastResult;if(this.isStopping)return await new Promise(s=>{const i=setInterval(()=>{this.lastResult&&(clearInterval(i),s())},50);setTimeout(()=>{clearInterval(i),s()},5e3)}),this.lastResult||{screenBlob:new Blob};this.isStopping=!0,this.durationInterval&&(clearInterval(this.durationInterval),this.durationInterval=null);const e={screenBlob:new Blob},t=[];return this.screenRecorder&&this.screenRecorder.state!=="inactive"?t.push(this.stopRecorder(this.screenRecorder,this.screenChunks).then(s=>{e.screenBlob=s})):this.screenChunks.length>0&&(e.screenBlob=new Blob(this.screenChunks,{type:"video/webm"})),this.webcamRecorder&&this.webcamRecorder.state!=="inactive"?t.push(this.stopRecorder(this.webcamRecorder,this.webcamChunks).then(s=>{e.webcamBlob=s})):this.webcamChunks.length>0&&(e.webcamBlob=new Blob(this.webcamChunks,{type:"video/webm"})),await Promise.all(t),this.lastResult=e,this.cleanup(),this.emit("stop",e),e}cancelRecording(){this.durationInterval&&(clearInterval(this.durationInterval),this.durationInterval=null),this.screenRecorder&&this.screenRecorder.state!=="inactive"&&this.screenRecorder.stop(),this.webcamRecorder&&this.webcamRecorder.state!=="inactive"&&this.webcamRecorder.stop(),this.cleanup()}getRecordingState(){return this.screenRecorder?.state||"inactive"}isRecording(){return this.screenRecorder?.state==="recording"}isPaused(){return this.screenRecorder?.state==="paused"}stopRecorder(e,t){return new Promise(s=>{e.onstop=()=>{const i=e.mimeType||"video/webm";s(new Blob(t,{type:i}))},e.stop()})}getBestMimeType(){const e=["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=h264,opus","video/webm","video/mp4"];for(const t of e)if(MediaRecorder.isTypeSupported(t))return t;return"video/webm"}cleanup(){this.screenStream?.getTracks().forEach(e=>e.stop()),this.webcamStream?.getTracks().forEach(e=>e.stop()),this.micStream?.getTracks().forEach(e=>e.stop()),this.screenStream=null,this.webcamStream=null,this.micStream=null,this.screenRecorder=null,this.webcamRecorder=null,this.screenChunks=[],this.webcamChunks=[]}static isSupported(){const e=typeof navigator.mediaDevices?.getDisplayMedia=="function",s=typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported("video/webm");return e&&s}static getSupportedFeatures(){const e=/Chrome|Chromium|Edge/.test(navigator.userAgent),t=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);return{screenCapture:!!navigator.mediaDevices?.getDisplayMedia,systemAudio:e,webcam:!!navigator.mediaDevices?.getUserMedia,vp9:MediaRecorder.isTypeSupported("video/webm;codecs=vp9"),h264:MediaRecorder.isTypeSupported("video/webm;codecs=h264")||t}}}const Rr=new Ey;function A2(r){const e=Math.floor(r/1e3),t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;return t>0?`${t}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${s}:${i.toString().padStart(2,"0")}`}const X7={video:{resolution:"1080p",frameRate:30},audio:{systemAudio:!0,microphone:!1},webcam:{enabled:!1,resolution:"720p"}},XP=Ta((r,e)=>(Rr.on("duration",t=>{r({duration:t})}),Rr.on("stop",()=>{r({status:"processing"})}),Rr.on("error",t=>{const s=t instanceof Error?t.message:"Recording error occurred";r({status:"error",error:s})}),{status:"idle",duration:0,error:null,options:X7,screenStream:null,webcamStream:null,result:null,isModalOpen:!1,isControlsMinimized:!1,setOptions:t=>{r(s=>({options:{...s.options,...t,video:{...s.options.video,...t.video},audio:{...s.options.audio,...t.audio},webcam:{...s.options.webcam,...t.webcam}}}))},setVideoOption:(t,s)=>{r(i=>({options:{...i.options,video:{...i.options.video,[t]:s}}}))},setAudioOption:(t,s)=>{r(i=>({options:{...i.options,audio:{...i.options.audio,[t]:s}}}))},setWebcamOption:(t,s)=>{r(i=>({options:{...i.options,webcam:{...i.options.webcam,[t]:s}}}))},requestPermissions:async()=>{const{options:t}=e();r({status:"requesting",error:null});try{const s=await Rr.requestPermissions(t);return r({screenStream:s.screenStream,webcamStream:s.webcamStream||null,status:"idle"}),!0}catch(s){const i=s instanceof Error?s.message:"Permission denied";return r({status:"error",error:i}),!1}},startRecording:async()=>{const{options:t,screenStream:s}=e();if(!s){r({status:"error",error:"No screen stream available"});return}r({status:"countdown"}),await new Promise(i=>setTimeout(i,3e3));try{await Rr.startRecording(t),r({status:"recording",duration:0})}catch(i){const n=i instanceof Error?i.message:"Failed to start recording";r({status:"error",error:n})}},pauseRecording:()=>{Rr.pauseRecording(),r({status:"paused"})},resumeRecording:()=>{Rr.resumeRecording(),r({status:"recording"})},stopRecording:async()=>{r({status:"processing"});try{const t=await Rr.stopRecording();return r({result:t,status:"idle"}),t}catch(t){const s=t instanceof Error?t.message:"Failed to stop recording";return r({status:"error",error:s}),null}},cancelRecording:()=>{Rr.cancelRecording(),r({status:"idle",duration:0,screenStream:null,webcamStream:null,result:null})},reset:()=>{Rr.cancelRecording(),r({status:"idle",duration:0,error:null,screenStream:null,webcamStream:null,result:null,isModalOpen:!1,isControlsMinimized:!1})},openModal:()=>{r({isModalOpen:!0})},closeModal:()=>{const{status:t}=e();(t==="idle"||t==="error")&&r({isModalOpen:!1,error:null})},minimizeControls:()=>{r({isControlsMinimized:!0})},expandControls:()=>{r({isControlsMinimized:!1})}})),K7=()=>{const[r,e]=w.useState(3);return w.useEffect(()=>{if(r>0){const t=setTimeout(()=>e(r-1),1e3);return()=>clearTimeout(t)}},[r]),c.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-md",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"text-[180px] font-bold text-white animate-countdown",style:{textShadow:"0 0 60px rgba(239, 68, 68, 0.8), 0 0 100px rgba(239, 68, 68, 0.4)"},children:r>0?r:""},r),r===0&&c.jsx("div",{className:"flex flex-col items-center gap-4 animate-fade-in",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-4 h-4 bg-error rounded-full animate-pulse"}),c.jsx("span",{className:"text-2xl font-bold text-white",children:"Recording..."})]})})]}),c.jsx("style",{children:`
 @keyframes countdown {
 0% {
 transform: scale(0.5);
 opacity: 0;
 }
 20% {
 transform: scale(1.2);
 opacity: 1;
 }
 40% {
 transform: scale(1);
 }
 100% {
 transform: scale(0.8);
 opacity: 0;
 }
 }

 @keyframes fade-in {
 from {
 opacity: 0;
 transform: translateY(20px);
 }
 to {
 opacity: 1;
 transform: translateY(0);
 }
 }

 .animate-countdown {
 animation: countdown 1s ease-out forwards;
 }

 .animate-fade-in {
 animation: fade-in 0.5s ease-out forwards;
 }
 `})]})},Q7=({onStop:r,onPause:e,onResume:t,onCancel:s})=>{const{status:i,duration:n,isControlsMinimized:a,minimizeControls:o,expandControls:l}=XP(),d=i==="paused";return a?c.jsxs("button",{onClick:l,className:"fixed bottom-6 right-6 z-[200] flex items-center gap-2 px-4 py-2 bg-red-600 rounded-full shadow-2xl hover:bg-red-700 transition-all group",children:[c.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"}),c.jsx("span",{className:"text-sm font-bold text-white",children:A2(n)})]}):c.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-[200]",children:c.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 bg-background-secondary/95 backdrop-blur-xl border border-border rounded-2xl shadow-2xl",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${d?"bg-warning":"bg-error animate-pulse"}`}),c.jsx("span",{className:"text-lg font-mono font-bold text-text-primary min-w-[80px]",children:A2(n)})]}),c.jsx("div",{className:"w-px h-8 bg-border"}),c.jsxs("div",{className:"flex items-center gap-2",children:[d?c.jsx("button",{onClick:t,className:"p-3 bg-primary hover:bg-primary-hover rounded-xl transition-colors",title:"Resume recording",children:c.jsx(ii,{size:20,className:"text-white"})}):c.jsx("button",{onClick:e,className:"p-3 bg-warning/20 hover:bg-warning/30 rounded-xl transition-colors",title:"Pause recording",children:c.jsx(Xj,{size:20,className:"text-warning"})}),c.jsx("button",{onClick:r,className:"p-3 bg-red-600 hover:bg-red-700 rounded-xl transition-colors",title:"Stop recording",children:c.jsx(rs,{size:20,className:"text-white fill-white"})}),c.jsx("button",{onClick:s,className:"p-3 bg-background-tertiary hover:bg-background-elevated rounded-xl transition-colors",title:"Cancel recording",children:c.jsx(ti,{size:20,className:"text-text-muted"})})]}),c.jsx("div",{className:"w-px h-8 bg-border"}),c.jsx("button",{onClick:o,className:"p-2 text-text-muted hover:text-text-primary rounded-lg hover:bg-background-tertiary transition-colors",title:"Minimize controls",children:c.jsx(Hj,{size:16})})]})})},j2=[{value:"720p",label:"720p HD",desc:"1280720 - Smaller files"},{value:"1080p",label:"1080p Full HD",desc:"19201080 - Recommended"},{value:"1440p",label:"1440p QHD",desc:"25601440 - High quality"},{value:"4k",label:"4K Ultra HD",desc:"38402160 - Maximum quality"}],J7=[{value:30,label:"30 fps"},{value:60,label:"60 fps"}],Z7=[{value:"480p",label:"480p"},{value:"720p",label:"720p"},{value:"1080p",label:"1080p"}],eK=({isOpen:r,onClose:e,onRecordingComplete:t})=>{const{status:s,options:i,webcamStream:n,error:a,setVideoOption:o,setAudioOption:l,setWebcamOption:d,requestPermissions:u,startRecording:h,stopRecording:p,cancelRecording:m,pauseRecording:f,resumeRecording:g,reset:y}=XP(),x=w.useRef(null),v=Ey.isSupported(),b=Ey.getSupportedFeatures();w.useEffect(()=>{x.current&&n&&(x.current.srcObject=n)},[n]),w.useEffect(()=>{r||(s==="idle"||s==="error")&&y()},[r,s,y]);const S=async()=>{await u()&&await h()},k=async()=>{const A=await p();A&&(t(A.screenBlob,A.webcamBlob),e())},C=()=>{m(),e()};return r?s==="countdown"?c.jsx(K7,{}):s==="recording"||s==="paused"?c.jsx(Q7,{onStop:k,onPause:f,onResume:g,onCancel:C}):c.jsx(Ea,{open:!0,onOpenChange:A=>!A&&C(),children:c.jsxs(En,{className:"max-w-2xl p-0 gap-0 bg-background-secondary border-border overflow-hidden",children:[c.jsx(Ma,{className:"p-4 border-b border-border bg-background-tertiary space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Wr,{size:20,className:"text-error fill-error animate-pulse"}),c.jsx(Pa,{className:"text-lg font-bold text-text-primary",children:"Screen Recording"})]})}),c.jsxs("div",{className:"p-6 space-y-6",children:[!v&&c.jsxs("div",{className:"flex items-start gap-3 p-4 bg-error/10 border border-error/30 rounded-lg",children:[c.jsx(_o,{size:20,className:"text-error flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-error",children:"Screen recording not supported"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Your browser doesn't support screen recording. Please use Chrome, Edge, or Firefox."})]})]}),a&&c.jsxs("div",{className:"flex items-start gap-3 p-4 bg-error/10 border border-error/30 rounded-lg",children:[c.jsx(_o,{size:20,className:"text-error flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-error",children:"Recording Error"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:a})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:[c.jsx(ji,{size:16}),c.jsx("span",{children:"Video Settings"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-text-muted mb-2",children:"Resolution"}),c.jsxs(Pt,{value:i.video.resolution,onValueChange:A=>o("resolution",A),disabled:!v,children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:j2.map(A=>c.jsx(ze,{value:A.value,children:A.label},A.value))})]}),c.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:j2.find(A=>A.value===i.video.resolution)?.desc})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-text-muted mb-2",children:"Frame Rate"}),c.jsxs(Pt,{value:String(i.video.frameRate),onValueChange:A=>o("frameRate",parseInt(A)),disabled:!v,children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:J7.map(A=>c.jsx(ze,{value:String(A.value),children:A.label},A.value))})]})]})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:[c.jsx(Gc,{size:16}),c.jsx("span",{children:"Audio Settings"})]}),c.jsxs("div",{className:"flex gap-4",children:[c.jsxs("button",{onClick:()=>l("systemAudio",!i.audio.systemAudio),disabled:!v||!b.systemAudio,className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border transition-all ${i.audio.systemAudio?"bg-primary/10 border-primary text-primary":"bg-background-tertiary border-border text-text-secondary hover:border-text-muted"} ${(!v||!b.systemAudio)&&"opacity-50 cursor-not-allowed"}`,children:[i.audio.systemAudio?c.jsx(Tn,{size:18}):c.jsx(hp,{size:18}),c.jsx("span",{className:"text-sm",children:"System Audio"})]}),c.jsxs("button",{onClick:()=>l("microphone",!i.audio.microphone),disabled:!v,className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border transition-all ${i.audio.microphone?"bg-primary/10 border-primary text-primary":"bg-background-tertiary border-border text-text-secondary hover:border-text-muted"} ${!v&&"opacity-50 cursor-not-allowed"}`,children:[i.audio.microphone?c.jsx(w0,{size:18}):c.jsx(fO,{size:18}),c.jsx("span",{className:"text-sm",children:"Microphone"})]})]}),!b.systemAudio&&c.jsx("p",{className:"text-[10px] text-text-muted",children:"System audio capture is only available in Chrome and Edge browsers."})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:[c.jsx(ZB,{size:16}),c.jsx("span",{children:"Webcam Recording"})]}),c.jsx("button",{onClick:()=>d("enabled",!i.webcam.enabled),disabled:!v||!b.webcam,className:`relative w-12 h-6 rounded-full transition-colors ${i.webcam.enabled?"bg-primary":"bg-background-tertiary"} ${(!v||!b.webcam)&&"opacity-50 cursor-not-allowed"}`,children:c.jsx("div",{className:`absolute top-1 w-4 h-4 bg-white rounded-full transition-transform ${i.webcam.enabled?"translate-x-7":"translate-x-1"}`})})]}),i.webcam.enabled&&c.jsxs("div",{className:"flex gap-4",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"block text-xs text-text-muted mb-2",children:"Webcam Resolution"}),c.jsxs(Pt,{value:i.webcam.resolution,onValueChange:A=>d("resolution",A),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:Z7.map(A=>c.jsx(ze,{value:A.value,children:A.label},A.value))})]})]}),n&&c.jsx("div",{className:"w-32 h-24 bg-background-tertiary rounded-lg overflow-hidden border border-border",children:c.jsx("video",{ref:x,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"})})]}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Webcam will be recorded as a separate file, giving you full control in the editor."})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border bg-background-tertiary",children:[c.jsx("p",{className:"text-xs text-text-muted",children:"Recording will start after a 3-second countdown"}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:C,className:"px-4 py-2 text-sm text-text-secondary hover:text-text-primary transition-colors",children:"Cancel"}),c.jsx("button",{onClick:S,disabled:!v||s==="requesting",className:"flex items-center gap-2 px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:s==="requesting"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),c.jsx("span",{children:"Requesting Access..."})]}):c.jsxs(c.Fragment,{children:[c.jsx(Wr,{size:14,className:"fill-current"}),c.jsx("span",{children:"Start Recording"})]})})]})]})]})}):null},tK=()=>{const{actionHistory:r,undo:e,redo:t,canUndo:s,canRedo:i,clipUndoStack:n,clipRedoStack:a}=U(),[o,l]=w.useState([]),[d,u]=w.useState([]),[h,p]=w.useState(!1),[m,f]=w.useState(""),[g,y]=w.useState(!1),x=_=>{switch(_){case"text":return"Create text clip";case"shape":return"Create shape";case"svg":return"Import SVG";case"sticker":return"Add sticker";default:return"Create clip"}};w.useEffect(()=>{const _=()=>{const E=r.getDisplayHistory();u(r.getSnapshots());const D=E.map((R,B)=>({id:`action-${R.entry.action.id}-${B}`,description:R.entry.description,timestamp:R.entry.timestamp,isCurrent:R.isCurrent,isClipEntry:!1,groupId:R.entry.groupId}));n.forEach((R,B)=>{D.push({id:`clip-${R.clipId}-${B}`,description:x(R.type),timestamp:Date.now()-(n.length-B)*1e3,isCurrent:B===n.length-1&&a.length===0,isClipEntry:!0,clipType:R.type})}),D.sort((R,B)=>R.timestamp-B.timestamp),l(D)};_();const M=r.subscribe(_);return()=>M()},[r,n,a]);const v=w.useCallback(async()=>{s()&&await e()},[e,s]),b=w.useCallback(async()=>{i()&&await t()},[t,i]),S=w.useCallback(()=>{m.trim()&&(r.createSnapshot(m.trim()),f(""),y(!1))},[r,m]),k=w.useCallback(_=>{r.deleteSnapshot(_)},[r]),C=_=>new Date(_).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),A=r.getUndoStackSize()+n.length,T=r.getRedoStackSize()+a.length,j=_=>{switch(_){case"text":return Vs;case"shape":return yu;case"svg":return Uc;case"sticker":return Zj;default:return Eh}};return c.jsxs("div",{className:"flex flex-col h-full",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Eh,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-sm font-medium text-text-primary",children:"History"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:v,disabled:!s(),className:"p-1.5 rounded hover:bg-background-tertiary disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:`Undo (${A})`,children:c.jsx(t_,{size:14})}),c.jsx("button",{onClick:b,disabled:!i(),className:"p-1.5 rounded hover:bg-background-tertiary disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:`Redo (${T})`,children:c.jsx(Qj,{size:14})})]})]}),c.jsxs("div",{className:"border-b border-border",children:[c.jsxs("button",{onClick:()=>p(!h),className:"w-full flex items-center gap-2 p-2 hover:bg-background-tertiary transition-colors",children:[h?c.jsx(ns,{size:12}):c.jsx(ei,{size:12}),c.jsx(x0,{size:12,className:"text-yellow-500"}),c.jsxs("span",{className:"text-xs text-text-secondary",children:["Snapshots (",d.length,")"]})]}),h&&c.jsxs("div",{className:"px-2 pb-2",children:[d.length===0&&!g&&c.jsx("p",{className:"text-[10px] text-text-muted py-2 text-center",children:"No snapshots saved"}),d.map(_=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-background-tertiary group",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(x0,{size:10,className:"text-yellow-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-text-primary",children:_.name}),c.jsx("p",{className:"text-[10px] text-text-muted",children:C(_.timestamp)})]})]}),c.jsx("button",{onClick:()=>k(_.id),className:"p-1 rounded hover:bg-red-500/20 text-text-muted hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all",children:c.jsx(bs,{size:10})})]},_.id)),g?c.jsxs("div",{className:"flex items-center gap-2 p-2",children:[c.jsx(Ns,{type:"text",value:m,onChange:_=>f(_.target.value),onKeyDown:_=>{_.key==="Enter"&&S(),_.key==="Escape"&&y(!1)},placeholder:"Snapshot name...",className:"flex-1 h-7 text-xs bg-background-tertiary border-border text-text-primary",autoFocus:!0}),c.jsx("button",{onClick:S,className:"px-2 py-1 bg-primary text-white rounded text-xs hover:bg-primary/80 transition-colors",children:"Save"})]}):c.jsxs("button",{onClick:()=>y(!0),className:"w-full flex items-center justify-center gap-1 p-2 rounded border border-dashed border-border hover:border-primary hover:text-primary transition-colors",children:[c.jsx(HB,{size:12}),c.jsx("span",{className:"text-[10px]",children:"Create Snapshot"})]})]})]}),c.jsx(ha,{className:"flex-1",children:o.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[c.jsx(Eh,{size:24,className:"mb-2 opacity-30"}),c.jsx("p",{className:"text-xs",children:"No actions yet"})]}):c.jsx("div",{className:"p-2 space-y-0.5",children:o.map(_=>{const M=_.isClipEntry?j(_.clipType):null;return c.jsxs("div",{className:`flex items-center gap-2 p-2 rounded transition-colors ${_.isCurrent?"bg-primary/20 border border-primary/30":"hover:bg-background-tertiary"}`,children:[_.isClipEntry&&M?c.jsx(M,{size:12,className:_.isCurrent?"text-primary":"text-text-muted"}):c.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${_.isCurrent?"bg-primary":"bg-text-muted"}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:`text-xs truncate ${_.isCurrent?"text-text-primary":"text-text-secondary"}`,children:_.description}),c.jsx("p",{className:"text-[10px] text-text-muted",children:C(_.timestamp)})]}),_.groupId&&c.jsx("span",{className:"px-1 py-0.5 bg-background-tertiary rounded text-[8px] text-text-muted",children:"grouped"}),_.isClipEntry&&c.jsx("span",{className:"px-1 py-0.5 bg-amber-500/20 rounded text-[8px] text-amber-400",children:"clip"})]},_.id)})})}),c.jsx("div",{className:"p-2 border-t border-border bg-background-tertiary",children:c.jsxs("div",{className:"flex items-center justify-between text-[10px] text-text-muted",children:[c.jsxs("span",{children:[A," actions"]}),c.jsxs("span",{children:[T," redoable"]})]})})]})};function sK(r){const e=Math.floor((Date.now()-r)/1e3);return e<60?"just now":e<3600?`${Math.floor(e/60)}m ago`:e<86400?`${Math.floor(e/3600)}h ago`:`${Math.floor(e/86400)}d ago`}const iK=()=>{const{project:r,createNewProject:e,recoverFromAutoSave:t,renameProject:s}=U(),[i,n]=w.useState(!1),[a,o]=w.useState([]),[l,d]=w.useState(!1),[u,h]=w.useState(r.name),[p,m]=w.useState(!1),f=w.useRef(null),g=w.useRef(null);w.useEffect(()=>{i&&(async()=>{try{await ar.initialize();const A=(await ar.checkForRecovery()).reduce((T,j)=>{const _=T.find(M=>M.projectId===j.projectId);return!_||j.timestamp>_.timestamp?[...T.filter(M=>M.projectId!==j.projectId),j]:T},[]);o(A.sort((T,j)=>j.timestamp-T.timestamp))}catch(C){console.warn("[ProjectSwitcher] Failed to load saved projects:",C)}})()},[i]),w.useEffect(()=>{const k=C=>{f.current&&!f.current.contains(C.target)&&(n(!1),d(!1))};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]),w.useEffect(()=>{l&&g.current&&(g.current.focus(),g.current.select())},[l]),w.useEffect(()=>{h(r.name)},[r.name]);const y=w.useCallback(async()=>{const k=u.trim();k&&k!==r.name&&await s(k),d(!1)},[u,r.name,s]),x=w.useCallback(k=>{k.key==="Enter"?y():k.key==="Escape"&&(h(r.name),d(!1))},[y,r.name]),v=w.useCallback(()=>{e(),n(!1)},[e]),b=w.useCallback(async k=>{m(!0);try{await t(k),n(!1)}catch(C){console.error("[ProjectSwitcher] Failed to switch project:",C)}finally{m(!1)}},[t]),S=a.filter(k=>k.projectId!==r.id);return c.jsxs("div",{className:"relative",ref:f,children:[c.jsxs("button",{onClick:()=>n(!i),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-background-secondary transition-colors group max-w-[200px]",children:[c.jsx(co,{className:"w-4 h-4 text-primary shrink-0"}),c.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:r.name}),c.jsx(ns,{className:`w-3.5 h-3.5 text-text-muted transition-transform duration-200 shrink-0 ${i?"rotate-180":""}`})]}),i&&c.jsxs("div",{className:"absolute top-full left-0 mt-2 w-72 bg-background border border-border rounded-xl shadow-2xl overflow-hidden z-50 animate-in fade-in slide-in-from-top-2 duration-150",children:[c.jsxs("div",{className:"p-3 border-b border-border",children:[c.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wider mb-2",children:"Current Project"}),l?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ns,{ref:g,type:"text",value:u,onChange:k=>h(k.target.value),onBlur:y,onKeyDown:x,className:"flex-1 bg-background-secondary border-primary text-text-primary"}),c.jsx("button",{onClick:y,className:"p-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors",children:c.jsx(Ri,{className:"w-4 h-4"})})]}):c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-secondary rounded-lg group",children:[c.jsx(co,{className:"w-4 h-4 text-primary shrink-0"}),c.jsx("span",{className:"flex-1 text-sm font-medium text-text-primary truncate",children:r.name}),c.jsx("button",{onClick:()=>d(!0),className:"p-1.5 rounded-md text-text-muted hover:text-text-primary hover:bg-background-tertiary transition-colors opacity-0 group-hover:opacity-100",title:"Rename project",children:c.jsx(MO,{className:"w-3.5 h-3.5"})})]})]}),c.jsx("div",{className:"p-2",children:c.jsxs("button",{onClick:v,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-background-secondary transition-colors text-left group",children:[c.jsx("div",{className:"p-1.5 bg-primary/10 rounded-md text-primary group-hover:bg-primary/20 transition-colors",children:c.jsx(Ar,{className:"w-4 h-4"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-sm font-medium text-text-primary",children:"New Project"}),c.jsx("div",{className:"text-xs text-text-muted",children:"Start fresh with a new canvas"})]})]})}),S.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"px-3 py-2 border-t border-border",children:c.jsxs("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wider flex items-center gap-2",children:[c.jsx(pi,{className:"w-3 h-3"}),"Recent Projects"]})}),c.jsx("div",{className:"max-h-64 overflow-y-auto px-2 pb-2",children:S.map(k=>c.jsxs("button",{onClick:()=>b(k.id),disabled:p,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-background-secondary transition-colors text-left group disabled:opacity-50",children:[c.jsx("div",{className:"p-1.5 bg-background-tertiary rounded-md text-text-muted group-hover:text-text-secondary transition-colors",children:c.jsx(Dx,{className:"w-4 h-4"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:k.projectName}),c.jsx("div",{className:"text-xs text-text-muted",children:sK(k.timestamp)})]})]},k.id))})]})]})]})},Xo=320,Ha=16,Hs=8,rK=({step:r,targetRect:e,currentStep:t,totalSteps:s,isFirstStep:i,isLastStep:n,onNext:a,onPrev:o,onSkip:l,onGoToStep:d})=>{const{position:u,arrowPosition:h}=w.useMemo(()=>{if(!e||r.position==="center")return{position:{x:0,y:0},arrowPosition:null};const m={width:window.innerWidth,height:window.innerHeight};let f=0,g=0,y=null;const x=12,v={left:e.left-x,top:e.top-x,right:e.right+x,bottom:e.bottom+x,width:e.width+x*2,height:e.height+x*2};switch(r.position){case"right":f=v.right+Ha,g=v.top+v.height/2-100,y="left";break;case"left":f=v.left-Xo-Ha,g=v.top+v.height/2-100,y="right";break;case"top":f=v.left+v.width/2-Xo/2,g=v.top-200-Ha,y="bottom";break;case"bottom":f=v.left+v.width/2-Xo/2,g=v.bottom+Ha,y="top";break}return f=Math.max(Ha,Math.min(f,m.width-Xo-Ha)),g=Math.max(Ha,Math.min(g,m.height-250)),{position:{x:f,y:g},arrowPosition:y}},[e,r.position]),p=r.position==="center"||!e;return c.jsx(Xt.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{type:"spring",stiffness:500,damping:30},className:`fixed z-[102] ${p?"inset-0 flex items-center justify-center pointer-events-none":""}`,style:p?void 0:{left:u.x,top:u.y,width:Xo},children:c.jsxs("div",{className:"relative bg-background-secondary border border-border rounded-xl shadow-2xl pointer-events-auto",style:{width:p?Xo:"100%"},children:[h&&!p&&c.jsx("div",{className:"absolute w-0 h-0",style:{...h==="left"&&{left:-Hs,top:"50%",transform:"translateY(-50%)",borderTop:`${Hs}px solid transparent`,borderBottom:`${Hs}px solid transparent`,borderRight:`${Hs}px solid var(--border)`},...h==="right"&&{right:-Hs,top:"50%",transform:"translateY(-50%)",borderTop:`${Hs}px solid transparent`,borderBottom:`${Hs}px solid transparent`,borderLeft:`${Hs}px solid var(--border)`},...h==="top"&&{top:-Hs,left:"50%",transform:"translateX(-50%)",borderLeft:`${Hs}px solid transparent`,borderRight:`${Hs}px solid transparent`,borderBottom:`${Hs}px solid var(--border)`},...h==="bottom"&&{bottom:-Hs,left:"50%",transform:"translateX(-50%)",borderLeft:`${Hs}px solid transparent`,borderRight:`${Hs}px solid transparent`,borderTop:`${Hs}px solid var(--border)`}}}),c.jsx("button",{onClick:l,className:"absolute top-3 right-3 p-1 rounded hover:bg-background-tertiary text-text-muted hover:text-text-primary transition-colors",children:c.jsx(ti,{size:14})}),c.jsxs("div",{className:"p-6",children:[c.jsx(Xt.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-lg font-bold text-text-primary mb-2",children:r.title},`title-${t}`),c.jsx(Xt.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"text-sm text-text-secondary mb-4",children:r.description},`desc-${t}`),r.tips&&r.tips.length>0&&c.jsx(Xt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-background-tertiary rounded-lg p-3 mb-4",children:c.jsx("ul",{className:"space-y-1.5",children:r.tips.map((m,f)=>c.jsxs("li",{className:"flex items-start gap-2 text-xs text-text-secondary",children:[c.jsx("span",{className:"text-primary mt-0.5",children:""}),m]},f))})},`tips-${t}`),c.jsx("div",{className:"flex items-center justify-center gap-1.5 mb-4",children:Array.from({length:s}).map((m,f)=>c.jsx("button",{onClick:()=>d(f),className:`w-2 h-2 rounded-full transition-all ${f===t?"bg-primary scale-110":"bg-border hover:bg-text-muted"}`},f))})]}),c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-border bg-background-tertiary rounded-b-xl",children:[c.jsxs("button",{onClick:o,disabled:i,className:"flex items-center gap-1 px-3 py-1.5 text-xs text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:[c.jsx(Vj,{size:14}),"Back"]}),c.jsx("button",{onClick:l,className:"px-3 py-1.5 text-xs text-text-muted hover:text-text-secondary transition-colors",children:"Skip Tour"}),c.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-4 py-1.5 bg-primary text-white rounded-lg text-xs font-medium hover:bg-primary/80 transition-colors",children:[n?"Get Started":"Next",!n&&c.jsx(ei,{size:14})]})]})]})})},ph=[{id:"welcome",target:null,title:"Welcome to OpenReel",description:"Let's take a quick tour of the editor",position:"center"},{id:"assets",target:"[data-tour='assets']",title:"Assets Panel",description:"Your creative toolkit. Import media, generate AI content, add shapes, stickers, and custom SVGs.",tips:["Drag & drop videos, audio, images","AI Gen tab: generate images & backgrounds with AI","Shapes & custom SVG imports","Stickers, backgrounds & overlays"],position:"right"},{id:"timeline",target:"[data-tour='timeline']",title:"Timeline",description:"Arrange and edit your clips. Drag to move, drag edges to trim.",tips:["Press S to split clips","Space to play/pause","Scroll to zoom"],position:"top"},{id:"preview",target:"[data-tour='preview']",title:"Preview",description:"Watch your video in real-time as you edit.",tips:["Arrow keys for frame navigation","Click to scrub","Fullscreen available"],position:"left"},{id:"inspector",target:"[data-tour='inspector']",title:"Inspector",description:"Select a clip to see its properties. Add effects, adjust colors, animate.",tips:["Transform, effects, color grading","Keyframe any property","AI-powered tools"],position:"left"},{id:"complete",target:null,title:"You're Ready!",description:"Start creating! Press ? anytime for keyboard shortcuts.",position:"center"}],Gh="openreel-onboarding-complete";let My={isActive:!1,currentStep:0};const Py=new Set;function nK(){Py.forEach(r=>r())}function aK(r){return Py.add(r),()=>Py.delete(r)}function _2(){return My}function ro(r){My={...My,...r},nK()}function oK(){ro({isActive:!0,currentStep:0})}function cK(){const r=w.useSyncExternalStore(aK,_2,_2),[e,t]=w.useState(null),s=ph[r.currentStep],i=r.currentStep===0,n=r.currentStep===ph.length-1,a=w.useCallback(()=>{if(!s?.target){t(null);return}const p=document.querySelector(s.target);t(p?p.getBoundingClientRect():null)},[s?.target]);w.useEffect(()=>{if(!r.isActive)return;a();const p=()=>a();window.addEventListener("resize",p);const m=setInterval(a,100);return()=>{window.removeEventListener("resize",p),clearInterval(m)}},[r.isActive,r.currentStep,a]);const o=w.useCallback(()=>{ro({currentStep:0,isActive:!0})},[]),l=w.useCallback(()=>{n?(localStorage.setItem(Gh,"true"),ro({isActive:!1})):ro({currentStep:r.currentStep+1})},[n,r.currentStep]),d=w.useCallback(()=>{i||ro({currentStep:r.currentStep-1})},[i,r.currentStep]),u=w.useCallback(()=>{localStorage.setItem(Gh,"true"),ro({isActive:!1})},[]),h=w.useCallback(p=>{p>=0&&p<ph.length&&ro({currentStep:p})},[]);return w.useEffect(()=>{if(!localStorage.getItem(Gh)){const m=setTimeout(()=>{o()},500);return()=>clearTimeout(m)}},[o]),w.useEffect(()=>{if(!r.isActive)return;const p=m=>{m.key==="Escape"?u():m.key==="ArrowRight"||m.key==="Enter"?l():m.key==="ArrowLeft"&&d()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[r.isActive,l,d,u]),{isActive:r.isActive,currentStep:r.currentStep,step:s,targetRect:e,isFirstStep:i,isLastStep:n,totalSteps:ph.length,start:o,next:l,prev:d,skip:u,goToStep:h}}const lK=()=>{const{isActive:r,currentStep:e,step:t,targetRect:s,isFirstStep:i,isLastStep:n,totalSteps:a,next:o,prev:l,skip:d,goToStep:u}=cK();if(!r||!t)return null;const h=12,p=!!s,m=p?{left:s.left-h,top:s.top-h,width:s.width+h*2,height:s.height+h*2}:null;return c.jsx(kx,{mode:"wait",children:c.jsxs("div",{className:"fixed inset-0 z-[100] pointer-events-none",children:[p&&m?c.jsxs(c.Fragment,{children:[c.jsx(Xt.div,{className:"fixed left-0 right-0 top-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:m.top},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`top-${e}`),c.jsx(Xt.div,{className:"fixed left-0 right-0 bottom-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:window.innerHeight-m.top-m.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`bottom-${e}`),c.jsx(Xt.div,{className:"fixed left-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:m.top,width:m.left,height:m.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`left-${e}`),c.jsx(Xt.div,{className:"fixed right-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:m.top,width:window.innerWidth-m.left-m.width,height:m.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`right-${e}`),c.jsx(Xt.div,{className:"fixed pointer-events-none border-2 border-primary rounded-lg",initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1,left:m.left,top:m.top,width:m.width,height:m.height},transition:{type:"spring",stiffness:300,damping:30},style:{boxShadow:"0 0 0 4px rgba(34, 197, 94, 0.2), 0 0 20px rgba(34, 197, 94, 0.3)"}},`ring-${e}`)]}):c.jsx(Xt.div,{className:"fixed inset-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:d},"full-overlay"),c.jsx(rK,{step:t,targetRect:s,currentStep:e,totalSteps:a,isFirstStep:i,isLastStep:n,onNext:o,onPrev:l,onSkip:d,onGoToStep:u})]},"tour-overlay")})},mh=[{id:"intro",target:null,title:"Motion Graphics & Animation",description:"Learn how to create professional animations with keyframes, motion paths, and particle effects.",position:"center"},{id:"keyframes-inspector",target:"[data-tour='inspector']",title:"Keyframe Animation",description:"Select any clip and expand the Keyframes section in the Inspector. Add keyframes to animate position, scale, rotation, and opacity over time.",tips:["Click the diamond icon to add a keyframe at current time","Each property can have its own animation curve","Choose from 30+ easing presets for smooth motion"],position:"left"},{id:"keyframes-timeline",target:"[data-tour='timeline']",title:"Timeline Keyframe View",description:"Click the expand arrow on any track header to reveal keyframe sub-tracks. Drag keyframe diamonds to adjust timing visually.",tips:["Diamond markers show keyframe positions","Drag horizontally to change timing","Click the curve between keyframes to edit easing"],position:"top"},{id:"keyframe-editor",target:"[data-tour='toolbar']",title:"Graph Editor",description:"Open the Keyframe Editor panel from the toolbar for precise control. Edit value curves, copy/paste keyframes, and fine-tune animations.",tips:["Drag keyframe points to adjust time and value","Select multiple keyframes with Shift+click","Apply easing presets to selected keyframes"],position:"bottom"},{id:"motion-path",target:"[data-tour='preview']",title:"Motion Paths",description:"Create smooth movement along custom paths. Enable Motion Path mode to draw bezier curves directly on the preview canvas.",tips:["Click on the canvas to add path points","Drag control handles to curve the path","Elements follow the path as they animate","Great for flying logos and dynamic text"],position:"left"},{id:"particle-effects",target:"[data-tour='inspector']",title:"Particle Effects",description:"Add cinematic particle effects like confetti, sparkles, dust, and explosions. Find them in the Inspector's Particle Effects section.",tips:["Choose from preset effects or customize","Adjust particle count, speed, and colors","Set timing for when effects appear","Combine with keyframes for dramatic reveals"],position:"left"},{id:"emphasis-animations",target:"[data-tour='inspector']",title:"Emphasis Animations",description:"Make elements pop with attention-grabbing animations. Pulse, bounce, shake, wiggle, and more - perfect for highlighting important content.",tips:["24 built-in emphasis presets","Set duration and loop count","Combine with entrance/exit animations"],position:"left"},{id:"text-animations",target:"[data-tour='inspector']",title:"Text Animation Presets",description:"Animate text with professional presets. Characters can fade in, slide, bounce, or appear with typewriter effects.",tips:["19 text animation styles available","Per-character or per-word animation","Customize timing and easing"],position:"left"},{id:"complete",target:null,title:"Start Animating!",description:"You're ready to create professional motion graphics. Select a clip and start experimenting with keyframes and effects.",tips:["Press K to add a keyframe at playhead","Use ? to see all keyboard shortcuts","Combine effects for unique animations"],position:"center"}],Ny="openreel-mograph-tour-complete";let Ry={isActive:!1,currentStep:0};const Iy=new Set;function dK(){Iy.forEach(r=>r())}function uK(r){return Iy.add(r),()=>Iy.delete(r)}function E2(){return Ry}function no(r){Ry={...Ry,...r},dK()}function hK(){no({isActive:!0,currentStep:0})}function pK(){const r=w.useSyncExternalStore(uK,E2,E2),[e,t]=w.useState(null),s=mh[r.currentStep],i=r.currentStep===0,n=r.currentStep===mh.length-1,a=w.useCallback(()=>{if(!s?.target){t(null);return}const p=document.querySelector(s.target);t(p?p.getBoundingClientRect():null)},[s?.target]);w.useEffect(()=>{if(!r.isActive)return;a();const p=()=>a();window.addEventListener("resize",p);const m=setInterval(a,100);return()=>{window.removeEventListener("resize",p),clearInterval(m)}},[r.isActive,r.currentStep,a]);const o=w.useCallback(()=>{no({currentStep:0,isActive:!0})},[]),l=w.useCallback(()=>{n?(localStorage.setItem(Ny,"true"),no({isActive:!1})):no({currentStep:r.currentStep+1})},[n,r.currentStep]),d=w.useCallback(()=>{i||no({currentStep:r.currentStep-1})},[i,r.currentStep]),u=w.useCallback(()=>{localStorage.setItem(Ny,"true"),no({isActive:!1})},[]),h=w.useCallback(p=>{p>=0&&p<mh.length&&no({currentStep:p})},[]);return w.useEffect(()=>{if(!r.isActive)return;const p=m=>{m.key==="Escape"?u():m.key==="ArrowRight"||m.key==="Enter"?l():m.key==="ArrowLeft"&&d()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[r.isActive,l,d,u]),{isActive:r.isActive,currentStep:r.currentStep,step:s,targetRect:e,isFirstStep:i,isLastStep:n,totalSteps:mh.length,start:o,next:l,prev:d,skip:u,goToStep:h}}const mK=()=>{const{isActive:r,currentStep:e,step:t,targetRect:s,isFirstStep:i,isLastStep:n,totalSteps:a,next:o,prev:l,skip:d,goToStep:u}=pK();if(!r||!t)return null;const h=12,p=!!s,m=p?{left:s.left-h,top:s.top-h,width:s.width+h*2,height:s.height+h*2}:null,g=(()=>{if(!p||!m)return{left:"50%",top:"50%",transform:"translate(-50%, -50%)"};const y=380,x=16;switch(t.position){case"right":return{left:m.left+m.width+x,top:m.top+m.height/2,transform:"translateY(-50%)",maxWidth:window.innerWidth-m.left-m.width-x-20};case"left":return{left:m.left-x,top:m.top+m.height/2,transform:"translate(-100%, -50%)",maxWidth:m.left-x-20};case"top":return{left:m.left+m.width/2,top:m.top-x,transform:"translate(-50%, -100%)",maxWidth:y};case"bottom":return{left:m.left+m.width/2,top:m.top+m.height+x,transform:"translateX(-50%)",maxWidth:y};default:return{left:"50%",top:"50%",transform:"translate(-50%, -50%)",maxWidth:y}}})();return c.jsx(kx,{mode:"wait",children:c.jsxs("div",{className:"fixed inset-0 z-[100] pointer-events-none",children:[p&&m?c.jsxs(c.Fragment,{children:[c.jsx(Xt.div,{className:"fixed left-0 right-0 top-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:m.top},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`top-${e}`),c.jsx(Xt.div,{className:"fixed left-0 right-0 bottom-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:window.innerHeight-m.top-m.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`bottom-${e}`),c.jsx(Xt.div,{className:"fixed left-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:m.top,width:m.left,height:m.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`left-${e}`),c.jsx(Xt.div,{className:"fixed right-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:m.top,width:window.innerWidth-m.left-m.width,height:m.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`right-${e}`),c.jsx(Xt.div,{className:"fixed pointer-events-none border-2 border-purple-500 rounded-lg",initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1,left:m.left,top:m.top,width:m.width,height:m.height},transition:{type:"spring",stiffness:300,damping:30},style:{boxShadow:"0 0 0 4px rgba(168, 85, 247, 0.2), 0 0 20px rgba(168, 85, 247, 0.3)"}},`ring-${e}`)]}):c.jsx(Xt.div,{className:"fixed inset-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:d},"full-overlay"),c.jsxs(Xt.div,{className:"fixed pointer-events-auto bg-background-secondary border border-purple-500/30 rounded-xl shadow-2xl overflow-hidden",initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{type:"spring",stiffness:400,damping:30},style:{...g,width:380},children:[c.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-3 flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:c.jsx(Xp,{size:16,className:"text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-white font-semibold text-sm",children:t.title}),c.jsxs("p",{className:"text-white/60 text-[10px]",children:["Motion Graphics Tour  Step ",e+1," of ",a]})]}),c.jsx("button",{onClick:d,className:"p-1 rounded hover:bg-white/10 text-white/60 hover:text-white transition-colors",children:c.jsx(ti,{size:16})})]}),c.jsxs("div",{className:"p-4",children:[c.jsx("p",{className:"text-text-secondary text-sm leading-relaxed mb-4",children:t.description}),t.tips&&t.tips.length>0&&c.jsxs("div",{className:"bg-purple-500/10 rounded-lg p-3 mb-4",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(lO,{size:14,className:"text-purple-400"}),c.jsx("span",{className:"text-purple-400 text-xs font-medium",children:"Pro Tips"})]}),c.jsx("ul",{className:"space-y-1.5",children:t.tips.map((y,x)=>c.jsxs("li",{className:"text-text-muted text-xs flex items-start gap-2",children:[c.jsx("span",{className:"text-purple-400 mt-0.5",children:""}),c.jsx("span",{children:y})]},x))})]}),c.jsx("div",{className:"flex items-center gap-2 mb-4",children:Array.from({length:a}).map((y,x)=>c.jsx("button",{onClick:()=>u(x),className:`h-1.5 rounded-full transition-all ${x===e?"w-6 bg-purple-500":"w-1.5 bg-border hover:bg-purple-500/50"}`},x))}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("button",{onClick:l,disabled:i,className:"flex items-center gap-1 px-3 py-2 text-xs rounded-lg bg-background-tertiary text-text-secondary hover:text-text-primary disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[c.jsx(Vj,{size:14}),"Back"]}),c.jsx("div",{className:"flex-1"}),c.jsx("button",{onClick:d,className:"px-3 py-2 text-xs text-text-muted hover:text-text-secondary transition-colors",children:"Skip Tour"}),c.jsxs("button",{onClick:o,className:"flex items-center gap-1 px-4 py-2 text-xs rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white font-medium hover:from-purple-500 hover:to-pink-500 transition-all",children:[n?"Get Started":"Next",!n&&c.jsx(ei,{size:14})]})]})]})]},`popover-${e}`)]},"mograph-tour-overlay")})},fK=()=>{const{project:r}=U(),{openModal:e,selectedItems:t,setExportState:s,keyframeEditorOpen:i,toggleKeyframeEditor:n}=ft(),{mode:a,toggleTheme:o}=lu(),[l,d]=w.useState(!1),[u,h]=w.useState(!1),[p,m]=w.useState(!1),[f,g]=w.useState(!1),{importMedia:y}=U(),{track:x}=lm(),v=w.useCallback(()=>{localStorage.removeItem(Gh),oK()},[]),b=w.useCallback(()=>{localStorage.removeItem(Ny),hK()},[]),S=t.some(ae=>ae.type==="clip"||ae.type==="text-clip"||ae.type==="shape-clip"),[k,C]=w.useState({isExporting:!1,progress:0,phase:"",error:null,complete:!1}),[A,T]=w.useState(null),[j,_]=w.useState(new Map);w.useEffect(()=>{s({isExporting:k.isExporting,progress:k.progress,phase:k.phase})},[k.isExporting,k.progress,k.phase,s]),w.useEffect(()=>{l&&!A&&Sy().then(T)},[l,A]),w.useEffect(()=>{if(!A||!r.timeline?.duration)return;const ae=r.timeline.duration,te=new Map,Ve=[{key:"mp4",width:r.settings.width,height:r.settings.height,frameRate:30,codec:"h264"},{key:"4k",width:3840,height:2160,frameRate:30,codec:"h264"},{key:"4k-60-master",width:3840,height:2160,frameRate:60,codec:"h264"},{key:"4k-master",width:3840,height:2160,frameRate:30,codec:"h264"},{key:"1080p-high",width:1920,height:1080,frameRate:30,codec:"h264"},{key:"1080p-60",width:1920,height:1080,frameRate:60,codec:"h264"},{key:"prores",width:r.settings.width,height:r.settings.height,frameRate:30,codec:"h264"}];for(const q of Ve){const oe=zP(A,{width:q.width,height:q.height,frameRate:q.frameRate,duration:ae,codec:q.codec});te.set(q.key,oe)}_(te)},[A,r.timeline?.duration,r.settings.width,r.settings.height]);const M=w.useCallback(()=>{e("search")},[e]),E=w.useCallback(async ae=>{d(!1),C({isExporting:!0,progress:0,phase:"Initializing...",error:null,complete:!1});try{const te=ld();if(await te.initialize(),ae==="wav"){const Ve={format:"wav",sampleRate:48e3,channels:2,bitDepth:24},q=te.exportAudio(r,Ve);let oe;for(;;){const{value:V,done:he}=await q.next();if(he){oe=V;break}C(Se=>({...Se,progress:V.progress*100,phase:V.phase==="complete"?"Complete!":`${V.phase}...`}))}if(oe?.success&&oe.blob)ag(oe.blob,`${r.name||"export"}.wav`),C(V=>({...V,complete:!0,phase:"Downloaded!"})),x(Ic.PROJECT_EXPORTED,{format:"wav",duration:r.timeline?.duration??0});else throw new Error(oe?.error?.message||"Export failed")}else{const q=(()=>{const ie={width:r.settings.width,height:r.settings.height,frameRate:r.settings.frameRate};switch(ae){case"project":return{...ie,format:"mov",codec:"prores",bitrate:22e4,quality:100};case"4k-60-master":return{...ie,width:3840,height:2160,frameRate:60,format:"mov",codec:"h265",bitrate:1e5,quality:95};case"4k-master":return{...ie,width:3840,height:2160,frameRate:30,format:"mov",codec:"h265",bitrate:8e4,quality:95};case"4k-prores":return{...ie,width:3840,height:2160,frameRate:30,format:"mov",codec:"prores",bitrate:88e4,quality:100};case"4k":return{...ie,width:3840,height:2160,frameRate:30,format:"mp4",codec:"h264",bitrate:5e4,quality:90};case"1080p-60":return{...ie,width:1920,height:1080,frameRate:60,format:"mp4",codec:"h264",bitrate:25e3,quality:95};case"1080p-high":return{...ie,width:1920,height:1080,frameRate:30,format:"mp4",codec:"h264",bitrate:2e4,quality:95};case"prores":return{...ie,format:"mov",codec:"prores",bitrate:22e4,quality:100};case"gif":return{...ie,format:"webm",codec:"vp9",bitrate:8e3};case"mp4":default:return{...ie,format:"mp4",codec:"h264",bitrate:12e3,quality:85}}})(),oe=()=>{switch(ae){case"4k-60-master":case"4k-master":case"4k-prores":case"prores":case"project":return"mov";case"gif":return"webm";default:return"mp4"}},V=()=>{switch(oe()){case"mov":return"video/quicktime";case"webm":return"video/webm";default:return"video/mp4"}};let he,Se=!1;if("showSaveFilePicker"in window&&typeof window.showSaveFilePicker=="function")try{const ie=window.showSaveFilePicker;he=await(await ie({suggestedName:`${r.name||"export"}.${oe()}`,types:[{description:"Video file",accept:{[V()]:[`.${oe()}`]}}]})).createWritable(),Se=!0}catch(ie){if(ie.name==="AbortError"){C({isExporting:!1,progress:0,phase:"",error:null,complete:!1});return}Se=!1}const J=te.exportVideoWithFFmpeg(r,q,he);let be;for(;;){const{value:ie,done:Pe}=await J.next();if(Pe){be=ie;break}C($=>({...$,progress:ie.progress*100,phase:ie.phase==="complete"?"Complete!":`${ie.phase}...`}))}if(be?.success)if(x(Ic.PROJECT_EXPORTED,{format:q.format??"mp4",codec:q.codec??"h264",width:q.width??r.settings.width,height:q.height??r.settings.height,frameRate:q.frameRate??r.settings.frameRate,duration:r.timeline?.duration??0,exportType:ae}),Se)C(ie=>({...ie,complete:!0,phase:"Saved!"}));else if(be.blob)ag(be.blob,`${r.name||"export"}.${oe()}`),C(ie=>({...ie,complete:!0,phase:"Downloaded!"}));else throw new Error("Export completed but no output generated");else throw new Error(be?.error?.message||"Export failed")}setTimeout(()=>{C({isExporting:!1,progress:0,phase:"",error:null,complete:!1})},2e3)}catch(te){C(Ve=>({...Ve,isExporting:!1,error:te instanceof Error?te.message:"Export failed"}))}},[r,x]),D=w.useCallback(()=>{ld().cancel(),C({isExporting:!1,progress:0,phase:"",error:null,complete:!1})},[]),R=w.useCallback(async ae=>{h(!1),C({isExporting:!0,progress:0,phase:"Initializing...",error:null,complete:!1});try{const te=ld();await te.initialize();const Ve=ae.width>r.settings.width||ae.height>r.settings.height,q={...ae,upscaling:ae.upscaling?.enabled&&Ve?ae.upscaling:void 0},oe=ae.format==="mov"?"mov":ae.format==="webm"?"webm":"mp4",V=()=>{switch(oe){case"mov":return"video/quicktime";case"webm":return"video/webm";default:return"video/mp4"}};let he,Se=!1;if("showSaveFilePicker"in window&&typeof window.showSaveFilePicker=="function")try{const ie=window.showSaveFilePicker;he=await(await ie({suggestedName:`${r.name||"export"}.${oe}`,types:[{description:"Video file",accept:{[V()]:[`.${oe}`]}}]})).createWritable(),Se=!0}catch(ie){if(ie.name==="AbortError"){C({isExporting:!1,progress:0,phase:"",error:null,complete:!1});return}Se=!1}const J=te.exportVideoWithFFmpeg(r,q,he);let be;for(;;){const{value:ie,done:Pe}=await J.next();if(Pe){be=ie;break}C($=>({...$,progress:ie.progress*100,phase:ie.phase==="complete"?"Complete!":`${ie.phase}...`}))}if(be?.success)if(x(Ic.PROJECT_EXPORTED,{format:ae.format,codec:ae.codec,width:ae.width,height:ae.height,frameRate:ae.frameRate,duration:r.timeline?.duration??0,exportType:"custom",upscaling:ae.upscaling?.enabled??!1}),Se)C(ie=>({...ie,complete:!0,phase:"Saved!"}));else if(be.blob)ag(be.blob,`${r.name||"export"}.${oe}`),C(ie=>({...ie,complete:!0,phase:"Downloaded!"}));else throw new Error("Export completed but no output generated");else throw new Error(be?.error?.message||"Export failed");setTimeout(()=>{C({isExporting:!1,progress:0,phase:"",error:null,complete:!1})},2e3)}catch(te){C(Ve=>({...Ve,isExporting:!1,error:te instanceof Error?te.message:"Export failed"}))}},[r,x]),B=w.useCallback(async(ae,te)=>{if(!ae||ae.size===0){Os.error("Recording failed","No video data was captured. Please try again.");return}const Ve=new Date().toISOString().slice(0,19).replace(/[:-]/g,"");let q=0;const oe=[],V=new File([ae],`Screen_${Ve}.webm`,{type:ae.type||"video/webm"}),he=await y(V);if(he.success?q++:oe.push(he.error?.message||"Failed to import screen recording"),te&&te.size>0){const Se=new File([te],`Webcam_${Ve}.webm`,{type:te.type||"video/webm"}),J=await y(Se);J.success?q++:oe.push(J.error?.message||"Failed to import webcam recording")}q>0?Os.success(`${q} recording${q>1?"s":""} imported!`,te&&te.size>0?"Screen and webcam added to assets. Use the timeline to composite them.":"Screen recording added to assets."):oe.length>0&&Os.error("Import failed",oe.join(". "))},[y]),O=typeof window<"u"&&new URLSearchParams(window.location.search).get("embedded")==="true",[F,I]=w.useState(!1),K=w.useCallback(async()=>{const ae=ft.getState().renderEngine;console.log("[OpenReel] Send to Output clicked, engine:",ae,"tracks:",r.timeline?.tracks?.length,"clips:",r.timeline?.tracks?.flatMap(te=>te.clips).length),I(!0),C({isExporting:!0,progress:0,phase:"Preparing export...",error:null,complete:!1});try{const te={width:r.settings.width,height:r.settings.height,frameRate:r.settings.frameRate,format:"mp4",codec:"h264",bitrate:12e3,quality:85};if(ae==="backend"){console.log("[OpenReel] Using backend FFmpeg engine");const{exportVideoWithBackendFFmpeg:Ve}=await hi(async()=>{const{exportVideoWithBackendFFmpeg:V}=await import("./index5.js");return{exportVideoWithBackendFFmpeg:V}},__vite__mapDeps([0,1,2,3,4,5,6])),q=Ve(r,te);let oe;for(;;){const{value:V,done:he}=await q.next();if(he){oe=V;break}C(Se=>({...Se,progress:V.progress*100,phase:V.phase==="complete"?"Complete!":`Backend ${V.phase}...`}))}if(console.log("[OpenReel] Backend export result:",{success:oe?.success,error:oe?.error}),oe?.success){const V=oe.filename||`openreel_render_${Date.now()}.mp4`;window.parent!==window&&(window.parent.postMessage({type:"openreel-video-output",filename:V},"*"),console.log("[OpenReel] postMessage sent to parent:",V)),Os.success("Sent to Output",`Video saved as ${V}`)}else throw new Error(oe?.error?.message||"Backend export failed")}else{const Ve=ld();console.log("[OpenReel] Using browser FFmpeg.wasm engine"),await Ve.initialize();const q=Ve.exportVideoWithFFmpeg(r,te);let oe;for(;;){const{value:V,done:he}=await q.next();if(he){oe=V;break}C(Se=>({...Se,progress:V.progress*100,phase:V.phase==="complete"?"Complete!":`${V.phase}...`}))}if(console.log("[OpenReel] Export result:",{success:oe?.success,blobSize:oe?.blob?.size,error:oe?.error}),oe?.success&&oe.blob){C(be=>({...be,phase:"Uploading to ComfyUI..."}));const V=new FormData,Se=`openreel_export_${Date.now()}.mp4`;V.append("image",new File([oe.blob],Se,{type:"video/mp4"})),V.append("type","input"),V.append("overwrite","true"),console.log("[OpenReel] Uploading",Se,"size:",oe.blob.size);const J=await fetch("/upload/image",{method:"POST",body:V});if(J.ok){const ie=(await J.json()).name||Se;console.log("[OpenReel] Upload success:",ie),fetch("/was/openreel_video/set_export_marker",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:ie})}).catch(()=>{}),window.parent!==window&&(window.parent.postMessage({type:"openreel-video-output",filename:ie},"*"),console.log("[OpenReel] postMessage sent to parent:",ie)),Os.success("Sent to Output",`Video saved as ${ie}`)}else throw new Error("Upload failed: "+J.statusText)}else throw new Error(oe?.error?.message||"Export failed")}}catch(te){console.error("[OpenReel] Send to Output error:",te);const Ve=te instanceof Error?te.message:"Send to output failed";Os.error("Send to Output Failed",Ve)}finally{I(!1),C({isExporting:!1,progress:0,phase:"",error:null,complete:!1})}},[r]),ee=`${r.settings.width}${r.settings.height}`,P=r.settings.width/r.settings.height,W=P<.9,z=P>=.9&&P<=1.1,ce=[{label:W?"TikTok / Reels / Shorts":z?"Instagram Feed":"YouTube / Social",icon:zs,desc:`${ee} H.264 - Best for your video`,type:"mp4",recommended:!0},{label:"Project Resolution",icon:vn,desc:`${ee} H.264 - High quality`,type:"project"},{label:"",icon:vn,desc:"",type:"mp4",separator:!0},...W?[]:[{label:"4K Standard",icon:co,desc:"38402160 - YouTube 4K",type:"4k"}],{label:"1080p High Quality",icon:co,desc:"19201080 30fps - High bitrate",type:"1080p-high"},{label:"1080p 60fps",icon:co,desc:"19201080 - Smooth playback",type:"1080p-60"},{label:"MP4 Standard",icon:co,desc:`${ee} - Web & social`,type:"mp4"},{label:"Audio Only (WAV)",icon:qr,desc:"Uncompressed audio",type:"wav"}];return c.jsxs("div",{className:"h-16 border-b border-border flex items-center px-6 justify-between bg-background shrink-0 z-30 relative",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 group",children:c.jsxs("svg",{viewBox:"0 0 490 490",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full text-primary group-hover:scale-110 transition-transform duration-300",children:[c.jsx("path",{d:"M245 24.5C123.223 24.5 24.5 123.223 24.5 245s98.723 220.5 220.5 220.5 220.5-98.723 220.5-220.5S366.777 24.5 245 24.5Z",stroke:"currentColor",strokeWidth:"30.625",className:"opacity-100"}),c.jsxs("g",{className:"origin-center group-hover:rotate-90 transition-transform duration-500 ease-out",children:[c.jsx("path",{d:"M245 98v73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M392 245h-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M245 392v-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M98 245h73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 141.059-51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 348.941-51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 348.941 51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 141.059 51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"})]}),c.jsx("path",{d:"M294 245a49 49 0 0 1-49 49 49 49 0 0 1-49-49 49 49 0 0 1 98 0",fill:"currentColor",className:"group-hover:fill-white transition-colors duration-300"})]})}),c.jsxs("div",{className:"hidden lg:flex flex-col leading-tight",children:[c.jsx("span",{className:"text-lg font-medium text-text-primary tracking-wide",children:"Open Reel"}),c.jsxs("span",{className:"absolute top-[40px] left-[98px] text-[9px] font-medium text-text-secondary tracking-widest opacity-60",children:["for ",c.jsx("span",{className:"font-bold",style:{color:"#e4f541"},children:"ComfyUI"})]})]})]}),c.jsx("div",{className:"h-6 w-px bg-border hidden md:block"}),c.jsx(iK,{})]}),c.jsxs("div",{className:"flex-1 max-w-2xl mx-12 relative group",children:[c.jsx("div",{className:`absolute inset-0 bg-primary/20 rounded-xl blur-md transition-opacity duration-300 ${S?"opacity-100 animate-pulse":"opacity-0 group-hover:opacity-100"}`}),c.jsxs("button",{onClick:M,className:`relative w-full bg-background-secondary border rounded-xl h-10 flex items-center px-4 gap-3 transition-all text-left shadow-inner ${S?"border-primary/50 ring-1 ring-primary/30":"border-border group-hover:border-primary/50"}`,children:[c.jsx(Mo,{size:16,className:`transition-colors ${S?"text-primary":"text-text-muted group-hover:text-primary"}`}),c.jsx("span",{className:`flex-1 text-sm transition-colors ${S?"text-text-secondary":"text-text-muted group-hover:text-text-secondary"}`,children:S?"Search effects for selected clip...":"Search tools, effects, or ask AI..."}),c.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded border border-border bg-background-tertiary",children:[c.jsx(Mw,{size:10,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:"K"})]})]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs(Cd,{children:[c.jsx(Sd,{asChild:!0,children:c.jsx("button",{className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:c.jsx(dL,{size:16})})}),c.jsxs(jc,{align:"end",className:"w-56",children:[c.jsxs(wi,{onClick:v,className:"gap-2",children:[c.jsx(ii,{size:14}),c.jsx("span",{children:"Editor Tour"})]}),c.jsxs(wi,{onClick:b,className:"gap-2",children:[c.jsx(Xp,{size:14,className:"text-purple-400"}),c.jsx("span",{children:"Animation & Effects Tour"})]}),c.jsx(Td,{}),c.jsxs(wi,{className:"gap-2 text-text-muted",children:[c.jsx(Mw,{size:14}),c.jsx("span",{children:"Press ? for shortcuts"})]})]})]}),!O&&c.jsxs(Ua,{children:[c.jsx(Ga,{asChild:!0,children:c.jsx("button",{onClick:o,className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:a==="light"?c.jsx(d$,{size:16}):a==="dark"?c.jsx(vO,{size:16}):c.jsx(c$,{size:16})})}),c.jsx(Zn,{children:c.jsxs("p",{children:["Theme: ",a]})})]}),O&&c.jsxs(Ua,{children:[c.jsx(Ga,{asChild:!0,children:c.jsx("button",{onClick:()=>{const ae=new URL(window.location.href);ae.search="",window.open(ae.toString(),"_blank")},className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:c.jsx(v0,{size:16})})}),c.jsx(Zn,{children:c.jsx("p",{children:"Launch in new tab"})})]}),c.jsxs(Ua,{children:[c.jsx(Ga,{asChild:!0,children:c.jsx("button",{onClick:()=>ft.getState().openModal("scriptView"),className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:c.jsx(Uc,{size:16})})}),c.jsx(Zn,{children:c.jsx("p",{children:"Script View - View/Import JSON"})})]}),c.jsxs(Ua,{children:[c.jsx(Ga,{asChild:!0,children:c.jsx("button",{onClick:n,className:`p-2 rounded-lg transition-colors ${i?"bg-primary/20 text-primary":"hover:bg-background-elevated text-text-secondary hover:text-text-primary"}`,children:c.jsx(Hp,{size:16})})}),c.jsx(Zn,{children:c.jsx("p",{children:"Keyframe Editor"})})]}),c.jsxs(Ua,{children:[c.jsx(Ga,{asChild:!0,children:c.jsx("button",{onClick:()=>g(!f),className:`p-2 rounded-lg transition-colors ${f?"bg-primary/20 text-primary":"hover:bg-background-elevated text-text-secondary hover:text-text-primary"}`,children:c.jsx(Eh,{size:16})})}),c.jsx(Zn,{children:c.jsx("p",{children:"History - Undo/Redo"})})]}),c.jsxs(Ua,{children:[c.jsx(Ga,{asChild:!0,children:c.jsxs("button",{onClick:()=>m(!0),className:"flex items-center gap-2 px-3 py-2 bg-error/10 hover:bg-error/20 text-error rounded-lg transition-colors",children:[c.jsx(Wr,{size:14,className:"fill-current"}),c.jsx("span",{className:"text-sm font-medium",children:"Record"})]})}),c.jsx(Zn,{children:c.jsx("p",{children:"Screen Recording"})})]}),O&&c.jsxs(c.Fragment,{children:[c.jsxs(Cd,{children:[c.jsx(Sd,{asChild:!0,children:c.jsxs("button",{className:`p-2 rounded-lg transition-colors text-xs font-medium flex items-center gap-1.5 ${ft.getState().renderEngine==="backend"?"bg-yellow-500/20 text-yellow-400 hover:bg-yellow-500/30":"hover:bg-background-elevated text-text-secondary hover:text-text-primary"}`,children:[c.jsx(zs,{size:14}),c.jsx("span",{className:"hidden xl:inline",children:ft.getState().renderEngine==="backend"?"Backend":"Browser"}),c.jsx(ns,{size:10})]})}),c.jsxs(jc,{align:"end",className:"w-56",children:[c.jsxs(wi,{onClick:()=>ft.getState().setRenderEngine("browser"),className:`gap-2 ${ft.getState().renderEngine==="browser"?"bg-background-tertiary":""}`,children:[c.jsx(vn,{size:14}),c.jsxs("div",{children:[c.jsx("div",{className:"font-medium",children:"Browser (FFmpeg.wasm)"}),c.jsx("div",{className:"text-[10px] text-text-muted",children:"In-browser encoding"})]})]}),c.jsxs(wi,{onClick:()=>ft.getState().setRenderEngine("backend"),className:`gap-2 ${ft.getState().renderEngine==="backend"?"bg-background-tertiary":""}`,children:[c.jsx(zs,{size:14,className:"text-yellow-400"}),c.jsxs("div",{children:[c.jsx("div",{className:"font-medium",children:"Backend (Native FFmpeg)"}),c.jsx("div",{className:"text-[10px] text-text-muted",children:"System FFmpeg  faster"})]})]})]})]}),c.jsxs(Ua,{children:[c.jsx(Ga,{asChild:!0,children:c.jsxs("button",{onClick:K,disabled:F||k.isExporting,className:"h-10 px-4 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-lg flex items-center gap-2 transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)] hover:shadow-[0_0_30px_rgba(59,130,246,0.5)] transform hover:-translate-y-0.5",children:[c.jsx(Kp,{size:14}),c.jsx("span",{className:"text-sm tracking-wider",children:F?"SENDING...":"SEND TO OUTPUT"})]})}),c.jsx(Zn,{children:c.jsx("p",{children:"Export and send video to ComfyUI"})})]})]}),c.jsx("div",{className:"relative",children:k.isExporting?c.jsxs("div",{className:"h-10 px-4 bg-background-secondary border border-border rounded-lg flex items-center gap-3 min-w-[200px]",children:[c.jsx(_i,{size:14,className:"text-primary animate-spin"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-[10px] text-text-secondary",children:k.phase}),c.jsx("div",{className:"h-1 bg-background-tertiary rounded-full mt-1 overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-200",style:{width:`${k.progress}%`}})})]}),c.jsx("button",{onClick:D,className:"p-1 hover:bg-background-tertiary rounded text-text-muted hover:text-error transition-colors",children:c.jsx(ti,{size:12})})]}):k.error?c.jsxs("div",{className:"h-10 px-4 bg-error/10 border border-error/30 rounded-lg flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-error",children:k.error}),c.jsx("button",{onClick:()=>C(ae=>({...ae,error:null})),className:"p-1 hover:bg-error/20 rounded text-error transition-colors",children:c.jsx(ti,{size:12})})]}):k.complete?c.jsxs("div",{className:"h-10 px-4 bg-primary/10 border border-primary/30 rounded-lg flex items-center gap-2",children:[c.jsx(Ri,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-xs text-primary",children:"Downloaded!"})]}):c.jsxs(Cd,{open:l,onOpenChange:d,children:[c.jsx(Sd,{asChild:!0,children:c.jsxs("button",{className:`h-10 px-4 bg-primary hover:bg-primary-hover active:bg-primary-active text-white font-bold rounded-lg flex items-center gap-2 transition-all shadow-[0_0_20px_rgba(34,197,94,0.3)] hover:shadow-[0_0_30px_rgba(34,197,94,0.5)] transform hover:-translate-y-0.5 ${l?"translate-y-0 shadow-none":""}`,children:[c.jsx("span",{className:"text-sm tracking-wider",children:"EXPORT"}),c.jsx(ns,{size:14,className:`transition-transform duration-200 ${l?"rotate-180":""}`})]})}),c.jsxs(jc,{align:"end",className:"w-72 p-0 rounded-xl bg-background-secondary border-border",children:[c.jsxs("div",{className:"p-3 space-y-1 max-h-[400px] overflow-y-auto",children:[ce.map((ae,te)=>ae.separator?c.jsx(Td,{},`sep-${te}`):c.jsxs(wi,{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${ae.recommended?"bg-primary/10 hover:bg-primary/20 border border-primary/30":""}`,onClick:()=>E(ae.type),children:[c.jsx("div",{className:`p-2 rounded-lg transition-colors ${ae.recommended?"bg-primary/20 text-primary":"bg-background-tertiary group-hover:bg-background-elevated text-text-secondary group-hover:text-primary"}`,children:c.jsx(ae.icon,{size:18})}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:`text-sm font-medium transition-colors ${ae.recommended?"text-primary":"text-text-primary"}`,children:[ae.label,ae.recommended&&c.jsx("span",{className:"ml-2 text-[10px] bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Best Match"})]}),c.jsx("div",{className:"text-xs text-text-muted mt-0.5",children:ae.desc}),j.get(ae.type)&&c.jsxs("div",{className:"text-[10px] text-text-secondary mt-1",children:["Est. ",j.get(ae.type)?.formatted]})]})]},ae.type+te)),c.jsx(Td,{}),c.jsxs(wi,{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer",onClick:()=>h(!0),children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg text-primary transition-colors",children:c.jsx(Gc,{size:18})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-sm font-medium text-primary transition-colors",children:"Custom Export..."}),c.jsx("div",{className:"text-xs text-text-muted mt-0.5",children:"Full settings with AI upscaling"})]}),c.jsx(Gc,{size:14,className:"text-text-muted"})]})]}),c.jsxs("div",{className:"bg-background-tertiary px-3 py-2.5 text-xs text-center text-text-muted border-t border-border",children:[r.settings.width,"",r.settings.height," "," ",r.settings.frameRate,"fps"]})]})]})})]}),c.jsx(H7,{isOpen:u,onClose:()=>h(!1),onExport:R,duration:r.timeline?.duration??0,projectWidth:r.settings?.width??1920,projectHeight:r.settings?.height??1080}),c.jsx(eK,{isOpen:p,onClose:()=>m(!1),onRecordingComplete:B}),f&&c.jsx(c.Fragment,{children:c.jsxs("div",{className:"fixed top-16 right-0 bottom-0 w-80 bg-background-secondary border-l border-border z-50 shadow-2xl animate-in slide-in-from-right duration-200",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[c.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Action History"}),c.jsx("button",{onClick:()=>g(!1),className:"p-1.5 rounded hover:bg-background-tertiary text-text-muted hover:text-text-primary transition-colors",children:c.jsx(ti,{size:14})})]}),c.jsx("div",{className:"h-[calc(100%-49px)]",children:c.jsx(tK,{})})]})})]})},Mn=(r,e)=>{const t=document.createElement("canvas");return t.width=r,t.height=e,t},Yn=r=>(e,t)=>{const s=Mn(e,t),i=s.getContext("2d");return i.fillStyle=r,i.fillRect(0,0,e,t),s},qn=(r,e=180)=>(t,s)=>{const i=Mn(t,s),n=i.getContext("2d"),a=(e-90)*(Math.PI/180),o=t/2-Math.cos(a)*t,l=s/2-Math.sin(a)*s,d=t/2+Math.cos(a)*t,u=s/2+Math.sin(a)*s,h=n.createLinearGradient(o,l,d,u);return r.forEach((p,m)=>h.addColorStop(m/(r.length-1),p)),n.fillStyle=h,n.fillRect(0,0,t,s),i},M2=r=>(e,t)=>{const s=Mn(e,t),i=s.getContext("2d"),n=i.createRadialGradient(e/2,t/2,0,e/2,t/2,Math.max(e,t)/2);return r.forEach((a,o)=>n.addColorStop(o/(r.length-1),a)),i.fillStyle=n,i.fillRect(0,0,e,t),s},fh=r=>(e,t)=>{const s=Mn(e,t),i=s.getContext("2d");i.fillStyle=r[0],i.fillRect(0,0,e,t);const n=[{x:.2,y:.3,r:.6,color:r[1]||r[0]},{x:.8,y:.2,r:.5,color:r[2]||r[1]||r[0]},{x:.5,y:.8,r:.55,color:r[3]||r[2]||r[0]},{x:.1,y:.9,r:.4,color:r[4]||r[1]||r[0]}];for(const a of n){const o=i.createRadialGradient(a.x*e,a.y*t,0,a.x*e,a.y*t,a.r*Math.max(e,t));o.addColorStop(0,a.color),o.addColorStop(1,"transparent"),i.fillStyle=o,i.fillRect(0,0,e,t)}return s},gK=(r,e=.1)=>(t,s)=>{const i=Mn(t,s),n=i.getContext("2d");n.fillStyle=r,n.fillRect(0,0,t,s);const a=n.getImageData(0,0,t,s),o=a.data;for(let l=0;l<o.length;l+=4){const d=(Math.random()-.5)*255*e;o[l]=Math.min(255,Math.max(0,o[l]+d)),o[l+1]=Math.min(255,Math.max(0,o[l+1]+d)),o[l+2]=Math.min(255,Math.max(0,o[l+2]+d))}return n.putImageData(a,0,0),i},P2=(r,e,t=40)=>(s,i)=>{const n=Mn(s,i),a=n.getContext("2d");a.fillStyle=r,a.fillRect(0,0,s,i),a.strokeStyle=e,a.lineWidth=1;for(let o=0;o<=s;o+=t)a.beginPath(),a.moveTo(o,0),a.lineTo(o,i),a.stroke();for(let o=0;o<=i;o+=t)a.beginPath(),a.moveTo(0,o),a.lineTo(s,o),a.stroke();return n},N2=(r,e,t=30,s=3)=>(i,n)=>{const a=Mn(i,n),o=a.getContext("2d");o.fillStyle=r,o.fillRect(0,0,i,n),o.fillStyle=e;for(let l=t/2;l<i;l+=t)for(let d=t/2;d<n;d+=t)o.beginPath(),o.arc(l,d,s,0,Math.PI*2),o.fill();return a},R2=r=>(e,t)=>{const s=Mn(e,t),i=s.getContext("2d"),n=i.createLinearGradient(0,0,0,t);r.forEach((o,l)=>n.addColorStop(l/(r.length-1),o)),i.fillStyle=n,i.fillRect(0,0,e,t),i.globalAlpha=.3;const a=["rgba(255,255,255,0.1)","rgba(255,255,255,0.15)","rgba(255,255,255,0.08)"];for(let o=0;o<3;o++){i.fillStyle=a[o],i.beginPath(),i.moveTo(0,t);const l=30+o*20,d=.005-o*.001,u=o*100;for(let h=0;h<=e;h+=5){const p=t*(.5+o*.15)+Math.sin(h*d+u)*l;i.lineTo(h,p)}i.lineTo(e,t),i.closePath(),i.fill()}return i.globalAlpha=1,s},yK=r=>(e,t)=>{const s=Mn(e,t),i=s.getContext("2d"),n=i.createLinearGradient(0,0,0,t);n.addColorStop(0,"#0f0c29"),n.addColorStop(.5,"#302b63"),n.addColorStop(1,"#24243e"),i.fillStyle=n,i.fillRect(0,0,e,t);for(let a=0;a<r.length;a++){i.globalAlpha=.4;const o=i.createRadialGradient(e*(.2+a*.3),t*.3,0,e*(.2+a*.3),t*.3,t*.8);o.addColorStop(0,r[a]),o.addColorStop(1,"transparent"),i.fillStyle=o,i.fillRect(0,0,e,t)}return i.globalAlpha=1,s},xK=[{id:"solid-black",name:"Black",category:"solid",generate:Yn("#000000"),thumbnail:"linear-gradient(#000000, #000000)"},{id:"solid-white",name:"White",category:"solid",generate:Yn("#ffffff"),thumbnail:"linear-gradient(#ffffff, #ffffff)"},{id:"solid-slate",name:"Slate",category:"solid",generate:Yn("#1e293b"),thumbnail:"linear-gradient(#1e293b, #1e293b)"},{id:"solid-zinc",name:"Zinc",category:"solid",generate:Yn("#27272a"),thumbnail:"linear-gradient(#27272a, #27272a)"},{id:"solid-red",name:"Red",category:"solid",generate:Yn("#dc2626"),thumbnail:"linear-gradient(#dc2626, #dc2626)"},{id:"solid-blue",name:"Blue",category:"solid",generate:Yn("#2563eb"),thumbnail:"linear-gradient(#2563eb, #2563eb)"},{id:"solid-green",name:"Green",category:"solid",generate:Yn("#16a34a"),thumbnail:"linear-gradient(#16a34a, #16a34a)"},{id:"solid-purple",name:"Purple",category:"solid",generate:Yn("#9333ea"),thumbnail:"linear-gradient(#9333ea, #9333ea)"},{id:"gradient-sunset",name:"Sunset",category:"gradient",generate:qn(["#f97316","#ec4899","#8b5cf6"],135),thumbnail:"linear-gradient(135deg, #f97316, #ec4899, #8b5cf6)"},{id:"gradient-ocean",name:"Ocean",category:"gradient",generate:qn(["#0ea5e9","#06b6d4","#14b8a6"],180),thumbnail:"linear-gradient(180deg, #0ea5e9, #06b6d4, #14b8a6)"},{id:"gradient-forest",name:"Forest",category:"gradient",generate:qn(["#166534","#15803d","#22c55e"],180),thumbnail:"linear-gradient(180deg, #166534, #15803d, #22c55e)"},{id:"gradient-lavender",name:"Lavender",category:"gradient",generate:qn(["#c084fc","#a78bfa","#818cf8"],135),thumbnail:"linear-gradient(135deg, #c084fc, #a78bfa, #818cf8)"},{id:"gradient-midnight",name:"Midnight",category:"gradient",generate:qn(["#0f172a","#1e3a5f","#1e40af"],180),thumbnail:"linear-gradient(180deg, #0f172a, #1e3a5f, #1e40af)"},{id:"gradient-rose",name:"Rose",category:"gradient",generate:qn(["#fda4af","#fb7185","#e11d48"],180),thumbnail:"linear-gradient(180deg, #fda4af, #fb7185, #e11d48)"},{id:"gradient-gold",name:"Gold",category:"gradient",generate:qn(["#fbbf24","#f59e0b","#d97706"],135),thumbnail:"linear-gradient(135deg, #fbbf24, #f59e0b, #d97706)"},{id:"gradient-noir",name:"Noir",category:"gradient",generate:qn(["#18181b","#27272a","#3f3f46"],180),thumbnail:"linear-gradient(180deg, #18181b, #27272a, #3f3f46)"},{id:"radial-spotlight",name:"Spotlight",category:"gradient",generate:M2(["#374151","#111827"]),thumbnail:"radial-gradient(circle, #374151, #111827)"},{id:"radial-glow",name:"Glow",category:"gradient",generate:M2(["#7c3aed","#4c1d95","#1e1b4b"]),thumbnail:"radial-gradient(circle, #7c3aed, #4c1d95, #1e1b4b)"},{id:"mesh-aurora",name:"Aurora",category:"mesh",generate:fh(["#0f172a","#06b6d4","#8b5cf6","#ec4899","#f97316"]),thumbnail:"linear-gradient(135deg, #06b6d4, #8b5cf6, #ec4899)"},{id:"mesh-nebula",name:"Nebula",category:"mesh",generate:fh(["#0c0a1d","#7c3aed","#db2777","#f97316","#06b6d4"]),thumbnail:"linear-gradient(135deg, #7c3aed, #db2777, #f97316)"},{id:"mesh-candy",name:"Candy",category:"mesh",generate:fh(["#fdf2f8","#f472b6","#a78bfa","#38bdf8","#34d399"]),thumbnail:"linear-gradient(135deg, #f472b6, #a78bfa, #38bdf8)"},{id:"mesh-sunset-beach",name:"Beach",category:"mesh",generate:fh(["#1e3a5f","#f97316","#fbbf24","#ec4899","#06b6d4"]),thumbnail:"linear-gradient(135deg, #f97316, #ec4899, #06b6d4)"},{id:"pattern-grid-dark",name:"Grid Dark",category:"pattern",generate:P2("#0f0f11","rgba(255,255,255,0.1)"),thumbnail:"linear-gradient(#0f0f11, #0f0f11)"},{id:"pattern-grid-light",name:"Grid Light",category:"pattern",generate:P2("#f8fafc","rgba(0,0,0,0.08)"),thumbnail:"linear-gradient(#f8fafc, #f8fafc)"},{id:"pattern-dots-dark",name:"Dots Dark",category:"pattern",generate:N2("#18181b","rgba(255,255,255,0.15)"),thumbnail:"linear-gradient(#18181b, #18181b)"},{id:"pattern-dots-light",name:"Dots Light",category:"pattern",generate:N2("#ffffff","rgba(0,0,0,0.1)"),thumbnail:"linear-gradient(#ffffff, #ffffff)"},{id:"pattern-noise-dark",name:"Film Grain",category:"pattern",generate:gK("#1a1a1a",.15),thumbnail:"linear-gradient(#1a1a1a, #1a1a1a)"},{id:"waves-ocean",name:"Ocean Waves",category:"mesh",generate:R2(["#0c4a6e","#0284c7","#38bdf8"]),thumbnail:"linear-gradient(180deg, #0c4a6e, #0284c7, #38bdf8)"},{id:"waves-sunset",name:"Sunset Waves",category:"mesh",generate:R2(["#7c2d12","#ea580c","#fbbf24"]),thumbnail:"linear-gradient(180deg, #7c2d12, #ea580c, #fbbf24)"},{id:"aurora-borealis",name:"Borealis",category:"mesh",generate:yK(["#22d3ee","#a78bfa","#34d399"]),thumbnail:"linear-gradient(180deg, #0f0c29, #302b63, #24243e)"}];async function bK(r,e=1920,t=1080){const s=r.generate(e,t);return new Promise((i,n)=>{s.toBlob(a=>{a?i(a):n(new Error("Failed to generate background blob"))},"image/png",1)})}const vK=({isOpen:r,videoWidth:e,videoHeight:t,currentWidth:s,currentHeight:i,onConfirm:n,onCancel:a})=>{const o=(e/t).toFixed(2),l=(s/i).toFixed(2);return c.jsx(Ea,{open:r,onOpenChange:d=>!d&&a(),children:c.jsxs(En,{className:"max-w-md",children:[c.jsx(Ma,{children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:c.jsx(ja,{size:20,className:"text-primary"})}),c.jsxs("div",{children:[c.jsx(Pa,{children:"Match Video Dimensions?"}),c.jsx(ku,{className:"mt-1",children:"The video you're adding has different dimensions than your current project settings."})]})]})}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background-tertiary",children:c.jsxs("div",{children:[c.jsx("div",{className:"text-xs text-text-tertiary mb-1",children:"Video Dimensions"}),c.jsxs("div",{className:"text-sm font-medium text-text-primary",children:[e,"  ",t]}),c.jsxs("div",{className:"text-xs text-text-tertiary mt-0.5",children:["Aspect Ratio: ",o]})]})}),c.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background-tertiary/50 border border-border/50",children:c.jsxs("div",{children:[c.jsx("div",{className:"text-xs text-text-tertiary mb-1",children:"Current Project"}),c.jsxs("div",{className:"text-sm font-medium text-text-primary",children:[s,"  ",i]}),c.jsxs("div",{className:"text-xs text-text-tertiary mt-0.5",children:["Aspect Ratio: ",l]})]})})]}),c.jsx("p",{className:"text-xs text-text-tertiary",children:"Updating the project dimensions will provide the best editing experience and prevent cropping during export."})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx(Rt,{variant:"outline",className:"flex-1",onClick:a,children:"Keep Current"}),c.jsx(Rt,{className:"flex-1",onClick:n,children:"Match Video"})]})]})})},wK=r=>{const e=Math.floor(r/60),t=Math.floor(r%60);return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},kK=({item:r,isSelected:e,onSelect:t,onDelete:s,onReplace:i,onDragStart:n,onAddToTimeline:a})=>{const[o,l]=w.useState(!1),u=(()=>{switch(r.type){case"video":return vn;case"audio":return qr;case"image":return No;default:return vn}})(),h=()=>r.metadata?.width&&r.metadata?.height?`${r.metadata.width}${r.metadata.height}`:null,p=m=>m?m<1024?`${m} B`:m<1024*1024?`${(m/1024).toFixed(1)} KB`:`${(m/(1024*1024)).toFixed(1)} MB`:null;return c.jsxs("div",{className:"flex flex-col",children:[c.jsxs("div",{draggable:!0,onDragStart:n,onClick:t,onDoubleClick:m=>{m.stopPropagation(),a()},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),className:`aspect-video bg-background-tertiary rounded-lg border-2 relative group cursor-pointer transition-all overflow-hidden shadow-sm ${r.isPlaceholder?"border-yellow-500 ring-1 ring-yellow-500/50 shadow-[0_0_10px_rgba(234,179,8,0.3)]":e?"border-primary ring-1 ring-primary/50 shadow-[0_0_10px_rgba(34,197,94,0.2)]":"border-border hover:border-text-secondary"}`,children:[r.thumbnailUrl?c.jsx("img",{src:r.thumbnailUrl,alt:r.name,className:"w-full h-full object-cover"}):c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background-tertiary",children:c.jsx(u,{size:24,className:`${r.type==="audio"||r.type==="image"?"text-primary/50":"text-status-info/50"}`})}),r.type==="audio"&&c.jsx("div",{className:"absolute top-1/2 left-0 right-0 h-4 flex items-center gap-px px-2 -translate-y-1/2",children:[...Array(10)].map((m,f)=>c.jsx("div",{className:"flex-1 bg-primary/30 rounded-full",style:{height:`${Math.random()*100}%`}},f))}),r.isPlaceholder&&c.jsxs("div",{className:"absolute top-1 left-1 px-1.5 py-0.5 bg-yellow-500 rounded text-[8px] text-black font-bold flex items-center gap-1",children:[c.jsx(Po,{size:10}),"Missing"]}),r.metadata?.duration&&c.jsx("div",{className:"absolute bottom-1 right-1 px-1.5 py-0.5 bg-black/70 rounded text-[9px] text-white font-mono",children:wK(r.metadata.duration)}),r.isPlaceholder&&!o&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-yellow-500/10",children:c.jsx(Po,{size:32,className:"text-yellow-500/50"})}),o&&c.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[1px] flex items-center justify-center gap-2 animate-in fade-in duration-200",children:r.isPlaceholder?c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:m=>{m.stopPropagation(),i()},title:"Replace asset",className:"p-2 bg-yellow-500/20 rounded-full hover:bg-yellow-500/40 backdrop-blur-sm transition-colors",children:c.jsx(nl,{size:14,className:"text-yellow-500"})}),c.jsx("button",{onClick:m=>{m.stopPropagation(),s()},title:"Delete",className:"p-2 bg-red-500/20 rounded-full hover:bg-red-500/40 backdrop-blur-sm transition-colors",children:c.jsx(bs,{size:14,className:"text-red-400"})})]}):c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:m=>{m.stopPropagation(),a()},title:"Add to timeline",className:"p-2 bg-primary/20 rounded-full hover:bg-primary/40 backdrop-blur-sm transition-colors",children:c.jsx(Ar,{size:14,className:"text-primary"})}),c.jsx("button",{onClick:m=>{m.stopPropagation(),s()},title:"Delete",className:"p-2 bg-red-500/20 rounded-full hover:bg-red-500/40 backdrop-blur-sm transition-colors",children:c.jsx(bs,{size:14,className:"text-red-400"})})]})}),e&&c.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-primary rounded-full shadow-[0_0_8px_#22c55e]"})]}),c.jsxs("div",{className:"mt-1.5 px-0.5",children:[c.jsx("div",{className:`text-[10px] truncate font-medium ${e?"text-primary":"text-text-primary"}`,title:r.name,children:r.name}),c.jsxs("div",{className:"flex items-center gap-1.5 text-[9px] text-text-muted mt-0.5",children:[h()&&c.jsx("span",{children:h()}),h()&&p(r.metadata?.fileSize)&&c.jsx("span",{children:""}),p(r.metadata?.fileSize)&&c.jsx("span",{children:p(r.metadata?.fileSize)})]})]})]})},CK=({onImport:r})=>c.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center",children:[c.jsx("div",{className:"w-16 h-16 rounded-2xl bg-background-tertiary border border-border flex items-center justify-center mb-4 shadow-inner",children:c.jsx(Kp,{size:24,className:"text-text-muted"})}),c.jsx("p",{className:"text-sm text-text-secondary mb-2 font-medium",children:"No media imported"}),c.jsx("p",{className:"text-xs text-text-muted mb-6",children:"Drag files here or click to import"}),c.jsx("button",{onClick:r,className:"px-4 py-2 bg-background-elevated hover:bg-background-tertiary border border-border text-text-primary text-xs font-medium rounded-lg transition-all hover:border-primary/50",children:"Import Media"})]}),SK=({message:r})=>c.jsxs("div",{className:"absolute inset-0 bg-background-secondary/90 backdrop-blur-sm flex flex-col items-center justify-center z-50",children:[c.jsx("div",{className:"w-10 h-10 border-2 border-primary border-t-transparent rounded-full animate-spin mb-3"}),c.jsx("p",{className:"text-sm text-text-secondary",children:r})]}),TK=()=>{const r=w.useRef(null),[e,t]=w.useState(""),[s,i]=w.useState("media"),[n,a]=w.useState(!1),[o,l]=w.useState(!1),[d,u]=w.useState(""),[h,p]=w.useState(!1),[m,f]=w.useState(!1),[g,y]=w.useState(null),[x,v]=w.useState(null),[b,S]=w.useState("all"),{project:k,importMedia:C,deleteMedia:A,replaceMediaAsset:T,updateSettings:j}=U(),_=k.mediaLibrary.items,{select:M,isSelected:E,startDrag:D}=ft(),R=_.filter(V=>V.isPlaceholder).length,B=_.filter(V=>{const he=V.name.toLowerCase().includes(e.toLowerCase()),Se=h?V.isPlaceholder:!0;return he&&Se}),O=w.useCallback(async V=>{if(!V||V.length===0)return;l(!0);const he=Array.from(V);try{for(let Se=0;Se<he.length;Se++){const J=he[Se];u(`Importing ${J.name} (${Se+1}/${he.length})...`),(await C(J)).success&&J.type.startsWith("video/")&&u(`Extracting audio from ${J.name}...`)}}catch(Se){console.error("Import failed:",Se)}finally{l(!1),u("")}},[C]),F=w.useCallback(V=>{V.preventDefault(),a(!1),O(V.dataTransfer.files)},[O]),I=w.useCallback(V=>{V.preventDefault(),a(!0)},[]),K=w.useCallback(()=>{a(!1)},[]),ee=w.useCallback(V=>{M({type:"clip",id:V})},[M]),P=w.useCallback(async V=>{await A(V)},[A]),W=w.useCallback(async V=>{const he=document.createElement("input");he.type="file",he.accept="video/*,audio/*,image/*",he.onchange=async Se=>{const J=Se.target.files?.[0];if(J){l(!0),u("Replacing asset...");try{await T(V,J)}catch(be){console.error("Asset replacement failed:",be)}finally{l(!1),u("")}}},he.click()},[T]),z=w.useCallback((V,he)=>{V.dataTransfer.setData("application/json",JSON.stringify({mediaId:he.id})),V.dataTransfer.effectAllowed="copy",D("media",{mediaId:he.id,mediaType:he.type})},[D]),G=w.useCallback(async V=>{const{addClipToNewTrack:he}=U.getState();await he(V.id)},[]),ce=w.useCallback(async()=>{if(!g)return;await j({width:g.videoWidth,height:g.videoHeight});const V=g.itemToAdd;f(!1),y(null),await G(V)},[g,j,G]),ae=w.useCallback(async()=>{if(!g)return;const V=g.itemToAdd;f(!1),y(null),await G(V)},[g,G]),te=w.useCallback(async V=>{const{project:he}=U.getState();if(!he.timeline.tracks.some(be=>be.clips.length>0)&&V.type==="video"&&V.metadata?.width&&V.metadata?.height){const be=V.metadata.width,ie=V.metadata.height,Pe=he.settings.width,$=he.settings.height;if(be!==Pe||ie!==$){y({videoWidth:be,videoHeight:ie,itemToAdd:V}),f(!0);return}}await G(V)},[G]),Ve=w.useCallback(()=>{r.current?.click()},[]),q=w.useCallback(async V=>{console.log("[AssetsPanel] Starting background import:",V.name),v(V.id);try{const{width:he,height:Se}=k.settings;console.log("[AssetsPanel] Generating blob:",he,"x",Se);const J=await bK(V,he,Se);console.log("[AssetsPanel] Blob generated:",J.size,"bytes");const be=new File([J],`${V.name}_${he}x${Se}.png`,{type:"image/png"});console.log("[AssetsPanel] Calling importMedia...");const ie=await C(be);console.log("[AssetsPanel] Import result:",ie)}catch(he){console.error("[AssetsPanel] Failed to generate background:",he)}finally{console.log("[AssetsPanel] Clearing loading state"),v(null)}},[C,k.settings]),oe=xK.filter(V=>b==="all"||V.category===b);return c.jsxs("div",{"data-tour":"assets",className:"w-80 bg-background-secondary border-r border-border flex flex-col h-full relative",children:[o&&c.jsx(SK,{message:d||"Importing media..."}),c.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[c.jsx("span",{className:"font-bold text-lg text-text-primary tracking-tight",children:"Assets"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx($r,{icon:Ar,onClick:Ve,title:"Import media"}),c.jsx($r,{icon:ja,title:"Maximize panel"}),c.jsx($r,{icon:ti,title:"Close panel"})]})]}),c.jsxs("div",{className:"flex px-5 gap-6 border-b border-border text-xs font-medium text-text-muted mb-5",children:[c.jsxs("button",{onClick:()=>i("media"),className:`pb-3 transition-all relative ${s==="media"?"text-text-primary":"hover:text-text-secondary"}`,children:["Media",s==="media"&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full shadow-[0_-2px_8px_rgba(34,197,94,0.5)]"})]}),c.jsxs("button",{onClick:()=>i("text"),className:`pb-3 transition-all relative ${s==="text"?"text-text-primary":"hover:text-text-secondary"}`,children:["Text",s==="text"&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full shadow-[0_-2px_8px_rgba(34,197,94,0.5)]"})]}),c.jsxs("button",{onClick:()=>i("graphics"),className:`pb-3 transition-all relative ${s==="graphics"?"text-text-primary":"hover:text-text-secondary"}`,children:["Graphics",s==="graphics"&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full shadow-[0_-2px_8px_rgba(34,197,94,0.5)]"})]})]}),s==="media"&&c.jsx("div",{className:"px-5 mb-3",children:c.jsxs("div",{className:"relative",children:[c.jsx(Mo,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted z-10"}),c.jsx(Ns,{type:"text",value:e,onChange:V=>t(V.target.value),placeholder:"Search media",className:"pl-9 text-xs bg-background-tertiary border-border text-text-primary h-9"})]})}),s==="media"&&R>0&&c.jsx("div",{className:"px-5 mb-5 space-y-2",children:c.jsxs("button",{onClick:()=>p(!h),className:`w-full px-3 py-2 rounded-lg border text-xs font-medium transition-all flex items-center justify-between ${h?"bg-yellow-500/10 border-yellow-500 text-yellow-500":"bg-background-tertiary border-border text-text-secondary hover:border-yellow-500/50"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Po,{size:14}),c.jsx("span",{children:"Show Only Missing Assets"})]}),c.jsx("div",{className:"px-2 py-0.5 rounded-full bg-yellow-500 text-black text-[10px] font-bold",children:R})]})}),c.jsx("input",{ref:r,type:"file",multiple:!0,accept:"video/*,audio/*,image/*",onChange:V=>O(V.target.files),className:"hidden"}),s==="media"&&c.jsx(ha,{className:`flex-1 ${n?"bg-primary/5":""}`,onDrop:F,onDragOver:I,onDragLeave:K,children:c.jsxs("div",{className:"px-5 pb-5",children:[B.length===0?c.jsx(CK,{onImport:Ve}):c.jsx("div",{className:"grid grid-cols-2 gap-3",children:B.map(V=>c.jsx(kK,{item:V,isSelected:E(V.id),onSelect:()=>ee(V.id),onDelete:()=>P(V.id),onReplace:()=>W(V.id),onDragStart:he=>z(he,V),onAddToTimeline:()=>te(V)},V.id))}),n&&c.jsx("div",{className:"absolute inset-4 border-2 border-dashed border-primary rounded-xl flex items-center justify-center bg-primary/5 pointer-events-none z-50 backdrop-blur-sm",children:c.jsx("div",{className:"text-primary text-sm font-bold bg-background-secondary px-4 py-2 rounded-full shadow-lg",children:"Drop files to import"})})]})}),s==="graphics"&&c.jsx(ha,{className:"flex-1",children:c.jsxs("div",{className:"px-5 pb-5",children:[c.jsxs("div",{className:"mb-6",children:[c.jsx("div",{className:"flex items-center justify-between mb-3",children:c.jsxs("h4",{className:"text-xs font-medium text-text-secondary flex items-center gap-1.5",children:[c.jsx(Ud,{size:12}),"Backgrounds"]})}),c.jsx("div",{className:"flex gap-1.5 mb-3 flex-wrap",children:["all","solid","gradient","mesh","pattern"].map(V=>c.jsx("button",{onClick:()=>S(V),className:`px-2.5 py-1 text-[10px] rounded-md transition-all ${b===V?"bg-primary text-white":"bg-background-tertiary text-text-muted hover:text-text-secondary"}`,children:V.charAt(0).toUpperCase()+V.slice(1)},V))}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:oe.map(V=>c.jsxs("button",{onClick:()=>q(V),disabled:x!==null,className:"aspect-square rounded-lg border border-border hover:border-primary/50 transition-all overflow-hidden relative group disabled:opacity-50",title:V.name,style:{background:V.thumbnail},children:[x===V.id&&c.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:c.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})}),c.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:c.jsx(Ar,{size:16,className:"text-white"})}),c.jsx("span",{className:"absolute bottom-0 left-0 right-0 text-[8px] text-white bg-black/60 py-0.5 px-1 truncate opacity-0 group-hover:opacity-100 transition-opacity",children:V.name})]},V.id))})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-3",children:"Shapes"}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{type:"rectangle",icon:rs,label:"Rectangle"},{type:"circle",icon:Wr,label:"Circle"},{type:"triangle",icon:e_,label:"Triangle"},{type:"star",icon:xa,label:"Star"},{type:"arrow",icon:da,label:"Arrow"},{type:"polygon",icon:Yj,label:"Polygon"}].map(V=>c.jsxs("button",{onClick:async()=>{const he=U.getState(),{createShapeClip:Se,addTrack:J}=he,be=he.project.timeline.tracks;await J("graphics",0);const Pe=U.getState().project.timeline.tracks.find($=>$.type==="graphics"&&!be.some(we=>we.id===$.id));Pe&&Se(Pe.id,0,V.type)},className:"aspect-square bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all flex flex-col items-center justify-center gap-1 group",title:V.label,children:[c.jsx(V.icon,{size:20,className:"text-text-secondary group-hover:text-primary transition-colors"}),c.jsx("span",{className:"text-[9px] text-text-muted group-hover:text-text-secondary",children:V.label})]},V.type))})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-3",children:"SVG Import"}),c.jsxs("button",{onClick:()=>{const V=document.createElement("input");V.type="file",V.accept=".svg",V.onchange=async he=>{const Se=he.target.files?.[0];if(Se){const J=await Se.text(),be=U.getState(),{importSVG:ie,addTrack:Pe}=be,$=be.project.timeline.tracks;await Pe("graphics",0);const qe=U.getState().project.timeline.tracks.find(fe=>fe.type==="graphics"&&!$.some(ke=>ke.id===fe.id));qe&&ie(J,qe.id,0)}},V.click()},className:"w-full py-3 bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center gap-2 group",children:[c.jsx(Uc,{size:16,className:"text-text-secondary group-hover:text-primary transition-colors"}),c.jsx("span",{className:"text-xs text-text-secondary group-hover:text-text-primary",children:"Import SVG File"})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-3",children:"Stickers & Emojis"}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:["","","","","","","",""].map((V,he)=>c.jsx("button",{onClick:async()=>{const Se=U.getState(),{createStickerClip:J,addTrack:be}=Se,{stickerLibrary:ie}=await hi(async()=>{const{stickerLibrary:qe}=await import("./index5.js");return{stickerLibrary:qe}},__vite__mapDeps([0,1,2,3,4,5,6])),Pe=Se.project.timeline.tracks;await be("graphics",0);const we=U.getState().project.timeline.tracks.find(qe=>qe.type==="graphics"&&!Pe.some(fe=>fe.id===qe.id));if(we){const qe={id:`emoji-${he}`,emoji:V,name:V,category:"emojis"},fe=ie.createEmojiClip(qe,we.id,0,5);J(fe)}},className:"aspect-square bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center text-xl cursor-pointer",children:V},he))})]})]})}),s==="text"&&c.jsx(ha,{className:"flex-1",children:c.jsxs("div",{className:"px-5 pb-5 space-y-3",children:[c.jsxs("button",{onClick:async()=>{const V=U.getState(),{createTextClip:he,addTrack:Se}=V,J=V.project.timeline.tracks;await Se("text",0);const ie=U.getState().project.timeline.tracks.find(Pe=>Pe.type==="text"&&!J.some($=>$.id===Pe.id));ie&&he(ie.id,0,"New Title")},className:"w-full py-4 bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all text-center",children:[c.jsx("span",{className:"text-lg font-bold text-text-primary",children:"Add Title"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Click to add text to timeline"})]}),c.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{name:"Heading",text:"Heading",style:{fontSize:72,fontWeight:700,textAlign:"center",verticalAlign:"middle"}},{name:"Subtitle",text:"Subtitle text",style:{fontSize:36,fontWeight:400,textAlign:"center",verticalAlign:"middle"}},{name:"Lower Third",text:"Name Here",style:{fontSize:32,fontWeight:600,textAlign:"left",verticalAlign:"bottom",backgroundColor:"rgba(0, 0, 0, 0.7)"}},{name:"Caption",text:"Caption text here",style:{fontSize:24,fontWeight:400,textAlign:"center",verticalAlign:"bottom",shadowColor:"rgba(0, 0, 0, 0.8)",shadowBlur:4,shadowOffsetX:1,shadowOffsetY:1}}].map(V=>c.jsx("button",{onClick:async()=>{const he=U.getState(),{createTextClip:Se,addTrack:J}=he,be=he.project.timeline.tracks;await J("text",0);const Pe=U.getState().project.timeline.tracks.find($=>$.type==="text"&&!be.some(we=>we.id===$.id));Pe&&Se(Pe.id,0,V.text,5,V.style)},className:"py-3 bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all text-xs text-text-secondary hover:text-text-primary",children:V.name},V.name))})]})}),g&&c.jsx(vK,{isOpen:m,videoWidth:g.videoWidth,videoHeight:g.videoHeight,currentWidth:k.settings.width,currentHeight:k.settings.height,onConfirm:ce,onCancel:ae})]})},Hn={MIN:10,DEFAULT:50,MAX:500},Wt=Ta()(Op((r,e)=>({playheadPosition:0,playbackState:"stopped",playbackRate:1,pixelsPerSecond:Hn.DEFAULT,scrollX:0,scrollY:0,viewportWidth:800,viewportHeight:400,trackHeight:80,trackHeights:{},loopEnabled:!1,loopStart:0,loopEnd:0,isScrubbing:!1,scrubPosition:null,expandedTracks:new Set,expandedClipKeyframes:new Set,keyframeEditMode:!1,play:()=>{r({playbackState:"playing"})},pause:()=>{r({playbackState:"paused"})},stop:()=>{r({playbackState:"stopped",playheadPosition:0})},togglePlayback:()=>{const{playbackState:t}=e();r(t==="playing"?{playbackState:"paused"}:{playbackState:"playing"})},setPlaybackRate:t=>{r({playbackRate:Math.max(.1,Math.min(4,t))})},setPlayheadPosition:t=>{r({playheadPosition:Math.max(0,t)})},seekTo:t=>{const s=Math.max(0,t);r({playheadPosition:s})},seekRelative:t=>{const{playheadPosition:s}=e(),i=Math.max(0,s+t);r({playheadPosition:i})},seekToStart:()=>{r({playheadPosition:0})},seekToEnd:t=>{r({playheadPosition:t})},startScrubbing:t=>{r({isScrubbing:!0,scrubPosition:t,playheadPosition:t})},updateScrubPosition:t=>{const{isScrubbing:s}=e();if(s){const i=Math.max(0,t);r({scrubPosition:i,playheadPosition:i})}},endScrubbing:()=>{const{scrubPosition:t}=e();r({isScrubbing:!1,scrubPosition:null,playheadPosition:t??e().playheadPosition})},zoomIn:()=>{const{pixelsPerSecond:t}=e(),s=Math.min(t*1.5,Hn.MAX);r({pixelsPerSecond:s})},zoomOut:()=>{const{pixelsPerSecond:t}=e(),s=Math.max(t/1.5,Hn.MIN);r({pixelsPerSecond:s})},setZoom:t=>{const s=Math.max(Hn.MIN,Math.min(Hn.MAX,t));r({pixelsPerSecond:s})},zoomToFit:t=>{const{viewportWidth:s}=e();if(t>0){const i=Math.max(Hn.MIN,Math.min(Hn.MAX,(s-100)/t));r({pixelsPerSecond:i,scrollX:0})}},resetZoom:()=>{r({pixelsPerSecond:Hn.DEFAULT,scrollX:0})},setScrollX:t=>{r({scrollX:Math.max(0,t)})},setScrollY:t=>{r({scrollY:Math.max(0,t)})},scrollToPlayhead:()=>{const{playheadPosition:t,pixelsPerSecond:s,viewportWidth:i,scrollX:n}=e(),a=t*s;if(a<n||a>n+i){const o=Math.max(0,a-i/2);r({scrollX:o})}},setViewportDimensions:(t,s)=>{r({viewportWidth:t,viewportHeight:s})},setTrackHeight:t=>{r({trackHeight:Math.max(40,Math.min(200,t))})},setTrackHeightById:(t,s)=>{const i=Math.max(40,Math.min(200,s));r(n=>({trackHeights:{...n.trackHeights,[t]:i}}))},getTrackHeight:t=>{const{trackHeights:s,trackHeight:i}=e();return s[t]??i},setLoopEnabled:t=>{r({loopEnabled:t})},setLoopRange:(t,s)=>{t<s&&r({loopStart:Math.max(0,t),loopEnd:s})},timeToPixels:t=>{const{pixelsPerSecond:s}=e();return t*s},pixelsToTime:t=>{const{pixelsPerSecond:s}=e();return t/s},getVisibleTimeRange:()=>{const{scrollX:t,viewportWidth:s,pixelsPerSecond:i}=e();return{start:t/i,end:(t+s)/i}},isTimeVisible:t=>{const{start:s,end:i}=e().getVisibleTimeRange();return t>=s&&t<=i},toggleTrackExpanded:t=>{r(s=>{const i=new Set(s.expandedTracks);return i.has(t)?i.delete(t):i.add(t),{expandedTracks:i}})},setTrackExpanded:(t,s)=>{r(i=>{const n=new Set(i.expandedTracks);return s?n.add(t):n.delete(t),{expandedTracks:n}})},isTrackExpanded:t=>e().expandedTracks.has(t),toggleClipKeyframesExpanded:t=>{r(s=>{const i=new Set(s.expandedClipKeyframes);return i.has(t)?i.delete(t):i.add(t),{expandedClipKeyframes:i}})},setClipKeyframesExpanded:(t,s)=>{r(i=>{const n=new Set(i.expandedClipKeyframes);return s?n.add(t):n.delete(t),{expandedClipKeyframes:n}})},isClipKeyframesExpanded:t=>e().expandedClipKeyframes.has(t),setKeyframeEditMode:t=>{r({keyframeEditMode:t})}}))),AK={maxFrames:100,maxSizeBytes:500*1024*1024,preloadAhead:30,preloadBehind:10};class wc{videoEngine=null;videoEffectsEngine=null;transitionEngine=null;canvas=null;ctx=null;initialized=!1;renderStats={lastRenderTime:0,avgRenderTime:0,framesRendered:0,renderErrors:0};renderTimes=[];maxRenderTimeSamples=60;pendingRender=null;lastRenderedTime=-1;DEBOUNCE_THRESHOLD=.001;frameCache=new Map;cacheConfig;cacheStats={hits:0,misses:0};totalCacheSizeBytes=0;isPreloading=!1;preloadAbortController=null;constructor(e={}){this.cacheConfig={...AK,...e}}async initialize(){if(this.initialized)return;const e=me.getState();if(!e.initialized)throw new Error("EngineStore must be initialized before RenderBridge");if(this.videoEngine=e.videoEngine,!this.videoEngine)throw new Error("VideoEngine not available in EngineStore");const t=U.getState().project,{width:s,height:i}=t.settings;this.videoEffectsEngine=U9(s,i),this.transitionEngine=wM(s,i),this.initialized=!0}setCanvas(e){this.canvas=e,e?this.ctx=e.getContext("2d"):this.ctx=null}getCanvas(){return this.canvas}async renderFrame(e){if(!this.initialized||!this.videoEngine)return null;const t=performance.now();try{const s=U.getState().project,i=await this.videoEngine.renderFrame(s,e);this.canvas&&this.ctx&&i&&this.drawFrameToCanvas(i);const n=performance.now()-t;return this.updateRenderStats(n),me.setState({currentFrame:i}),this.lastRenderedTime=e,i}catch(s){return this.renderStats.renderErrors++,console.error("RenderBridge: Frame render error:",s),null}}renderFrameDebounced(e){this.pendingRender!==null&&cancelAnimationFrame(this.pendingRender),!(Math.abs(e-this.lastRenderedTime)<this.DEBOUNCE_THRESHOLD)&&(this.pendingRender=requestAnimationFrame(()=>{this.pendingRender=null,this.renderFrame(e).catch(t=>{console.error("[RenderBridge] Frame render failed:",t)})}))}async renderCurrentFrame(){const e=Wt.getState().playheadPosition;return this.renderFrame(e)}async applyEffects(e,t){if(!this.videoEffectsEngine)return e;const s=this.filterEnabledEffects(t);return s.length===0?e:(await this.videoEffectsEngine.applyEffects(e,s)).image}filterEnabledEffects(e){return e.filter(t=>t.enabled)}getEffectApplicationOrder(e){return this.filterEnabledEffects(e).map(t=>t.id)}async applyClipEffects(e,t){const s=U.getState().project;for(const i of s.timeline.tracks){const n=i.clips.find(a=>a.id===t);if(n&&n.effects&&n.effects.length>0)return this.applyEffects(e,n.effects)}return e}hasEffectsEngine(){return this.videoEffectsEngine!==null}getVideoEffectsEngine(){return this.videoEffectsEngine}findTransitionAtTime(e,t){if(!this.transitionEngine)return null;for(const s of e.transitions){const i=e.clips.find(a=>a.id===s.clipAId),n=e.clips.find(a=>a.id===s.clipBId);if(!(!i||!n)&&this.transitionEngine.isTimeInTransition(s,i,t)){const a=this.transitionEngine.calculateTransitionProgress(s,i,t);return{transition:s,clipA:i,clipB:n,progress:a}}}return null}async renderTransition(e,t,s,i){if(!this.transitionEngine)return null;try{return(await this.transitionEngine.renderTransition(e,t,s,i)).frame}catch(n){return console.error("RenderBridge: Transition render error:",n),null}}isTimeInTransition(e,t){return this.findTransitionAtTime(e,t)!==null}getTransitionEngine(){return this.transitionEngine}hasTransitionEngine(){return this.transitionEngine!==null}getClipLocalTime(e,t){const s=t-e.startTime;return e.inPoint+s}drawFrameToCanvas(e){if(!this.canvas||!this.ctx)return;const{width:t,height:s}=this.canvas;this.ctx.clearRect(0,0,t,s);const i=e.width/e.height,n=t/s;let a,o,l,d;i>n?(a=t,o=t/i,l=0,d=(s-o)/2):(o=s,a=s*i,l=(t-a)/2,d=0),this.ctx.drawImage(e.image,l,d,a,o)}updateRenderStats(e){this.renderStats.lastRenderTime=e,this.renderStats.framesRendered++,this.renderTimes.push(e),this.renderTimes.length>this.maxRenderTimeSamples&&this.renderTimes.shift();const t=this.renderTimes.reduce((s,i)=>s+i,0);this.renderStats.avgRenderTime=t/this.renderTimes.length}getRenderStats(){return{...this.renderStats}}clearCanvas(){this.canvas&&this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}resizeCanvas(){if(!this.canvas)return;const e=U.getState().project,{width:t,height:s}=e.settings;(this.canvas.width!==t||this.canvas.height!==s)&&(this.canvas.width=t,this.canvas.height=s)}isInitialized(){return this.initialized}static getCacheKey(e,t=30){return`frame:${(Math.round(e*t)/t).toFixed(4)}`}getCachedFrame(e){const t=this.frameCache.get(e);return t?(t.lastAccessed=Date.now(),this.cacheStats.hits++,t.frame):(this.cacheStats.misses++,null)}hasFrame(e){return this.frameCache.has(e)}cacheFrame(e,t){const s=t.width*t.height*4;if(this.evictIfNeeded(s),s>this.cacheConfig.maxSizeBytes){console.warn("RenderBridge: Frame too large to cache:",s,"bytes");return}if(this.frameCache.has(e)){const i=this.frameCache.get(e);this.totalCacheSizeBytes-=i.sizeBytes}this.frameCache.set(e,{frame:t,key:e,sizeBytes:s,lastAccessed:Date.now()}),this.totalCacheSizeBytes+=s}removeFrame(e){const t=this.frameCache.get(e);return t?(t.frame.image&&typeof t.frame.image.close=="function"&&t.frame.image.close(),this.totalCacheSizeBytes-=t.sizeBytes,this.frameCache.delete(e)):!1}evictIfNeeded(e){for(;this.frameCache.size>=this.cacheConfig.maxFrames;)this.evictOldest();for(;this.totalCacheSizeBytes+e>this.cacheConfig.maxSizeBytes&&this.frameCache.size>0;)this.evictOldest()}evictOldest(){let e="",t=1/0;for(const[s,i]of this.frameCache.entries())i.lastAccessed<t&&(t=i.lastAccessed,e=s);e&&this.removeFrame(e)}async preloadFrames(e,t,s=30){if(!this.initialized||!this.videoEngine)return;this.preloadAbortController&&this.preloadAbortController.abort(),this.preloadAbortController=new AbortController;const i=this.preloadAbortController.signal;this.isPreloading=!0;try{const n=1/s,a=Math.max(0,e-this.cacheConfig.preloadBehind*n),o=Math.min(t,e+this.cacheConfig.preloadAhead*n),l=U.getState().project,d=[];for(let u=e;u<=o;u+=n){const h=wc.getCacheKey(u,s);this.frameCache.has(h)||d.push(u)}for(let u=e-n;u>=a;u-=n){const h=wc.getCacheKey(u,s);this.frameCache.has(h)||d.push(u)}for(const u of d){if(i.aborted)break;try{const h=await this.videoEngine.renderFrame(l,u);if(h&&!i.aborted){const p=wc.getCacheKey(u,s);this.cacheFrame(p,h)}}catch(h){console.warn("RenderBridge: Preload frame error:",h)}}}finally{this.isPreloading=!1}}getPreloadRange(e,t,s=30){const i=1/s,n=Math.max(0,e-this.cacheConfig.preloadBehind*i),a=Math.min(t,e+this.cacheConfig.preloadAhead*i),o=[];for(let l=n;l<=a;l+=i){const d=wc.getCacheKey(l,s);this.frameCache.has(d)||o.push(l)}return{startTime:n,endTime:a,missingFrames:o}}cancelPreload(){this.preloadAbortController&&(this.preloadAbortController.abort(),this.preloadAbortController=null),this.isPreloading=!1}isPreloadingFrames(){return this.isPreloading}clearCache(){for(const e of this.frameCache.values())e.frame.image&&typeof e.frame.image.close=="function"&&e.frame.image.close();this.frameCache.clear(),this.totalCacheSizeBytes=0,this.cacheStats={hits:0,misses:0}}getCacheStats(){const e=this.cacheStats.hits+this.cacheStats.misses;return{entries:this.frameCache.size,sizeBytes:this.totalCacheSizeBytes,hitRate:e>0?this.cacheStats.hits/e:0,maxSizeBytes:this.cacheConfig.maxSizeBytes,hits:this.cacheStats.hits,misses:this.cacheStats.misses}}getCacheConfig(){return{...this.cacheConfig}}updateCacheConfig(e){this.cacheConfig={...this.cacheConfig,...e},this.evictIfNeeded(0)}async applyColorAdjustments(e,t){if(!this.videoEffectsEngine)return e;const s=[];return t.brightness!==void 0&&t.brightness!==0&&s.push({id:"color-brightness",type:"brightness",params:{value:t.brightness},enabled:!0}),t.contrast!==void 0&&t.contrast!==1&&s.push({id:"color-contrast",type:"contrast",params:{value:t.contrast},enabled:!0}),t.saturation!==void 0&&t.saturation!==1&&s.push({id:"color-saturation",type:"saturation",params:{value:t.saturation},enabled:!0}),t.temperature!==void 0&&t.temperature!==0&&s.push({id:"color-temperature",type:"temperature",params:{value:t.temperature},enabled:!0}),t.tint!==void 0&&t.tint!==0&&s.push({id:"color-tint",type:"tint",params:{value:t.tint},enabled:!0}),(t.shadows!==void 0&&t.shadows!==0||t.midtones!==void 0&&t.midtones!==0||t.highlights!==void 0&&t.highlights!==0)&&s.push({id:"color-tonal",type:"tonal",params:{shadows:t.shadows??0,midtones:t.midtones??0,highlights:t.highlights??0},enabled:!0}),s.length===0?e:(await this.videoEffectsEngine.applyEffects(e,s)).image}hasColorAdjustments(e){return e.brightness!==void 0&&e.brightness!==0||e.contrast!==void 0&&e.contrast!==1||e.saturation!==void 0&&e.saturation!==1||e.temperature!==void 0&&e.temperature!==0||e.tint!==void 0&&e.tint!==0||e.shadows!==void 0&&e.shadows!==0||e.midtones!==void 0&&e.midtones!==0||e.highlights!==void 0&&e.highlights!==0}getDefaultColorAdjustments(){return{brightness:0,contrast:1,saturation:1,temperature:0,tint:0,shadows:0,midtones:0,highlights:0}}dispose(){this.pendingRender!==null&&(cancelAnimationFrame(this.pendingRender),this.pendingRender=null),this.cancelPreload(),this.clearCache(),this.clearCanvas(),this.transitionEngine&&(this.transitionEngine.dispose(),this.transitionEngine=null),this.canvas=null,this.ctx=null,this.videoEngine=null,this.videoEffectsEngine=null,this.initialized=!1,this.lastRenderedTime=-1,this.renderTimes=[],this.renderStats={lastRenderTime:0,avgRenderTime:0,framesRendered:0,renderErrors:0}}}let Dc=null;function Dy(){return Dc||(Dc=new wc),Dc}async function jK(){const r=Dy();return await r.initialize(),r}function _K(){Dc&&(Dc.dispose(),Dc=null)}const Bi={position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,anchor:{x:.5,y:.5},borderRadius:0},lg=r=>{const e=Math.floor(r/60),t=Math.floor(r%60),s=Math.floor(r%1*100);return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`};class EK{transitionEngine=null;initialized=!1;trackTransitions=new Map;initialize(e=1920,t=1080){if(!this.initialized)try{this.transitionEngine=wM(e,t),this.initialized=!0}catch(s){const i=s instanceof Error?s.message:"Unknown initialization error";throw new Error(`TransitionBridge initialization failed: ${i}`)}}isInitialized(){return this.initialized}getEngine(){return this.transitionEngine}createTransition(e,t,s,i,n){if(!this.initialized||!this.transitionEngine)return{success:!1,error:"TransitionBridge not initialized"};const a=this.transitionEngine.validateTransition(e,t,i);if(!a.valid&&!a.warning)return{success:!1,error:a.error};const o=this.transitionEngine.createTransition(e,t,s,i,n);if(!o)return{success:!1,error:"Failed to create transition"};const l=e.trackId,u=(this.trackTransitions.get(l)||[]).filter(h=>!(h.clipAId===e.id&&h.clipBId===t.id));return u.push(o),this.trackTransitions.set(l,u),{success:!0,transitionId:o.id,warning:a.warning,maxDuration:a.maxDuration}}updateTransition(e,t){if(!this.initialized||!this.transitionEngine)return{success:!1,error:"TransitionBridge not initialized"};let s=null,i=null;for(const[l,d]of this.trackTransitions.entries()){const u=d.find(h=>h.id===e);if(u){s=u,i=l;break}}if(!s||!i)return{success:!1,error:"Transition not found"};const n={...s,type:t.type??s.type,duration:t.duration??s.duration,params:t.params?{...s.params,...t.params}:s.params},a=this.trackTransitions.get(i)||[],o=a.findIndex(l=>l.id===e);return o!==-1&&(a[o]=n,this.trackTransitions.set(i,a)),{success:!0,transitionId:e}}removeTransition(e){if(!this.initialized)return{success:!1,error:"TransitionBridge not initialized"};for(const[t,s]of this.trackTransitions.entries()){const i=s.findIndex(n=>n.id===e);if(i!==-1)return s.splice(i,1),this.trackTransitions.set(t,s),{success:!0,transitionId:e}}return{success:!1,error:"Transition not found"}}getTransition(e){for(const t of this.trackTransitions.values()){const s=t.find(i=>i.id===e);if(s)return s}}getTransitionsForTrack(e){return this.trackTransitions.get(e)||[]}getTransitionBetweenClips(e,t){for(const s of this.trackTransitions.values()){const i=s.find(n=>n.clipAId===e&&n.clipBId===t);if(i)return i}}validateTransition(e,t,s){return!this.initialized||!this.transitionEngine?{valid:!1,error:"TransitionBridge not initialized"}:this.transitionEngine.validateTransition(e,t,s)}areClipsAdjacent(e,t){return!this.initialized||!this.transitionEngine?!1:this.transitionEngine.areClipsAdjacent(e,t)}findAdjacentClipPairs(e){return!this.initialized||!this.transitionEngine?[]:this.transitionEngine.findAdjacentClipPairs(e)}getAvailableTransitionTypes(){return[{type:"crossfade",name:"Crossfade",description:"Smooth blend between clips",hasDirection:!1,hasCustomParams:!1},{type:"dipToBlack",name:"Dip to Black",description:"Fade through black",hasDirection:!1,hasCustomParams:!0},{type:"dipToWhite",name:"Dip to White",description:"Fade through white",hasDirection:!1,hasCustomParams:!0},{type:"wipe",name:"Wipe",description:"Wipe from one clip to another",hasDirection:!0,hasCustomParams:!0},{type:"slide",name:"Slide",description:"Slide incoming clip over outgoing",hasDirection:!0,hasCustomParams:!0},{type:"zoom",name:"Zoom",description:"Zoom transition between clips",hasDirection:!1,hasCustomParams:!0},{type:"push",name:"Push",description:"Push outgoing clip with incoming",hasDirection:!0,hasCustomParams:!1}]}getDefaultParams(e){return!this.initialized||!this.transitionEngine?{}:this.transitionEngine.getDefaultParams(e)}calculateProgress(e,t,s){return!this.initialized||!this.transitionEngine?0:this.transitionEngine.calculateTransitionProgress(e,t,s)}isTimeInTransition(e,t,s){return!this.initialized||!this.transitionEngine?!1:this.transitionEngine.isTimeInTransition(e,t,s)}async renderTransition(e,t,s,i){if(!this.initialized||!this.transitionEngine)return null;try{const n=await this.transitionEngine.renderTransition(e,t,s,i);return{frame:n.frame,processingTime:n.processingTime}}catch(n){return console.error("[TransitionBridge] Render error:",n),null}}clearTransitionsForTrack(e){this.trackTransitions.delete(e)}clearAllTransitions(){this.trackTransitions.clear()}resize(e,t){this.transitionEngine&&this.transitionEngine.resize(e,t)}dispose(){this.transitionEngine&&this.transitionEngine.dispose(),this.trackTransitions.clear(),this.transitionEngine=null,this.initialized=!1}}let Fc=null;function Xb(){return Fc||(Fc=new EK),Fc}function MK(r=1920,e=1080){const t=Xb();return t.initialize(r,e),t}function PK(){Fc&&(Fc.dispose(),Fc=null)}const NK={normal:wr,multiply:Sg,screen:kc,overlay:wr,darken:wr,lighten:kc,"color-dodge":kc,"color-burn":Sg,"hard-light":wr,"soft-light":wr,difference:mv,exclusion:mv,hue:wr,saturation:wr,color:wr,luminosity:wr};class Kb{scene;camera;renderer;_canvas;constructor(e,t){this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this.renderer=new KS({canvas:this._canvas,alpha:!0,antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(e,t),this.renderer.setClearColor(0,0),this.scene=new QS;const s=e/t,i=t;this.camera=new JS(-i*s/2,i*s/2,i/2,-i/2,.1,2e3),this.camera.position.z=1e3}resize(e,t){this._canvas.width=e,this._canvas.height=t,this.renderer.setSize(e,t);const s=e/t,i=t;this.camera.left=-i*s/2,this.camera.right=i*s/2,this.camera.top=i/2,this.camera.bottom=-i/2,this.camera.updateProjectionMatrix()}createTextTexture(e,t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const n=i.getContext("2d");n.clearRect(0,0,t,s);const a=e.style,o=typeof a.fontWeight=="number"?a.fontWeight:a.fontWeight==="bold"?700:400;n.font=`${a.fontStyle} ${o} ${a.fontSize}px "${a.fontFamily}"`,n.fillStyle=a.color,n.textAlign=a.textAlign,n.textBaseline="middle",a.shadowColor&&a.shadowBlur&&(n.shadowColor=a.shadowColor,n.shadowBlur=a.shadowBlur,n.shadowOffsetX=a.shadowOffsetX||0,n.shadowOffsetY=a.shadowOffsetY||0),a.strokeColor&&a.strokeWidth&&(n.strokeStyle=a.strokeColor,n.lineWidth=a.strokeWidth);const l=e.text.split(`
`),d=a.fontSize*a.lineHeight;l.forEach((h,p)=>{const m=s/2+(p-(l.length-1)/2)*d;a.strokeColor&&a.strokeWidth&&n.strokeText(h,t/2,m),n.fillText(h,t/2,m)});const u=new Eu(i);return u.needsUpdate=!0,u}applyTransform(e,t,s,i){const n=(t.position.x-.5)*s,a=-(t.position.y-.5)*i;e.position.set(n,a,0),e.scale.set(t.scale.x,t.scale.y,1),e.rotation.z=t.rotation*Math.PI/180,t.rotate3d&&(e.rotation.x=t.rotate3d.x*Math.PI/180,e.rotation.y=t.rotate3d.y*Math.PI/180,e.rotation.z+=t.rotate3d.z*Math.PI/180),t.perspective&&(this.camera.position.z=t.perspective,this.camera.updateProjectionMatrix())}applyBlendMode(e,t,s){e.blending=NK[t]||wr,e.opacity=(s??100)/100,e.transparent=!0}renderTextClip(e,t,s){const i=this.createTextTexture(e,t,s),n=new bl({map:i,transparent:!0,opacity:e.transform.opacity,side:vl});this.applyBlendMode(n,e.blendMode||"normal",e.blendOpacity??100);const a=new wl(t,s),o=new Uo(a,n);return this.applyTransform(o,e.transform,t,s),o}createCanvasTexture(e,t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const n=i.getContext("2d");e(n);const a=new Eu(i);return a.needsUpdate=!0,a}renderShapeClip(e,t,s){const{shapeType:i,style:n,transform:a}=e,o=this.createCanvasTexture(h=>{const p=a.position.x*t,m=a.position.y*s;h.translate(p,m),h.scale(a.scale.x,a.scale.y),n.shadow?.blur&&n.shadow.blur>0&&(h.shadowColor=n.shadow.color||"#000000",h.shadowBlur=n.shadow.blur,h.shadowOffsetX=n.shadow.offsetX||0,h.shadowOffsetY=n.shadow.offsetY||0);const f=Math.min(t,s),g=f*.15,y=g/2,x=f/1080;switch(h.fillStyle=n.fill?.color||"#3b82f6",h.strokeStyle=n.stroke?.color||"#1d4ed8",h.lineWidth=(n.stroke?.width||2)*x,n.stroke?.dashArray&&n.stroke.dashArray.length>0&&h.setLineDash(n.stroke.dashArray),h.beginPath(),i){case"rectangle":{const v=n.cornerRadius||0;v>0?h.roundRect(-y,-y,g,g,Math.min(v,y)):h.rect(-y,-y,g,g);break}case"circle":case"ellipse":{h.ellipse(0,0,y,y,0,0,Math.PI*2);break}case"triangle":{h.moveTo(0,-y),h.lineTo(y,y),h.lineTo(-y,y),h.closePath();break}case"star":{const v=y,b=y*.4,S=5;for(let k=0;k<S*2;k++){const C=k%2===0?v:b,A=k*Math.PI/S-Math.PI/2,T=Math.cos(A)*C,j=Math.sin(A)*C;k===0?h.moveTo(T,j):h.lineTo(T,j)}h.closePath();break}case"polygon":{for(let b=0;b<6;b++){const S=b*2*Math.PI/6-Math.PI/2,k=Math.cos(S)*y,C=Math.sin(S)*y;b===0?h.moveTo(k,C):h.lineTo(k,C)}h.closePath();break}case"line":{h.moveTo(-y,0),h.lineTo(y,0);break}}n.fill?.color&&i!=="line"&&h.fill(),n.stroke?.width&&n.stroke.width>0&&h.stroke()},t,s),l=new bl({map:o,transparent:!0,opacity:a.opacity,side:vl});this.applyBlendMode(l,e.blendMode||"normal",e.blendOpacity??100);const d=new wl(t,s),u=new Uo(d,l);return this.applyTransform(u,a,t,s),u}renderSVGClip(e,t,s){const{svgContent:i,transform:n,viewBox:a}=e,o=this.createCanvasTexture(h=>{const p=new Image,m=new Blob([i],{type:"image/svg+xml"});if(p.src=URL.createObjectURL(m),p.complete&&p.naturalWidth>0){const f=n.position.x*t,g=n.position.y*s;h.translate(f,g),h.scale(n.scale.x,n.scale.y);const y=a?.width||200,x=a?.height||200;h.drawImage(p,-y/2,-x/2,y,x)}URL.revokeObjectURL(p.src)},t,s),l=new bl({map:o,transparent:!0,opacity:n.opacity,side:vl});this.applyBlendMode(l,e.blendMode||"normal",e.blendOpacity??100);const d=new wl(t,s),u=new Uo(d,l);return this.applyTransform(u,n,t,s),u}renderStickerClip(e,t,s){const{imageUrl:i,transform:n}=e,a=this.createCanvasTexture(u=>{const h=new Image;if(h.src=i,h.complete&&h.naturalWidth>0){const p=n.position.x*t,m=n.position.y*s;u.translate(p,m),u.scale(n.scale.x,n.scale.y),u.drawImage(h,-h.naturalWidth/2,-h.naturalHeight/2,h.naturalWidth,h.naturalHeight)}},t,s),o=new bl({map:a,transparent:!0,opacity:n.opacity,side:vl});this.applyBlendMode(o,e.blendMode||"normal",e.blendOpacity??100);const l=new wl(t,s),d=new Uo(l,o);return this.applyTransform(d,n,t,s),d}renderImageFrame(e,t,s,i,n,a){let o;if(e instanceof HTMLVideoElement)o=new wR(e);else if(e instanceof ImageBitmap){const h=document.createElement("canvas");h.width=e.width,h.height=e.height,h.getContext("2d").drawImage(e,0,0),o=new Eu(h)}else o=new Eu(e);o.needsUpdate=!0;const l=new bl({map:o,transparent:!0,opacity:t.opacity??1,side:vl});n&&this.applyBlendMode(l,n,a??100);const d=new wl(s,i),u=new Uo(d,l);return this.applyTransform(u,t,s,i),u}render(){return this.renderer.render(this.scene,this.camera),this._canvas}clear(){for(;this.scene.children.length>0;){const e=this.scene.children[0];this.scene.remove(e),e instanceof Uo&&(e.geometry.dispose(),e.material instanceof kR&&e.material.dispose())}this.renderer.clear()}dispose(){this.clear(),this.renderer.dispose()}getScene(){return this.scene}get canvas(){return this._canvas}}let I2=0,wt=null;const Ko=new Cu,D2={opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0},Pd=(r,e)=>{const{type:t,speed:s,intensity:i,loop:n,startTime:a,animationDuration:o}=r,l=a??0;if(e<l)return D2;if(o!==void 0&&o>0){const p=l+o;if(e>p)return D2}const d=e-l,u=n?d*s%1:Math.min(d*s,1),h=u*Math.PI*2;switch(t){case"pulse":return{opacity:1,scale:1+Math.sin(h)*.1*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":{const p=Math.sin(h*5)*.02*i,m=Math.cos(h*5)*.02*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:p,offsetY:m,rotation:0}}case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(h))*-.05*i,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(h)*.03*i,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:u*360*i};case"flash":return{opacity:.5+Math.abs(Math.sin(h))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":{const p=u*4;let m=1;return p<1?m=1+.15*i*Math.sin(p*Math.PI):p<2&&(m=1+.1*i*Math.sin((p-1)*Math.PI)),{opacity:1,scale:m,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(h)*15*i};case"wobble":{const p=Math.sin(h*3)*5*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(h)*.02*i,offsetY:0,rotation:p}}case"jello":{const p=1+Math.sin(h*2)*.1*i,m=1-Math.sin(h*2)*.1*i;return{opacity:1,scale:1,scaleX:p,scaleY:m,offsetX:0,offsetY:0,rotation:0}}case"rubber-band":{const p=1+Math.sin(h)*.2*i,m=1-Math.sin(h)*.1*i;return{opacity:1,scale:1,scaleX:p,scaleY:m,offsetX:0,offsetY:0,rotation:0}}case"tada":{const p=Math.sin(h*4)*10*i;return{opacity:1,scale:1+Math.sin(h*2)*.1*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:p}}case"vibrate":{const p=(Math.random()-.5)*.02*i,m=(Math.random()-.5)*.02*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:p,offsetY:m,rotation:0}}case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":{const p=1+Math.sin(h)*.05*i;return{opacity:.8+Math.sin(h)*.2,scale:p,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"breathe":return{opacity:1,scale:1+Math.sin(h*.5)*.08*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":{const p=Math.sin(h+e*2)*.03*i,m=Math.sin(h)*5*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:p,rotation:m}}case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(h*.5)*10*i};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(h)*.15*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const p=r.focusPoint||{x:.5,y:.5},m=r.zoomScale||1.5,f=r.holdDuration||.3,g=.3,y=1-f-g;let x=1,v=0,b=0;if(u<g){const S=u/g,k=1-Math.pow(1-S,3);x=1+(m-1)*k*i,v=(.5-p.x)*(x-1),b=(.5-p.y)*(x-1)}else if(u<g+f)x=m*i,v=(.5-p.x)*(x-1),b=(.5-p.y)*(x-1);else{const S=(u-g-f)/y,k=Math.pow(S,3);x=m-(m-1)*k*i,v=(.5-p.x)*(x-1),b=(.5-p.y)*(x-1)}return{opacity:1,scale:x,scaleX:1,scaleY:1,offsetX:v,offsetY:b,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-u*.2*i,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:u*.2*i,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-u*.2*i,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:u*.2*i,rotation:0};case"ken-burns":{const p=1+u*.3*i,m=u*.1*i,f=u*.05*i;return{opacity:1,scale:p,scaleX:1,scaleY:1,offsetX:m,offsetY:f,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}},ea=(r,e,t)=>{if(!e||e.length===0)return r;const s={...r},i=e.filter(u=>u.property==="position.x"),n=e.filter(u=>u.property==="position.y"),a=e.filter(u=>u.property==="scale.x"),o=e.filter(u=>u.property==="scale.y"),l=e.filter(u=>u.property==="rotation"),d=e.filter(u=>u.property==="opacity");if(i.length>0){const{value:u}=Ko.getValueAtTime(i,t);typeof u=="number"&&(s.position={...s.position,x:u})}if(n.length>0){const{value:u}=Ko.getValueAtTime(n,t);typeof u=="number"&&(s.position={...s.position,y:u})}if(a.length>0){const{value:u}=Ko.getValueAtTime(a,t);typeof u=="number"&&(s.scale={...s.scale,x:u})}if(o.length>0){const{value:u}=Ko.getValueAtTime(o,t);typeof u=="number"&&(s.scale={...s.scale,y:u})}if(l.length>0){const{value:u}=Ko.getValueAtTime(l,t);typeof u=="number"&&(s.rotation=u)}if(d.length>0){const{value:u}=Ko.getValueAtTime(d,t);typeof u=="number"&&(s.opacity=u)}return s},gh=new Map,RK=async(r,e)=>{const t=`${e}px "${r}"`;if(!gh.has(t)){const s=document.fonts.load(t).then(()=>{});gh.set(t,s),setTimeout(()=>gh.delete(t),3e4)}try{await Promise.race([gh.get(t),new Promise(s=>setTimeout(s,100))])}catch{}},zl=(r,e,t,s,i)=>{const n=i-e.startTime,a=Sp.getAnimatedState(e,n);let{opacity:o,transform:l,style:d,visibleText:u,characterStates:h}=a;if(o<=0||u.length===0)return;if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"){const k=Pd(e.emphasisAnimation,n);o=o*k.opacity,l={...l,scale:{x:l.scale.x*k.scale*k.scaleX,y:l.scale.y*k.scale*k.scaleY},position:{x:l.position.x+k.offsetX,y:l.position.y+k.offsetY},rotation:l.rotation+k.rotation}}const p=l.rotate3d&&(l.rotate3d.x!==0||l.rotate3d.y!==0),m=e.blendMode&&e.blendMode!=="normal";if(p||m){wt||(wt=new Kb(t,s)),(wt.canvas.width!==t||wt.canvas.height!==s)&&wt.resize(t,s),wt.clear();const k={...e,text:u,style:d,transform:{...l,opacity:o}},C=wt.renderTextClip(k,t,s);if(C){wt.getScene().add(C);const A=wt.render();r.drawImage(A,0,0)}return}RK(d.fontFamily,d.fontSize),r.save();const f=l.position.x*t,g=l.position.y*s;r.translate(f,g),r.rotate(l.rotation*Math.PI/180),r.scale(l.scale.x,l.scale.y),r.globalAlpha=o;const y=typeof d.fontWeight=="number"?d.fontWeight:d.fontWeight==="bold"?700:400;r.font=`${d.fontStyle} ${y} ${d.fontSize}px "${d.fontFamily}"`,r.textAlign=d.textAlign,r.textBaseline="middle",d.shadowColor&&d.shadowBlur&&(r.shadowColor=d.shadowColor,r.shadowBlur=d.shadowBlur,r.shadowOffsetX=d.shadowOffsetX||0,r.shadowOffsetY=d.shadowOffsetY||0);const x=u.split(`
`),v=d.fontSize*d.lineHeight,b=x.length*v;let S=-b/2+v/2;if(d.verticalAlign==="top"?S=0:d.verticalAlign==="bottom"&&(S=-b),h&&h.length>0){let k=0;for(let C=0;C<x.length;C++){const A=x[C],T=S+C*v;let j=0;const _=r.measureText(A).width,M=d.textAlign==="center"?-_/2:d.textAlign==="right"?-_:0;for(const E of A){if(k<h.length){const D=h[k],R=r.measureText(E).width;r.save(),r.globalAlpha=o*D.opacity,r.translate(M+j+D.offsetX+R/2,T+D.offsetY),r.rotate(D.rotation*Math.PI/180),r.scale(D.scale,D.scale),d.strokeColor&&d.strokeWidth&&(r.strokeStyle=d.strokeColor,r.lineWidth=d.strokeWidth,r.strokeText(E,0,0)),r.fillStyle=d.color,r.fillText(E,0,0),r.restore(),j+=R}k++}k++}}else for(let k=0;k<x.length;k++){const C=x[k],A=S+k*v;if(d.backgroundColor){const j=r.measureText(C).width+20,_=v;r.fillStyle=d.backgroundColor,r.fillRect(-j/2,A-_/2,j,_)}d.strokeColor&&d.strokeWidth&&(r.strokeStyle=d.strokeColor,r.lineWidth=d.strokeWidth,r.strokeText(C,0,A)),r.fillStyle=d.color,r.fillText(C,0,A)}r.restore()},Xa=(r,e)=>r.filter(t=>{const s=t.startTime+t.duration;return e>=t.startTime&&e<s}),Ka=(r,e)=>r.filter(t=>{const s=t.startTime+t.duration;return e>=t.startTime&&e<s}),Qo=new Map,F2=new Map,IK=(r,e,t,s,i)=>{const{imageUrl:n,transform:a,keyframes:o}=e,l=i-e.startTime,d=o&&o.length>0?ea(a,o,l):a;r.save();const u=d.position.x*t,h=d.position.y*s;r.translate(u,h),r.rotate(d.rotation*Math.PI/180),r.globalAlpha=d.opacity;let p=F2.get(n);if(p||(p=new Image,p.src=n,F2.set(n,p)),p.complete&&p.naturalHeight!==0){const m=p.naturalWidth,f=p.naturalHeight,g=d.scale.x,y=d.scale.y,x=d.anchor?.x??.5,v=d.anchor?.y??.5;if(d.crop){const b=d.crop.x*m,S=d.crop.y*f,k=d.crop.width*m,C=d.crop.height*f;r.drawImage(p,b,S,k,C,-k*g*x,-C*y*v,k*g,C*y)}else r.drawImage(p,-m*g*x,-f*y*v,m*g,f*y)}r.restore()},DK=(r,e,t,s,i)=>{const{svgContent:n,viewBox:a,colorStyle:o,entryAnimation:l,exitAnimation:d}=e,u=i-e.startTime;let h=e.transform;e.keyframes&&e.keyframes.length>0&&(h=ea(e.transform,e.keyframes,u)),r.save();const p=h.position.x*t,m=h.position.y*s;r.translate(p,m),r.rotate(h.rotation*Math.PI/180);let f={x:h.scale.x,y:h.scale.y},g=h.opacity,y=0,x=0;const v=e.duration;let b=null,S=0;if(l&&u<l.duration){const T=u/l.duration;switch(l.type){case"fade":g*=T;break;case"scale":const j=T;f={x:f.x*j,y:f.y*j};break;case"slide-left":y=-(1-T)*t;break;case"slide-right":y=(1-T)*t;break;case"slide-up":x=-(1-T)*s;break;case"slide-down":x=(1-T)*s;break;case"rotate":r.rotate((1-T)*Math.PI*2),g*=T;break;case"bounce":const _=T<.5?2*T*T:1-Math.pow(-2*T+2,2)/2;f={x:f.x*_,y:f.y*_},g*=T;break;case"pop":const M=T<.5?T*2.2:1+(1-T)*.2;f={x:f.x*M,y:f.y*M};break;case"draw":S=T,g*=Math.min(1,T*2);break;case"wipe-left":b={x:0,y:0,width:(a?.width||200)*T,height:a?.height||200};break;case"wipe-right":b={x:(a?.width||200)*(1-T),y:0,width:(a?.width||200)*T,height:a?.height||200};break;case"wipe-up":b={x:0,y:(a?.height||200)*(1-T),width:a?.width||200,height:(a?.height||200)*T};break;case"wipe-down":b={x:0,y:0,width:a?.width||200,height:(a?.height||200)*T};break;case"reveal-center":const E=T;f={x:f.x*E,y:f.y*E},b={x:(a?.width||200)*(1-T)*.5,y:(a?.height||200)*(1-T)*.5,width:(a?.width||200)*T,height:(a?.height||200)*T};break;case"reveal-edges":b={x:(a?.width||200)*T*.5,y:(a?.height||200)*T*.5,width:(a?.width||200)*(1-T),height:(a?.height||200)*(1-T)};break;case"elastic":const D=T<.5?4*T*T*T:1-Math.pow(-2*T+2,3)/2,R=(D>1,D);f={x:f.x*R,y:f.y*R};break;case"flip-horizontal":f={x:f.x*Math.cos(T*Math.PI),y:f.y},g*=Math.abs(Math.cos(T*Math.PI/2));break;case"flip-vertical":f={x:f.x,y:f.y*Math.cos(T*Math.PI)},g*=Math.abs(Math.cos(T*Math.PI/2));break}}if(d&&u>v-d.duration){const A=v-d.duration,j=(u-A)/d.duration;switch(d.type){case"fade":g*=1-j;break;case"scale":const _=1-j;f={x:f.x*_,y:f.y*_};break;case"slide-left":y=-j*t;break;case"slide-right":y=j*t;break;case"slide-up":x=-j*s;break;case"slide-down":x=j*s;break;case"rotate":r.rotate(j*Math.PI*2),g*=1-j;break;case"bounce":const M=1-(j<.5?2*j*j:1-Math.pow(-2*j+2,2)/2);f={x:f.x*M,y:f.y*M},g*=1-j;break;case"pop":const E=j<.5?1-j*.2:1-j*2.2;f={x:f.x*Math.max(0,E),y:f.y*Math.max(0,E)};break;case"draw":S=1-j,g*=Math.max(0,1-j*2);break;case"wipe-left":b={x:(a?.width||200)*j,y:0,width:(a?.width||200)*(1-j),height:a?.height||200};break;case"wipe-right":b={x:0,y:0,width:(a?.width||200)*(1-j),height:a?.height||200};break;case"wipe-up":b={x:0,y:0,width:a?.width||200,height:(a?.height||200)*(1-j)};break;case"wipe-down":b={x:0,y:(a?.height||200)*j,width:a?.width||200,height:(a?.height||200)*(1-j)};break;case"reveal-center":b={x:(a?.width||200)*j*.5,y:(a?.height||200)*j*.5,width:(a?.width||200)*(1-j),height:(a?.height||200)*(1-j)};break;case"reveal-edges":b={x:(a?.width||200)*(1-j)*.5,y:(a?.height||200)*(1-j)*.5,width:(a?.width||200)*j,height:(a?.height||200)*j};break;case"elastic":const D=1-(j<.5?4*j*j*j:1-Math.pow(-2*j+2,3)/2);f={x:f.x*Math.max(0,D),y:f.y*Math.max(0,D)};break;case"flip-horizontal":f={x:f.x*Math.cos((1-j)*Math.PI+Math.PI),y:f.y},g*=Math.abs(Math.cos((1-j)*Math.PI/2));break;case"flip-vertical":f={x:f.x,y:f.y*Math.cos((1-j)*Math.PI+Math.PI)},g*=Math.abs(Math.cos((1-j)*Math.PI/2));break}}r.translate(y,x),r.scale(f.x,f.y),r.globalAlpha=g;const k=e.id;let C=Qo.get(k);if(!C){C=new Image;const A=new Blob([n],{type:"image/svg+xml"});if(C.src=URL.createObjectURL(A),Qo.set(k,C),Qo.size>50){const T=Qo.keys().next().value;if(T){const j=Qo.get(T);j?.src?.startsWith("blob:")&&URL.revokeObjectURL(j.src),Qo.delete(T)}}}if(C.complete&&C.naturalWidth>0){const A=a?.width||200,T=a?.height||200,j=document.createElement("canvas");j.width=A,j.height=T;const _=j.getContext("2d");if(_){if(_.drawImage(C,0,0,A,T),o&&o.colorMode&&o.colorMode!=="none"&&(o.colorMode==="tint"||o.colorMode==="replace")&&(_.globalCompositeOperation="source-in",_.fillStyle=o.tintColor||"#ffffff",_.globalAlpha=o.tintOpacity??1,_.fillRect(0,0,A,T)),b&&(r.save(),r.beginPath(),r.rect(-A/2+b.x,-T/2+b.y,b.width,b.height),r.clip()),S>0&&S<1){const M=Math.max(A,T)*4,E=M*(1-S);_.globalCompositeOperation="destination-in",_.strokeStyle="#000",_.lineWidth=Math.max(A,T),_.setLineDash([M]),_.lineDashOffset=E,_.strokeRect(0,0,A,T),_.setLineDash([])}r.drawImage(j,-A/2,-T/2,A,T),b&&r.restore()}}r.restore()},FK=(r,e,t,s)=>{const{shapeType:i,style:n,transform:a}=e;r.save();const o=a.position.x*t,l=a.position.y*s;r.translate(o,l),r.rotate(a.rotation*Math.PI/180),r.scale(a.scale.x,a.scale.y),r.globalAlpha=a.opacity,n.shadow?.blur&&n.shadow.blur>0&&(r.shadowColor=n.shadow.color||"#000000",r.shadowBlur=n.shadow.blur,r.shadowOffsetX=n.shadow.offsetX||0,r.shadowOffsetY=n.shadow.offsetY||0);const d=Math.min(t,s),u=d*.15,h=u/2,p=d/1080;switch(r.fillStyle=n.fill?.color||"#3b82f6",r.strokeStyle=n.stroke?.color||"#1d4ed8",r.lineWidth=(n.stroke?.width||2)*p,n.stroke?.dashArray&&n.stroke.dashArray.length>0&&r.setLineDash(n.stroke.dashArray),r.beginPath(),i){case"rectangle":{const m=n.cornerRadius||0;m>0?r.roundRect(-h,-h,u,u,Math.min(m,h)):r.rect(-h,-h,u,u);break}case"circle":case"ellipse":{r.ellipse(0,0,h,h,0,0,Math.PI*2);break}case"triangle":{r.moveTo(0,-h),r.lineTo(h,h),r.lineTo(-h,h),r.closePath();break}case"star":{const m=n.points||5,f=(n.innerRadius||.5)*h;for(let g=0;g<m*2;g++){const y=g%2===0?h:f,x=g*Math.PI/m-Math.PI/2,v=Math.cos(x)*y,b=Math.sin(x)*y;g===0?r.moveTo(v,b):r.lineTo(v,b)}r.closePath();break}case"arrow":{r.moveTo(-h,0),r.lineTo(h*.3,0),r.lineTo(h*.3,-h*.4),r.lineTo(h,0),r.lineTo(h*.3,h*.4),r.lineTo(h*.3,0),r.closePath();break}case"line":{r.moveTo(-h,0),r.lineTo(h,0);break}default:r.rect(-h,-h,u,u)}r.globalAlpha=a.opacity*(n.fill?.opacity??1),r.fill(),n.stroke?.width&&n.stroke.width>0&&(r.globalAlpha=a.opacity*(n.stroke?.opacity??1),r.stroke()),r.restore()},Vl=(r,e,t,s,i)=>{const n=i-e.startTime;let a=e.transform;e.keyframes&&e.keyframes.length>0&&(a=ea(e.transform,e.keyframes,n));let o={...e,transform:a};if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"){const u=Pd(e.emphasisAnimation,n);o={...o,transform:{...a,opacity:a.opacity*u.opacity,scale:{x:a.scale.x*u.scale*u.scaleX,y:a.scale.y*u.scale*u.scaleY},position:{x:a.position.x+u.offsetX,y:a.position.y+u.offsetY},rotation:a.rotation+u.rotation}}}const l=o.transform.rotate3d&&(o.transform.rotate3d.x!==0||o.transform.rotate3d.y!==0),d=o.blendMode&&o.blendMode!=="normal";if(l||d){wt||(wt=new Kb(t,s)),(wt.canvas.width!==t||wt.canvas.height!==s)&&wt.resize(t,s),wt.clear();let u=null;if(o.type==="svg"?u=wt.renderSVGClip(o,t,s):o.type==="sticker"||o.type==="emoji"?u=wt.renderStickerClip(o,t,s):u=wt.renderShapeClip(o,t,s),u){wt.getScene().add(u);const h=wt.render();r.drawImage(h,0,0)}return}o.type==="svg"?DK(r,o,t,s,i):o.type==="sticker"||o.type==="emoji"?IK(r,o,t,s,i):FK(r,o,t,s)},Jo=(r,e)=>r.filter(t=>e>=t.startTime&&e<t.endTime),Zo=(r,e,t,s,i)=>{const{text:n,animationStyle:a,words:o}=e;if(!n||n.trim().length===0)return;const l=a&&a!=="none"&&o&&o.length>0,d=i??e.startTime;l?LK(r,e,t,s,d):BK(r,e,t,s)},BK=(r,e,t,s)=>{const{text:i,style:n}=e;r.save();const a=n?.fontSize||24,o=n?.fontFamily||"Inter",l=n?.color||"#ffffff",d=n?.backgroundColor||"rgba(0, 0, 0, 0.7)",u=n?.position||"bottom";r.font=`bold ${a}px "${o}"`,r.textAlign="center",r.textBaseline="middle";const h=i.split(`
`),p=a*1.3,m=h.length*p;let f;u==="top"?f=a*2:u==="center"?f=s/2-m/2:f=s-a*2-m;for(let g=0;g<h.length;g++){const y=h[g].trim();if(y.length===0)continue;const x=f+g*p+p/2,b=r.measureText(y).width+20,S=p;r.fillStyle=d,r.fillRect(t/2-b/2,x-S/2,b,S),r.fillStyle=l,r.fillText(y,t/2,x)}r.restore()},LK=(r,e,t,s,i)=>{const n=CY(e,i);if(!n.visible||n.segments.length===0)return;r.save();const a=e.style,o=a?.fontSize||24,l=a?.fontFamily||"Inter",d=a?.color||"#ffffff",u=a?.backgroundColor||"rgba(0, 0, 0, 0.7)",h=a?.position||"bottom";r.font=`bold ${o}px "${l}"`,r.textBaseline="middle";const p=o*1.3;let m;h==="top"?m=o*2+p/2:h==="center"?m=s/2:m=s-o*2-p/2;const f=n.segments.map(b=>b.text).join(" "),g=r.measureText(f).width,y=g+30,x=p+10;r.fillStyle=u,r.fillRect(t/2-y/2,m-x/2,y,x);let v=t/2-g/2;for(const b of n.segments){const S=r.measureText(b.text+" ").width;r.save(),r.globalAlpha=b.opacity;const k=v+r.measureText(b.text).width/2,C=m+b.offsetY;r.translate(k,C),r.scale(b.scale,b.scale),r.translate(-k,-C);const A=OK(b,d,a?.highlightColor);r.fillStyle=A,r.textAlign="left",r.fillText(b.text,v,m+b.offsetY),r.restore(),v+=S}r.restore()},OK=(r,e,t)=>{if(r.color)return r.color.startsWith("linear-gradient")?t||"#ffff00":r.color==="transparent"?"rgba(0,0,0,0)":r.color;switch(r.style){case"highlighted":case"active":return t||"#ffff00";case"hidden":return"rgba(0,0,0,0)";default:return e}},Ir=(r,e,t,s,i,n)=>{const a={...Bi,...t,position:{x:t?.position?.x??Bi.position.x,y:t?.position?.y??Bi.position.y},scale:{x:t?.scale?.x??Bi.scale.x,y:t?.scale?.y??Bi.scale.y},anchor:{x:t?.anchor?.x??Bi.anchor.x,y:t?.anchor?.y??Bi.anchor.y}},o=a.rotate3d,l=o&&(o.x!==0||o.y!==0||o.z!==0),d=a.perspective;if(l||d&&d!==1e3){wt||(wt=new Kb(s,i)),(wt.canvas.width!==s||wt.canvas.height!==i)&&wt.resize(s,i),wt.clear();const M=wt.renderImageFrame(e,a,s,i,n,100);if(M){wt.getScene().add(M);const E=wt.render();r.drawImage(E,0,0)}return}const h=n&&n!=="normal",p=(a.opacity??1)<1,m=h&&p;let f=r,g=null;m&&(typeof OffscreenCanvas<"u"?g=new OffscreenCanvas(s,i):(g=document.createElement("canvas"),g.width=s,g.height=i),f=g.getContext("2d"),f||(f=r,g=null)),f.save(),f.globalAlpha=m?1:a.opacity??1,h&&!m&&(f.globalCompositeOperation=n);const y=s/2,x=i/2;f.translate(y+a.position.x,x+a.position.y),f.rotate(a.rotation*Math.PI/180),f.scale(a.scale.x,a.scale.y);let v,b;e instanceof HTMLVideoElement?(v=e.videoWidth||s,b=e.videoHeight||i):(v="width"in e?e.width:s,b="height"in e?e.height:i);const S=v/b,k=s/i;let C,A;S>k?(C=s,A=s/S):(A=i,C=i*S);const T=-C*a.anchor.x,j=-A*a.anchor.y,_=a.borderRadius||0;if(_>0){f.beginPath();const M=Math.min(_,C/2,A/2);f.roundRect(T,j,C,A,M),f.clip()}if(a.crop){const M=a.crop.x*v,E=a.crop.y*b,D=a.crop.width*v,R=a.crop.height*b,B=D/R;let O,F;B>k?(O=s,F=s/B):(F=i,O=i*B);const I=-O*a.anchor.x,K=-F*a.anchor.y;f.drawImage(e,M,E,D,R,I,K,O,F)}else f.drawImage(e,T,j,C,A);f.restore(),g&&h&&(r.save(),r.globalAlpha=a.opacity??1,r.globalCompositeOperation=n,r.drawImage(g,0,0),r.restore())},Qa=async(r,e)=>{try{let t=e;try{const{useEngineStore:u}=await hi(async()=>{const{useEngineStore:m}=await Promise.resolve().then(()=>VX);return{useEngineStore:m}},void 0),h=await u.getState().getChromaKeyEngine(),p=h?h.isEnabled(r):!1;if(h&&p){const m=await h.applyChromaKey(t,r);m&&m.image&&m.image.width>0&&m.image.height>0?t=m.image:console.warn("[ChromaKey] Chroma key returned invalid result")}}catch(u){console.error("[ChromaKey] Chroma key processing failed:",u)}const s=eq();s&&s.isInitialized();const i=vr();if(!i.isInitialized())return t;const a=i.getEffects(r),o=i.getColorGrading(r),l=Date.now();if(l-I2>5e3&&(I2=l),a.filter(u=>u.enabled).length>0)try{const u=await i.processEffects(r,t);u.image&&u.image.width>0&&u.image.height>0&&(t=u.image)}catch{}if(Object.keys(o).length>0)try{const u=await i.processColorGrading(r,t);u.image&&u.image.width>0&&u.image.height>0&&(t=u.image)}catch{}return t}catch{return e}},$K=(r,e)=>{try{const t=Xb();if(!t.isInitialized())return null;const s=e.filter(i=>i.type==="video"||i.type==="image");for(const i of s){const n=t.getTransitionsForTrack(i.id);for(const a of n){const o=i.clips.find(d=>d.id===a.clipAId),l=i.clips.find(d=>d.id===a.clipBId);if(!(!o||!l)&&t.isTimeInTransition(a,o,r)){const d=t.calculateProgress(a,o,r);return{clipA:{id:o.id,startTime:o.startTime,duration:o.duration,mediaId:o.mediaId,inPoint:o.inPoint},clipB:{id:l.id,startTime:l.startTime,duration:l.duration,mediaId:l.mediaId,inPoint:l.inPoint},transitionId:a.id,progress:d}}}}return null}catch{return null}},zK=async(r,e,t)=>{try{const s=Xb();if(!s.isInitialized())return r.progress<.5?e:t;const i=s.getTransition(r.transitionId);if(!i)return r.progress<.5?e:t;const n=await s.renderTransition(e,t,i,r.progress);return n&&n.frame&&n.frame.width>0&&n.frame.height>0?n.frame:r.progress<.5?e:t}catch{return r.progress<.5?e:t}},VK=[{label:"Free",value:null},{label:"9:16",value:9/16},{label:"16:9",value:16/9},{label:"1:1",value:1},{label:"4:3",value:4/3},{label:"3:4",value:3/4}],UK=({clip:r,videoSrc:e,mediaType:t,currentTime:s,canvasWidth:i,canvasHeight:n,onCropChange:a,onComplete:o,onCancel:l})=>{const d=w.useRef(null),u=w.useRef(null),h=w.useRef(null),p=r.transform.crop||{x:0,y:0,width:1,height:1},[m,f]=w.useState(p),[g,y]=w.useState(!1),[x,v]=w.useState(null),[b,S]=w.useState({x:0,y:0}),[k,C]=w.useState(p),[A,T]=w.useState(null),[j,_]=w.useState({width:0,height:0}),[M,E]=w.useState(!0);w.useEffect(()=>{if(E(!0),t==="image"){const P=h.current;if(!P)return;const W=()=>{P.naturalWidth>0&&P.naturalHeight>0&&(_({width:P.naturalWidth,height:P.naturalHeight}),E(!1))},z=()=>{console.error("[CropModeView] Image load error"),E(!1)};return P.addEventListener("load",W),P.addEventListener("error",z),P.src=e,()=>{P.removeEventListener("load",W),P.removeEventListener("error",z)}}else{const P=u.current;if(!P)return;const W=()=>{P.videoWidth>0&&P.videoHeight>0&&(_({width:P.videoWidth,height:P.videoHeight}),E(!1))},z=()=>{console.error("[CropModeView] Video load error"),E(!1)};return P.addEventListener("loadedmetadata",W),P.addEventListener("error",z),P.src=e,P.currentTime=s,()=>{P.removeEventListener("loadedmetadata",W),P.removeEventListener("error",z)}}},[e,s,t]);const D=(P,W)=>{P.preventDefault(),P.stopPropagation(),y(!0),v(W),S({x:P.clientX,y:P.clientY}),C(m)},R=P=>{if(!g||!x||!d.current)return;const W=(P.clientX-b.x)/(j.width*O),z=(P.clientY-b.y)/(j.height*O);let G={...k};if(x==="center")G.x=Math.max(0,Math.min(1-k.width,k.x+W)),G.y=Math.max(0,Math.min(1-k.height,k.y+z));else if(x==="nw"){const ce=-k.x,ae=k.width-.05,te=-k.y,Ve=k.height-.05,q=Math.max(ce,Math.min(W,ae)),oe=Math.max(te,Math.min(z,Ve));if(A){const V=(q+oe)/2;G.x=k.x+V,G.y=k.y+V,G.width=k.width-V,G.height=k.height-V}else G.x=k.x+q,G.y=k.y+oe,G.width=k.width-q,G.height=k.height-oe}else if(x==="ne"){const ce=-k.y,ae=k.height-.05,te=Math.max(ce,Math.min(z,ae));if(A){const Ve=(-W+te)/2;G.y=k.y+Ve,G.width=k.width-Ve,G.height=k.height-Ve}else G.y=k.y+te,G.width=Math.min(1-k.x,k.width+W),G.height=k.height-te}else if(x==="sw"){const ce=-k.x,ae=k.width-.05,te=Math.max(ce,Math.min(W,ae));if(A){const Ve=(te-z)/2;G.x=k.x+Ve,G.width=k.width-Ve,G.height=k.height-Ve}else G.x=k.x+te,G.width=k.width-te,G.height=Math.min(1-k.y,k.height+z)}else if(x==="se")if(A){const ce=(W+z)/2;G.width=Math.min(1-k.x,Math.max(.1,k.width+ce)),G.height=Math.min(1-k.y,Math.max(.1,k.height+ce))}else G.width=Math.min(1-k.x,Math.max(.1,k.width+W)),G.height=Math.min(1-k.y,Math.max(.1,k.height+z));else if(x==="n"){const ce=-k.y,ae=k.height-.05,te=Math.max(ce,Math.min(z,ae));G.y=k.y+te,G.height=k.height-te}else if(x==="s")G.height=Math.min(1-k.y,Math.max(.1,k.height+z));else if(x==="w"){const ce=-k.x,ae=k.width-.05,te=Math.max(ce,Math.min(W,ae));G.x=k.x+te,G.width=k.width-te}else x==="e"&&(G.width=Math.min(1-k.x,Math.max(.1,k.width+W)));G.width=Math.max(.05,Math.min(1,G.width)),G.height=Math.max(.05,Math.min(1,G.height)),G.x=Math.max(0,Math.min(1-G.width,G.x)),G.y=Math.max(0,Math.min(1-G.height,G.y)),f(G)},B=j.width>0&&i>0&&n>0?(()=>{const P=j.width/j.height,W=i/n;let z,G;return P>W?(z=i,G=i/P):(G=n,z=n*P),{width:z,height:G}})():{width:i,height:n},O=j.width>0?B.width/j.width:1,F=j.width>0?{x:m.x*j.width*O,y:m.y*j.height*O,width:m.width*j.width*O,height:m.height*j.height*O}:{x:0,y:0,width:0,height:0},I=()=>{g&&x&&a(m),y(!1),v(null)};w.useEffect(()=>{if(g)return window.addEventListener("mousemove",R),window.addEventListener("mouseup",I),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",I)}},[g,x,b,k,A,j,O]);const K=P=>{if(T(P),P){const W=m.width/m.height;let z;if(W>P){const G=m.height*P;z={...m,x:m.x+(m.width-G)/2,width:G}}else{const G=m.width/P;z={...m,y:m.y+(m.height-G)/2,height:G}}f(z),a(z)}},ee=()=>{const P={x:0,y:0,width:1,height:1};f(P),T(null),a(P)};return c.jsxs("div",{className:"absolute inset-0 z-10 bg-background-secondary flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 bg-background border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-xs font-medium text-text-primary",children:"Crop Video"}),c.jsx("div",{className:"flex items-center gap-1",children:VK.map(P=>c.jsx("button",{onClick:()=>K(P.value),disabled:M,className:`px-2.5 py-1 text-xs rounded transition-colors ${A===P.value?"bg-primary text-white font-medium":"bg-background-tertiary text-text-secondary hover:bg-background-secondary"}`,children:P.label},P.label))}),c.jsx("button",{onClick:ee,disabled:M,className:"p-1 text-text-muted hover:bg-background-secondary rounded transition-colors",title:"Reset crop",children:c.jsx(ja,{size:14})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("button",{onClick:l,className:"px-3 py-1.5 text-xs bg-background-tertiary hover:bg-background-secondary text-text-primary rounded transition-colors flex items-center gap-1.5",children:[c.jsx(ti,{size:14}),"Cancel"]}),c.jsxs("button",{onClick:()=>{a(m),o()},disabled:M,className:"px-3 py-1.5 text-xs bg-primary hover:bg-primary/90 text-black font-medium rounded transition-colors flex items-center gap-1.5",children:[c.jsx(Ri,{size:14}),"Apply"]})]})]}),c.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 overflow-hidden relative",children:[M&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background-secondary",children:c.jsx("div",{className:"text-text-muted text-sm",children:"Loading video..."})}),c.jsxs("div",{ref:d,className:"relative",style:{width:B.width,height:B.height,opacity:M?0:1},children:[t==="image"?c.jsx("img",{ref:h,className:"w-full h-full",style:{objectFit:"contain"},alt:"Crop preview"}):c.jsx("video",{ref:u,className:"w-full h-full",style:{objectFit:"contain"},muted:!0,playsInline:!0,preload:"metadata"}),!M&&j.width>0&&c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"absolute inset-0 pointer-events-none",width:B.width,height:B.height,children:[c.jsx("defs",{children:c.jsxs("mask",{id:"crop-mask",children:[c.jsx("rect",{x:"0",y:"0",width:B.width,height:B.height,fill:"white"}),c.jsx("rect",{x:F.x,y:F.y,width:F.width,height:F.height,fill:"black"})]})}),c.jsx("rect",{x:"0",y:"0",width:B.width,height:B.height,fill:"black",opacity:"0.6",mask:"url(#crop-mask)"})]}),c.jsxs("div",{className:"absolute border-2 border-white pointer-events-auto cursor-move",style:{left:F.x,top:F.y,width:F.width,height:F.height},onMouseDown:P=>D(P,"center"),children:[c.jsxs("svg",{className:"absolute inset-0 pointer-events-none",width:"100%",height:"100%",children:[c.jsx("line",{x1:"33.33%",y1:"0",x2:"33.33%",y2:"100%",stroke:"white",strokeWidth:"1",opacity:"0.5"}),c.jsx("line",{x1:"66.66%",y1:"0",x2:"66.66%",y2:"100%",stroke:"white",strokeWidth:"1",opacity:"0.5"}),c.jsx("line",{x1:"0",y1:"33.33%",x2:"100%",y2:"33.33%",stroke:"white",strokeWidth:"1",opacity:"0.5"}),c.jsx("line",{x1:"0",y1:"66.66%",x2:"100%",y2:"66.66%",stroke:"white",strokeWidth:"1",opacity:"0.5"})]}),["nw","ne","sw","se"].map(P=>c.jsx("div",{className:"absolute w-4 h-4 bg-white border-2 border-gray-800 rounded-sm cursor-nwse-resize pointer-events-auto hover:bg-primary transition-colors",style:{top:P.includes("n")?-8:void 0,bottom:P.includes("s")?-8:void 0,left:P.includes("w")?-8:void 0,right:P.includes("e")?-8:void 0},onMouseDown:W=>D(W,P)},P)),c.jsx("div",{className:"absolute w-16 h-4 bg-white border-2 border-gray-800 rounded-sm cursor-ns-resize pointer-events-auto hover:bg-primary transition-colors -top-2 left-1/2 -translate-x-1/2",onMouseDown:P=>D(P,"n")}),c.jsx("div",{className:"absolute w-16 h-4 bg-white border-2 border-gray-800 rounded-sm cursor-ns-resize pointer-events-auto hover:bg-primary transition-colors -bottom-2 left-1/2 -translate-x-1/2",onMouseDown:P=>D(P,"s")}),c.jsx("div",{className:"absolute w-4 h-16 bg-white border-2 border-gray-800 rounded-sm cursor-ew-resize pointer-events-auto hover:bg-primary transition-colors -left-2 top-1/2 -translate-y-1/2",onMouseDown:P=>D(P,"w")}),c.jsx("div",{className:"absolute w-4 h-16 bg-white border-2 border-gray-800 rounded-sm cursor-ew-resize pointer-events-auto hover:bg-primary transition-colors -right-2 top-1/2 -translate-y-1/2",onMouseDown:P=>D(P,"e")})]})]})]})]})]})},GK=({points:r,canvasWidth:e,canvasHeight:t,selectedPoint:s,hoveredPoint:i,disabled:n,onPointSelect:a,onPointHover:o,onPointMove:l,onPointRemove:d,onControlPointMove:u})=>{const[h,p]=w.useState(null),m=w.useRef(null),f=w.useCallback((v,b,S,k,C)=>{n||(v.preventDefault(),v.stopPropagation(),p({type:b,pointIndex:S,startX:v.clientX,startY:v.clientY,initialX:k,initialY:C}),b==="point"&&a(S))},[n,a]),g=w.useCallback(v=>{if(!h)return;const b=v.clientX-h.startX,S=v.clientY-h.startY,k=h.initialX+b,C=h.initialY+S;h.type==="point"?l(h.pointIndex,k,C):u(h.pointIndex,h.type,k,C)},[h,l,u]),y=w.useCallback(()=>{p(null)},[]);w.useEffect(()=>{if(h)return window.addEventListener("mousemove",g),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",y)}},[h,g,y]);const x=w.useCallback((v,b)=>{v.preventDefault(),r.length>2&&d(b)},[r.length,d]);return c.jsx("g",{ref:m,children:r.map((v,b)=>{const S=s===b,k=i===b,C=S&&v.controlPoints;return c.jsxs("g",{children:[C&&v.controlPoints&&c.jsxs(c.Fragment,{children:[c.jsx("line",{x1:v.controlPoints.cp1.x,y1:v.controlPoints.cp1.y,x2:v.screenX,y2:v.screenY,stroke:"#a855f7",strokeWidth:"1",opacity:"0.6"}),c.jsx("line",{x1:v.screenX,y1:v.screenY,x2:v.controlPoints.cp2.x,y2:v.controlPoints.cp2.y,stroke:"#a855f7",strokeWidth:"1",opacity:"0.6"}),c.jsx("circle",{cx:v.controlPoints.cp1.x,cy:v.controlPoints.cp1.y,r:"5",fill:"#a855f7",stroke:"white",strokeWidth:"1",className:"cursor-move pointer-events-auto",onMouseDown:A=>f(A,"cp1",b,v.controlPoints.cp1.x,v.controlPoints.cp1.y)}),c.jsx("circle",{cx:v.controlPoints.cp2.x,cy:v.controlPoints.cp2.y,r:"5",fill:"#a855f7",stroke:"white",strokeWidth:"1",className:"cursor-move pointer-events-auto",onMouseDown:A=>f(A,"cp2",b,v.controlPoints.cp2.x,v.controlPoints.cp2.y)})]}),c.jsxs("g",{transform:`translate(${v.screenX}, ${v.screenY}) rotate(45)`,className:"pointer-events-auto cursor-move",onMouseDown:A=>f(A,"point",b,v.screenX,v.screenY),onMouseEnter:()=>o(b),onMouseLeave:()=>o(null),onContextMenu:A=>x(A,b),children:[c.jsx("rect",{x:"-7",y:"-7",width:"14",height:"14",fill:S?"#22d3ee":k?"#67e8f9":"white",stroke:S?"white":"#22d3ee",strokeWidth:"2",rx:"2"}),b===0&&c.jsx("text",{transform:"rotate(-45)",x:"0",y:"4",textAnchor:"middle",fill:S?"white":"#22d3ee",fontSize:"8",fontWeight:"bold",className:"pointer-events-none select-none",children:"S"}),b===r.length-1&&b!==0&&c.jsx("text",{transform:"rotate(-45)",x:"0",y:"4",textAnchor:"middle",fill:S?"white":"#22d3ee",fontSize:"8",fontWeight:"bold",className:"pointer-events-none select-none",children:"E"})]})]},`point-${b}`)})})},WK=({config:r,canvasWidth:e,canvasHeight:t,currentTime:s,clipDuration:i,onPointMove:n,onPointAdd:a,onPointRemove:o,onControlPointMove:l,disabled:d=!1})=>{const[u,h]=w.useState(null),[p,m]=w.useState(null),f=w.useMemo(()=>r.points.map(b=>({...b,screenX:e/2+b.x,screenY:t/2+b.y,controlPoints:b.controlPoints?{cp1:{x:e/2+b.controlPoints.cp1.x,y:t/2+b.controlPoints.cp1.y},cp2:{x:e/2+b.controlPoints.cp2.x,y:t/2+b.controlPoints.cp2.y}}:void 0})),[r.points,e,t]),g=w.useMemo(()=>{if(f.length<2)return"";const b=f.map(S=>({x:S.screenX,y:S.screenY,time:S.time,controlPoints:S.controlPoints}));return OP(b)},[f]),y=w.useMemo(()=>{if(r.points.length===0||i<=0)return null;const b=s/i,S=[...f].sort((k,C)=>k.time-C.time);if(b<=S[0].time)return{x:S[0].screenX,y:S[0].screenY};if(b>=S[S.length-1].time){const k=S[S.length-1];return{x:k.screenX,y:k.screenY}}for(let k=0;k<S.length-1;k++)if(b>=S[k].time&&b<=S[k+1].time){const C=S[k],A=S[k+1],T=A.time-C.time,j=T>0?(b-C.time)/T:0;return C.controlPoints&&A.controlPoints?YK({x:C.screenX,y:C.screenY},C.controlPoints.cp2,A.controlPoints.cp1,{x:A.screenX,y:A.screenY},j):{x:C.screenX+(A.screenX-C.screenX)*j,y:C.screenY+(A.screenY-C.screenY)*j}}return null},[f,s,i,r.points.length]),x=w.useCallback(b=>{if(d)return;const S=b.currentTarget.closest("svg");if(!S)return;const k=S.getBoundingClientRect(),C=b.clientX-k.left,A=b.clientY-k.top,T=C-e/2,j=A-t/2;let _=.5;if(f.length>=2){let M=1/0,E=.5;for(let D=0;D<f.length-1;D++){const R=f[D],B=f[D+1],O=B.screenX-R.screenX,F=B.screenY-R.screenY,I=Math.sqrt(O*O+F*F);if(I===0)continue;const K=Math.max(0,Math.min(1,((C-R.screenX)*O+(A-R.screenY)*F)/(I*I))),ee=R.screenX+K*O,P=R.screenY+K*F,W=Math.sqrt((C-ee)**2+(A-P)**2);W<M&&(M=W,E=R.time+K*(B.time-R.time))}_=E}a({x:T,y:j,time:_})},[e,t,f,a,d]),v=w.useCallback(b=>{h(S=>S===b?null:b)},[]);return!r.enabled||!r.showPath?null:c.jsxs("svg",{className:"absolute inset-0 pointer-events-none",width:e,height:t,style:{overflow:"visible"},children:[c.jsx("defs",{children:c.jsx("marker",{id:"motion-path-arrow",markerWidth:"6",markerHeight:"6",refX:"3",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:c.jsx("path",{d:"M0,0 L6,3 L0,6 Z",fill:"#22d3ee"})})}),g&&c.jsxs(c.Fragment,{children:[c.jsx("path",{d:g,fill:"none",stroke:"#22d3ee",strokeWidth:"2",strokeDasharray:"6 3",opacity:"0.8",className:"pointer-events-auto cursor-crosshair",onClick:x}),c.jsx("path",{d:g,fill:"none",stroke:"transparent",strokeWidth:"16",className:"pointer-events-auto cursor-crosshair",onClick:x})]}),c.jsx(GK,{points:f,canvasWidth:e,canvasHeight:t,selectedPoint:u,hoveredPoint:p,disabled:d,onPointSelect:v,onPointHover:m,onPointMove:(b,S,k)=>{const C=S-e/2,A=k-t/2;n(b,C,A)},onPointRemove:o,onControlPointMove:(b,S,k,C)=>{const A=k-e/2,T=C-t/2;l(b,S,A,T)}}),y&&c.jsxs("g",{transform:`translate(${y.x}, ${y.y})`,children:[c.jsx("circle",{r:"8",fill:"#22d3ee",opacity:"0.3"}),c.jsx("circle",{r:"5",fill:"#22d3ee"}),c.jsx("circle",{r:"3",fill:"white"})]}),f.map((b,S)=>c.jsxs("text",{x:b.screenX+12,y:b.screenY-12,fill:"white",fontSize:"10",fontFamily:"system-ui",className:"pointer-events-none select-none",children:[(b.time*100).toFixed(0),"%"]},`label-${S}`))]})};function YK(r,e,t,s,i){const n=1-i,a=n*n,o=a*n,l=i*i,d=l*i;return{x:o*r.x+3*a*i*e.x+3*n*l*t.x+d*s.x,y:o*r.y+3*a*i*e.y+3*n*l*t.y+d*s.y}}const qK=({effects:r,width:e,height:t,currentTime:s,isPlaying:i})=>{const n=w.useRef(null),a=w.useRef(null),o=w.useRef(null),l=w.useRef(null),d=w.useRef(null),u=w.useRef(null),h=w.useRef(null),p=w.useRef(null),m=w.useRef(s),f=w.useRef(performance.now()),g=w.useRef(0),y=w.useRef(0),x=w.useRef(i),[v,b]=He.useState(!1),S=w.useMemo(()=>eu(),[]),k=w.useCallback(_=>{switch(_){case"add":return kc;case"multiply":return Sg;case"screen":return kc;case"normal":default:return wr}},[]);w.useEffect(()=>{m.current=s},[s]),w.useEffect(()=>{S.setCanvasSize(e,t)},[S,e,t]);const C=w.useRef(new Set);w.useEffect(()=>{const _=new Set(r.map(E=>E.id)),M=C.current;for(const E of r)S.getEffect(E.id)?M.has(E.id)||S.updateEffect(E.id,E.config):S.addEffect(E);for(const E of M)_.has(E)||S.removeEffect(E);C.current=_},[r,S]),w.useEffect(()=>{if(!n.current||e<=0||t<=0)return;const _=new QS;o.current=_;const M=new JS(0,e,t,0,.1,1e3);M.position.z=100,l.current=M;const E=new KS({alpha:!0,antialias:!0,premultipliedAlpha:!1});E.setSize(e,t,!1),E.setPixelRatio(Math.min(window.devicePixelRatio,2)),E.setClearColor(0,0),E.domElement.style.width="100%",E.domElement.style.height="100%",E.domElement.style.objectFit="contain",E.domElement.style.position="absolute",E.domElement.style.top="0",E.domElement.style.left="0",n.current.appendChild(E.domElement),a.current=E;const D=new CR,R=new Float32Array(1e4*3),B=new Float32Array(1e4*3),O=new Float32Array(1e4),F=new Float32Array(1e4);D.setAttribute("position",new Mu(R,3)),D.setAttribute("color",new Mu(B,3)),D.setAttribute("size",new Mu(O,1)),D.setAttribute("alpha",new Mu(F,1)),d.current=D;const I=new SR({size:12,vertexColors:!0,transparent:!0,opacity:1,blending:kc,depthWrite:!1,sizeAttenuation:!1});u.current=I;const K=new TR(D,I);return h.current=K,_.add(K),b(!0),()=>{b(!1),D.dispose(),I.dispose(),E.dispose(),n.current&&E.domElement&&n.current.removeChild(E.domElement)}},[e,t]),w.useEffect(()=>{if(!u.current||r.length===0)return;const _=r.find(M=>M.enabled);if(_){const M=k(_.config.blendMode);u.current.blending!==M&&(u.current.blending=M,u.current.needsUpdate=!0)}},[r,k]);const A=w.useCallback(_=>{const M=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(_);if(M)return{r:parseInt(M[1],16)/255,g:parseInt(M[2],16)/255,b:parseInt(M[3],16)/255};const E=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/i.exec(_);return E?{r:parseInt(E[1],10)/255,g:parseInt(E[2],10)/255,b:parseInt(E[3],10)/255}:{r:1,g:1,b:1}},[]),T=w.useCallback(_=>{if(!d.current)return;const M=d.current.attributes.position.array,E=d.current.attributes.color.array,D=d.current.attributes.size.array,R=Math.min(_.length,1e4);for(let B=0;B<R;B++){const O=_[B],F=B*3;M[F]=O.position.x,M[F+1]=t-O.position.y,M[F+2]=O.position.z;const I=A(O.color);E[F]=I.r*O.opacity,E[F+1]=I.g*O.opacity,E[F+2]=I.b*O.opacity,D[B]=O.size}for(let B=R;B<1e4;B++){const O=B*3;M[O]=0,M[O+1]=0,M[O+2]=-1e3,D[B]=0}d.current.attributes.position.needsUpdate=!0,d.current.attributes.color.needsUpdate=!0,d.current.attributes.size.needsUpdate=!0,d.current.setDrawRange(0,R)},[A,t]),j=w.useCallback(()=>{!a.current||!o.current||!l.current||a.current.render(o.current,l.current)},[]);return w.useEffect(()=>{x.current=i},[i]),w.useEffect(()=>{if(v)if(i){g.current=performance.now(),y.current=m.current,f.current=performance.now();const _=()=>{if(!x.current)return;const M=performance.now(),E=M-f.current;f.current=M;const D=E/1e3,R=(M-g.current)/1e3,B=y.current+R;S.update(B,D);const O=S.getParticles();T(O),j(),p.current=requestAnimationFrame(_)};return p.current=requestAnimationFrame(_),()=>{p.current&&(cancelAnimationFrame(p.current),p.current=null)}}else{S.update(s,1/30);const _=S.getParticles();T(_),j()}},[i,v,s,S,T,j,r]),w.useEffect(()=>{l.current&&(l.current.left=0,l.current.right=e,l.current.top=t,l.current.bottom=0,l.current.updateProjectionMatrix()),a.current&&a.current.setSize(e,t,!1)},[e,t]),c.jsx("div",{ref:n,className:"absolute inset-0 pointer-events-none w-full h-full",style:{zIndex:50}})};let HK=0;const XK=Ta((r,e)=>({tasks:new Map,isProcessing:!1,currentTaskId:null,addTask:(t,s)=>{const i=`task-${++HK}-${Date.now()}`,n={id:i,clipId:t,type:s,progress:0,status:"queued",message:"Waiting to start..."};return r(a=>{const o=new Map(a.tasks);return o.set(i,n),{tasks:o,isProcessing:!0,currentTaskId:a.currentTaskId||i}}),i},updateTaskProgress:(t,s,i)=>{r(n=>{const a=n.tasks.get(t);if(!a)return n;const o=new Map(n.tasks);return o.set(t,{...a,progress:Math.min(100,Math.max(0,s)),status:"processing",message:i||a.message,startedAt:a.startedAt||Date.now()}),{tasks:o}})},completeTask:t=>{r(s=>{const i=s.tasks.get(t);if(!i)return s;const n=new Map(s.tasks);n.set(t,{...i,progress:100,status:"completed",message:"Complete",completedAt:Date.now()});const a=Array.from(n.values()).some(l=>l.status==="queued"||l.status==="processing"),o=a&&Array.from(n.values()).find(l=>l.status==="queued")?.id||null;return{tasks:n,isProcessing:a,currentTaskId:o}})},failTask:(t,s)=>{r(i=>{const n=i.tasks.get(t);if(!n)return i;const a=new Map(i.tasks);a.set(t,{...n,status:"failed",message:"Failed",error:s,completedAt:Date.now()});const o=Array.from(a.values()).some(l=>l.status==="queued"||l.status==="processing");return{tasks:a,isProcessing:o,currentTaskId:o&&Array.from(a.values()).find(l=>l.status==="queued")?.id||null}})},removeTask:t=>{r(s=>{const i=new Map(s.tasks);i.delete(t);const n=Array.from(i.values()).some(a=>a.status==="queued"||a.status==="processing");return{tasks:i,isProcessing:n,currentTaskId:n?s.currentTaskId:null}})},getTasksForClip:t=>Array.from(e().tasks.values()).filter(s=>s.clipId===t),hasActiveProcessing:()=>Array.from(e().tasks.values()).some(t=>t.status==="queued"||t.status==="processing"),getOverallProgress:()=>{const t=Array.from(e().tasks.values()),s=t.filter(a=>a.status!=="completed"&&a.status!=="failed");if(s.length===0)return{total:0,completed:0,progress:100};const n=s.reduce((a,o)=>a+o.progress,0)/s.length;return{total:s.length,completed:t.filter(a=>a.status==="completed").length,progress:Math.round(n)}},clearCompleted:()=>{r(t=>{const s=new Map(t.tasks);for(const[i,n]of s)(n.status==="completed"||n.status==="failed")&&s.delete(i);return{tasks:s}})}})),KK={"background-removal":"Background Removal","auto-reframe":"Auto Reframe","color-grading":"Color Grading",effects:"Video Effects"},QK=({task:r})=>{const e=()=>{switch(r.status){case"queued":return c.jsx(pi,{size:14,className:"text-text-muted"});case"processing":return c.jsx(_i,{size:14,className:"text-blue-400 animate-spin"});case"completed":return c.jsx(Rx,{size:14,className:"text-green-400"});case"failed":return c.jsx(Gj,{size:14,className:"text-red-400"})}},t=()=>{switch(r.status){case"queued":return"text-text-muted";case"processing":return"text-blue-400";case"completed":return"text-green-400";case"failed":return"text-red-400"}};return c.jsxs("div",{className:"flex items-center gap-3 p-2 bg-black/20 rounded",children:[e(),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-xs font-medium text-text-primary truncate",children:KK[r.type]}),c.jsx("span",{className:`text-[10px] ${t()}`,children:r.status==="processing"?`${r.progress}%`:r.status})]}),r.status==="processing"&&c.jsxs("div",{className:"mt-1",children:[c.jsx(bb,{value:r.progress,className:"h-1 bg-black/30"}),c.jsx("p",{className:"text-[9px] text-text-muted mt-0.5 truncate",children:r.message})]}),r.status==="failed"&&r.error&&c.jsx("p",{className:"text-[9px] text-red-400 mt-0.5 truncate",children:r.error})]})]})},JK=()=>{const{tasks:r,isProcessing:e,getOverallProgress:t}=XK(),i=Array.from(r.values()).filter(a=>a.status==="queued"||a.status==="processing");if(!e||i.length===0)return null;const{progress:n}=t();return c.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-background-secondary/95 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-border",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center",children:c.jsx(_i,{size:20,className:"text-blue-400 animate-spin"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Processing Effects"}),c.jsxs("p",{className:"text-xs text-text-muted",children:[i.length," task",i.length!==1?"s":""," in progress"]})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Overall Progress"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[n,"%"]})]}),c.jsx(bb,{value:n,className:"h-2 bg-black/30"})]}),c.jsx(ha,{className:"max-h-48",children:c.jsx("div",{className:"space-y-2",children:i.map(a=>c.jsx(QK,{task:a},a.id))})}),c.jsx("p",{className:"text-[10px] text-text-muted text-center mt-4",children:"Please wait while effects are being applied..."})]})})},ZK=(r,e)=>{const t=r*e;return t>=3840*2160?6:t>=2560*1440?5:t>=1920*1080?4:3},eQ=async(r,e,t,s)=>{try{if(!r.getDevice()||e.length===0)return null;r.beginFrame();const n=[];for(let o=0;o<e.length;o++){const l=e[o],d=r.createTextureFromImage(l.bitmap);n.push(d);const u={position:l.transform.position,scale:l.transform.scale,rotation:l.transform.rotation,anchor:l.transform.anchor,opacity:l.transform.opacity,borderRadius:l.transform.borderRadius};r.renderLayer({texture:d,transform:u,effects:[],opacity:l.transform.opacity,borderRadius:l.transform.borderRadius||0})}const a=await r.endFrame();for(const o of n)r.releaseTexture(o);return a}catch(i){return console.error("[renderAllLayersWithGPU] Error:",i),null}},tQ=()=>{const r=w.useRef(null),e=w.useRef(null),t=w.useRef(null),s=w.useRef(null),i=w.useRef(!1),n=w.useRef(null),a=w.useRef(null),o=w.useRef(null),l=w.useRef(null),d=w.useRef(null),u=w.useRef(null),h=w.useRef(!1),p=w.useRef(null),m=w.useRef(null),f=w.useRef(null),g=w.useRef(new Map),y=w.useRef(null),x=w.useRef(!1),[v,b]=w.useState(!1),[S,k]=w.useState(!1),[C,A]=w.useState({width:0,height:0}),[T,j]=w.useState("none"),[_,M]=w.useState(!1),[E,D]=w.useState(!1),R=lu(N=>N.isDark),[B,O]=w.useState("none"),[F,I]=w.useState(null),[K,ee]=w.useState(!0),P=w.useRef(null),W=w.useRef(null),z=w.useRef(null),G=w.useRef(!1),ce=w.useRef(0),ae=32,te=w.useRef(0),Ve=16,[q,oe]=w.useState(null),[V,he]=w.useState(null),Se=w.useRef(null),J=w.useRef(new Map),be=w.useRef(new Map);w.useEffect(()=>{const N=r.current;if(!N)return;const L=new ResizeObserver(re=>{for(const X of re){const{width:ne,height:ve}=X.contentRect;A({width:ne,height:ve}),ne>0&&ve>0&&(a.current=new OffscreenCanvas(ne,ve),o.current=a.current.getContext("2d"))}});return L.observe(N),()=>L.disconnect()},[]);const ie=U(N=>N.project),Pe=U(N=>N.getMediaItem),$=me(N=>N.getTitleEngine),we=w.useMemo(()=>$()?.getAllTextClips()||[],[$,ie.modifiedAt]),qe=me(N=>N.getGraphicsEngine),fe=w.useMemo(()=>{const N=qe(),L=N?.getAllShapeClips()||[],re=N?.getAllSVGClips()||[],X=N?.getAllStickerClips()||[];return[...L,...re,...X]},[qe,ie.modifiedAt]),ke=w.useMemo(()=>ie.timeline.subtitles||[],[ie.timeline.subtitles]),Ge=U(N=>N.updateClipTransform),Je=U(N=>N.updateTextTransform),Tt=U(N=>N.updateShapeTransform),et=ie.timeline.tracks,Ee=ie.settings,At=w.useRef(et);w.useEffect(()=>{At.current=et},[et]);const mi=w.useRef(we);w.useEffect(()=>{mi.current=we},[we]);const ri=w.useRef(fe);w.useEffect(()=>{ri.current=fe},[fe]);const qi=w.useRef(ke);w.useEffect(()=>{qi.current=ke},[ke]);const Hi=w.useRef(!1),vs=ft(N=>N.selectedItems),ni=ft(N=>N.cropMode),qs=ft(N=>N.cropClipId),Kr=ft(N=>N.setCropMode),Pn=ft(N=>N.exportState),Do=ft(N=>N.motionPathMode),Ia=ft(N=>N.motionPathClipId),{playheadPosition:Bt,playbackState:Qr,playbackRate:Q,isScrubbing:Ce,pause:Ie,togglePlayback:Ue,seekTo:kt,seekRelative:tt,setPlayheadPosition:ht}=Wt();w.useEffect(()=>{Hi.current=Ce},[Ce]);const vt=Qr==="playing",pt=He.useMemo(()=>{if(!Do||!Ia)return null;for(const N of ie.timeline.tracks){const L=N.clips.find(re=>re.id===Ia);if(L)return L}return null},[Do,Ia,ie.timeline.tracks]),[gr,Xi]=He.useState(null);He.useEffect(()=>{Xi(pt?{clipId:pt.id,enabled:!0,pathType:"bezier",points:[],showPath:!0,autoOrient:!1,alignOrigin:[.5,.5]}:null)},[pt]);const dm=He.useCallback((N,L,re)=>{Xi(X=>{if(!X)return X;const ne=[...X.points];return ne[N]={...ne[N],x:L,y:re},{...X,points:ne}})},[]),Qb=He.useCallback(N=>{Xi(L=>{if(!L)return L;const re=[...L.points,N].sort((X,ne)=>X.time-ne.time);return{...L,points:re}})},[]),Fo=He.useCallback(N=>{Xi(L=>{if(!L)return L;const re=L.points.filter((X,ne)=>ne!==N);return{...L,points:re}})},[]),um=He.useCallback((N,L,re,X)=>{Xi(ne=>{if(!ne)return ne;const ve=[...ne.points],Re=ve[N];return Re.controlPoints||(Re.controlPoints={cp1:{x:0,y:0},cp2:{x:0,y:0}}),Re.controlPoints[L]={x:re,y:X},{...ne,points:ve}})},[]),Nn=He.useMemo(()=>eu(),[]),[Jb,oN]=He.useState(()=>Nn.getChangeVersion());He.useEffect(()=>Nn.onEffectsChange(()=>{oN(Nn.getChangeVersion())}),[Nn]);const Zb=He.useMemo(()=>Nn.getAllEffects(),[Nn,Jb]),fi=He.useMemo(()=>{const N=ie.timeline.tracks;let L=0;for(const X of N)for(const ne of X.clips){const ve=ne.startTime+ne.duration;ve>L&&(L=ve)}for(const X of we){const ne=X.startTime+X.duration;ne>L&&(L=ne)}for(const X of fe){const ne=X.startTime+X.duration;ne>L&&(L=ne)}const re=ie.timeline.duration;return re>0?Math.min(L,re):L},[ie.timeline.tracks,we,fe,ie.timeline.duration]);w.useEffect(()=>{if(i.current)return;const N=Dy();r.current&&N.setCanvas(r.current),i.current=!0,k(!0)},[]),w.useEffect(()=>()=>{for(const N of be.current.values())N.input[Symbol.dispose]?.();be.current.clear();for(const N of J.current.values())N.video.src="",URL.revokeObjectURL(N.url);J.current.clear(),l.current&&(l.current.pause(),l.current.src="",l.current=null),d.current&&(URL.revokeObjectURL(d.current),d.current=null),u.current=null},[]),He.useLayoutEffect(()=>{const N=r.current;if(!N)return;const L=Ee.viewportWidth??Ee.width,re=Ee.viewportHeight??Ee.height;(N.width!==L||N.height!==re)&&(N.width=L,N.height=re)},[Ee.width,Ee.height,Ee.viewportWidth,Ee.viewportHeight]),w.useEffect(()=>{S&&r.current&&Dy().setCanvas(r.current)},[S]),w.useEffect(()=>x.current||!r.current?void 0:((async()=>{try{const L=r.current;if(!L)return;const X=await ia.getInstance().createRenderer({canvas:L,width:Ee.width,height:Ee.height,preferredRenderer:qc()?"webgpu":"canvas2d"});y.current=X,x.current=!0,j(X.type),X.onDeviceLost(()=>{console.warn("[Preview] GPU device lost, attempting recovery..."),X.recreateDevice().then(ne=>{ne||(console.error("[Preview] Failed to recover GPU device"),j("canvas2d"))})})}catch(L){console.warn("[Preview] Failed to initialize GPU renderer:",L),j("canvas2d")}})(),()=>{y.current&&(y.current.destroy(),y.current=null,x.current=!1)}),[]),w.useEffect(()=>{if(y.current&&r.current){const N=r.current;(N.width!==Ee.width||N.height!==Ee.height)&&y.current.resize(Ee.width,Ee.height)}},[Ee.width,Ee.height]);const ev=w.useRef(Q),Bo=w.useRef(Bt),_r=w.useRef(new Map),hl=w.useRef(new Map);w.useEffect(()=>{ev.current=Q},[Q]),w.useEffect(()=>{vt||(Bo.current=Bt)},[vt,Bt]);const Da=w.useCallback(()=>{const N=_r.current;for(const[,L]of N)L.input[Symbol.dispose]?.();_r.current=new Map;for(const[,L]of hl.current)L.close();hl.current=new Map},[]),Lo=w.useCallback(()=>{if(p.current){try{p.current.stop()}catch{}p.current.disconnect(),p.current=null}f.current&&(f.current.stopScheduler(),f.current.stopAllClips())},[]);w.useEffect(()=>{m.current&&(m.current.gain.value=v?0:1),f.current&&f.current.setMasterVolume(v?0:1)},[v]);const Jr=w.useCallback((N,L,re,X,ne,ve,Re,pe="all")=>{const ue=L.map((Y,le)=>({track:Y,originalIndex:le})).filter(({track:Y})=>(Y.type==="video"||Y.type==="image")&&!Y.hidden).map(({originalIndex:Y})=>Y),ge=ue.length>0?Math.min(...ue):1/0,We=ue.length>0?Math.max(...ue):-1,je=L.map((Y,le)=>({track:Y,originalIndex:le})).filter(({track:Y})=>(Y.type==="text"||Y.type==="graphics")&&!Y.hidden).filter(({originalIndex:Y})=>pe==="below-video"?Y>We:pe==="above-video"?Y<ge:!0);je.sort((Y,le)=>le.originalIndex-Y.originalIndex);for(const{track:Y}of je)if(Y.type==="graphics"){const le=re.filter(xe=>xe.trackId===Y.id);for(const xe of le)Vl(N,xe,ve,Re,ne)}else if(Y.type==="text"){const le=X.filter(xe=>xe.trackId===Y.id);for(const xe of le)zl(N,xe,ve,Re,ne)}},[]),cN=w.useCallback(async N=>{const L=At.current,re=L.filter(ue=>ue.type==="audio"&&!ue.hidden),X=L.filter(ue=>(ue.type==="video"||ue.type==="image")&&!ue.hidden);f.current||(f.current=eh());const ne=f.current;ne.setMasterVolume(v?0:1);const ve=U.getState(),Re=yc(),pe=[];for(const ue of re)if(ne.createTrack({trackId:ue.id,volume:1,pan:0,muted:ue.muted||!1,solo:ue.solo||!1,effects:[]}),!ue.muted)for(const ge of ue.clips){const We=ge.startTime+ge.duration;if(N>=ge.startTime&&N<We){const de=Pe(ge.mediaId);if(!de?.blob)continue;let je=g.current.get(ge.mediaId);if(!je)try{const Le=ne.getAudioContext(),$e=await de.blob.arrayBuffer();je=await Le.decodeAudioData($e),g.current.set(ge.mediaId,je)}catch(Le){console.warn(`[Preview] Failed to decode audio for clip ${ge.id}:`,Le);continue}let le=ve.getClip(ge.id)?.audioEffects||[];if(le.length===0)for(const Le of X){for(const $e of Le.clips)if($e.mediaId===ge.mediaId&&Math.abs($e.startTime-ge.startTime)<.01){const st=ve.getClip($e.id)?.audioEffects||[];if(st.length>0){le=st;break}}if(le.length>0)break}const xe=le.filter(Le=>Le.enabled);ne.updateTrackEffects(ue.id,xe);const ye=N-ge.startTime,se=Re.isReverse(ge.id);let Me=(ge.inPoint||0)+ye;se&&(Me=je.duration-Me,Me=Math.max(0,Me)),pe.push({clipId:ge.id,trackId:ue.id,audioBuffer:je,startTime:ge.startTime,endTime:We,mediaOffset:Me,volume:ge.volume??1,pan:0,effects:xe,speed:ge.speed??1})}}pe.length>0&&(await ne.resume(),ne.scheduleClips(pe))},[Pe,v]),Au=w.useCallback(async()=>{const N=At.current,L=N.filter(Re=>Re.type==="audio"&&!Re.hidden),re=N.filter(Re=>(Re.type==="video"||Re.type==="image")&&!Re.hidden);f.current||(f.current=eh());const ne=f.current.getAudioContext(),ve=[...L,...re];for(const Re of ve)for(const pe of Re.clips){if(g.current.has(pe.mediaId))continue;const ue=Pe(pe.mediaId);if(ue?.blob)try{const ge=await ue.blob.arrayBuffer(),We=await ne.decodeAudioData(ge);g.current.set(pe.mediaId,We)}catch{}}},[Pe]),tv=w.useCallback(N=>{const re=At.current.filter(ve=>(ve.type==="audio"||ve.type==="video")&&!ve.hidden&&!ve.muted),X=[],ne=U.getState();for(const ve of re)for(const Re of ve.clips){const pe=Re.startTime+Re.duration;if(pe<=N||Re.startTime>N+1)continue;const ue=g.current.get(Re.mediaId);if(!ue)continue;const We=(ne.getClip(Re.id)?.audioEffects||[]).filter(de=>de.enabled);X.push({clipId:Re.id,trackId:ve.id,audioBuffer:ue,startTime:Re.startTime,endTime:pe,mediaOffset:Re.inPoint||0,volume:Re.volume??1,pan:0,effects:We,speed:Re.speed??1})}return X},[]),ju=w.useCallback(async(N,L,re,X)=>{const ne=Pe(N.mediaId);if(!ne?.blob)return null;if(ne.type==="image")try{return await createImageBitmap(ne.blob)}catch{return null}try{const ve=L-N.startTime,pe=yc().getSourceTimeAtPlaybackTime(N.id,ve);let ue=(N.inPoint||0)+pe;const ge=N.mediaId;let We=J.current.get(ge);if(!We){const Ze=URL.createObjectURL(ne.blob),st=document.createElement("video");if(st.src=Ze,st.muted=!0,st.playsInline=!0,st.preload="auto",st.crossOrigin="anonymous",await new Promise((Lt,gt)=>{const Xe=setTimeout(()=>gt(new Error("Video load timeout")),1e4);st.onloadedmetadata=()=>{clearTimeout(Xe),Lt()},st.onerror=()=>{clearTimeout(Xe),gt(new Error("Video load failed"))}}),We={video:st,url:Ze,lastUsed:Date.now()},J.current.set(ge,We),J.current.size>8){let Lt="",gt=1/0;for(const[Xe,js]of J.current.entries())js.lastUsed<gt&&(gt=js.lastUsed,Lt=Xe);if(Lt){const Xe=J.current.get(Lt);Xe&&(Xe.video.src="",URL.revokeObjectURL(Xe.url),J.current.delete(Lt))}}}We.lastUsed=Date.now();const{video:de}=We;if(de.duration>0&&ue>=de.duration){const Ze=de.duration-(N.inPoint||0);Ze>0?ue=(N.inPoint||0)+(ue-(N.inPoint||0))%Ze:ue=N.inPoint||0}const je=Math.max(0,Math.min(ue,de.duration-.001));Math.abs(de.currentTime-je)>.01&&(de.currentTime=je,await new Promise(Ze=>{const st=()=>{de.removeEventListener("seeked",st),Ze()};de.addEventListener("seeked",st),setTimeout(Ze,500)}));const Y=document.createElement("canvas");Y.width=re,Y.height=X;const le=Y.getContext("2d");if(!le)return null;const xe=de.videoWidth/de.videoHeight,ye=re/X;let se=re,Me=X,Le=0,$e=0;return xe>ye?(Me=re/xe,$e=(X-Me)/2):(se=X*xe,Le=(re-se)/2),le.fillStyle="#000000",le.fillRect(0,0,re,X),le.drawImage(de,Le,$e,se,Me),await createImageBitmap(Y)}catch{const ve=J.current.get(N.mediaId);return ve&&(ve.video.src="",URL.revokeObjectURL(ve.url),J.current.delete(N.mediaId)),null}},[Pe]),Oo=w.useCallback(async N=>{const L=r.current;if(!L)return!1;(L.width===0||L.height===0)&&(L.width=Ee.width,L.height=Ee.height);const re=L.getContext("2d");if(!re)return!1;(!a.current||a.current.width!==L.width||a.current.height!==L.height)&&(a.current=new OffscreenCanvas(L.width,L.height),o.current=a.current.getContext("2d"));const X=o.current;if(!X)return!1;const ne=et.filter(de=>(de.type==="video"||de.type==="image")&&!de.hidden);let ve=!1,Re=!0;const pe=Ka(fe,N),ue=Xa(we,N),ge=$K(N,et);if(ge)try{const de=await ju(ge.clipA,N,L.width,L.height),je=await ju(ge.clipB,N,L.width,L.height);if(de&&je){const Y=await Qa(ge.clipA.id,de),le=await Qa(ge.clipB.id,je),xe=Y.width>0&&Y.height>0?Y:de,ye=le.width>0&&le.height>0?le:je,se=await zK(ge,xe,ye);se&&se.width>0&&se.height>0&&(Re&&(X.fillStyle="#000000",X.fillRect(0,0,L.width,L.height),Re=!1),Jr(X,et,pe,ue,N,L.width,L.height,"below-video"),X.drawImage(se,0,0),Jr(X,et,pe,ue,N,L.width,L.height,"above-video"),ve=!0)}else if(de){const Y=await Qa(ge.clipA.id,de),le=Y.width>0&&Y.height>0?Y:de;Re&&(X.fillStyle="#000000",X.fillRect(0,0,L.width,L.height),Re=!1),Jr(X,et,pe,ue,N,L.width,L.height,"below-video"),X.drawImage(le,0,0),Jr(X,et,pe,ue,N,L.width,L.height,"above-video"),ve=!0}else if(je){const Y=await Qa(ge.clipB.id,je),le=Y.width>0&&Y.height>0?Y:je;Re&&(X.fillStyle="#000000",X.fillRect(0,0,L.width,L.height),Re=!1),Jr(X,et,pe,ue,N,L.width,L.height,"below-video"),X.drawImage(le,0,0),Jr(X,et,pe,ue,N,L.width,L.height,"above-video"),ve=!0}}catch(de){console.warn("[Preview] Transition render failed:",de)}if(!ve){const de=ne.some(Y=>Y.clips.some(le=>N>=le.startTime&&N<le.startTime+le.duration));Re&&(de||pe.length>0||ue.length>0)&&(X.fillStyle=de?"#000000":R?"#0f0f11":"#ffffff",X.fillRect(0,0,L.width,L.height),Re=!1);const je=et.map((Y,le)=>({track:Y,originalIndex:le})).filter(({track:Y})=>(Y.type==="video"||Y.type==="image"||Y.type==="text"||Y.type==="graphics")&&!Y.hidden).sort((Y,le)=>le.originalIndex-Y.originalIndex);for(const{track:Y}of je)if(Y.type==="video"||Y.type==="image")for(const le of Y.clips){const xe=le.startTime,ye=le.startTime+le.duration;if(N>=xe&&N<ye){const se=await ju(le,N,L.width,L.height);if(se){const Me=N-le.startTime;let Le=ea(le.transform,le.keyframes,Me);if(le.emphasisAnimation&&le.emphasisAnimation.type!=="none"){const $e=Pd(le.emphasisAnimation,Me);Le={...Le,opacity:Le.opacity*$e.opacity,scale:{x:Le.scale.x*$e.scale*$e.scaleX,y:Le.scale.y*$e.scale*$e.scaleY},position:{x:Le.position.x+$e.offsetX*L.width,y:Le.position.y+$e.offsetY*L.height},rotation:Le.rotation+$e.rotation}}try{const $e=await Qa(le.id,se);$e.width>0&&$e.height>0?(Ir(X,$e,Le,L.width,L.height,le.blendMode),ve=!0):(Ir(X,se,Le,L.width,L.height,le.blendMode),ve=!0)}catch{Ir(X,se,Le,L.width,L.height,le.blendMode),ve=!0}}}}else if(Y.type==="graphics"){const le=pe.filter(xe=>xe.trackId===Y.id);for(const xe of le)Vl(X,xe,L.width,L.height,N),ve=!0}else if(Y.type==="text"){const le=ue.filter(xe=>xe.trackId===Y.id);for(const xe of le)zl(X,xe,L.width,L.height,N),ve=!0}}const We=Jo(ke,N);if(We.length>0&&X)for(const de of We)Zo(X,de,L.width,L.height,N);return ve&&a.current&&(re.clearRect(0,0,L.width,L.height),re.drawImage(a.current,0,0)),ve},[et,Pe,ju,Ee.width,Ee.height,we,fe,ke,Jr,R]),sv=w.useCallback(N=>{const L=r.current;if(!L)return;(L.width===0||L.height===0)&&(L.width=Ee.width,L.height=Ee.height);const re=L.getContext("2d");if(!re)return;const X=R?"#0f0f11":"#ffffff",ne=R?"#52525b":"#a1a1aa",ve=R?"#ffffff":"#18181b",Re=R?"#a1a1aa":"#71717a",pe=Ka(fe,N),ue=Xa(we,N),We=et.filter(ye=>(ye.type==="video"||ye.type==="image")&&!ye.hidden).some(ye=>ye.clips.some(se=>N>=se.startTime&&N<se.startTime+se.duration));re.fillStyle=We?R?"#18181b":"#f4f4f5":X,re.fillRect(0,0,L.width,L.height);let de=!1;const je=et.map((ye,se)=>({track:ye,originalIndex:se})).filter(({track:ye})=>(ye.type==="video"||ye.type==="image"||ye.type==="text"||ye.type==="graphics")&&!ye.hidden).sort((ye,se)=>se.originalIndex-ye.originalIndex);for(const{track:ye}of je)if(ye.type==="video"||ye.type==="image")for(const se of ye.clips){const Me=se.startTime,Le=se.startTime+se.duration;if(N>=Me&&N<Le){const $e=Pe(se.mediaId);$e?(de=!0,re.fillStyle=ve,re.font="bold 24px Inter, sans-serif",re.textAlign="center",re.fillText($e.name,L.width/2,L.height/2),re.font="16px Inter, sans-serif",re.fillStyle=Re,re.fillText(`${lg(N)} / ${lg(se.duration)}`,L.width/2,L.height/2+30)):se.isPlaceholder&&(de=!0,re.fillStyle=Re,re.font="bold 20px Inter, sans-serif",re.textAlign="center",re.fillText("Drop media here",L.width/2,L.height/2),re.font="14px Inter, sans-serif",re.fillStyle=ne,re.fillText("Replace this placeholder with your content",L.width/2,L.height/2+28))}}else if(ye.type==="graphics"){const se=pe.filter(Me=>Me.trackId===ye.id);for(const Me of se)Vl(re,Me,L.width,L.height,N),de=!0}else if(ye.type==="text"){const se=ue.filter(Me=>Me.trackId===ye.id);for(const Me of se)zl(re,Me,L.width,L.height,N),de=!0}const Y=Jo(ke,N);for(const ye of Y)Zo(re,ye,L.width,L.height,N);const xe=et.filter(ye=>ye.type==="audio"&&!ye.hidden).some(ye=>ye.clips.some(se=>N>=se.startTime&&N<se.startTime+se.duration));!de&&ue.length===0&&pe.length===0&&!xe&&(re.fillStyle=ne,re.font="24px Inter, sans-serif",re.textAlign="center",re.fillText("Import media to get started",L.width/2,L.height/2))},[et,Pe,Ee.width,Ee.height,we,fe,ke,R]),iv=w.useCallback(N=>{const L=et,re=L.filter(pe=>pe.type==="video"&&!pe.hidden),X=[],ne=yc();for(const pe of re)for(const ue of pe.clips)if(ue.startTime+ue.duration>N){const ge=Pe(ue.mediaId);if(ge?.blob&&ge.type==="video"){const We=ne.getClipSpeed(ue.id),de=ne.isReverse(ue.id);if(We!==1||de)return{canUse:!1,clips:[]};X.push({clip:ue,mediaItem:ge})}}if(X.length===0)return{canUse:!1,clips:[]};X.sort((pe,ue)=>pe.clip.startTime-ue.clip.startTime);const ve=L.filter(pe=>pe.type==="image"&&!pe.hidden),Re=[];return ve.forEach(pe=>{const ue=L.indexOf(pe);for(const ge of pe.clips)Re.push({clip:ge,trackIndex:ue})}),{canUse:!0,clips:X,imageClips:Re}},[et,Pe,we,fe]),rv=w.useCallback(async(N,L,re,X)=>{const ne=r.current;if(!ne||N.length===0)return X(),()=>{};const ve=ne.getContext("2d");if(!ve)return X(),()=>{};h.current=!0;const Re=new Map;for(const{clip:se}of L){const Me=Pe(se.mediaId);if(Me?.type==="image"&&Me.blob)try{const Le=await createImageBitmap(Me.blob);Re.set(se.id,Le)}catch(Le){console.warn(`Failed to cache image bitmap for ${se.id}:`,Le)}}await Au();const pe=new Map,ue=[];for(const{clip:se,mediaItem:Me}of N)if(!pe.has(se.mediaId)&&Me.blob){const Le=URL.createObjectURL(Me.blob),$e=document.createElement("video");$e.src=Le,$e.muted=!0,$e.playsInline=!0,$e.preload="auto",pe.set(se.mediaId,{video:$e,url:Le}),ue.push(new Promise((Ze,st)=>{$e.onloadedmetadata=()=>Ze(),$e.onerror=()=>st(new Error(`Video load failed for ${se.mediaId}`)),setTimeout(()=>Ze(),5e3)}))}await Promise.all(ue);const ge=Bh();ge.setDuration(fi),ge.seek(re),f.current||(f.current=eh());const We=f.current;We.setMasterVolume(v?0:1);const de=et.filter(se=>(se.type==="audio"||se.type==="video")&&!se.hidden);for(const se of de)We.createTrack({trackId:se.id,volume:1,pan:0,muted:se.muted||!1,solo:se.solo||!1,effects:[]});await We.resume(),We.seekTo(re),await ge.play(),We.startScheduler(()=>{const se=et.filter(Le=>(Le.type==="audio"||Le.type==="video")&&!Le.hidden),Me=[];for(const Le of se)for(const $e of Le.clips){const Ze=Pe($e.mediaId);if(!(Ze?.type==="audio"||Ze?.type==="video"&&Ze?.metadata?.channels&&Ze.metadata.channels>0))continue;const Lt=g.current.get($e.mediaId);Lt&&Me.push({clipId:$e.id,trackId:Le.id,audioBuffer:Lt,startTime:$e.startTime,endTime:$e.startTime+$e.duration,mediaOffset:$e.inPoint||0,volume:1,pan:0,effects:[],speed:$e.speed??1})}return Me});let je=!0,Y=null;const le=se=>{const Me=[];for(const{clip:Le,mediaItem:$e}of N)if(se>=Le.startTime&&se<Le.startTime+Le.duration){const Ze=(()=>{for(let st=0;st<At.current.length;st++)if(At.current[st].clips.some(gt=>gt.id===Le.id))return st;return-1})();Me.push({clip:Le,mediaItem:$e,trackIndex:Ze})}return Me.sort((Le,$e)=>$e.trackIndex-Le.trackIndex)},xe=async()=>{if(!je||!h.current)return;const se=ge.currentTime;if(se>=fi){ye(),ht(0),Bo.current=0,X();return}if(!ge.isPlaying){ye(),Hi.current||X();return}const Me=le(se);if(Me.length===0){ve.fillStyle="#000000",ve.fillRect(0,0,ne.width,ne.height);const Xe=[...L].sort(($t,Ke)=>Ke.trackIndex-$t.trackIndex);for(const{clip:$t}of Xe)if(se>=$t.startTime&&se<$t.startTime+$t.duration){const Ke=Re.get($t.id);if(Ke){const jt=(()=>{for(const Fa of At.current){const zo=Fa.clips.find(cv=>cv.id===$t.id);if(zo)return zo}return $t})(),us=se-$t.startTime,os=ea(jt.transform||Bi,jt.keyframes,us);Ir(ve,Ke,os,ne.width,ne.height,jt.blendMode)}}const js=Ka(ri.current,se),gi=Xa(mi.current,se);(js.length>0||gi.length>0)&&Jr(ve,At.current,js,gi,se,ne.width,ne.height,"all");const ws=Jo(ke,se);for(const $t of ws)Zo(ve,$t,ne.width,ne.height,se);const _s=performance.now();_s-te.current>=Ve&&(te.current=_s,ht(se)),Y=requestAnimationFrame(()=>{xe()});return}ve.fillStyle="#000000",ve.fillRect(0,0,ne.width,ne.height);const Le=[];for(const{clip:Xe,trackIndex:js}of Me){const gi=pe.get(Xe.mediaId);if(!gi)continue;const{video:ws}=gi;ws.paused&&ws.play().catch(()=>{});const _s=se-Xe.startTime;let $t=(Xe.inPoint||0)+_s;if(ws.duration>0&&$t>=ws.duration){const os=ws.duration-(Xe.inPoint||0);os>0?$t=(Xe.inPoint||0)+_s%os:$t=Xe.inPoint||0}Math.abs(ws.currentTime-$t)>.1&&(ws.currentTime=$t);const jt=(()=>{for(const os of At.current){const Fa=os.clips.find(zo=>zo.id===Xe.id);if(Fa)return Fa}return Xe})();let us=ea(jt.transform||Bi,jt.keyframes,_s);if(jt.emphasisAnimation&&jt.emphasisAnimation.type!=="none"){const os=Pd(jt.emphasisAnimation,_s);us={...us,opacity:us.opacity*os.opacity,scale:{x:us.scale.x*os.scale*os.scaleX,y:us.scale.y*os.scale*os.scaleY},position:{x:us.position.x+os.offsetX*ne.width,y:us.position.y+os.offsetY*ne.height},rotation:us.rotation+os.rotation}}Le.push({type:"video",trackIndex:js,render:async()=>{try{const os=await createImageBitmap(ws),Fa=await Qa(Xe.id,os);Ir(ve,Fa,us,ne.width,ne.height,jt.blendMode)}catch{Ir(ve,ws,us,ne.width,ne.height,jt.blendMode)}}})}for(const{clip:Xe,trackIndex:js}of L)if(se>=Xe.startTime&&se<Xe.startTime+Xe.duration){const gi=Re.get(Xe.id);gi&&Le.push({type:"image",trackIndex:js,render:()=>{const ws=(()=>{for(const Ke of At.current){const jt=Ke.clips.find(us=>us.id===Xe.id);if(jt)return jt}return Xe})(),_s=se-Xe.startTime,$t=ea(ws.transform||Bi,ws.keyframes,_s);Ir(ve,gi,$t,ne.width,ne.height,ws.blendMode)}})}Le.sort((Xe,js)=>js.trackIndex-Xe.trackIndex);for(const Xe of Le)await Xe.render();const $e=ri.current,Ze=Ka($e,se),st=Xa(mi.current,se);(Ze.length>0||st.length>0)&&Jr(ve,At.current,Ze,st,se,ne.width,ne.height,"all");const Lt=Jo(ke,se);for(const Xe of Lt)Zo(ve,Xe,ne.width,ne.height,se);const gt=performance.now();gt-te.current>=Ve&&(te.current=gt,ht(se)),Y=requestAnimationFrame(()=>{xe()})},ye=()=>{je=!1,h.current=!1,Y&&cancelAnimationFrame(Y);for(const[,{video:se,url:Me}]of pe)se.pause(),se.src="",URL.revokeObjectURL(Me);pe.clear();for(const[,se]of Re)se.close();Re.clear(),l.current=null,u.current=null,ge.stop(),We.stopScheduler()};return Y=requestAnimationFrame(()=>{xe()}),ye},[fi,ke,Pe,v,Au,ht,et]);w.useEffect(()=>{const N=r.current;if(!N)return;if((N.width===0||N.height===0)&&(N.width=Ee.width,N.height=Ee.height),!vt){s.current&&(cancelAnimationFrame(s.current),s.current=null),Da(),Lo();return}if(fi<=0){Ie();return}let L=!0,re=null;const X=Bo.current,ne=Y=>{const le=At.current,xe=[];return le.forEach((ye,se)=>{if((ye.type==="video"||ye.type==="image")&&!ye.hidden)for(const Me of ye.clips)Y>=Me.startTime&&Y<Me.startTime+Me.duration&&xe.push({clip:Me,track:ye,trackIndex:se})}),xe.sort((ye,se)=>ye.trackIndex-se.trackIndex)},ve=async(Y,le)=>{const xe=Pe(Y.mediaId);if(!xe?.blob||xe.type==="image")return null;try{const ye=await hi(()=>import("./index2.js"),[]),{Input:se,ALL_FORMATS:Me,BlobSource:Le,CanvasSink:$e}=ye,Ze=new se({source:new Le(xe.blob),formats:Me}),st=await Ze.getPrimaryVideoTrack();if(!st||!await st.canDecode())return Ze[Symbol.dispose]?.(),null;const gt=Ee.width||1920,Xe=Ee.height||1080,js=new $e(st,{width:gt,height:Xe,fit:"contain",poolSize:ZK(gt,Xe)});return{input:Ze,sink:js,mediaId:Y.mediaId,clipId:Y.id,trackIndex:le}}catch(ye){return console.error(`[Preview] Failed to init resources for clip ${Y.id}:`,ye),null}},Re=async()=>{const le=At.current.filter(xe=>xe.type==="image"&&!xe.hidden);for(const xe of le)for(const ye of xe.clips){if(hl.current.has(ye.id))continue;const se=Pe(ye.mediaId);if(se?.type==="image"&&se.blob)try{const Me=await createImageBitmap(se.blob);hl.current.set(ye.id,Me)}catch(Me){console.warn(`[Preview] Failed to pre-cache image clip ${ye.id}:`,Me)}}},pe=async()=>{const Y=ne(X),le=Xa(mi.current,X),xe=Ka(ri.current,X),se=At.current.filter(Ke=>Ke.type==="audio"&&!Ke.hidden).some(Ke=>Ke.clips.some(jt=>X>=jt.startTime&&X<jt.startTime+jt.duration));if(!(Y.length>0||le.length>0||xe.length>0||se)&&fi<=0){Ie();return}await Re();for(const{clip:Ke,trackIndex:jt}of Y)if(!_r.current.has(Ke.id)){const us=await ve(Ke,jt);us&&_r.current.set(Ke.id,us)}const $e=le.length>0||xe.length>0;if(_r.current.size===0&&!$e&&!se&&fi<=0){Ie();return}await Au(),f.current||(f.current=eh());const Ze=f.current;Ze.setMasterVolume(v?0:1);const st=At.current.filter(Ke=>(Ke.type==="audio"||Ke.type==="video")&&!Ke.hidden);for(const Ke of st)Ze.createTrack({trackId:Ke.id,volume:1,pan:0,muted:Ke.muted||!1,solo:Ke.solo||!1,effects:[]});await Ze.resume();const Lt=N.getContext("2d");if(!Lt){console.error("[Preview] Failed to get 2D context"),Ie();return}(!a.current||a.current.width!==N.width||a.current.height!==N.height)&&(a.current=new OffscreenCanvas(N.width,N.height),o.current=a.current.getContext("2d"));const gt=o.current;if(!gt){console.error("[Preview] Failed to get offscreen 2D context"),Ie();return}const Xe=Bh();Xe.setDuration(fi),Xe.seek(X),Ze.seekTo(X),await Xe.play(),Ze.startScheduler(tv);const js=1e3/30;let gi=performance.now(),ws=0,_s=!1;const $t=async()=>{if(!L){Da(),Xe.pause();return}if(_s)return;_s=!0;const Ke=Xe.currentTime;try{if(Ke>=fi){_s=!1,Da(),Lo(),Xe.stop(),ht(0),Bo.current=0,Ie();return}if(!Xe.isPlaying){_s=!1,Da(),Lo(),Hi.current||Ie();return}const jt=ne(Ke),us=Xa(mi.current,Ke),os=Ka(ri.current,Ke),zo=At.current.filter(nt=>nt.type==="audio"&&!nt.hidden).some(nt=>nt.clips.some(Es=>Ke>=Es.startTime&&Ke<Es.startTime+Es.duration));if(!(jt.length>0||us.length>0||os.length>0||zo)){const nt=ue(Ke),Es=ge(Ke),yr=We(Ke),Is=de(Ke),hs=[nt,Es,yr,Is].filter(Vo=>Vo!==null&&Vo<fi),gl=hs.length>0?Math.min(...hs):null;if(gl!==null){Xe.seek(gl),Ze.seekTo(gl),_s=!1,s.current=requestAnimationFrame($t);return}else{_s=!1,Da(),Lo(),Hi.current||(Xe.stop(),ht(0),Bo.current=0,Ie());return}}for(const{clip:nt,trackIndex:Es}of jt)if(!_r.current.has(nt.id)){const yr=await ve(nt,Es);yr&&_r.current.set(nt.id,yr)}const EN=new Set(jt.map(nt=>nt.clip.id));for(const[nt,Es]of _r.current)EN.has(nt)||(Es.input[Symbol.dispose]?.(),_r.current.delete(nt));const MN=[...jt].sort((nt,Es)=>Es.trackIndex-nt.trackIndex),lv=[],dv=[];for(const{clip:nt,track:Es}of MN){if(!L)continue;const yr=Ke-nt.startTime;let Is=ea(nt.transform||Bi,nt.keyframes,yr);if(nt.emphasisAnimation&&nt.emphasisAnimation.type!=="none"){const hs=Pd(nt.emphasisAnimation,yr);Is={...Is,opacity:Is.opacity*hs.opacity,scale:{x:Is.scale.x*hs.scale*hs.scaleX,y:Is.scale.y*hs.scale*hs.scaleY},position:{x:Is.position.x+hs.offsetX*N.width,y:Is.position.y+hs.offsetY*N.height},rotation:Is.rotation+hs.rotation}}if(Es.type==="image"){const hs=hl.current.get(nt.id);hs&&lv.push({clip:nt,transform:Is,frame:hs});continue}dv.push((async()=>{const hs=_r.current.get(nt.id);if(!hs)return null;const Vo=yc().getSourceTimeAtPlaybackTime(nt.id,yr),mt=(nt.inPoint||0)+Vo;try{const ps=await hs.sink.getCanvas(mt);if(!L)return null;if(ps?.canvas){let zt=ps.canvas;try{const ks=await createImageBitmap(ps.canvas);zt=await Qa(nt.id,ks)}catch{}return{clip:nt,transform:Is,frame:zt}}}catch(ps){if((ps instanceof Error?ps.message:String(ps)).includes("disposed")||!L)return null;console.warn(`[Preview] Failed to get frame for clip ${nt.id}:`,ps)}return null})())}const PN=(await Promise.all(dv)).filter(nt=>nt!==null),_u=[...lv,...PN];if(_u.length>0||us.length>0||os.length>0){gt.fillStyle="#000000",gt.fillRect(0,0,N.width,N.height);const nt=Ka(ri.current,Ke),Es=Xa(mi.current,Ke),yr=At.current,Is=new Map;yr.forEach((mt,ps)=>{if((mt.type==="video"||mt.type==="image")&&!mt.hidden)for(const zt of mt.clips)Is.set(zt.id,ps)});const hs=yr.map((mt,ps)=>({track:mt,originalIndex:ps})).filter(({track:mt})=>(mt.type==="video"||mt.type==="image"||mt.type==="text"||mt.type==="graphics")&&!mt.hidden).sort((mt,ps)=>ps.originalIndex-mt.originalIndex);if(y.current&&y.current.type==="webgpu"){const mt=[],ps=[];for(const{track:zt,originalIndex:ks}of hs)if(zt.type==="video"){const rn=_u.filter(ai=>Is.get(ai.clip.id)===ks);for(const{transform:ai,frame:Mr}of rn)Mr instanceof ImageBitmap&&mt.push({bitmap:Mr,transform:ai})}else if(zt.type==="image"){const rn=_u.filter(ai=>Is.get(ai.clip.id)===ks);for(const{transform:ai,frame:Mr}of rn)Ir(gt,Mr,ai,N.width,N.height)}else if(zt.type==="graphics"){const rn=nt.filter(ai=>ai.trackId===zt.id);for(const ai of rn){const Mr=new OffscreenCanvas(N.width,N.height),yl=Mr.getContext("2d");if(yl){Vl(yl,ai,N.width,N.height,Ke);const xl=await createImageBitmap(Mr);ps.push(xl),mt.push({bitmap:xl,transform:{...Bi,opacity:1,scale:{x:1,y:1},position:{x:0,y:0},anchor:{x:0,y:0}}})}}}else if(zt.type==="text"){const rn=Es.filter(ai=>ai.trackId===zt.id);for(const ai of rn){const Mr=new OffscreenCanvas(N.width,N.height),yl=Mr.getContext("2d");if(yl){zl(yl,ai,N.width,N.height,Ke);const xl=await createImageBitmap(Mr);ps.push(xl),mt.push({bitmap:xl,transform:{...Bi,opacity:1,scale:{x:1,y:1},position:{x:0,y:0},anchor:{x:0,y:0}}})}}}if(mt.length>0){const zt=await eQ(y.current,mt,N.width,N.height);if(zt)gt.drawImage(zt,0,0),zt.close();else for(const ks of mt)Ir(gt,ks.bitmap,ks.transform,N.width,N.height)}for(const zt of ps)zt.close()}else for(const{track:mt,originalIndex:ps}of hs)if(mt.type==="video"||mt.type==="image"){const zt=_u.filter(ks=>Is.get(ks.clip.id)===ps);for(const{transform:ks,frame:rn}of zt)Ir(gt,rn,ks,N.width,N.height)}else if(mt.type==="graphics"){const zt=nt.filter(ks=>ks.trackId===mt.id);for(const ks of zt)Vl(gt,ks,N.width,N.height,Ke)}else if(mt.type==="text"){const zt=Es.filter(ks=>ks.trackId===mt.id);for(const ks of zt)zl(gt,ks,N.width,N.height,Ke)}const Vo=Jo(qi.current,Ke);for(const mt of Vo)Zo(gt,mt,N.width,N.height,Ke);Lt.drawImage(a.current,0,0);try{n.current?.close(),n.current=await createImageBitmap(a.current)}catch{}}else if(n.current){gt.drawImage(n.current,0,0,N.width,N.height);const nt=Jo(qi.current,Ke);for(const Es of nt)Zo(gt,Es,N.width,N.height,Ke);Lt.drawImage(a.current,0,0)}ws++,Xe.reportVideoTime(Ke);const uv=performance.now();uv-te.current>=Ve&&(te.current=uv,ht(Ke));const hv=performance.now(),NN=hv-gi,RN=js/ev.current,pv=Math.max(0,RN-NN);gi=hv,_s=!1,L&&(pv>0?setTimeout(()=>{L&&(s.current=requestAnimationFrame($t))},pv):s.current=requestAnimationFrame($t))}catch(jt){_s=!1,console.error("[Preview] Multi-track frame error:",jt),Da(),Ie()}};s.current=requestAnimationFrame($t)},ue=Y=>{const xe=At.current.filter(se=>(se.type==="video"||se.type==="image")&&!se.hidden);let ye=null;for(const se of xe)for(const Me of se.clips)Me.startTime>Y&&(ye===null||Me.startTime<ye)&&(ye=Me.startTime);return ye},ge=Y=>{const le=mi.current;let xe=null;for(const ye of le)ye.startTime>Y&&(xe===null||ye.startTime<xe)&&(xe=ye.startTime);return xe},We=Y=>{const le=ri.current;let xe=null;for(const ye of le)ye.startTime>Y&&(xe===null||ye.startTime<xe)&&(xe=ye.startTime);return xe},de=Y=>{const xe=At.current.filter(se=>se.type==="audio"&&!se.hidden);let ye=null;for(const se of xe)for(const Me of se.clips)Me.startTime>Y&&(ye===null||Me.startTime<ye)&&(ye=Me.startTime);return ye};return(async()=>{const Y=iv(X);if(Y.canUse&&Y.clips.length>0)try{return re=await rv(Y.clips,Y.imageClips||[],X,()=>Ie()),re}catch(le){console.warn("[Preview] Native video playback failed, falling back to MediaBunny:",le)}await pe()})().catch(Y=>{console.error("[Preview] startPlayback error:",Y)}),()=>{L=!1,h.current=!1;const Y=Bh();(Y.isPlaying||Y.isPaused)&&(Bo.current=Y.currentTime),re&&(re(),re=null),s.current&&(cancelAnimationFrame(s.current),s.current=null),l.current&&(l.current.pause(),l.current.src="",l.current=null),d.current&&(URL.revokeObjectURL(d.current),d.current=null),Y.pause(),Lo()}},[vt,iv,rv,fi,ht,Ie,Pe,Da,Lo,cN,Au,tv,v,Ee.width,Ee.height]);const nv=w.useRef(ie.modifiedAt);w.useEffect(()=>{if(vt)return;if(G.current){nv.current=ie.modifiedAt;return}if(nv.current=ie.modifiedAt,!r.current)return;(async()=>{await Oo(Bt)||sv(Bt)})()},[Bt,vt,Oo,sv,ie.modifiedAt,R]);const hm=w.useMemo(()=>vs.find(L=>L.type==="clip")?.id||null,[vs]),Zr=w.useMemo(()=>{if(!hm)return null;for(const N of et){const L=N.clips.find(re=>re.id===hm);if(L)return L}return null},[hm,et]),Rn=w.useMemo(()=>{const N=et.filter(L=>(L.type==="video"||L.type==="image")&&!L.hidden);for(const L of N)for(const re of L.clips){const X=re.startTime,ne=re.startTime+re.duration;if(Bt>=X&&Bt<ne)return re}return null},[et,Bt]),pm=w.useMemo(()=>vs.find(L=>L.type==="text-clip")?.id||null,[vs]),pl=w.useMemo(()=>pm&&we.find(N=>N.id===pm)||null,[pm,we]),Er=pl,en=w.useMemo(()=>{const N=Zr||Rn;if(!N||!r.current||!t.current)return null;const L=r.current,X=t.current.getBoundingClientRect(),ne=L.getBoundingClientRect(),ve=N.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,anchor:{x:.5,y:.5}},Re=q?{...ve,position:q.position,scale:q.scale}:ve,pe=Ee.width,ue=Ee.height,ge=pe/ue,We=ne.width/ne.height;let de,je,Y=0,le=0;We>ge?(je=ne.height,de=je*ge,Y=(ne.width-de)/2):(de=ne.width,je=de/ge,le=(ne.height-je)/2);const xe=de/pe,ye=pe*Re.scale.x*xe,se=ue*Re.scale.y*xe,Me=Re.position.x*xe,Le=Re.position.y*xe,$e=ne.left-X.left+Y,Ze=ne.top-X.top+le,st=$e+de/2+Me,Lt=Ze+je/2+Le;return{x:st-ye/2,y:Lt-se/2,width:ye,height:se,centerX:st,centerY:Lt,displayScale:xe}},[Zr,Rn,Ee.width,Ee.height,C,q]),tn=w.useMemo(()=>{if(!pl||!r.current||!t.current)return null;const N=r.current,re=t.current.getBoundingClientRect(),X=N.getBoundingClientRect(),{transform:ne,style:ve,text:Re}=pl,pe=Ee.width,ue=Ee.height,ge=pe/ue,We=X.width/X.height;let de,je,Y=0,le=0;We>ge?(je=X.height,de=je*ge,Y=(X.width-de)/2):(de=X.width,je=de/ge,le=(X.height-je)/2);const xe=de/pe,ye=Re.split(`
`),se=ve.fontSize*ve.lineHeight,Me=ye.length*se,$e=ve.fontSize*Math.max(...ye.map(ws=>ws.length))*.6*ne.scale.x*xe,Ze=Me*ne.scale.y*xe,st=ne.position.x*pe*xe,Lt=ne.position.y*ue*xe,gt=X.left-re.left+Y,Xe=X.top-re.top+le,js=gt+st,gi=Xe+Lt;return{x:js-$e/2,y:gi-Ze/2,width:$e,height:Ze,centerX:js,centerY:gi,displayScale:xe,isTextClip:!0}},[pl,Ee.width,Ee.height,C]),mm=w.useMemo(()=>vs.find(L=>L.type==="shape-clip")?.id||null,[vs]),ml=w.useMemo(()=>mm&&fe.find(N=>N.id===mm)||null,[mm,fe]),sn=ml,In=w.useMemo(()=>{if(!ml||!r.current||!t.current)return null;const N=r.current,re=t.current.getBoundingClientRect(),X=N.getBoundingClientRect(),{transform:ne}=ml,ve=200,Re=Ee.width,pe=Ee.height,ue=Re/pe,ge=X.width/X.height;let We,de,je=0,Y=0;ge>ue?(de=X.height,We=de*ue,je=(X.width-We)/2):(We=X.width,de=We/ue,Y=(X.height-de)/2);const le=We/Re,xe=ve*ne.scale.x*le,ye=ve*ne.scale.y*le,se=ne.position.x*Re*le,Me=ne.position.y*pe*le,Le=X.left-re.left+je,$e=X.top-re.top+Y,Ze=Le+se,st=$e+Me;return{x:Ze-xe/2,y:st-ye/2,width:xe,height:ye,centerX:Ze,centerY:st,displayScale:le,isShapeClip:!0}},[ml,Ee.width,Ee.height,C]),fm=w.useMemo(()=>vs.find(L=>L.type==="subtitle")?.id||null,[vs]),Dn=w.useMemo(()=>fm&&ke.find(N=>N.id===fm)||null,[fm,ke]),$o=w.useMemo(()=>{if(!Dn||!r.current||!t.current||Bt<Dn.startTime||Bt>=Dn.endTime)return null;const N=r.current,re=t.current.getBoundingClientRect(),X=N.getBoundingClientRect(),ne=Dn.style?.fontSize||24,ve=Dn.style?.position||"bottom",Re=Dn.text.split(`
`),pe=ne*1.3,ue=Re.length*pe,ge=Ee.width,We=Ee.height,de=ge/We,je=X.width/X.height;let Y,le,xe=0,ye=0;je>de?(le=X.height,Y=le*de,xe=(X.width-Y)/2):(Y=X.width,le=Y/de,ye=(X.height-le)/2);const se=Y/ge;let Me;ve==="top"?Me=ne*2:ve==="center"?Me=We/2-ue/2:Me=We-ne*2-ue;const Le=ge*.8*se,$e=ue*se,Ze=X.left-re.left+xe,st=X.top-re.top+ye,Lt=Ze+Y/2,gt=st+Me*se;return{x:Lt-Le/2,y:gt,width:Le,height:$e,centerX:Lt,centerY:gt+$e/2,displayScale:se}},[Dn,Ee.width,Ee.height,C,Bt]),Fn=w.useCallback((N,L)=>{N.stopPropagation(),N.preventDefault();const re=Zr||Rn;if(!re)return;const X=re.transform||{position:{x:0,y:0},scale:{x:1,y:1}};G.current=!0,O("resize"),I(L),P.current={x:N.clientX,y:N.clientY,transform:{x:X.position.x,y:X.position.y,scaleX:X.scale.x,scaleY:X.scale.y}}},[Zr,Rn]),lN=w.useCallback(N=>{N.stopPropagation(),N.preventDefault();const L=Zr||Rn;if(!L)return;const re=L.transform||{position:{x:0,y:0},scale:{x:1,y:1}};G.current=!0,O("move"),P.current={x:N.clientX,y:N.clientY,transform:{x:re.position.x,y:re.position.y,scaleX:re.scale.x,scaleY:re.scale.y}}},[Zr,Rn]),dN=w.useCallback(N=>{if(N.stopPropagation(),N.preventDefault(),!Er)return;const{transform:L}=Er;G.current=!0,O("move"),he("text-clip"),Se.current=Er.id,P.current={x:N.clientX,y:N.clientY,transform:{x:L.position.x,y:L.position.y,scaleX:L.scale.x,scaleY:L.scale.y}}},[Er]),Bn=w.useCallback((N,L)=>{if(N.stopPropagation(),N.preventDefault(),!Er)return;const{transform:re}=Er;G.current=!0,O("resize"),I(L),he("text-clip"),Se.current=Er.id,P.current={x:N.clientX,y:N.clientY,transform:{x:re.position.x,y:re.position.y,scaleX:re.scale.x,scaleY:re.scale.y}}},[Er]),uN=w.useCallback(N=>{if(N.stopPropagation(),N.preventDefault(),!sn)return;const{transform:L}=sn;G.current=!0,O("move"),he("shape-clip"),Se.current=sn.id,P.current={x:N.clientX,y:N.clientY,transform:{x:L.position.x,y:L.position.y,scaleX:L.scale.x,scaleY:L.scale.y}}},[sn]),Ln=w.useCallback((N,L)=>{if(N.stopPropagation(),N.preventDefault(),!sn)return;const{transform:re}=sn;G.current=!0,O("resize"),I(L),he("shape-clip"),Se.current=sn.id,P.current={x:N.clientX,y:N.clientY,transform:{x:re.position.x,y:re.position.y,scaleX:re.scale.x,scaleY:re.scale.y}}},[sn]),hN=w.useCallback(N=>{if(B==="none"||!P.current)return;if(V==="text-clip"&&tn&&Er){const pe=N.clientX-P.current.x,ue=N.clientY-P.current.y,{displayScale:ge}=tn;let We={};if(B==="move"){const de=P.current.transform.x+pe/ge/Ee.width,je=P.current.transform.y+ue/ge/Ee.height;We={position:{x:de,y:je}}}else if(B==="resize"&&F){const de=P.current.transform;let je=de.scaleX,Y=de.scaleY;const le=pe/ge/100,xe=ue/ge/100;switch(F){case"e":case"se":case"ne":je=Math.max(.1,de.scaleX+le),K&&(Y=je);break;case"w":case"sw":case"nw":je=Math.max(.1,de.scaleX-le),K&&(Y=je);break;case"s":Y=Math.max(.1,de.scaleY+xe),K&&(je=Y);break;case"n":Y=Math.max(.1,de.scaleY-xe),K&&(je=Y);break}We={position:{x:de.x,y:de.y},scale:{x:je,y:Y}}}z.current||(z.current=requestAnimationFrame(()=>{const de=performance.now();de-ce.current>=ae&&Se.current&&(ce.current=de,Je(Se.current,We)),z.current=null}));return}if(V==="shape-clip"&&In&&sn){const pe=N.clientX-P.current.x,ue=N.clientY-P.current.y,{displayScale:ge}=In;let We={};if(B==="move"){const de=P.current.transform.x+pe/ge/Ee.width,je=P.current.transform.y+ue/ge/Ee.height;We={position:{x:de,y:je}}}else if(B==="resize"&&F){const de=P.current.transform;let je=de.scaleX,Y=de.scaleY;const le=pe/ge/100,xe=ue/ge/100;switch(F){case"e":case"se":case"ne":je=Math.max(.1,de.scaleX+le),K&&(Y=je);break;case"w":case"sw":case"nw":je=Math.max(.1,de.scaleX-le),K&&(Y=je);break;case"s":Y=Math.max(.1,de.scaleY+xe),K&&(je=Y);break;case"n":Y=Math.max(.1,de.scaleY-xe),K&&(je=Y);break}We={position:{x:de.x,y:de.y},scale:{x:je,y:Y}}}z.current||(z.current=requestAnimationFrame(()=>{const de=performance.now();de-ce.current>=ae&&Se.current&&(ce.current=de,Tt(Se.current,We)),z.current=null}));return}if(!en)return;const L=Zr||Rn;if(!L)return;const re=N.clientX-P.current.x,X=N.clientY-P.current.y,{displayScale:ne}=en;let ve={};if(B==="move"){const pe=P.current.transform.x+re/ne,ue=P.current.transform.y+X/ne;ve={position:{x:pe,y:ue}}}else if(B==="resize"&&F){const pe=P.current.transform;let ue=pe.scaleX,ge=pe.scaleY,We=pe.x,de=pe.y;const je=re/ne/(Ee.width/2),Y=X/ne/(Ee.height/2);switch(F){case"e":ue=Math.max(.1,pe.scaleX+je),K&&(ge=ue);break;case"w":ue=Math.max(.1,pe.scaleX-je),K&&(ge=ue),We=pe.x+re/ne/2;break;case"s":ge=Math.max(.1,pe.scaleY+Y),K&&(ue=ge);break;case"n":ge=Math.max(.1,pe.scaleY-Y),K&&(ue=ge),de=pe.y+X/ne/2;break;case"se":if(K){const le=(je+Y)/2;ue=Math.max(.1,pe.scaleX+le),ge=ue}else ue=Math.max(.1,pe.scaleX+je),ge=Math.max(.1,pe.scaleY+Y);break;case"sw":if(K){const le=(-je+Y)/2;ue=Math.max(.1,pe.scaleX+le),ge=ue}else ue=Math.max(.1,pe.scaleX-je),ge=Math.max(.1,pe.scaleY+Y);We=pe.x+re/ne/2;break;case"ne":if(K){const le=(je-Y)/2;ue=Math.max(.1,pe.scaleX+le),ge=ue}else ue=Math.max(.1,pe.scaleX+je),ge=Math.max(.1,pe.scaleY-Y);de=pe.y+X/ne/2;break;case"nw":if(K){const le=(-je-Y)/2;ue=Math.max(.1,pe.scaleX+le),ge=ue}else ue=Math.max(.1,pe.scaleX-je),ge=Math.max(.1,pe.scaleY-Y);We=pe.x+re/ne/2,de=pe.y+X/ne/2;break}ve={position:{x:We,y:de},scale:{x:ue,y:ge}}}W.current={clipId:L.id,transform:ve};const Re=L.transform||{position:{x:0,y:0},scale:{x:1,y:1}};oe({position:ve.position||Re.position,scale:ve.scale||Re.scale}),z.current||(z.current=requestAnimationFrame(()=>{const pe=performance.now();W.current&&pe-ce.current>=ae&&(ce.current=pe,Ge(W.current.clipId,W.current.transform)),z.current=null}))},[B,F,en,Zr,Rn,Ge,Ee.width,Ee.height,K,V,tn,Er,Je]),pN=w.useCallback(()=>{W.current&&(Ge(W.current.clipId,W.current.transform),W.current=null),he(null),Se.current=null,z.current&&(cancelAnimationFrame(z.current),z.current=null);const N=G.current;G.current=!1,O("none"),I(null),P.current=null,oe(null),N&&Oo(Bt)},[Ge,Oo,Bt]),mN=w.useCallback(N=>{qs&&Ge(qs,{crop:N})},[qs,Ge]),fN=w.useCallback(()=>{Kr(!1)},[Kr]),gN=w.useCallback(()=>{Kr(!1)},[Kr]);w.useEffect(()=>{if(B!=="none"){const N=()=>{W.current&&(Ge(W.current.clipId,W.current.transform),W.current=null),z.current&&(cancelAnimationFrame(z.current),z.current=null);const L=G.current;G.current=!1,O("none"),I(null),P.current=null,oe(null),L&&Oo(Bt)};return window.addEventListener("mouseup",N),()=>window.removeEventListener("mouseup",N)}},[B,Oo,Bt,Ge]);const yN=w.useCallback(N=>{const L=N.currentTarget.getBoundingClientRect(),re=N.clientX-L.left,ne=Math.max(0,Math.min(1,re/L.width))*(fi||10);kt(ne)},[fi,kt]),xN=w.useCallback(()=>{tt(-5)},[tt]),bN=w.useCallback(()=>{tt(5)},[tt]),vN=w.useCallback(()=>{const N=e.current;N&&(document.fullscreenElement?document.exitFullscreen().then(()=>{D(!1)}).catch(L=>{console.error("Error exiting fullscreen:",L)}):N.requestFullscreen().then(()=>{D(!0)}).catch(L=>{console.error("Error entering fullscreen:",L)}))},[]),wN=w.useCallback(()=>{M(N=>!N)},[]);w.useEffect(()=>{const N=()=>{D(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",N),()=>document.removeEventListener("fullscreenchange",N)},[]);const kN=fi>0?Bt/fi*100:0,CN=!vt&&Zr&&en,SN=!vt&&pl&&tn,TN=!vt&&ml&&In,AN=!vt&&Dn&&$o,fl=w.useMemo(()=>{if(!ni||!qs)return null;for(const N of et){const L=N.clips.find(re=>re.id===qs);if(L)return L}return null},[ni,qs,et]),av=w.useMemo(()=>{if(!ni||!qs||!fl)return null;const N=Pe(fl.mediaId);if(!N)return null;let L=null;return N.blob?L=URL.createObjectURL(N.blob):N.originalUrl&&(L=N.originalUrl),L?{src:L,type:N.type}:null},[ni,qs,fl,Pe]),ov=av?.src??null,jN=av?.type??"video",_N=ni&&qs&&fl&&ov;return c.jsxs("div",{ref:e,"data-tour":"preview",className:"flex-1 bg-background flex flex-col relative group overflow-hidden",children:[_N&&c.jsx(UK,{clip:fl,videoSrc:ov,mediaType:jN,currentTime:Bt,canvasWidth:C.width,canvasHeight:C.height,onCropChange:mN,onComplete:fN,onCancel:gN}),c.jsx("div",{className:`flex-1 relative flex items-center justify-center bg-background-secondary/30 transition-all duration-300 ${_||E?"p-0":"p-4"}`,onMouseMove:B!=="none"?hN:void 0,onMouseUp:pN,children:c.jsxs("div",{ref:t,className:`relative bg-black overflow-hidden transition-all duration-300 ${_||E?"rounded-none ring-0 shadow-none":"shadow-2xl rounded-xl ring-1 ring-border shadow-[0_0_50px_rgba(0,0,0,0.5)]"}`,style:_||E?{width:"100%",height:"100%",maxWidth:"none"}:{height:"450px",width:`calc(450px * ${Ee.width} / ${Ee.height})`,maxWidth:"800px"},children:[c.jsx("canvas",{ref:r,width:Ee.width,height:Ee.height,className:"w-full h-full object-contain bg-black",style:{cursor:"default"}}),c.jsx(JK,{}),c.jsxs("div",{className:"absolute top-2 left-2 bg-black/70 backdrop-blur-sm px-2 py-1 rounded text-[10px] font-mono text-white/90 pointer-events-none z-10 border border-white/10",children:[Ee.width,"",Ee.height,c.jsxs("span",{className:"text-white/60 ml-1.5",children:["(",(Ee.width/Ee.height).toFixed(2),")"]})]}),Do&&gr&&pt&&c.jsx("div",{className:"absolute inset-0 pointer-events-auto z-30",children:c.jsx(WK,{config:gr,canvasWidth:Ee.width,canvasHeight:Ee.height,currentTime:Bt-pt.startTime,clipDuration:pt.duration,onPointMove:dm,onPointAdd:Qb,onPointRemove:Fo,onControlPointMove:um,disabled:vt})}),Zb.length>0&&c.jsx("div",{className:"absolute inset-0 pointer-events-none z-20",children:c.jsx(qK,{effects:Zb,width:Ee.width,height:Ee.height,currentTime:Bt,isPlaying:vt})}),Pn.isExporting&&c.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-background-secondary/95 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-border",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center",children:c.jsx(_i,{size:20,className:"text-primary animate-spin"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Exporting Video"}),c.jsx("p",{className:"text-xs text-text-muted",children:Pn.phase||"Preparing..."})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Export Progress"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(Pn.progress),"%"]})]}),c.jsx("div",{className:"h-2 bg-black/30 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-primary-hover transition-all duration-300",style:{width:`${Pn.progress}%`}})})]}),c.jsx("p",{className:"text-[10px] text-text-muted text-center",children:"Please wait while your video is being exported..."})]})}),!ni&&CN&&en&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:en.x,top:en.y,width:en.width,height:en.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-primary pointer-events-none"}),c.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-primary/80 rounded-full flex items-center justify-center cursor-move pointer-events-auto hover:bg-primary transition-colors",onMouseDown:lN,title:"Drag to move",children:c.jsx(ua,{size:14,className:"text-white"})}),c.jsx("button",{className:`absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 text-[10px] rounded pointer-events-auto transition-colors ${K?"bg-primary text-white":"bg-background-tertiary text-text-secondary border border-border hover:bg-background-elevated"}`,onClick:()=>ee(!K),title:K?"Unlock aspect ratio":"Lock aspect ratio",children:K?" Locked":" Free"}),c.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-nw-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"nw")}),c.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-ne-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"ne")}),c.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-sw-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"sw")}),c.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-se-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"se")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-6 h-4 bg-white border-2 border-primary rounded-sm cursor-n-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"n")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-6 h-4 bg-white border-2 border-primary rounded-sm cursor-s-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"s")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-6 bg-white border-2 border-primary rounded-sm cursor-w-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"w")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-6 bg-white border-2 border-primary rounded-sm cursor-e-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Fn(N,"e")})]}),SN&&tn&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:tn.x,top:tn.y,width:tn.width,height:tn.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-cyan-500 pointer-events-none"}),c.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-cyan-500/80 rounded-full flex items-center justify-center cursor-move pointer-events-auto hover:bg-cyan-500 transition-colors",onMouseDown:dN,title:"Drag to move text",children:c.jsx(ua,{size:14,className:"text-white"})}),c.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-nw-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"nw")}),c.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-ne-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"ne")}),c.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-sw-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"sw")}),c.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-se-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"se")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-6 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-n-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"n")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-6 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-s-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"s")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-6 bg-white border-2 border-cyan-500 rounded-sm cursor-w-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"w")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-6 bg-white border-2 border-cyan-500 rounded-sm cursor-e-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Bn(N,"e")})]}),TN&&In&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:In.x,top:In.y,width:In.width,height:In.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-green-500 pointer-events-none"}),c.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-green-500/80 rounded-full flex items-center justify-center cursor-move pointer-events-auto hover:bg-green-500 transition-colors",onMouseDown:uN,title:"Drag to move shape",children:c.jsx(ua,{size:14,className:"text-white"})}),c.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-nw-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"nw")}),c.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-ne-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"ne")}),c.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-sw-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"sw")}),c.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-se-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"se")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-6 h-4 bg-white border-2 border-green-500 rounded-sm cursor-n-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"n")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-6 h-4 bg-white border-2 border-green-500 rounded-sm cursor-s-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"s")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-6 bg-white border-2 border-green-500 rounded-sm cursor-w-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"w")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-6 bg-white border-2 border-green-500 rounded-sm cursor-e-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Ln(N,"e")})]}),AN&&$o&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:$o.x,top:$o.y,width:$o.width,height:$o.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-yellow-500 rounded-lg pointer-events-none animate-pulse"}),c.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-yellow-500 rounded text-[10px] font-medium text-black whitespace-nowrap",children:"Subtitle Selected - Edit in Inspector"})]})]})}),c.jsxs("div",{className:`border-t border-border transition-all duration-300 ${_||E?"absolute bottom-0 left-0 right-0 z-50 bg-background-secondary backdrop-blur-sm":"z-20 bg-background-secondary"}`,children:[c.jsx("div",{className:"h-1.5 bg-background-tertiary cursor-pointer group hover:h-2.5 transition-all relative",onClick:yN,children:c.jsx("div",{className:"h-full bg-primary relative pointer-events-none shadow-[0_0_10px_rgba(34,197,94,0.5)]",style:{width:`${kN}%`},children:c.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity transform scale-0 group-hover:scale-100 duration-100 border border-black/20"})})}),c.jsxs("div",{className:"h-12 px-6 flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"font-mono text-text-primary tabular-nums text-sm w-24 tracking-wider",children:lg(Bt)}),T!=="none"&&c.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${T==="webgpu"?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,title:`Rendering with ${T.toUpperCase()}`,children:T.toUpperCase()})]}),c.jsxs("div",{className:"flex items-center gap-6",children:[c.jsx($r,{icon:JO,onClick:xN,title:"Skip back 5s"}),c.jsx("button",{onClick:()=>{Ue()},className:"w-10 h-10 rounded-full bg-primary hover:bg-primary-hover active:bg-primary-active flex items-center justify-center text-white transition-all shadow-[0_0_15px_rgba(34,197,94,0.4)] hover:shadow-[0_0_25px_rgba(34,197,94,0.6)] transform hover:scale-105",children:vt?c.jsx(Xj,{size:18,fill:"currentColor"}):c.jsx(ii,{size:18,fill:"currentColor",className:"ml-0.5"})}),c.jsx($r,{icon:e$,onClick:bN,title:"Skip forward 5s"})]}),c.jsxs("div",{className:"flex gap-2 items-center",children:[c.jsx("button",{onClick:()=>b(!v),className:`p-2 rounded-lg hover:bg-background-elevated transition-colors ${v?"text-red-500":"text-text-secondary hover:text-text-primary"}`,children:v?c.jsx(hp,{size:16}):c.jsx(Tn,{size:16})}),c.jsx("div",{className:"w-px h-4 bg-border mx-2"}),c.jsx("button",{onClick:vN,title:E?"Exit Full Screen":"Full Screen",className:`p-2 rounded-lg transition-colors ${E?"text-primary bg-primary/20":"text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:c.jsx(ji,{size:16})}),c.jsx("button",{onClick:wN,title:_?"Restore Size":"Maximize Preview",className:`p-2 rounded-lg transition-colors ${_?"text-primary bg-primary/20":"text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:_?c.jsx(Hj,{size:16}):c.jsx(ja,{size:16})})]})]})]})]})},It=ut,sQ=({effect:r,onUpdate:e,onToggle:t,onRemove:s})=>{const[i,n]=He.useState(!0),a={brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",hue:"Hue",blur:"Blur",sharpen:"Sharpen",vignette:"Vignette",grain:"Grain",temperature:"Temperature",tint:"Tint",tonal:"Tonal",chromaKey:"Chroma Key",shadow:"Drop Shadow",glow:"Glow","motion-blur":"Motion Blur","radial-blur":"Radial Blur","chromatic-aberration":"Chromatic Aberration"},o=()=>{switch(r.type){case"brightness":return c.jsx(It,{label:"Value",value:r.params.value||0,onChange:l=>e(r.id,{value:l}),min:-100,max:100});case"contrast":return c.jsx(It,{label:"Value",value:(r.params.value||1)*100,onChange:l=>e(r.id,{value:l/100}),min:0,max:200,unit:"%"});case"saturation":return c.jsx(It,{label:"Value",value:(r.params.value||1)*100,onChange:l=>e(r.id,{value:l/100}),min:0,max:200,unit:"%"});case"blur":return c.jsx(It,{label:"Radius",value:r.params.radius||0,onChange:l=>e(r.id,{radius:l}),min:0,max:100,unit:"px"});case"sharpen":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Amount",value:r.params.amount||0,onChange:l=>e(r.id,{amount:l}),min:0,max:200,unit:"%"}),c.jsx(It,{label:"Radius",value:r.params.radius||1,onChange:l=>e(r.id,{radius:l}),min:.1,max:10,step:.1})]});case"vignette":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Amount",value:r.params.amount||0,onChange:l=>e(r.id,{amount:l}),min:0,max:100}),c.jsx(It,{label:"Midpoint",value:(r.params.midpoint||.5)*100,onChange:l=>e(r.id,{midpoint:l/100}),min:0,max:100,unit:"%"}),c.jsx(It,{label:"Feather",value:(r.params.feather||.3)*100,onChange:l=>e(r.id,{feather:l/100}),min:0,max:100,unit:"%"})]});case"grain":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Amount",value:r.params.amount||0,onChange:l=>e(r.id,{amount:l}),min:0,max:100}),c.jsx(It,{label:"Size",value:r.params.size||1,onChange:l=>e(r.id,{size:l}),min:.5,max:5,step:.1})]});case"temperature":return c.jsx(It,{label:"Value",value:r.params.value||0,onChange:l=>e(r.id,{value:l}),min:-100,max:100});case"tint":return c.jsx(It,{label:"Value",value:r.params.value||0,onChange:l=>e(r.id,{value:l}),min:-100,max:100});case"shadow":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Offset X",value:r.params.offsetX||5,onChange:l=>e(r.id,{offsetX:l}),min:-100,max:100,unit:"px"}),c.jsx(It,{label:"Offset Y",value:r.params.offsetY||5,onChange:l=>e(r.id,{offsetY:l}),min:-100,max:100,unit:"px"}),c.jsx(It,{label:"Blur",value:r.params.blur||10,onChange:l=>e(r.id,{blur:l}),min:0,max:100,unit:"px"}),c.jsx(It,{label:"Opacity",value:(r.params.opacity||.8)*100,onChange:l=>e(r.id,{opacity:l/100}),min:0,max:100,unit:"%"})]});case"glow":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Radius",value:r.params.radius||10,onChange:l=>e(r.id,{radius:l}),min:0,max:100,unit:"px"}),c.jsx(It,{label:"Intensity",value:(r.params.intensity||1)*100,onChange:l=>e(r.id,{intensity:l/100}),min:0,max:300,unit:"%"})]});case"motion-blur":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Angle",value:r.params.angle||0,onChange:l=>e(r.id,{angle:l}),min:0,max:360,unit:""}),c.jsx(It,{label:"Distance",value:r.params.distance||20,onChange:l=>e(r.id,{distance:l}),min:0,max:100,unit:"px"})]});case"radial-blur":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Amount",value:r.params.amount||20,onChange:l=>e(r.id,{amount:l}),min:0,max:100}),c.jsx(It,{label:"Center X",value:r.params.centerX||50,onChange:l=>e(r.id,{centerX:l}),min:0,max:100,unit:"%"}),c.jsx(It,{label:"Center Y",value:r.params.centerY||50,onChange:l=>e(r.id,{centerY:l}),min:0,max:100,unit:"%"})]});case"chromatic-aberration":return c.jsxs(c.Fragment,{children:[c.jsx(It,{label:"Amount",value:r.params.amount||5,onChange:l=>e(r.id,{amount:l}),min:0,max:50,step:.5,unit:"px"}),c.jsx(It,{label:"Angle",value:r.params.angle||0,onChange:l=>e(r.id,{angle:l}),min:0,max:360,unit:""})]});default:return null}};return c.jsxs("div",{className:`border rounded-lg ${r.enabled?"border-border":"border-border/50 opacity-60"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-t-lg",children:[c.jsx(qL,{size:12,className:"text-text-muted cursor-grab"}),c.jsxs("button",{onClick:()=>n(!i),className:"flex-1 flex items-center gap-1 text-left",children:[c.jsx(ns,{size:12,className:`transition-transform ${i?"":"-rotate-90"} text-text-muted`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:a[r.type]||r.type})]}),c.jsx("button",{onClick:()=>t(r.id,!r.enabled),className:"p-1 hover:bg-background-secondary rounded transition-colors",title:r.enabled?"Disable effect":"Enable effect",children:r.enabled?c.jsx(Yr,{size:12,className:"text-text-secondary"}):c.jsx(ya,{size:12,className:"text-text-muted"})}),c.jsx("button",{onClick:()=>s(r.id),className:"p-1 hover:bg-red-500/20 rounded transition-colors text-text-muted hover:text-red-400",title:"Remove effect",children:c.jsx(Gi,{size:12})})]}),i&&c.jsx("div",{className:"p-3 space-y-3",children:o()})]})},KP=[{type:"brightness",label:"Brightness",category:"Basic"},{type:"contrast",label:"Contrast",category:"Basic"},{type:"saturation",label:"Saturation",category:"Basic"},{type:"temperature",label:"Temperature",category:"Color"},{type:"tint",label:"Tint",category:"Color"},{type:"blur",label:"Blur",category:"Blur"},{type:"motion-blur",label:"Motion Blur",category:"Blur"},{type:"radial-blur",label:"Radial Blur",category:"Blur"},{type:"sharpen",label:"Sharpen",category:"Creative"},{type:"vignette",label:"Vignette",category:"Creative"},{type:"grain",label:"Film Grain",category:"Creative"},{type:"shadow",label:"Drop Shadow",category:"Stylize"},{type:"glow",label:"Glow",category:"Stylize"},{type:"chromatic-aberration",label:"Chromatic Aberration",category:"Stylize"}],iQ=[...new Set(KP.map(r=>r.category))],rQ=({onSelect:r})=>c.jsxs(Cd,{children:[c.jsx(Sd,{asChild:!0,children:c.jsx("button",{className:"w-full py-2 bg-primary/10 border border-primary/30 rounded-lg text-[10px] text-primary hover:bg-primary/20 transition-colors",children:"+ Add Effect"})}),c.jsx(jc,{align:"start",className:"w-48 max-h-64 overflow-y-auto",children:iQ.map(e=>c.jsxs(He.Fragment,{children:[c.jsx(sM,{className:"text-[9px] uppercase tracking-wider text-text-muted",children:e}),KP.filter(t=>t.category===e).map(t=>c.jsx(wi,{onClick:()=>r(t.type),className:"text-[10px]",children:t.label},t.type))]},e))})]}),nQ=({clipId:r})=>{const{getVideoEffects:e,addVideoEffect:t,updateVideoEffect:s,removeVideoEffect:i,toggleVideoEffect:n}=U(),a=U(p=>p.project.modifiedAt),o=w.useMemo(()=>e(r),[r,e,a]),l=w.useCallback(p=>{t(r,p)},[r,t]),d=w.useCallback((p,m)=>{s(r,p,m)},[r,s]),u=w.useCallback((p,m)=>{n(r,p,m)},[r,n]),h=w.useCallback(p=>{i(r,p)},[r,i]);return c.jsxs("div",{className:"space-y-3",children:[o.length===0?c.jsx("p",{className:"text-[10px] text-text-muted text-center py-2",children:"No effects applied"}):c.jsx("div",{className:"space-y-2",children:o.map(p=>c.jsx(sQ,{effect:p,onUpdate:d,onToggle:u,onRemove:h},p.id))}),c.jsx(rQ,{onSelect:l})]})},aQ=({color:r,onClick:e})=>c.jsx("button",{onClick:e,className:"w-8 h-8 rounded-lg border-2 border-border hover:border-primary transition-colors",style:{backgroundColor:`rgb(${Math.round(r.r*255)}, ${Math.round(r.g*255)}, ${Math.round(r.b*255)})`},title:"Click to pick color from video"}),dg=({label:r,value:e,onChange:t,min:s=0,max:i=1,step:n=.01})=>{const a=(e-s)/(i-s)*100;return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[Math.round(e*100),"%"]})]}),c.jsxs("div",{className:"relative h-1.5",children:[c.jsx("input",{type:"range",min:s,max:i,step:n,value:e,onChange:o=>t(parseFloat(o.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),c.jsx("div",{className:"absolute inset-0 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${a}%`}})}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none",style:{left:`calc(${a}% - 5px)`}})]})]})},oQ=({color:r,label:e,isActive:t,onClick:s})=>c.jsxs("button",{onClick:s,className:`flex items-center gap-1.5 px-2 py-1 rounded text-[9px] transition-colors ${t?"bg-primary text-white":"bg-background-tertiary text-text-muted hover:text-text-primary"}`,children:[c.jsx("div",{className:"w-3 h-3 rounded-sm border border-border",style:{backgroundColor:`rgb(${Math.round(r.r*255)}, ${Math.round(r.g*255)}, ${Math.round(r.b*255)})`}}),e]}),cQ=[{color:{r:0,g:1,b:0},label:"Green"},{color:{r:0,g:0,b:1},label:"Blue"},{color:{r:1,g:1,b:1},label:"White"},{color:{r:0,g:0,b:0},label:"Black"},{color:{r:1,g:0,b:1},label:"Magenta"},{color:{r:0,g:1,b:1},label:"Cyan"}],lQ=({clipId:r})=>{const e=U(y=>y.project),t=me(y=>y.getChromaKeyEngine),[s,i]=w.useState(!1),[n,a]=w.useState(null);w.useEffect(()=>{let y=!1;return(async()=>{const v=await t();if(!y){a(v);const b=e.timeline.tracks.flatMap(S=>S.clips).find(S=>S.id===r);if(b){const S=b.effects.find(k=>k.type==="chromaKey");S&&S.params&&v.setSettings(r,S.params)}}})(),()=>{y=!0}},[t,r,e]);const o=w.useMemo(()=>n?n.getSettings(r)||{enabled:!1,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5}:{enabled:!1,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5},[n,r,e.modifiedAt]),l=w.useCallback(()=>{if(!n)return;const y=n.getSettings(r);y&&U.setState(x=>{const v=x.project.timeline.tracks.map(b=>({...b,clips:b.clips.map(S=>{if(S.id!==r)return S;const k=S.effects.filter(C=>C.type!=="chromaKey");return{...S,effects:[...k,{id:`chromakey-${r}`,type:"chromaKey",enabled:y.enabled,params:y}]}})}));return{project:{...x.project,timeline:{...x.project.timeline,tracks:v},modifiedAt:Date.now()}}})},[n,r]),d=w.useCallback(()=>{n&&(o.enabled?n.disableChromaKey(r):n.enableChromaKey(r),l())},[n,r,o.enabled,l]),u=w.useCallback(y=>{n&&(n.setKeyColor(r,y),l())},[n,r,l]),h=w.useCallback(y=>{n&&(n.setTolerance(r,y),l())},[n,r,l]),p=w.useCallback(y=>{n&&(n.setEdgeSoftness(r,y),l())},[n,r,l]),m=w.useCallback(y=>{n&&(n.setSpillSuppression(r,y),l())},[n,r,l]),f=w.useCallback(()=>{n&&(n.setSettings(r,{enabled:!0,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5}),l())},[n,r,l]),g=y=>Math.abs(o.keyColor.r-y.r)<.1&&Math.abs(o.keyColor.g-y.g)<.1&&Math.abs(o.keyColor.b-y.b)<.1;return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-lg border border-green-500/30",children:[c.jsx(Wc,{size:16,className:"text-green-400"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Green Screen"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Remove background color from video"})]}),c.jsx("button",{onClick:d,className:`p-1.5 rounded transition-colors ${o.enabled?"bg-green-500/30 text-green-400":"bg-background-tertiary text-text-muted hover:text-text-primary"}`,title:o.enabled?"Disable chroma key":"Enable chroma key",children:o.enabled?c.jsx(Yr,{size:14}):c.jsx(ya,{size:14})})]}),o.enabled&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:"Key Color"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>i(!s),className:`p-1.5 rounded transition-colors ${s?"bg-primary text-white":"bg-background-tertiary text-text-muted hover:text-text-primary"}`,title:"Pick color from video",children:c.jsx(FO,{size:12})}),c.jsx(aQ,{color:o.keyColor})]})]}),s&&c.jsx("div",{className:"p-2 bg-primary/10 border border-primary/30 rounded-lg",children:c.jsx("p",{className:"text-[9px] text-primary text-center",children:"Click on the video preview to pick a color"})}),c.jsx("div",{className:"flex flex-wrap gap-1",children:cQ.map(y=>c.jsx(oQ,{color:y.color,label:y.label,isActive:g(y.color),onClick:()=>u(y.color)},y.label))})]}),c.jsxs("div",{className:"space-y-3 pt-2 border-t border-border",children:[c.jsx(dg,{label:"Tolerance",value:o.tolerance,onChange:h}),c.jsx(dg,{label:"Edge Softness",value:o.edgeSoftness,onChange:p}),c.jsx(dg,{label:"Spill Suppression",value:o.spillSuppression,onChange:m})]}),c.jsx("div",{className:"flex items-center gap-2 pt-2 border-t border-border",children:c.jsxs("button",{onClick:f,className:"flex-1 flex items-center justify-center gap-1.5 py-2 text-[10px] text-text-secondary hover:text-text-primary bg-background-tertiary rounded-lg transition-colors",children:[c.jsx(nl,{size:12}),"Reset to Defaults"]})}),c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(Gs,{size:12,className:"text-text-muted"}),c.jsx("p",{className:"text-[9px] text-text-muted flex-1",children:"Place video clips below this one to use as background"})]})]}),!o.enabled&&c.jsxs("div",{className:"text-center py-4",children:[c.jsx(Wc,{size:24,className:"mx-auto mb-2 text-text-muted opacity-50"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Enable to remove background color"}),c.jsx("button",{onClick:d,className:"mt-2 px-4 py-1.5 text-[10px] bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-lg transition-colors",children:"Enable Green Screen"})]})]})},dQ=[{id:"rectangle",name:"Rectangle",icon:rs},{id:"ellipse",name:"Ellipse",icon:Wr},{id:"polygon",name:"Polygon",icon:NO}],uQ=({mask:r,isSelected:e,isExpanded:t,onSelect:s,onToggleExpand:i,onDelete:n,onDuplicate:a,onUpdateFeathering:o,onUpdateExpansion:l,onUpdateOpacity:d,onToggleInvert:u})=>{const p=r.type==="shape"?rs:Kj;return c.jsxs("div",{className:`border rounded-lg overflow-hidden transition-colors ${e?"border-primary bg-primary/10":"border-border"}`,children:[c.jsxs("button",{onClick:s,className:"w-full flex items-center gap-2 p-2 hover:bg-background-tertiary transition-colors",children:[c.jsx("button",{onClick:m=>{m.stopPropagation(),i()},className:"p-0.5",children:t?c.jsx(ns,{size:12,className:"text-text-muted"}):c.jsx(ei,{size:12,className:"text-text-muted"})}),c.jsx(p,{size:12,className:"text-primary"}),c.jsx("span",{className:"flex-1 text-left text-[10px] font-medium text-text-primary",children:r.type==="shape"?"Shape Mask":"Drawn Mask"}),c.jsx("button",{onClick:m=>{m.stopPropagation(),u()},className:`p-1 rounded transition-colors ${r.inverted?"bg-amber-500/20 text-amber-400":"text-text-muted hover:text-text-primary"}`,title:r.inverted?"Mask Inverted":"Mask Normal",children:r.inverted?c.jsx(ya,{size:10}):c.jsx(Yr,{size:10})}),c.jsx("button",{onClick:m=>{m.stopPropagation(),a()},className:"p-1 text-text-muted hover:text-text-primary transition-colors",title:"Duplicate Mask",children:c.jsx(Eo,{size:10})}),c.jsx("button",{onClick:m=>{m.stopPropagation(),n()},className:"p-1 text-text-muted hover:text-red-400 transition-colors",title:"Delete Mask",children:c.jsx(bs,{size:10})})]}),t&&c.jsxs("div",{className:"p-2 space-y-3 border-t border-border bg-background-tertiary/50",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Feathering"}),c.jsxs("span",{className:"text-[9px] text-text-secondary",children:[r.feathering,"px"]})]}),c.jsx(rt,{min:0,max:100,step:1,value:[r.feathering],onValueChange:m=>o(m[0])})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Expansion"}),c.jsxs("span",{className:"text-[9px] text-text-secondary",children:[r.expansion,"px"]})]}),c.jsx(rt,{min:-100,max:100,step:1,value:[r.expansion],onValueChange:m=>l(m[0])})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Opacity"}),c.jsxs("span",{className:"text-[9px] text-text-secondary",children:[Math.round(r.opacity*100),"%"]})]}),c.jsx(rt,{min:0,max:100,step:1,value:[r.opacity*100],onValueChange:m=>d(m[0]/100)})]}),c.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-border",children:[c.jsxs("button",{onClick:u,className:`flex-1 flex items-center justify-center gap-1 py-1.5 text-[9px] rounded transition-colors ${r.inverted?"bg-amber-500/20 text-amber-400":"bg-background-secondary text-text-secondary hover:text-text-primary"}`,children:[r.inverted?c.jsx(ya,{size:10}):c.jsx(Yr,{size:10}),r.inverted?"Inverted":"Invert"]}),c.jsx("span",{className:"text-[8px] text-text-muted",children:r.keyframes.length>0?`${r.keyframes.length} keyframes`:"No keyframes"})]})]})]})},hQ=({clipId:r})=>{const e=me(k=>k.getMaskEngine),[t,s]=w.useState(null),[i,n]=w.useState(new Set),[a,o]=w.useState(0),[l,d]=w.useState(null);w.useEffect(()=>{let k=!1;return(async()=>{const A=await e();k||d(A)})(),()=>{k=!0}},[e]);const u=w.useMemo(()=>l?l.getMasksForClip(r):[],[l,r,a]),h=w.useCallback(()=>{o(k=>k+1),U.setState(k=>({project:{...k.project,modifiedAt:Date.now()}}))},[]),p=w.useCallback(k=>{if(!l)return;const C={rectangle:{type:"rectangle",x:.25,y:.25,width:.5,height:.5},ellipse:{type:"ellipse",cx:.5,cy:.5,rx:.25,ry:.25},polygon:{type:"polygon",points:[{x:.5,y:.2},{x:.8,y:.5},{x:.5,y:.8},{x:.2,y:.5}]}},A=l.createShapeMask(r,C[k]);s(A.id),n(T=>new Set([...T,A.id])),h()},[l,r,h]),m=w.useCallback(k=>{l&&(l.deleteMask(k),t===k&&s(null),n(C=>{const A=new Set(C);return A.delete(k),A}),h())},[l,t,h]),f=w.useCallback(k=>{if(!l)return;const C=l.createDrawnMask(r,{...k.path});l.setFeathering(C.id,k.feathering),l.setExpansion(C.id,k.expansion),l.setInverted(C.id,k.inverted),s(C.id),h()},[l,r,h]),g=w.useCallback((k,C)=>{l&&(l.setFeathering(k,C),h())},[l,h]),y=w.useCallback((k,C)=>{l&&(l.setExpansion(k,C),h())},[l,h]),x=w.useCallback((k,C)=>{if(!l)return;const A=l.getMask(k);A&&(l.updateMaskPath(k,A.path),h())},[l,h]),v=w.useCallback(k=>{if(!l)return;const C=l.getMask(k);C&&(l.setInverted(k,!C.inverted),h())},[l,h]),b=k=>{n(C=>{const A=new Set(C);return A.has(k)?A.delete(k):A.add(k),A})},S=w.useCallback(()=>{if(l){for(const k of u)l.deleteMask(k.id);s(null),n(new Set),h()}},[l,u,h]);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(rs,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Masking"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Control visible regions of clip"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Add Mask Shape"})}),c.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[dQ.map(k=>{const C=k.icon;return c.jsxs("button",{onClick:()=>p(k.id),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-background-tertiary hover:bg-primary/20 border border-transparent hover:border-primary/30 transition-colors",title:k.name,children:[c.jsx(C,{size:14,className:"text-text-secondary"}),c.jsx("span",{className:"text-[8px] text-text-muted",children:k.name})]},k.id)}),c.jsxs("button",{onClick:()=>{},className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-background-tertiary hover:bg-primary/20 border border-transparent hover:border-primary/30 transition-colors",title:"Draw Freehand",children:[c.jsx(Kj,{size:14,className:"text-text-secondary"}),c.jsx("span",{className:"text-[8px] text-text-muted",children:"Freehand"})]})]})]}),u.length>0?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("span",{className:"text-[10px] font-medium text-text-secondary",children:["Masks (",u.length,")"]}),c.jsxs("button",{onClick:S,className:"flex items-center gap-1 px-2 py-1 text-[9px] text-red-400 hover:bg-red-400/10 rounded transition-colors",children:[c.jsx(nl,{size:10}),"Clear All"]})]}),c.jsx("div",{className:"space-y-2",children:u.map(k=>c.jsx(uQ,{mask:k,isSelected:t===k.id,isExpanded:i.has(k.id),onSelect:()=>s(k.id),onToggleExpand:()=>b(k.id),onDelete:()=>m(k.id),onDuplicate:()=>f(k),onUpdateFeathering:C=>g(k.id,C),onUpdateExpansion:C=>y(k.id,C),onUpdateOpacity:C=>x(k.id,C),onToggleInvert:()=>v(k.id)},k.id))})]}):c.jsxs("div",{className:"text-center py-4",children:[c.jsx(rs,{size:24,className:"mx-auto mb-2 text-text-muted opacity-50"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No masks on this clip"}),c.jsx("p",{className:"text-[9px] text-text-muted mt-1",children:"Click a shape above to add a mask"})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Masks control which parts of the clip are visible"})})]})},yh=[{id:"top-left",name:"Top Left",icon:"corner",transform:{position:{x:-.35,y:-.35},scale:{x:.3,y:.3}}},{id:"top-right",name:"Top Right",icon:"corner",transform:{position:{x:.35,y:-.35},scale:{x:.3,y:.3}}},{id:"bottom-left",name:"Bottom Left",icon:"corner",transform:{position:{x:-.35,y:.35},scale:{x:.3,y:.3}}},{id:"bottom-right",name:"Bottom Right",icon:"corner",transform:{position:{x:.35,y:.35},scale:{x:.3,y:.3}}},{id:"split-left",name:"Split Left",icon:"split",transform:{position:{x:-.25,y:0},scale:{x:.5,y:1}}},{id:"split-right",name:"Split Right",icon:"split",transform:{position:{x:.25,y:0},scale:{x:.5,y:1}}},{id:"split-top",name:"Split Top",icon:"split",transform:{position:{x:0,y:-.25},scale:{x:1,y:.5}}},{id:"split-bottom",name:"Split Bottom",icon:"split",transform:{position:{x:0,y:.25},scale:{x:1,y:.5}}},{id:"center-small",name:"Center Small",icon:"center",transform:{position:{x:0,y:0},scale:{x:.5,y:.5}}},{id:"center-medium",name:"Center Medium",icon:"center",transform:{position:{x:0,y:0},scale:{x:.7,y:.7}}},{id:"fullscreen",name:"Full Screen",icon:"center",transform:{position:{x:0,y:0},scale:{x:1,y:1}}}],pQ=({type:r,className:e=""})=>{switch(r){case"corner":return c.jsx(rs,{size:14,className:e});case"split":return c.jsx(Fx,{size:14,className:e});case"center":return c.jsx(ja,{size:14,className:e});default:return c.jsx(ua,{size:14,className:e})}},Ja=({label:r,value:e,onChange:t,min:s=-1,max:i=1,step:n=.01,unit:a=""})=>{const o=(e-s)/(i-s)*100;return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[e.toFixed(2),a]})]}),c.jsxs("div",{className:"relative h-1.5",children:[c.jsx("input",{type:"range",min:s,max:i,step:n,value:e,onChange:l=>t(parseFloat(l.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),c.jsx("div",{className:"absolute inset-0 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${o}%`}})}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none",style:{left:`calc(${o}% - 5px)`}})]})]})},ug=({preset:r,isActive:e,onClick:t})=>c.jsxs("button",{onClick:t,className:`flex flex-col items-center gap-1 p-2 rounded-lg border transition-colors ${e?"bg-primary/20 border-primary text-primary":"bg-background-tertiary border-border text-text-muted hover:text-text-primary hover:border-primary/50"}`,title:r.name,children:[c.jsx(pQ,{type:r.icon}),c.jsx("span",{className:"text-[8px] truncate max-w-full",children:r.name})]}),mQ=({clipId:r})=>{const e=U(x=>x.project),t=U(x=>x.updateClipTransform),[s,i]=w.useState(!1),n=w.useMemo(()=>{for(const x of e.timeline.tracks){const v=x.clips.find(b=>b.id===r);if(v)return v}return null},[e,r]),a=w.useMemo(()=>n?n.transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},[n]),o=w.useMemo(()=>{for(const x of yh){const v=x.transform;if(v.position&&v.scale&&Math.abs(a.position.x-v.position.x)<.05&&Math.abs(a.position.y-v.position.y)<.05&&Math.abs(a.scale.x-v.scale.x)<.05&&Math.abs(a.scale.y-v.scale.y)<.05)return x.id}return null},[a]),l=w.useCallback(x=>{if(!n)return;const v={...a,position:x.transform.position||a.position,scale:x.transform.scale||a.scale};t(r,v)},[n,r,a,t]),d=w.useCallback((x,v)=>{if(!n)return;const b={...a,position:{...a.position,[x]:v}};t(r,b)},[n,r,a,t]),u=w.useCallback((x,v)=>{if(!n)return;const b=x==="both"?{x:v,y:v}:{...a.scale,[x]:v},S={...a,scale:b};t(r,S)},[n,r,a,t]),h=w.useCallback(x=>{if(!n)return;const v={...a,borderRadius:x};t(r,v)},[n,r,a,t]),p=w.useCallback(x=>{if(!n)return;const v={...a,opacity:x};t(r,v)},[n,r,a,t]),m=w.useCallback(()=>{if(!n)return;t(r,{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1,borderRadius:0})},[n,r,t]),f=yh.filter(x=>x.icon==="corner"),g=yh.filter(x=>x.icon==="split"),y=yh.filter(x=>x.icon==="center");return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(IO,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Picture-in-Picture"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Position and scale video overlay"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Corner Positions"}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:f.map(x=>c.jsx(ug,{preset:x,isActive:o===x.id,onClick:()=>l(x)},x.id))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Split Screen"}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:g.map(x=>c.jsx(ug,{preset:x,isActive:o===x.id,onClick:()=>l(x)},x.id))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Center & Full"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:y.map(x=>c.jsx(ug,{preset:x,isActive:o===x.id,onClick:()=>l(x)},x.id))})]}),c.jsxs("button",{onClick:()=>i(!s),className:"w-full py-1.5 text-[10px] text-text-secondary hover:text-text-primary bg-background-tertiary rounded-lg transition-colors",children:[s?"Hide":"Show"," Advanced Controls"]}),s&&c.jsxs("div",{className:"space-y-3 pt-2 border-t border-border",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Position"}),c.jsx(Ja,{label:"X Position",value:a.position.x,onChange:x=>d("x",x),min:-1,max:1}),c.jsx(Ja,{label:"Y Position",value:a.position.y,onChange:x=>d("y",x),min:-1,max:1})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Scale"}),c.jsx(Ja,{label:"Uniform Scale",value:a.scale.x,onChange:x=>u("both",x),min:.1,max:2}),c.jsx(Ja,{label:"X Scale",value:a.scale.x,onChange:x=>u("x",x),min:.1,max:2}),c.jsx(Ja,{label:"Y Scale",value:a.scale.y,onChange:x=>u("y",x),min:.1,max:2})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Appearance"}),c.jsx(Ja,{label:"Border Radius",value:a.borderRadius||0,onChange:h,min:0,max:50,unit:"px"}),c.jsx(Ja,{label:"Opacity",value:a.opacity,onChange:p,min:0,max:1})]})]}),c.jsxs("button",{onClick:m,className:"w-full flex items-center justify-center gap-1.5 py-2 text-[10px] text-text-secondary hover:text-text-primary bg-background-tertiary rounded-lg transition-colors",children:[c.jsx(Gi,{size:12}),"Reset to Default"]}),c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Drag clip in preview to fine-tune position"})]})},dd=[{type:"lowshelf",frequency:60,gain:0,q:.707},{type:"peaking",frequency:250,gain:0,q:1.4},{type:"peaking",frequency:1e3,gain:0,q:1.4},{type:"peaking",frequency:4e3,gain:0,q:1.4},{type:"highshelf",frequency:16e3,gain:0,q:.707}];function QP(r){return{type:["lowshelf","highshelf","peaking","lowpass","highpass","notch"].includes(r.type)?r.type:"peaking",frequency:Math.max(20,Math.min(2e4,r.frequency??1e3)),gain:Math.max(-24,Math.min(24,r.gain??0)),q:Math.max(.1,Math.min(18,r.q??1))}}function JP(r){return{threshold:Math.max(-60,Math.min(0,r.threshold??-20)),ratio:Math.max(1,Math.min(20,r.ratio??4)),attack:Math.max(.001,Math.min(1,r.attack??.01)),release:Math.max(.01,Math.min(3,r.release??.1)),knee:Math.max(0,Math.min(40,r.knee??6))}}function ZP(r){return{roomSize:Math.max(0,Math.min(1,r.roomSize??.5)),damping:Math.max(0,Math.min(1,r.damping??.5)),wetLevel:Math.max(0,Math.min(1,r.wetLevel??.3)),dryLevel:Math.max(0,Math.min(1,r.dryLevel??1)),preDelay:Math.max(0,Math.min(100,r.preDelay??0))}}function eN(r){return{time:Math.max(0,Math.min(2,r.time??.25)),feedback:Math.max(0,Math.min(.95,r.feedback??.3)),wetLevel:Math.max(0,Math.min(1,r.wetLevel??.25))}}function tN(r){return{threshold:Math.max(-80,Math.min(0,r.threshold??-40)),reduction:Math.max(0,Math.min(1,r.reduction??.5)),attack:Math.max(0,Math.min(100,r.attack??10)),release:Math.max(0,Math.min(500,r.release??100))}}function fQ(r){const e=r.map(QP);return{id:`eq-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"eq",params:{bands:e},enabled:!0}}function gQ(r){const e=JP(r);return{id:`compressor-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"compressor",params:e,enabled:!0}}function yQ(r){const e=ZP(r);return{id:`reverb-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"reverb",params:e,enabled:!0}}function xQ(r){const e=eN(r);return{id:`delay-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"delay",params:e,enabled:!0}}function bQ(r){const e=tN(r);return{id:`noiseReduction-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"noiseReduction",params:e,enabled:!0}}class vQ{audioEffectsEngine=null;noiseProfiles=new Map;initialized=!1;async initialize(){this.initialized||(this.audioEffectsEngine=$W(),this.audioEffectsEngine.isInitialized()||await this.audioEffectsEngine.initialize(),this.initialized=!0)}isInitialized(){return this.initialized}getAudioEffectsEngine(){return this.audioEffectsEngine}applyEQ(e,t){try{const s=fQ(t);return U.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply EQ"}}}updateEQ(e,t,s){try{const i=s.map(QP);return U.getState().updateAudioEffect(e,t,{bands:i}),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update EQ"}}}applyCompressor(e,t){try{const s=gQ(t);return U.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply compressor"}}}updateCompressor(e,t,s){try{const i=JP(s);return U.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update compressor"}}}applyReverb(e,t){try{const s=yQ(t);return U.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply reverb"}}}updateReverb(e,t,s){try{const i=ZP(s);return U.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update reverb"}}}applyDelay(e,t){try{const s=xQ(t);return U.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply delay"}}}updateDelay(e,t,s){try{const i=eN(s);return U.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update delay"}}}applyNoiseReduction(e,t){try{const s=bQ(t);return U.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply noise reduction"}}}updateNoiseReduction(e,t,s){try{const i=tN(s);return U.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update noise reduction"}}}async learnNoiseProfile(e,t){if(!this.audioEffectsEngine)throw new Error("AudioBridgeEffects not initialized");const s=t??`noise-profile-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,i=await this.audioEffectsEngine.learnNoiseProfile(e,s),n={id:s,frequencyBins:i.frequencyBins,magnitudes:i.magnitudes,sampleRate:i.sampleRate,createdAt:Date.now()};return this.noiseProfiles.set(s,n),n}getNoiseProfile(e){return this.noiseProfiles.get(e)}getAllNoiseProfiles(){return Array.from(this.noiseProfiles.values())}removeNoiseProfile(e){return this.noiseProfiles.delete(e)}removeEffect(e,t){try{return U.getState().removeAudioEffect(e,t),{success:!0,effectId:t}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to remove effect"}}}toggleEffect(e,t,s){try{return U.getState().toggleAudioEffect(e,t,s),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to toggle effect"}}}async processAudio(e,t){if(!this.audioEffectsEngine)throw new Error("AudioBridgeEffects not initialized");return(await this.audioEffectsEngine.applyEffectChain(e,t)).buffer}dispose(){this.noiseProfiles.clear(),this.audioEffectsEngine=null,this.initialized=!1}}let hg=null;function Dr(){return hg||(hg=new vQ),hg}async function sN(){const r=Dr();return await r.initialize(),r}const wQ=({clip:r})=>{const e=U(o=>o.updateClipTransform),t=ft(o=>o.setCropMode),s=r.transform.crop||{x:0,y:0,width:1,height:1},i=s.x!==0||s.y!==0||s.width!==1||s.height!==1,n=()=>{e(r.id,{crop:void 0})},a=()=>{t(!0,r.id)};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("button",{onClick:a,className:"w-full py-2.5 bg-primary hover:bg-primary/90 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-2",children:[c.jsx(wL,{size:14}),i?"Adjust Crop":"Crop Video"]}),i&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"text-[9px] text-text-muted space-y-0.5 p-2 bg-background-tertiary rounded border border-border",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Crop Region:"}),c.jsxs("span",{children:[Math.round(s.width*100),"%  ",Math.round(s.height*100),"%"]})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Position:"}),c.jsxs("span",{children:["(",Math.round(s.x*100),"%, ",Math.round(s.y*100),"%)"]})]})]}),c.jsxs("button",{onClick:n,className:"w-full py-2 text-xs text-text-secondary hover:text-text-primary bg-background-tertiary hover:bg-background-elevated border border-border rounded-lg transition-colors flex items-center justify-center gap-2",children:[c.jsx(Gi,{size:12}),"Reset Crop"]})]})]})},kQ=[{label:"0.25",value:.25},{label:"0.5",value:.5},{label:"0.75",value:.75},{label:"1",value:1},{label:"1.25",value:1.25},{label:"1.5",value:1.5},{label:"2",value:2},{label:"3",value:3},{label:"5",value:5}],CQ=({clip:r})=>{const e=yc(),{project:t}=U(),[s,i]=w.useState(e.getClipSpeed(r.id)||1),[n,a]=w.useState(()=>e.getClipSpeedData(r.id)?.reverse||!1),[o,l]=w.useState(s.toString()),[d,u]=w.useState(!0);w.useEffect(()=>{l(s.toString())},[s]);const h=()=>!!t.timeline.tracks.find(v=>v.type==="audio"&&v.clips.some(b=>b.mediaId===r.mediaId)),p=x=>{const b=(r.outPoint-r.inPoint)/x,S=t.timeline.tracks.map(k=>{const C=k.clips.findIndex(j=>j.id===r.id);if(C===-1){if(d&&k.type==="audio"){const j=k.clips.findIndex(_=>_.mediaId===r.mediaId);if(j!==-1){const _=k.clips[j],M={..._,duration:b,speed:x},E=[...k.clips];return E[j]=M,e.setClipSpeed(_.id,x,_.duration),{...k,clips:E}}}return k}const A={...k.clips[C],duration:b,speed:x},T=[...k.clips];return T[C]=A,{...k,clips:T}});U.setState({project:{...t,timeline:{...t.timeline,tracks:S},modifiedAt:Date.now()}})},m=x=>{const v=t.timeline.tracks.map(b=>{const S=b.clips.findIndex(A=>A.id===r.id);if(S===-1){if(d&&b.type==="audio"){const A=b.clips.findIndex(T=>T.mediaId===r.mediaId);if(A!==-1){const T=b.clips[A],j={...T,reversed:x},_=[...b.clips];return _[A]=j,e.setReverse(T.id,x,T.duration),{...b,clips:_}}}return b}const k={...b.clips[S],reversed:x},C=[...b.clips];return C[S]=k,{...b,clips:C}});U.setState({project:{...t,timeline:{...t.timeline,tracks:v},modifiedAt:Date.now()}})},f=x=>{e.setClipSpeed(r.id,x,r.duration),p(x),i(x)},g=()=>{const x=parseFloat(o);!isNaN(x)&&x>=.1&&x<=100&&(e.setClipSpeed(r.id,x,r.duration),p(x),i(x))},y=()=>{const x=!n;e.setReverse(r.id,x,r.duration),m(x),a(x)};return c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"grid grid-cols-3 gap-2",children:kQ.map(x=>c.jsx("button",{onClick:()=>f(x.value),className:`px-3 py-2 text-xs font-medium rounded-lg transition-all ${s===x.value?"bg-primary text-white shadow-lg shadow-primary/20":"bg-background-tertiary hover:bg-background-elevated text-text-secondary hover:text-text-primary border border-border"}`,children:x.label},x.value))}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(ss,{className:"text-xs text-text-tertiary",children:"Custom Speed"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Ns,{type:"number",min:.1,max:100,step:.1,value:o,onChange:x=>l(x.target.value),onBlur:g,onKeyDown:x=>{x.key==="Enter"&&g()},className:"flex-1 bg-background-tertiary border-border text-text-primary",placeholder:"1.0"}),c.jsx("span",{className:"flex items-center text-xs text-text-tertiary",children:""})]}),c.jsx("p",{className:"text-xs text-text-tertiary",children:"Range: 0.1 (slowest) to 100 (fastest)"})]}),h()&&c.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background-tertiary border border-border",children:[c.jsx(ss,{htmlFor:"affect-audio",className:"text-xs text-text-secondary",children:"Apply speed to audio"}),c.jsx(wa,{id:"affect-audio",checked:d,onCheckedChange:u})]}),c.jsxs("button",{onClick:y,className:`w-full px-3 py-2.5 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${n?"bg-primary text-white shadow-lg shadow-primary/20":"bg-background-tertiary hover:bg-background-elevated text-text-secondary hover:text-text-primary border border-border"}`,children:[c.jsx(Gi,{size:14}),n?"Reversed":"Reverse Clip"]}),(s!==1||n)&&c.jsxs("div",{className:"p-3 rounded-lg bg-background-tertiary border border-border",children:[c.jsx("div",{className:"text-xs text-text-tertiary mb-1",children:"Current Settings"}),c.jsxs("div",{className:"text-sm text-text-primary",children:["Speed: ",s," ",n&&" Reversed"]})]})]})},pg=({label:r,value:e,onChange:t,min:s,max:i,defaultValue:n,step:a=.01})=>{const o=(e-s)/(i-s)*100,l=w.useCallback(()=>{t(n)},[t,n]);return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary cursor-pointer hover:text-accent",onDoubleClick:l,title:"Double-click to reset",children:e.toFixed(2)})]}),c.jsxs("div",{className:"h-1.5 bg-background-tertiary rounded-full relative overflow-hidden",children:[c.jsx("input",{type:"range",min:s,max:i,step:a,value:e,onChange:d=>t(parseFloat(d.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),c.jsx("div",{className:"absolute top-0 left-0 h-full bg-text-secondary rounded-full transition-all",style:{width:`${o}%`}}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none transition-all",style:{left:`calc(${o}% - 5px)`}})]})]})},mg=({label:r,color:e,onChange:t,onReset:s})=>{const i=w.useRef(null),n=w.useRef(!1),a=w.useMemo(()=>{const d=e.r,u=-e.b,h=Math.sqrt(d*d+u*u),p=Math.atan2(u,d);return{x:Math.cos(p)*h*28,y:Math.sin(p)*h*28,saturation:Math.min(h,1)}},[e.r,e.b]),o=w.useCallback(d=>{const u=i.current;if(!u)return;n.current=!0;const h=u.getBoundingClientRect(),p=h.width/2,m=h.height/2,f=(x,v)=>{const b=(x-h.left-p)/p,S=(v-h.top-m)/m,k=Math.sqrt(b*b+S*S),C=Math.min(k,1),A=k>0?b/k*C:0,T=k>0?S/k*C:0,j=A,_=-T,M=-(j+_)/2;t({r:j,g:M,b:_})};f(d.clientX,d.clientY);const g=x=>{n.current&&f(x.clientX,x.clientY)},y=()=>{n.current=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",y)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",y)},[t]),l=w.useCallback(()=>{s()},[s]);return c.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[c.jsx("span",{className:"text-[9px] text-text-muted uppercase tracking-wider font-medium",children:r}),c.jsxs("div",{ref:i,className:"w-16 h-16 rounded-full relative cursor-crosshair shadow-inner",style:{background:`conic-gradient(
 from 90deg,
 hsl(0, 70%, 50%),
 hsl(60, 70%, 50%),
 hsl(120, 70%, 50%),
 hsl(180, 70%, 50%),
 hsl(240, 70%, 50%),
 hsl(300, 70%, 50%),
 hsl(360, 70%, 50%)
 )`},onMouseDown:o,onDoubleClick:l,title:"Drag to adjust color. Double-click to reset.",children:[c.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"radial-gradient(circle, rgba(128,128,128,1) 0%, rgba(128,128,128,0) 70%)"}}),c.jsx("div",{className:"absolute w-3 h-3 border-2 border-white rounded-full shadow-md pointer-events-none z-10",style:{left:`calc(50% + ${a.x}px - 6px)`,top:`calc(50% + ${a.y}px - 6px)`,backgroundColor:a.saturation>.1?`rgb(${128+e.r*127}, ${128+e.g*127}, ${128+e.b*127})`:"white"}})]})]})},SQ=({values:r,onChange:e,onReset:t})=>{const s=w.useCallback(p=>{e({...r,shadows:p})},[r,e]),i=w.useCallback(p=>{e({...r,midtones:p})},[r,e]),n=w.useCallback(p=>{e({...r,highlights:p})},[r,e]),a=w.useCallback(p=>{e({...r,shadowsLift:p})},[r,e]),o=w.useCallback(p=>{e({...r,midtonesGamma:p})},[r,e]),l=w.useCallback(p=>{e({...r,highlightsGain:p})},[r,e]),d=w.useCallback(()=>{e({...r,shadows:{r:0,g:0,b:0}})},[r,e]),u=w.useCallback(()=>{e({...r,midtones:{r:0,g:0,b:0}})},[r,e]),h=w.useCallback(()=>{e({...r,highlights:{r:0,g:0,b:0}})},[r,e]);return c.jsxs("div",{className:"space-y-4",children:[t&&c.jsx("div",{className:"flex justify-end",children:c.jsxs("button",{onClick:t,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx(Gi,{size:10}),"Reset"]})}),c.jsxs("div",{className:"flex justify-around items-start",children:[c.jsx(mg,{label:"Shadows",color:r.shadows,onChange:s,onReset:d}),c.jsx(mg,{label:"Midtones",color:r.midtones,onChange:i,onReset:u}),c.jsx(mg,{label:"Highlights",color:r.highlights,onChange:n,onReset:h})]}),c.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[c.jsx(pg,{label:"Lift (Shadows)",value:r.shadowsLift,onChange:a,min:-1,max:1,defaultValue:0}),c.jsx(pg,{label:"Gamma (Midtones)",value:r.midtonesGamma,onChange:o,min:.1,max:4,defaultValue:1}),c.jsx(pg,{label:"Gain (Highlights)",value:r.highlightsGain,onChange:l,min:0,max:4,defaultValue:1})]})]})},B2={rgb:[{x:0,y:0},{x:1,y:1}],red:[{x:0,y:0},{x:1,y:1}],green:[{x:0,y:0},{x:1,y:1}],blue:[{x:0,y:0},{x:1,y:1}]},Fy={rgb:"#ffffff",red:"#ef4444",green:"#22c55e",blue:"#3b82f6"},xh=({channel:r,label:e,isActive:t,onClick:s})=>c.jsx("button",{onClick:s,className:`px-3 py-1 text-[10px] font-medium rounded transition-colors ${t?"bg-background-tertiary text-text-primary":"text-text-muted hover:text-text-secondary"}`,style:{borderBottom:t?`2px solid ${Fy[r]}`:"none"},children:e});function TQ(r,e){if(r.length<2)return e;const t=[...r].sort((p,m)=>p.x-m.x);let s=0;for(let p=0;p<t.length-1;p++)if(e>=t[p].x&&e<=t[p+1].x){s=p;break}const i=s>0?t[s-1]:t[s],n=t[s],a=t[Math.min(s+1,t.length-1)],o=t[Math.min(s+2,t.length-1)],l=a.x!==n.x?(e-n.x)/(a.x-n.x):0,d=l*l,u=d*l,h=.5*(2*n.y+(-i.y+a.y)*l+(2*i.y-5*n.y+4*a.y-o.y)*d+(-i.y+3*n.y-3*a.y+o.y)*u);return Math.max(0,Math.min(1,h))}function AQ(r,e,t){if(r.length<2)return"";const s=[...r].sort((a,o)=>a.x-o.x),i=[],n=100;for(let a=0;a<=n;a++){const o=a/n,l=TQ(s,o),d=o*e,u=t-l*t;i.push(a===0?`M ${d} ${u}`:`L ${d} ${u}`)}return i.join(" ")}const jQ=({values:r,onChange:e,onReset:t})=>{const[s,i]=w.useState("rgb"),[n,a]=w.useState(null),[o,l]=w.useState(!1),d=w.useRef(null),u=200,h=200,p=8,m=w.useMemo(()=>r[s]||B2[s],[r,s]),f=w.useCallback(k=>{if(!d.current||n===null)return;const C=d.current.getBoundingClientRect(),A=Math.max(0,Math.min(1,(k.clientX-C.left-p)/(u-2*p))),T=Math.max(0,Math.min(1,1-(k.clientY-C.top-p)/(h-2*p))),j=[...m];if(n===0)j[n]={x:0,y:T};else if(n===m.length-1)j[n]={x:1,y:T};else{const _=j[n-1]?.x||0,M=j[n+1]?.x||1,E=Math.max(_+.01,Math.min(M-.01,A));j[n]={x:E,y:T}}e({...r,[s]:j})},[n,m,s,r,e]),g=w.useCallback(k=>C=>{C.preventDefault(),C.stopPropagation(),a(k),l(!0)},[]);w.useEffect(()=>{const k=()=>{l(!1),a(null)},C=A=>{o&&f(A)};return o&&(document.addEventListener("mousemove",C),document.addEventListener("mouseup",k)),()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",k)}},[o,f]);const y=w.useCallback(k=>{if(!d.current||o)return;const C=d.current.getBoundingClientRect(),A=(k.clientX-C.left-p)/(u-2*p),T=1-(k.clientY-C.top-p)/(h-2*p);if(A<.01||A>.99||T<0||T>1)return;const j=[...m,{x:A,y:T}].sort((_,M)=>_.x-M.x);e({...r,[s]:j})},[m,s,r,e,o]),x=w.useCallback(k=>C=>{if(C.preventDefault(),C.stopPropagation(),k===0||k===m.length-1)return;const A=m.filter((T,j)=>j!==k);e({...r,[s]:A})},[m,s,r,e]),v=w.useCallback(()=>{e({...r,[s]:[...B2[s]]})},[s,r,e]),b=w.useMemo(()=>AQ(m,u-2*p,h-2*p),[m]),S=`M ${p} ${h-p} L ${u-p} ${p}`;return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex gap-1 justify-center",children:[c.jsx(xh,{channel:"rgb",label:"RGB",isActive:s==="rgb",onClick:()=>i("rgb")}),c.jsx(xh,{channel:"red",label:"R",isActive:s==="red",onClick:()=>i("red")}),c.jsx(xh,{channel:"green",label:"G",isActive:s==="green",onClick:()=>i("green")}),c.jsx(xh,{channel:"blue",label:"B",isActive:s==="blue",onClick:()=>i("blue")})]}),c.jsx("div",{className:"relative bg-background-tertiary rounded-lg overflow-hidden",children:c.jsxs("svg",{ref:d,width:u,height:h,className:"cursor-crosshair",onClick:y,children:[c.jsx("defs",{children:c.jsx("pattern",{id:"grid",width:u/4,height:h/4,patternUnits:"userSpaceOnUse",children:c.jsx("path",{d:`M ${u/4} 0 L 0 0 0 ${h/4}`,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"0.5"})})}),c.jsx("rect",{width:u,height:h,fill:"url(#grid)"}),c.jsx("path",{d:S,fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"1",strokeDasharray:"4,4"}),c.jsxs("g",{transform:`translate(${p}, ${p})`,children:[c.jsx("path",{d:b,fill:"none",stroke:Fy[s],strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),m.map((k,C)=>{const A=k.x*(u-2*p),T=(1-k.y)*(h-2*p),j=n===C,_=C===0||C===m.length-1;return c.jsxs("g",{children:[c.jsx("circle",{cx:A,cy:T,r:12,fill:"transparent",className:"cursor-pointer",onMouseDown:g(C),onDoubleClick:x(C)}),c.jsx("circle",{cx:A,cy:T,r:j?6:4,fill:_?"#666":Fy[s],stroke:"white",strokeWidth:j?2:1,className:"pointer-events-none"})]},C)})]})]})}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"Click to add point  Double-click to remove"}),c.jsxs("button",{onClick:v,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx(Gi,{size:10}),"Reset"]})]}),c.jsxs("div",{className:"text-[9px] text-text-muted text-center",children:[m.length," points"]})]})},_Q=({value:r,onChange:e})=>{const t=Math.round(r*100);return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Intensity"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t,"%"]})]}),c.jsx(rt,{min:0,max:100,step:1,value:[t],onValueChange:s=>e(s[0]/100)})]})};function EQ(r){const e=r.split(`
`).map(n=>n.trim());let t=0;const s=[];for(const n of e){if(n.startsWith("#")||n==="")continue;if(n.startsWith("LUT_3D_SIZE")){const o=n.split(/\s+/);if(t=parseInt(o[1],10),isNaN(t)||t<2||t>256)throw new Error(`Invalid LUT size: ${o[1]}`);continue}if(n.startsWith("TITLE")||n.startsWith("DOMAIN_"))continue;const a=n.split(/\s+/).map(parseFloat);a.length===3&&a.every(o=>!isNaN(o))&&s.push(Math.round(Math.max(0,Math.min(1,a[0]))*255),Math.round(Math.max(0,Math.min(1,a[1]))*255),Math.round(Math.max(0,Math.min(1,a[2]))*255))}if(t===0)throw new Error("LUT size not specified in file");const i=t*t*t*3;if(s.length!==i)throw new Error(`Invalid LUT data: expected ${i} values, got ${s.length}`);return{data:new Uint8Array(s),size:t,intensity:1}}function MQ(r){const e=r.split(`
`).map(i=>i.trim()),t=[];let s=0;for(const i of e){if(i===""||i.startsWith("#"))continue;if(s===0){const a=i.split(/\s+/).map(parseFloat);if(a.length>=1&&!isNaN(a[0])){s=Math.round(Math.cbrt(a.length/3))||17,a.length===3&&(s=17,t.push(Math.round(a[0]/4095*255),Math.round(a[1]/4095*255),Math.round(a[2]/4095*255)));continue}}const n=i.split(/\s+/).map(parseFloat);if(n.length===3&&n.every(a=>!isNaN(a))){const a=Math.max(...n),o=a>255?4095:a>1?255:1;t.push(Math.round(n[0]/o*255),Math.round(n[1]/o*255),Math.round(n[2]/o*255))}}if(s===0||s*s*s*3!==t.length){const i=Math.round(Math.cbrt(t.length/3));if(i*i*i*3===t.length)s=i;else throw new Error("Could not determine LUT size from data")}if(t.length===0)throw new Error("No valid LUT data found in file");return{data:new Uint8Array(t),size:s,intensity:1}}const PQ=({lutData:r,onChange:e,onError:t})=>{const s=w.useRef(null),[i,n]=w.useState(null),[a,o]=w.useState(null),[l,d]=w.useState(!1),u=w.useCallback(async f=>{const g=f.target.files?.[0];if(g){d(!0),n(null);try{const y=await g.text(),x=g.name.toLowerCase().split(".").pop();let v;if(x==="cube")v=EQ(y);else if(x==="3dl")v=MQ(y);else throw new Error("Unsupported file format. Please use .cube or .3dl files.");o(g.name),e(v)}catch(y){const x=y instanceof Error?y.message:"Failed to parse LUT file";n(x),t?.(x)}finally{d(!1),s.current&&(s.current.value="")}}},[e,t]),h=w.useCallback(f=>{r&&e({...r,intensity:f})},[r,e]),p=w.useCallback(()=>{e(null),o(null),n(null)},[e]),m=w.useCallback(()=>{s.current?.click()},[]);return c.jsxs("div",{className:"space-y-3",children:[c.jsx("input",{ref:s,type:"file",accept:".cube,.3dl",onChange:u,className:"hidden"}),r?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-[10px] text-text-primary truncate",children:a||"LUT Loaded"}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[r.size,"x",r.size,"x",r.size," LUT"]})]}),c.jsx("button",{onClick:p,className:"p-1 text-text-muted hover:text-text-primary transition-colors",title:"Remove LUT",children:c.jsx(ti,{size:14})})]}),c.jsx(_Q,{value:r.intensity,onChange:h}),c.jsx("button",{onClick:m,disabled:l,className:"w-full py-1.5 text-[10px] text-text-muted hover:text-text-secondary transition-colors",children:"Load Different LUT"})]}):c.jsx("button",{onClick:m,disabled:l,className:"w-full py-2 bg-background-tertiary border border-border rounded-lg text-[10px] text-text-secondary hover:text-text-primary hover:border-text-secondary transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-3 h-3 border border-text-muted border-t-transparent rounded-full animate-spin"}),"Loading..."]}):c.jsxs(c.Fragment,{children:[c.jsx(Kp,{size:12}),"Load LUT (.cube, .3dl)"]})}),i&&c.jsxs("div",{className:"flex items-start gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:[c.jsx(_o,{size:14,className:"text-red-500 flex-shrink-0 mt-0.5"}),c.jsx("p",{className:"text-[10px] text-red-400",children:i})]})]})},fg=[{key:"reds",label:"R",fullLabel:"Reds",color:"#ef4444",index:0},{key:"oranges",label:"O",fullLabel:"Oranges",color:"#f97316",index:1},{key:"yellows",label:"Y",fullLabel:"Yellows",color:"#eab308",index:2},{key:"greens",label:"G",fullLabel:"Greens",color:"#22c55e",index:3},{key:"cyans",label:"C",fullLabel:"Cyans",color:"#06b6d4",index:4},{key:"blues",label:"B",fullLabel:"Blues",color:"#3b82f6",index:5},{key:"purples",label:"P",fullLabel:"Purples",color:"#a855f7",index:6},{key:"magentas",label:"M",fullLabel:"Magentas",color:"#ec4899",index:7}],NQ=({color:r,isActive:e,onClick:t})=>c.jsx("button",{onClick:t,className:`flex-1 py-1.5 text-[9px] font-medium rounded transition-all ${e?"bg-background-tertiary text-text-primary shadow-sm":"text-text-muted hover:text-text-secondary"}`,style:{borderBottom:e?`2px solid ${r.color}`:"2px solid transparent"},title:r.fullLabel,children:r.label}),gg=({label:r,value:e,onChange:t,min:s,max:i,unit:n="",color:a})=>{const o=i-s,l=(e-s)/o*100,d=(0-s)/o*100,u=s<0;return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[e>0?"+":"",Math.round(e),n]})]}),c.jsxs("div",{className:"h-1.5 bg-background-tertiary rounded-full relative overflow-hidden",children:[c.jsx("input",{type:"range",min:s,max:i,step:1,value:e,onChange:h=>t(parseFloat(h.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),u?c.jsx("div",{className:"absolute top-0 h-full rounded-full transition-all",style:{backgroundColor:a||"rgb(var(--text-secondary))",left:e>=0?`${d}%`:`${l}%`,width:`${Math.abs(l-d)}%`}}):c.jsx("div",{className:"absolute top-0 left-0 h-full rounded-full transition-all",style:{backgroundColor:a||"rgb(var(--text-secondary))",width:`${l}%`}}),u&&c.jsx("div",{className:"absolute top-0 w-0.5 h-full bg-text-muted/50",style:{left:`${d}%`}}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none transition-all",style:{left:`calc(${l}% - 5px)`}})]})]})},RQ=({values:r,onChange:e,onReset:t})=>{const[s,i]=w.useState(0),n=fg[s],a=r.hue[s]||0,o=(r.saturation[s]||0)*100,l=(r.luminance[s]||0)*100,d=w.useCallback(f=>{const g=[...r.hue];g[s]=f,e({...r,hue:g})},[r,s,e]),u=w.useCallback(f=>{const g=[...r.saturation];g[s]=f/100,e({...r,saturation:g})},[r,s,e]),h=w.useCallback(f=>{const g=[...r.luminance];g[s]=f/100,e({...r,luminance:g})},[r,s,e]),p=w.useCallback(()=>{const f=[...r.hue],g=[...r.saturation],y=[...r.luminance];f[s]=0,g[s]=0,y[s]=0,e({hue:f,saturation:g,luminance:y})},[r,s,e]),m=w.useMemo(()=>a!==0||o!==0||l!==0,[a,o,l]);return c.jsxs("div",{className:"space-y-3",children:[t&&c.jsx("div",{className:"flex justify-end",children:c.jsxs("button",{onClick:t,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx(Gi,{size:10}),"Reset All"]})}),c.jsx("div",{className:"flex gap-0.5",children:fg.map(f=>c.jsx(NQ,{color:f,isActive:s===f.index,onClick:()=>i(f.index)},f.key))}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:n.color}}),c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:n.fullLabel})]}),m&&c.jsx("button",{onClick:p,className:"text-[9px] text-text-muted hover:text-text-secondary transition-colors",children:"Reset"})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsx(gg,{label:"Hue",value:a,onChange:d,min:-180,max:180,unit:"",color:n.color}),c.jsx(gg,{label:"Saturation",value:o,onChange:u,min:-100,max:100,unit:"%",color:n.color}),c.jsx(gg,{label:"Luminance",value:l,onChange:h,min:-100,max:100,unit:"%",color:n.color})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("div",{className:"flex gap-1",children:fg.map(f=>{const g=r.hue[f.index]!==0||r.saturation[f.index]!==0||r.luminance[f.index]!==0;return c.jsx("div",{className:`flex-1 h-1 rounded-full transition-all ${g?"opacity-100":"opacity-20"}`,style:{backgroundColor:f.color},title:`${f.fullLabel}${g?" (adjusted)":""}`},f.key)})})})]})},bh=({title:r,defaultOpen:e=!1,children:t})=>{const[s,i]=He.useState(e);return c.jsxs("div",{className:"border border-border rounded-lg overflow-hidden",children:[c.jsxs("button",{onClick:()=>i(!s),className:"flex items-center gap-2 w-full p-2 bg-background-tertiary hover:bg-background-tertiary/80 transition-colors",children:[c.jsx(ns,{size:12,className:`transition-transform ${s?"":"-rotate-90"} text-text-muted`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:r})]}),s&&c.jsx("div",{className:"p-3 space-y-3",children:t})]})},IQ=({clipId:r})=>{const{getColorGrading:e,updateColorGrading:t,resetColorGrading:s}=U(),i=U(x=>x.project.modifiedAt),n=w.useMemo(()=>e(r),[r,e,i]),a=w.useMemo(()=>n.colorWheels||{...J0},[n.colorWheels]),o=w.useMemo(()=>n.hsl||{...ey},[n.hsl]),l=w.useMemo(()=>n.curves||{...Z0},[n.curves]),d=w.useCallback(x=>{t(r,{colorWheels:x})},[r,t]),u=w.useCallback(()=>{t(r,{colorWheels:{...J0}})},[r,t]),h=w.useCallback(x=>{t(r,{curves:x})},[r,t]),p=w.useCallback(()=>{t(r,{curves:{...Z0}})},[r,t]),m=w.useCallback(x=>{t(r,{lut:x||void 0})},[r,t]),f=w.useCallback(x=>{t(r,{hsl:x})},[r,t]),g=w.useCallback(()=>{t(r,{hsl:{...ey}})},[r,t]),y=w.useCallback(()=>{s(r)},[r,s]);return c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"flex justify-end",children:c.jsxs("button",{onClick:y,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx(Gi,{size:10}),"Reset All"]})}),c.jsx(bh,{title:"Color Wheels",defaultOpen:!0,children:c.jsx(SQ,{values:a,onChange:d,onReset:u})}),c.jsx(bh,{title:"Curves",children:c.jsx(jQ,{values:l,onChange:h,onReset:p})}),c.jsx(bh,{title:"LUT",children:c.jsx(PQ,{lutData:n.lut,onChange:m})}),c.jsx(bh,{title:"HSL",children:c.jsx(RQ,{values:o,onChange:f,onReset:g})})]})},vh=({label:r,value:e,onChange:t})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:e,onChange:s=>t(s.target.value),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:e})]})]}),Za=({label:r,value:e,onChange:t,min:s=0,max:i=1e3,step:n=1,unit:a=""})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"number",value:e,onChange:o=>t(parseFloat(o.target.value)||0),min:s,max:i,step:n,className:"w-16 px-2 py-1 text-[10px] font-mono text-text-primary bg-background-tertiary border border-border rounded text-right outline-none focus:border-primary"}),a&&c.jsx("span",{className:"text-[10px] text-text-muted",children:a})]})]}),DQ=({options:r,value:e,onChange:t})=>c.jsx("div",{className:"flex gap-1",children:r.map(s=>c.jsx("button",{onClick:()=>t(s.value),className:`p-1.5 rounded transition-colors ${e===s.value?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,title:s.label,children:s.icon},s.value))}),FQ={Popular:["Inter","Poppins","Montserrat","Roboto","Open Sans","Lato","Outfit","DM Sans"],"Display & Headlines":["Bebas Neue","Anton","Oswald","Teko","Staatliches","Alfa Slab One","Archivo Black","Black Ops One","Titan One","Righteous","Concert One","Fredoka One","Bungee"],"Elegant & Serif":["Playfair Display","Cinzel","Lora","Merriweather","DM Serif Display","Abril Fatface","Roboto Slab","Zilla Slab"],"Modern & Clean":["Lexend","Quicksand","Nunito","Rubik","Work Sans","Raleway","Ubuntu","Space Grotesk","Comfortaa"],"Handwritten & Script":["Pacifico","Lobster","Dancing Script","Great Vibes","Caveat","Sacramento","Satisfy","Yellowtail","Rock Salt","Permanent Marker"],"Fun & Creative":["Bangers","Creepster","Press Start 2P"],Monospace:["Roboto Mono","Space Mono"],System:["Arial","Helvetica","Times New Roman","Georgia","Verdana"]},BQ=({value:r,onChange:e})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Font"}),c.jsxs(Pt,{value:r,onValueChange:e,children:[c.jsx(Ct,{className:"max-w-[140px] bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border max-h-80",children:Object.entries(FQ).map(([t,s])=>c.jsxs(sd,{children:[c.jsx(gc,{className:"text-text-muted text-[10px] font-medium",children:t}),s.map(i=>c.jsx(ze,{value:i,style:{fontFamily:i},children:i},i))]},t))})]})]}),LQ=({clipId:r})=>{const{getTextClip:e,updateTextContent:t,updateTextStyle:s,updateTextTransform:i,project:n}=U(),a=w.useMemo(()=>e(r),[r,e,n.modifiedAt]),o={fontFamily:"Inter",fontSize:48,fontWeight:"normal",fontStyle:"normal",color:"#ffffff",backgroundColor:"transparent",textAlign:"center",verticalAlign:"middle",lineHeight:1.2,letterSpacing:0,textDecoration:"none",strokeColor:"#000000",strokeWidth:0,shadowColor:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0},l=a?.style||o,d=a?.text||"",u=w.useCallback(g=>{t(r,g)},[r,t]),h=w.useCallback(async g=>{if(g.fontFamily)try{const y=l.fontSize||48;await document.fonts.load(`${y}px "${g.fontFamily}"`)}catch{}s(r,g)},[r,s,l.fontSize]),p=w.useCallback(()=>{const g=a?.transform?.position?.y??.5;i(r,{position:{x:.5,y:g}})},[r,a,i]),m=w.useCallback(()=>{const g=a?.transform?.position?.x??.5;i(r,{position:{x:g,y:.5}})},[r,a,i]),f=w.useCallback(()=>{i(r,{position:{x:.5,y:.5}})},[r,i]);return a?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Text Content"}),c.jsx("textarea",{value:d,onChange:g=>u(g.target.value),placeholder:"Enter text...",className:"w-full h-20 px-3 py-2 text-sm text-text-primary bg-background-tertiary border border-border rounded-lg resize-none outline-none focus:border-primary",style:{fontFamily:l.fontFamily}})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx(BQ,{value:l.fontFamily,onChange:g=>h({fontFamily:g})}),c.jsx(Za,{label:"Size",value:l.fontSize,onChange:g=>h({fontSize:g}),min:8,max:500,unit:"px"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Style"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:()=>h({fontWeight:l.fontWeight==="bold"?"normal":"bold"}),className:`p-1.5 rounded transition-colors ${l.fontWeight==="bold"?"bg-primary text-white":"bg-background-secondary border border-border text-text-secondary hover:text-text-primary"}`,title:"Bold",children:c.jsx(YB,{size:12})}),c.jsx("button",{onClick:()=>h({fontStyle:l.fontStyle==="italic"?"normal":"italic"}),className:`p-1.5 rounded transition-colors ${l.fontStyle==="italic"?"bg-primary text-white":"bg-background-secondary border border-border text-text-secondary hover:text-text-primary"}`,title:"Italic",children:c.jsx(iO,{size:12})}),c.jsx("button",{onClick:()=>h({textDecoration:l.textDecoration==="underline"?"none":"underline"}),className:`p-1.5 rounded transition-colors ${l.textDecoration==="underline"?"bg-primary text-white":"bg-background-secondary border border-border text-text-secondary hover:text-text-primary"}`,title:"Underline",children:c.jsx(T$,{size:12})})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Text Align"}),c.jsx(DQ,{options:[{value:"left",icon:c.jsx(y$,{size:12}),label:"Left"},{value:"center",icon:c.jsx(p$,{size:12}),label:"Center"},{value:"right",icon:c.jsx(f$,{size:12}),label:"Right"}],value:l.textAlign,onChange:g=>h({textAlign:g})})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Position on Canvas"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-muted",children:"Align to Canvas"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:p,className:"p-1.5 rounded bg-background-secondary border border-border text-text-secondary hover:text-text-primary transition-colors",title:"Center Horizontally",children:c.jsx(NB,{size:12})}),c.jsx("button",{onClick:m,className:"p-1.5 rounded bg-background-secondary border border-border text-text-secondary hover:text-text-primary transition-colors",title:"Center Vertically",children:c.jsx(IB,{size:12})}),c.jsx("button",{onClick:f,className:"p-1.5 rounded bg-primary text-white transition-colors",title:"Center Both",children:c.jsx(CL,{size:12})})]})]})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx(vh,{label:"Text Color",value:l.color,onChange:g=>h({color:g})}),c.jsx(vh,{label:"Background",value:l.backgroundColor||"transparent",onChange:g=>h({backgroundColor:g})})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Stroke"}),c.jsx(vh,{label:"Color",value:l.strokeColor||"#000000",onChange:g=>h({strokeColor:g})}),c.jsx(Za,{label:"Width",value:l.strokeWidth||0,onChange:g=>h({strokeWidth:g}),min:0,max:20,unit:"px"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Shadow"}),c.jsx(vh,{label:"Color",value:l.shadowColor||"#000000",onChange:g=>h({shadowColor:g})}),c.jsx(Za,{label:"Offset X",value:l.shadowOffsetX||0,onChange:g=>h({shadowOffsetX:g}),min:-50,max:50,unit:"px"}),c.jsx(Za,{label:"Offset Y",value:l.shadowOffsetY||0,onChange:g=>h({shadowOffsetY:g}),min:-50,max:50,unit:"px"}),c.jsx(Za,{label:"Blur",value:l.shadowBlur||0,onChange:g=>h({shadowBlur:g}),min:0,max:50,unit:"px"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx(Za,{label:"Line Height",value:l.lineHeight||1.2,onChange:g=>h({lineHeight:g}),min:.5,max:3,step:.1}),c.jsx(Za,{label:"Letter Spacing",value:l.letterSpacing||0,onChange:g=>h({letterSpacing:g}),min:-10,max:50,unit:"px"})]})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(Vs,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No text clip selected"})]})},L2=[{value:"none",label:"None",description:"No animation"},{value:"typewriter",label:"Typewriter",description:"Characters appear one by one"},{value:"fade",label:"Fade",description:"Fade in and out"},{value:"slide-left",label:"Slide Left",description:"Slide in from the right"},{value:"slide-right",label:"Slide Right",description:"Slide in from the left"},{value:"slide-up",label:"Slide Up",description:"Slide in from below"},{value:"slide-down",label:"Slide Down",description:"Slide in from above"},{value:"scale",label:"Scale",description:"Scale up from small"},{value:"bounce",label:"Bounce",description:"Bouncy entrance"},{value:"rotate",label:"Rotate",description:"Rotate into view"},{value:"wave",label:"Wave",description:"Characters wave up and down"},{value:"shake",label:"Shake",description:"Vibrating text effect"},{value:"pop",label:"Pop",description:"Poppy entrance with overshoot"},{value:"glitch",label:"Glitch",description:"Digital glitch effect"},{value:"split",label:"Split",description:"Text splits from center"},{value:"flip",label:"Flip",description:"3D flip animation"},{value:"word-by-word",label:"Word by Word",description:"Words appear sequentially"},{value:"rainbow",label:"Rainbow",description:"Color cycles through spectrum"}],Ws=ut,OQ=({value:r,onChange:e})=>c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Animation Preset"}),c.jsxs(Pt,{value:r,onValueChange:t=>e(t),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border max-h-60",children:L2.map(t=>c.jsx(ze,{value:t.value,children:t.label},t.value))})]}),c.jsx("p",{className:"text-[9px] text-text-muted",children:L2.find(t=>t.value===r)?.description})]}),$Q=({value:r,onChange:e})=>{const t=[{value:"linear",label:"Linear"},{value:"ease-in",label:"Ease In"},{value:"ease-out",label:"Ease Out"},{value:"ease-in-out",label:"Ease In Out"}];return c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Easing"}),c.jsxs(Pt,{value:r,onValueChange:e,children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:t.map(s=>c.jsx(ze,{value:s.value,children:s.label},s.value))})]})]})},zQ=({clipId:r})=>{const e=U(p=>p.getTextClip),t=U(p=>p.applyTextAnimationPreset);U(p=>p.project);const s=e(r),i=s?.animation?.preset||"none",n=s?.animation?.inDuration??.5,a=s?.animation?.outDuration??.5,o=s?.animation?.params?.easing??"ease-out",l=w.useCallback(p=>{t(r,p,n,a)},[r,t,n,a]),d=w.useCallback(p=>{t(r,i,p,a)},[r,t,i,a]),u=w.useCallback(p=>{t(r,i,n,p)},[r,t,i,n]),h=w.useCallback(p=>{t(r,i,n,a,{easing:p})},[r,t,i,n,a]);return s?c.jsxs("div",{className:"space-y-4",children:[c.jsx(OQ,{value:i,onChange:l}),i!=="none"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-3 p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(pi,{size:12,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Timing"})]}),c.jsx(Ws,{label:"In Duration",value:n,onChange:d,min:0,max:5,step:.1,unit:"s"}),c.jsx(Ws,{label:"Out Duration",value:a,onChange:u,min:0,max:5,step:.1,unit:"s"})]}),c.jsx("div",{className:"p-3 bg-background-tertiary rounded-lg",children:c.jsx($Q,{value:o,onChange:h})}),c.jsxs("div",{className:"p-3 bg-background-secondary rounded-lg border border-border",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(ii,{size:12,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Preview"})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:["Animation will play during preview and export. Total animation time: ",(n+a).toFixed(1),"s"]})]})]}),i==="fade"&&c.jsx(VQ,{clipId:r,animation:s.animation}),(i==="slide-left"||i==="slide-right"||i==="slide-up"||i==="slide-down")&&c.jsx(UQ,{clipId:r,animation:s.animation}),i==="scale"&&c.jsx(GQ,{clipId:r,animation:s.animation}),i==="bounce"&&c.jsx(WQ,{clipId:r,animation:s.animation}),i==="rotate"&&c.jsx(YQ,{clipId:r,animation:s.animation}),i==="wave"&&c.jsx(qQ,{clipId:r,animation:s.animation}),i==="shake"&&c.jsx(HQ,{clipId:r,animation:s.animation}),i==="pop"&&c.jsx(XQ,{clipId:r,animation:s.animation}),i==="glitch"&&c.jsx(KQ,{clipId:r,animation:s.animation})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(Vs,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No text clip selected"})]})},VQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.fadeOpacity?.start??0,a=e?.params?.fadeOpacity?.end??1,o=(l,d)=>{i?.animation&&t(r,"fade",i.animation.inDuration,i.animation.outDuration,{fadeOpacity:{start:l,end:d}})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Fade Settings"}),c.jsx(Ws,{label:"Start Opacity",value:n,onChange:l=>o(l,a),min:0,max:1,step:.1,unit:""}),c.jsx(Ws,{label:"End Opacity",value:a,onChange:l=>o(n,l),min:0,max:1,step:.1,unit:""})]})},UQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.slideDistance??.2,a=o=>{i?.animation&&t(r,i.animation.preset,i.animation.inDuration,i.animation.outDuration,{slideDistance:o})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Slide Settings"}),c.jsx(Ws,{label:"Distance",value:n,onChange:a,min:.05,max:1,step:.05,unit:""})]})},GQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.scaleFrom??0,a=e?.params?.scaleTo??1,o=(l,d)=>{i?.animation&&t(r,"scale",i.animation.inDuration,i.animation.outDuration,{scaleFrom:l,scaleTo:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Scale Settings"}),c.jsx(Ws,{label:"Scale From",value:n,onChange:l=>o(l,a),min:0,max:2,step:.1,unit:"x"}),c.jsx(Ws,{label:"Scale To",value:a,onChange:l=>o(n,l),min:0,max:2,step:.1,unit:"x"})]})},WQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.bounceHeight??.1,a=e?.params?.bounceCount??3,o=(l,d)=>{i?.animation&&t(r,"bounce",i.animation.inDuration,i.animation.outDuration,{bounceHeight:l,bounceCount:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Bounce Settings"}),c.jsx(Ws,{label:"Height",value:n,onChange:l=>o(l,a),min:.01,max:.5,step:.01,unit:""}),c.jsx(Ws,{label:"Bounces",value:a,onChange:l=>o(n,Math.round(l)),min:1,max:10,step:1,unit:""})]})},YQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.rotateAngle??360,a=o=>{i?.animation&&t(r,"rotate",i.animation.inDuration,i.animation.outDuration,{rotateAngle:o})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Rotate Settings"}),c.jsx(Ws,{label:"Angle",value:n,onChange:a,min:-720,max:720,step:15,unit:""})]})},qQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.waveAmplitude??.02,a=e?.params?.waveFrequency??2,o=(l,d)=>{i?.animation&&t(r,"wave",i.animation.inDuration,i.animation.outDuration,{waveAmplitude:l,waveFrequency:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Wave Settings"}),c.jsx(Ws,{label:"Amplitude",value:n,onChange:l=>o(l,a),min:.005,max:.1,step:.005,unit:""}),c.jsx(Ws,{label:"Frequency",value:a,onChange:l=>o(n,l),min:.5,max:5,step:.5,unit:""})]})},HQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.shakeIntensity??.01,a=e?.params?.shakeSpeed??20,o=(l,d)=>{i?.animation&&t(r,"shake",i.animation.inDuration,i.animation.outDuration,{shakeIntensity:l,shakeSpeed:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Shake Settings"}),c.jsx(Ws,{label:"Intensity",value:n,onChange:l=>o(l,a),min:.001,max:.05,step:.001,unit:""}),c.jsx(Ws,{label:"Speed",value:a,onChange:l=>o(n,l),min:5,max:50,step:5,unit:""})]})},XQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.popOvershoot??1.2,a=o=>{i?.animation&&t(r,"pop",i.animation.inDuration,i.animation.outDuration,{popOvershoot:o})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Pop Settings"}),c.jsx(Ws,{label:"Overshoot",value:n,onChange:a,min:1,max:2,step:.05,unit:"x"})]})},KQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=U(),i=s(r),n=e?.params?.glitchIntensity??.02,a=e?.params?.glitchSpeed??10,o=(l,d)=>{i?.animation&&t(r,"glitch",i.animation.inDuration,i.animation.outDuration,{glitchIntensity:l,glitchSpeed:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Glitch Settings"}),c.jsx(Ws,{label:"Intensity",value:n,onChange:l=>o(l,a),min:.005,max:.1,step:.005,unit:""}),c.jsx(Ws,{label:"Speed",value:a,onChange:l=>o(n,l),min:1,max:30,step:1,unit:""})]})},O2={isProcessing:!1,progress:null,beatAnalysis:null,selectedAudioClipId:null,selectedTrackIds:[],clipsToSync:[],previewTimings:[],config:$Y,error:null};let QQ=class{state={...O2};listeners=new Set;audioContext=null;subscribe(e){return this.listeners.add(e),e(this.state),()=>this.listeners.delete(e)}setState(e){this.state={...this.state,...e},this.listeners.forEach(t=>t(this.state))}getState(){return this.state}setSelectedAudioClip(e){this.setState({selectedAudioClipId:e,beatAnalysis:null,previewTimings:[],error:null})}setSelectedTracks(e){this.setState({selectedTrackIds:e}),this.updateClipsToSync(),this.updatePreview()}toggleTrackSelection(e){const{selectedTrackIds:t}=this.state,s=t.includes(e)?t.filter(i=>i!==e):[...t,e];this.setSelectedTracks(s)}updateConfig(e){this.setState({config:{...this.state.config,...e}}),this.updatePreview()}updateClipsToSync(){const{selectedTrackIds:e}=this.state,t=U.getState(),{project:s}=t,i=[];for(const n of s.timeline.tracks)if(e.includes(n.id))for(const a of n.clips)i.push({id:a.id,startTime:a.startTime,duration:a.duration,trackId:n.id});this.setState({clipsToSync:i})}updatePreview(){const{beatAnalysis:e,clipsToSync:t,config:s,selectedAudioClipId:i}=this.state;if(!e||t.length===0){this.setState({previewTimings:[]});return}const n=U.getState(),o=(i?n.getClip(i):null)?.startTime??0,d=SC().calculateSyncedTimings(t,e,o,s);this.setState({previewTimings:d})}async analyzeBeats(){const{selectedAudioClipId:e}=this.state;if(!e){this.setState({error:"No audio clip selected"});return}const t=U.getState(),s=t.getClip(e);if(!s){this.setState({error:"Clip not found"});return}const i=t.getMediaItem(s.mediaId);if(!i?.blob){this.setState({error:"Media blob not found"});return}this.setState({isProcessing:!0,error:null});try{const n=await this.extractAudioFromBlob(i.blob,s.inPoint??0,s.outPoint??s.duration),o=await SC().analyzeBeats(n,l=>this.setState({progress:l}));this.setState({beatAnalysis:o,isProcessing:!1,progress:null}),this.updatePreview()}catch(n){this.setState({isProcessing:!1,error:n instanceof Error?n.message:"Beat analysis failed",progress:null})}}async applySync(){const{previewTimings:e}=this.state;if(e.length===0)return this.setState({error:"No clips to sync"}),!1;const t=U.getState();this.setState({isProcessing:!0,error:null});try{for(const s of e){await t.moveClip(s.clipId,s.newStartTime);const i=t.getClip(s.clipId);if(i&&this.state.config.syncMode!=="preserve-duration"){const n=(i.inPoint??0)+s.newDuration;await t.trimClip(s.clipId,i.inPoint,n)}}return this.setState({isProcessing:!1,progress:{phase:"complete",percent:100,message:`Synced ${e.length} clips to beats`}}),!0}catch(s){return this.setState({isProcessing:!1,error:s instanceof Error?s.message:"Failed to apply sync"}),!1}}getAvailableTracks(){const e=U.getState(),{project:t}=e,{selectedAudioClipId:s}=this.state,n=(s?e.getClip(s):null)?t.timeline.tracks.find(a=>a.clips.some(o=>o.id===s))?.id:null;return t.timeline.tracks.filter(a=>a.id!==n&&a.clips.length>0).map(a=>({id:a.id,name:a.name,type:a.type,clipCount:a.clips.length}))}async extractAudioFromBlob(e,t,s){this.audioContext||(this.audioContext=new AudioContext);const i=await e.arrayBuffer(),n=await this.audioContext.decodeAudioData(i),a=Math.min(s-t,n.duration-t),o=n.sampleRate,l=Math.floor(t*o),d=Math.floor(a*o),u=new OfflineAudioContext(1,d,o),h=u.createBuffer(1,d,o),p=h.getChannelData(0),m=n.getChannelData(0);for(let y=0;y<d;y++)p[y]=m[l+y]||0;const f=u.createBufferSource();f.buffer=h,f.connect(u.destination),f.start(0);const g=await u.startRendering();return this.audioBufferToWav(g)}audioBufferToWav(e){const t=e.numberOfChannels,s=e.sampleRate,i=1,n=16,a=n/8,o=t*a,l=s*o,d=e.length*o,h=44+d,p=new ArrayBuffer(h),m=new DataView(p),f=(x,v)=>{for(let b=0;b<v.length;b++)m.setUint8(x+b,v.charCodeAt(b))};f(0,"RIFF"),m.setUint32(4,h-8,!0),f(8,"WAVE"),f(12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,i,!0),m.setUint16(22,t,!0),m.setUint32(24,s,!0),m.setUint32(28,l,!0),m.setUint16(32,o,!0),m.setUint16(34,n,!0),f(36,"data"),m.setUint32(40,d,!0);const g=e.getChannelData(0);let y=44;for(let x=0;x<e.length;x++){const v=Math.max(-1,Math.min(1,g[x])),b=v<0?v*32768:v*32767;m.setInt16(y,b,!0),y+=2}return new Blob([p],{type:"audio/wav"})}reset(){this.setState({...O2})}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.listeners.clear()}},yg=null;function JQ(){return yg||(yg=new QQ),yg}const ZQ={video:c.jsx(Wc,{size:12}),image:c.jsx(No,{size:12}),text:c.jsx(Vs,{size:12}),graphics:c.jsx(Vs,{size:12})},eJ=({clipId:r})=>{const[e,t]=w.useState(null),[s,i]=w.useState(!1),n=w.useMemo(()=>JQ(),[]);w.useEffect(()=>{const b=n.subscribe(t);return n.setSelectedAudioClip(r),b},[n,r]);const a=w.useMemo(()=>n.getAvailableTracks(),[n,e?.beatAnalysis]),o=w.useCallback(()=>{n.analyzeBeats()},[n]),l=w.useCallback(b=>{n.toggleTrackSelection(b)},[n]),d=w.useCallback(async()=>{await n.applySync()},[n]),u=w.useCallback(b=>{n.updateConfig(b)},[n]);if(!e)return c.jsx("div",{className:"p-4 flex items-center justify-center",children:c.jsx(_i,{size:20,className:"animate-spin text-primary"})});const{isProcessing:h,progress:p,beatAnalysis:m,selectedTrackIds:f,clipsToSync:g,previewTimings:y,config:x,error:v}=e;return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[c.jsx(qr,{size:14}),c.jsx("span",{className:"text-[10px]",children:"Sync clips to the beat of this audio"})]}),v&&c.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[c.jsx(_o,{size:14,className:"text-red-400 shrink-0"}),c.jsx("span",{className:"text-[10px] text-red-400",children:v})]}),m?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] text-text-secondary block",children:"BPM Detected"}),c.jsx("span",{className:"text-lg font-bold text-primary",children:m.bpm})]}),c.jsxs("div",{className:"text-right",children:[c.jsx("span",{className:"text-[10px] text-text-secondary block",children:"Beats"}),c.jsx("span",{className:"text-sm font-medium text-text-primary",children:m.beats.length})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary block",children:"Select tracks to sync to beats:"}),a.length===0?c.jsx("p",{className:"text-[10px] text-text-muted p-3 bg-background-tertiary rounded-lg",children:"No other tracks with clips found. Add clips to other tracks first."}):c.jsx("div",{className:"space-y-1",children:a.map(b=>c.jsxs("button",{onClick:()=>l(b.id),className:`w-full flex items-center justify-between p-2 rounded-lg text-left transition-colors ${f.includes(b.id)?"bg-primary/20 border border-primary/50":"bg-background-tertiary border border-transparent hover:border-border"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[ZQ[b.type]||c.jsx(Wc,{size:12}),c.jsx("span",{className:"text-[11px] text-text-primary",children:b.name})]}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[b.clipCount," ",b.clipCount===1?"clip":"clips"]})]},b.id))})]}),g.length>0&&c.jsx("div",{className:"p-2 bg-background-tertiary rounded-lg",children:c.jsxs("span",{className:"text-[9px] text-text-muted",children:[g.length," clips will be synced to ",m.beats.length," beats"]})}),c.jsxs("div",{className:"border-t border-border pt-3",children:[c.jsxs("button",{onClick:()=>i(!s),className:"flex items-center gap-2 text-[10px] text-text-secondary hover:text-text-primary mb-3",children:[c.jsx(Jj,{size:12}),"Sync Settings"]}),s&&c.jsxs("div",{className:"space-y-3 p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] text-text-secondary block mb-2",children:"Sync Mode"}),c.jsx("div",{className:"space-y-1",children:[{value:"smart",label:"Smart",desc:"Adjust duration to fit nearest beat count"},{value:"one-per-beat",label:"One per Beat",desc:"Each clip gets exactly one beat"},{value:"preserve-duration",label:"Preserve Duration",desc:"Keep original duration, snap start to beat"}].map(b=>c.jsxs("button",{onClick:()=>u({syncMode:b.value}),className:`w-full text-left p-2 rounded transition-colors ${x.syncMode===b.value?"bg-primary/20 border border-primary/50":"bg-background-secondary border border-transparent hover:border-border"}`,children:[c.jsx("span",{className:"text-[10px] text-text-primary block",children:b.label}),c.jsx("span",{className:"text-[9px] text-text-muted",children:b.desc})]},b.value))})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Beat Subdivision"}),c.jsx("div",{className:"flex gap-1",children:[1,2,4].map(b=>c.jsxs("button",{onClick:()=>u({beatSubdivision:b}),className:`px-2 py-1 text-[9px] rounded transition-colors ${x.beatSubdivision===b?"bg-primary text-black":"bg-background-secondary text-text-secondary hover:text-text-primary"}`,children:["1/",b]},b))})]}),c.jsx(ut,{label:"Offset",value:x.offsetMs,onChange:b=>u({offsetMs:b}),min:-500,max:500,step:10,unit:"ms"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Downbeats Only"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:()=>u({snapToDownbeats:!1}),className:`px-2 py-1 text-[9px] rounded transition-colors ${x.snapToDownbeats?"bg-background-secondary text-text-secondary":"bg-primary text-black"}`,children:"All Beats"}),c.jsx("button",{onClick:()=>u({snapToDownbeats:!0}),className:`px-2 py-1 text-[9px] rounded transition-colors ${x.snapToDownbeats?"bg-primary text-black":"bg-background-secondary text-text-secondary"}`,children:"Downbeats"})]})]})]})]}),y.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"Preview:"}),c.jsxs("div",{className:"max-h-24 overflow-y-auto bg-background-tertiary rounded-lg p-2 space-y-1",children:[y.slice(0,5).map((b,S)=>c.jsxs("div",{className:"flex items-center justify-between text-[9px]",children:[c.jsxs("span",{className:"text-text-muted",children:["Clip ",S+1]}),c.jsxs("span",{className:"text-text-primary",children:[b.originalStartTime.toFixed(2),"s  ",b.newStartTime.toFixed(2),"s"]})]},b.clipId)),y.length>5&&c.jsxs("span",{className:"text-[9px] text-text-muted",children:["...and ",y.length-5," more"]})]})]}),p?.phase==="complete"&&c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 rounded-lg border border-green-500/30",children:[c.jsx(Ri,{size:14,className:"text-green-400"}),c.jsx("span",{className:"text-[10px] text-green-400",children:p.message})]}),c.jsx(Rt,{onClick:d,disabled:h||y.length===0,className:"w-full bg-primary hover:bg-primary/80 text-black disabled:opacity-50",children:h?c.jsxs(c.Fragment,{children:[c.jsx(_i,{size:14,className:"mr-2 animate-spin"}),"Syncing..."]}):`Sync ${y.length} Clips to Beats`}),c.jsx(Rt,{onClick:o,variant:"outline",className:"w-full",children:"Re-analyze Beats"})]}):c.jsx("div",{className:"space-y-3",children:h&&p?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(_i,{size:12,className:"animate-spin text-primary"}),c.jsx("span",{className:"text-[10px] text-text-primary",children:p.message})]}),c.jsx("div",{className:"h-1.5 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${p.percent}%`}})})]}):c.jsxs(Rt,{onClick:o,className:"w-full bg-primary/20 hover:bg-primary/30 text-primary border border-primary/30",children:[c.jsx(qr,{size:14,className:"mr-2"}),"Detect Beats"]})})]})},xg=({label:r,value:e,onChange:t})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:e,onChange:s=>t(s.target.value),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:e})]})]}),bg=({label:r,value:e,onChange:t,min:s=0,max:i=1e3,step:n=1,unit:a=""})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"number",value:e,onChange:o=>t(parseFloat(o.target.value)||0),min:s,max:i,step:n,className:"w-16 px-2 py-1 text-[10px] font-mono text-text-primary bg-background-tertiary border border-border rounded text-right outline-none focus:border-primary"}),a&&c.jsx("span",{className:"text-[10px] text-text-muted",children:a})]})]}),tJ=({value:r,onChange:e})=>{const t=[{value:void 0,label:"Solid",preview:""},{value:[5,5],label:"Dashed",preview:"- - -"},{value:[2,2],label:"Dotted",preview:"  "}];return c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Style"}),c.jsx("div",{className:"flex gap-1",children:t.map((s,i)=>c.jsx("button",{onClick:()=>e(s.value),className:`px-2 py-1 text-[9px] rounded transition-colors ${s.value===void 0&&r===void 0||s.value&&r&&s.value[0]===r[0]?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,title:s.label,children:s.preview},i))})]})},sJ=({shapeType:r})=>{const e={rectangle:c.jsx(rs,{size:16}),circle:c.jsx(Wr,{size:16}),ellipse:c.jsx(Wr,{size:16}),triangle:c.jsx(e_,{size:16}),star:c.jsx(xa,{size:16}),polygon:c.jsx(Yj,{size:16}),arrow:c.jsx(da,{size:16})};return c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx("div",{className:"p-1.5 bg-background-secondary rounded",children:e[r]||c.jsx(rs,{size:16})}),c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary capitalize",children:r}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Shape clip"})]})]})},iJ=({clipId:r})=>{const{getShapeClip:e,updateShapeStyle:t,project:s}=U(),i=w.useMemo(()=>e(r),[r,e,s.modifiedAt]),o={fill:{type:"solid",color:"#3b82f6",opacity:1},stroke:{color:"#1d4ed8",width:2,opacity:1}},l=i?.style||o,d=i?.shapeType||"rectangle",u=w.useCallback(h=>{t(r,h)},[r,t]);return i?c.jsxs("div",{className:"space-y-4",children:[c.jsx(sJ,{shapeType:d}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Fill"}),c.jsx(xg,{label:"Color",value:l.fill?.color||"#3b82f6",onChange:h=>u({fill:{...l.fill,color:h,type:"solid",opacity:l.fill?.opacity||1}})}),c.jsx(ut,{label:"Opacity",value:(l.fill?.opacity||1)*100,onChange:h=>u({fill:{...l.fill,opacity:h/100,type:l.fill?.type||"solid"}}),min:0,max:100,unit:"%"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Stroke"}),c.jsx(xg,{label:"Color",value:l.stroke?.color||"#1d4ed8",onChange:h=>u({stroke:{...l.stroke,color:h,width:l.stroke?.width||2,opacity:l.stroke?.opacity||1}})}),c.jsx(bg,{label:"Width",value:l.stroke?.width||0,onChange:h=>u({stroke:{...l.stroke,width:h,color:l.stroke?.color||"#1d4ed8",opacity:l.stroke?.opacity||1}}),min:0,max:50,unit:"px"}),c.jsx(tJ,{value:l.stroke?.dashArray,onChange:h=>u({stroke:{...l.stroke,dashArray:h,color:l.stroke?.color||"#1d4ed8",width:l.stroke?.width||2,opacity:l.stroke?.opacity||1}})})]}),d==="rectangle"&&c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Corners"}),c.jsx(ut,{label:"Radius",value:l.cornerRadius||0,onChange:h=>u({cornerRadius:h}),min:0,max:100,unit:"px"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Shadow"}),c.jsx(xg,{label:"Color",value:l.shadow?.color||"#000000",onChange:h=>u({shadow:{color:h,offsetX:l.shadow?.offsetX||0,offsetY:l.shadow?.offsetY||0,blur:l.shadow?.blur||0}})}),c.jsx(bg,{label:"Offset X",value:l.shadow?.offsetX||0,onChange:h=>u({shadow:{offsetX:h,color:l.shadow?.color||"#000000",offsetY:l.shadow?.offsetY||0,blur:l.shadow?.blur||0}}),min:-50,max:50,unit:"px"}),c.jsx(bg,{label:"Offset Y",value:l.shadow?.offsetY||0,onChange:h=>u({shadow:{offsetY:h,color:l.shadow?.color||"#000000",offsetX:l.shadow?.offsetX||0,blur:l.shadow?.blur||0}}),min:-50,max:50,unit:"px"}),c.jsx(ut,{label:"Blur",value:l.shadow?.blur||0,onChange:h=>u({shadow:{blur:h,color:l.shadow?.color||"#000000",offsetX:l.shadow?.offsetX||0,offsetY:l.shadow?.offsetY||0}}),min:0,max:50,unit:"px"})]})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(rs,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No shape clip selected"})]})},rJ=({label:r,value:e,onChange:t})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:e,onChange:s=>t(s.target.value),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:e})]})]}),$2=GY.map(r=>({value:r.id,label:r.name,description:r.description})),nJ=({clipId:r})=>{const{getSVGClipById:e,updateSVGClip:t,project:s}=U(),i=w.useMemo(()=>e(r),[r,e,s.modifiedAt]),n=i?.colorStyle||{colorMode:"none",tintColor:"#ffffff",tintOpacity:1},a=i?.entryAnimation,o=i?.exitAnimation,l=w.useCallback(g=>{if(!i){console.warn(`[SVGSection] No SVG clip found for ${r}`);return}const y={...n,colorMode:g};t(r,{colorStyle:y})},[r,i,n,t]),d=w.useCallback(g=>{i&&t(r,{colorStyle:{...n,tintColor:g}})},[r,i,n,t]),u=w.useCallback(g=>{i&&t(r,{colorStyle:{...n,tintOpacity:g}})},[r,i,n,t]),h=w.useCallback(g=>{if(!i){console.warn(`[SVGSection] No SVG clip found for ${r}`);return}const y={type:g,duration:a?.duration||.5,easing:a?.easing||"ease-out"};t(r,{entryAnimation:y})},[r,i,a,t]),p=w.useCallback(g=>{if(!i)return;const y={type:g,duration:o?.duration||.5,easing:o?.easing||"ease-out"};t(r,{exitAnimation:y})},[r,i,o,t]),m=w.useCallback(g=>{!i||!a||t(r,{entryAnimation:{...a,duration:g}})},[r,i,a,t]),f=w.useCallback(g=>{!i||!o||t(r,{exitAnimation:{...o,duration:g}})},[r,i,o,t]);return i?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Mode"}),c.jsx("div",{className:"flex gap-1",children:["none","tint","replace"].map(g=>c.jsx("button",{onClick:()=>l(g),className:`px-2 py-1 text-[9px] rounded capitalize transition-colors ${n.colorMode===g?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:g},g))})]}),n.colorMode!=="none"&&c.jsxs(c.Fragment,{children:[c.jsx(rJ,{label:"Color",value:n.tintColor||"#ffffff",onChange:d}),c.jsx(ut,{label:"Opacity",value:n.tintOpacity||1,onChange:u,min:0,max:1,step:.1})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Entry Animation"}),c.jsxs(Pt,{value:a?.type||"none",onValueChange:g=>h(g),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:$2.map(g=>c.jsx(ze,{value:g.value,children:g.label},g.value))})]}),a&&a.type!=="none"&&c.jsx(ut,{label:"Duration",value:a.duration,onChange:m,min:.1,max:3,step:.1})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Exit Animation"}),c.jsxs(Pt,{value:o?.type||"none",onValueChange:g=>p(g),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:$2.map(g=>c.jsx(ze,{value:g.value,children:g.label},g.value))})]}),o&&o.type!=="none"&&c.jsx(ut,{label:"Duration",value:o.duration,onChange:f,min:.1,max:3,step:.1})]})]}):c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No SVG clip selected"})};class aJ{playbackController=null;unsubscribeTimelineStore=null;unsubscribePlaybackEvents=null;initialized=!1;isUpdatingProject=!1;async initialize(){if(this.initialized)return;const e=me.getState();if(!e.initialized)throw new Error("EngineStore must be initialized before PlaybackBridge");if(this.playbackController=e.playbackController,!this.playbackController)throw new Error("PlaybackController not available in EngineStore");const t=U.getState();this.playbackController.setProject(t.project),this.setupPlaybackEventSubscriptions(),this.setupProjectSubscription(),this.initialized=!0}setupPlaybackEventSubscriptions(){if(!this.playbackController)return;const e=t=>{const s=Wt.getState();switch(t.type){case"timeupdate":this.playbackController?.getIsScrubbing()||s.setPlayheadPosition(t.time);break;case"statechange":this.syncPlaybackState(t.state);break;case"ended":s.pause();break;case"framerendered":t.frame&&me.setState({currentFrame:t.frame});break}};this.playbackController.addEventListener("timeupdate",e),this.playbackController.addEventListener("statechange",e),this.playbackController.addEventListener("ended",e),this.playbackController.addEventListener("framerendered",e),this.unsubscribePlaybackEvents=()=>{this.playbackController?.removeEventListener("timeupdate",e),this.playbackController?.removeEventListener("statechange",e),this.playbackController?.removeEventListener("ended",e),this.playbackController?.removeEventListener("framerendered",e)}}setupProjectSubscription(){this.unsubscribeTimelineStore=U.subscribe(e=>e.project,e=>{if(this.playbackController){const t=Wt.getState(),s=t.playheadPosition,i=t.playbackState==="playing";this.isUpdatingProject=!0,this.playbackController.setProject(e),this.isUpdatingProject=!1,this.playbackController.scrubTo(s),i&&this.playbackController.play()}})}syncPlaybackState(e){if(this.isUpdatingProject||this.playbackController?.getIsScrubbing())return;const t=Wt.getState(),s=t.playbackState,i=e==="seeking"?"paused":e;if(s!==i)switch(i){case"playing":t.play();break;case"paused":t.pause();break;case"stopped":t.stop();break}}isReady(){return this.initialized&&this.playbackController!==null}async play(){this.playbackController&&await this.playbackController.play(),Wt.getState().play()}pause(){this.playbackController&&this.playbackController.pause(),Wt.getState().pause()}stop(){this.playbackController&&this.playbackController.stop(),Wt.getState().stop()}async togglePlayback(){this.playbackController?await this.playbackController.togglePlayback():Wt.getState().togglePlayback()}async seek(e){this.playbackController&&await this.playbackController.seek(e),Wt.getState().seekTo(e)}startScrubbing(){this.playbackController&&this.playbackController.startScrubbing(),Wt.getState().startScrubbing(Wt.getState().playheadPosition)}async scrubTo(e){this.playbackController&&await this.playbackController.scrubTo(e),Wt.getState().updateScrubPosition(e)}endScrubbing(){this.playbackController&&this.playbackController.endScrubbing(),Wt.getState().endScrubbing()}setPlaybackRate(e){this.playbackController&&this.playbackController.setPlaybackRate(e),Wt.getState().setPlaybackRate(e)}isTrackAudible(e,t){return!(e.muted||t&&!e.solo)}getTrackAudibility(e){const t=e.some(s=>s.solo);return e.map(s=>({trackId:s.id,isAudible:this.isTrackAudible(s,t),isMuted:s.muted,isSolo:s.solo}))}getAudibleTrackIds(){const t=U.getState().project.timeline.tracks,s=this.getTrackAudibility(t),i=new Set;for(const n of s)n.isAudible&&i.add(n.trackId);return i}hasSoloTracks(){return U.getState().project.timeline.tracks.some(s=>s.solo)}getState(){return Wt.getState().playbackState}getCurrentTime(){return this.playbackController?this.playbackController.getCurrentTime():Wt.getState().playheadPosition}isPlaying(){return this.playbackController?.isPlaying()??!1}isScrubbing(){return this.playbackController?.getIsScrubbing()??!1}getStats(){return this.playbackController?.getStats()??null}dispose(){this.unsubscribePlaybackEvents&&(this.unsubscribePlaybackEvents(),this.unsubscribePlaybackEvents=null),this.unsubscribeTimelineStore&&(this.unsubscribeTimelineStore(),this.unsubscribeTimelineStore=null),this.playbackController=null,this.initialized=!1}}let Bc=null;function ud(){return Bc||(Bc=new aJ),Bc}async function oJ(){const r=ud();return await r.initialize(),r}function cJ(){Bc&&(Bc.dispose(),Bc=null)}class lJ{engine=SW();currentState={isTracking:!1,progress:0,currentJob:null,trackingData:null,lostFrames:[],error:null};listeners=new Set;clipTrackingMap=new Map;unsubscribeProgress=null;unsubscribeLost=null;constructor(){this.unsubscribeProgress=this.engine.onTrackingProgress(this.handleProgress),this.unsubscribeLost=this.engine.onTrackingLost(this.handleTrackingLost)}handleProgress=e=>{this.updateState({progress:e})};handleTrackingLost=e=>{const t=[...this.currentState.lostFrames,e];this.updateState({lostFrames:t})};updateState(e){this.currentState={...this.currentState,...e},this.notifyListeners()}notifyListeners(){for(const e of this.listeners)e(this.currentState)}subscribe(e){return this.listeners.add(e),e(this.currentState),()=>this.listeners.delete(e)}getState(){return this.currentState}async startTracking(e,t,s={}){this.updateState({isTracking:!0,progress:0,lostFrames:[],error:null,trackingData:null});try{const i=await this.engine.startTracking(e,t,s);this.updateState({currentJob:i});const n=setInterval(()=>{const a=this.engine.getTrackingJob(i.id);if(!a){clearInterval(n);return}if(this.updateState({currentJob:a,progress:a.progress}),a.status==="completed"||a.status==="failed"||a.status==="cancelled")if(clearInterval(n),a.status==="completed"){const o=this.engine.getTrackingDataForClip(e),l=o.length>0?o[o.length-1]:null;l&&this.clipTrackingMap.set(e,l.trackId),this.updateState({isTracking:!1,trackingData:l,currentJob:a})}else a.status==="failed"?this.updateState({isTracking:!1,error:a.error||"Tracking failed",currentJob:a}):this.updateState({isTracking:!1,currentJob:a})},100);return i}catch(i){const n=i instanceof Error?i.message:"Unknown error";throw this.updateState({isTracking:!1,error:n}),i}}cancelTracking(e){this.engine.cancelTracking(e),this.updateState({isTracking:!1,progress:0})}applyTrackingToElement(e,t,s={x:0,y:0}){this.engine.applyTrackingToElement(e,t,s)}applyTrackingToClip(e,t={x:0,y:0}){const s=this.clipTrackingMap.get(e);if(!s)return console.warn(`No tracking data found for clip ${e}`),!1;try{return this.applyTrackingToElement(s,e,t),!0}catch{return!1}}setTrackingOffset(e,t){this.engine.setTrackingOffset(e,t)}getTrackingOffset(e){return this.engine.getTrackingOffset(e)}setApplyScale(e,t){this.engine.setApplyScale(e,t)}setApplyRotation(e,t){this.engine.setApplyRotation(e,t)}getElementPositionAtTime(e,t){return this.engine.getElementPositionAtTime(e,t)}correctTrackingPoint(e,t,s){this.engine.correctTrackingPoint(e,t,s)}getTrackingDataForClip(e){return this.engine.getTrackingDataForClip(e)}getTrackingData(e,t){return this.engine.getTrackingData(e,t)}removeAttachment(e){this.engine.removeTrackingFromElement(e)}hasTrackingData(e){return this.clipTrackingMap.has(e)}getClipTrackId(e){return this.clipTrackingMap.get(e)||null}reset(){this.updateState({isTracking:!1,progress:0,currentJob:null,trackingData:null,lostFrames:[],error:null})}dispose(){this.unsubscribeProgress&&this.unsubscribeProgress(),this.unsubscribeLost&&this.unsubscribeLost(),this.listeners.clear()}}let vg=null;function dJ(){return vg||(vg=new lJ),vg}const uJ={snapToBeats:!0,snapThreshold:.1,autoZoomOnBeats:!1,zoomIntensity:1.1,autoCutOnBeats:!1,beatsPerCut:4};class hJ{engine;state={isAnalyzing:!1,progress:0,error:null,beatMarkers:[],beatAnalysis:null};options={...uJ};listeners=new Set;constructor(){this.engine=AM()}getState(){return{...this.state}}getOptions(){return{...this.options}}setOptions(e){this.options={...this.options,...e}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){const e=this.getState();this.listeners.forEach(t=>t(e))}updateState(e){this.state={...this.state,...e},this.notifyListeners()}async analyzeAudioFromBlob(e,t){this.updateState({isAnalyzing:!0,progress:0,error:null});try{this.updateState({progress:10});const s=await this.engine.analyzeFromBlob(e);this.updateState({progress:80});const i=this.convertToBeatMarkers(s.beats,s.downbeats),n={bpm:s.bpm,confidence:s.confidence,sourceClipId:t,analyzedAt:Date.now()};return this.updateState({isAnalyzing:!1,progress:100,beatMarkers:i,beatAnalysis:n}),s}catch(s){const i=s instanceof Error?s.message:"Beat analysis failed";throw this.updateState({isAnalyzing:!1,progress:0,error:i}),s}}async analyzeAudioFromUrl(e,t){this.updateState({isAnalyzing:!0,progress:0,error:null});try{this.updateState({progress:10});const s=await this.engine.analyzeFromUrl(e);this.updateState({progress:80});const i=this.convertToBeatMarkers(s.beats,s.downbeats),n={bpm:s.bpm,confidence:s.confidence,sourceClipId:t,analyzedAt:Date.now()};return this.updateState({isAnalyzing:!1,progress:100,beatMarkers:i,beatAnalysis:n}),s}catch(s){const i=s instanceof Error?s.message:"Beat analysis failed";throw this.updateState({isAnalyzing:!1,progress:0,error:i}),s}}async analyzeAudioBuffer(e,t){this.updateState({isAnalyzing:!0,progress:0,error:null});try{this.updateState({progress:10});const s=await this.engine.analyzeAudioBuffer(e);this.updateState({progress:80});const i=this.convertToBeatMarkers(s.beats,s.downbeats),n={bpm:s.bpm,confidence:s.confidence,sourceClipId:t,analyzedAt:Date.now()};return this.updateState({isAnalyzing:!1,progress:100,beatMarkers:i,beatAnalysis:n}),s}catch(s){const i=s instanceof Error?s.message:"Beat analysis failed";throw this.updateState({isAnalyzing:!1,progress:0,error:i}),s}}convertToBeatMarkers(e,t){const s=new Set(t);return e.map(i=>({time:i.time,strength:i.strength,index:i.index,isDownbeat:s.has(i.time)||i.index%4===0}))}generateManualBeatMarkers(e,t,s=0){const n=this.engine.generateBeatMarkersAtInterval(e,t,s).map(o=>({time:o.time,strength:o.strength,index:o.index,isDownbeat:o.index%4===0})),a={bpm:e,confidence:1,analyzedAt:Date.now()};return this.updateState({beatMarkers:n,beatAnalysis:a}),n}snapTimeToNearestBeat(e){if(!this.options.snapToBeats||this.state.beatMarkers.length===0)return e;const t=this.state.beatMarkers.map(s=>({time:s.time,strength:s.strength,index:s.index}));return this.engine.snapTimeToNearestBeat(e,t,this.options.snapThreshold)}getBeatsInRange(e,t){return this.state.beatMarkers.filter(s=>s.time>=e&&s.time<=t)}getNearestBeat(e){if(this.state.beatMarkers.length===0)return null;let t=this.state.beatMarkers[0],s=Math.abs(t.time-e);for(const i of this.state.beatMarkers){const n=Math.abs(i.time-e);n<s&&(s=n,t=i)}return t}getNextBeat(e){for(const t of this.state.beatMarkers)if(t.time>e)return t;return null}getPreviousBeat(e){let t=null;for(const s of this.state.beatMarkers){if(s.time>=e)break;t=s}return t}generateCutPointsForClips(e,t=4){const s=[],i=this.state.beatMarkers.filter(n=>n.isDownbeat);for(let n=t;n<i.length;n+=t)s.push(i[n].time);return s}clearBeatMarkers(){this.updateState({beatMarkers:[],beatAnalysis:null,error:null})}setBeatMarkers(e,t){this.updateState({beatMarkers:e,beatAnalysis:t})}}let wg=null;function Bp(){return wg||(wg=new hJ),wg}const pJ={threshold:-40,minSilenceDuration:.5,paddingBefore:.1,paddingAfter:.1};class mJ{audioContext=null;getAudioContext(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext}async analyzeClip(e,t,s){const i=U.getState(),n=i.getClip(e);if(!n)throw new Error("Clip not found");const a=i.getMediaItem(n.mediaId);if(!a?.blob)throw new Error("Media blob not found");s?.(10,"Loading audio...");const o=this.getAudioContext(),l=await a.blob.arrayBuffer(),d=await o.decodeAudioData(l);s?.(30,"Detecting silence...");const h=kb().detectSilence(d,t.threshold);s?.(60,"Processing results...");const p=n.inPoint??0,f=(n.outPoint??d.duration)-p,g=h.map(x=>{const v=x.start-p,b=x.end-p,S=Math.max(0,v+t.paddingBefore),k=Math.min(f,b-t.paddingAfter);return{start:S,end:k,duration:k-S}}).filter(x=>x.duration>=t.minSilenceDuration&&x.start>=0&&x.end<=f&&x.start<x.end);s?.(90,"Finalizing...");const y=g.reduce((x,v)=>x+v.duration,0);return s?.(100,"Complete"),{silentRegions:g,totalSilenceDuration:y,clipDuration:f}}async cutSilence(e,t,s){if(t.length===0)return{success:!0};const i=U.getState(),n=i.getClip(e);if(!n)return{success:!1,error:"Clip not found"};const a=n.startTime,o=[...t].sort((d,u)=>u.start-d.start);s?.(0,"Preparing cuts...");const l=i.actionHistory;l.beginGroup("Cut silence");try{for(let d=0;d<o.length;d++){const u=o[d],h=Math.round((d+1)/o.length*100);s?.(h,`Cutting section ${d+1}/${o.length}`);const p=a+u.start,m=a+u.end,f=this.findClipContainingTime(p);if(!f)continue;const g=m-f.startTime;if(g<f.duration&&!(await i.splitClip(f.id,g)).success)continue;const y=this.findClipContainingTime(p);if(!y)continue;const x=p-y.startTime;if(x>0&&!(await i.splitClip(y.id,x)).success)continue;const v=this.findClipInTimeRange(p,m);v&&await i.rippleDeleteClip(v.id)}return s?.(100,"Complete"),{success:!0}}catch(d){return{success:!1,error:d instanceof Error?d.message:"Unknown error occurred"}}finally{l.endGroup()}}findClipContainingTime(e){const t=U.getState(),{project:s}=t;for(const i of s.timeline.tracks)for(const n of i.clips){const a=n.startTime+n.duration;if(e>=n.startTime&&e<a)return n}return null}findClipInTimeRange(e,t){const s=U.getState(),{project:i}=s;for(const n of i.timeline.tracks)for(const a of n.clips){const o=a.startTime+a.duration/2;if(o>=e&&o<t)return a}return null}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}}let kg=null;function z2(){return kg||(kg=new mJ),kg}const wh=({title:r,enabled:e=!0,onToggle:t,defaultOpen:s=!1,children:i})=>{const[n,a]=w.useState(s);return c.jsxs("div",{className:`border rounded-lg overflow-hidden ${e?"border-border":"border-border/50 opacity-60"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary",children:[c.jsxs("button",{onClick:()=>a(!n),className:"flex-1 flex items-center gap-1",children:[c.jsx(ns,{size:12,className:`transition-transform ${n?"":"-rotate-90"} text-text-muted`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:r})]}),t&&c.jsx("button",{onClick:()=>t(!e),className:`w-8 h-4 rounded-full transition-colors ${e?"bg-primary":"bg-background-tertiary border border-border"}`,children:c.jsx("div",{className:`w-3 h-3 rounded-full bg-white shadow-sm transition-transform ${e?"translate-x-4":"translate-x-0.5"}`})})]}),n&&c.jsx("div",{className:"p-3 space-y-3",children:i})]})},fJ=({frequency:r,gain:e,onChange:t})=>{const s=(e+12)/24*100;return c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsxs("div",{className:"h-16 w-4 bg-background-tertiary rounded-full relative overflow-hidden",children:[c.jsx("input",{type:"range",min:-12,max:12,value:e,onChange:i=>t(parseFloat(i.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",style:{writingMode:"vertical-lr",direction:"rtl"}}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-primary/50 rounded-full transition-all",style:{height:`${s}%`}}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-3 h-3 bg-white rounded-full shadow-sm pointer-events-none transition-all",style:{bottom:`calc(${s}% - 6px)`}})]}),c.jsx("span",{className:"text-[8px] text-text-muted",children:r}),c.jsxs("span",{className:"text-[8px] font-mono text-text-secondary",children:[e>0?"+":"",e]})]})},gJ=({clipId:r})=>{const e=U(P=>P.toggleAudioEffect),t=U(P=>P.getAudioEffects),[s,i]=w.useState(!1),[n,a]=w.useState(null),[o,l]=w.useState([{frequency:"60Hz",gain:0},{frequency:"250Hz",gain:0},{frequency:"1kHz",gain:0},{frequency:"4kHz",gain:0},{frequency:"16kHz",gain:0}]),[d,u]=w.useState(!1),[h,p]=w.useState(null),[m,f]=w.useState({threshold:-20,ratio:4,attack:.01,release:.1}),[g,y]=w.useState(!1),[x,v]=w.useState(null),[b,S]=w.useState({roomSize:.5,damping:.5,wetLevel:.3}),[k,C]=w.useState(!1),[A,T]=w.useState(null),[j,_]=w.useState({time:.25,feedback:.3,wetLevel:.25});w.useEffect(()=>{(async()=>{try{await sN()}catch(z){console.error("Failed to initialize AudioBridgeEffects:",z)}})();const W=t(r);for(const z of W)if(z.type==="eq"){i(z.enabled),a(z.id);const G=z.params;G.bands&&l(G.bands.map(ce=>({frequency:M(ce.frequency),gain:ce.gain})))}else if(z.type==="compressor"){u(z.enabled),p(z.id);const G=z.params;f(ce=>({...ce,...G}))}else if(z.type==="reverb"){y(z.enabled),v(z.id);const G=z.params;S(ce=>({...ce,...G}))}else if(z.type==="delay"){C(z.enabled),T(z.id);const G=z.params;_(ce=>({...ce,...G}))}},[r,t]);const M=P=>P>=1e3?`${P/1e3}kHz`:`${P}Hz`,E=P=>P.includes("kHz")?parseFloat(P)*1e3:parseFloat(P),D=w.useCallback(P=>{const W=Dr();if(P&&!n){const z=o.map((ce,ae)=>({type:dd[ae].type,frequency:E(ce.frequency),gain:ce.gain,q:dd[ae].q})),G=W.applyEQ(r,z);G.success&&G.effectId&&a(G.effectId)}else n&&e(r,n,P);i(P)},[r,n,o,e]),R=w.useCallback((P,W)=>{const z=Dr();l(G=>{const ce=G.map((ae,te)=>te===P?{...ae,gain:W}:ae);if(n&&s){const ae=ce.map((te,Ve)=>({type:dd[Ve].type,frequency:E(te.frequency),gain:te.gain,q:dd[Ve].q}));z.updateEQ(r,n,ae)}return ce})},[r,n,s]),B=w.useCallback(P=>{const W=Dr();if(P&&!h){const z=W.applyCompressor(r,m);z.success&&z.effectId&&p(z.effectId)}else h&&e(r,h,P);u(P)},[r,h,m,e]),O=w.useCallback((P,W)=>{const z=Dr();f(G=>{const ce={...G,[P]:W};return h&&d&&z.updateCompressor(r,h,ce),ce})},[r,h,d]),F=w.useCallback(P=>{const W=Dr();if(P&&!x){const z=W.applyReverb(r,b);z.success&&z.effectId&&v(z.effectId)}else x&&e(r,x,P);y(P)},[r,x,b,e]),I=w.useCallback((P,W)=>{const z=Dr();S(G=>{const ce={...G,[P]:W};return x&&g&&z.updateReverb(r,x,ce),ce})},[r,x,g]),K=w.useCallback(P=>{const W=Dr();if(P&&!A){const z=W.applyDelay(r,j);z.success&&z.effectId&&T(z.effectId)}else A&&e(r,A,P);C(P)},[r,A,j,e]),ee=w.useCallback((P,W)=>{const z=Dr();_(G=>{const ce={...G,[P]:W};return A&&k&&z.updateDelay(r,A,ce),ce})},[r,A,k]);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(Tn,{size:14,className:"text-text-secondary"}),c.jsxs("span",{className:"text-[10px] text-text-secondary",children:["Audio clip: ",r.substring(0,8),"..."]})]}),c.jsx(wh,{title:"Equalizer",enabled:s,onToggle:D,defaultOpen:!0,children:c.jsx("div",{className:"flex justify-around py-2",children:o.map((P,W)=>c.jsx(fJ,{frequency:P.frequency,gain:P.gain,onChange:z=>R(W,z)},P.frequency))})}),c.jsx(wh,{title:"Compressor",enabled:d,onToggle:B,children:c.jsxs("div",{className:"space-y-2",children:[c.jsx(ut,{label:"Threshold",value:m.threshold,onChange:P=>O("threshold",P),min:-60,max:0,unit:"dB"}),c.jsx(ut,{label:"Ratio",value:m.ratio,onChange:P=>O("ratio",P),min:1,max:20,step:.5,unit:":1"}),c.jsx(ut,{label:"Attack",value:m.attack*1e3,onChange:P=>O("attack",P/1e3),min:1,max:100,step:1,unit:"ms"}),c.jsx(ut,{label:"Release",value:m.release*1e3,onChange:P=>O("release",P/1e3),min:10,max:1e3,unit:"ms"})]})}),c.jsx(wh,{title:"Reverb",enabled:g,onToggle:F,children:c.jsxs("div",{className:"space-y-2",children:[c.jsx(ut,{label:"Room Size",value:b.roomSize*100,onChange:P=>I("roomSize",P/100),min:0,max:100,unit:"%"}),c.jsx(ut,{label:"Damping",value:b.damping*100,onChange:P=>I("damping",P/100),min:0,max:100,unit:"%"}),c.jsx(ut,{label:"Wet/Dry",value:b.wetLevel*100,onChange:P=>I("wetLevel",P/100),min:0,max:100,unit:"%"})]})}),c.jsx(wh,{title:"Delay",enabled:k,onToggle:K,children:c.jsxs("div",{className:"space-y-2",children:[c.jsx(ut,{label:"Time",value:j.time*1e3,onChange:P=>ee("time",P/1e3),min:1,max:2e3,unit:"ms"}),c.jsx(ut,{label:"Feedback",value:j.feedback*100,onChange:P=>ee("feedback",P/100),min:0,max:95,unit:"%"}),c.jsx(ut,{label:"Wet Level",value:j.wetLevel*100,onChange:P=>ee("wetLevel",P/100),min:0,max:100,unit:"%"})]})})]})},V2={enabled:!1,sourceTrackId:null,threshold:-30,reduction:.7,attack:.1,release:.3,holdTime:.2},U2=[{id:"subtle",name:"Subtle",settings:{threshold:-35,reduction:.4,attack:.15,release:.5}},{id:"moderate",name:"Moderate",settings:{threshold:-30,reduction:.6,attack:.1,release:.3}},{id:"aggressive",name:"Aggressive",settings:{threshold:-25,reduction:.8,attack:.05,release:.2}},{id:"podcast",name:"Podcast",settings:{threshold:-28,reduction:.75,attack:.08,release:.4,holdTime:.3}}],yJ=({clipId:r})=>{const e=U(g=>g.project),[t,s]=w.useState(V2),[i,n]=w.useState(!1),[a,o]=w.useState(!1),l=w.useMemo(()=>e.timeline.tracks.filter(g=>g.type==="audio"),[e.timeline.tracks]),d=w.useMemo(()=>{for(const g of e.timeline.tracks)for(const y of g.clips)if(y.id===r)return g;return null},[e.timeline.tracks,r]),u=w.useMemo(()=>l.filter(g=>g.id!==d?.id),[l,d]),h=w.useCallback((g,y)=>{s(x=>({...x,[g]:y})),a&&o(!1)},[a]),p=w.useCallback(g=>{const y=U2.find(x=>x.id===g);y&&s(x=>({...x,...y.settings}))},[]),m=w.useCallback(()=>{t.sourceTrackId&&(o(!0),U.setState(g=>({project:{...g.project,modifiedAt:Date.now()}})))},[t]),f=w.useCallback(()=>{s(V2),o(!1),U.setState(g=>({project:{...g.project,modifiedAt:Date.now()}}))},[]);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(hp,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Audio Ducking"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Auto-lower music when speech plays"})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${t.enabled?"bg-green-400":"bg-gray-500"}`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:t.enabled?"Ducking Enabled":"Ducking Disabled"})]}),c.jsx("button",{onClick:()=>h("enabled",!t.enabled),className:`relative w-10 h-5 rounded-full transition-colors ${t.enabled?"bg-primary":"bg-background-secondary"}`,children:c.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${t.enabled?"translate-x-5":"translate-x-0.5"}`})})]}),t.enabled&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-[10px] font-medium text-text-secondary flex items-center gap-2",children:[c.jsx(w0,{size:12}),"Trigger Source (Voice Track)"]}),u.length>0?c.jsx("div",{className:"space-y-1",children:u.map(g=>c.jsxs("button",{onClick:()=>h("sourceTrackId",g.id),className:`w-full flex items-center gap-2 p-2 rounded-lg text-left transition-colors ${t.sourceTrackId===g.id?"bg-primary/20 border border-primary":"bg-background-tertiary border border-transparent hover:border-border"}`,children:[c.jsx(Tn,{size:12,className:"text-text-muted"}),c.jsx("span",{className:"flex-1 text-[10px] text-text-primary",children:g.name||`Audio ${g.id.slice(-4)}`}),t.sourceTrackId===g.id&&c.jsx(Ri,{size:12,className:"text-primary"})]},g.id))}):c.jsxs("div",{className:"p-3 bg-background-tertiary rounded-lg text-center",children:[c.jsx(w0,{size:16,className:"mx-auto mb-1 text-text-muted opacity-50"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Add another audio track to use as trigger"})]})]}),t.sourceTrackId&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-[10px] font-medium text-text-secondary flex items-center gap-2",children:[c.jsx(qr,{size:12}),"Ducking Presets"]}),c.jsx("div",{className:"grid grid-cols-2 gap-1",children:U2.map(g=>c.jsx("button",{onClick:()=>p(g.id),className:"p-2 text-[9px] text-text-secondary bg-background-tertiary rounded-lg hover:bg-primary/10 hover:text-primary transition-colors",children:g.name},g.id))})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Detection Threshold"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.threshold," dB"]})]}),c.jsx(rt,{min:-50,max:-10,step:1,value:[t.threshold],onValueChange:g=>h("threshold",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Voice level that triggers ducking"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Volume Reduction"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[Math.round(t.reduction*100),"%"]})]}),c.jsx(rt,{min:0,max:100,step:5,value:[t.reduction*100],onValueChange:g=>h("reduction",g[0]/100)}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"How much to lower background music"})]})]}),c.jsxs("button",{onClick:()=>n(!i),className:"w-full flex items-center gap-2 py-1.5 text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[i?c.jsx(ns,{size:12}):c.jsx(ei,{size:12}),"Timing Controls"]}),i&&c.jsxs("div",{className:"space-y-3 p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Attack"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.attack.toFixed(2),"s"]})]}),c.jsx(rt,{min:.01,max:.5,step:.01,value:[t.attack],onValueChange:g=>h("attack",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"How fast volume drops when voice starts"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Release"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.release.toFixed(2),"s"]})]}),c.jsx(rt,{min:.1,max:1,step:.05,value:[t.release],onValueChange:g=>h("release",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"How fast volume returns after voice stops"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Hold Time"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.holdTime.toFixed(2),"s"]})]}),c.jsx(rt,{min:0,max:.5,step:.05,value:[t.holdTime],onValueChange:g=>h("holdTime",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Minimum time to stay ducked between words"})]})]}),a?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/20 rounded-lg",children:[c.jsx(Ri,{size:12,className:"text-green-400"}),c.jsx("span",{className:"text-[10px] text-green-400",children:"Ducking Applied"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:m,className:"flex items-center justify-center gap-1 py-2 bg-background-tertiary rounded-lg text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(nl,{size:10}),"Update"]}),c.jsx("button",{onClick:f,className:"py-2 bg-red-500/10 border border-red-500/20 rounded-lg text-[10px] text-red-400 hover:bg-red-500/20 transition-colors",children:"Remove"})]})]}):c.jsxs("button",{onClick:m,className:"w-full py-2.5 bg-primary hover:bg-primary-hover rounded-lg text-[11px] font-medium text-white flex items-center justify-center gap-2 transition-colors",children:[c.jsx(hp,{size:14}),"Apply Ducking"]})]})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Automatically reduces music volume when voice is detected"})})]})},xJ=({clipId:r})=>{const{getClip:e,getMediaItem:t}=U(),[s,i]=w.useState(pJ),[n,a]=w.useState(!1),[o,l]=w.useState(!1),[d,u]=w.useState(null),[h,p]=w.useState(0),[m,f]=w.useState(""),g=e(r),y=g?t(g.mediaId):void 0,x=y?.type==="audio"||y?.type==="video",v=w.useCallback(k=>{i(C=>({...C,...k})),u(null)},[]),b=w.useCallback(async()=>{if(r){a(!0),p(0),f("Initializing...");try{const C=await z2().analyzeClip(r,s,(A,T)=>{p(A),f(T)});u(C),C.silentRegions.length===0&&Os.info("No Silence Detected","No silent sections found with current settings. Try lowering the threshold.")}catch(k){console.error("Silence analysis failed:",k),Os.error("Analysis Failed",k instanceof Error?k.message:"Unknown error")}finally{a(!1)}}},[r,s]),S=w.useCallback(async()=>{if(!(!d||d.silentRegions.length===0)){l(!0),p(0),f("Preparing...");try{const C=await z2().cutSilence(r,d.silentRegions,(A,T)=>{p(A),f(T)});C.success?(Os.success("Silence Removed",`Removed ${d.silentRegions.length} silent section${d.silentRegions.length>1?"s":""}`),u(null)):Os.error("Cut Failed",C.error??"Unknown error")}catch(k){console.error("Cut silence failed:",k),Os.error("Cut Failed",k instanceof Error?k.message:"Unknown error")}finally{l(!1)}}},[r,d]);return x?c.jsx("div",{className:"space-y-3",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsxs("label",{className:"text-[10px] text-text-secondary flex items-center gap-1",children:[c.jsx(Tn,{size:10}),"Silence Threshold"]}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.threshold," dB"]})]}),c.jsx(rt,{min:-80,max:-20,step:1,value:[s.threshold],onValueChange:k=>v({threshold:k[0]})}),c.jsx("p",{className:"text-[8px] text-text-muted mt-1",children:"Lower values detect more silence"})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Min Duration"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.minSilenceDuration.toFixed(1),"s"]})]}),c.jsx(rt,{min:.1,max:2,step:.1,value:[s.minSilenceDuration],onValueChange:k=>v({minSilenceDuration:k[0]})}),c.jsx("p",{className:"text-[8px] text-text-muted mt-1",children:"Minimum silence length to detect"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Pad Before"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.paddingBefore.toFixed(1),"s"]})]}),c.jsx(rt,{min:0,max:2,step:.05,value:[s.paddingBefore],onValueChange:k=>v({paddingBefore:k[0]})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Pad After"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.paddingAfter.toFixed(1),"s"]})]}),c.jsx(rt,{min:0,max:2,step:.05,value:[s.paddingAfter],onValueChange:k=>v({paddingAfter:k[0]})})]})]}),d&&c.jsxs("div",{className:"p-2 bg-background-secondary rounded border border-primary/20",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Silent Sections Found"}),c.jsx("span",{className:"text-sm font-bold text-primary",children:d.silentRegions.length})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Total Silence"}),c.jsxs("span",{className:"text-[10px] text-text-primary",children:[d.totalSilenceDuration.toFixed(1),"s of"," ",d.clipDuration.toFixed(1),"s (",Math.round(d.totalSilenceDuration/d.clipDuration*100),"%)"]})]})]}),(n||o)&&c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:m}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[h,"%"]})]}),c.jsx("div",{className:"h-1 bg-background-secondary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${h}%`}})})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:b,disabled:n||o,className:`flex-1 py-2 rounded text-[11px] font-medium transition-colors flex items-center justify-center gap-2 ${d?"bg-background-secondary hover:bg-background-primary border border-border text-text-primary":"bg-primary hover:bg-primary-hover disabled:bg-primary/50 text-white"}`,children:n?c.jsxs(c.Fragment,{children:[c.jsx(_i,{size:14,className:"animate-spin"}),"Analyzing..."]}):c.jsxs(c.Fragment,{children:[c.jsx(Mo,{size:14}),d?"Re-analyze":"Analyze"]})}),d&&d.silentRegions.length>0&&c.jsx("button",{onClick:S,disabled:o,className:"flex-1 py-2 bg-primary hover:bg-primary-hover disabled:bg-primary/50 text-white rounded text-[11px] font-medium transition-colors flex items-center justify-center gap-2",children:o?c.jsxs(c.Fragment,{children:[c.jsx(_i,{size:14,className:"animate-spin"}),"Cutting..."]}):c.jsxs(c.Fragment,{children:[c.jsx(Bx,{size:14}),"Cut ",d.silentRegions.length]})})]}),c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Tip: Use Ctrl+Z to undo all cuts at once"})]})}):null},G2=[{id:"none",label:"None",icon:null},{id:"fade",label:"Fade",icon:c.jsx(Yr,{size:12})},{id:"slide-left",label:"Slide Left",icon:c.jsx(Nx,{size:12})},{id:"slide-right",label:"Slide Right",icon:c.jsx(da,{size:12})},{id:"slide-up",label:"Slide Up",icon:c.jsx(VB,{size:12})},{id:"slide-down",label:"Slide Down",icon:c.jsx(LB,{size:12})},{id:"zoom-in",label:"Zoom In",icon:c.jsx(B$,{size:12})},{id:"zoom-out",label:"Zoom Out",icon:c.jsx($$,{size:12})},{id:"rotate",label:"Rotate",icon:c.jsx(UO,{size:12})},{id:"blur",label:"Blur",icon:c.jsx(PL,{size:12})},{id:"iris-circle",label:"Iris Circle",icon:c.jsx(Wr,{size:12})},{id:"iris-rectangle",label:"Iris Rect",icon:c.jsx(rs,{size:12})},{id:"iris-diamond",label:"Iris Diamond",icon:c.jsx(Hp,{size:12})},{id:"iris-star",label:"Iris Star",icon:c.jsx(xa,{size:12})}],W2=[{id:"linear",label:"Linear"},{id:"ease-in",label:"Ease In"},{id:"ease-out",label:"Ease Out"},{id:"ease-in-out",label:"Ease In Out"}];function bJ(r,e){const t=r.position.x,s=r.position.y,i=.1;return{left:t+.5+i,right:1-t+.5+i,up:s+.5+i,down:1-s+.5+i}}function vJ(r,e,t,s,i){const n=[],a=r.transform,o=r.duration,l=e.duration,d=o-t.duration,u=bJ(a);if(e.preset!=="none")switch(e.preset){case"fade":n.push({id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"slide-left":n.push({id:"kf-entry-pos-0",time:0,property:"position.x",value:a.position.x-u.left,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.x",value:a.position.x,easing:e.easing});break;case"slide-right":n.push({id:"kf-entry-pos-0",time:0,property:"position.x",value:a.position.x+u.right,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.x",value:a.position.x,easing:e.easing});break;case"slide-up":n.push({id:"kf-entry-pos-0",time:0,property:"position.y",value:a.position.y-u.up,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.y",value:a.position.y,easing:e.easing});break;case"slide-down":n.push({id:"kf-entry-pos-0",time:0,property:"position.y",value:a.position.y+u.down,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.y",value:a.position.y,easing:e.easing});break;case"zoom-in":n.push({id:"kf-entry-scale-0",time:0,property:"scale.x",value:.3,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:.3,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"zoom-out":n.push({id:"kf-entry-scale-0",time:0,property:"scale.x",value:1.8,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:1.8,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"rotate":n.push({id:"kf-entry-rot-0",time:0,property:"rotation",value:a.rotation-90,easing:e.easing},{id:"kf-entry-rot-1",time:l,property:"rotation",value:a.rotation,easing:e.easing},{id:"kf-entry-scale-0",time:0,property:"scale.x",value:.5,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:.5,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"blur":n.push({id:"kf-entry-blur-0",time:0,property:"blur",value:30,easing:e.easing},{id:"kf-entry-blur-1",time:l,property:"blur",value:0,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"iris-circle":case"iris-rectangle":case"iris-diamond":case"iris-star":n.push({id:"kf-entry-scale-0",time:0,property:"scale.x",value:0,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:0,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:.5,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break}if(t.preset!=="none")switch(t.preset){case"fade":n.push({id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"slide-left":n.push({id:"kf-exit-pos-0",time:d,property:"position.x",value:a.position.x,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.x",value:a.position.x-u.left,easing:t.easing});break;case"slide-right":n.push({id:"kf-exit-pos-0",time:d,property:"position.x",value:a.position.x,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.x",value:a.position.x+u.right,easing:t.easing});break;case"slide-up":n.push({id:"kf-exit-pos-0",time:d,property:"position.y",value:a.position.y,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.y",value:a.position.y-u.up,easing:t.easing});break;case"slide-down":n.push({id:"kf-exit-pos-0",time:d,property:"position.y",value:a.position.y,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.y",value:a.position.y+u.down,easing:t.easing});break;case"zoom-in":n.push({id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:1.8,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:1.8,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"zoom-out":n.push({id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:.3,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:.3,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"rotate":n.push({id:"kf-exit-rot-0",time:d,property:"rotation",value:a.rotation,easing:t.easing},{id:"kf-exit-rot-1",time:o,property:"rotation",value:a.rotation+90,easing:t.easing},{id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:.5,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:.5,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"blur":n.push({id:"kf-exit-blur-0",time:d,property:"blur",value:0,easing:t.easing},{id:"kf-exit-blur-1",time:o,property:"blur",value:30,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"iris-circle":case"iris-rectangle":case"iris-diamond":case"iris-star":n.push({id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:0,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:0,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:.5,easing:t.easing});break}return n}function wJ(r){const e={preset:"none",duration:.5,easing:"ease-out"},t={preset:"none",duration:.5,easing:"ease-in"},s=r.keyframes||[],i=s.filter(a=>a.id.startsWith("kf-entry-")),n=s.filter(a=>a.id.startsWith("kf-exit-"));if(i.length>0){const a=i.find(f=>f.property==="opacity"),o=i.find(f=>f.property==="position.x"),l=i.find(f=>f.property==="position.y"),d=i.find(f=>f.property==="scale.x"),u=i.find(f=>f.property==="rotation");i.find(f=>f.property==="blur")?e.preset="blur":u?e.preset="rotate":d&&Number(d.value)===0?e.preset="iris-circle":d&&Number(d.value)<1?e.preset="zoom-in":d&&Number(d.value)>1?e.preset="zoom-out":o&&Number(o.value)<r.transform.position.x?e.preset="slide-left":o&&Number(o.value)>r.transform.position.x?e.preset="slide-right":l&&Number(l.value)<r.transform.position.y?e.preset="slide-up":l&&Number(l.value)>r.transform.position.y?e.preset="slide-down":a&&(e.preset="fade");const p=Math.max(...i.map(f=>f.time));p>0&&(e.duration=p);const m=i[0];m&&(e.easing=m.easing)}if(n.length>0){const a=n.find(f=>f.property==="opacity"&&f.time===r.duration),o=n.find(f=>f.property==="position.x"&&f.time===r.duration),l=n.find(f=>f.property==="position.y"&&f.time===r.duration),d=n.find(f=>f.property==="scale.x"&&f.time===r.duration),u=n.find(f=>f.property==="rotation"&&f.time===r.duration);n.find(f=>f.property==="blur"&&f.time===r.duration)?t.preset="blur":u?t.preset="rotate":d&&Number(d.value)===0?t.preset="iris-circle":d&&Number(d.value)>1?t.preset="zoom-in":d&&Number(d.value)<1?t.preset="zoom-out":o&&Number(o.value)<r.transform.position.x?t.preset="slide-left":o&&Number(o.value)>r.transform.position.x?t.preset="slide-right":l&&Number(l.value)<r.transform.position.y?t.preset="slide-up":l&&Number(l.value)>r.transform.position.y?t.preset="slide-down":a&&(t.preset="fade");const p=Math.min(...n.filter(f=>f.id.includes("-0")).map(f=>f.time));p<r.duration&&(t.duration=r.duration-p);const m=n[0];m&&(t.easing=m.easing)}return{entry:e,exit:t}}const kJ=({clipId:r})=>{const{project:e,updateClipKeyframes:t,updateTextClipKeyframes:s,getTextClip:i,getShapeClip:n,getSVGClip:a,getStickerClip:o}=U(),l=me(_=>_.getTitleEngine),d=me(_=>_.getGraphicsEngine),{settings:u}=e,h=w.useMemo(()=>{const _=e.timeline.tracks.flatMap(B=>B.clips).find(B=>B.id===r);if(_)return{type:"regular",data:_};const M=i(r);if(M)return{type:"text",data:M};const E=n(r);if(E)return{type:"shape",data:E};const D=a(r);if(D)return{type:"svg",data:D};const R=o(r);return R?{type:"sticker",data:R}:null},[e.timeline.tracks,r,i,n,a,o,l,e.modifiedAt]),p=h?wJ(h.data):{entry:{preset:"none",duration:.5,easing:"ease-out"},exit:{preset:"none",duration:.5,easing:"ease-in"}},[m,f]=w.useState(p.entry.preset),[g,y]=w.useState(p.entry.duration),[x,v]=w.useState(p.entry.easing),[b,S]=w.useState(p.exit.preset),[k,C]=w.useState(p.exit.duration),[A,T]=w.useState(p.exit.easing),j=w.useCallback(()=>{if(!h)return;const _=(h.data.keyframes||[]).filter(R=>!R.id.startsWith("kf-entry-")&&!R.id.startsWith("kf-exit-"));u.width,u.height,(h.type==="regular"||h.type==="text")&&h.type;const M=vJ(h.data,{preset:m,duration:g,easing:x},{preset:b,duration:k,easing:A}),E=[..._,...M];if(h.type==="text")s(r,E);else if(h.type==="shape"||h.type==="svg"||h.type==="sticker"){const R=d();if(R){const B=h.type==="shape"?R.getShapeClip(r):h.type==="svg"?R.getSVGClip(r):R.getStickerClip(r);B&&(B.keyframes=E,U.setState(O=>({project:{...O.project,modifiedAt:Date.now()}})))}}else t(r,E);const D=[];m!=="none"&&D.push(`Entry: ${m}`),b!=="none"&&D.push(`Exit: ${b}`),D.length>0?Os.success("Clip Animation Applied",D.join(", ")):Os.info("Animations Cleared")},[h,r,m,g,x,b,k,A,t,s,u]);return h?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary uppercase tracking-wider",children:"Entry Animation"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:G2.map(_=>c.jsxs("button",{onClick:()=>f(_.id),className:`flex items-center justify-center gap-1 py-1.5 px-2 rounded text-[9px] transition-all ${m===_.id?"bg-primary text-white font-medium":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary hover:border-text-muted"}`,children:[_.icon,c.jsx("span",{children:_.label})]},`entry-${_.id}`))}),m!=="none"&&c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Duration"}),c.jsx("input",{type:"number",step:"0.1",min:"0.1",max:h.data.duration/2,value:g,onChange:_=>y(parseFloat(_.target.value)||.5),className:"w-full px-2 py-1 text-[10px] bg-background-tertiary border border-border rounded"})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Easing"}),c.jsxs(Pt,{value:x,onValueChange:_=>v(_),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary text-[10px] h-7",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:W2.map(_=>c.jsx(ze,{value:_.id,children:_.label},_.id))})]})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary uppercase tracking-wider",children:"Exit Animation"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:G2.map(_=>c.jsxs("button",{onClick:()=>S(_.id),className:`flex items-center justify-center gap-1 py-1.5 px-2 rounded text-[9px] transition-all ${b===_.id?"bg-primary text-white font-medium":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary hover:border-text-muted"}`,children:[_.icon,c.jsx("span",{children:_.label})]},`exit-${_.id}`))}),b!=="none"&&c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Duration"}),c.jsx("input",{type:"number",step:"0.1",min:"0.1",max:h.data.duration/2,value:k,onChange:_=>C(parseFloat(_.target.value)||.5),className:"w-full px-2 py-1 text-[10px] bg-background-tertiary border border-border rounded"})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Easing"}),c.jsxs(Pt,{value:A,onValueChange:_=>T(_),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary text-[10px] h-7",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:W2.map(_=>c.jsx(ze,{value:_.id,children:_.label},_.id))})]})]})]})]}),c.jsx("button",{onClick:j,className:"w-full py-2 bg-primary hover:bg-primary-hover text-white font-medium rounded-lg text-[11px] transition-all",children:"Apply Transitions"})]}):null},ec=new bM,Wh=[{id:"position.x",label:"Position X",category:"Transform",defaultValue:0,min:-2e3,max:2e3,supportedTrackTypes:["video","image","graphics","text"]},{id:"position.y",label:"Position Y",category:"Transform",defaultValue:0,min:-2e3,max:2e3,supportedTrackTypes:["video","image","graphics","text"]},{id:"scale.x",label:"Scale X",category:"Transform",defaultValue:1,min:0,max:16,step:.01,supportedTrackTypes:["video","image","graphics","text"]},{id:"scale.y",label:"Scale Y",category:"Transform",defaultValue:1,min:0,max:16,step:.01,supportedTrackTypes:["video","image","graphics","text"]},{id:"rotation",label:"Rotation",category:"Transform",defaultValue:0,min:-360,max:360,supportedTrackTypes:["video","image","graphics","text"]},{id:"opacity",label:"Opacity",category:"Transform",defaultValue:1,min:0,max:1,step:.01,supportedTrackTypes:["video","image","graphics","text"]},{id:"effect.brightness",label:"Brightness",category:"Effects",defaultValue:0,min:-100,max:100,supportedTrackTypes:["video","image"]},{id:"effect.contrast",label:"Contrast",category:"Effects",defaultValue:1,min:0,max:2,step:.01,supportedTrackTypes:["video","image"]},{id:"effect.saturation",label:"Saturation",category:"Effects",defaultValue:1,min:0,max:2,step:.01,supportedTrackTypes:["video","image"]},{id:"effect.blur",label:"Blur",category:"Effects",defaultValue:0,min:0,max:100,supportedTrackTypes:["video","image"]},{id:"volume",label:"Volume",category:"Audio",defaultValue:1,min:0,max:2,step:.01,supportedTrackTypes:["audio","video"]},{id:"pan",label:"Pan (Audio L/R)",category:"Audio",defaultValue:0,min:-1,max:1,step:.01,supportedTrackTypes:["audio","video"]}],Y2=r=>r.replace(/([A-Z])/g," $1").replace(/^ease/,"").trim()||r,CJ=({selectedProperty:r,onSelect:e,existingProperties:t})=>{const[s,i]=w.useState(!1),n=[...new Set(Wh.map(o=>o.category))],a=r?Wh.find(o=>o.id===r)?.label||r:"Select Property";return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>i(!s),className:"w-full flex items-center justify-between px-3 py-2 bg-background-tertiary border border-border rounded-lg text-[10px] text-text-primary hover:border-text-secondary transition-colors",children:[c.jsx("span",{children:a}),c.jsx(ns,{size:12,className:`transition-transform ${s?"rotate-180":""}`})]}),s&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),c.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background-secondary border border-border rounded-lg shadow-lg z-20 max-h-64 overflow-y-auto",children:n.map(o=>c.jsxs("div",{children:[c.jsx("div",{className:"px-3 py-1.5 text-[9px] font-medium text-text-muted uppercase tracking-wider bg-background-tertiary",children:o}),Wh.filter(l=>l.category===o).map(l=>{const d=t.includes(l.id);return c.jsxs("button",{onClick:()=>{e(l.id),i(!1)},className:`w-full px-3 py-1.5 text-left text-[10px] hover:bg-background-tertiary transition-colors flex items-center justify-between gap-2 ${r===l.id?"bg-background-tertiary text-primary":"text-text-primary"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[c.jsx("span",{className:"truncate",children:l.label}),l.supportedTrackTypes&&c.jsx("div",{className:"flex gap-0.5 flex-shrink-0",children:l.supportedTrackTypes.map(u=>c.jsx("span",{className:"text-[7px] px-1 py-0.5 rounded bg-background-secondary text-text-muted uppercase font-medium",title:`Works with ${u} tracks`,children:u[0]},u))})]}),d&&c.jsx(Hp,{size:10,className:"text-primary fill-primary flex-shrink-0"})]},l.id)})]},o))})]})]})},q2=({easing:r,size:e=16})=>{const t=s=>{const i={linear:"M0,16 L16,0",easeIn:"M0,16 Q8,16 16,0",easeOut:"M0,16 Q8,0 16,0",easeInOut:"M0,16 Q4,16 8,8 Q12,0 16,0",easeInQuad:"M0,16 C0,16 12,16 16,0",easeOutQuad:"M0,16 C4,0 16,0 16,0",easeInOutQuad:"M0,16 C0,16 6,16 8,8 C10,0 16,0 16,0",easeInCubic:"M0,16 C0,16 14,16 16,0",easeOutCubic:"M0,16 C2,0 16,0 16,0",easeInOutCubic:"M0,16 C0,16 5,16 8,8 C11,0 16,0 16,0",easeInElastic:"M0,16 Q2,18 4,16 Q6,14 8,16 Q12,8 16,0",easeOutElastic:"M0,16 Q4,8 8,0 Q10,2 12,0 Q14,-2 16,0",easeInBounce:"M0,16 L4,16 L6,14 L8,16 L12,8 L16,0",easeOutBounce:"M0,16 L4,8 L8,0 L10,2 L12,0 L14,2 L16,0"};return i[s]||i.linear};return c.jsx("svg",{width:e,height:e,viewBox:"0 0 16 16",className:"text-primary",children:c.jsx("path",{d:t(r),fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})})},SJ=({value:r,onChange:e})=>{const[t,s]=w.useState(!1),i=Y2(r);return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>s(!t),className:"flex items-center gap-1.5 px-2 py-1 bg-background-tertiary border border-border rounded text-[9px] text-text-secondary hover:text-text-primary hover:border-primary/50 transition-colors",title:`Easing: ${i}`,children:[c.jsx(q2,{easing:r,size:14}),c.jsx("span",{children:i}),c.jsx(ns,{size:10})]}),t&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>s(!1)}),c.jsx("div",{className:"absolute top-full right-0 mt-1 bg-background-secondary border border-border rounded-lg shadow-lg z-20 min-w-[160px] max-h-64 overflow-y-auto",children:S9.map(n=>c.jsxs("div",{children:[c.jsx("div",{className:"px-3 py-1 text-[8px] font-medium text-text-muted uppercase tracking-wider bg-background-tertiary sticky top-0",children:n.name}),n.easings.map(a=>c.jsxs("button",{onClick:()=>{e(a),s(!1)},className:`w-full px-3 py-1.5 text-left text-[10px] hover:bg-background-tertiary transition-colors flex items-center gap-2 ${r===a?"text-primary":"text-text-primary"}`,children:[c.jsx(q2,{easing:a,size:14}),Y2(a)]},a))]},n.name))})]})]})},TJ=({keyframe:r,onUpdate:e,onDelete:t,onEasingChange:s,property:i,clipStartTime:n})=>c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg border border-border",children:[c.jsx(Hp,{size:12,className:"text-primary fill-primary flex-shrink-0"}),c.jsx("div",{className:"flex-1 min-w-0",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-text-secondary",title:"Timeline position",children:[(n+r.time).toFixed(2),"s"]}),c.jsx("span",{className:"text-[10px] text-text-muted",children:""}),c.jsx("input",{type:"number",value:typeof r.value=="number"?r.value:0,onChange:a=>e({value:parseFloat(a.target.value)||0}),min:i?.min,max:i?.max,step:i?.step||1,className:"w-16 text-[10px] font-mono text-text-primary bg-background-secondary px-1.5 py-0.5 rounded border border-border outline-none focus:border-primary"})]})}),c.jsx(SJ,{value:r.easing,onChange:s}),c.jsx("button",{onClick:t,className:"p-1 hover:bg-red-500/20 rounded transition-colors text-text-muted hover:text-red-400",title:"Delete keyframe",children:c.jsx(bs,{size:12})})]}),AJ=({clipId:r})=>{const{getClip:e,updateClipKeyframes:t,project:s}=U(),i=Wt(C=>C.playheadPosition),n=me(C=>C.getGraphicsEngine),a=me(C=>C.getTitleEngine),[o,l]=w.useState(null),[d,u]=w.useState(!1);w.useEffect(()=>{const C=()=>{const j=sessionStorage.getItem("openreel_selected_keyframe_property");j&&(l(j),sessionStorage.removeItem("openreel_selected_keyframe_property"))};C();const A=setInterval(C,100),T=setTimeout(()=>clearInterval(A),1e3);return()=>{clearInterval(A),clearTimeout(T)}},[r]);const h=w.useMemo(()=>{const C=e(r);if(C)return C;const A=n(),T=A?.getSVGClip(r);if(T)return T;const j=A?.getShapeClip(r);if(j)return j;const _=A?.getStickerClip(r);if(_)return _;const E=a()?.getTextClip(r);if(E)return E},[r,e,n,a,s.modifiedAt]);w.useEffect(()=>{if(!h||d||!h.keyframes||h.keyframes.length===0)return;const C=h.startTime||0;let A=!1;const T=h.keyframes.map(j=>j.time>=C&&C>0?(A=!0,{...j,time:j.time-C}):j);A&&(console.log(`[KeyframesSection] Migrating ${h.keyframes.length} keyframes from absolute to clip-local time for clip ${r}`),t(r,T)),u(!0)},[h,r,t,d]);const p=h?.keyframes||[],m=w.useMemo(()=>[...new Set(p.map(C=>C.property))],[p]),f=w.useMemo(()=>o?ec.getKeyframesForProperty(p,o):[],[p,o]),g=w.useMemo(()=>Wh.find(C=>C.id===o),[o]),y=w.useMemo(()=>{if(!o)return g?.defaultValue??0;if(f.length===0){if(h?.transform&&(o.startsWith("position.")||o.startsWith("scale.")||o==="rotation"||o==="opacity")){const T=h.transform;switch(o){case"position.x":return T.position.x;case"position.y":return T.position.y;case"scale.x":return T.scale.x;case"scale.y":return T.scale.y;case"rotation":return T.rotation;case"opacity":return T.opacity}}return g?.defaultValue??0}const C=i-(h?.startTime||0);return ec.getValueAtTime(f,C).value},[o,f,i,g,h]),x=w.useMemo(()=>{if(!o)return!1;const C=i-(h?.startTime||0);return f.some(A=>Math.abs(A.time-C)<.01)},[o,f,i,h]),v=w.useCallback(()=>{if(!o||!h)return;const C=i-(h.startTime||0),A=ec.addKeyframe(r,o,C,y,"linear"),T=[...p,A].sort((j,_)=>j.time-_.time);t(r,T)},[r,h,o,i,y,p,t]),b=w.useCallback((C,A)=>{const T=ec.updateKeyframe(p,C,A);t(r,T)},[r,p,t]),S=w.useCallback(C=>{const A=ec.removeKeyframe(p,C);t(r,A)},[r,p,t]),k=w.useCallback((C,A)=>{const T=ec.updateKeyframe(p,C,{easing:A});t(r,T)},[r,p,t]);return h?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-[10px] text-text-secondary font-medium",children:"Animate Property"}),c.jsx(CJ,{selectedProperty:o,onSelect:l,existingProperties:m})]}),o&&c.jsxs("div",{className:"flex items-center justify-between p-2 bg-background-tertiary rounded-lg border border-border",children:[c.jsxs("span",{className:"text-[10px] text-text-secondary",children:["Value at ",i.toFixed(2),"s"]}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary",children:typeof y=="number"?y.toFixed(2):String(y)})]}),o&&c.jsx("button",{onClick:v,disabled:x,className:`w-full py-2 rounded-lg text-[10px] flex items-center justify-center gap-2 transition-colors ${x?"bg-background-tertiary border border-border text-text-muted cursor-not-allowed":"bg-primary/10 border border-primary/30 text-primary hover:bg-primary/20"}`,children:x?c.jsxs(c.Fragment,{children:[c.jsx(Pw,{size:12}),"Keyframe exists at ",i.toFixed(2),"s"]}):c.jsxs(c.Fragment,{children:[c.jsx(Ar,{size:12}),"Add Keyframe at ",i.toFixed(2),"s"]})}),o&&f.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("span",{className:"text-[10px] text-text-secondary font-medium",children:["Keyframes (",f.length,")"]})}),c.jsx("div",{className:"space-y-1.5",children:f.map(C=>c.jsx(TJ,{keyframe:C,property:g,clipStartTime:h?.startTime||0,onUpdate:A=>b(C.id,A),onDelete:()=>S(C.id),onEasingChange:A=>k(C.id,A)},C.id))})]}),!o&&c.jsxs("div",{className:"text-center py-4",children:[c.jsx(Pw,{size:24,className:"mx-auto text-text-muted mb-2"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Select a property to animate"})]}),o&&f.length===0&&c.jsx("p",{className:"text-[10px] text-text-muted text-center py-2",children:"No keyframes for this property. Add one to start animating."})]}):c.jsx("div",{className:"text-[10px] text-text-muted text-center py-4",children:"No clip selected"})},jJ=({clipId:r})=>{const{getClip:e,getTextClip:t,getShapeClip:s,getSVGClip:i,getStickerClip:n,updateClipBlendMode:a,updateClipBlendOpacity:o,project:l}=U(),d=w.useMemo(()=>{const g=e(r);if(g)return g;const y=t(r);if(y)return y;const x=s(r);if(x)return x;const v=i(r);if(v)return v;const b=n(r);return b||null},[r,e,t,s,i,n,l.modifiedAt]),u=d?.blendMode||"normal",h=d?.blendOpacity??100,p=w.useMemo(()=>vW(),[]),m=w.useCallback(g=>{a(r,g)},[r,a]),f=w.useCallback(g=>{o(r,g)},[r,o]);return d?c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Blend Mode"}),c.jsxs(Pt,{value:u,onValueChange:g=>m(g),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:p.map(g=>c.jsx(ze,{value:g,children:wW(g)},g))})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[u==="normal"&&"Default blending, no special effect",u==="multiply"&&"Darkens by multiplying colors",u==="screen"&&"Lightens by screening colors",u==="overlay"&&"Combines multiply and screen",u==="darken"&&"Keeps darker pixels",u==="lighten"&&"Keeps lighter pixels",u==="color-dodge"&&"Brightens base color",u==="color-burn"&&"Darkens base color",u==="hard-light"&&"Strong contrast effect",u==="soft-light"&&"Subtle contrast effect",u==="difference"&&"Subtracts colors",u==="exclusion"&&"Similar to difference but softer"]})]}),c.jsx(ut,{label:"Opacity",value:h,onChange:f,min:0,max:100,step:1,unit:"%"}),u!=="normal"&&c.jsx("div",{className:"p-2 bg-primary/5 border border-primary/20 rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-text-muted",children:[c.jsx("span",{className:"text-primary font-medium",children:"Tip:"})," Blend modes affect how this layer combines with layers below it. Experiment with different modes for creative effects."]})})]}):c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No clip selected"})},_J=({clipId:r})=>{const{getClip:e,getTextClip:t,getShapeClip:s,getSVGClip:i,getStickerClip:n,updateClipRotate3D:a,updateClipPerspective:o,updateClipTransformStyle:l,project:d}=U(),u=w.useMemo(()=>{const b=e(r);if(b)return b;const S=t(r);if(S)return S;const k=s(r);if(k)return k;const C=i(r);if(C)return C;const A=n(r);return A||null},[r,e,t,s,i,n,d.modifiedAt]),h=u?.transform.rotate3d??{x:0,y:0,z:0},p=u?.transform.perspective??1e3,m=u?.transform.transformStyle??"flat",f=w.useCallback(b=>{a(r,{...h,x:b})},[r,h,a]),g=w.useCallback(b=>{a(r,{...h,y:b})},[r,h,a]),y=w.useCallback(b=>{a(r,{...h,z:b})},[r,h,a]),x=w.useCallback(b=>{o(r,b)},[r,o]),v=w.useCallback(b=>{l(r,b)},[r,l]);return u?c.jsxs("div",{className:"space-y-3",children:[c.jsx(ut,{label:"Rotation X",value:h.x,onChange:f,min:-360,max:360,step:1,unit:""}),c.jsx(ut,{label:"Rotation Y",value:h.y,onChange:g,min:-360,max:360,step:1,unit:""}),c.jsx(ut,{label:"Rotation Z",value:h.z,onChange:y,min:-360,max:360,step:1,unit:""}),c.jsx(ut,{label:"Perspective",value:p,onChange:x,min:100,max:2e3,step:10,unit:"px"}),c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Transform Style"}),c.jsxs(Pt,{value:m,onValueChange:b=>v(b),children:[c.jsx(Ct,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"flat",children:"Flat"}),c.jsx(ze,{value:"preserve-3d",children:"Preserve 3D"})]})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[m==="flat"&&"Flattens children into the plane of this element",m==="preserve-3d"&&"Children positioned in 3D space"]})]}),(h.x!==0||h.y!==0||h.z!==0)&&c.jsx("div",{className:"p-2 bg-primary/5 border border-primary/20 rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-text-muted",children:[c.jsx("span",{className:"text-primary font-medium",children:"Tip:"})," 3D rotations allow you to rotate layers along X, Y, and Z axes for depth effects. Adjust perspective to control the 3D depth perception."]})})]}):c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No clip selected"})},EJ="openreel-motion-presets",MJ=1,Lp="userPresets";function PJ(){return new Promise((r,e)=>{const t=indexedDB.open(EJ,MJ);t.onerror=()=>e(t.error),t.onsuccess=()=>r(t.result),t.onupgradeneeded=s=>{const i=s.target.result;i.objectStoreNames.contains(Lp)||i.createObjectStore(Lp,{keyPath:"id"})}})}async function NJ(){try{const r=await PJ();return new Promise((e,t)=>{const n=r.transaction(Lp,"readonly").objectStore(Lp).getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}catch{return[]}}const RJ=[{id:"fade-in",name:"Fade In",category:"entrance",description:"Smooth fade in from transparent",duration:.5,tags:["simple","opacity"],tracks:[{property:"opacity",keyframes:[{time:0,value:0,easing:"ease-out"},{time:.5,value:1}]}]},{id:"slide-in-left",name:"Slide In Left",category:"entrance",description:"Slide in from the left edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:-200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"slide-in-right",name:"Slide In Right",category:"entrance",description:"Slide in from the right edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"slide-in-top",name:"Slide In Top",category:"entrance",description:"Slide in from the top edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.y",keyframes:[{time:0,value:-200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"slide-in-bottom",name:"Slide In Bottom",category:"entrance",description:"Slide in from the bottom edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.y",keyframes:[{time:0,value:200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"scale-in",name:"Scale In",category:"entrance",description:"Pop in with scale animation",duration:.4,tags:["scale","pop"],tracks:[{property:"scale.x",keyframes:[{time:0,value:0,easing:"ease-out-back"},{time:.4,value:1}]},{property:"scale.y",keyframes:[{time:0,value:0,easing:"ease-out-back"},{time:.4,value:1}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.1,value:1}]}]},{id:"pop",name:"Pop",category:"entrance",description:"Quick pop entrance with overshoot",duration:.3,tags:["scale","quick"],tracks:[{property:"scale.x",keyframes:[{time:0,value:.5,easing:"ease-out-back"},{time:.3,value:1}]},{property:"scale.y",keyframes:[{time:0,value:.5,easing:"ease-out-back"},{time:.3,value:1}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.05,value:1}]}]},{id:"bounce-in",name:"Bounce In",category:"entrance",description:"Bouncy scale entrance",duration:.6,tags:["bounce","playful"],tracks:[{property:"scale.x",keyframes:[{time:0,value:0},{time:.4,value:1.15,easing:"ease-out"},{time:.5,value:.9},{time:.6,value:1}]},{property:"scale.y",keyframes:[{time:0,value:0},{time:.4,value:1.15,easing:"ease-out"},{time:.5,value:.9},{time:.6,value:1}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.1,value:1}]}]},{id:"flip-in",name:"Flip In",category:"entrance",description:"3D flip entrance effect",duration:.5,tags:["3d","rotation"],tracks:[{property:"rotation",keyframes:[{time:0,value:-90,easing:"ease-out"},{time:.5,value:0}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.25,value:1}]}]},{id:"blur-in",name:"Blur In",category:"entrance",description:"Fade in with blur effect",duration:.5,tags:["blur","soft"],tracks:[{property:"opacity",keyframes:[{time:0,value:0,easing:"ease-out"},{time:.5,value:1}]},{property:"scale.x",keyframes:[{time:0,value:1.1,easing:"ease-out"},{time:.5,value:1}]},{property:"scale.y",keyframes:[{time:0,value:1.1,easing:"ease-out"},{time:.5,value:1}]}]},{id:"fade-out",name:"Fade Out",category:"exit",description:"Smooth fade out to transparent",duration:.5,tags:["simple","opacity"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:0}]}]},{id:"slide-out-left",name:"Slide Out Left",category:"exit",description:"Slide out to the left edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:0,easing:"ease-in-cubic"},{time:.6,value:-200}],relative:!0},{property:"opacity",keyframes:[{time:.4,value:1},{time:.6,value:0}]}]},{id:"slide-out-right",name:"Slide Out Right",category:"exit",description:"Slide out to the right edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:0,easing:"ease-in-cubic"},{time:.6,value:200}],relative:!0},{property:"opacity",keyframes:[{time:.4,value:1},{time:.6,value:0}]}]},{id:"scale-out",name:"Scale Out",category:"exit",description:"Shrink and fade out",duration:.4,tags:["scale"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in-back"},{time:.4,value:0}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in-back"},{time:.4,value:0}]},{property:"opacity",keyframes:[{time:.3,value:1},{time:.4,value:0}]}]},{id:"shrink",name:"Shrink",category:"exit",description:"Quick shrink exit",duration:.3,tags:["scale","quick"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.3,value:.5}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.3,value:.5}]},{property:"opacity",keyframes:[{time:0,value:1},{time:.3,value:0}]}]},{id:"blur-out",name:"Blur Out",category:"exit",description:"Fade out with blur effect",duration:.5,tags:["blur","soft"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:0}]},{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.1}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.1}]}]},{id:"pulse",name:"Pulse",category:"emphasis",description:"Subtle pulsing scale effect",duration:.8,tags:["attention","loop"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in-out"},{time:.4,value:1.1},{time:.8,value:1}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in-out"},{time:.4,value:1.1},{time:.8,value:1}]}]},{id:"shake",name:"Shake",category:"emphasis",description:"Quick horizontal shake",duration:.5,tags:["attention","error"],tracks:[{property:"position.x",keyframes:[{time:0,value:0},{time:.1,value:-10},{time:.2,value:10},{time:.3,value:-10},{time:.4,value:10},{time:.5,value:0}],relative:!0}]},{id:"bounce",name:"Bounce",category:"emphasis",description:"Bouncing attention effect",duration:.6,tags:["attention","playful"],tracks:[{property:"position.y",keyframes:[{time:0,value:0},{time:.2,value:-20,easing:"ease-out"},{time:.4,value:0,easing:"ease-in"},{time:.5,value:-10,easing:"ease-out"},{time:.6,value:0,easing:"ease-in"}],relative:!0}]},{id:"wiggle",name:"Wiggle",category:"emphasis",description:"Playful wiggle rotation",duration:.6,tags:["attention","playful"],tracks:[{property:"rotation",keyframes:[{time:0,value:0},{time:.1,value:-5},{time:.2,value:5},{time:.3,value:-5},{time:.4,value:5},{time:.5,value:-2},{time:.6,value:0}],relative:!0}]},{id:"rubber-band",name:"Rubber Band",category:"emphasis",description:"Elastic stretch effect",duration:.6,tags:["attention","playful"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1},{time:.2,value:1.25},{time:.35,value:.85},{time:.5,value:1.1},{time:.6,value:1}]},{property:"scale.y",keyframes:[{time:0,value:1},{time:.2,value:.85},{time:.35,value:1.15},{time:.5,value:.95},{time:.6,value:1}]}]},{id:"glow-pulse",name:"Glow Pulse",category:"emphasis",description:"Subtle opacity pulse",duration:1,tags:["attention","subtle"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"ease-in-out"},{time:.5,value:.7},{time:1,value:1}]}]},{id:"cross-dissolve",name:"Cross Dissolve",category:"transition",description:"Simple opacity crossfade",duration:.5,tags:["simple"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"linear"},{time:.5,value:0}]}]},{id:"wipe-left",name:"Wipe Left",category:"transition",description:"Wipe transition to the left",duration:.5,tags:["wipe","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:0,easing:"ease-in-out"},{time:.5,value:-100}],relative:!0},{property:"opacity",keyframes:[{time:.3,value:1},{time:.5,value:0}]}]},{id:"zoom-transition",name:"Zoom Transition",category:"transition",description:"Zoom out transition",duration:.5,tags:["zoom","scale"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.5}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.5}]},{property:"opacity",keyframes:[{time:.2,value:1},{time:.5,value:0}]}]}];let By=[],Cg=!1;async function IJ(){if(!Cg)try{By=await NJ(),Cg=!0}catch{By=[],Cg=!0}}IJ();function DJ(){return[...RJ,...By]}function FJ(){const r=DJ();return{entrance:r.filter(e=>e.category==="entrance"),exit:r.filter(e=>e.category==="exit"),emphasis:r.filter(e=>e.category==="emphasis"),transition:r.filter(e=>e.category==="transition")}}const BJ=[{id:"entrance",name:"In",icon:da},{id:"exit",name:"Out",icon:Nx},{id:"emphasis",name:"Emphasis",icon:zs},{id:"transition",name:"Transition",icon:nl}];function LJ(r){return{linear:"linear",ease:"ease-in-out","ease-in":"ease-in","ease-out":"ease-out","ease-in-out":"ease-in-out","ease-in-cubic":"ease-in","ease-out-cubic":"ease-out","ease-in-out-cubic":"ease-in-out","ease-out-back":"ease-out","ease-in-back":"ease-in"}[r]||"ease-in-out"}function OJ(r,e,t,s,i,n){const a=[],o=i||r.duration,l=s==="entrance"?"motion-in":s==="exit"?"motion-out":"motion-emphasis";let d=0;s==="exit"?d=e-o:s==="emphasis"&&(d=(e-o)/2);const u=i?i/r.duration:1,h=n?.width||1920,p=n?.height||1080;for(const m of r.tracks)for(let f=0;f<m.keyframes.length;f++){const g=m.keyframes[f],y=Math.min(e,d+g.time*u),x=LJ(g.easing||"ease-out");let v=g.value;if(m.relative)switch(m.property){case"position.x":{if(g.value!==0){const b=g.value>0?1:-1,S=h+100;v=t.position.x+b*S}else v=t.position.x;break}case"position.y":{if(g.value!==0){const b=g.value>0?1:-1,S=p+100;v=t.position.y+b*S}else v=t.position.y;break}case"rotation":v=t.rotation+g.value;break}else m.property==="opacity"&&g.value===1?v=t.opacity:(m.property==="scale.x"||m.property==="scale")&&g.value===1?v=t.scale.x:m.property==="scale.y"&&g.value===1&&(v=t.scale.y);a.push({id:`${l}-${m.property}-${f}-${dt().slice(0,4)}`,time:y,property:m.property,value:v,easing:x})}return a}function $J(r){const e=[];for(let s=0;s<=10;s++){const i=s/10,n=i*r.duration;let a=1,o=0,l=0,d=1,u=1,h=0;for(const p of r.tracks){let m=0;const f=p.keyframes.filter(y=>y.time<=n),g=p.keyframes.filter(y=>y.time>n);if(f.length>0&&g.length>0){const y=f[f.length-1],x=g[0],v=(n-y.time)/(x.time-y.time);m=y.value+(x.value-y.value)*v}else f.length>0?m=f[f.length-1].value:g.length>0&&(m=g[0].value);switch(p.property){case"opacity":a=m;break;case"position.x":o=m*.3;break;case"position.y":l=m*.3;break;case"scale":case"scale.x":d=m;break;case"scale.y":u=m;break;case"rotation":h=m;break}}e.push({opacity:a,transform:`translate(${o}px, ${l}px) scale(${d}, ${u}) rotate(${h}deg)`,offset:i})}return e}const zJ=({preset:r,isApplied:e,onApply:t})=>{const[s,i]=w.useState(!1),n=w.useRef(null),a=w.useRef(null);return w.useEffect(()=>{if(!s||!n.current){a.current&&(a.current.cancel(),a.current=null);return}const o=n.current,l=$J(r);return a.current=o.animate(l,{duration:r.duration*1e3,iterations:1/0,easing:"ease-in-out"}),()=>{a.current?.cancel()}},[s,r]),c.jsxs("button",{onClick:t,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),className:`relative w-full rounded-lg border transition-all overflow-hidden ${e?"border-primary bg-primary/10":"border-border bg-background-tertiary hover:border-primary/50"}`,children:[c.jsxs("div",{className:"relative h-20 bg-gradient-to-br from-background-secondary to-background-tertiary flex items-center justify-center overflow-hidden",children:[c.jsx("div",{ref:n,className:"w-10 h-10 rounded bg-primary/80 flex items-center justify-center",children:c.jsx(ii,{size:16,className:"text-white"})}),e&&c.jsx("div",{className:"absolute top-2 right-2",children:c.jsx(Ri,{size:14,className:"text-primary"})}),s&&!e&&c.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:c.jsx("span",{className:"text-[10px] text-white font-medium px-2 py-1 bg-primary rounded",children:"Apply"})})]}),c.jsxs("div",{className:"p-2 text-left",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary block truncate",children:r.name}),c.jsxs("span",{className:"text-[8px] text-text-muted",children:[r.duration,"s"]})]})]})},VJ=({clipId:r})=>{const e=ft(k=>k.getSelectedClipIds()),t=U(k=>k.project),s=U(k=>k.updateClipKeyframes),i=U(k=>k.updateTextClipKeyframes),n=U(k=>k.getTextClip),a=U(k=>k.getShapeClip),o=U(k=>k.getSVGClip),l=U(k=>k.getStickerClip),d=me(k=>k.getGraphicsEngine),[u,h]=w.useState("entrance"),p={},m=r||e[0],g=w.useMemo(()=>FJ(),[])[u]||[],y=w.useMemo(()=>{if(!m)return null;const k=t.timeline.tracks.flatMap(_=>_.clips).find(_=>_.id===m);if(k)return{type:"regular",data:k};const C=n(m);if(C)return{type:"text",data:C};const A=a(m);if(A)return{type:"shape",data:A};const T=o(m);if(T)return{type:"svg",data:T};const j=l(m);return j?{type:"sticker",data:j}:null},[m,t.timeline.tracks,n,a,o,l,t.modifiedAt]),v=w.useCallback(()=>{if(!y)return{entrance:null,exit:null,emphasis:null};const k=y.data.keyframes||[],C=k.some(j=>j.id.startsWith("motion-in-")),A=k.some(j=>j.id.startsWith("motion-out-")),T=k.some(j=>j.id.startsWith("motion-emphasis-"));return{entrance:C?"applied":null,exit:A?"applied":null,emphasis:T?"applied":null}},[y])(),b=w.useCallback(k=>{if(!y||!m)return;const C=k.category==="entrance"?"motion-in-":k.category==="exit"?"motion-out-":"motion-emphasis-",A=(y.data.keyframes||[]).filter(D=>!D.id.startsWith(C)),T=y.data.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1},j=p[k.id],_={width:t.settings.width,height:t.settings.height},M=OJ(k,y.data.duration,T,k.category,j,_),E=[...A,...M];if(y.type==="text")i(m,E);else if(y.type==="shape"||y.type==="svg"||y.type==="sticker"){const D=d();if(D){const R=y.type==="shape"?D.getShapeClip(m):y.type==="svg"?D.getSVGClip(m):D.getStickerClip(m);R&&(R.keyframes=E,U.setState(B=>({project:{...B.project,modifiedAt:Date.now()}})))}}else s(m,E);Os.success("Motion Preset Applied",`${k.name} added to clip`)},[y,m,p,s,i,d,t.settings]),S=w.useCallback(k=>{if(!y||!m)return;const C=k==="entrance"?"motion-in-":k==="exit"?"motion-out-":"motion-emphasis-",A=(y.data.keyframes||[]).filter(T=>!T.id.startsWith(C));if(y.type==="text")i(m,A);else if(y.type==="shape"||y.type==="svg"||y.type==="sticker"){const T=d();if(T){const j=y.type==="shape"?T.getShapeClip(m):y.type==="svg"?T.getSVGClip(m):T.getStickerClip(m);j&&(j.keyframes=A,U.setState(_=>({project:{..._.project,modifiedAt:Date.now()}})))}}else s(m,A);Os.info("Preset Removed")},[y,m,s,i,d]);return m?y?c.jsxs("div",{className:"space-y-4",children:[(v.entrance||v.exit||v.emphasis)&&c.jsxs("div",{className:"space-y-1 p-2 bg-background-tertiary rounded-lg border border-border",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Applied Animations"}),c.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[v.entrance&&c.jsxs("button",{onClick:()=>S("entrance"),className:"flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 rounded text-[9px] hover:bg-green-500/30",children:[c.jsx(da,{size:10}),"Entry "]}),v.exit&&c.jsxs("button",{onClick:()=>S("exit"),className:"flex items-center gap-1 px-2 py-1 bg-red-500/20 text-red-400 rounded text-[9px] hover:bg-red-500/30",children:[c.jsx(Nx,{size:10}),"Exit "]}),v.emphasis&&c.jsxs("button",{onClick:()=>S("emphasis"),className:"flex items-center gap-1 px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-[9px] hover:bg-yellow-500/30",children:[c.jsx(zs,{size:10}),"Emphasis "]})]})]}),c.jsx("div",{className:"flex gap-1",children:BJ.map(k=>{const C=k.icon,A=k.id==="entrance"&&v.entrance||k.id==="exit"&&v.exit||k.id==="emphasis"&&v.emphasis||k.id==="transition"&&v.emphasis;return c.jsxs("button",{onClick:()=>h(k.id),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[10px] whitespace-nowrap transition-colors relative ${u===k.id?"bg-primary text-white font-medium":"bg-background-tertiary text-text-secondary hover:text-text-primary"}`,children:[c.jsx(C,{size:12}),k.name,A&&c.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full"})]},k.id)})}),c.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-72 overflow-y-auto",children:g.map(k=>{const C=k.category==="entrance"?"entrance":k.category==="exit"?"exit":"emphasis";return c.jsx(zJ,{preset:k,isApplied:!!v[C],onApply:()=>b(k)},k.id)})}),c.jsxs("p",{className:"text-[9px] text-text-muted text-center",children:[g.length," presets in ",u]})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(zs,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Clip not found"})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(zs,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Select a clip to apply motion presets"})]})},UJ=({clipId:r})=>{const{getClip:e,project:t}=U(),{motionPathMode:s,motionPathClipId:i,setMotionPathMode:n}=ft(),a=me(_=>_.getGraphicsEngine),o=me(_=>_.getTitleEngine),[l,d]=w.useState(0),u=w.useMemo(()=>{const _=e(r);if(_)return _;const M=a(),E=M?.getSVGClip(r);if(E)return E;const D=M?.getShapeClip(r);if(D)return D;const R=M?.getStickerClip(r);if(R)return R;const O=o()?.getTextClip(r);if(O)return O},[r,e,a,o,t.modifiedAt]),h=w.useMemo(()=>rX(),[]),p=w.useMemo(()=>h.getMotionPath(r),[r,h,l]),m=s&&i===r,f=w.useCallback(_=>{if(_){const M=h.getMotionPath(r);if(M)h.setMotionPath(r,{...M,enabled:!0});else{const E=[{x:0,y:0,time:0},{x:100,y:0,time:1}];h.setMotionPath(r,{enabled:!0,pathType:"bezier",points:ky(E),showPath:!0,autoOrient:!1,alignOrigin:[.5,.5]})}}else{const M=h.getMotionPath(r);M&&h.setMotionPath(r,{...M,enabled:!1})}d(M=>M+1)},[r,h]),g=w.useCallback(_=>{const M=h.getMotionPath(r);M&&(h.setMotionPath(r,{...M,showPath:_}),d(E=>E+1))},[r,h]),y=w.useCallback(_=>{const M=h.getMotionPath(r);M&&(h.setMotionPath(r,{...M,autoOrient:_}),d(E=>E+1))},[r,h]),x=w.useCallback(_=>{const M=h.getMotionPath(r);M&&(h.setMotionPath(r,{...M,pathType:_}),d(E=>E+1))},[r,h]),v=w.useCallback(()=>{m?n(!1):n(!0,r)},[m,r,n]),b=w.useCallback(()=>{const _=h.getMotionPath(r);if(!_)return;const M=_.points[_.points.length-1],E={x:M.x+50,y:M.y,time:Math.min(1,M.time+.2)};h.addGSAPMotionPathPoint(r,E),d(D=>D+1)},[r,h]),S=w.useCallback(()=>{h.removeMotionPath(r),n(!1),d(_=>_+1)},[r,h,n]);if(!u)return c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No clip selected"});const k=p?.enabled??!1,C=p?.showPath??!0,A=p?.autoOrient??!1,T=p?.pathType??"bezier",j=p?.points.length??0;return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Rw,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-xs font-medium text-text-primary",children:"Motion Path"})]}),c.jsx(wa,{checked:k,onCheckedChange:f})]}),k&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"p-3 bg-background-tertiary rounded-lg space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Show Path"}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("button",{onClick:()=>g(!C),className:`p-1.5 rounded transition-colors ${C?"bg-primary/20 text-primary":"bg-background-elevated text-text-muted"}`,children:C?c.jsx(Yr,{size:12}):c.jsx(ya,{size:12})})})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Auto Orient"}),c.jsx(wa,{checked:A,onCheckedChange:y})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Path Type"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:["linear","bezier","catmull-rom"].map(_=>c.jsx("button",{onClick:()=>x(_),className:`py-1.5 rounded text-[9px] capitalize transition-colors ${T===_?"bg-primary text-white":"bg-background-elevated border border-border text-text-secondary hover:text-text-primary"}`,children:_==="catmull-rom"?"Smooth":_},_))})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Path Points"}),c.jsxs("p",{className:"text-sm font-medium text-text-primary",children:[j," points"]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:b,className:"p-1.5 rounded bg-primary/20 text-primary hover:bg-primary/30 transition-colors",title:"Add point",children:c.jsx(Ar,{size:12})}),c.jsx("button",{onClick:S,className:"p-1.5 rounded bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-colors",title:"Clear path",children:c.jsx(bs,{size:12})})]})]}),c.jsxs(Rt,{onClick:v,className:`w-full ${m?"bg-primary text-white":"bg-background-tertiary text-text-primary border border-border hover:bg-background-elevated"}`,size:"sm",children:[c.jsx(Rw,{size:14,className:"mr-2"}),m?"Exit Edit Mode":"Edit Path on Canvas"]}),m&&c.jsx("div",{className:"p-2 bg-primary/10 border border-primary/30 rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-primary",children:[c.jsx("span",{className:"font-medium",children:"Editing:"})," Click on the path to add points. Drag points to move them. Right-click to remove. Drag handles to adjust curves."]})}),c.jsx("div",{className:"p-2 bg-background-tertiary/50 border border-border rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-text-muted",children:[c.jsx("span",{className:"text-text-secondary font-medium",children:"Tip:"})," ","Motion paths animate the clip's position along a curved path over time. Use bezier handles for smooth curves."]})})]})]})},kh=r=>{const e=Math.floor(r/60),t=(r%60).toFixed(1);return e>0?`${e}:${t.padStart(4,"0")}`:`${t}s`},H2=[{category:"Attention",animations:[{type:"pulse",label:"Pulse",description:"Gentle scale breathing effect"},{type:"heartbeat",label:"Heartbeat",description:"Double-beat pulse like a heart"},{type:"flash",label:"Flash",description:"Opacity pulsing effect"},{type:"glow",label:"Glow",description:"Scale and opacity pulse"},{type:"breathe",label:"Breathe",description:"Slow, calming scale effect"}]},{category:"Movement",animations:[{type:"shake",label:"Shake",description:"Quick side-to-side shake"},{type:"bounce",label:"Bounce",description:"Bouncing up and down"},{type:"float",label:"Float",description:"Gentle floating motion"},{type:"vibrate",label:"Vibrate",description:"Random small movements"},{type:"wave",label:"Wave",description:"Wave-like motion"}]},{category:"Rotation",animations:[{type:"spin",label:"Spin",description:"Continuous rotation"},{type:"swing",label:"Swing",description:"Pendulum-like rotation"},{type:"wobble",label:"Wobble",description:"Wobbling with rotation"},{type:"tilt",label:"Tilt",description:"Slow tilting motion"},{type:"tada",label:"Tada",description:"Attention-grabbing wiggle"}]},{category:"Distortion",animations:[{type:"jello",label:"Jello",description:"Jelly-like squish effect"},{type:"rubber-band",label:"Rubber Band",description:"Stretchy rubber effect"},{type:"flicker",label:"Flicker",description:"Random visibility flicker"}]},{category:"Zoom & Pan",animations:[{type:"zoom-pulse",label:"Zoom Pulse",description:"Scale in and out"},{type:"focus-zoom",label:"Focus Zoom",description:"Zoom to point and back"},{type:"ken-burns",label:"Ken Burns",description:"Slow zoom with pan"},{type:"pan-left",label:"Pan Left",description:"Slow pan to the left"},{type:"pan-right",label:"Pan Right",description:"Slow pan to the right"},{type:"pan-up",label:"Pan Up",description:"Slow pan upward"},{type:"pan-down",label:"Pan Down",description:"Slow pan downward"}]}],X2={type:"none",speed:1,intensity:1,loop:!0},GJ=({clipId:r})=>{const{project:e,updateClipEmphasisAnimation:t}=U(),s=me(h=>h.getTitleEngine),i=me(h=>h.getGraphicsEngine),n=w.useMemo(()=>{const h=e.timeline.tracks.flatMap(v=>v.clips).find(v=>v.id===r);if(h)return h.duration;const m=s()?.getTextClip(r);if(m)return m.duration;const f=i(),g=f?.getShapeClip(r);if(g)return g.duration;const y=f?.getSVGClip(r);if(y)return y.duration;const x=f?.getStickerClip(r);return x?x.duration:5},[r,e.timeline.tracks,s,i,e.modifiedAt]),a=w.useMemo(()=>{const h=e.timeline.tracks.flatMap(v=>v.clips).find(v=>v.id===r);if(h?.emphasisAnimation)return h.emphasisAnimation;const m=s()?.getTextClip(r);if(m?.emphasisAnimation)return m.emphasisAnimation;const f=i(),g=f?.getShapeClip(r);if(g?.emphasisAnimation)return g.emphasisAnimation;const y=f?.getSVGClip(r);if(y?.emphasisAnimation)return y.emphasisAnimation;const x=f?.getStickerClip(r);return x?.emphasisAnimation?x.emphasisAnimation:X2},[r,e.timeline.tracks,s,i,e.modifiedAt]),o=w.useCallback(h=>{const p={...a,...h};t(r,p)},[r,a,t]),l=w.useCallback(h=>{o(h==="focus-zoom"?{type:h,focusPoint:{x:.5,y:.5},zoomScale:1.5,holdDuration:.3,loop:!1}:h==="ken-burns"?{type:h,loop:!1}:{type:h})},[o]),d=w.useCallback(()=>{o(X2)},[o]),u=H2.flatMap(h=>h.animations).find(h=>h.type===a.type);return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:()=>l("none"),className:`py-2 rounded-lg text-[10px] font-medium transition-all ${a.type==="none"?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:"None"}),c.jsxs("button",{onClick:d,className:"py-2 rounded-lg text-[10px] font-medium bg-background-tertiary border border-border text-text-secondary hover:text-text-primary transition-all flex items-center justify-center gap-1",children:[c.jsx(Gi,{size:10}),"Reset"]})]}),H2.map(h=>c.jsxs("div",{children:[c.jsx("h4",{className:"text-[10px] font-medium text-text-muted mb-2",children:h.category}),c.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:h.animations.map(p=>c.jsx("button",{onClick:()=>l(p.type),className:`py-2 px-2 rounded-lg text-[10px] transition-all text-left ${a.type===p.type?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary hover:border-primary/50"}`,children:p.label},p.type))})]},h.category)),a.type!=="none"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[u&&c.jsx("p",{className:"text-[10px] text-text-muted italic",children:u.description}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Speed"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[a.speed.toFixed(1),"x"]})]}),c.jsx(rt,{min:.1,max:3,step:.1,value:[a.speed],onValueChange:h=>o({speed:h[0]})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Intensity"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[Math.round(a.intensity*100),"%"]})]}),c.jsx(rt,{min:.1,max:2,step:.1,value:[a.intensity],onValueChange:h=>o({intensity:h[0]})})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Loop Animation"}),c.jsx("button",{onClick:()=>o({loop:!a.loop}),className:`w-10 h-5 rounded-full transition-colors ${a.loop?"bg-primary":"bg-background-tertiary border border-border"}`,children:c.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-sm transition-transform ${a.loop?"translate-x-5":"translate-x-0.5"}`})})]})]}),c.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[c.jsx(pi,{size:12}),c.jsx("span",{className:"text-[10px] font-medium",children:"Timing"}),c.jsxs("span",{className:"text-[9px] text-text-muted ml-auto",children:["Clip: ",kh(n)]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Start Time"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:kh(a.startTime??0)})]}),c.jsx(rt,{min:0,max:n,step:.1,value:[a.startTime??0],onValueChange:h=>o({startTime:h[0]})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Duration"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:a.animationDuration?kh(a.animationDuration):"Full clip"})]}),c.jsx(rt,{min:0,max:n-(a.startTime??0),step:.1,value:[a.animationDuration??n-(a.startTime??0)],onValueChange:h=>{const p=h[0];o({animationDuration:p>0?p:void 0})}}),c.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted",children:[c.jsx("span",{children:"0s"}),c.jsx("button",{onClick:()=>o({startTime:0,animationDuration:void 0}),className:"text-primary hover:underline",children:"Reset to full clip"}),c.jsx("span",{children:kh(n-(a.startTime??0))})]})]})]}),a.type==="focus-zoom"&&c.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[c.jsx(C0,{size:12}),c.jsx("span",{className:"text-[10px] font-medium",children:"Focus Zoom Settings"})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Zoom Scale"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[(a.zoomScale||1.5).toFixed(1),"x"]})]}),c.jsx(rt,{min:1.1,max:3,step:.1,value:[a.zoomScale||1.5],onValueChange:h=>o({zoomScale:h[0]})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Hold Duration"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[((a.holdDuration||.3)*100).toFixed(0),"%"]})]}),c.jsx(rt,{min:0,max:1,step:.05,value:[a.holdDuration||.3],onValueChange:h=>o({holdDuration:h[0]})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Focus Point"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"X Position"}),c.jsx(rt,{min:0,max:1,step:.05,value:[a.focusPoint?.x||.5],onValueChange:h=>o({focusPoint:{x:h[0],y:a.focusPoint?.y||.5}})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"Y Position"}),c.jsx(rt,{min:0,max:1,step:.05,value:[a.focusPoint?.y||.5],onValueChange:h=>o({focusPoint:{x:a.focusPoint?.x||.5,y:h[0]}})})]})]}),c.jsx("div",{className:"grid grid-cols-3 gap-1 mt-2",children:[{x:0,y:0,label:"TL"},{x:.5,y:0,label:"TC"},{x:1,y:0,label:"TR"},{x:0,y:.5,label:"ML"},{x:.5,y:.5,label:"C"},{x:1,y:.5,label:"MR"},{x:0,y:1,label:"BL"},{x:.5,y:1,label:"BC"},{x:1,y:1,label:"BR"}].map(h=>c.jsx("button",{onClick:()=>o({focusPoint:{x:h.x,y:h.y}}),className:`py-1.5 rounded text-[9px] transition-all ${a.focusPoint?.x===h.x&&a.focusPoint?.y===h.y?"bg-primary text-white":"bg-background-tertiary border border-border text-text-muted hover:text-text-primary"}`,children:h.label},h.label))})]})]})]}),c.jsx("div",{className:"pt-3 border-t border-border",children:c.jsxs("div",{className:"flex items-center gap-2 text-text-muted",children:[c.jsx(zs,{size:10}),c.jsx("span",{className:"text-[9px]",children:"Emphasis animations play while the clip is visible (not during entry/exit)"})]})})]})},WJ=[{id:"correlation",name:"Correlation",description:"Best for high-contrast objects"},{id:"optical-flow",name:"Optical Flow",description:"Good for smooth motion"},{id:"feature",name:"Feature Match",description:"Works with complex textures"}],YJ=({clipId:r})=>{const[e,t]=w.useState({isTracking:!1,progress:0,currentJob:null,trackingData:null,lostFrames:[],error:null}),[s,i]=w.useState({x:100,y:100,width:200,height:200}),[n,a]=w.useState("correlation"),[o,l]=w.useState(70),[d,u]=w.useState(!1),[h,p]=w.useState(0),[m,f]=w.useState(0),[g,y]=w.useState(!0),[x,v]=w.useState(!0),[b,S]=w.useState(0),[k,C]=w.useState(!1),A=dJ();w.useEffect(()=>{const R=A.subscribe(t),B=A.getTrackingDataForClip(r);return B.length>0&&t(O=>({...O,trackingData:B[B.length-1]})),R},[A,r]);const T=w.useCallback(async()=>{try{await A.startTracking(r,s,{frameRate:30,startFrame:0,endFrame:150,algorithm:n,confidenceThreshold:o/100})}catch(R){console.error("Failed to start tracking:",R)}},[A,r,s,n,o]),j=w.useCallback(()=>{e.currentJob&&A.cancelTracking(e.currentJob.id)},[A,e.currentJob]),_=w.useCallback(()=>{A.applyTrackingToClip(r,{x:h,y:m})&&(A.setApplyScale(r,g),A.setApplyRotation(r,x),C(!0))},[A,r,h,m,g,x]),M=w.useCallback(()=>{A.removeAttachment(r),C(!1)},[A,r]),E=w.useCallback((R,B)=>{R==="x"?p(B):f(B),k&&A.setTrackingOffset(r,{x:R==="x"?B:h,y:R==="y"?B:m})},[A,r,k,h,m]),D=e.trackingData!==null||A.hasTrackingData(r);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(C0,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Motion Tracking"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Track objects to attach elements"})]})]}),!e.isTracking&&!D&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-[10px] font-medium text-text-secondary",children:"Tracking Region"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"X Position"}),c.jsx("input",{type:"number",value:s.x,onChange:R=>i({...s,x:Number(R.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Y Position"}),c.jsx("input",{type:"number",value:s.y,onChange:R=>i({...s,y:Number(R.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Width"}),c.jsx("input",{type:"number",value:s.width,onChange:R=>i({...s,width:Number(R.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Height"}),c.jsx("input",{type:"number",value:s.height,onChange:R=>i({...s,height:Number(R.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]})]}),c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Draw region in preview or enter coordinates"})]}),c.jsxs("button",{onClick:()=>u(!d),className:"w-full flex items-center gap-2 py-1.5 text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[d?c.jsx(ns,{size:12}):c.jsx(ei,{size:12}),c.jsx(Jj,{size:12}),"Advanced Options"]}),d&&c.jsxs("div",{className:"space-y-3 p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsx("label",{className:"text-[10px] font-medium text-text-secondary",children:"Algorithm"}),c.jsx("div",{className:"space-y-1",children:WJ.map(R=>c.jsxs("button",{onClick:()=>a(R.id),className:`w-full flex items-center gap-2 p-2 rounded-lg text-left transition-colors ${n===R.id?"bg-primary/20 border border-primary":"bg-background-secondary border border-transparent hover:border-border"}`,children:[c.jsx("div",{className:`w-3 h-3 rounded-full border-2 flex items-center justify-center ${n===R.id?"border-primary":"border-border"}`,children:n===R.id&&c.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:R.name}),c.jsx("p",{className:"text-[8px] text-text-muted",children:R.description})]})]},R.id))})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Confidence Threshold"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[o,"%"]})]}),c.jsx(rt,{min:30,max:95,step:5,value:[o],onValueChange:R=>l(R[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Higher = more accurate but may lose track easier"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Path Smoothing"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary",children:b})]}),c.jsx(rt,{min:0,max:10,step:1,value:[b],onValueChange:R=>S(R[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Reduces jitter in tracking path"})]})]}),c.jsxs("button",{onClick:T,className:"w-full py-2.5 bg-primary hover:bg-primary-hover rounded-lg text-[11px] font-medium text-white flex items-center justify-center gap-2 transition-colors",children:[c.jsx(C0,{size:14}),"Start Tracking"]})]}),e.isTracking&&c.jsxs("div",{className:"space-y-3 p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),c.jsx("span",{className:"text-[11px] font-medium text-primary",children:"Tracking in Progress"})]}),c.jsx("button",{onClick:j,className:"p-1.5 text-text-muted hover:text-red-400 hover:bg-red-400/10 rounded transition-colors",title:"Cancel Tracking",children:c.jsx(ti,{size:14})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[c.jsx("span",{className:"text-text-muted",children:"Analyzing frames..."}),c.jsxs("span",{className:"font-mono text-text-primary",children:[Math.round(e.progress),"%"]})]}),c.jsx("div",{className:"w-full h-2 bg-background-secondary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-200",style:{width:`${e.progress}%`}})})]}),e.lostFrames.length>0&&c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-amber-500/10 border border-amber-500/20 rounded text-[10px] text-amber-400",children:[c.jsx(Po,{size:12}),"Lost tracking on ",e.lostFrames.length," frame(s)"]})]}),e.error&&c.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-[10px] text-red-400",children:[c.jsxs("div",{className:"flex items-center gap-2 font-medium mb-1",children:[c.jsx(Po,{size:12}),"Tracking Failed"]}),c.jsx("p",{className:"text-[9px] text-red-300/80",children:e.error})]}),D&&!e.isTracking&&c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/30 rounded-lg",children:[c.jsx(Ri,{size:14,className:"text-green-400"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[10px] font-medium text-green-400",children:"Tracking Complete"}),e.trackingData&&c.jsxs("p",{className:"text-[9px] text-green-300/70",children:[e.trackingData.keyframes.length," keyframes captured",e.trackingData.lostFrames.length>0&&`  ${e.trackingData.lostFrames.length} frames lost`]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-[10px] font-medium text-text-secondary flex items-center gap-2",children:[c.jsx(ua,{size:12}),"Position Offset"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"X Offset"}),c.jsx("input",{type:"number",value:h,onChange:R=>E("x",Number(R.target.value)),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Y Offset"}),c.jsx("input",{type:"number",value:m,onChange:R=>E("y",Number(R.target.value)),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(ss,{className:"text-[10px] font-medium text-text-secondary",children:"Transform Options"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(T0,{id:"apply-scale",checked:g,onCheckedChange:R=>{const B=R===!0;y(B),k&&A.setApplyScale(r,B)}}),c.jsxs(ss,{htmlFor:"apply-scale",className:"flex items-center gap-1 cursor-pointer",children:[c.jsx(ja,{size:10,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Scale"})]})]}),c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(T0,{id:"apply-rotation",checked:x,onCheckedChange:R=>{const B=R===!0;v(B),k&&A.setApplyRotation(r,B)}}),c.jsxs(ss,{htmlFor:"apply-rotation",className:"flex items-center gap-1 cursor-pointer",children:[c.jsx(Gi,{size:10,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Rotation"})]})]})]})]}),k?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/10 border border-primary/20 rounded-lg",children:[c.jsx(Ri,{size:12,className:"text-primary"}),c.jsx("span",{className:"text-[10px] text-primary",children:"Tracking Applied"})]}),c.jsx("button",{onClick:M,className:"w-full py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-[10px] text-red-400 hover:bg-red-500/20 transition-colors",children:"Remove Tracking"})]}):c.jsx("button",{onClick:_,className:"w-full py-2.5 bg-primary/20 border border-primary/30 rounded-lg text-[11px] font-medium text-primary hover:bg-primary/30 transition-colors",children:"Apply Tracking to Clip"}),c.jsxs("button",{onClick:T,className:"w-full flex items-center justify-center gap-2 py-1.5 text-[9px] text-text-muted hover:text-text-secondary transition-colors",children:[c.jsx(nl,{size:10}),"Re-track with Different Settings"]})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Track objects to pin graphics, text, or effects"})})]})},qJ=({clipId:r})=>{const e=me(T=>T.getNestedSequenceEngine),t=U(T=>T.project),s=ft(T=>T.getSelectedClipIds()),[i,n]=w.useState(null),[a,o]=w.useState(null),[l,d]=w.useState(""),[u,h]=w.useState(null);w.useEffect(()=>{let T=!1;return(async()=>{const _=await e();T||h(_)})(),()=>{T=!0}},[e]);const p=w.useMemo(()=>u?.getAllCompoundClips()||[],[u]),m=w.useMemo(()=>u?u.getInstance(r):null,[u,r]),f=w.useMemo(()=>!u||!m?null:u.getCompoundClip(m.compoundClipId),[u,m]),g=w.useMemo(()=>{const T=[];for(const j of t.timeline.tracks)for(const _ of j.clips)s.includes(_.id)&&T.push({id:_.id,trackId:j.id,startTime:_.startTime,duration:_.duration});return T},[t.timeline.tracks,s]),y=w.useCallback(()=>{if(!u||g.length<2)return;const T=[];for(const _ of t.timeline.tracks)for(const M of _.clips)s.includes(M.id)&&T.push(M);if(T.length<2)return;const j=u.createCompoundClip(T,t.timeline.tracks);U.setState(_=>({project:{..._.project,modifiedAt:Date.now()}})),n(j.id)},[u,g,s,t.timeline.tracks]),x=w.useCallback(()=>{if(!u||!r)return;u.flattenInstance(r)&&U.setState(j=>({project:{...j.project,modifiedAt:Date.now()}}))},[u,r]),v=w.useCallback(T=>{u&&(u.duplicateCompoundClip(T),U.setState(j=>({project:{...j.project,modifiedAt:Date.now()}})))},[u]),b=w.useCallback(T=>{if(!u)return;u.deleteCompoundClip(T)&&(U.setState(_=>({project:{..._.project,modifiedAt:Date.now()}})),i===T&&n(null))},[u,i]),S=w.useCallback(T=>{o(T.id),d(T.name)},[]),k=w.useCallback(()=>{!u||!a||(u.renameCompoundClip(a,l.trim()),U.setState(T=>({project:{...T.project,modifiedAt:Date.now()}})),o(null),d(""))},[u,a,l]),C=w.useCallback(()=>{o(null),d("")},[]),A=T=>{const j=Math.floor(T/60),_=Math.floor(T%60);return`${j}:${_.toString().padStart(2,"0")}`};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(Gs,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Nested Sequences"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Create compound clips from selections"})]})]}),f&&c.jsxs("div",{className:"p-3 bg-primary/10 border border-primary/20 rounded-lg space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Dx,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:f.name})]}),c.jsxs("div",{className:"flex gap-2 text-[9px] text-text-muted",children:[c.jsxs("span",{children:[f.content.clips.length," clips"]}),c.jsx("span",{children:""}),c.jsx("span",{children:A(f.content.duration)})]}),c.jsxs("div",{className:"flex gap-2 pt-1",children:[c.jsxs("button",{onClick:x,className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-background-tertiary rounded text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(ja,{size:10}),"Flatten"]}),c.jsxs("button",{onClick:()=>v(f.id),className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-background-tertiary rounded text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(Eo,{size:10}),"Duplicate"]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Create Compound Clip"}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[g.length," clips selected"]})]}),c.jsxs("button",{onClick:y,disabled:g.length<2,className:`w-full py-2.5 rounded-lg text-[11px] font-medium flex items-center justify-center gap-2 transition-colors ${g.length>=2?"bg-primary/20 border border-primary/30 text-primary hover:bg-primary/20":"bg-background-tertiary text-text-muted cursor-not-allowed"}`,children:[c.jsx(Ar,{size:14}),"Create Compound Clip"]}),g.length<2&&c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Select 2+ clips to create a compound clip"})]}),p.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Compound Clips Library"}),c.jsx("div",{className:"space-y-1.5",children:p.map(T=>{const j=u?.getInstanceCount(T.id)||0,_=i===T.id,M=a===T.id;return c.jsxs("div",{className:"bg-background-tertiary rounded-lg overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 cursor-pointer hover:bg-background-secondary transition-colors",onClick:()=>n(_?null:T.id),children:[c.jsx(ei,{size:12,className:`text-text-muted transition-transform ${_?"rotate-90":""}`}),c.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:T.color}}),M?c.jsx("input",{type:"text",value:l,onChange:E=>d(E.target.value),onClick:E=>E.stopPropagation(),onKeyDown:E=>{E.key==="Enter"&&k(),E.key==="Escape"&&C()},className:"flex-1 bg-background-secondary px-1.5 py-0.5 rounded text-[10px] text-text-primary outline-none border border-primary",autoFocus:!0}):c.jsx("span",{className:"flex-1 text-[10px] text-text-primary truncate",children:T.name}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[j," instance",j!==1?"s":""]})]}),_&&c.jsxs("div",{className:"px-2 pb-2 space-y-2",children:[c.jsxs("div",{className:"flex gap-2 text-[9px] text-text-muted pl-5",children:[c.jsxs("span",{children:[T.content.clips.length," clips"]}),c.jsx("span",{children:""}),c.jsx("span",{children:A(T.content.duration)}),c.jsx("span",{children:""}),c.jsxs("span",{children:[T.content.tracks.length," tracks"]})]}),c.jsx("div",{className:"flex gap-1 pl-5",children:M?c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:E=>{E.stopPropagation(),k()},className:"p-1.5 bg-green-500/20 rounded text-green-400 hover:bg-green-500/30 transition-colors",children:c.jsx(Ri,{size:10})}),c.jsx("button",{onClick:E=>{E.stopPropagation(),C()},className:"p-1.5 bg-red-500/20 rounded text-red-400 hover:bg-red-500/30 transition-colors",children:c.jsx(ti,{size:10})})]}):c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:E=>{E.stopPropagation(),S(T)},className:"p-1.5 bg-background-secondary rounded text-text-muted hover:text-text-primary transition-colors",title:"Rename",children:c.jsx(jO,{size:10})}),c.jsx("button",{onClick:E=>{E.stopPropagation(),v(T.id)},className:"p-1.5 bg-background-secondary rounded text-text-muted hover:text-text-primary transition-colors",title:"Duplicate",children:c.jsx(Eo,{size:10})}),c.jsx("button",{onClick:E=>{E.stopPropagation(),b(T.id)},disabled:j>0,className:`p-1.5 rounded transition-colors ${j>0?"bg-background-secondary text-text-muted cursor-not-allowed opacity-50":"bg-red-500/20 text-red-400 hover:bg-red-500/30"}`,title:j>0?"Cannot delete - has instances":"Delete",children:c.jsx(bs,{size:10})})]})})]})]},T.id)})})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Group clips into reusable compound clips"})})]})},K2=[{id:"brightness",name:"Brightness",effect:{type:"brightness",params:{value:0},enabled:!0}},{id:"contrast",name:"Contrast",effect:{type:"contrast",params:{value:1},enabled:!0}},{id:"saturation",name:"Saturation",effect:{type:"saturation",params:{value:1},enabled:!0}},{id:"exposure",name:"Exposure",effect:{type:"exposure",params:{value:0},enabled:!0}},{id:"blur",name:"Blur",effect:{type:"blur",params:{radius:0},enabled:!0}},{id:"sharpen",name:"Sharpen",effect:{type:"sharpen",params:{amount:0},enabled:!0}},{id:"vignette",name:"Vignette",effect:{type:"vignette",params:{intensity:0},enabled:!0}},{id:"tint",name:"Tint",effect:{type:"tint",params:{color:"#ffffff",strength:0},enabled:!0}}],Q2=[{id:"normal",name:"Normal",group:"Basic"},{id:"multiply",name:"Multiply",group:"Darken"},{id:"screen",name:"Screen",group:"Lighten"},{id:"overlay",name:"Overlay",group:"Contrast"},{id:"darken",name:"Darken",group:"Darken"},{id:"lighten",name:"Lighten",group:"Lighten"},{id:"color-dodge",name:"Color Dodge",group:"Lighten"},{id:"color-burn",name:"Color Burn",group:"Darken"},{id:"hard-light",name:"Hard Light",group:"Contrast"},{id:"soft-light",name:"Soft Light",group:"Contrast"},{id:"difference",name:"Difference",group:"Inversion"},{id:"exclusion",name:"Exclusion",group:"Inversion"},{id:"hue",name:"Hue",group:"Component"},{id:"saturation",name:"Saturation",group:"Component"},{id:"color",name:"Color",group:"Component"},{id:"luminosity",name:"Luminosity",group:"Component"}],HJ=({clipId:r})=>{const e=me(k=>k.getAdjustmentLayerEngine),t=U(k=>k.project),[s,i]=w.useState(null),[n,a]=w.useState(!1),[o,l]=w.useState(null);w.useEffect(()=>{let k=!1;return(async()=>{const A=await e();k||l(A)})(),()=>{k=!0}},[e]);const d=w.useMemo(()=>{for(const k of t.timeline.tracks)for(const C of k.clips)if(C.id===r)return k;return null},[t.timeline.tracks,r]),u=w.useMemo(()=>o?.getAllLayers()||[],[o,t.modifiedAt]),h=w.useMemo(()=>d?o?.getLayersForTrack(d.id)||[]:[],[o,d,t.modifiedAt]),p=w.useCallback(()=>{if(!o||!d)return;const k=d.clips.find(j=>j.id===r),C=k?.startTime||0,A=k?.duration||5,T=o.createAdjustmentLayer(d.id,C,{duration:A,name:`Adjustment ${u.length+1}`});i(T.id),U.setState(j=>({project:{...j.project,modifiedAt:Date.now()}}))},[o,d,r,u.length]),m=w.useCallback(k=>{o&&(o.deleteLayer(k),s===k&&i(null),U.setState(C=>({project:{...C.project,modifiedAt:Date.now()}})))},[o,s]),f=w.useCallback((k,C)=>{o&&(o.setEnabled(k,C),U.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),g=w.useCallback((k,C)=>{o&&(o.setOpacity(k,C),U.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),y=w.useCallback((k,C)=>{o&&(o.setBlendMode(k,C),a(!1),U.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),x=w.useCallback((k,C)=>{if(!o)return;const A=K2.find(T=>T.id===C);A&&(o.addEffect(k,{id:`effect_${Date.now()}`,...A.effect}),U.setState(T=>({project:{...T.project,modifiedAt:Date.now()}})))},[o]),v=w.useCallback((k,C)=>{o&&(o.removeEffect(k,C),U.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),b=w.useCallback(k=>{if(!o)return;const C=o.duplicateLayer(k);C&&i(C.id),U.setState(A=>({project:{...A.project,modifiedAt:Date.now()}}))},[o]),S=k=>{const C=s===k.id;return c.jsxs("div",{className:"bg-background-tertiary rounded-lg overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 cursor-pointer hover:bg-background-secondary transition-colors",onClick:()=>i(C?null:k.id),children:[c.jsx(ei,{size:12,className:`text-text-muted transition-transform ${C?"rotate-90":""}`}),c.jsx(Gs,{size:12,className:"text-indigo-400"}),c.jsx("span",{className:"flex-1 text-[10px] text-text-primary truncate",children:k.name}),c.jsx("button",{onClick:A=>{A.stopPropagation(),f(k.id,!k.enabled)},className:`p-1 rounded transition-colors ${k.enabled?"text-text-primary":"text-text-muted opacity-50"}`,children:k.enabled?c.jsx(Yr,{size:12}):c.jsx(ya,{size:12})})]}),C&&c.jsxs("div",{className:"px-2 pb-2 space-y-3",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Opacity"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[Math.round(k.opacity*100),"%"]})]}),c.jsx(rt,{min:0,max:100,step:1,value:[k.opacity*100],onValueChange:A=>g(k.id,A[0]/100)})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("label",{className:"text-[10px] text-text-secondary flex items-center gap-1",children:[c.jsx(Ud,{size:10}),"Blend Mode"]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>a(!n),className:"w-full flex items-center justify-between p-2 bg-background-secondary rounded text-[10px] text-text-primary hover:bg-background-tertiary transition-colors",children:[c.jsx("span",{children:Q2.find(A=>A.id===k.blendMode)?.name||"Normal"}),c.jsx(ns,{size:10})]}),n&&c.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background-secondary border border-border rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:Q2.map(A=>c.jsx("button",{onClick:()=>y(k.id,A.id),className:`w-full text-left px-3 py-1.5 text-[10px] hover:bg-background-tertiary transition-colors ${k.blendMode===A.id?"text-indigo-400 bg-indigo-500/10":"text-text-secondary"}`,children:A.name},A.id))})]})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("label",{className:"text-[10px] text-text-secondary flex items-center gap-1",children:[c.jsx(EL,{size:10}),"Effects (",k.effects.length,")"]}),k.effects.length>0&&c.jsx("div",{className:"space-y-1",children:k.effects.map(A=>c.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-background-secondary rounded",children:[c.jsx("span",{className:"text-[9px] text-text-primary capitalize",children:A.type}),c.jsx("button",{onClick:()=>v(k.id,A.id),className:"p-0.5 text-red-400 hover:bg-red-500/20 rounded transition-colors",children:c.jsx(bs,{size:10})})]},A.id))}),c.jsx("div",{className:"grid grid-cols-2 gap-1",children:K2.slice(0,4).map(A=>c.jsxs("button",{onClick:()=>x(k.id,A.id),className:"p-1.5 text-[9px] text-text-secondary bg-background-secondary rounded hover:bg-indigo-500/10 hover:text-indigo-400 transition-colors",children:["+ ",A.name]},A.id))})]}),c.jsxs("div",{className:"flex gap-1 pt-2 border-t border-border",children:[c.jsxs("button",{onClick:()=>b(k.id),className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-background-secondary rounded text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(Eo,{size:10}),"Duplicate"]}),c.jsxs("button",{onClick:()=>m(k.id),className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-red-500/10 rounded text-[10px] text-red-400 hover:bg-red-500/20 transition-colors",children:[c.jsx(bs,{size:10}),"Delete"]})]})]})]},k.id)};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-lg border border-indigo-500/30",children:[c.jsx(Gs,{size:16,className:"text-indigo-400"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Adjustment Layers"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Non-destructive effects on clips below"})]})]}),c.jsxs("button",{onClick:p,disabled:!d,className:`w-full py-2.5 rounded-lg text-[11px] font-medium flex items-center justify-center gap-2 transition-colors ${d?"bg-indigo-500/20 border border-indigo-500/30 text-indigo-400 hover:bg-indigo-500/30":"bg-background-tertiary text-text-muted cursor-not-allowed"}`,children:[c.jsx(Ar,{size:14}),"Add Adjustment Layer"]}),h.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("span",{className:"text-[10px] font-medium text-text-secondary",children:["Track Layers (",h.length,")"]}),c.jsx("div",{className:"space-y-1.5",children:h.map(S)})]}),u.length>h.length&&c.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Other Layers"}),c.jsx("div",{className:"space-y-1.5",children:u.filter(k=>!h.some(C=>C.id===k.id)).map(S)})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Apply color, effects to all clips below"})})]})},XJ={youtube:c.jsx(ji,{size:14}),tiktok:c.jsx(Si,{size:14}),"instagram-reels":c.jsx(Si,{size:14}),"instagram-feed":c.jsx(rs,{size:14}),"instagram-stories":c.jsx(Si,{size:14}),"youtube-shorts":c.jsx(Si,{size:14}),facebook:c.jsx(ji,{size:14}),twitter:c.jsx(ji,{size:14}),linkedin:c.jsx(ji,{size:14})},KJ=({onReframeComplete:r})=>{const e=U(v=>v.updateSettings),[t,s]=w.useState(tq),[i,n]=w.useState(!1),[a,o]=w.useState(!1),[l,d]=w.useState(0),[u,h]=w.useState(""),[p,m]=w.useState("tiktok"),f=w.useCallback(v=>{s(b=>({...b,...v}))},[]),g=w.useCallback(v=>{m(v);const b=sh[v],S=Object.entries(Bl).find(([,k])=>Math.abs(k.ratio-b.ratio)<.01);S&&f({targetAspectRatio:S[0]})},[f]),y=w.useCallback(v=>{m(null),f({targetAspectRatio:v})},[f]),x=w.useCallback(async()=>{n(!0),d(0),h("Updating canvas size...");try{const v=Bl[t.targetAspectRatio];console.log("[AutoReframe] Applying canvas size:",{targetAspectRatio:t.targetAspectRatio,targetConfig:v,newDimensions:{width:v.width,height:v.height}}),d(50);const b=await e({width:v.width,height:v.height});console.log("[AutoReframe] Update result:",b),d(100),h("Complete!"),o(!0);const S={keyframes:[],outputWidth:v.width,outputHeight:v.height,success:!0,message:`Canvas resized to ${v.name} (${v.width}x${v.height})`};r?.(S);const k=p?sh[p].name:t.targetAspectRatio;Os.success("Canvas Resized",`Project output size changed to ${k} (${v.width}x${v.height})`)}catch(v){console.error("Canvas resize failed:",v),Os.error("Resize Failed",v instanceof Error?v.message:"Unknown error"),o(!1)}finally{n(!1)}},[t,p,r,e]);return c.jsx("div",{className:"space-y-3",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-text-secondary block mb-2",children:"Platform Presets"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:Object.keys(sh).map(v=>c.jsxs("button",{onClick:()=>g(v),className:`flex items-center gap-1 p-2 rounded text-[9px] transition-colors ${p===v?"bg-primary/20 border border-primary text-text-primary":"bg-background-secondary hover:bg-background-primary border border-transparent text-text-secondary"}`,children:[XJ[v],c.jsx("span",{className:"truncate",children:sh[v].name})]},v))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-text-secondary block mb-2",children:"Aspect Ratio"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:Object.keys(Bl).filter(v=>v!=="custom").map(v=>c.jsx("button",{onClick:()=>y(v),className:`p-2 rounded text-[9px] transition-colors ${t.targetAspectRatio===v&&!p?"bg-primary/20 border border-primary text-text-primary":"bg-background-secondary hover:bg-background-primary border border-transparent text-text-secondary"}`,children:v},v))})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Tracking Speed"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(t.trackingSpeed*100),"%"]})]}),c.jsx(rt,{min:0,max:100,step:1,value:[t.trackingSpeed*100],onValueChange:v=>f({trackingSpeed:v[0]/100})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Smoothing"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(t.smoothing*100),"%"]})]}),c.jsx(rt,{min:0,max:100,step:1,value:[t.smoothing*100],onValueChange:v=>f({smoothing:v[0]/100})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Center Bias"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(t.centerBias*100),"%"]})]}),c.jsx(rt,{min:0,max:100,step:1,value:[t.centerBias*100],onValueChange:v=>f({centerBias:v[0]/100})})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Follow Subject"}),c.jsx("button",{onClick:()=>f({followSubject:!t.followSubject}),className:`w-8 h-4 rounded-full transition-colors ${t.followSubject?"bg-primary":"bg-background-secondary"}`,children:c.jsx("div",{className:`w-3 h-3 rounded-full bg-white transition-transform ${t.followSubject?"translate-x-4":"translate-x-0.5"}`})})]}),i&&c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:u}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[l,"%"]})]}),c.jsx("div",{className:"h-1 bg-background-secondary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${l}%`}})})]}),c.jsx("button",{onClick:x,disabled:i,className:"w-full py-2 rounded text-[11px] font-medium transition-colors flex items-center justify-center gap-2 bg-primary hover:bg-primary-hover disabled:bg-primary/50 text-white",children:i?c.jsxs(c.Fragment,{children:[c.jsx(_i,{size:14,className:"animate-spin"}),"Resizing Canvas..."]}):a?c.jsxs(c.Fragment,{children:[c.jsx(Rx,{size:14}),"Applied - Click to Change Again"]}):c.jsxs(c.Fragment,{children:[c.jsx(ii,{size:14}),"Apply Canvas Size"]})}),c.jsxs("div",{className:"text-[9px] text-text-muted text-center",children:["Output:"," ",Bl[t.targetAspectRatio].width," x"," ",Bl[t.targetAspectRatio].height]})]})})},QJ=({clipId:r,clipDuration:e,clipStartTime:t,effects:s,onAddEffect:i,onUpdateEffect:n,onRemoveEffect:a,onToggleEffect:o,onUpdateTiming:l,onPreviewEffect:d})=>{const[u,h]=w.useState(new Set),[p,m]=w.useState(""),f=w.useCallback(S=>{h(k=>{const C=new Set(k);return C.has(S)?C.delete(S):C.add(S),C})},[]),g=w.useCallback(()=>{if(!p)return;const S=`particle-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,k=cX(p,S,r,t,e);k&&(i(k),h(C=>new Set(C).add(S)))},[p,r,t,e,i]),y=w.useCallback((S,k,C)=>{n(S,{[k]:C})},[n]),x=w.useCallback((S,k,C)=>{const A=t+C;l(S,A,k.duration)},[t,l]),v=w.useCallback((S,k,C)=>{l(S,k.startTime,C)},[l]),b=$P.reduce((S,k)=>(S[k.type]||(S[k.type]=[]),S[k.type].push(k),S),{});return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(Pt,{value:p,onValueChange:m,children:[c.jsx(Ct,{className:"flex-1 h-8 text-xs min-w-0 [&>span]:truncate",children:c.jsx(Nt,{placeholder:"Select effect preset..."})}),c.jsx(St,{children:Object.entries(b).map(([S,k])=>c.jsxs("div",{children:[c.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-text-muted uppercase tracking-wider",children:S}),k.map(C=>c.jsx(ze,{value:C.id,textValue:C.name,children:C.name},C.id))]},S))})]}),c.jsxs(Rt,{variant:"default",size:"sm",onClick:g,disabled:!p,className:"h-8 px-3",children:[c.jsx(Ar,{size:14,className:"mr-1"}),"Add"]})]}),s.length===0?c.jsxs("div",{className:"text-center py-6 text-text-muted text-xs",children:[c.jsx(Xp,{size:24,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:"No particle effects added"}),c.jsx("p",{className:"mt-1 text-[10px]",children:"Select a preset above to add effects"})]}):c.jsx(ha,{className:"max-h-[400px]",children:c.jsx("div",{className:"space-y-2 pr-2",children:s.map(S=>{const k=S.startTime-t;return c.jsxs("div",{className:"bg-background-tertiary rounded-lg border border-border overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[c.jsx("button",{onClick:()=>f(S.id),className:"p-0.5 rounded hover:bg-background-elevated text-text-muted",children:u.has(S.id)?c.jsx(ns,{size:14}):c.jsx(ei,{size:14})}),c.jsx("span",{className:"flex-1 text-xs font-medium text-text-primary capitalize",children:S.type}),d&&c.jsx("button",{onClick:()=>d(S.id),className:"p-1 rounded hover:bg-background-elevated text-text-muted hover:text-primary transition-colors",title:"Preview effect",children:c.jsx(ii,{size:12})}),c.jsx("button",{onClick:()=>o(S.id,!S.enabled),className:`p-1 rounded transition-colors ${S.enabled?"text-primary hover:bg-primary/20":"text-text-muted hover:bg-background-elevated"}`,title:S.enabled?"Disable":"Enable",children:S.enabled?c.jsx(Yr,{size:12}):c.jsx(ya,{size:12})}),c.jsx("button",{onClick:()=>a(S.id),className:"p-1 rounded hover:bg-red-500/20 text-text-muted hover:text-red-400 transition-colors",title:"Remove effect",children:c.jsx(bs,{size:12})})]}),u.has(S.id)&&c.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border/50 pt-3",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx(ss,{className:"text-[10px] text-text-muted mb-1",children:"Start Time (s)"}),c.jsx(Ns,{type:"number",value:k.toFixed(1),onChange:C=>{const A=parseFloat(C.target.value);!isNaN(A)&&A>=0&&A<e&&x(S.id,S,A)},className:"h-7 text-xs",step:.1,min:0,max:e})]}),c.jsxs("div",{children:[c.jsx(ss,{className:"text-[10px] text-text-muted mb-1",children:"Duration (s)"}),c.jsx(Ns,{type:"number",value:S.duration.toFixed(1),onChange:C=>{const A=parseFloat(C.target.value);!isNaN(A)&&A>=.1&&v(S.id,S,A)},className:"h-7 text-xs",step:.1,min:.1})]})]}),c.jsxs(Kd,{children:[c.jsxs(wp,{className:"flex items-center gap-1 text-[10px] text-text-muted hover:text-text-primary",children:[c.jsx(ei,{size:10,className:"transition-transform data-[state=open]:rotate-90"}),"Particle Settings"]}),c.jsxs(Qd,{className:"pt-2 space-y-3",children:[c.jsxs("div",{children:[c.jsxs(ss,{className:"text-[10px] text-text-muted mb-1",children:["Particle Count: ",S.config.particleCount]}),c.jsx(rt,{value:[S.config.particleCount],onValueChange:([C])=>y(S.id,"particleCount",C),min:10,max:500,step:10,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ss,{className:"text-[10px] text-text-muted mb-1",children:["Speed: ",S.config.speed]}),c.jsx(rt,{value:[S.config.speed],onValueChange:([C])=>y(S.id,"speed",C),min:10,max:500,step:10,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ss,{className:"text-[10px] text-text-muted mb-1",children:["Gravity: ",S.config.gravity]}),c.jsx(rt,{value:[S.config.gravity],onValueChange:([C])=>y(S.id,"gravity",C),min:-500,max:500,step:10,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ss,{className:"text-[10px] text-text-muted mb-1",children:["Emission Rate: ",S.config.emissionRate]}),c.jsx(rt,{value:[S.config.emissionRate],onValueChange:([C])=>y(S.id,"emissionRate",C),min:1,max:200,step:1,className:"w-full"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsxs(ss,{className:"text-[10px] text-text-muted mb-1",children:["Min Size: ",S.config.size.min]}),c.jsx(rt,{value:[S.config.size.min],onValueChange:([C])=>y(S.id,"size",{...S.config.size,min:C}),min:1,max:20,step:1,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ss,{className:"text-[10px] text-text-muted mb-1",children:["Max Size: ",S.config.size.max]}),c.jsx(rt,{value:[S.config.size.max],onValueChange:([C])=>y(S.id,"size",{...S.config.size,max:C}),min:1,max:30,step:1,className:"w-full"})]})]}),c.jsxs("div",{children:[c.jsxs(ss,{className:"text-[10px] text-text-muted mb-1",children:["Turbulence: ",S.config.turbulence]}),c.jsx(rt,{value:[S.config.turbulence],onValueChange:([C])=>y(S.id,"turbulence",C),min:0,max:100,step:5,className:"w-full"})]}),c.jsxs("div",{children:[c.jsx(ss,{className:"text-[10px] text-text-muted mb-1",children:"Blend Mode"}),c.jsxs(Pt,{value:S.config.blendMode,onValueChange:C=>y(S.id,"blendMode",C),children:[c.jsx(Ct,{className:"h-7 text-xs",children:c.jsx(Nt,{})}),c.jsxs(St,{children:[c.jsx(ze,{value:"normal",children:"Normal"}),c.jsx(ze,{value:"add",children:"Additive"}),c.jsx(ze,{value:"multiply",children:"Multiply"}),c.jsx(ze,{value:"screen",children:"Screen"})]})]})]})]})]}),c.jsxs(Kd,{children:[c.jsxs(wp,{className:"flex items-center gap-1 text-[10px] text-text-muted hover:text-text-primary",children:[c.jsx(ei,{size:10,className:"transition-transform data-[state=open]:rotate-90"}),"Colors (",S.config.colors.length,")"]}),c.jsx(Qd,{className:"pt-2",children:c.jsxs("div",{className:"flex flex-wrap gap-1",children:[S.config.colors.map((C,A)=>c.jsx(JJ,{color:C,onChange:T=>{const j=[...S.config.colors];j[A]=T,y(S.id,"colors",j)},onRemove:S.config.colors.length>1?()=>{const T=S.config.colors.filter((j,_)=>_!==A);y(S.id,"colors",T)}:void 0},A)),c.jsx("button",{onClick:()=>{const C=[...S.config.colors,"#ffffff"];y(S.id,"colors",C)},className:"w-6 h-6 rounded border border-dashed border-border flex items-center justify-center text-text-muted hover:text-text-primary hover:border-primary transition-colors",children:c.jsx(Ar,{size:12})})]})})]})]})]},S.id)})})})]})},JJ=({color:r,onChange:e,onRemove:t})=>{const[s,i]=w.useState(!1),n=w.useRef(null);return c.jsxs(iM,{open:s,onOpenChange:i,children:[c.jsx(rM,{asChild:!0,children:c.jsx("button",{className:"w-6 h-6 rounded border border-border cursor-pointer hover:ring-2 hover:ring-primary/50 transition-all",style:{backgroundColor:r}})}),c.jsx(xb,{side:"top",align:"start",className:"w-auto p-2",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("input",{ref:n,type:"color",value:r,onChange:a=>e(a.target.value),className:"w-32 h-24 cursor-pointer border-0 p-0"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ns,{type:"text",value:r,onChange:a=>{const o=a.target.value;/^#[0-9A-Fa-f]{6}$/.test(o)&&e(o)},className:"h-7 text-xs font-mono flex-1",placeholder:"#ffffff"}),t&&c.jsx("button",{onClick:()=>{t(),i(!1)},className:"p-1.5 rounded hover:bg-red-500/20 text-text-muted hover:text-red-400 transition-colors",title:"Remove color",children:c.jsx(bs,{size:12})})]})]})})]})},Xn=new kM({width:1920,height:1080}),ct=({title:r,defaultOpen:e=!1,sectionId:t,children:s})=>{const[i,n]=He.useState(e);return c.jsxs("div",{className:"mb-6 transition-all","data-section-id":t,children:[c.jsxs("button",{onClick:()=>n(!i),className:"flex items-center gap-2 text-text-secondary hover:text-text-primary transition-colors mb-3 w-full group",children:[c.jsx(ns,{size:12,className:`transition-transform duration-200 ${i?"":"-rotate-90"} text-text-muted group-hover:text-text-primary`}),c.jsx("span",{className:"text-xs font-medium",children:r})]}),i&&c.jsx("div",{className:"animate-in slide-in-from-top-2 duration-200",children:s})]})},ZJ=()=>c.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center opacity-50",children:[c.jsx("p",{className:"text-sm text-text-secondary mb-2",children:"No selection"}),c.jsx("p",{className:"text-xs text-text-muted",children:"Select a clip to view its properties"})]}),eZ=({clipId:r,clipDuration:e,clipStartTime:t})=>{const[s,i]=He.useState(0),n=He.useMemo(()=>eu(),[]),a=He.useMemo(()=>n.getEffectsForClip(r),[r,n,s]),o=He.useCallback(p=>{n.addEffect(p),i(m=>m+1)},[n]),l=He.useCallback((p,m)=>{n.updateEffect(p,m),i(f=>f+1)},[n]),d=He.useCallback(p=>{n.removeEffect(p),i(m=>m+1)},[n]),u=He.useCallback((p,m)=>{n.toggleEffect(p,m),i(f=>f+1)},[n]),h=He.useCallback((p,m,f)=>{n.updateEffectTiming(p,m,f),i(g=>g+1)},[n]);return c.jsx(QJ,{clipId:r,clipDuration:e,clipStartTime:t,effects:a,onAddEffect:o,onUpdateEffect:l,onRemoveEffect:d,onToggleEffect:u,onUpdateTiming:h})},tZ=()=>{const{getClip:r,getMediaItem:e,addSubtitle:t,updateSubtitle:s,getSubtitle:i}=U(),n=U($=>$.project),{getSelectedClipIds:a}=ft(),o=ft($=>$.selectedItems),l=a(),d=me($=>$.getTitleEngine),u=me($=>$.getGraphicsEngine),[h,p]=w.useState(null),[m,f]=w.useState(!1),[g,y]=w.useState("word-highlight"),x=w.useMemo(()=>o.find(we=>we.type==="subtitle")?.id||null,[o]),v=w.useMemo(()=>x&&i(x)||null,[x,i,n.timeline.subtitles]),b=w.useMemo(()=>{if(l.length!==1)return null;const $=l[0],we=r($);if(we)return we;const fe=d()?.getTextClip($);if(fe)return{id:fe.id,mediaId:`text-${fe.id}`,startTime:fe.startTime,duration:fe.duration,inPoint:0,outPoint:fe.duration,transform:fe.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],text:fe.text,trackId:fe.trackId};const ke=u(),Ge=ke?.getShapeClip($);if(Ge)return{id:Ge.id,mediaId:`shape-${Ge.id}`,startTime:Ge.startTime,duration:Ge.duration,inPoint:0,outPoint:Ge.duration,transform:Ge.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],shapeType:Ge.shapeType,trackId:Ge.trackId};const Je=ke?.getSVGClip($);if(Je)return{id:Je.id,mediaId:`svg-${Je.id}`,startTime:Je.startTime,duration:Je.duration,inPoint:0,outPoint:Je.duration,transform:Je.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],svgContent:Je.svgContent,trackId:Je.trackId};const Tt=ke?.getStickerClip($);return Tt?{id:Tt.id,mediaId:`sticker-${Tt.id}`,startTime:Tt.startTime,duration:Tt.duration,inPoint:0,outPoint:Tt.duration,transform:Tt.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],imageUrl:Tt.imageUrl,trackId:Tt.trackId}:null},[l,r,d,u,n.modifiedAt]),[S,k]=He.useReducer($=>$+1,0),C=b?.id||"",A=w.useMemo(()=>C?Xn.getSettings(C):null,[C,S]),T=U($=>$.updateClipTransform),j=U($=>$.updateShapeTransform),_=w.useCallback($=>{b&&(b.mediaId.startsWith("shape-")||b.mediaId.startsWith("svg-")?j(b.id,$):T(b.id,$))},[b,T,j]),M=w.useCallback($=>{b&&($?Xn.enableChromaKey(b.id):Xn.disableChromaKey(b.id),k())},[b]),E=w.useCallback($=>{if(!b)return;const we=$.replace("#",""),qe=parseInt(we.substring(0,2),16)/255,fe=parseInt(we.substring(2,4),16)/255,ke=parseInt(we.substring(4,6),16)/255;Xn.setKeyColor(b.id,{r:qe,g:fe,b:ke}),k()},[b]),D=w.useCallback($=>{b&&(Xn.setTolerance(b.id,$/100),k())},[b]),{addVideoEffect:R,updateVideoEffect:B}=U(),O=w.useCallback(()=>{b&&(Xn.enableChromaKey(b.id),Xn.setKeyColor(b.id,{r:0,g:1,b:0}),Xn.setTolerance(b.id,.35),k())},[b]),[F,I]=w.useState(!1),[K,ee]=w.useState(!1),P=w.useCallback(async()=>{if(b){I(!0);try{await sN();const $=Dr(),we=dd.map((ke,Ge)=>{let Je=0;return Ge===0&&(Je=-3),Ge===1&&(Je=2),Ge===2&&(Je=4),Ge===3&&(Je=3),Ge===4&&(Je=-2),{...ke,gain:Je}}),qe=$.applyEQ(b.id,we),fe=$.applyCompressor(b.id,{threshold:-18,ratio:3,attack:.005,release:.15});qe.success&&fe.success&&(ee(!0),setTimeout(()=>ee(!1),2e3)),k()}catch($){console.error("Failed to enhance audio:",$)}finally{I(!1)}}},[b,k]),W=w.useCallback(()=>{if(!b)return;R(b.id,"saturation"),R(b.id,"contrast"),R(b.id,"brightness");const $=U.getState().getVideoEffects(b.id),we=$.find(ke=>ke.type==="saturation"),qe=$.find(ke=>ke.type==="contrast"),fe=$.find(ke=>ke.type==="brightness");we&&B(b.id,we.id,{value:1.15}),qe&&B(b.id,qe.id,{value:1.1}),fe&&B(b.id,fe.id,{value:5})},[b,R,B]),z=w.useCallback(async()=>{if(!b||m)return;const $=e(b.mediaId);if(!$){console.error("[Subtitles] No media item found for clip");return}f(!0),p({phase:"extracting",progress:0,message:"Preparing audio..."});try{let we=fY();we||(we=gY({apiEndpoint:"https://transcribe.openreel.video"}));const qe=r(b.id);if(!qe)throw new Error("Could not find clip data");const fe=await we.transcribeClip(qe,$,p);for(const ke of fe)t({...ke,animationStyle:g});p({phase:"complete",progress:100,message:`Added ${fe.length} subtitles`}),setTimeout(()=>{p(null),f(!1)},2e3)}catch(we){console.error("[Subtitles] Transcription failed:",we),p({phase:"error",progress:0,message:we instanceof Error?we.message:"Transcription failed"}),setTimeout(()=>{p(null),f(!1)},3e3)}},[b,m,e,r,t,g]),G={position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,borderRadius:0},ce=b?.transform||G,ae=A?.enabled||!1,te=A?`#${Math.round(A.keyColor.r*255).toString(16).padStart(2,"0")}${Math.round(A.keyColor.g*255).toString(16).padStart(2,"0")}${Math.round(A.keyColor.b*255).toString(16).padStart(2,"0")}`:"#00ff00",Ve=(A?.tolerance||.3)*100,q=w.useMemo(()=>{if(!b)return null;if(b.mediaId.startsWith("text-"))return"text";if(b.mediaId.startsWith("shape-"))return"shape";if(b.mediaId.startsWith("svg-"))return"svg";if(b.mediaId.startsWith("sticker-")||b.mediaId.startsWith("emoji-"))return"sticker";const $=n.timeline.tracks.find(qe=>qe.clips.some(fe=>fe.id===b.id));if(!$)return"video";const we=n.mediaLibrary.items.find(qe=>qe.id===b.mediaId);return $.type==="audio"?"audio":$.type==="image"||we?.type==="image"?"image":"video"},[b,n.timeline.tracks,n.mediaLibrary.items]),oe=q==="video"||q==="image",V=q==="video"||q==="image",he=q==="video"||q==="audio",Se=q==="text",J=q==="shape",be=q==="svg",ie=q==="video"||q==="image",Pe=q==="video"||q==="image"||q==="text"||q==="shape"||q==="svg"||q==="sticker";return c.jsx("div",{"data-tour":"inspector",className:"w-80 bg-background-secondary border-l border-border flex flex-col overflow-y-auto h-full custom-scrollbar",children:c.jsxs("div",{className:"p-5",children:[c.jsx("h3",{className:"text-sm font-bold text-text-primary mb-5 tracking-tight",children:"Inspector"}),b?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"mb-4 p-3 bg-background-tertiary rounded-lg border border-border",children:[c.jsxs("p",{className:"text-xs text-text-primary font-medium truncate",children:[b.id.substring(0,20),"..."]}),c.jsxs("p",{className:"text-[10px] text-text-muted",children:["Duration: ",b.duration.toFixed(2),"s"]})]}),q==="video"&&c.jsx(ct,{title:"AI Auto-Captions",sectionId:"auto-captions",defaultOpen:!1,children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-text-secondary block mb-1",children:"Animation Style"}),c.jsxs(Pt,{value:g,onValueChange:$=>y($),disabled:m,children:[c.jsx(Ct,{className:"w-full bg-background-secondary border-border text-text-primary text-[11px]",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:CC.map($=>c.jsx(ze,{value:$,children:kC($)},$))})]})]}),h?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(_i,{size:12,className:"animate-spin text-primary"}),c.jsx("span",{className:"text-[10px] text-text-primary",children:h.message})]}),c.jsx("div",{className:"h-1.5 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:`h-full transition-all duration-300 ${h.phase==="error"?"bg-red-500":h.phase==="complete"?"bg-green-500":"bg-primary"}`,style:{width:`${h.progress}%`}})})]}):c.jsxs("button",{onClick:z,disabled:m,className:"w-full py-2 bg-primary hover:bg-primary/80 text-black rounded-lg text-[11px] font-medium transition-all flex items-center justify-center gap-2",children:[c.jsx(Ew,{size:14}),"Generate Captions"]})]})}),q==="video"&&c.jsx(ct,{title:"Output Size",sectionId:"output-size",defaultOpen:!1,children:c.jsx(KJ,{clipId:C})}),he&&c.jsx(ct,{title:"Auto Cut Silence",sectionId:"auto-cut-silence",defaultOpen:!1,children:c.jsx(xJ,{clipId:C})}),q==="audio"&&c.jsx(ct,{title:"Beat Sync",sectionId:"beat-sync",defaultOpen:!1,children:c.jsx(eJ,{clipId:C})}),Pe&&c.jsx(ct,{title:"Transform",sectionId:"transform",children:c.jsxs("div",{className:"space-y-3",children:[c.jsx(ut,{label:"Position X",value:ce.position.x,onChange:$=>_({position:{...ce.position,x:$}}),min:-1920,max:1920,step:1,unit:"px"}),c.jsx(ut,{label:"Position Y",value:ce.position.y,onChange:$=>_({position:{...ce.position,y:$}}),min:-1080,max:1080,step:1,unit:"px"}),c.jsx(ut,{label:"Scale X",value:ce.scale.x*100,onChange:$=>_({scale:{...ce.scale,x:$/100}}),min:0,max:300,step:1,unit:"%"}),c.jsx(ut,{label:"Scale Y",value:ce.scale.y*100,onChange:$=>_({scale:{...ce.scale,y:$/100}}),min:0,max:300,step:1,unit:"%"}),c.jsx(ut,{label:"Rotation",value:ce.rotation,onChange:$=>_({rotation:$}),min:-180,max:180,step:1,unit:""}),c.jsx(ut,{label:"Opacity",value:ce.opacity*100,onChange:$=>_({opacity:$/100}),min:0,max:100,step:1,unit:"%"}),c.jsx(ut,{label:"Border Radius",value:ce.borderRadius||0,onChange:$=>_({borderRadius:$}),min:0,max:200,step:1,unit:"px"}),q==="image"&&c.jsxs("div",{className:"space-y-1 pt-2 border-t border-border",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Fit Mode"}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:["contain","cover","stretch","none"].map($=>c.jsx("button",{onClick:()=>_({fitMode:$}),className:`py-1.5 rounded text-[9px] capitalize transition-colors ${(ce.fitMode||"none")===$?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:$==="contain"?"Fit":$==="cover"?"Fill":$},$))})]})]})}),ie&&b&&!b.mediaId.startsWith("text-")&&!b.mediaId.startsWith("shape-")&&!b.mediaId.startsWith("svg-")&&!b.mediaId.startsWith("sticker-")&&c.jsx(ct,{title:"Crop",sectionId:"crop",defaultOpen:!1,children:c.jsx(wQ,{clip:b})}),ie&&b&&!b.mediaId.startsWith("text-")&&!b.mediaId.startsWith("shape-")&&!b.mediaId.startsWith("svg-")&&!b.mediaId.startsWith("sticker-")&&c.jsx(ct,{title:"Speed & Direction",sectionId:"speed",defaultOpen:!0,children:c.jsx(CQ,{clip:b})}),(q==="video"||q==="image"||q==="text"||q==="shape"||q==="svg"||q==="sticker")&&c.jsx(ct,{title:"Blending",sectionId:"blending",defaultOpen:!1,children:c.jsx(jJ,{clipId:C})}),(q==="video"||q==="image"||q==="text"||q==="shape"||q==="svg"||q==="sticker")&&c.jsx(ct,{title:"3D Transforms",sectionId:"transform-3d",defaultOpen:!1,children:c.jsx(_J,{clipId:C})}),c.jsx(ct,{title:"Keyframes",sectionId:"keyframes",children:c.jsx(AJ,{clipId:C})}),(q==="video"||q==="image"||q==="text"||q==="shape"||q==="svg"||q==="sticker")&&c.jsx(ct,{title:"Entry/Exit Transitions",sectionId:"transitions",defaultOpen:!1,children:c.jsx(kJ,{clipId:C})}),(q==="video"||q==="image"||q==="shape"||q==="svg"||q==="sticker")&&c.jsx(ct,{title:"Motion Presets",sectionId:"motion-presets",defaultOpen:!1,children:c.jsx(VJ,{clipId:C})}),(q==="video"||q==="image"||q==="text"||q==="shape"||q==="svg"||q==="sticker")&&c.jsx(ct,{title:"Motion Path",sectionId:"motion-path",defaultOpen:!1,children:c.jsx(UJ,{clipId:C})}),(q==="video"||q==="image"||q==="text"||q==="shape"||q==="svg"||q==="sticker")&&b&&c.jsx(ct,{title:"Particle Effects",sectionId:"particle-effects",defaultOpen:!1,children:c.jsx(eZ,{clipId:C,clipDuration:b.duration,clipStartTime:b.startTime})}),(q==="video"||q==="image"||q==="text"||q==="shape"||q==="svg"||q==="sticker")&&c.jsx(ct,{title:"Emphasis Animation",sectionId:"emphasis-animation",defaultOpen:!1,children:c.jsx(GJ,{clipId:C})}),ie&&c.jsx(ct,{title:"Chroma Key (Green Screen)",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Enable"}),c.jsx(wa,{checked:ae,onCheckedChange:M})]}),ae&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Key Color"}),c.jsx("input",{type:"color",value:te,onChange:$=>E($.target.value),className:"w-8 h-6 rounded border border-border cursor-pointer"})]}),c.jsx(ut,{label:"Tolerance",value:Ve,onChange:D,unit:"%"})]})]})}),ie&&c.jsx(ct,{title:"Motion Tracking",sectionId:"motion-tracking",children:c.jsx(YJ,{clipId:C})}),oe&&c.jsx(ct,{title:"Video Effects",sectionId:"video-effects",children:c.jsx(nQ,{clipId:C})}),oe&&c.jsx(ct,{title:"Green Screen",sectionId:"green-screen",defaultOpen:!1,children:c.jsx(lQ,{clipId:C})}),ie&&c.jsx(ct,{title:"Picture-in-Picture",sectionId:"pip",defaultOpen:!1,children:c.jsx(mQ,{clipId:C})}),ie&&c.jsx(ct,{title:"Masking",sectionId:"masking",defaultOpen:!1,children:c.jsx(hQ,{clipId:C})}),ie&&c.jsx(ct,{title:"Nested Sequences",defaultOpen:!1,children:c.jsx(qJ,{clipId:C})}),ie&&c.jsx(ct,{title:"Adjustment Layers",defaultOpen:!1,children:c.jsx(HJ,{clipId:C})}),V&&c.jsx(ct,{title:"Color Grading",sectionId:"color-grading",defaultOpen:!1,children:c.jsx(IQ,{clipId:C})}),he&&c.jsx(ct,{title:"Audio Effects",sectionId:"audio-effects",defaultOpen:!1,children:c.jsx(gJ,{clipId:C})}),he&&c.jsx(ct,{title:"Audio Ducking",sectionId:"audio-ducking",defaultOpen:!1,children:c.jsx(yJ,{clipId:C})}),Se&&c.jsx(ct,{title:"Text Properties",sectionId:"text-properties",children:c.jsx(LQ,{clipId:C})}),Se&&c.jsx(ct,{title:"Text Animation",sectionId:"text-animation",defaultOpen:!1,children:c.jsx(zQ,{clipId:C})}),J&&c.jsx(ct,{title:"Shape Properties",sectionId:"shape-properties",children:c.jsx(iJ,{clipId:C})}),be&&c.jsx(ct,{title:"SVG Properties",children:c.jsx(nJ,{clipId:C})}),(ie||he||oe)&&c.jsxs("div",{className:"border border-primary/30 bg-primary/5 rounded-xl p-4 relative overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 text-primary mb-3",children:[c.jsx(zs,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:"Quick Actions"})]}),c.jsxs("div",{className:"space-y-2",children:[ie&&c.jsx("button",{onClick:O,className:"w-full py-2 bg-background-tertiary hover:bg-primary hover:text-white border border-border hover:border-primary rounded-lg text-[10px] transition-all",children:"Remove Background"}),he&&c.jsx("button",{onClick:P,disabled:F,className:`w-full py-2 border rounded-lg text-[10px] transition-all flex items-center justify-center gap-1.5 ${K?"bg-green-500/20 border-green-500 text-green-400":F?"bg-background-tertiary border-border text-text-muted cursor-not-allowed":"bg-background-tertiary hover:bg-primary hover:text-white border-border hover:border-primary"}`,children:F?c.jsxs(c.Fragment,{children:[c.jsx(_i,{size:12,className:"animate-spin"}),"Enhancing..."]}):K?" Enhanced":"Enhance Audio"}),oe&&c.jsx("button",{onClick:W,className:"w-full py-2 bg-background-tertiary hover:bg-primary hover:text-white border border-border hover:border-primary rounded-lg text-[10px] transition-all",children:"Auto-Color"})]})]})]}):v?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"mb-4 p-3 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx(Ew,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-xs font-bold text-primary",children:"Subtitle"})]}),c.jsxs("p",{className:"text-[10px] text-text-muted",children:[v.startTime.toFixed(2),"s -"," ",v.endTime.toFixed(2),"s"]})]}),c.jsx(ct,{title:"Text Content",children:c.jsx("div",{className:"space-y-3",children:c.jsx("textarea",{value:v.text,onChange:$=>s(v.id,{text:$.target.value}),className:"w-full h-24 px-3 py-2 bg-background-tertiary border border-border rounded-lg text-xs text-text-primary resize-none focus:outline-none focus:border-primary",placeholder:"Enter subtitle text..."})})}),c.jsx(ct,{title:"Timing",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Start Time"}),c.jsx(Ns,{type:"number",step:"0.1",value:v.startTime.toFixed(2),onChange:$=>s(v.id,{startTime:parseFloat($.target.value)||0}),className:"w-20 h-7 text-[10px] bg-background-tertiary border-border text-text-primary text-right"})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"End Time"}),c.jsx(Ns,{type:"number",step:"0.1",value:v.endTime.toFixed(2),onChange:$=>s(v.id,{endTime:parseFloat($.target.value)||0}),className:"w-20 h-7 text-[10px] bg-background-tertiary border-border text-text-primary text-right"})]})]})}),c.jsx(ct,{title:"Position",children:c.jsx("div",{className:"grid grid-cols-3 gap-2",children:["top","center","bottom"].map($=>c.jsx("button",{onClick:()=>s(v.id,{style:{...v.style||{},position:$}}),className:`py-1.5 rounded text-[10px] capitalize transition-colors ${(v.style?.position||"bottom")===$?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:$},$))})}),c.jsx(ct,{title:"Animation",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Style"}),c.jsxs(Pt,{value:v.animationStyle||"none",onValueChange:$=>s(v.id,{animationStyle:$}),children:[c.jsx(Ct,{className:"w-auto min-w-[100px] bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(Nt,{})}),c.jsx(St,{className:"bg-background-secondary border-border",children:CC.map($=>c.jsx(ze,{value:$,children:kC($)},$))})]})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[v.animationStyle==="karaoke"&&"Words fill with color as they're spoken",v.animationStyle==="word-highlight"&&"Current word is highlighted and scaled",v.animationStyle==="word-by-word"&&"Shows one word at a time",v.animationStyle==="bounce"&&"Words bounce in as they appear",v.animationStyle==="typewriter"&&"Words appear progressively like typing",(!v.animationStyle||v.animationStyle==="none")&&"Static text, no animation"]}),v.animationStyle&&v.animationStyle!=="none"&&!v.words?.length&&c.jsx("p",{className:"text-[9px] text-amber-400 bg-amber-400/10 p-2 rounded",children:" No word-level timing data. Re-generate captions to enable animation."}),v.animationStyle&&v.animationStyle!=="none"&&v.animationStyle!=="typewriter"&&v.animationStyle!=="word-by-word"&&c.jsxs("div",{className:"pt-2 border-t border-border space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Highlight Color"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:v.style?.highlightColor||"#ffff00",onChange:$=>s(v.id,{style:{...v.style||{},highlightColor:$.target.value}}),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[9px] font-mono text-text-muted uppercase",children:v.style?.highlightColor||"#ffff00"})]})]}),c.jsx("div",{className:"grid grid-cols-6 gap-1",children:["#ffff00","#00ff00","#ff6b6b","#4ecdc4","#ff9f43","#a55eea"].map($=>c.jsx("button",{onClick:()=>s(v.id,{style:{...v.style||{},highlightColor:$}}),className:`w-6 h-6 rounded border-2 transition-transform hover:scale-110 ${(v.style?.highlightColor||"#ffff00")===$?"border-white":"border-transparent"}`,style:{backgroundColor:$}},$))})]})]})}),c.jsx(ct,{title:"Font",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Font Family"}),c.jsxs(Pt,{value:v.style?.fontFamily||"Inter",onValueChange:$=>s(v.id,{style:{...v.style||{},fontFamily:$}}),children:[c.jsx(Ct,{className:"max-w-[120px] bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border max-h-60",children:[c.jsxs(sd,{children:[c.jsx(gc,{className:"text-text-muted text-[10px] font-medium",children:"Popular"}),["Inter","Poppins","Montserrat","Roboto","Open Sans","Lato","DM Sans"].map($=>c.jsx(ze,{value:$,style:{fontFamily:$},children:$},$))]}),c.jsxs(sd,{children:[c.jsx(gc,{className:"text-text-muted text-[10px] font-medium",children:"Display"}),["Bebas Neue","Anton","Oswald","Teko","Staatliches","Alfa Slab One"].map($=>c.jsx(ze,{value:$,style:{fontFamily:$},children:$},$))]}),c.jsxs(sd,{children:[c.jsx(gc,{className:"text-text-muted text-[10px] font-medium",children:"Elegant"}),["Playfair Display","Cinzel","Lora","Merriweather","DM Serif Display"].map($=>c.jsx(ze,{value:$,style:{fontFamily:$},children:$},$))]}),c.jsxs(sd,{children:[c.jsx(gc,{className:"text-text-muted text-[10px] font-medium",children:"Handwritten"}),["Pacifico","Lobster","Dancing Script","Caveat","Permanent Marker"].map($=>c.jsx(ze,{value:$,style:{fontFamily:$},children:$},$))]})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Font Size"}),c.jsx(Ns,{type:"number",min:12,max:72,value:v.style?.fontSize||24,onChange:$=>s(v.id,{style:{...v.style||{},fontSize:parseInt($.target.value)||24}}),className:"w-16 h-7 text-[10px] bg-background-tertiary border-border text-text-primary text-right"})]})]})}),c.jsx(ct,{title:"Colors",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Text Color"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:v.style?.color||"#ffffff",onChange:$=>s(v.id,{style:{...v.style||{},color:$.target.value}}),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:v.style?.color||"#ffffff"})]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Background"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:v.style?.backgroundColor?.replace(/rgba?\([^)]+\)/,"#000000")||"#000000",onChange:$=>{const we=$.target.value,qe=parseInt(we.slice(1,3),16),fe=parseInt(we.slice(3,5),16),ke=parseInt(we.slice(5,7),16);s(v.id,{style:{...v.style||{},backgroundColor:`rgba(${qe}, ${fe}, ${ke}, 0.7)`}})},className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsxs(Pt,{value:v.style?.backgroundColor?.includes("0.7")?"0.7":v.style?.backgroundColor?.includes("0.5")?"0.5":"1",onValueChange:$=>{const qe=(v.style?.backgroundColor||"rgba(0, 0, 0, 0.7)").replace(/[\d.]+\)$/,`${$})`);s(v.id,{style:{...v.style||{},backgroundColor:qe}})},children:[c.jsx(Ct,{className:"w-auto min-w-[50px] bg-background-tertiary border-border text-text-primary text-[9px] h-6",children:c.jsx(Nt,{})}),c.jsxs(St,{className:"bg-background-secondary border-border",children:[c.jsx(ze,{value:"0",children:"None"}),c.jsx(ze,{value:"0.5",children:"50%"}),c.jsx(ze,{value:"0.7",children:"70%"}),c.jsx(ze,{value:"1",children:"100%"})]})]})]})]})]})}),c.jsx("div",{className:"pt-4 border-t border-border",children:c.jsx("button",{onClick:()=>{const{removeSubtitle:$}=U.getState();$(v.id)},className:"w-full py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30 rounded-lg text-[10px] transition-all",children:"Delete Subtitle"})})]}):c.jsx(ZJ,{})]})})},sZ=(r,e,t,s,i,n)=>{if(!i.enabled)return{time:r,snapped:!1};const a=i.snapThreshold/n,o=[];if(i.snapToClips)for(const u of t)for(const h of u.clips)h.id!==e&&(o.push({time:h.startTime,type:"clip-start"}),o.push({time:h.startTime+h.duration,type:"clip-end"}));if(i.snapToPlayhead&&o.push({time:s,type:"playhead"}),i.snapToGrid){const u=Math.round(r/i.gridSize)*i.gridSize;o.push({time:u,type:"grid"})}let l,d=1/0;for(const u of o){const h=Math.abs(u.time-r);h<a&&h<d&&(d=h,l=u)}return l?{time:l.time,snapped:!0,snapPoint:l}:{time:r,snapped:!1}},iZ=(r,e)=>{if(!r||r.length===0)return"M0,20 L100,20";const t=Array.from(r),s=Math.max(1,Math.floor(t.length/e)),i=[];for(let n=0;n<e;n++){const a=Math.min(n*s,t.length-1),l=20-Math.abs(t[a]||0)*18;i.push(`${n===0?"M":"L"}${n},${l}`)}return i.join(" ")},iN=(r,e=30)=>{if(!isFinite(r)||isNaN(r)||r<0)return"00:00:00:00";const t=Math.floor(r/3600),s=Math.floor(r%3600/60),i=Math.floor(r%60),n=Math.floor(r%1*e);return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},rN=(r,e)=>{switch(r.type){case"video":return{label:`V${e+1}`,icon:vn,color:"bg-primary",textColor:"text-primary",bgLight:"bg-primary/20"};case"audio":return{label:`A${e+1}`,icon:Tn,color:"bg-blue-500",textColor:"text-blue-400",bgLight:"bg-blue-500/20"};case"image":return{label:`I${e+1}`,icon:No,color:"bg-purple-500",textColor:"text-purple-400",bgLight:"bg-purple-500/20"};case"text":return{label:`T${e+1}`,icon:Vs,color:"bg-amber-500",textColor:"text-amber-400",bgLight:"bg-amber-500/20"};case"graphics":return{label:`G${e+1}`,icon:yu,color:"bg-green-500",textColor:"text-green-400",bgLight:"bg-green-500/20"};default:return{label:`?${e+1}`,icon:Gs,color:"bg-gray-500",textColor:"text-gray-400",bgLight:"bg-gray-500/20"}}},rZ=r=>{switch(r){case"video":return{bg:"bg-primary/10",border:"border-primary/30",text:"text-white/90",selectedText:"text-white"};case"audio":return{bg:"bg-blue-500/10",border:"border-blue-500/30",text:"text-text-secondary",selectedText:"text-blue-400"};case"image":return{bg:"bg-purple-500/10",border:"border-purple-500/30",text:"text-purple-300",selectedText:"text-purple-400"};default:return{bg:"bg-gray-500/10",border:"border-gray-500/30",text:"text-text-secondary",selectedText:"text-text-primary"}}},nZ=({position:r,pixelsPerSecond:e,scrollX:t,headerOffset:s})=>{const i=r*e-t;return i<0?null:c.jsxs("div",{className:"absolute top-0 bottom-0 z-50 pointer-events-none",style:{left:s,transform:`translateX(${i}px)`,willChange:"transform"},children:[c.jsx("div",{className:"absolute -translate-x-1/2",style:{top:"-1px"},children:c.jsx("svg",{width:"13",height:"14",viewBox:"0 0 13 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"drop-shadow-[0_0_8px_rgba(34,197,94,0.8)]",children:c.jsx("path",{d:"M0.5 0H12.5V8L6.5 14L0.5 8V0Z",fill:"#22c55e"})})}),c.jsx("div",{className:"absolute w-px bg-primary shadow-[0_0_10px_#22c55e]",style:{top:"13px",bottom:0,left:0}})]})},aZ=({pixelsPerSecond:r,scrollX:e,viewportWidth:t,onSeek:s,onScrubStart:i,onScrubEnd:n})=>{const a=w.useRef(null),[o,l]=w.useState(!1),[d,u]=w.useState(()=>Bp().getState());w.useEffect(()=>Bp().subscribe(u),[]);const h=r>0?r:100,p=e/h,m=(e+t)/h,f=w.useMemo(()=>{if(d.beatMarkers.length===0)return[];const A=1;return d.beatMarkers.filter(T=>T.time>=p-A&&T.time<=m+A)},[d.beatMarkers,p,m]),y=h>500?{minor:.01,major:.1,labelEvery:.5}:h>200?{minor:.05,major:.5,labelEvery:1}:h>100?{minor:.1,major:1,labelEvery:1}:h>50?{minor:.5,major:1,labelEvery:5}:h>20?{minor:1,major:5,labelEvery:5}:{minor:5,major:10,labelEvery:10},x=Math.floor(p/y.minor)*y.minor,v=Math.max(0,x),b=[];for(let A=v;A<=m+y.minor;A+=y.minor){if(A<0)continue;const T=Math.round(A*1e4)/1e4;if(!isFinite(T)||isNaN(T))continue;const j=T===0||Math.abs(T%y.major)<1e-4,_=T===0||Math.abs(T%y.labelEvery)<1e-4;b.push({time:T,isMajor:j,showLabel:_})}const S=w.useRef(e);S.current=e;const k=w.useCallback(A=>{const T=a.current?.parentElement?.parentElement;if(!T)return 0;const j=T.getBoundingClientRect(),_=A.clientX-j.left+S.current;return Math.max(0,_/h)},[h]),C=w.useCallback(A=>{A.preventDefault(),A.stopPropagation(),l(!0),i?.();const T=k(A);s(T)},[k,s,i]);return w.useEffect(()=>{if(!o)return;const A=j=>{j.preventDefault();const _=k(j);s(_)},T=j=>{j.preventDefault(),l(!1),n?.()};return window.addEventListener("mousemove",A),window.addEventListener("mouseup",T),()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",T)}},[o,k,s,n]),c.jsxs("div",{ref:a,"data-time-ruler":!0,className:`h-8 border-b border-border flex items-end relative bg-background-secondary select-none ${o?"cursor-grabbing":"cursor-pointer"}`,onMouseDown:C,onClick:A=>A.stopPropagation(),style:{cursor:o?"grabbing":"pointer"},children:[b.map(A=>c.jsx("div",{className:`absolute border-l pointer-events-none ${A.isMajor?"border-border h-4":"border-border/50 h-2"}`,style:{left:`${A.time*h}px`},children:A.showLabel&&A.time>=0&&c.jsx("span",{className:"text-[9px] font-mono text-text-muted pl-1 whitespace-nowrap",children:iN(Math.max(0,A.time)).slice(3)})},`tick-${A.time}`)),f.map(A=>c.jsx("div",{className:`absolute bottom-0 pointer-events-none ${A.isDownbeat?"w-[2px] h-5 bg-orange-500":"w-px h-3 bg-orange-400/50"}`,style:{left:`${A.time*h}px`}},`beat-ruler-${A.index}`)),d.beatAnalysis&&c.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1.5 bg-orange-500/20 px-2 py-0.5 rounded text-[9px] text-orange-400 font-medium pointer-events-none",children:[c.jsx("span",{className:"opacity-70",children:""}),c.jsxs("span",{children:[d.beatAnalysis.bpm," BPM"]})]})]})},oZ=({track:r,index:e,onDragStart:t,onDragOver:s,onDrop:i,keyframeCount:n=0})=>{const{lockTrack:a,hideTrack:o,muteTrack:l,removeTrack:d}=U(),{isTrackExpanded:u,toggleTrackExpanded:h}=Wt(),p=u(r.id),m=rN(r,e),f=m.icon,g=r.type==="video"||r.type==="image"||r.type==="text"||r.type==="graphics",y=async()=>{await d(r.id)};return c.jsxs(sm,{children:[c.jsx(im,{asChild:!0,children:c.jsxs("div",{draggable:!0,onDragStart:x=>t(x,r.id),onDragOver:s,onDrop:x=>i(x,r.id),className:`h-full border-b border-border flex flex-col justify-between py-2 px-3 relative group transition-colors cursor-grab active:cursor-grabbing ${r.hidden?"opacity-50":""} ${r.locked?"bg-background-secondary/50":"bg-background-tertiary"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[n>0&&c.jsx("button",{onClick:x=>{x.stopPropagation(),h(r.id)},className:"p-0.5 rounded transition-colors hover:bg-background-elevated text-text-muted",title:p?"Collapse keyframes":"Expand keyframes",children:p?c.jsx(ns,{size:12}):c.jsx(ei,{size:12})}),c.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center ${m.bgLight}`,children:c.jsx(f,{size:12,className:m.textColor})}),c.jsx("span",{className:`text-[11px] font-semibold truncate max-w-[70px] ${m.textColor}`,children:r.name||m.label}),n>0&&c.jsx("span",{className:"text-[8px] text-text-muted bg-background-elevated px-1 py-0.5 rounded",children:n})]}),c.jsxs("div",{className:"flex items-center gap-1 text-text-secondary",children:[g&&c.jsx("button",{onClick:x=>{x.stopPropagation(),o(r.id,!r.hidden)},className:`p-1 rounded transition-colors ${r.hidden?"text-yellow-500 bg-yellow-500/10":"text-text-muted hover:bg-background-elevated hover:text-text-primary"}`,title:r.hidden?"Show track":"Hide track",children:r.hidden?c.jsx(ya,{size:12}):c.jsx(Yr,{size:12})}),c.jsx("button",{onClick:x=>{x.stopPropagation(),l(r.id,!r.muted)},className:`p-1 rounded transition-colors ${r.muted?"text-red-500 bg-red-500/10":"text-text-muted hover:bg-background-elevated hover:text-text-primary"}`,title:r.muted?"Unmute":"Mute",children:c.jsx(Tn,{size:12})}),c.jsx("button",{onClick:x=>{x.stopPropagation(),a(r.id,!r.locked)},className:`p-1 rounded transition-colors ${r.locked?"text-yellow-500 bg-yellow-500/10":"text-text-muted hover:bg-background-elevated hover:text-text-primary"}`,title:r.locked?"Unlock":"Lock",children:c.jsx(hO,{size:12})}),c.jsx("button",{onClick:x=>{x.stopPropagation(),y()},className:"p-1 rounded transition-colors hover:bg-red-500/20 text-red-400/50 hover:text-red-400",title:"Delete track",children:c.jsx(bs,{size:12})})]}),c.jsx("div",{className:`absolute left-0 top-0 w-1 h-full ${m.color} opacity-60 group-hover:opacity-100 transition-opacity`})]})}),c.jsx(rm,{className:"min-w-[160px]",children:c.jsxs(bi,{onClick:y,className:"text-red-400 focus:text-red-400 hover:text-red-400",children:[c.jsx(bs,{className:"mr-2 h-4 w-4"}),"Delete Track"]})})]})},cZ=({clip:r,track:e,onClose:t})=>{const{copyClips:s,duplicateClip:i,removeClip:n,rippleDeleteClip:a,splitClip:o,separateAudio:l,getMediaItem:d,copyEffects:u,pasteEffects:h,copiedEffects:p}=U(),{playheadPosition:m}=Wt(),f=m>=r.startTime&&m<=r.startTime+r.duration,g=d(r.mediaId),y=e.type==="video",x=e.type==="audio",v=e.type==="image",b=y&&g?.type==="video"&&g?.metadata?.channels&&g.metadata.channels>0,S=r.effects&&r.effects.length>0,k=p&&p.length>0,C=()=>{s([r.id]),t?.()},A=async()=>{await i(r.id),t?.()},T=async()=>{await n(r.id),t?.()},j=async()=>{await a(r.id),t?.()},_=async()=>{f&&await o(r.id,m),t?.()},M=async()=>{await l(r.id),t?.()},E=()=>{u(r.id),t?.()},D=async()=>{await h(r.id),t?.()},R=()=>y?"Video Clip":x?"Audio Clip":v?"Image Clip":"Clip",B=()=>y?c.jsx(vn,{className:"mr-2 h-3 w-3 text-primary"}):x?c.jsx(Tn,{className:"mr-2 h-3 w-3 text-blue-400"}):v?c.jsx(No,{className:"mr-2 h-3 w-3 text-purple-400"}):null;return c.jsxs(rm,{className:"min-w-[220px]",children:[c.jsxs(yb,{className:"flex items-center text-[10px] text-text-muted",children:[B(),R()]}),c.jsx(pn,{}),c.jsxs(bi,{onClick:C,children:[c.jsx(Eo,{className:"mr-2 h-4 w-4"}),"Copy Clip",c.jsx(ho,{children:"C"})]}),c.jsxs(bi,{onClick:A,children:[c.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Duplicate to New Track",c.jsx(ho,{children:"D"})]}),c.jsx(pn,{}),c.jsxs(bi,{onClick:_,disabled:!f,children:[c.jsx(Bx,{className:"mr-2 h-4 w-4"}),"Split at Playhead",c.jsx(ho,{children:"S"})]}),(y||v)&&c.jsxs(c.Fragment,{children:[c.jsx(pn,{}),c.jsxs(iC,{children:[c.jsxs(X0,{children:[c.jsx(Xp,{className:"mr-2 h-4 w-4"}),"Effects"]}),c.jsxs(K0,{children:[c.jsx(bi,{onClick:E,disabled:!S,children:"Copy Effects"}),c.jsx(bi,{onClick:D,disabled:!k,children:"Paste Effects"})]})]})]}),b&&c.jsxs(c.Fragment,{children:[c.jsx(pn,{}),c.jsxs(bi,{onClick:M,children:[c.jsx(qr,{className:"mr-2 h-4 w-4"}),"Separate Audio"]})]}),x&&c.jsxs(c.Fragment,{children:[c.jsx(pn,{}),c.jsxs(iC,{children:[c.jsxs(X0,{children:[c.jsx(Tn,{className:"mr-2 h-4 w-4"}),"Audio"]}),c.jsxs(K0,{children:[c.jsx(bi,{onClick:E,disabled:!S,children:"Copy Audio Effects"}),c.jsx(bi,{onClick:D,disabled:!k,children:"Paste Audio Effects"})]})]})]}),c.jsx(pn,{}),c.jsxs(bi,{onClick:j,className:"text-red-400",children:[c.jsx(bs,{className:"mr-2 h-4 w-4"}),"Ripple Delete",c.jsx(ho,{children:""})]}),c.jsxs(bi,{onClick:T,className:"text-red-400",children:[c.jsx(bs,{className:"mr-2 h-4 w-4"}),"Delete"]})]})},J2=80,Z2=10,lZ=5,dZ=({clip:r,track:e,allTracks:t,pixelsPerSecond:s,isSelected:i,trackHeights:n,timelineRef:a,onSelect:o,onMoveClip:l,onSnapIndicator:d,onTrimClip:u})=>{const{getMediaItem:h,updateClipKeyframes:p}=U(),{snapSettings:m,setPanelVisible:f}=ft(),{playheadPosition:g}=Wt(),y=h(r.mediaId),[x,v]=w.useState(!1),[b,S]=w.useState(!1),[k,C]=w.useState(0),[A,T]=w.useState(0),[j,_]=w.useState(!1),[M,E]=w.useState(!1),[D,R]=w.useState(null),B=w.useRef({mouseX:0,startTime:r.startTime,duration:r.duration}),O=w.useRef({mouseY:0,clipY:0,scrollTop:0}),F=w.useRef({x:0,y:0}),I=w.useRef({time:0}),K=w.useRef({active:!1,startX:0,startY:0}),ee=w.useRef(null),P=w.useMemo(()=>{if(!r.keyframes||r.keyframes.length===0)return null;const J=16,be={opacity:"#fbbf24","position.x":"#22d3ee","position.y":"#a78bfa","scale.x":"#fb923c","scale.y":"#f472b6",rotation:"#34d399",default:"#6b7280"},ie=new Map;for(const we of r.keyframes){const qe=ie.get(we.property)||[];qe.push(we),ie.set(we.property,qe)}const Pe=Array.from(ie.keys()).sort(),$=Pe.length*J;return c.jsx("div",{className:"absolute bottom-0 left-0 right-0 pointer-events-auto z-20",style:{height:$},children:Pe.map((we,qe)=>{const fe=ie.get(we),ke=be[we]||be.default;return c.jsxs("div",{className:"absolute left-0 right-0",style:{bottom:qe*J,height:J,background:"rgba(0,0,0,0.2)"},children:[c.jsx("div",{className:"absolute left-0 right-0",style:{top:J/2,height:1,background:"rgba(255,255,255,0.1)"}}),fe.map(Ge=>{const Je=Ge.time/r.duration*100,Tt=(et,Ee)=>{et.stopPropagation();const At=et.currentTarget.closest("[data-clip-id]");if(!At)return;const mi=et.clientX,qi=At.getBoundingClientRect().width;let Hi=!1;const vs=qs=>{const Kr=qs.clientX-mi;Math.abs(Kr)>3&&(Hi=!0);const Pn=Je/100*qi+Kr,Ia=Math.max(0,Math.min(100,Pn/qi*100))/100*r.duration,Bt=r.keyframes.map(Qr=>Qr.id===Ee?{...Qr,time:Ia}:Qr);p(r.id,Bt)},ni=qs=>{qs.stopPropagation(),qs.preventDefault(),document.removeEventListener("mousemove",vs),document.removeEventListener("mouseup",ni),Hi||(o(r.id,!1),f("inspector",!0),sessionStorage.setItem("openreel_selected_keyframe_property",we))};document.addEventListener("mousemove",vs),document.addEventListener("mouseup",ni)};return c.jsx("div",{className:"absolute pointer-events-auto cursor-move z-30",style:{left:`${Je}%`,top:"50%",transform:"translate(-50%, -50%)"},title:`${we}: ${Ge.value}`,onMouseDown:et=>Tt(et,Ge.id),onClick:et=>et.stopPropagation(),children:c.jsx("div",{className:"w-2 h-2 rotate-45",style:{backgroundColor:ke,boxShadow:"0 0 2px rgba(0,0,0,0.5)"}})},Ge.id)})]},we)})})},[r.keyframes,r.duration,r.id,o,p,f]),W=r.startTime*s,z=r.duration*s,G=e.type==="video",ce=e.type==="audio",ae=e.type==="image",te=rZ(e.type),Ve=J=>{J.button===0&&(x||b||(J.stopPropagation(),o(r.id,J.shiftKey||J.metaKey)))},q=J=>{if(J.button!==0||e.locked||M)return;J.stopPropagation();const be=ee.current?.parentElement?.getBoundingClientRect(),ie=ee.current?.getBoundingClientRect();if(!be||!ie)return;const Pe=J.clientX-be.left,$=r.startTime*s;C(Pe-$),O.current={mouseY:J.clientY,clipY:ie.top-be.top,scrollTop:a.current?.scrollTop||0},F.current={x:J.clientX,y:J.clientY},K.current={active:!0,startX:J.clientX,startY:J.clientY},T(0),_(!1),S(!0)},oe=J=>be=>{be.button===0&&(e.locked||!u||(be.stopPropagation(),E(!0),R(J),B.current={mouseX:be.clientX,startTime:r.startTime,duration:r.duration},document.body.style.cursor="ew-resize"))};w.useEffect(()=>{if(!b)return;const J=ie=>{const Pe=ie.clientX-K.current.startX,$=ie.clientY-K.current.startY;Math.sqrt(Pe*Pe+$*$)>=lZ&&(K.current.active=!1,S(!1),v(!0))},be=ie=>{K.current.active=!1,S(!1),o(r.id,ie.shiftKey||ie.metaKey)};return window.addEventListener("mousemove",J),window.addEventListener("mouseup",be),()=>{window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",be)}},[b,r.id,o]),w.useEffect(()=>{if(!x)return;let J=null;const be=()=>{if(!a.current){J=requestAnimationFrame(be);return}const $=a.current,we=$.getBoundingClientRect(),qe=F.current.y,fe=we.top,ke=we.bottom,Ge=$.scrollTop>0,Je=$.scrollTop<$.scrollHeight-$.clientHeight,Tt=qe-fe,et=ke-qe;Tt<J2&&Ge?$.scrollTop-=Z2:et<J2&&Je&&($.scrollTop+=Z2),J=requestAnimationFrame(be)};J=requestAnimationFrame(be);const ie=$=>{F.current.x=$.clientX,F.current.y=$.clientY;const we=ee.current?.parentElement?.getBoundingClientRect(),qe=a.current?.getBoundingClientRect();if(!we||!qe)return;const fe=$.clientX-we.left-k,ke=Math.max(0,fe/s),Ge=sZ(ke,r.id,t,g,m,s),Tt=(a.current?.scrollTop||0)-O.current.scrollTop,et=$.clientY-O.current.mouseY+Tt;T(et);const Ee=a.current?.scrollTop||0,At=$.clientY-qe.top+Ee;let mi,ri,qi=0;for(const vs of t){const ni=n.get(vs.id)||60;if(At>=qi&&At<qi+ni){ri=vs.type,vs.type===e.type&&vs.id!==e.id&&(mi=vs.id);break}qi+=ni}const Hi=ri!==void 0&&ri!==e.type;_(Hi),I.current={time:Ge.time,targetTrackId:mi},l(r.id,Ge.time,void 0),d(Ge.snapped?Ge.time:null)},Pe=()=>{J!==null&&cancelAnimationFrame(J);const{time:$,targetTrackId:we}=I.current;we&&l(r.id,$,we),v(!1),T(0),_(!1),d(null)};return window.addEventListener("mousemove",ie),window.addEventListener("mouseup",Pe),()=>{J!==null&&cancelAnimationFrame(J),window.removeEventListener("mousemove",ie),window.removeEventListener("mouseup",Pe)}},[x,k,s,r.id,e.id,e.type,t,n,a,g,m,l,d]),w.useEffect(()=>{if(!M||!D||!u)return;const J=ie=>{const $=(ie.clientX-B.current.mouseX)/s;if(D==="left"){const we=Math.max(0,B.current.startTime+$),qe=B.current.startTime+B.current.duration-.1,fe=Math.min(we,qe);u(r.id,"left",fe)}else{const we=B.current.startTime+B.current.duration+$,qe=B.current.startTime+.1,fe=Math.max(we,qe);u(r.id,"right",fe)}},be=()=>{E(!1),R(null),document.body.style.cursor=""};return window.addEventListener("mousemove",J),window.addEventListener("mouseup",be),()=>{window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",be)}},[M,D,r.id,s,u]);const V=Math.max(1,Math.floor(z/60)),he=y?.name||r.mediaId.slice(0,8),Se=x||M;return c.jsxs(sm,{children:[c.jsx(im,{asChild:!0,children:c.jsxs("div",{ref:ee,"data-clip-id":r.id,onClick:Ve,onMouseDown:q,className:`group absolute top-1 bottom-1 rounded-lg overflow-hidden shadow-sm ${x?`cursor-grabbing z-50 ${j?"opacity-50 ring-2 ring-red-500 border-red-500":"opacity-90 shadow-xl"}`:"cursor-grab"} ${i&&!x?"ring-2 ring-primary border-primary z-10":x?"":"border-opacity-30 hover:border-opacity-60 hover:brightness-110"} ${te.bg} border ${te.border} ${e.locked?"cursor-not-allowed opacity-60":""}`,style:{transform:x?`translate(${W}px, ${A}px)`:`translateX(${W}px)`,width:`${z}px`,willChange:Se?"transform, width":"auto",transition:Se?"none":"opacity 150ms, box-shadow 150ms",pointerEvents:x?"none":"auto"},children:[G&&(y?.filmstripThumbnails?.length||y?.thumbnailUrl)&&c.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:y?.filmstripThumbnails&&y.filmstripThumbnails.length>0?Array.from({length:V}).map((J,be)=>{const ie=be/Math.max(1,V-1),Pe=Math.min(Math.floor(ie*y.filmstripThumbnails.length),y.filmstripThumbnails.length-1),$=y.filmstripThumbnails[Pe];return c.jsx("div",{className:"flex-1 h-full bg-cover bg-center opacity-70",style:{backgroundImage:`url(${$.url})`,borderRight:be<V-1?"1px solid rgba(0,0,0,0.2)":"none"}},be)}):Array.from({length:V}).map((J,be)=>c.jsx("div",{className:"flex-1 h-full bg-cover bg-center opacity-60",style:{backgroundImage:`url(${y.thumbnailUrl})`,borderRight:be<V-1?"1px solid rgba(0,0,0,0.2)":"none"}},be))}),G&&!y?.thumbnailUrl&&c.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-primary/10 pointer-events-none"}),ae&&c.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-purple-500/10 flex items-center justify-center pointer-events-none",children:y?.thumbnailUrl?c.jsx("img",{src:y.thumbnailUrl,alt:he,className:"h-full object-cover opacity-60"}):c.jsx(No,{size:24,className:"text-purple-400/50"})}),c.jsx("div",{className:"w-full h-full flex flex-col justify-start px-2 pt-1 relative z-10 pointer-events-none",children:c.jsx("span",{className:`text-[10px] font-medium truncate drop-shadow-md ${i?te.selectedText:te.text}`,children:he})}),ce&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute inset-0 flex items-center opacity-50 px-1 pointer-events-none",children:y?.waveformData?c.jsx("svg",{className:"w-full h-full",preserveAspectRatio:"none",viewBox:"0 0 100 40",children:c.jsx("path",{d:iZ(y.waveformData,100),stroke:"currentColor",className:"text-blue-400",fill:"none",strokeWidth:"1",vectorEffect:"non-scaling-stroke"})}):c.jsx("svg",{className:"w-full h-full",preserveAspectRatio:"none",children:c.jsx("path",{d:"M0,20 Q10,5 20,20 T40,20 T60,20 T80,20 T100,20",stroke:"currentColor",className:"text-blue-400",fill:"none",vectorEffect:"non-scaling-stroke"})})}),c.jsx("div",{className:"absolute inset-x-0 top-1 flex justify-center opacity-0 group-hover:opacity-60 transition-opacity pointer-events-none",children:c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("div",{className:"w-1 h-1 rounded-full bg-blue-300"}),c.jsx("div",{className:"w-1 h-1 rounded-full bg-blue-300"}),c.jsx("div",{className:"w-1 h-1 rounded-full bg-blue-300"})]})})]}),i&&c.jsx("div",{className:"absolute inset-0 border-2 border-primary rounded-lg pointer-events-none shadow-[inset_0_0_10px_rgba(34,197,94,0.2)]"}),P,(G||ae||ce)&&u&&c.jsxs(c.Fragment,{children:[c.jsx("div",{onMouseDown:oe("left"),className:`absolute left-0 top-0 bottom-0 w-3 cursor-ew-resize z-10 opacity-0 group-hover:opacity-100 transition-opacity ${ce?"hover:bg-blue-400/50":G?"hover:bg-green-400/50":"hover:bg-purple-400/50"}`,onClick:J=>J.stopPropagation(),title:"Drag to adjust start"}),c.jsx("div",{onMouseDown:oe("right"),className:`absolute right-0 top-0 bottom-0 w-3 cursor-ew-resize z-10 opacity-0 group-hover:opacity-100 transition-opacity ${ce?"hover:bg-blue-400/50":G?"hover:bg-green-400/50":"hover:bg-purple-400/50"}`,onClick:J=>J.stopPropagation(),title:"Drag to adjust end"})]})]})}),c.jsx(cZ,{clip:r,track:e})]})},nN=({clip:r,clipType:e,onClose:t,onDelete:s,onDuplicate:i})=>{const{deleteShapeClip:n,deleteSVGClip:a,deleteStickerClip:o,deleteTextClip:l}=U(),d=()=>{if(s)s();else switch(e){case"shape":n(r.id);break;case"svg":a(r.id);break;case"sticker":case"emoji":o(r.id);break;case"text":l(r.id);break}t?.()},u=()=>{i?.(),t?.()},h=()=>{switch(e){case"shape":return"Shape";case"svg":return"SVG";case"sticker":return"Sticker";case"emoji":return"Emoji";case"text":return"Text";default:return"Graphics"}},p=()=>{switch(e){case"text":return c.jsx(Vs,{className:"mr-2 h-3 w-3 text-amber-400"});default:return c.jsx(yu,{className:"mr-2 h-3 w-3 text-green-400"})}};return c.jsxs(rm,{className:"min-w-[200px]",children:[c.jsxs(yb,{className:"flex items-center text-[10px] text-text-muted",children:[p(),h()," Clip"]}),c.jsx(pn,{}),i&&c.jsxs(c.Fragment,{children:[c.jsxs(bi,{onClick:u,children:[c.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Duplicate",c.jsx(ho,{children:"D"})]}),c.jsx(pn,{})]}),c.jsxs(bi,{onClick:d,className:"text-red-400",children:[c.jsx(bs,{className:"mr-2 h-4 w-4"}),"Delete",c.jsx(ho,{children:""})]})]})},uZ=({textClip:r,pixelsPerSecond:e,isSelected:t,onSelect:s,onTrim:i,onMoveClip:n})=>{const a=w.useRef(null),[o,l]=w.useState(null),[d,u]=w.useState(!1),[h,p]=w.useState(0),m=w.useRef({mouseX:0,startTime:r.startTime,duration:r.duration}),f=r.startTime*e,g=r.duration*e,y=S=>{S.button===0&&(o||d||(S.stopPropagation(),s(r.id,S.shiftKey||S.metaKey)))},x=S=>{if(S.button!==0||o)return;S.stopPropagation();const k=a.current?.parentElement?.getBoundingClientRect();if(!k)return;const C=S.clientX-k.left,A=r.startTime*e;p(C-A),u(!0),s(r.id,S.shiftKey||S.metaKey)};w.useEffect(()=>{if(!d||!n)return;const S=C=>{const A=a.current?.parentElement?.getBoundingClientRect();if(!A)return;const T=C.clientX-A.left-h,j=Math.max(0,T/e);n(r.id,j)},k=()=>{u(!1)};return window.addEventListener("mousemove",S),window.addEventListener("mouseup",k),()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",k)}},[d,r.id,e,h,n]);const v=(S,k)=>{S.button===0&&(S.stopPropagation(),S.preventDefault(),l(k),m.current={mouseX:S.clientX,startTime:r.startTime,duration:r.duration},document.body.style.cursor="ew-resize",document.body.style.userSelect="none")};w.useEffect(()=>{if(!o)return;const S=C=>{const T=(C.clientX-m.current.mouseX)/e;if(o==="left"){const j=Math.max(0,m.current.startTime+T),_=m.current.startTime+m.current.duration-.1,M=Math.min(j,_);i(r.id,"left",M)}else{const j=m.current.startTime+m.current.duration+T,_=m.current.startTime+.1,M=Math.max(j,_);i(r.id,"right",M)}},k=()=>{l(null),document.body.style.cursor="",document.body.style.userSelect=""};return window.addEventListener("mousemove",S),window.addEventListener("mouseup",k),()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",k)}},[o,r.id,e,i]);const b=d||o;return c.jsxs(sm,{children:[c.jsx(im,{asChild:!0,children:c.jsxs("div",{ref:a,onClick:y,onMouseDown:x,className:`absolute top-1 bottom-1 rounded-lg overflow-hidden cursor-grab group ${d?"cursor-grabbing opacity-75":""} ${t?"ring-2 ring-amber-400 border-amber-400 z-10":"border-amber-500/30 hover:border-amber-500/60 hover:brightness-110"} bg-amber-500/20 border`,style:{transform:`translateX(${f}px)`,width:`${Math.max(g,40)}px`,willChange:b?"transform, width":"auto",transition:b?"none":"opacity 150ms, box-shadow 150ms"},children:[c.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-amber-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:S=>v(S,"left"),title:"Drag to trim start"}),c.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-amber-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:S=>v(S,"right"),title:"Drag to trim end"}),c.jsxs("div",{className:"w-full h-full flex items-center gap-1 px-3",children:[c.jsx(Vs,{size:12,className:"text-amber-400 flex-shrink-0"}),c.jsx("span",{className:"text-[10px] font-medium text-amber-200 truncate",children:r.text||"Text"})]}),t&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute inset-0 border-2 border-amber-400 rounded-lg pointer-events-none"}),c.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-amber-400 rounded-r cursor-ew-resize",onMouseDown:S=>v(S,"left")}),c.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-amber-400 rounded-l cursor-ew-resize",onMouseDown:S=>v(S,"right")})]})]})}),c.jsx(nN,{clip:r,clipType:"text"})]})},hZ=({shapeClip:r,pixelsPerSecond:e,isSelected:t,onSelect:s,onTrim:i,onMoveClip:n})=>{const a=w.useRef(null),[o,l]=w.useState(!1),[d,u]=w.useState(0),[h,p]=w.useState(null),m=w.useRef({mouseX:0,startTime:r.startTime,duration:r.duration}),f=r.startTime*e,g=r.duration*e,y=_=>{if(_.button!==0||h)return;_.stopPropagation();const M=a.current?.getBoundingClientRect();if(!M)return;const E=_.clientX-M.left;u(E),l(!0)},x=_=>{_.button===0&&(h||o||(_.stopPropagation(),s(r.id,_.shiftKey||_.metaKey)))},v=(_,M)=>{_.button===0&&(_.stopPropagation(),_.preventDefault(),p(M),m.current={mouseX:_.clientX,startTime:r.startTime,duration:r.duration},document.body.style.cursor="ew-resize",document.body.style.userSelect="none")};w.useEffect(()=>{if(!o)return;const _=E=>{const D=a.current?.parentElement;if(!D)return;const R=D.getBoundingClientRect(),O=(E.clientX-R.left-d)/e,F=Math.max(0,O);n(r.id,F)},M=()=>{l(!1)};return window.addEventListener("mousemove",_),window.addEventListener("mouseup",M),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",M)}},[o,d,e,r.id,n]),w.useEffect(()=>{if(!h)return;const _=E=>{const R=(E.clientX-m.current.mouseX)/e;if(h==="left"){const B=Math.max(0,m.current.startTime+R),O=m.current.startTime+m.current.duration-.1,F=Math.min(B,O);i(r.id,"left",F)}else{const B=m.current.startTime+m.current.duration+R,O=m.current.startTime+.1,F=Math.max(B,O);i(r.id,"right",F)}},M=()=>{p(null),document.body.style.cursor="",document.body.style.userSelect=""};return window.addEventListener("mousemove",_),window.addEventListener("mouseup",M),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",M)}},[h,r.id,e,i]);const b=r.type==="shape",S=r.type==="sticker"||r.type==="emoji",k=b&&"shapeType"in r?r.shapeType.charAt(0).toUpperCase()+r.shapeType.slice(1):S?r.type==="emoji"?"Emoji":"Sticker":"SVG",C=b?yu:S?Zj:Uc,A=b?"green":S?"pink":"purple",T=o||h,j=b?"shape":S?r.type==="emoji"?"emoji":"sticker":"svg";return c.jsxs(sm,{children:[c.jsx(im,{asChild:!0,children:c.jsxs("div",{ref:a,onClick:x,onMouseDown:y,className:`absolute top-1 bottom-1 rounded-lg overflow-hidden cursor-grab group ${o?"cursor-grabbing opacity-75":""} ${t?`ring-2 ring-${A}-400 border-${A}-400 z-10`:`border-${A}-500/30 hover:border-${A}-500/60 hover:brightness-110`} bg-${A}-500/20 border`,style:{transform:`translateX(${f}px)`,width:`${Math.max(g,40)}px`,willChange:T?"transform, width":"auto",transition:T?"none":"opacity 150ms, box-shadow 150ms"},children:[c.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-${A}-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity`,onMouseDown:_=>v(_,"left"),title:"Drag to trim start"}),c.jsx("div",{className:`absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-${A}-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity`,onMouseDown:_=>v(_,"right"),title:"Drag to trim end"}),c.jsxs("div",{className:"w-full h-full flex items-center gap-1 px-3",children:[c.jsx(C,{size:12,className:`text-${A}-400 flex-shrink-0`}),c.jsx("span",{className:`text-[10px] font-medium text-${A}-200 truncate`,children:k})]}),t&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute inset-0 border-2 border-green-400 rounded-lg pointer-events-none"}),c.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-green-400 rounded-r cursor-ew-resize",onMouseDown:_=>v(_,"left")}),c.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-green-400 rounded-l cursor-ew-resize",onMouseDown:_=>v(_,"right")})]})]})}),c.jsx(nN,{clip:r,clipType:j})]})},pZ=({track:r,allTracks:e,pixelsPerSecond:t,selectedClipIds:s,textClips:i,shapeClips:n,trackHeights:a,timelineRef:o,onSelectClip:l,onDropMedia:d,onMoveClip:u,onMoveTextClip:h,onSnapIndicator:p,onTrimClip:m,onTrimTextClip:f,onTrimShapeClip:g,scrollX:y,trackHeight:x,onResizeTrack:v})=>{const[b,S]=w.useState(!1),[k,C]=w.useState(!1),A=w.useRef(null),T=w.useRef(0),j=w.useRef(0),_=w.useCallback(R=>{R.preventDefault(),R.dataTransfer.dropEffect="copy",S(!0)},[]),M=w.useCallback(()=>{S(!1)},[]),E=w.useCallback(R=>{R.preventDefault(),S(!1);try{const B=R.dataTransfer.getData("application/json");if(!B)return;const O=JSON.parse(B);if(!O||typeof O!="object"||typeof O.mediaId!="string"||!O.mediaId.trim())return;const F=A.current?.getBoundingClientRect();if(F){const I=R.clientX-F.left+y,K=Math.max(0,I/t);d(r.id,O.mediaId,K)}}catch{}},[r.id,t,y,d]),D=w.useCallback(R=>{R.preventDefault(),R.stopPropagation(),C(!0),T.current=R.clientY,j.current=x,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},[x]);return w.useEffect(()=>{if(!k)return;const R=O=>{const F=O.clientY-T.current,I=j.current+F;v(r.id,I)},B=()=>{C(!1),document.body.style.cursor="",document.body.style.userSelect=""};return document.addEventListener("mousemove",R),document.addEventListener("mouseup",B),()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",B)}},[k,r.id,v]),c.jsxs("div",{className:"relative",children:[c.jsxs("div",{ref:A,style:{height:x},className:`relative border-b border-border/50 transition-colors ${b?"bg-primary/10 border-primary/30":"bg-background-secondary/20"}`,onDragOver:_,onDragLeave:M,onDrop:E,children:[r.clips.filter(R=>!i.some(B=>B.id===R.id)).filter(R=>!n.some(B=>B.id===R.id)).map(R=>c.jsx(dZ,{clip:R,track:r,allTracks:e,pixelsPerSecond:t,isSelected:s.includes(R.id),trackHeights:a,timelineRef:o,onSelect:l,onMoveClip:u,onSnapIndicator:p,onTrimClip:m},R.id)),i.map(R=>c.jsx(uZ,{textClip:R,pixelsPerSecond:t,isSelected:s.includes(R.id),onSelect:l,onTrim:f,onMoveClip:h},R.id)),n.map(R=>c.jsx(hZ,{shapeClip:R,pixelsPerSecond:t,isSelected:s.includes(R.id),onSelect:l,onTrim:g,onMoveClip:u},R.id)),b&&c.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-primary/50 rounded pointer-events-none flex items-center justify-center",children:c.jsx("span",{className:"text-xs text-primary bg-background/80 px-2 py-1 rounded",children:"Drop to add clip"})})]}),c.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-1 cursor-row-resize hover:bg-primary/50 transition-colors z-10 ${k?"bg-primary":""}`,onMouseDown:D})]})},mZ=({pixelsPerSecond:r,scrollX:e,viewportWidth:t,totalHeight:s})=>{const[i,n]=w.useState(()=>Bp().getState());w.useEffect(()=>Bp().subscribe(n),[]);const a=w.useMemo(()=>{if(i.beatMarkers.length===0)return[];const o=e/r,l=(e+t)/r,d=1;return i.beatMarkers.filter(u=>u.time>=o-d&&u.time<=l+d)},[i.beatMarkers,e,t,r]);return a.length===0?null:c.jsx("div",{className:"absolute inset-0 pointer-events-none z-5",children:a.map(o=>{const l=o.time*r,d=o.isDownbeat;return c.jsxs("div",{className:"absolute top-0",style:{left:`${l}px`,height:`${s}px`},children:[c.jsx("div",{className:`h-full transition-opacity ${d?"w-[2px] bg-orange-500/60":"w-px bg-orange-400/30"}`}),d&&c.jsx("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-orange-500",title:`Beat ${o.index+1}`})]},`beat-${o.index}`)})})},fZ=({marker:r,pixelsPerSecond:e,scrollX:t,onSeek:s,onRemove:i,onUpdate:n})=>{const[a,o]=He.useState(!1),[l,d]=He.useState(!1),[u,h]=He.useState(r.label),p=r.time*e-t,m=x=>{x.stopPropagation(),s&&s(r.time)},f=x=>{x.stopPropagation(),d(!0)},g=x=>{x.stopPropagation(),i&&i(r.id)},y=x=>{x.key==="Enter"?(n&&u.trim()&&n(r.id,{label:u.trim()}),d(!1)):x.key==="Escape"&&(h(r.label),d(!1))};return c.jsxs("div",{className:"absolute top-0 bottom-0 flex flex-col items-center cursor-pointer z-20",style:{left:`${p}px`},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:m,onDoubleClick:f,children:[c.jsx("div",{className:"w-0.5 h-full transition-opacity",style:{backgroundColor:r.color,opacity:a?1:.6}}),c.jsxs("div",{className:"absolute top-1 flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium whitespace-nowrap transition-all shadow-lg",style:{backgroundColor:r.color,color:"#fff",transform:a?"scale(1.05)":"scale(1)"},children:[c.jsx(OL,{size:10}),l?c.jsx("input",{type:"text",value:u,onChange:x=>h(x.target.value),onKeyDown:y,onBlur:()=>{h(r.label),d(!1)},className:"bg-transparent border-none outline-none text-white w-20 px-1",autoFocus:!0,onClick:x=>x.stopPropagation()}):c.jsx("span",{children:r.label}),a&&i&&c.jsx("button",{onClick:g,className:"ml-1 hover:bg-white/20 rounded p-0.5 transition-colors",children:c.jsx(ti,{size:10})})]})]})},gZ=()=>{const r=w.useRef(null),e=w.useRef(null),{project:t,undo:s,redo:i,canUndo:n,canRedo:a,splitClip:o,removeClip:l,addTrack:d,reorderTrack:u,deleteShapeClip:h,deleteSVGClip:p,deleteTextClip:m,removeMarker:f,updateMarker:g,setTimelineDuration:y}=U(),x=t.timeline.tracks,[v,b]=He.useState(null),{playheadPosition:S,playbackState:k,pixelsPerSecond:C,scrollX:A,scrollY:T,viewportWidth:j,setScrollX:_,setScrollY:M,setViewportDimensions:E,zoomIn:D,zoomOut:R,setTrackHeightById:B,getTrackHeight:O}=Wt(),[F,I]=w.useState(!1),{select:K,selectMultiple:ee,clearSelection:P,getSelectedClipIds:W}=ft(),z=W(),{getTitleEngine:G,getGraphicsEngine:ce}=me(),ae=G(),te=w.useMemo(()=>ae?.getAllTextClips()??[],[ae,t.modifiedAt]),Ve=w.useCallback(Q=>te.filter(Ce=>Ce.trackId===Q),[te]),q=ce(),oe=w.useMemo(()=>{const Q=q?.getAllShapeClips()??[],Ce=q?.getAllSVGClips()??[],Ie=q?.getAllStickerClips()??[];return[...Q,...Ce,...Ie]},[q,t.modifiedAt]),V=w.useCallback(Q=>oe.filter(Ce=>Ce.trackId===Q),[oe]),[he,Se]=He.useState(!1),[J,be]=He.useState(null),ie=w.useMemo(()=>{const Q=t.timeline?.duration||0;if(Q>0)return Q;let Ce=0;for(const Ie of x)for(const Ue of Ie.clips){const kt=Ue.startTime+Ue.duration;kt>Ce&&(Ce=kt)}return Math.max(Ce,60)},[x,t.timeline?.duration]),Pe=20,$=w.useCallback(Q=>{const Ce=x.find(tt=>tt.id===Q);if(!Ce)return 0;const Ie=new Set;for(const tt of Ce.clips)if(tt.keyframes)for(const ht of tt.keyframes)Ie.add(ht.property);const Ue=Ve(Q);for(const tt of Ue)if(tt.keyframes)for(const ht of tt.keyframes)Ie.add(ht.property);const kt=V(Q);for(const tt of kt)if(tt.keyframes)for(const ht of tt.keyframes)Ie.add(ht.property);return Ie.size*Pe},[x,Ve,V]),we=w.useCallback(Q=>O(Q)+$(Q),[O,$]),qe=w.useMemo(()=>{let Q=0;for(const Ce of x)Q+=we(Ce.id);return Q},[x,we]),fe=w.useMemo(()=>{const Q=new Map;for(const Ce of x)Q.set(Ce.id,O(Ce.id));return Q},[x,O]),ke=w.useCallback((Q,Ce)=>{Q.dataTransfer.setData("trackId",Ce),Q.dataTransfer.effectAllowed="move",b(Ce)},[]),Ge=w.useCallback(Q=>{Q.preventDefault(),Q.dataTransfer.dropEffect="move"},[]),Je=w.useCallback(async(Q,Ce)=>{Q.preventDefault();const Ie=Q.dataTransfer.getData("trackId");if(b(null),Ie&&Ie!==Ce){const Ue=x.findIndex(kt=>kt.id===Ce);Ue!==-1&&await u(Ie,Ue)}},[x,u]);w.useEffect(()=>{if(!r.current)return;const Q=new ResizeObserver(Ce=>{for(const Ie of Ce)E(Ie.contentRect.width,Ie.contentRect.height)});return Q.observe(r.current),()=>Q.disconnect()},[E]),w.useEffect(()=>{if(k!=="playing")return;const Q=S*C,Ce=A+j-150;if(Q>Ce&&e.current){const Ie=Q-j+200;e.current.scrollLeft=Math.max(0,Ie)}},[S,k,C,A,j]);const Tt=w.useCallback((Q,Ce)=>{if(te.some(tt=>tt.id===Q)){const tt=te.find(ht=>ht.id===Q);K({type:"text-clip",id:Q,trackId:tt?.trackId},Ce);return}if(oe.some(tt=>tt.id===Q)){const tt=oe.find(ht=>ht.id===Q);K({type:"shape-clip",id:Q,trackId:tt?.trackId},Ce);return}let kt;for(const tt of x)if(tt.clips.some(ht=>ht.id===Q)){kt=tt.id;break}K({type:"clip",id:Q,trackId:kt},Ce)},[x,K,te,oe]),et=w.useCallback(async()=>{z.length===1&&await o(z[0],S)},[z,S,o]),Ee=w.useCallback(async()=>{if(z.length!==0){for(const Q of z){if(te.find(Ue=>Ue.id===Q)){m(Q);continue}const Ie=oe.find(Ue=>Ue.id===Q);if(Ie){Ie.type==="svg"?p(Q):h(Q);continue}l(Q)}P()}},[z,l,P,te,oe,m,h,p]),At=w.useCallback(Q=>{if(Q.button!==0||Q.target.closest(".clip-component"))return;const Ce=e.current?.getBoundingClientRect();if(!Ce)return;const Ie=Q.clientX-Ce.left+A,Ue=Q.clientY-Ce.top+T;Se(!0),be({startX:Ie,startY:Ue,currentX:Ie,currentY:Ue})},[A,T]),mi=w.useCallback(Q=>{if(!he||!J)return;const Ce=e.current?.getBoundingClientRect();if(!Ce)return;const Ie=Q.clientX-Ce.left+A,Ue=Q.clientY-Ce.top+T;be({...J,currentX:Ie,currentY:Ue})},[he,J,A,T]),ri=w.useCallback(()=>{if(!he||!J){Se(!1),be(null);return}const Q=Math.min(J.startX,J.currentX),Ce=Math.max(J.startX,J.currentX),Ie=Q/C,Ue=Ce/C;let kt=0;const tt=[];for(const ht of x){const vt=we(ht.id),pt=kt,gr=kt+vt,Xi=Math.min(J.startY,J.currentY),dm=Math.max(J.startY,J.currentY);if(Xi<gr&&dm>pt)for(const Fo of ht.clips){const um=Fo.startTime,Nn=Fo.startTime+Fo.duration;Ie<Nn&&Ue>um&&tt.push({type:"clip",id:Fo.id,trackId:ht.id})}kt+=vt}tt.length>0&&ee(tt),Se(!1),be(null)},[he,J,C,x,O,ee]);w.useEffect(()=>{if(!he)return;const Q=()=>ri();return document.addEventListener("mouseup",Q),()=>document.removeEventListener("mouseup",Q)},[he,ri]);const qi=w.useCallback(async(Q,Ce,Ie)=>{const{addClipToNewTrack:Ue}=U.getState();await Ue(Ce,Ie)},[]),{moveClip:Hi}=U(),vs=w.useCallback(async(Q,Ce,Ie)=>{const Ue=oe.find(kt=>kt.id===Q);Ue&&q?(Ue.type==="sticker"||Ue.type==="emoji"?q.updateStickerClip(Q,{startTime:Ce}):Ue.type==="svg"?q.updateSVGClip(Q,{startTime:Ce}):q.updateShapeClip(Q,{startTime:Ce}),U.setState(kt=>({project:{...kt.project,modifiedAt:Date.now()}}))):await Hi(Q,Ce,Ie)},[Hi,oe,q]),[ni,qs]=He.useState(null),Kr=w.useCallback(Q=>{qs(Q)},[]),Pn=w.useCallback((Q,Ce,Ie)=>{if(!ae)return;const Ue=te.find(vt=>vt.id===Q);if(!Ue)return;const kt=Ue.duration,tt=Ce==="left"?Math.max(.1,Ue.startTime+Ue.duration-Ie):Math.max(.1,Ie-Ue.startTime),ht=Ue.keyframes.map(vt=>{if(vt.id.startsWith("kf-exit-")){const pt=vt.time-kt;return{...vt,time:tt+pt}}return vt});Ce==="left"?ae.updateTextClip(Q,{startTime:Ie,duration:tt}):ae.updateTextClip(Q,{duration:tt}),U.getState().updateTextClipKeyframes(Q,ht),U.setState(vt=>({project:{...vt.project,modifiedAt:Date.now()}}))},[ae,te]),Do=w.useCallback((Q,Ce)=>{!ae||!te.find(Ue=>Ue.id===Q)||(ae.updateTextClip(Q,{startTime:Math.max(0,Ce)}),U.setState(Ue=>({project:{...Ue.project,modifiedAt:Date.now()}})))},[ae,te]),Ia=w.useCallback((Q,Ce,Ie)=>{if(!q)return;const Ue=oe.find(pt=>pt.id===Q);if(!Ue)return;const kt=Ue.duration,tt=Ce==="left"?Math.max(.1,Ue.startTime+Ue.duration-Ie):Math.max(.1,Ie-Ue.startTime),ht=Ce==="left"?{startTime:Ie,duration:tt}:{duration:tt},vt=Ue.keyframes.map(pt=>{if(pt.id.startsWith("kf-exit-")){const gr=pt.time-kt;return{...pt,time:tt+gr}}return pt});Ue.type==="sticker"||Ue.type==="emoji"?q.updateStickerClip(Q,ht):Ue.type==="svg"?q.updateSVGClip(Q,ht):q.updateShapeClip(Q,ht),U.getState().updateClipKeyframes(Q,vt),U.setState(pt=>({project:{...pt.project,modifiedAt:Date.now()}}))},[q,oe]),Bt=w.useCallback((Q,Ce,Ie)=>{const Ue=x.flatMap(pt=>pt.clips).find(pt=>pt.id===Q);if(!Ue)return;const kt=Ue.duration,tt=Ce==="left"?Math.max(.1,Ue.startTime+Ue.duration-Ie):Math.max(.1,Ie-Ue.startTime),ht=Ce==="left"?{startTime:Ie,duration:tt}:{duration:tt},vt=Ue.keyframes.map(pt=>{if(pt.id.startsWith("kf-exit-")){const gr=pt.time-kt;return{...pt,time:tt+gr}}return pt});U.setState(pt=>({project:{...pt.project,timeline:{...pt.project.timeline,tracks:pt.project.timeline.tracks.map(gr=>({...gr,clips:gr.clips.map(Xi=>Xi.id===Q?{...Xi,...ht,keyframes:vt}:Xi)}))},modifiedAt:Date.now()}}))},[x]),Qr=w.useMemo(()=>x,[x]);return c.jsxs("div",{"data-tour":"timeline",className:"h-full bg-background border-t border-border flex flex-col",children:[c.jsxs("div",{className:"h-12 border-b border-border flex items-center justify-between px-4 bg-background-secondary relative z-[100]",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("div",{className:"flex bg-background-tertiary rounded-lg p-1 border border-border",children:[c.jsx($r,{icon:t_,onClick:s,disabled:!n(),title:"Undo (Cmd+Z)"}),c.jsx($r,{icon:Qj,onClick:i,disabled:!a(),title:"Redo (Cmd+Shift+Z)"})]}),c.jsx("div",{className:"w-px h-6 bg-border mx-1"}),c.jsxs("div",{className:"flex bg-background-tertiary rounded-lg p-1 border border-border gap-1",children:[c.jsxs("button",{onClick:et,disabled:z.length!==1,title:"Split clip at playhead (S)",className:`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${z.length===1?"bg-orange-500/20 text-orange-400 hover:bg-orange-500/30 border border-orange-500/30":"text-text-muted opacity-50 cursor-not-allowed"}`,children:[c.jsx(Bx,{size:14}),c.jsx("span",{className:"text-[10px] font-medium",children:"SPLIT"})]}),c.jsx($r,{icon:bs,onClick:Ee,disabled:z.length===0,title:"Delete clip (Del)",className:"hover:text-red-500"})]}),c.jsx("div",{className:"w-px h-6 bg-border mx-1"}),c.jsxs(Cd,{children:[c.jsx(Sd,{asChild:!0,children:c.jsxs("button",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-primary/10 text-primary hover:bg-primary/20 border border-primary/20 transition-colors",title:"Add new track",children:[c.jsx(Ar,{size:14}),c.jsx("span",{className:"text-[11px] font-semibold",children:"Add Track"}),c.jsx(ns,{size:12,className:"ml-0.5 opacity-60"})]})}),c.jsxs(jc,{side:"top",align:"start",sideOffset:8,className:"w-48",children:[c.jsxs(wi,{onClick:()=>d("video"),children:[c.jsx(vn,{size:16,className:"text-green-400"}),c.jsx("span",{children:"Video Track"})]}),c.jsxs(wi,{onClick:()=>d("audio"),children:[c.jsx(qr,{size:16,className:"text-blue-400"}),c.jsx("span",{children:"Audio Track"})]}),c.jsx(Td,{}),c.jsxs(wi,{onClick:()=>d("image"),children:[c.jsx(No,{size:16,className:"text-purple-400"}),c.jsx("span",{children:"Image Track"})]}),c.jsxs(wi,{onClick:()=>d("text"),children:[c.jsx(Vs,{size:16,className:"text-yellow-400"}),c.jsx("span",{children:"Text Track"})]}),c.jsxs(wi,{onClick:()=>d("graphics"),children:[c.jsx(yu,{size:16,className:"text-pink-400"}),c.jsx("span",{children:"Graphics Track"})]})]})]}),c.jsx("div",{className:"w-px h-6 bg-border mx-1"}),c.jsxs(iM,{open:F,onOpenChange:I,children:[c.jsx(rM,{asChild:!0,children:c.jsxs("button",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg transition-colors ${F?"bg-primary/20 text-primary":"hover:bg-background-elevated text-text-secondary hover:text-text-primary"}`,title:"Manage track layers",children:[c.jsx(Gs,{size:14}),c.jsx("span",{className:"text-[10px] font-medium tracking-wide",children:"LAYERS"})]})}),c.jsxs(xb,{side:"top",align:"start",sideOffset:8,className:"w-64 p-0 bg-background-secondary border-border",children:[c.jsx("div",{className:"flex items-center justify-between px-3 py-2.5 border-b border-border bg-background-tertiary",children:c.jsx("span",{className:"text-xs font-semibold text-text-primary",children:"Track Layers"})}),c.jsx("div",{className:"p-2 max-h-60 overflow-y-auto",children:x.length===0?c.jsx("p",{className:"text-xs text-text-muted text-center py-6",children:"No tracks yet"}):c.jsx("div",{className:"space-y-0.5",children:x.map((Q,Ce)=>{const Ie=rN(Q,Ce);return c.jsxs("div",{className:"flex items-center gap-2.5 px-2 py-2 rounded-md hover:bg-background-tertiary group transition-colors cursor-default",children:[c.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center ${Ie.bgLight}`,children:c.jsx(Ie.icon,{size:14,className:Ie.textColor})}),c.jsx("span",{className:"text-[11px] font-medium text-text-primary flex-1 truncate",children:Q.name||Ie.label}),c.jsxs("div",{className:"flex gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:()=>Ce>0&&u(Q.id,Ce-1),disabled:Ce===0,className:"p-1.5 rounded-md hover:bg-background-elevated disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Move up",children:c.jsx(Uj,{size:12})}),c.jsx("button",{onClick:()=>Ce<x.length-1&&u(Q.id,Ce+1),disabled:Ce===x.length-1,className:"p-1.5 rounded-md hover:bg-background-elevated disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Move down",children:c.jsx(ns,{size:12})})]})]},Q.id)})})})]})]})]}),c.jsx("div",{className:"font-mono text-primary text-sm font-bold tracking-wider bg-background-tertiary px-4 py-1.5 rounded-lg border border-primary/20 shadow-[0_0_12px_rgba(34,197,94,0.15)]",children:iN(S)}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("div",{className:"flex items-center bg-background-tertiary rounded-lg border border-border px-3 py-1.5 gap-2",children:[c.jsx("label",{className:"text-[11px] text-text-secondary whitespace-nowrap",children:"Project Length"}),c.jsx("input",{type:"number",step:"0.1",min:"0",value:t.timeline?.duration||0,onChange:Q=>{const Ce=parseFloat(Q.target.value);!isNaN(Ce)&&Ce>=0&&y(Ce)},onFocus:()=>{},className:"w-20 bg-background text-text-primary text-[11px] font-mono px-2 py-1 rounded border border-border focus:border-primary focus:outline-none",placeholder:"Auto",title:"Project duration in seconds (0 = auto-calculate from clips)"}),c.jsx("span",{className:"text-[11px] text-text-secondary",children:"s"})]}),c.jsxs("div",{className:"flex items-center bg-background-tertiary rounded-lg border border-border overflow-hidden",children:[c.jsx("button",{onClick:R,className:"w-8 h-8 flex items-center justify-center text-text-secondary hover:text-text-primary hover:bg-background-elevated transition-colors border-r border-border",title:"Zoom out",children:c.jsx("span",{className:"text-base font-medium",children:""})}),c.jsxs("span",{className:"text-[11px] w-14 text-center font-mono text-text-secondary tabular-nums",children:[Math.round(C),"px/s"]}),c.jsx("button",{onClick:D,className:"w-8 h-8 flex items-center justify-center text-text-secondary hover:text-text-primary hover:bg-background-elevated transition-colors border-l border-border",title:"Zoom in",children:c.jsx("span",{className:"text-base font-medium",children:"+"})})]}),c.jsx($r,{icon:ja,title:"Maximize timeline"})]})]}),c.jsxs("div",{ref:r,className:"flex-1 flex flex-col overflow-hidden relative",children:[c.jsxs("div",{className:"flex shrink-0",children:[c.jsx("div",{className:"w-32 h-8 bg-background-tertiary border-b border-r border-border shrink-0"}),c.jsx("div",{className:"flex-1 overflow-hidden relative",children:c.jsx("div",{style:{width:`${ie*C}px`,transform:`translateX(-${A}px)`},children:c.jsx(aZ,{duration:ie,pixelsPerSecond:C,scrollX:A,viewportWidth:j,onSeek:Q=>{ud().scrubTo(Q)},onScrubStart:()=>{ud().startScrubbing()},onScrubEnd:()=>{ud().endScrubbing()}})})})]}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:"w-32 bg-background-secondary border-r border-border shrink-0 z-20 shadow-lg overflow-hidden",children:c.jsx("div",{className:"flex flex-col",style:{transform:`translateY(-${T}px)`},children:Qr.map((Q,Ce)=>{const Ie=Q.clips.reduce((Ue,kt)=>Ue+(kt.keyframes?.length||0),0);return c.jsx("div",{className:v===Q.id?"opacity-50":"",style:{height:we(Q.id)},children:c.jsx(oZ,{track:Q,index:Ce,onDragStart:ke,onDragOver:Ge,onDrop:Je,keyframeCount:Ie})},Q.id)})})}),c.jsx("div",{ref:e,className:"flex-1 bg-background relative overflow-auto custom-scrollbar",onScroll:Q=>{_(Q.currentTarget.scrollLeft),M(Q.currentTarget.scrollTop)},onMouseDown:At,onMouseMove:mi,children:c.jsxs("div",{style:{width:`${ie*C}px`},className:"min-w-full",children:[Qr.map(Q=>c.jsx(pZ,{track:Q,allTracks:Qr,pixelsPerSecond:C,selectedClipIds:z,textClips:Ve(Q.id),shapeClips:V(Q.id),trackHeights:fe,timelineRef:e,onSelectClip:Tt,onDropMedia:qi,onMoveClip:vs,onSnapIndicator:Kr,onTrimClip:Q.type==="video"||Q.type==="image"||Q.type==="audio"?Bt:void 0,onTrimTextClip:Pn,onMoveTextClip:Do,onTrimShapeClip:Ia,scrollX:A,trackHeight:we(Q.id),onResizeTrack:B},Q.id)),c.jsx(mZ,{pixelsPerSecond:C,scrollX:A,viewportWidth:j,totalHeight:qe}),t.timeline.markers.map(Q=>c.jsx(fZ,{marker:Q,pixelsPerSecond:C,scrollX:A,onSeek:Ce=>{ud().scrubTo(Ce)},onRemove:f,onUpdate:g},Q.id)),ni!==null&&c.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-yellow-400 z-30 pointer-events-none",style:{left:`${ni*C}px`},children:c.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-yellow-400 rounded-full"})}),he&&J&&c.jsx("div",{className:"absolute border-2 border-primary bg-primary/10 pointer-events-none z-40",style:{left:Math.min(J.startX,J.currentX)-A,top:Math.min(J.startY,J.currentY)-T,width:Math.abs(J.currentX-J.startX),height:Math.abs(J.currentY-J.startY)}})]})})]}),c.jsx(nZ,{position:S,pixelsPerSecond:C,scrollX:A,headerOffset:128})]})]})},eS={"position.x":"#22d3ee","position.y":"#a78bfa","scale.x":"#4ade80","scale.y":"#86efac",rotation:"#f472b6",opacity:"#fbbf24",borderRadius:"#94a3b8",default:"#64748b"},yZ=[{label:"Linear",value:"linear"},{label:"Ease In",value:"easeInQuad"},{label:"Ease Out",value:"easeOutQuad"},{label:"Ease In Out",value:"easeInOutQuad"},{label:"Ease In Cubic",value:"easeInCubic"},{label:"Ease Out Cubic",value:"easeOutCubic"},{label:"Ease In Out Cubic",value:"easeInOutCubic"},{label:"Ease In Quart",value:"easeInQuart"},{label:"Ease Out Quart",value:"easeOutQuart"},{label:"Ease In Out Quart",value:"easeInOutQuart"},{label:"Ease In Back",value:"easeInBack"},{label:"Ease Out Back",value:"easeOutBack"},{label:"Ease In Out Back",value:"easeInOutBack"},{label:"Ease In Elastic",value:"easeInElastic"},{label:"Ease Out Elastic",value:"easeOutElastic"},{label:"Ease In Out Elastic",value:"easeInOutElastic"},{label:"Ease In Bounce",value:"easeInBounce"},{label:"Ease Out Bounce",value:"easeOutBounce"},{label:"Ease In Out Bounce",value:"easeInOutBounce"}],Gt=40,br=200,xZ=({clip:r,onClose:e,onUpdateKeyframe:t,onDeleteKeyframe:s,onCopyKeyframes:i,onPasteKeyframes:n,selectedKeyframeIds:a,onSelectKeyframe:o,copiedKeyframes:l})=>{const[d,u]=w.useState(null),h=w.useRef(null),[p,m]=w.useState(!1),[f,g]=w.useState(null),y=600,x=w.useMemo(()=>{if(!r?.keyframes)return[];const F=new Map;for(const I of r.keyframes){const K=F.get(I.property)||[];K.push(I),F.set(I.property,K)}return Array.from(F.entries()).map(([I,K])=>({property:I,keyframes:K.sort((ee,P)=>ee.time-P.time),color:eS[I]||eS.default})).sort((I,K)=>I.property.localeCompare(K.property))},[r?.keyframes]);w.useEffect(()=>{x.length>0&&!d&&u(x[0].property)},[x,d]);const v=w.useMemo(()=>x.find(F=>F.property===d)||null,[x,d]),b=w.useMemo(()=>{if(!v||v.keyframes.length===0)return{min:0,max:r?.duration||1};const F=v.keyframes.map(I=>I.time);return{min:Math.min(0,...F),max:Math.max(r?.duration||1,...F)}},[v,r?.duration]),S=w.useMemo(()=>{if(!v||v.keyframes.length===0)return{min:0,max:1};const F=v.keyframes.map(P=>P.value),I=Math.min(...F),K=Math.max(...F),ee=(K-I)*.1||.1;return{min:I-ee,max:K+ee}},[v]),k=w.useCallback(F=>{const I=b.max-b.min;return Gt+(F-b.min)/I*(y-Gt*2)},[b,y]),C=w.useCallback(F=>{const I=S.max-S.min;return Gt+(1-(F-S.min)/I)*(br-Gt*2)},[S]),A=w.useCallback(F=>{const I=b.max-b.min;return b.min+(F-Gt)/(y-Gt*2)*I},[b,y]),T=w.useCallback(F=>{const I=S.max-S.min;return S.min+(1-(F-Gt)/(br-Gt*2))*I},[S]),j=w.useCallback(()=>{const F=h.current;if(!F||!v)return;const I=F.getContext("2d");if(!I)return;const K=window.devicePixelRatio||1;F.width=y*K,F.height=br*K,I.scale(K,K),I.fillStyle="#1a1a1a",I.fillRect(0,0,y,br),I.strokeStyle="#333",I.lineWidth=1;for(let ee=0;ee<=10;ee++){const P=Gt+ee/10*(y-Gt*2);I.beginPath(),I.moveTo(P,Gt),I.lineTo(P,br-Gt),I.stroke()}for(let ee=0;ee<=5;ee++){const P=Gt+ee/5*(br-Gt*2);I.beginPath(),I.moveTo(Gt,P),I.lineTo(y-Gt,P),I.stroke()}I.strokeStyle="#555",I.lineWidth=2,I.beginPath(),I.moveTo(Gt,br-Gt),I.lineTo(y-Gt,br-Gt),I.lineTo(y-Gt,Gt),I.stroke(),I.fillStyle="#888",I.font="10px sans-serif",I.textAlign="center";for(let ee=0;ee<=5;ee++){const P=b.min+ee/5*(b.max-b.min),W=k(P);I.fillText(P.toFixed(2)+"s",W,br-10)}I.textAlign="right";for(let ee=0;ee<=5;ee++){const P=S.min+ee/5*(S.max-S.min),W=C(P);I.fillText(P.toFixed(2),Gt-5,W+3)}if(v.keyframes.length>1){I.strokeStyle=v.color,I.lineWidth=2,I.beginPath();const ee=100;for(let P=0;P<=ee;P++){const W=P/ee,z=Math.floor(W*(v.keyframes.length-1)),G=Math.min(z+1,v.keyframes.length-1),ce=W*(v.keyframes.length-1)-z,ae=v.keyframes[z],te=v.keyframes[G],q=(Li[ae.easing]||Li.linear)(ce),oe=ae.time+(te.time-ae.time)*ce,V=ae.value+(te.value-ae.value)*q,he=k(oe),Se=C(V);P===0?I.moveTo(he,Se):I.lineTo(he,Se)}I.stroke()}for(const ee of v.keyframes){const P=k(ee.time),W=C(ee.value),z=a.includes(ee.id);I.save(),I.translate(P,W),I.rotate(Math.PI/4),I.fillStyle=v.color,I.fillRect(-6,-6,12,12),z&&(I.strokeStyle="#fff",I.lineWidth=2,I.strokeRect(-6,-6,12,12),I.shadowColor=v.color,I.shadowBlur=10,I.fillRect(-6,-6,12,12)),I.restore()}},[v,y,k,C,b,S,a]);w.useEffect(()=>{j()},[j]);const _=w.useCallback(F=>{if(!v)return;const I=h.current?.getBoundingClientRect();if(!I)return;const K=F.clientX-I.left,ee=F.clientY-I.top;for(const P of v.keyframes){const W=k(P.time),z=C(P.value);if(Math.sqrt((K-W)**2+(ee-z)**2)<10){o(P.id,F.shiftKey||F.metaKey),m(!0),g(P.id);return}}},[v,k,C,o]),M=w.useCallback(F=>{if(!p||!f||!v)return;const I=h.current?.getBoundingClientRect();if(!I)return;const K=F.clientX-I.left,ee=F.clientY-I.top,P=Math.max(0,A(K)),W=T(ee);t(f,{time:P,value:W})},[p,f,v,A,T,t]),E=w.useCallback(()=>{m(!1),g(null)},[]);w.useEffect(()=>{const F=()=>{m(!1),g(null)};return window.addEventListener("mouseup",F),()=>window.removeEventListener("mouseup",F)},[]);const D=w.useCallback(()=>{i(a)},[i,a]),R=w.useCallback(()=>{r&&n(r.id,0)},[r,n]),B=w.useCallback(()=>{for(const F of a)s(F)},[a,s]),O=w.useCallback(F=>{for(const I of a)t(I,{easing:F})},[a,t]);return r?c.jsxs("div",{className:"h-full flex flex-col bg-background-secondary border-l border-border",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[c.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Keyframe Editor"}),c.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-background-elevated text-text-muted hover:text-text-primary transition-colors",children:c.jsx(ti,{size:16})})]}),c.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border bg-background-tertiary",children:[c.jsxs(Pt,{value:d||"",onValueChange:u,children:[c.jsx(Ct,{className:"w-[180px] h-8",children:c.jsx(Nt,{placeholder:"Select property"})}),c.jsx(St,{children:x.map(F=>c.jsx(ze,{value:F.property,children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:F.color}}),c.jsx("span",{children:F.property})]})},F.property))})]}),c.jsx("div",{className:"flex-1"}),c.jsxs(Rt,{variant:"ghost",size:"sm",onClick:D,disabled:a.length===0,className:"h-8 px-2",children:[c.jsx(Eo,{size:14,className:"mr-1"}),"Copy"]}),c.jsxs(Rt,{variant:"ghost",size:"sm",onClick:R,disabled:l.length===0,className:"h-8 px-2",children:[c.jsx(mL,{size:14,className:"mr-1"}),"Paste"]}),c.jsxs(Rt,{variant:"ghost",size:"sm",onClick:B,disabled:a.length===0,className:"h-8 px-2 text-red-400 hover:text-red-300",children:[c.jsx(bs,{size:14,className:"mr-1"}),"Delete"]})]}),c.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:c.jsx("canvas",{ref:h,width:y,height:br,className:"rounded border border-border cursor-crosshair",style:{width:y,height:br},onMouseDown:_,onMouseMove:M,onMouseUp:E})}),c.jsx("div",{className:"px-4 py-3 border-t border-border bg-background-tertiary",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-text-muted",children:"Easing:"}),c.jsxs(Pt,{value:a.length>0?void 0:"",onValueChange:O,disabled:a.length===0,children:[c.jsx(Ct,{className:"w-[160px] h-7 text-xs",children:c.jsx(Nt,{placeholder:"Select easing"})}),c.jsx(St,{children:yZ.map(F=>c.jsx(ze,{value:F.value,children:F.label},F.value))})]})]}),c.jsx("div",{className:"flex-1"}),c.jsxs("span",{className:"text-xs text-text-muted",children:[a.length," keyframe",a.length!==1?"s":""," selected"]})]})}),v&&c.jsx(ha,{className:"max-h-32 border-t border-border",children:c.jsx("div",{className:"p-2",children:c.jsxs("table",{className:"w-full text-xs",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"text-text-muted",children:[c.jsx("th",{className:"text-left py-1 px-2",children:"Time"}),c.jsx("th",{className:"text-left py-1 px-2",children:"Value"}),c.jsx("th",{className:"text-left py-1 px-2",children:"Easing"})]})}),c.jsx("tbody",{children:v.keyframes.map(F=>c.jsxs("tr",{className:`cursor-pointer hover:bg-background-elevated transition-colors ${a.includes(F.id)?"bg-primary/20":""}`,onClick:I=>o(F.id,I.shiftKey||I.metaKey),children:[c.jsxs("td",{className:"py-1 px-2",children:[F.time.toFixed(3),"s"]}),c.jsx("td",{className:"py-1 px-2",children:F.value.toFixed(3)}),c.jsx("td",{className:"py-1 px-2",children:F.easing})]},F.id))})]})})})]}):c.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:c.jsx("p",{className:"text-sm",children:"Select a clip with keyframes to edit"})})},tS="openreel_shortcuts",sS="openreel_shortcut_preset";function Ly(r){const e=r.toLowerCase().split("+");return{key:e[e.length-1],meta:e.includes("cmd")||e.includes("meta"),ctrl:e.includes("ctrl"),shift:e.includes("shift"),alt:e.includes("alt")||e.includes("option")}}function aN(r){const e=[];(r.meta||r.ctrl)&&e.push(""),r.shift&&e.push(""),r.alt&&e.push("");const t={space:"Space",arrowleft:"",arrowright:"",arrowup:"",arrowdown:"",delete:"",backspace:"",escape:"Esc",enter:"",tab:"",home:"Home",end:"End"};return e.push(t[r.key]||r.key.toUpperCase()),e.join("")}const bZ=[{id:"playback.playPause",name:"Play/Pause",description:"Toggle playback",category:"playback",defaultKey:"space",currentKey:"space",action:"playback.playPause",enabled:!0},{id:"playback.frameBack",name:"Frame Back",description:"Move back one frame",category:"playback",defaultKey:"arrowleft",currentKey:"arrowleft",action:"playback.frameBack",enabled:!0},{id:"playback.frameForward",name:"Frame Forward",description:"Move forward one frame",category:"playback",defaultKey:"arrowright",currentKey:"arrowright",action:"playback.frameForward",enabled:!0},{id:"playback.secondBack",name:"Second Back",description:"Move back one second",category:"playback",defaultKey:"shift+arrowleft",currentKey:"shift+arrowleft",action:"playback.secondBack",enabled:!0},{id:"playback.secondForward",name:"Second Forward",description:"Move forward one second",category:"playback",defaultKey:"shift+arrowright",currentKey:"shift+arrowright",action:"playback.secondForward",enabled:!0},{id:"playback.jump5Back",name:"Jump 5s Back",description:"Move back 5 seconds",category:"playback",defaultKey:"arrowup",currentKey:"arrowup",action:"playback.jump5Back",enabled:!0},{id:"playback.jump5Forward",name:"Jump 5s Forward",description:"Move forward 5 seconds",category:"playback",defaultKey:"arrowdown",currentKey:"arrowdown",action:"playback.jump5Forward",enabled:!0},{id:"playback.goToStart",name:"Go to Start",description:"Jump to timeline start",category:"playback",defaultKey:"home",currentKey:"home",action:"playback.goToStart",enabled:!0},{id:"playback.goToEnd",name:"Go to End",description:"Jump to timeline end",category:"playback",defaultKey:"end",currentKey:"end",action:"playback.goToEnd",enabled:!0},{id:"playback.prevClip",name:"Previous Clip",description:"Jump to previous clip edge",category:"playback",defaultKey:"[",currentKey:"[",action:"playback.prevClip",enabled:!0},{id:"playback.nextClip",name:"Next Clip",description:"Jump to next clip edge",category:"playback",defaultKey:"]",currentKey:"]",action:"playback.nextClip",enabled:!0},{id:"editing.undo",name:"Undo",description:"Undo last action",category:"editing",defaultKey:"cmd+z",currentKey:"cmd+z",action:"editing.undo",enabled:!0},{id:"editing.redo",name:"Redo",description:"Redo last undone action",category:"editing",defaultKey:"cmd+shift+z",currentKey:"cmd+shift+z",action:"editing.redo",enabled:!0},{id:"editing.cut",name:"Cut",description:"Cut selected clips",category:"editing",defaultKey:"cmd+x",currentKey:"cmd+x",action:"editing.cut",enabled:!0},{id:"editing.copy",name:"Copy",description:"Copy selected clips",category:"editing",defaultKey:"cmd+c",currentKey:"cmd+c",action:"editing.copy",enabled:!0},{id:"editing.paste",name:"Paste",description:"Paste clips at playhead",category:"editing",defaultKey:"cmd+v",currentKey:"cmd+v",action:"editing.paste",enabled:!0},{id:"editing.duplicate",name:"Duplicate",description:"Duplicate selected clip",category:"editing",defaultKey:"cmd+d",currentKey:"cmd+d",action:"editing.duplicate",enabled:!0},{id:"editing.delete",name:"Delete",description:"Delete selected clips",category:"editing",defaultKey:"delete",currentKey:"delete",action:"editing.delete",enabled:!0},{id:"editing.rippleDelete",name:"Ripple Delete",description:"Delete and close gap",category:"editing",defaultKey:"shift+delete",currentKey:"shift+delete",action:"editing.rippleDelete",enabled:!0},{id:"editing.split",name:"Split",description:"Split clip at playhead",category:"editing",defaultKey:"s",currentKey:"s",action:"editing.split",enabled:!0},{id:"editing.trimStart",name:"Trim Start",description:"Trim clip start to playhead",category:"editing",defaultKey:"q",currentKey:"q",action:"editing.trimStart",enabled:!0},{id:"editing.trimEnd",name:"Trim End",description:"Trim clip end to playhead",category:"editing",defaultKey:"w",currentKey:"w",action:"editing.trimEnd",enabled:!0},{id:"selection.selectAll",name:"Select All",description:"Select all clips",category:"selection",defaultKey:"cmd+a",currentKey:"cmd+a",action:"selection.selectAll",enabled:!0},{id:"selection.deselect",name:"Deselect",description:"Clear selection",category:"selection",defaultKey:"escape",currentKey:"escape",action:"selection.deselect",enabled:!0},{id:"timeline.toggleSnap",name:"Toggle Snap",description:"Toggle snapping",category:"timeline",defaultKey:"n",currentKey:"n",action:"timeline.toggleSnap",enabled:!0},{id:"timeline.zoomIn",name:"Zoom In",description:"Zoom in timeline",category:"timeline",defaultKey:"cmd+=",currentKey:"cmd+=",action:"timeline.zoomIn",enabled:!0},{id:"timeline.zoomOut",name:"Zoom Out",description:"Zoom out timeline",category:"timeline",defaultKey:"cmd+-",currentKey:"cmd+-",action:"timeline.zoomOut",enabled:!0},{id:"timeline.fitTimeline",name:"Fit Timeline",description:"Fit timeline to view",category:"timeline",defaultKey:"cmd+0",currentKey:"cmd+0",action:"timeline.fitTimeline",enabled:!0},{id:"view.showShortcuts",name:"Show Shortcuts",description:"Show keyboard shortcuts",category:"view",defaultKey:"?",currentKey:"?",action:"view.showShortcuts",enabled:!0},{id:"file.save",name:"Save",description:"Save project",category:"file",defaultKey:"cmd+s",currentKey:"cmd+s",action:"file.save",enabled:!0},{id:"file.export",name:"Export",description:"Export video",category:"file",defaultKey:"cmd+e",currentKey:"cmd+e",action:"file.export",enabled:!0},{id:"tools.addText",name:"Add Text",description:"Add text clip",category:"tools",defaultKey:"t",currentKey:"t",action:"tools.addText",enabled:!0},{id:"tools.addMarker",name:"Add Marker",description:"Add marker at playhead",category:"tools",defaultKey:"m",currentKey:"m",action:"tools.addMarker",enabled:!0}],iS=[{id:"openreel",name:"OpenReel Default",description:"Default OpenReel shortcuts",shortcuts:{}},{id:"capcut",name:"CapCut",description:"CapCut-style shortcuts",shortcuts:{"editing.split":"ctrl+b","playback.playPause":"space","editing.delete":"delete"}},{id:"premiere",name:"Adobe Premiere",description:"Premiere Pro-style shortcuts",shortcuts:{"editing.split":"cmd+k","playback.playPause":"space","playback.frameBack":"arrowleft","playback.frameForward":"arrowright","editing.rippleDelete":"shift+delete"}},{id:"finalcut",name:"Final Cut Pro",description:"Final Cut Pro-style shortcuts",shortcuts:{"editing.split":"cmd+b","playback.playPause":"space","editing.trimStart":"[","editing.trimEnd":"]"}},{id:"davinci",name:"DaVinci Resolve",description:"DaVinci Resolve-style shortcuts",shortcuts:{"editing.split":"cmd+\\","playback.playPause":"space","editing.rippleDelete":"shift+backspace"}}];class vZ{shortcuts=new Map;handlers=new Map;activePreset="openreel";isListening=!1;constructor(){this.loadShortcuts(),this.loadPreset()}loadShortcuts(){const e=localStorage.getItem(tS),t=e?JSON.parse(e):{};bZ.forEach(s=>{const i=t[s.id];this.shortcuts.set(s.id,{...s,currentKey:i||s.defaultKey})})}loadPreset(){const e=localStorage.getItem(sS);e&&(this.activePreset=e)}saveShortcuts(){const e={};this.shortcuts.forEach((t,s)=>{t.currentKey!==t.defaultKey&&(e[s]=t.currentKey)}),localStorage.setItem(tS,JSON.stringify(e))}savePreset(){localStorage.setItem(sS,this.activePreset)}startListening(){this.isListening||(this.isListening=!0,window.addEventListener("keydown",this.handleKeyDown))}stopListening(){this.isListening&&(this.isListening=!1,window.removeEventListener("keydown",this.handleKeyDown))}handleKeyDown=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;const t=this.findMatchingShortcut(e);t&&(e.preventDefault(),e.stopPropagation(),this.executeAction(t.action,e))};findMatchingShortcut(e){const t=e.metaKey||e.ctrlKey;for(const s of this.shortcuts.values()){if(!s.enabled)continue;const i=Ly(s.currentKey),n=e.key.toLowerCase()===i.key||e.code.toLowerCase()===i.key,a=(i.meta||i.ctrl)===t,o=i.shift===e.shiftKey,l=i.alt===e.altKey;if(n&&a&&o&&l)return s}return null}executeAction(e,t){const s=this.handlers.get(e);s&&s.forEach(i=>i(t))}registerHandler(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{this.handlers.get(e)?.delete(t)}}getShortcut(e){return this.shortcuts.get(e)}getAllShortcuts(){return Array.from(this.shortcuts.values())}getShortcutsByCategory(e){return this.getAllShortcuts().filter(t=>t.category===e)}setShortcut(e,t){const s=this.shortcuts.get(e);return!s||this.findConflict(t,e)?!1:(this.shortcuts.set(e,{...s,currentKey:t}),this.saveShortcuts(),!0)}resetShortcut(e){const t=this.shortcuts.get(e);t&&(this.shortcuts.set(e,{...t,currentKey:t.defaultKey}),this.saveShortcuts())}resetAllShortcuts(){this.shortcuts.forEach((e,t)=>{this.shortcuts.set(t,{...e,currentKey:e.defaultKey})}),this.saveShortcuts()}findConflict(e,t){for(const[s,i]of this.shortcuts)if(s!==t&&i.currentKey.toLowerCase()===e.toLowerCase())return i;return null}getPresets(){return iS}getActivePreset(){return this.activePreset}applyPreset(e){const t=iS.find(s=>s.id===e);t&&(this.resetAllShortcuts(),Object.entries(t.shortcuts).forEach(([s,i])=>{const n=this.shortcuts.get(s);n&&this.shortcuts.set(s,{...n,currentKey:i})}),this.activePreset=e,this.saveShortcuts(),this.savePreset())}formatShortcut(e){const t=this.shortcuts.get(e);if(!t)return"";const s=Ly(t.currentKey);return aN(s)}getCategories(){return["playback","editing","selection","timeline","view","file","tools"]}getCategoryName(e){return{playback:"Playback",editing:"Editing",selection:"Selection",timeline:"Timeline",view:"View",file:"File",tools:"Tools"}[e]}}const Ps=new vZ;function wZ(r){const e=Ly(r);return aN(e)}const kZ=({isOpen:r,onClose:e})=>{const[t,s]=w.useState(""),[i,n]=w.useState("all"),[a,o]=w.useState([]),[l,d]=w.useState(null),[u,h]=w.useState(!1),[p,m]=w.useState(Ps.getActivePreset());w.useEffect(()=>{o(Ps.getAllShortcuts())},[]),w.useEffect(()=>{const C=A=>{A.key==="Escape"&&r&&(l?d(null):e())};return window.addEventListener("keydown",C),()=>window.removeEventListener("keydown",C)},[r,e,l]);const f=a.filter(C=>{const A=i==="all"||C.category===i,T=t===""||C.name.toLowerCase().includes(t.toLowerCase())||C.description.toLowerCase().includes(t.toLowerCase());return A&&T}),g=f.reduce((C,A)=>(C[A.category]||(C[A.category]=[]),C[A.category].push(A),C),{}),y=w.useCallback((C,A)=>{if(C.preventDefault(),C.stopPropagation(),C.key==="Escape"){d(null);return}if(["Shift","Control","Alt","Meta"].includes(C.key))return;const T=[];(C.metaKey||C.ctrlKey)&&T.push("cmd"),C.shiftKey&&T.push("shift"),C.altKey&&T.push("alt"),T.push(C.key.toLowerCase());const j=T.join("+"),_=Ps.findConflict(j,A);if(_){alert(`This shortcut conflicts with "${_.name}". Choose a different key.`);return}Ps.setShortcut(A,j),o(Ps.getAllShortcuts()),d(null)},[]),x=C=>{Ps.resetShortcut(C),o(Ps.getAllShortcuts())},v=()=>{confirm("Reset all shortcuts to defaults?")&&(Ps.resetAllShortcuts(),o(Ps.getAllShortcuts()))},b=C=>{Ps.applyPreset(C),o(Ps.getAllShortcuts()),m(C),h(!1)},S=Ps.getCategories(),k=Ps.getPresets();return r?c.jsx(Ea,{open:!0,onOpenChange:C=>!C&&e(),children:c.jsxs(En,{className:"max-w-3xl max-h-[80vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsx(Ma,{className:"p-4 border-b border-border bg-background-tertiary space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Nw,{size:20,className:"text-primary"}),c.jsx(Pa,{className:"text-lg font-bold text-text-primary",children:"Keyboard Shortcuts"})]})}),c.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(Mo,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted z-10"}),c.jsx(Ns,{type:"text",value:t,onChange:C=>s(C.target.value),placeholder:"Search shortcuts...",className:"pl-9 bg-background-tertiary border-border text-text-primary"})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>h(!u),className:"flex items-center gap-2 px-3 py-2 bg-background-tertiary border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx("span",{children:k.find(C=>C.id===p)?.name||"Preset"}),c.jsx(ns,{size:14})]}),u&&c.jsx("div",{className:"absolute top-full right-0 mt-1 w-48 bg-background-secondary border border-border rounded-lg shadow-lg z-10",children:k.map(C=>c.jsxs("button",{onClick:()=>b(C.id),className:`w-full text-left px-3 py-2 text-sm transition-colors ${p===C.id?"bg-primary/10 text-primary":"text-text-secondary hover:bg-background-tertiary hover:text-text-primary"}`,children:[c.jsx("div",{className:"font-medium",children:C.name}),c.jsx("div",{className:"text-[10px] text-text-muted",children:C.description})]},C.id))})]}),c.jsxs("button",{onClick:v,className:"flex items-center gap-1 px-3 py-2 text-sm text-text-muted hover:text-text-primary transition-colors",children:[c.jsx(Gi,{size:14}),"Reset All"]})]}),c.jsxs("div",{className:"flex gap-2 px-4 py-2 border-b border-border overflow-x-auto",children:[c.jsx("button",{onClick:()=>n("all"),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${i==="all"?"bg-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-background-tertiary"}`,children:"All"}),S.map(C=>c.jsx("button",{onClick:()=>n(C),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${i===C?"bg-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-background-tertiary"}`,children:Ps.getCategoryName(C)},C))]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[Object.entries(g).map(([C,A])=>c.jsxs("div",{children:[c.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase tracking-wider mb-3",children:Ps.getCategoryName(C)}),c.jsx("div",{className:"space-y-1",children:A.map(T=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-background-tertiary group",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-sm text-text-primary",children:T.name}),c.jsx("div",{className:"text-[10px] text-text-muted",children:T.description})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[l===T.id?c.jsx("input",{autoFocus:!0,onKeyDown:j=>y(j,T.id),placeholder:"Press keys...",className:"w-32 px-2 py-1 bg-primary/20 border border-primary rounded text-sm text-center text-text-primary focus:outline-none"}):c.jsx("button",{onClick:()=>d(T.id),className:"min-w-[80px] px-3 py-1.5 bg-background-tertiary border border-border rounded text-sm font-mono text-text-primary hover:border-primary transition-colors",children:wZ(T.currentKey)}),T.currentKey!==T.defaultKey&&c.jsx("button",{onClick:()=>x(T.id),className:"p-1 text-text-muted hover:text-text-primary opacity-0 group-hover:opacity-100 transition-opacity",title:"Reset to default",children:c.jsx(Gi,{size:12})})]})]},T.id))})]},C)),f.length===0&&c.jsxs("div",{className:"text-center py-8 text-text-muted",children:[c.jsx(Nw,{size:32,className:"mx-auto mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:"No shortcuts found"})]})]}),c.jsx("div",{className:"p-3 border-t border-border bg-background-tertiary text-center",children:c.jsxs("p",{className:"text-[10px] text-text-muted",children:["Click a shortcut key to customize  Press"," ",c.jsx("kbd",{className:"px-1.5 py-0.5 bg-background-secondary border border-border rounded text-[10px]",children:"?"})," ","to toggle this overlay"]})})]})}):null};class CZ extends He.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("[ErrorBoundary] Component error:",e,t),this.props.onError?.(e,t)}handleRetry=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:c.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center bg-background-secondary/50 rounded-lg m-2",children:[c.jsx("div",{className:"text-red-400 text-sm font-medium mb-2",children:"Something went wrong"}),c.jsx("div",{className:"text-text-muted text-xs mb-4 max-w-xs",children:this.state.error?.message||"An unexpected error occurred"}),c.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary text-xs rounded transition-colors",children:"Retry"})]}):this.props.children}}const Ul=({name:r,children:e})=>c.jsx(CZ,{fallback:c.jsx("div",{className:"flex-1 flex items-center justify-center p-4 text-center",children:c.jsxs("div",{className:"text-text-muted text-xs",children:[r," failed to load. Please refresh the page."]})}),children:e});function SZ(){const[r,e]=w.useState(!1),{undo:t,redo:s,splitClip:i,removeClip:n,rippleDeleteClip:a,copyClips:o,pasteClips:l,duplicateClip:d,getClip:u,project:h,addMarker:p}=U(),{getSelectedClipIds:m,clearSelection:f,toggleSnap:g,select:y}=ft(),{togglePlayback:x,seekRelative:v,seekTo:b,playheadPosition:S,zoomIn:k,zoomOut:C,zoomToFit:A}=Wt(),T=w.useCallback(()=>{x()},[x]),j=w.useCallback(()=>{v(-1/30)},[v]),_=w.useCallback(()=>{v(1/30)},[v]),M=w.useCallback(()=>{v(-1)},[v]),E=w.useCallback(()=>{v(1)},[v]),D=w.useCallback(()=>{v(-5)},[v]),R=w.useCallback(()=>{v(5)},[v]),B=w.useCallback(()=>{b(0)},[b]),O=w.useCallback(()=>{let fe=0;for(const ke of h.timeline.tracks)for(const Ge of ke.clips){const Je=Ge.startTime+Ge.duration;Je>fe&&(fe=Je)}b(fe)},[b,h.timeline.tracks]),F=w.useCallback(()=>{const fe=S;let ke=0;for(const Ge of h.timeline.tracks)for(const Je of Ge.clips){const Tt=Je.startTime+Je.duration;Je.startTime<fe-.001&&Je.startTime>ke&&(ke=Je.startTime),Tt<fe-.001&&Tt>ke&&(ke=Tt)}b(ke)},[b,h.timeline.tracks,S]),I=w.useCallback(()=>{const fe=S;let ke=1/0;for(const Ge of h.timeline.tracks)for(const Je of Ge.clips){const Tt=Je.startTime+Je.duration;Je.startTime>fe+.001&&Je.startTime<ke&&(ke=Je.startTime),Tt>fe+.001&&Tt<ke&&(ke=Tt)}ke!==1/0&&b(ke)},[b,h.timeline.tracks,S]),K=w.useCallback(()=>{t()},[t]),ee=w.useCallback(()=>{s()},[s]),P=w.useCallback(()=>{const fe=m();fe.length>0&&o(fe)},[m,o]),W=w.useCallback(()=>{const fe=m();fe.length>0&&(o(fe),fe.forEach(ke=>n(ke)))},[m,o,n]),z=w.useCallback(()=>{const fe=S,ke=h.timeline.tracks[0];ke&&l(ke.id,fe)},[l,S,h.timeline.tracks]),G=w.useCallback(()=>{const fe=m();fe.length===1&&d(fe[0])},[m,d]),ce=w.useCallback(()=>{m().forEach(ke=>n(ke)),f()},[m,n,f]),ae=w.useCallback(()=>{m().forEach(ke=>a(ke)),f()},[m,a,f]),te=w.useCallback(()=>{const fe=m();if(fe.length===1){const ke=S,Ge=u(fe[0]);Ge&&ke>Ge.startTime&&ke<Ge.startTime+Ge.duration&&i(fe[0],ke)}},[m,S,u,i]),Ve=w.useCallback(()=>{const fe=m();if(fe.length===1){const ke=S;U.getState().trimToPlayhead(fe[0],ke,!0)}},[m,S]),q=w.useCallback(()=>{const fe=m();if(fe.length===1){const ke=S;U.getState().trimToPlayhead(fe[0],ke,!1)}},[m,S]),oe=w.useCallback(()=>{for(const fe of h.timeline.tracks)for(const ke of fe.clips)y({id:ke.id,type:"clip"})},[y,h.timeline.tracks]),V=w.useCallback(()=>{f()},[f]),he=w.useCallback(()=>{g()},[g]),Se=w.useCallback(()=>{k()},[k]),J=w.useCallback(()=>{C()},[C]),be=w.useCallback(()=>{let fe=0;for(const ke of h.timeline.tracks)for(const Ge of ke.clips){const Je=Ge.startTime+Ge.duration;Je>fe&&(fe=Je)}A(fe||60)},[A,h.timeline.tracks]),ie=w.useCallback(()=>{e(!0)},[]),Pe=w.useCallback(()=>{},[]),$=w.useCallback(()=>{},[]),we=w.useCallback(()=>{},[]),qe=w.useCallback(()=>{const fe=S,ke=h.timeline.markers.length;p(fe,`Marker ${ke+1}`,"#3b82f6")},[S,h.timeline.markers.length,p]);return w.useEffect(()=>{const ke=[["playback.playPause",T],["playback.frameBack",j],["playback.frameForward",_],["playback.secondBack",M],["playback.secondForward",E],["playback.jump5Back",D],["playback.jump5Forward",R],["playback.goToStart",B],["playback.goToEnd",O],["playback.prevClip",F],["playback.nextClip",I],["editing.undo",K],["editing.redo",ee],["editing.cut",W],["editing.copy",P],["editing.paste",z],["editing.duplicate",G],["editing.delete",ce],["editing.rippleDelete",ae],["editing.split",te],["editing.trimStart",Ve],["editing.trimEnd",q],["selection.selectAll",oe],["selection.deselect",V],["timeline.toggleSnap",he],["timeline.zoomIn",Se],["timeline.zoomOut",J],["timeline.fitTimeline",be],["view.showShortcuts",ie],["file.save",Pe],["file.export",$],["tools.addText",we],["tools.addMarker",qe]].map(([Ge,Je])=>Ps.registerHandler(Ge,Je));return Ps.startListening(),()=>{ke.forEach(Ge=>Ge()),Ps.stopListening()}},[T,j,_,M,E,D,R,B,O,F,I,K,ee,W,P,z,G,ce,ae,te,Ve,q,oe,V,he,Se,J,be,ie,Pe,$,we,qe]),{showShortcutsOverlay:r,setShowShortcutsOverlay:e}}const TZ=()=>{const{initializeAutoSave:r}=U();w.useEffect(()=>{r().catch(console.error)},[r])},AZ=()=>{const{initialize:r,initialized:e,initializing:t,initError:s}=me(),[i,n]=w.useState(!1),[a,o]=w.useState("Starting..."),[l,d]=w.useState(null);return w.useEffect(()=>{let u=!0;return(async()=>{try{const p=me.getState();if(!p.initialized&&!p.initializing?(o("Initializing video engine..."),await r()):p.initializing&&await new Promise(x=>{const v=me.subscribe(b=>{(b.initialized||b.initError)&&(v(),x())})}),!u)return;const m=me.getState();if(!m.initialized)throw new Error(m.initError||"Engine initialization failed");if(o("Initializing media bridge..."),await _y(),!u||(o("Initializing playback bridge..."),await oJ(),!u)||(o("Initializing render bridge..."),await jK(),!u))return;o("Initializing effects bridge...");const f=U.getState(),{width:g,height:y}=f.project.settings;try{await IX(g,y)}catch(x){console.error("[EditorInterface] EffectsBridge initialization failed:",x)}if(!u)return;o("Initializing transition bridge...");try{MK(g,y)}catch(x){console.error("[EditorInterface] TransitionBridge initialization failed:",x)}if(!u)return;n(!0)}catch(p){console.error("Failed to initialize engines/bridges:",p),u&&(d(p instanceof Error?p.message:"Unknown error"),o(`Error: ${p instanceof Error?p.message:"Unknown error"}`))}})(),()=>{u=!1,cJ(),GX(),_K(),DX(),PK()}},[r,e,t]),{initialized:e&&i,initializing:t||!i&&e,initError:s||l,initStatus:a}},Oy=()=>{const{initialized:r,initializing:e,initError:t,initStatus:s}=AZ(),{showShortcutsOverlay:i,setShowShortcutsOverlay:n}=SZ();TZ();const{keyframeEditorOpen:a,setKeyframeEditorOpen:o,selectedItems:l}=ft(),{project:d,updateClipKeyframes:u}=U(),h=d.timeline.tracks,[p,m]=He.useState([]),[f,g]=He.useState([]),y=He.useMemo(()=>{const _=l.filter(E=>E.type==="clip"||E.type==="text-clip"||E.type==="shape-clip").map(E=>E.id);if(_.length===0)return null;const M=_[0];for(const E of h){const D=E.clips.find(R=>R.id===M);if(D)return D}return null},[l,h]),x=He.useCallback((_,M)=>{if(!y?.keyframes)return;const E=y.keyframes.map(D=>D.id===_?{...D,...M}:D);u(y.id,E)},[y,u]),v=He.useCallback(_=>{if(!y?.keyframes)return;const M=y.keyframes.filter(E=>E.id!==_);u(y.id,M),m(E=>E.filter(D=>D!==_))},[y,u]),b=He.useCallback(_=>{if(!y?.keyframes)return;const M=y.keyframes.filter(E=>_.includes(E.id));g(M)},[y]),S=He.useCallback((_,M)=>{const E=h.flatMap(R=>R.clips).find(R=>R.id===_);if(!E)return;const D=f.map(R=>({...R,id:`kf-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,time:R.time+M}));u(_,[...E.keyframes||[],...D])},[f,h,u]),k=He.useCallback((_,M)=>{m(M?E=>E.includes(_)?E.filter(D=>D!==_):[...E,_]:[_])},[]),[C,A]=w.useState(320),T=w.useRef(!1),j=w.useCallback(_=>{_.preventDefault(),T.current=!0,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},[]);return w.useEffect(()=>{const _=E=>{if(!T.current)return;const D=window.innerHeight-E.clientY,R=window.innerHeight*.6;A(Math.max(200,Math.min(D,R)))},M=()=>{T.current=!1,document.body.style.cursor="",document.body.style.userSelect=""};return window.addEventListener("mousemove",_),window.addEventListener("mouseup",M),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",M)}},[]),e||!r?c.jsx("div",{className:"w-full h-full bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),c.jsx("p",{className:"text-text-secondary text-sm",children:"Initializing editor..."}),c.jsx("p",{className:"text-text-muted text-xs mt-2",children:s}),t&&c.jsx("p",{className:"text-red-500 text-xs mt-2",children:t})]})}):c.jsxs("div",{className:"w-full h-full bg-background flex flex-col overflow-hidden font-sans select-none relative z-20 text-xs text-text-secondary",children:[c.jsx(fK,{}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx(Ul,{name:"Assets Panel",children:c.jsx(TK,{})}),c.jsx(Ul,{name:"Preview",children:c.jsx(tQ,{})}),c.jsx(Ul,{name:"Inspector",children:c.jsx(tZ,{})}),a&&c.jsx(Ul,{name:"Keyframe Editor",children:c.jsx(xZ,{clip:y,onClose:()=>o(!1),onUpdateKeyframe:x,onDeleteKeyframe:v,onCopyKeyframes:b,onPasteKeyframes:S,selectedKeyframeIds:p,onSelectKeyframe:k,copiedKeyframes:f})})]}),c.jsx("div",{className:"h-1 bg-border hover:bg-primary/50 cursor-row-resize transition-colors z-10 relative group",onMouseDown:j,children:c.jsx("div",{className:"absolute inset-x-0 -top-1 -bottom-1 bg-transparent"})}),c.jsx("div",{style:{height:C},className:"shrink-0 flex flex-col",children:c.jsx(Ul,{name:"Timeline",children:c.jsx(gZ,{})})}),c.jsx(kZ,{isOpen:i,onClose:()=>n(!1)}),c.jsx(lK,{}),c.jsx(mK,{})]})},jZ=Object.freeze(Object.defineProperty({__proto__:null,EditorInterface:Oy,default:Oy},Symbol.toStringTag,{value:"Module"})),_Z={"1080x1920":"tiktok","1920x1080":"youtube-video","1080x1080":"instagram-post","720x1280":"instagram-stories","1280x720":"youtube-video"};function EZ(){const{activeModal:r,closeModal:e,skipWelcomeScreen:t}=ft(),{openModal:s}=ft(),i=U(k=>k.createNewProject),{showDialog:n,availableSaves:a,recover:o,dismiss:l,clearAll:d}=R7(),{route:u,params:h,navigate:p,parsedDimensions:m,fps:f}=Hb(),g=w.useRef(!1),y=typeof window<"u"&&new URLSearchParams(window.location.search).get("embedded")==="true";D7({enabled:y}),w.useEffect(()=>{if(!g.current)if(u==="new"){g.current=!0;let k="New Project",C=1920,A=1080,T=f;if(h.preset){const j=h.preset,_=kp[j];_&&(C=_.width,A=_.height,T=_.frameRate||f,k=`New ${j.charAt(0).toUpperCase()+j.slice(1).replace(/-/g," ")} Project`)}else if(m){C=m.width,A=m.height;const j=`${C}x${A}`,_=_Z[j];_&&(T=kp[_].frameRate||f);const M=C/A;M<1?k="New Vertical Video":M>1?k="New Horizontal Video":k="New Square Video"}i(k,{width:C,height:A,frameRate:T}),p("editor")}else(u==="editor"&&t||["welcome","templates","recent"].includes(u))&&(g.current=!0)},[u,h,m,f,i,p,t]);const x=w.useCallback(k=>{k.key==="Escape"&&u!=="editor"&&p("editor"),(k.metaKey||k.ctrlKey)&&k.key==="k"&&(k.preventDefault(),s("search"))},[u,p,s]);w.useEffect(()=>(window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)),[x]);const v=["welcome","templates","recent"].includes(u)&&!t&&!y,b=u==="templates"?"templates":u==="recent"?"recent":void 0,S=u==="share"&&h.shareId;return c.jsx(GG,{children:c.jsxs("div",{className:"h-screen w-screen bg-background text-text-primary overflow-hidden",children:[!y&&c.jsx(l7,{}),S?c.jsx(N7,{shareId:h.shareId}):v?c.jsx(A7,{initialTab:b}):c.jsx(Oy,{}),c.jsx(G$,{}),c.jsx(i7,{isOpen:r==="scriptView",onClose:e}),c.jsx(c7,{isOpen:r==="search",onClose:e}),n&&a.length>0&&c.jsx(j7,{saves:a,onRecover:async k=>{await o(k)&&p("editor")},onDismiss:l,onClearAll:d})]})})}class MZ{registration=null;listeners=new Map;isOnline=typeof navigator<"u"?navigator.onLine:!0;constructor(){typeof window<"u"&&(window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline))}isSupported(){return typeof navigator<"u"&&"serviceWorker"in navigator}async register(){if(!this.isSupported())return console.warn("[SW Manager] Service workers not supported"),null;try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return this.registration=e,e.addEventListener("updatefound",()=>{this.handleUpdateFound(e)}),setInterval(()=>{this.checkForUpdates()},60*60*1e3),this.emit("registered",{registration:e}),e}catch(e){return console.error("[SW Manager] Registration failed:",e),this.emit("error",{error:e}),null}}async unregister(){if(!this.registration)return!1;try{const e=await this.registration.unregister();return e&&(this.registration=null),e}catch(e){return console.error("[SW Manager] Unregistration failed:",e),!1}}async checkForUpdates(){if(this.registration)try{await this.registration.update()}catch(e){console.error("[SW Manager] Update check failed:",e)}}async skipWaiting(){this.registration?.waiting&&this.sendMessage({type:"SKIP_WAITING"})}getStatus(){return{supported:this.isSupported(),registered:!!this.registration,active:!!this.registration?.active,waiting:!!this.registration?.waiting,updateAvailable:!!this.registration?.waiting}}async getCacheStatus(){return this.sendMessageWithResponse({type:"GET_CACHE_STATUS"})}async clearCache(){await this.sendMessageWithResponse({type:"CLEAR_CACHE"})}getOnlineStatus(){return this.isOnline}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}sendMessage(e){this.registration?.active&&this.registration.active.postMessage(e)}sendMessageWithResponse(e){return new Promise(t=>{if(!this.registration?.active){t(null);return}const s=new MessageChannel;s.port1.onmessage=i=>{t(i.data?.payload||null)},this.registration.active.postMessage(e,[s.port2]),setTimeout(()=>t(null),5e3)})}handleUpdateFound(e){const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&this.emit("updated",{registration:e})})}handleOnline=()=>{this.isOnline=!0,this.emit("online")};handleOffline=()=>{this.isOnline=!1,this.emit("offline")};emit(e,t){this.listeners.get(e)?.forEach(s=>{try{s(t)}catch(i){console.error("[SW Manager] Event callback error:",i)}})}destroy(){typeof window<"u"&&(window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)),this.listeners.clear()}}const PZ=new MZ;async function NZ(){return typeof window<"u"&&new URLSearchParams(window.location.search).get("embedded")==="true"?null:PZ.register()}NZ().then(r=>{});const RZ=document.getElementById("root");FN.createRoot(RZ).render(c.jsx(He.StrictMode,{children:c.jsx(EZ,{})}));export{fW as $,qG as A,p9 as B,m9 as C,Ms as D,NX as E,a9 as F,f9 as G,x9 as H,KG as I,Fh as J,b9 as K,v9 as L,r9 as M,s9 as N,w9 as O,e9 as P,lW as Q,vM as R,kp as S,Su as T,U9 as U,Un as V,y9 as W,J0 as X,Z0 as Y,ey as Z,mW as _,_c as a,Bh as a$,wM as a0,Cu as a1,gW as a2,yW as a3,xW as a4,bW as a5,vW as a6,wW as a7,G9 as a8,W9 as a9,DW as aA,_W as aB,EW as aC,MW as aD,PW as aE,yC as aF,xC as aG,NW as aH,FW as aI,BW as aJ,LW as aK,kb as aL,OW as aM,$W as aN,SM as aO,eh as aP,VW as aQ,qW as aR,WW as aS,YW as aT,iY as aU,rY as aV,AM as aW,nY as aX,aY,oY as aZ,CM as a_,Y9 as aa,yc as ab,bM as ac,yi as ad,kW as ae,Dl as af,kM as ag,CW as ah,SW as ai,qc as aj,_9 as ak,ia as al,E9 as am,J9 as an,Z9 as ao,X9 as ap,K9 as aq,Q9 as ar,pC as as,eW as at,tW as au,sW as av,iW as aw,TW as ax,jW as ay,IW as az,sg as b,bX as b$,zW as b0,k9 as b1,C9 as b2,A9 as b3,bo as b4,T9 as b5,Sp as b6,Cb as b7,Of as b8,bC as b9,qY as bA,HY as bB,XY as bC,Uf as bD,JY as bE,eq as bF,Bl as bG,sh as bH,tq as bI,Li as bJ,S9 as bK,iX as bL,rX as bM,ZC as bN,sX as bO,OP as bP,ky as bQ,Qi as bR,oW as bS,eu as bT,$P as bU,oX as bV,cX as bW,gX as bX,Sy as bY,i2 as bZ,xX as b_,vC as ba,cY as bb,lY as bc,dY as bd,Sb as be,mY as bf,fY as bg,gY as bh,CY as bi,kC as bj,CC as bk,$f as bl,OY as bm,$Y as bn,zY as bo,SC as bp,wf as bq,Tp as br,j9 as bs,Sr as bt,VY as bu,UY as bv,gee as bw,GY as bx,WY as by,YY as bz,o2 as c,zP as c0,kX as c1,CX as c2,ag as d,uM as e,ff as f,ld as g,YG as h,qu as i,id as j,QG as k,JG as l,it as m,hM as n,ZG as o,Il as p,t9 as q,pM as r,WG as s,mM as t,fM as u,gM as v,aC as w,yM as x,oC as y,Dh as z};
