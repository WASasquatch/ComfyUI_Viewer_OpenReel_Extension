const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index2.js","assets/webgpu-renderer-impl.js","assets/canvas2d-fallback-renderer.js","assets/react.js","assets/zustand.js","assets/radix.js","assets/three.js"])))=>i.map(i=>d[i]);
import{r as v,b as Ye,j as c,_ as _i,S as aS,e as NN,v as RN,f as IN}from"./react.js";import{c as wa,s as Up,p as oS}from"./zustand.js";import{S as DN,C as cS,a as FN,R as BN,b as LN,c as ON,d as lS,e as dS,P as $N,f as uS,I as hS,g as pS,h as fS,i as mS,L as gS,j as yS,k as zN,T as VN,l as UN,O as xS,m as GN,n as bS,o as WN,p as vS,D as wS,q as YN,r as kS,s as CS,t as qN,u as SS,v as TS,w as AS,x as jS,y as _S,z as ES,A as MS,B as HN,E as XN,F as PS,G as KN,H as NS,J as QN,K as JN,M as RS,N as ZN,Q as IS,U as eR,V as DS,W as FS,X as tR,Y as BS,Z as sR,_ as LS,$ as OS,a0 as iR,a1 as rR,a2 as $S,a3 as nR,a4 as aR,a5 as oR,a6 as zS,a7 as cR,a8 as lR,a9 as VS,aa as dR,ab as US,ac as uR,ad as hR,ae as pR,af as GS,ag as fR,ah as mR,ai as WS,aj as YS,ak as qS,al as HS,am as XS,an as KS,ao as QS,ap as gR,aq as yR,ar as xR}from"./radix.js";import{W as JS,S as ZS,O as eT,C as Pu,N as gr,a as mv,M as _g,A as wc,b as vl,D as wl,P as kl,c as Vo,V as bR,d as vR,B as wR,e as Nu,f as kR,g as CR}from"./three.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var q=typeof window<"u"?window:void 0,Ls=typeof globalThis<"u"?globalThis:q;typeof self>"u"&&(Ls.self=Ls),typeof File>"u"&&(Ls.File=function(){});var tT=Array.prototype,gv=tT.forEach,yv=tT.indexOf,Fi=Ls?.navigator,Ae=Ls?.document,yi=Ls?.location,Eg=Ls?.fetch,Mg=Ls!=null&&Ls.XMLHttpRequest&&"withCredentials"in new Ls.XMLHttpRequest?Ls.XMLHttpRequest:void 0,xv=Ls?.AbortController,gi=Fi?.userAgent,We=q??{},nn={DEBUG:!1,LIB_VERSION:"1.335.2"};function bv(r,e,t,s,i,n,a){try{var o=r[n](a),l=o.value}catch(d){return void t(d)}o.done?e(l):Promise.resolve(l).then(s,i)}function ic(r){return function(){var e=this,t=arguments;return new Promise(function(s,i){var n=r.apply(e,t);function a(l){bv(n,s,i,a,o,"next",l)}function o(l){bv(n,s,i,a,o,"throw",l)}a(void 0)})}}function Re(){return Re=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(r[s]=t[s])}return r},Re.apply(null,arguments)}function sT(r,e){if(r==null)return{};var t={};for(var s in r)if({}.hasOwnProperty.call(r,s)){if(e.indexOf(s)!==-1)continue;t[s]=r[s]}return t}var SR=["amazonbot","amazonproductbot","app.hypefactors.com","applebot","archive.org_bot","awariobot","backlinksextendedbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","dataforseobot","deepscan","duckduckbot","facebookexternal","facebookcatalog","http://yandex.com/bots","hubspot","ia_archiver","leikibot","linkedinbot","meta-externalagent","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","sebot-wa","sitebulb","slackbot","slurp","trendictionbot","turnitin","twitterbot","vercel-screenshot","vercelbot","yahoo! slurp","yandexbot","zoombot","bot.htm","bot.php","(bot;","bot/","crawler","ahrefsbot","ahrefssiteaudit","semrushbot","siteauditbot","splitsignalbot","gptbot","oai-searchbot","chatgpt-user","perplexitybot","better uptime bot","sentryuptimebot","uptimerobot","headlesschrome","cypress","google-hoteladsverifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleother","google-cloudvertexbot","googleweblight","mediapartners-google","storebot-google","google-inspectiontool","bytespider"],vv=function(r,e){if(e===void 0&&(e=[]),!r)return!1;var t=r.toLowerCase();return SR.concat(e).some(s=>{var i=s.toLowerCase();return t.indexOf(i)!==-1})},TR=["$snapshot","$pageview","$pageleave","$set","survey dismissed","survey sent","survey shown","$identify","$groupidentify","$create_alias","$$client_ingestion_warning","$web_experiment_applied","$feature_enrollment_update","$feature_flag_called"];function at(r,e){return r.indexOf(e)!==-1}var Gp=function(r){return r.trim()},Pg=function(r){return r.replace(/^\$/,"")},AR=Array.isArray,iT=Object.prototype,rT=iT.hasOwnProperty,Wp=iT.toString,xt=AR||function(r){return Wp.call(r)==="[object Array]"},sa=r=>typeof r=="function",ks=r=>r===Object(r)&&!xt(r),rc=r=>{if(ks(r)){for(var e in r)if(rT.call(r,e))return!1;return!0}return!1},Se=r=>r===void 0,Cs=r=>Wp.call(r)=="[object String]",Ng=r=>Cs(r)&&r.trim().length===0,kr=r=>r===null,gt=r=>Se(r)||kr(r),yn=r=>Wp.call(r)=="[object Number]"&&r==r,ec=r=>yn(r)&&r>0,mn=r=>Wp.call(r)==="[object Boolean]",jR=r=>r instanceof FormData,_R=r=>at(TR,r);function Rg(r){return r===null||typeof r!="object"}function Hh(r,e){return Object.prototype.toString.call(r)==="[object "+e+"]"}function nT(r){return!Se(Event)&&function(e,t){try{return e instanceof t}catch{return!1}}(r,Event)}var ER=[!0,"true",1,"1","yes"],wf=r=>at(ER,r),MR=[!1,"false",0,"0","no"];function Fr(r,e,t,s,i){return e>t&&(s.warn("min cannot be greater than max."),e=t),yn(r)?r>t?(s.warn(" cannot be  greater than max: "+t+". Using max value instead."),t):r<e?(s.warn(" cannot be less than min: "+e+". Using min value instead."),e):r:(s.warn(" must be a number. using max or fallback. max: "+t+", fallback: "+i),Fr(i||t,e,t,s))}class PR{constructor(e){this.t={},this.i=e.i,this.o=Fr(e.bucketSize,0,100,e.h),this.m=Fr(e.refillRate,0,this.o,e.h),this.$=Fr(e.refillInterval,0,864e5,e.h)}S(e,t){var s=t-e.lastAccess,i=Math.floor(s/this.$);if(i>0){var n=i*this.m;e.tokens=Math.min(e.tokens+n,this.o),e.lastAccess=e.lastAccess+i*this.$}}consumeRateLimit(e){var t,s=Date.now(),i=String(e),n=this.t[i];return n?this.S(n,s):(n={tokens:this.o,lastAccess:s},this.t[i]=n),n.tokens===0||(n.tokens--,n.tokens===0&&((t=this.i)==null||t.call(this,e)),n.tokens===0)}stop(){this.t={}}}var ar="Mobile",Xh="iOS",pn="Android",Pd="Tablet",aT=pn+" "+Pd,oT="iPad",cT="Apple",lT=cT+" Watch",Nd="Safari",Fc="BlackBerry",dT="Samsung",uT=dT+"Browser",hT=dT+" Internet",Co="Chrome",NR=Co+" OS",pT=Co+" "+Xh,Gy="Internet Explorer",fT=Gy+" "+ar,Wy="Opera",RR=Wy+" Mini",Yy="Edge",mT="Microsoft "+Yy,kc="Firefox",gT=kc+" "+Xh,Rd="Nintendo",Id="PlayStation",Cc="Xbox",yT=pn+" "+ar,xT=ar+" "+Nd,Wl="Windows",Ig=Wl+" Phone",wv="Nokia",Dg="Ouya",bT="Generic",IR=bT+" "+ar.toLowerCase(),vT=bT+" "+Pd.toLowerCase(),Fg="Konqueror",ri="(\\d+(\\.\\d+)?)",kf=new RegExp("Version/"+ri),DR=new RegExp(Cc,"i"),FR=new RegExp(Id+" \\w+","i"),BR=new RegExp(Rd+" \\w+","i"),qy=new RegExp(Fc+"|PlayBook|BB10","i"),LR={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},Ru,kv,Cf,OR=(r,e)=>e&&at(e,cT)||function(t){return at(t,Nd)&&!at(t,Co)&&!at(t,pn)}(r),wT=function(r,e){return e=e||"",at(r," OPR/")&&at(r,"Mini")?RR:at(r," OPR/")?Wy:qy.test(r)?Fc:at(r,"IE"+ar)||at(r,"WPDesktop")?fT:at(r,uT)?hT:at(r,Yy)||at(r,"Edg/")?mT:at(r,"FBIOS")?"Facebook "+ar:at(r,"UCWEB")||at(r,"UCBrowser")?"UC Browser":at(r,"CriOS")?pT:at(r,"CrMo")||at(r,Co)?Co:at(r,pn)&&at(r,Nd)?yT:at(r,"FxiOS")?gT:at(r.toLowerCase(),Fg.toLowerCase())?Fg:OR(r,e)?at(r,ar)?xT:Nd:at(r,kc)?kc:at(r,"MSIE")||at(r,"Trident/")?Gy:at(r,"Gecko")?kc:""},$R={[fT]:[new RegExp("rv:"+ri)],[mT]:[new RegExp(Yy+"?\\/"+ri)],[Co]:[new RegExp("("+Co+"|CrMo)\\/"+ri)],[pT]:[new RegExp("CriOS\\/"+ri)],"UC Browser":[new RegExp("(UCBrowser|UCWEB)\\/"+ri)],[Nd]:[kf],[xT]:[kf],[Wy]:[new RegExp("(Opera|OPR)\\/"+ri)],[kc]:[new RegExp(kc+"\\/"+ri)],[gT]:[new RegExp("FxiOS\\/"+ri)],[Fg]:[new RegExp("Konqueror[:/]?"+ri,"i")],[Fc]:[new RegExp(Fc+" "+ri),kf],[yT]:[new RegExp("android\\s"+ri,"i")],[hT]:[new RegExp(uT+"\\/"+ri)],[Gy]:[new RegExp("(rv:|MSIE )"+ri)],Mozilla:[new RegExp("rv:"+ri)]},zR=function(r,e){var t=wT(r,e),s=$R[t];if(Se(s))return null;for(var i=0;i<s.length;i++){var n=s[i],a=r.match(n);if(a)return parseFloat(a[a.length-2])}return null},Cv=[[new RegExp(Cc+"; "+Cc+" (.*?)[);]","i"),r=>[Cc,r&&r[1]||""]],[new RegExp(Rd,"i"),[Rd,""]],[new RegExp(Id,"i"),[Id,""]],[qy,[Fc,""]],[new RegExp(Wl,"i"),(r,e)=>{if(/Phone/.test(e)||/WPDesktop/.test(e))return[Ig,""];if(new RegExp(ar).test(e)&&!/IEMobile\b/.test(e))return[Wl+" "+ar,""];var t=/Windows NT ([0-9.]+)/i.exec(e);if(t&&t[1]){var s=t[1],i=LR[s]||"";return/arm/i.test(e)&&(i="RT"),[Wl,i]}return[Wl,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,r=>{if(r&&r[3]){var e=[r[3],r[4],r[5]||"0"];return[Xh,e.join(".")]}return[Xh,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,r=>{var e="";return r&&r.length>=3&&(e=Se(r[2])?r[3]:r[2]),["watchOS",e]}],[new RegExp("("+pn+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+pn+")","i"),r=>{if(r&&r[2]){var e=[r[2],r[3],r[4]||"0"];return[pn,e.join(".")]}return[pn,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,r=>{var e=["Mac OS X",""];if(r&&r[1]){var t=[r[1],r[2],r[3]||"0"];e[1]=t.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[NR,""]],[/Linux|debian/i,["Linux",""]]],Sv=function(r){return BR.test(r)?Rd:FR.test(r)?Id:DR.test(r)?Cc:new RegExp(Dg,"i").test(r)?Dg:new RegExp("("+Ig+"|WPDesktop)","i").test(r)?Ig:/iPad/.test(r)?oT:/iPod/.test(r)?"iPod Touch":/iPhone/.test(r)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(r)?lT:qy.test(r)?Fc:/(kobo)\s(ereader|touch)/i.test(r)?"Kobo":new RegExp(wv,"i").test(r)?wv:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(r)||/(kf[a-z]+)( bui|\)).+silk\//i.test(r)?"Kindle Fire":/(Android|ZTE)/i.test(r)?new RegExp(ar).test(r)&&!/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(r)||/pixel[\daxl ]{1,6}/i.test(r)&&!/pixel c/i.test(r)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(r)||/lmy47v/i.test(r)&&!/QTAQZ3/i.test(r)?pn:aT:new RegExp("(pda|"+ar+")","i").test(r)?IR:new RegExp(Pd,"i").test(r)&&!new RegExp(Pd+" pc","i").test(r)?vT:""},VR=r=>r instanceof Error;function UR(r){var e=globalThis._posthogChunkIds;if(e){var t=Object.keys(e);return Cf&&t.length===kv||(kv=t.length,Cf=t.reduce((s,i)=>{Ru||(Ru={});var n=Ru[i];if(n)s[n[0]]=n[1];else for(var a=r(i),o=a.length-1;o>=0;o--){var l=a[o],d=l?.filename,u=e[i];if(d&&u){s[d]=u,Ru[i]=[d,u];break}}return s},{})),Cf}}class GR{constructor(e,t,s){s===void 0&&(s=[]),this.coercers=e,this.stackParser=t,this.modifiers=s}buildFromUnknown(e,t){t===void 0&&(t={});var s=t&&t.mechanism||{handled:!0,type:"generic"},i=this.buildCoercingContext(s,t,0).apply(e),n=this.buildParsingContext(),a=this.parseStacktrace(i,n);return{$exception_list:this.convertToExceptionList(a,s),$exception_level:"error"}}modifyFrames(e){var t=this;return ic(function*(){for(var s of e)s.stacktrace&&s.stacktrace.frames&&xt(s.stacktrace.frames)&&(s.stacktrace.frames=yield t.applyModifiers(s.stacktrace.frames));return e})()}coerceFallback(e){var t;return{type:"Error",value:"Unknown error",stack:(t=e.syntheticException)==null?void 0:t.stack,synthetic:!0}}parseStacktrace(e,t){var s,i;return e.cause!=null&&(s=this.parseStacktrace(e.cause,t)),e.stack!=""&&e.stack!=null&&(i=this.applyChunkIds(this.stackParser(e.stack,e.synthetic?1:0),t.chunkIdMap)),Re({},e,{cause:s,stack:i})}applyChunkIds(e,t){return e.map(s=>(s.filename&&t&&(s.chunk_id=t[s.filename]),s))}applyCoercers(e,t){for(var s of this.coercers)if(s.match(e))return s.coerce(e,t);return this.coerceFallback(t)}applyModifiers(e){var t=this;return ic(function*(){var s=e;for(var i of t.modifiers)s=yield i(s);return s})()}convertToExceptionList(e,t){var s,i,n,a={type:e.type,value:e.value,mechanism:{type:(s=t.type)!==null&&s!==void 0?s:"generic",handled:(i=t.handled)===null||i===void 0||i,synthetic:(n=e.synthetic)!==null&&n!==void 0&&n}};e.stack&&(a.stacktrace={type:"raw",frames:e.stack});var o=[a];return e.cause!=null&&o.push(...this.convertToExceptionList(e.cause,Re({},t,{handled:!0}))),o}buildParsingContext(){return{chunkIdMap:UR(this.stackParser)}}buildCoercingContext(e,t,s){s===void 0&&(s=0);var i=(n,a)=>{if(a<=4){var o=this.buildCoercingContext(e,t,a);return this.applyCoercers(n,o)}};return Re({},t,{syntheticException:s==0?t.syntheticException:void 0,mechanism:e,apply:n=>i(n,s),next:n=>i(n,s+1)})}}var Bc="?";function Bg(r,e,t,s,i){var n={platform:r,filename:e,function:t==="<anonymous>"?Bc:t,in_app:!0};return Se(s)||(n.lineno=s),Se(i)||(n.colno=i),n}var kT=(r,e)=>{var t=r.indexOf("safari-extension")!==-1,s=r.indexOf("safari-web-extension")!==-1;return t||s?[r.indexOf("@")!==-1?r.split("@")[0]:Bc,t?"safari-extension:"+e:"safari-web-extension:"+e]:[r,e]},WR=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,YR=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,qR=/\((\S*)(?::(\d+))(?::(\d+))\)/,HR=(r,e)=>{var t=WR.exec(r);if(t){var[,s,i,n]=t;return Bg(e,s,Bc,+i,+n)}var a=YR.exec(r);if(a){if(a[2]&&a[2].indexOf("eval")===0){var o=qR.exec(a[2]);o&&(a[2]=o[1],a[3]=o[2],a[4]=o[3])}var[l,d]=kT(a[1]||Bc,a[2]);return Bg(e,d,l,a[3]?+a[3]:void 0,a[4]?+a[4]:void 0)}},XR=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,KR=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,QR=(r,e)=>{var t=XR.exec(r);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){var s=KR.exec(t[3]);s&&(t[1]=t[1]||"eval",t[3]=s[1],t[4]=s[2],t[5]="")}var i=t[3],n=t[1]||Bc;return[n,i]=kT(n,i),Bg(e,i,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}},Tv=/\(error: (.*)\)/,Av=50;function JR(){return function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return function(i,n){n===void 0&&(n=0);for(var a=[],o=i.split(`
`),l=n;l<o.length;l++){var d=o[l];if(!(d.length>1024)){var u=Tv.test(d)?d.replace(Tv,"$1"):d;if(!u.match(/\S*Error: /)){for(var h of t){var p=h(u,r);if(p){a.push(p);break}}if(a.length>=Av)break}}}return function(f){if(!f.length)return[];var m=Array.from(f);return m.reverse(),m.slice(0,Av).map(g=>{return Re({},g,{filename:g.filename||(y=m,y[y.length-1]||{}).filename,function:g.function||Bc});var y})}(a)}}("web:javascript",HR,QR)}class ZR{match(e){return this.isDOMException(e)||this.isDOMError(e)}coerce(e,t){var s=Cs(e.stack);return{type:this.getType(e),value:this.getValue(e),stack:s?e.stack:void 0,cause:e.cause?t.next(e.cause):void 0,synthetic:!1}}getType(e){return this.isDOMError(e)?"DOMError":"DOMException"}getValue(e){var t=e.name||(this.isDOMError(e)?"DOMError":"DOMException");return e.message?t+": "+e.message:t}isDOMException(e){return Hh(e,"DOMException")}isDOMError(e){return Hh(e,"DOMError")}}class eI{match(e){return(t=>t instanceof Error)(e)}coerce(e,t){return{type:this.getType(e),value:this.getMessage(e,t),stack:this.getStack(e),cause:e.cause?t.next(e.cause):void 0,synthetic:!1}}getType(e){return e.name||e.constructor.name}getMessage(e,t){var s=e.message;return s.error&&typeof s.error.message=="string"?String(s.error.message):String(s)}getStack(e){return e.stacktrace||e.stack||void 0}}class tI{constructor(){}match(e){return Hh(e,"ErrorEvent")&&e.error!=null}coerce(e,t){var s,i=t.apply(e.error);return i||{type:"ErrorEvent",value:e.message,stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}}var sI=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;class iI{match(e){return typeof e=="string"}coerce(e,t){var s,[i,n]=this.getInfos(e);return{type:i??"Error",value:n??e,stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}getInfos(e){var t="Error",s=e,i=e.match(sI);return i&&(t=i[1],s=i[2]),[t,s]}}var rI=["fatal","error","warning","log","info","debug"];function CT(r,e){e===void 0&&(e=40);var t=Object.keys(r);if(t.sort(),!t.length)return"[object has no keys]";for(var s=t.length;s>0;s--){var i=t.slice(0,s).join(", ");if(!(i.length>e))return s===t.length||i.length<=e?i:i.slice(0,e)+"..."}return""}class nI{match(e){return typeof e=="object"&&e!==null}coerce(e,t){var s,i=this.getErrorPropertyFromObject(e);return i?t.apply(i):{type:this.getType(e),value:this.getValue(e),stack:(s=t.syntheticException)==null?void 0:s.stack,level:this.isSeverityLevel(e.level)?e.level:"error",synthetic:!0}}getType(e){return nT(e)?e.constructor.name:"Error"}getValue(e){if("name"in e&&typeof e.name=="string"){var t="'"+e.name+"' captured as exception";return"message"in e&&typeof e.message=="string"&&(t+=" with message: '"+e.message+"'"),t}if("message"in e&&typeof e.message=="string")return e.message;var s=this.getObjectClassName(e);return(s&&s!=="Object"?"'"+s+"'":"Object")+" captured as exception with keys: "+CT(e)}isSeverityLevel(e){return Cs(e)&&!Ng(e)&&rI.indexOf(e)>=0}getErrorPropertyFromObject(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var s=e[t];if(VR(s))return s}}getObjectClassName(e){try{var t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch{return}}}class aI{match(e){return nT(e)}coerce(e,t){var s,i=e.constructor.name;return{type:i,value:i+" captured as exception with keys: "+CT(e),stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}}class oI{match(e){return Rg(e)}coerce(e,t){var s;return{type:"Error",value:"Primitive value captured as exception: "+String(e),stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}}}class cI{match(e){return Hh(e,"PromiseRejectionEvent")}coerce(e,t){var s,i=this.getUnhandledRejectionReason(e);return Rg(i)?{type:"UnhandledRejection",value:"Non-Error promise rejection captured with value: "+String(i),stack:(s=t.syntheticException)==null?void 0:s.stack,synthetic:!0}:t.apply(i)}getUnhandledRejectionReason(e){if(Rg(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch{}return e}}var ST=function(r,e){var{debugEnabled:t}=e===void 0?{}:e,s={k:function(i){if(q&&(nn.DEBUG||We.POSTHOG_DEBUG||t)&&!Se(q.console)&&q.console){for(var n=("__rrweb_original__"in q.console[i])?q.console[i].__rrweb_original__:q.console[i],a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];n(r,...o)}},info:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];s.k("log",...n)},warn:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];s.k("warn",...n)},error:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];s.k("error",...n)},critical:function(){for(var i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];console.error(r,...n)},uninitializedWarning:i=>{s.error("You must initialize PostHog before calling "+i)},createLogger:(i,n)=>ST(r+" "+i,n)};return s},_e=ST("[PostHog.js]"),rs=_e.createLogger,lI=rs("[ExternalScriptsLoader]"),jv=(r,e,t)=>{if(r.config.disable_external_dependency_loading)return lI.warn(e+" was requested but loading of external scripts is disabled."),t("Loading of external scripts is disabled");var s=Ae?.querySelectorAll("script");if(s){for(var i,n=function(){if(s[a].src===e){var l=s[a];return l.__posthog_loading_callback_fired?{v:t()}:(l.addEventListener("load",d=>{l.__posthog_loading_callback_fired=!0,t(void 0,d)}),l.onerror=d=>t(d),{v:void 0})}},a=0;a<s.length;a++)if(i=n())return i.v}var o=()=>{if(!Ae)return t("document not found");var l=Ae.createElement("script");if(l.type="text/javascript",l.crossOrigin="anonymous",l.src=e,l.onload=h=>{l.__posthog_loading_callback_fired=!0,t(void 0,h)},l.onerror=h=>t(h),r.config.prepare_external_dependency_script&&(l=r.config.prepare_external_dependency_script(l)),!l)return t("prepare_external_dependency_script returned null");if(r.config.external_scripts_inject_target==="head")Ae.head.appendChild(l);else{var d,u=Ae.querySelectorAll("body > script");u.length>0?(d=u[0].parentNode)==null||d.insertBefore(l,u[0]):Ae.body.appendChild(l)}};Ae!=null&&Ae.body?o():Ae?.addEventListener("DOMContentLoaded",o)};We.__PosthogExtensions__=We.__PosthogExtensions__||{},We.__PosthogExtensions__.loadExternalDependency=(r,e,t)=>{var s="/static/"+e+".js?v="+r.version;if(e==="remote-config"&&(s="/array/"+r.config.token+"/config.js"),e==="toolbar"){var i=3e5;s=s+"&t="+Math.floor(Date.now()/i)*i}var n=r.requestRouter.endpointFor("assets",s);jv(r,n,t)},We.__PosthogExtensions__.loadSiteApp=(r,e,t)=>{var s=r.requestRouter.endpointFor("api",e);jv(r,s,t)};var Kh={};function ia(r,e,t){if(xt(r)){if(gv&&r.forEach===gv)r.forEach(e,t);else if("length"in r&&r.length===+r.length){for(var s=0,i=r.length;s<i;s++)if(s in r&&e.call(t,r[s],s)===Kh)return}}}function Nt(r,e,t){if(!gt(r)){if(xt(r))return ia(r,e,t);if(jR(r)){for(var s of r.entries())if(e.call(t,s[1],s[0])===Kh)return}else for(var i in r)if(rT.call(r,i)&&e.call(t,r[i],i)===Kh)return}}var cs=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return ia(t,function(i){for(var n in i)i[n]!==void 0&&(r[n]=i[n])}),r},Jc=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];return ia(t,function(i){ia(i,function(n){r.push(n)})}),r};function Th(r){for(var e=Object.keys(r),t=e.length,s=new Array(t);t--;)s[t]=[e[t],r[e[t]]];return s}var _v=function(r){try{return r()}catch{return}},dI=function(r){return function(){try{for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return r.apply(this,t)}catch(i){_e.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),_e.critical(i)}}},Hy=function(r){var e={};return Nt(r,function(t,s){(Cs(t)&&t.length>0||yn(t))&&(e[s]=t)}),e};function uI(r,e){return t=r,s=n=>Cs(n)&&!kr(e)?n.slice(0,e):n,i=new Set,function n(a,o){return a!==Object(a)?s?s(a,o):a:i.has(a)?void 0:(i.add(a),xt(a)?(l=[],ia(a,d=>{l.push(n(d))})):(l={},Nt(a,(d,u)=>{i.has(d)||(l[u]=n(d,u))})),l);var l}(t);var t,s,i}var hI=["herokuapp.com","vercel.app","netlify.app"];function pI(r){var e=r?.hostname;if(!Cs(e))return!1;var t=e.split(".").slice(-2).join(".");for(var s of hI)if(t===s)return!1;return!0}function TT(r,e){for(var t=0;t<r.length;t++)if(e(r[t]))return r[t]}function ys(r,e,t,s){var{capture:i=!1,passive:n=!0}=s??{};r?.addEventListener(e,t,{capture:i,passive:n})}var AT="$people_distinct_id",Yl="__alias",ql="__timers",Ev="$autocapture_disabled_server_side",Lg="$heatmaps_enabled_server_side",Mv="$exception_capture_enabled_server_side",Og="$error_tracking_suppression_rules",Pv="$error_tracking_capture_extension_exceptions",Nv="$web_vitals_enabled_server_side",jT="$dead_clicks_enabled_server_side",Rv="$product_tours_enabled_server_side",Iv="$web_vitals_allowed_metrics",Sf="$session_recording_remote_config",Qh="$sesid",_T="$session_is_sampled",nc="$enabled_feature_flags",Hl="$early_access_features",$g="$feature_flag_details",Xl="$stored_person_properties",Qa="$stored_group_properties",zg="$surveys",Jh="$flag_call_reported",an="$user_state",Vg="$client_session_props",Ug="$capture_rate_limit",Gg="$initial_campaign_params",Wg="$initial_referrer_info",Zh="$initial_person_info",ep="$epp",ET="__POSTHOG_TOOLBAR__",Cl="$posthog_cookieless",fI=[AT,Yl,"__cmpns",ql,"$session_recording_enabled_server_side",Lg,Qh,nc,Og,an,Hl,$g,Qa,Xl,zg,Jh,Vg,Ug,Gg,Wg,ep,Zh,"$conversations_widget_session_id","$conversations_ticket_id","$conversations_widget_state","$conversations_user_traits"];function Dv(r){return r instanceof Element&&(r.id===ET||!(r.closest==null||!r.closest(".toolbar-global-fade-container")))}function Yp(r){return!!r&&r.nodeType===1}function ra(r,e){return!!r&&!!r.tagName&&r.tagName.toLowerCase()===e.toLowerCase()}function MT(r){return!!r&&r.nodeType===3}function PT(r){return!!r&&r.nodeType===11}function Xy(r){return r?Gp(r).split(/\s+/):[]}function Fv(r){var e=q?.location.href;return!!(e&&r&&r.some(t=>e.match(t)))}function tp(r){var e="";switch(typeof r.className){case"string":e=r.className;break;case"object":e=(r.className&&"baseVal"in r.className?r.className.baseVal:null)||r.getAttribute("class")||"";break;default:e=""}return Xy(e)}function NT(r){return gt(r)?null:Gp(r).split(/(\s+)/).filter(e=>Dd(e)).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function du(r){var e="";return Yg(r)&&!BT(r)&&r.childNodes&&r.childNodes.length&&Nt(r.childNodes,function(t){var s;MT(t)&&t.textContent&&(e+=(s=NT(t.textContent))!==null&&s!==void 0?s:"")}),Gp(e)}function RT(r){return Se(r.target)?r.srcElement||null:(e=r.target)!=null&&e.shadowRoot?r.composedPath()[0]||null:r.target||null;var e}var Ky=["a","button","form","input","select","textarea","label"];function IT(r,e){if(Se(e))return!0;var t,s=function(n){if(e.some(a=>n.matches(a)))return{v:!0}};for(var i of r)if(t=s(i))return t.v;return!1}function DT(r){var e=r.parentNode;return!(!e||!Yp(e))&&e}var mI=["next","previous","prev",">","<"],Bv=10,Lv=[".ph-no-rageclick",".ph-no-capture"];function gI(r,e){if(!q||Qy(r))return!1;var t,s,i;if(mn(e)?(t=!!e&&Lv,s=void 0):(t=(i=e?.css_selector_ignorelist)!==null&&i!==void 0?i:Lv,s=e?.content_ignorelist),t===!1)return!1;var{targetElementList:n}=FT(r,!1);return!function(a,o){if(a===!1||Se(a))return!1;var l;if(a===!0)l=mI;else{if(!xt(a))return!1;if(a.length>Bv)return _e.error("[PostHog] content_ignorelist array cannot exceed "+Bv+" items. Use css_selector_ignorelist for more complex matching."),!1;l=a.map(d=>d.toLowerCase())}return o.some(d=>{var{safeText:u,ariaLabel:h}=d;return l.some(p=>u.includes(p)||h.includes(p))})}(s,n.map(a=>{var o;return{safeText:du(a).toLowerCase(),ariaLabel:((o=a.getAttribute("aria-label"))==null?void 0:o.toLowerCase().trim())||""}}))&&!IT(n,t)}var Qy=r=>!r||ra(r,"html")||!Yp(r),FT=(r,e)=>{if(!q||Qy(r))return{parentIsUsefulElement:!1,targetElementList:[]};for(var t=!1,s=[r],i=r;i.parentNode&&!ra(i,"body");)if(PT(i.parentNode))s.push(i.parentNode.host),i=i.parentNode.host;else{var n=DT(i);if(!n)break;if(e||Ky.indexOf(n.tagName.toLowerCase())>-1)t=!0;else{var a=q.getComputedStyle(n);a&&a.getPropertyValue("cursor")==="pointer"&&(t=!0)}s.push(n),i=n}return{parentIsUsefulElement:t,targetElementList:s}};function yI(r,e,t,s,i){var n,a,o,l;if(t===void 0&&(t=void 0),!q||Qy(r)||(n=t)!=null&&n.url_allowlist&&!Fv(t.url_allowlist)||(a=t)!=null&&a.url_ignorelist&&Fv(t.url_ignorelist))return!1;if((o=t)!=null&&o.dom_event_allowlist){var d=t.dom_event_allowlist;if(d&&!d.some(m=>e.type===m))return!1}var{parentIsUsefulElement:u,targetElementList:h}=FT(r,s);if(!function(m,g){var y=g?.element_allowlist;if(Se(y))return!0;var x,b=function(C){if(y.some(k=>C.tagName.toLowerCase()===k))return{v:!0}};for(var w of m)if(x=b(w))return x.v;return!1}(h,t)||!IT(h,(l=t)==null?void 0:l.css_selector_allowlist))return!1;var p=q.getComputedStyle(r);if(p&&p.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var f=r.tagName.toLowerCase();switch(f){case"html":return!1;case"form":return(i||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(e.type)>=0;default:return u?(i||["click"]).indexOf(e.type)>=0:(i||["click"]).indexOf(e.type)>=0&&(Ky.indexOf(f)>-1||r.getAttribute("contenteditable")==="true")}}function Yg(r){for(var e=r;e.parentNode&&!ra(e,"body");e=e.parentNode){var t=tp(e);if(at(t,"ph-sensitive")||at(t,"ph-no-capture"))return!1}if(at(tp(r),"ph-include"))return!0;var s=r.type||"";if(Cs(s))switch(s.toLowerCase()){case"hidden":case"password":return!1}var i=r.name||r.id||"";return!(Cs(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function BT(r){return!!(ra(r,"input")&&!["button","checkbox","submit","reset"].includes(r.type)||ra(r,"select")||ra(r,"textarea")||r.getAttribute("contenteditable")==="true")}var LT="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",xI=new RegExp("^(?:"+LT+")$"),bI=new RegExp(LT),OT="\\d{3}-?\\d{2}-?\\d{4}",vI=new RegExp("^("+OT+")$"),wI=new RegExp("("+OT+")");function Dd(r,e){return e===void 0&&(e=!0),!(gt(r)||Cs(r)&&(r=Gp(r),(e?xI:bI).test((r||"").replace(/[- ]/g,""))||(e?vI:wI).test(r)))}function $T(r){var e=du(r);return Dd(e=(e+" "+zT(r)).trim())?e:""}function zT(r){var e="";return r&&r.childNodes&&r.childNodes.length&&Nt(r.childNodes,function(t){var s;if(t&&((s=t.tagName)==null?void 0:s.toLowerCase())==="span")try{var i=du(t);e=(e+" "+i).trim(),t.childNodes&&t.childNodes.length&&(e=(e+" "+zT(t)).trim())}catch(n){_e.error("[AutoCapture]",n)}}),e}function kI(r){return function(e){var t=e.map(s=>{var i,n,a="";if(s.tag_name&&(a+=s.tag_name),s.attr_class)for(var o of(s.attr_class.sort(),s.attr_class))a+="."+o.replace(/"/g,"");var l=Re({},s.text?{text:s.text}:{},{"nth-child":(i=s.nth_child)!==null&&i!==void 0?i:0,"nth-of-type":(n=s.nth_of_type)!==null&&n!==void 0?n:0},s.href?{href:s.href}:{},s.attr_id?{attr_id:s.attr_id}:{},s.attributes),d={};return Th(l).sort((u,h)=>{var[p]=u,[f]=h;return p.localeCompare(f)}).forEach(u=>{var[h,p]=u;return d[Ov(h.toString())]=Ov(p.toString())}),a+=":",a+=Th(d).map(u=>{var[h,p]=u;return h+'="'+p+'"'}).join("")});return t.join(";")}(function(e){return e.map(t=>{var s,i,n={text:(s=t.$el_text)==null?void 0:s.slice(0,400),tag_name:t.tag_name,href:(i=t.attr__href)==null?void 0:i.slice(0,2048),attr_class:CI(t),attr_id:t.attr__id,nth_child:t.nth_child,nth_of_type:t.nth_of_type,attributes:{}};return Th(t).filter(a=>{var[o]=a;return o.indexOf("attr__")===0}).forEach(a=>{var[o,l]=a;return n.attributes[o]=l}),n})}(r))}function Ov(r){return r.replace(/"|\\"/g,'\\"')}function CI(r){var e=r.attr__class;return e?xt(e)?e:Xy(e):void 0}class VT{constructor(e){this.disabled=e===!1;var t=ks(e)?e:{};this.thresholdPx=t.threshold_px||30,this.timeoutMs=t.timeout_ms||1e3,this.clickCount=t.click_count||3,this.clicks=[]}isRageClick(e,t,s){if(this.disabled)return!1;var i=this.clicks[this.clicks.length-1];if(i&&Math.abs(e-i.x)+Math.abs(t-i.y)<this.thresholdPx&&s-i.timestamp<this.timeoutMs){if(this.clicks.push({x:e,y:t,timestamp:s}),this.clicks.length===this.clickCount)return!0}else this.clicks=[{x:e,y:t,timestamp:s}];return!1}}var sp=r=>{var e=Ae?.createElement("a");return Se(e)?null:(e.href=r,e)},SI=function(r,e){var t,s;e===void 0&&(e="&");var i=[];return Nt(r,function(n,a){Se(n)||Se(a)||a==="undefined"||(t=encodeURIComponent((o=>o instanceof File)(n)?n.name:n.toString()),s=encodeURIComponent(a),i[i.length]=s+"="+t)}),i.join(e)},ip=function(r,e){for(var t,s=((r.split("#")[0]||"").split(/\?(.*)/)[1]||"").replace(/^\?+/g,"").split("&"),i=0;i<s.length;i++){var n=s[i].split("=");if(n[0]===e){t=n;break}}if(!xt(t)||t.length<2)return"";var a=t[1];try{a=decodeURIComponent(a)}catch{_e.error("Skipping decoding for malformed query param: "+a)}return a.replace(/\+/g," ")},uu=function(r,e,t){if(!r||!e||!e.length)return r;for(var s=r.split("#"),i=s[0]||"",n=s[1],a=i.split("?"),o=a[1],l=a[0],d=(o||"").split("&"),u=[],h=0;h<d.length;h++){var p=d[h].split("=");xt(p)&&(e.includes(p[0])?u.push(p[0]+"="+t):u.push(d[h]))}var f=l;return o!=null&&(f+="?"+u.join("&")),n!=null&&(f+="#"+n),f},rp=function(r,e){var t=r.match(new RegExp(e+"=([^&]*)"));return t?t[1]:null},Tf="$copy_autocapture",$v=rs("[AutoCapture]");function Af(r,e){return e.length>r?e.slice(0,r)+"...":e}function TI(r){if(r.previousElementSibling)return r.previousElementSibling;var e=r;do e=e.previousSibling;while(e&&!Yp(e));return e}function AI(r,e,t,s){var i=r.tagName.toLowerCase(),n={tag_name:i};Ky.indexOf(i)>-1&&!t&&(i.toLowerCase()==="a"||i.toLowerCase()==="button"?n.$el_text=Af(1024,$T(r)):n.$el_text=Af(1024,du(r)));var a=tp(r);a.length>0&&(n.classes=a.filter(function(u){return u!==""})),Nt(r.attributes,function(u){var h;if((!BT(r)||["name","id","class","aria-label"].indexOf(u.name)!==-1)&&(s==null||!s.includes(u.name))&&!e&&Dd(u.value)&&(h=u.name,!Cs(h)||h.substring(0,10)!=="_ngcontent"&&h.substring(0,7)!=="_nghost")){var p=u.value;u.name==="class"&&(p=Xy(p).join(" ")),n["attr__"+u.name]=Af(1024,p)}});for(var o=1,l=1,d=r;d=TI(d);)o++,d.tagName===r.tagName&&l++;return n.nth_child=o,n.nth_of_type=l,n}function jI(r,e){for(var t,s,{e:i,maskAllElementAttributes:n,maskAllText:a,elementAttributeIgnoreList:o,elementsChainAsString:l}=e,d=[r],u=r;u.parentNode&&!ra(u,"body");)PT(u.parentNode)?(d.push(u.parentNode.host),u=u.parentNode.host):(d.push(u.parentNode),u=u.parentNode);var h,p=[],f={},m=!1,g=!1;if(Nt(d,C=>{var k=Yg(C);C.tagName.toLowerCase()==="a"&&(m=C.getAttribute("href"),m=k&&m&&Dd(m)&&m),at(tp(C),"ph-no-capture")&&(g=!0),p.push(AI(C,n,a,o));var S=function(A){if(!Yg(A))return{};var T={};return Nt(A.attributes,function(j){if(j.name&&j.name.indexOf("data-ph-capture-attribute")===0){var _=j.name.replace("data-ph-capture-attribute-",""),M=j.value;_&&M&&Dd(M)&&(T[_]=M)}}),T}(C);cs(f,S)}),g)return{props:{},explicitNoCapture:g};if(a||(r.tagName.toLowerCase()==="a"||r.tagName.toLowerCase()==="button"?p[0].$el_text=$T(r):p[0].$el_text=du(r)),m){var y,x;p[0].attr__href=m;var b=(y=sp(m))==null?void 0:y.host,w=q==null||(x=q.location)==null?void 0:x.host;b&&w&&b!==w&&(h=m)}return{props:cs({$event_type:i.type,$ce_version:1},l?{}:{$elements:p},{$elements_chain:kI(p)},(t=p[0])!=null&&t.$el_text?{$el_text:(s=p[0])==null?void 0:s.$el_text}:{},h&&i.type==="click"?{$external_click_url:h}:{},f)}}class _I{constructor(e){this.P=!1,this.T=null,this.I=!1,this.instance=e,this.rageclicks=new VT(e.config.rageclick),this.C=null}get R(){var e,t,s=ks(this.instance.config.autocapture)?this.instance.config.autocapture:{};return s.url_allowlist=(e=s.url_allowlist)==null?void 0:e.map(i=>new RegExp(i)),s.url_ignorelist=(t=s.url_ignorelist)==null?void 0:t.map(i=>new RegExp(i)),s}F(){if(this.isBrowserSupported()){if(q&&Ae){var e=s=>{s=s||q?.event;try{this.M(s)}catch(i){$v.error("Failed to capture event",i)}};if(ys(Ae,"submit",e,{capture:!0}),ys(Ae,"change",e,{capture:!0}),ys(Ae,"click",e,{capture:!0}),this.R.capture_copied_text){var t=s=>{s=s||q?.event,this.M(s,Tf)};ys(Ae,"copy",t,{capture:!0}),ys(Ae,"cut",t,{capture:!0})}}}else $v.info("Disabling Automatic Event Collection because this browser is not supported")}startIfEnabled(){this.isEnabled&&!this.P&&(this.F(),this.P=!0)}onRemoteConfig(e){e.elementsChainAsString&&(this.I=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register({[Ev]:!!e.autocapture_opt_out}),this.T=!!e.autocapture_opt_out,this.startIfEnabled()}setElementSelectors(e){this.C=e}getElementSelectors(e){var t,s=[];return(t=this.C)==null||t.forEach(i=>{var n=Ae?.querySelectorAll(i);n?.forEach(a=>{e===a&&s.push(i)})}),s}get isEnabled(){var e,t,s=(e=this.instance.persistence)==null?void 0:e.props[Ev],i=this.T;if(kr(i)&&!mn(s)&&!this.instance.O())return!1;var n=(t=this.T)!==null&&t!==void 0?t:!!s;return!!this.instance.config.autocapture&&!n}M(e,t){if(t===void 0&&(t="$autocapture"),this.isEnabled){var s,i=RT(e);MT(i)&&(i=i.parentNode||null),t==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(s=this.rageclicks)!=null&&s.isRageClick(e.clientX,e.clientY,e.timeStamp||new Date().getTime())&&gI(i,this.instance.config.rageclick)&&this.M(e,"$rageclick");var n=t===Tf;if(i&&yI(i,e,this.R,n,n?["copy","cut"]:void 0)){var{props:a,explicitNoCapture:o}=jI(i,{e,maskAllElementAttributes:this.instance.config.mask_all_element_attributes,maskAllText:this.instance.config.mask_all_text,elementAttributeIgnoreList:this.R.element_attribute_ignorelist,elementsChainAsString:this.I});if(o)return!1;var l=this.getElementSelectors(i);if(l&&l.length>0&&(a.$element_selectors=l),t===Tf){var d,u=NT(q==null||(d=q.getSelection())==null?void 0:d.toString()),h=e.type||"clipboard";if(!u)return!1;a.$selected_content=u,a.$copy_type=h}return this.instance.capture(t,a),!0}}}isBrowserSupported(){return sa(Ae?.querySelectorAll)}}Math.trunc||(Math.trunc=function(r){return r<0?Math.ceil(r):Math.floor(r)}),Number.isInteger||(Number.isInteger=function(r){return yn(r)&&isFinite(r)&&Math.floor(r)===r});var zv="0123456789abcdef";class np{constructor(e){if(this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,s,i){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(s)||!Number.isInteger(i)||e<0||t<0||s<0||i<0||e>0xffffffffffff||t>4095||s>1073741823||i>4294967295)throw new RangeError("invalid field value");var n=new Uint8Array(16);return n[0]=e/Math.pow(2,40),n[1]=e/Math.pow(2,32),n[2]=e/Math.pow(2,24),n[3]=e/Math.pow(2,16),n[4]=e/Math.pow(2,8),n[5]=e,n[6]=112|t>>>8,n[7]=t,n[8]=128|s>>>24,n[9]=s>>>16,n[10]=s>>>8,n[11]=s,n[12]=i>>>24,n[13]=i>>>16,n[14]=i>>>8,n[15]=i,new np(n)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+zv.charAt(this.bytes[t]>>>4)+zv.charAt(15&this.bytes[t]),t!==3&&t!==5&&t!==7&&t!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}clone(){return new np(this.bytes.slice(0))}equals(e){return this.compareTo(e)===0}compareTo(e){for(var t=0;t<16;t++){var s=this.bytes[t]-e.bytes[t];if(s!==0)return Math.sign(s)}return 0}}class EI{constructor(){this.A=0,this.D=0,this.j=new MI}generate(){var e=this.generateOrAbort();if(Se(e)){this.A=0;var t=this.generateOrAbort();if(Se(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.A)this.A=e,this.L();else{if(!(e+1e4>this.A))return;this.D++,this.D>4398046511103&&(this.A++,this.L())}return np.fromFieldsV7(this.A,Math.trunc(this.D/Math.pow(2,30)),this.D&Math.pow(2,30)-1,this.j.nextUint32())}L(){this.D=1024*this.j.nextUint32()+(1023&this.j.nextUint32())}}var Vv,UT=r=>{if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<r.length;e++)r[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return r};q&&!Se(q.crypto)&&crypto.getRandomValues&&(UT=r=>crypto.getRandomValues(r));class MI{constructor(){this.N=new Uint32Array(8),this.U=1/0}nextUint32(){return this.U>=this.N.length&&(UT(this.N),this.U=0),this.N[this.U++]}}var Kn=()=>PI().toString(),PI=()=>(Vv||(Vv=new EI)).generate(),Sl="",NI=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function RI(r,e){if(e){var t=function(i,n){if(n===void 0&&(n=Ae),Sl)return Sl;if(!n||["localhost","127.0.0.1"].includes(i))return"";for(var a=i.split("."),o=Math.min(a.length,8),l="dmn_chk_"+Kn();!Sl&&o--;){var d=a.slice(o).join("."),u=l+"=1;domain=."+d+";path=/";n.cookie=u+";max-age=3",n.cookie.includes(l)&&(n.cookie=u+";max-age=0",Sl=d)}return Sl}(r);if(!t){var s=(i=>{var n=i.match(NI);return n?n[0]:""})(r);s!==t&&_e.info("Warning: cookie subdomain discovery mismatch",s,t),t=s}return t?"; domain=."+t:""}return""}var Ir={H:()=>!!Ae,B:function(r){_e.error("cookieStore error: "+r)},q:function(r){if(Ae){try{for(var e=r+"=",t=Ae.cookie.split(";").filter(n=>n.length),s=0;s<t.length;s++){for(var i=t[s];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null}},W:function(r){var e;try{e=JSON.parse(Ir.q(r))||{}}catch{}return e},G:function(r,e,t,s,i){if(Ae)try{var n="",a="",o=RI(Ae.location.hostname,s);if(t){var l=new Date;l.setTime(l.getTime()+24*t*60*60*1e3),n="; expires="+l.toUTCString()}i&&(a="; secure");var d=r+"="+encodeURIComponent(JSON.stringify(e))+n+"; SameSite=Lax; path=/"+o+a;return d.length>3686.4&&_e.warn("cookieStore warning: large cookie, len="+d.length),Ae.cookie=d,d}catch{return}},V:function(r,e){if(Ae!=null&&Ae.cookie)try{Ir.G(r,"",-1,e)}catch{return}}},jf=null,Yt={H:function(){if(!kr(jf))return jf;var r=!0;if(Se(q))r=!1;else try{var e="__mplssupport__";Yt.G(e,"xyz"),Yt.q(e)!=='"xyz"'&&(r=!1),Yt.V(e)}catch{r=!1}return r||_e.error("localStorage unsupported; falling back to cookie store"),jf=r,r},B:function(r){_e.error("localStorage error: "+r)},q:function(r){try{return q?.localStorage.getItem(r)}catch(e){Yt.B(e)}return null},W:function(r){try{return JSON.parse(Yt.q(r))||{}}catch{}return null},G:function(r,e){try{q?.localStorage.setItem(r,JSON.stringify(e))}catch(t){Yt.B(t)}},V:function(r){try{q?.localStorage.removeItem(r)}catch(e){Yt.B(e)}}},II=["$device_id","distinct_id",Qh,_T,ep,Zh],Iu={},DI={H:function(){return!0},B:function(r){_e.error("memoryStorage error: "+r)},q:function(r){return Iu[r]||null},W:function(r){return Iu[r]||null},G:function(r,e){Iu[r]=e},V:function(r){delete Iu[r]}},Ia=null,Bs={H:function(){if(!kr(Ia))return Ia;if(Ia=!0,Se(q))Ia=!1;else try{var r="__support__";Bs.G(r,"xyz"),Bs.q(r)!=='"xyz"'&&(Ia=!1),Bs.V(r)}catch{Ia=!1}return Ia},B:function(r){_e.error("sessionStorage error: ",r)},q:function(r){try{return q?.sessionStorage.getItem(r)}catch(e){Bs.B(e)}return null},W:function(r){try{return JSON.parse(Bs.q(r))||null}catch{}return null},G:function(r,e){try{q?.sessionStorage.setItem(r,JSON.stringify(e))}catch(t){Bs.B(t)}},V:function(r){try{q?.sessionStorage.removeItem(r)}catch(e){Bs.B(e)}}},on=function(r){return r[r.PENDING=-1]="PENDING",r[r.DENIED=0]="DENIED",r[r.GRANTED=1]="GRANTED",r}({});class FI{constructor(e){this._instance=e}get R(){return this._instance.config}get consent(){return this.J()?on.DENIED:this.K}isOptedOut(){return this.R.cookieless_mode==="always"||this.consent===on.DENIED||this.consent===on.PENDING&&(this.R.opt_out_capturing_by_default||this.R.cookieless_mode==="on_reject")}isOptedIn(){return!this.isOptedOut()}isExplicitlyOptedOut(){return this.consent===on.DENIED}optInOut(e){this.Y.G(this.X,e?1:0,this.R.cookie_expiration,this.R.cross_subdomain_cookie,this.R.secure_cookie)}reset(){this.Y.V(this.X,this.R.cross_subdomain_cookie)}get X(){var{token:e,opt_out_capturing_cookie_prefix:t,consent_persistence_name:s}=this._instance.config;return s||(t?t+e:"__ph_opt_in_out_"+e)}get K(){var e=this.Y.q(this.X);return wf(e)?on.GRANTED:at(MR,e)?on.DENIED:on.PENDING}get Y(){if(!this.Z){var e=this.R.opt_out_capturing_persistence_type;this.Z=e==="localStorage"?Yt:Ir;var t=e==="localStorage"?Ir:Yt;t.q(this.X)&&(this.Z.q(this.X)||this.optInOut(wf(t.q(this.X))),t.V(this.X,this.R.cross_subdomain_cookie))}return this.Z}J(){return!!this.R.respect_dnt&&!!TT([Fi?.doNotTrack,Fi?.msDoNotTrack,We.doNotTrack],e=>wf(e))}}var Du=rs("[Dead Clicks]"),BI=()=>!0,LI=r=>{var e,t=!((e=r.instance.persistence)==null||!e.get_property(jT)),s=r.instance.config.capture_dead_clicks;return mn(s)?s:!!ks(s)||t};class GT{get lazyLoadedDeadClicksAutocapture(){return this.tt}constructor(e,t,s){this.instance=e,this.isEnabled=t,this.onCapture=s,this.startIfEnabled()}onRemoteConfig(e){this.instance.persistence&&this.instance.persistence.register({[jT]:e?.captureDeadClicks}),this.startIfEnabled()}startIfEnabled(){this.isEnabled(this)&&this.it(()=>{this.et()})}it(e){var t,s;(t=We.__PosthogExtensions__)!=null&&t.initDeadClicksAutocapture&&e(),(s=We.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this.instance,"dead-clicks-autocapture",i=>{i?Du.error("failed to load script",i):e()})}et(){var e;if(Ae){if(!this.tt&&(e=We.__PosthogExtensions__)!=null&&e.initDeadClicksAutocapture){var t=ks(this.instance.config.capture_dead_clicks)?this.instance.config.capture_dead_clicks:{};t.__onCapture=this.onCapture,this.tt=We.__PosthogExtensions__.initDeadClicksAutocapture(this.instance,t),this.tt.start(Ae),Du.info("starting...")}}else Du.error("`document` not found. Cannot start.")}stop(){this.tt&&(this.tt.stop(),this.tt=void 0,Du.info("stopping..."))}}var Tl=rs("[ExceptionAutocapture]");class OI{constructor(e){var t,s,i;this.rt=()=>{var n;if(q&&this.isEnabled&&(n=We.__PosthogExtensions__)!=null&&n.errorWrappingFunctions){var a=We.__PosthogExtensions__.errorWrappingFunctions.wrapOnError,o=We.__PosthogExtensions__.errorWrappingFunctions.wrapUnhandledRejection,l=We.__PosthogExtensions__.errorWrappingFunctions.wrapConsoleError;try{!this.st&&this.R.capture_unhandled_errors&&(this.st=a(this.captureException.bind(this))),!this.nt&&this.R.capture_unhandled_rejections&&(this.nt=o(this.captureException.bind(this))),!this.ot&&this.R.capture_console_errors&&(this.ot=l(this.captureException.bind(this)))}catch(d){Tl.error("failed to start",d),this.ut()}}},this._instance=e,this.ht=!((t=this._instance.persistence)==null||!t.props[Mv]),this.dt=new PR({refillRate:(s=this._instance.config.error_tracking.__exceptionRateLimiterRefillRate)!==null&&s!==void 0?s:1,bucketSize:(i=this._instance.config.error_tracking.__exceptionRateLimiterBucketSize)!==null&&i!==void 0?i:10,refillInterval:1e4,h:Tl}),this.R=this.vt(),this.startIfEnabledOrStop()}vt(){var e=this._instance.config.capture_exceptions,t={capture_unhandled_errors:!1,capture_unhandled_rejections:!1,capture_console_errors:!1};return ks(e)?t=Re({},t,e):(Se(e)?this.ht:e)&&(t=Re({},t,{capture_unhandled_errors:!0,capture_unhandled_rejections:!0})),t}get isEnabled(){return this.R.capture_console_errors||this.R.capture_unhandled_errors||this.R.capture_unhandled_rejections}startIfEnabledOrStop(){this.isEnabled?(Tl.info("enabled"),this.ut(),this.it(this.rt)):this.ut()}it(e){var t,s;(t=We.__PosthogExtensions__)!=null&&t.errorWrappingFunctions&&e(),(s=We.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"exception-autocapture",i=>{if(i)return Tl.error("failed to load script",i);e()})}ut(){var e,t,s;(e=this.st)==null||e.call(this),this.st=void 0,(t=this.nt)==null||t.call(this),this.nt=void 0,(s=this.ot)==null||s.call(this),this.ot=void 0}onRemoteConfig(e){var t=e.autocaptureExceptions;this.ht=!!t||!1,this._instance.persistence&&this._instance.persistence.register({[Mv]:this.ht}),this.R=this.vt(),this.startIfEnabledOrStop()}onConfigChange(){this.R=this.vt()}captureException(e){var t,s,i=(t=e==null||(s=e.$exception_list)==null||(s=s[0])==null?void 0:s.type)!==null&&t!==void 0?t:"Exception";this.dt.consumeRateLimit(i)?Tl.info("Skipping exception capture because of client rate limiting.",{exception:i}):this._instance.exceptions.sendExceptionEvent(e)}}function Uv(r,e,t){try{if(!(e in r))return()=>{};var s=r[e],i=t(s);return sa(i)&&(i.prototype=i.prototype||{},Object.defineProperties(i,{__posthog_wrapped__:{enumerable:!1,value:!0}})),r[e]=i,()=>{r[e]=s}}catch{return()=>{}}}class $I{constructor(e){var t;this._instance=e,this.ct=(q==null||(t=q.location)==null?void 0:t.pathname)||""}get isEnabled(){return this._instance.config.capture_pageview==="history_change"}startIfEnabled(){this.isEnabled&&(_e.info("History API monitoring enabled, starting..."),this.monitorHistoryChanges())}stop(){this.ft&&this.ft(),this.ft=void 0,_e.info("History API monitoring stopped")}monitorHistoryChanges(){var e,t;if(q&&q.history){var s=this;(e=q.history.pushState)!=null&&e.__posthog_wrapped__||Uv(q.history,"pushState",i=>function(n,a,o){i.call(this,n,a,o),s._t("pushState")}),(t=q.history.replaceState)!=null&&t.__posthog_wrapped__||Uv(q.history,"replaceState",i=>function(n,a,o){i.call(this,n,a,o),s._t("replaceState")}),this.yt()}}_t(e){try{var t,s=q==null||(t=q.location)==null?void 0:t.pathname;if(!s)return;s!==this.ct&&this.isEnabled&&this._instance.capture("$pageview",{navigation_type:e}),this.ct=s}catch(i){_e.error("Error capturing "+e+" pageview",i)}}yt(){if(!this.ft){var e=()=>{this._t("popstate")};ys(q,"popstate",e),this.ft=()=>{q&&q.removeEventListener("popstate",e)}}}}var _f=rs("[SegmentIntegration]");function zI(r,e){var t=r.config.segment;if(!t)return e();(function(s,i){var n=s.config.segment;if(!n)return i();var a=l=>{var d=()=>l.anonymousId()||Kn();s.config.get_device_id=d,l.id()&&(s.register({distinct_id:l.id(),$device_id:d()}),s.persistence.set_property(an,"identified")),i()},o=n.user();"then"in o&&sa(o.then)?o.then(a):a(o)})(r,()=>{t.register((s=>{Promise&&Promise.resolve||_f.warn("This browser does not have Promise support, and can not use the segment integration");var i=(n,a)=>{if(!a)return n;n.event.userId||n.event.anonymousId===s.get_distinct_id()||(_f.info("No userId set, resetting PostHog"),s.reset()),n.event.userId&&n.event.userId!==s.get_distinct_id()&&(_f.info("UserId set, identifying with PostHog"),s.identify(n.event.userId));var o=s.calculateEventProperties(a,n.event.properties);return n.event.properties=Object.assign({},o,n.event.properties),n};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:()=>!0,load:()=>Promise.resolve(),track:n=>i(n,n.event.event),page:n=>i(n,"$pageview"),identify:n=>i(n,"$identify"),screen:n=>i(n,"$screen")}})(r)).then(()=>{e()})})}var WT="posthog-js";function YT(r,e){var{organization:t,projectId:s,prefix:i,severityAllowList:n=["error"],sendExceptionsToPostHog:a=!0}=e===void 0?{}:e;return o=>{var l,d,u,h,p;if(!(n==="*"||n.includes(o.level))||!r.__loaded)return o;o.tags||(o.tags={});var f=r.requestRouter.endpointFor("ui","/project/"+r.config.token+"/person/"+r.get_distinct_id());o.tags["PostHog Person URL"]=f,r.sessionRecordingStarted()&&(o.tags["PostHog Recording URL"]=r.get_session_replay_url({withTimestamp:!0}));var m=((l=o.exception)==null?void 0:l.values)||[],g=m.map(x=>Re({},x,{stacktrace:x.stacktrace?Re({},x.stacktrace,{type:"raw",frames:(x.stacktrace.frames||[]).map(b=>Re({},b,{platform:"web:javascript"}))}):void 0})),y={$exception_message:((d=m[0])==null?void 0:d.value)||o.message,$exception_type:(u=m[0])==null?void 0:u.type,$exception_level:o.level,$exception_list:g,$sentry_event_id:o.event_id,$sentry_exception:o.exception,$sentry_exception_message:((h=m[0])==null?void 0:h.value)||o.message,$sentry_exception_type:(p=m[0])==null?void 0:p.type,$sentry_tags:o.tags};return t&&s&&(y.$sentry_url=(i||"https://sentry.io/organizations/")+t+"/issues/?project="+s+"&query="+o.event_id),a&&r.exceptions.sendExceptionEvent(y),o}}class VI{constructor(e,t,s,i,n,a){this.name=WT,this.setupOnce=function(o){o(YT(e,{organization:t,projectId:s,prefix:i,severityAllowList:n,sendExceptionsToPostHog:a==null||a}))}}}var UI=q!=null&&q.location?rp(q.location.hash,"__posthog")||rp(location.hash,"state"):null,Gv="_postHogToolbarParams",Wv=rs("[Toolbar]"),Wn=function(r){return r[r.UNINITIALIZED=0]="UNINITIALIZED",r[r.LOADING=1]="LOADING",r[r.LOADED=2]="LOADED",r}(Wn||{});class GI{constructor(e){this.instance=e}bt(e){We.ph_toolbar_state=e}wt(){var e;return(e=We.ph_toolbar_state)!==null&&e!==void 0?e:Wn.UNINITIALIZED}maybeLoadToolbar(e,t,s){if(e===void 0&&(e=void 0),t===void 0&&(t=void 0),s===void 0&&(s=void 0),!q||!Ae)return!1;e=e??q.location,s=s??q.history;try{if(!t){try{q.localStorage.setItem("test","test"),q.localStorage.removeItem("test")}catch{return!1}t=q?.localStorage}var i,n=UI||rp(e.hash,"__posthog")||rp(e.hash,"state"),a=n?_v(()=>JSON.parse(atob(decodeURIComponent(n))))||_v(()=>JSON.parse(decodeURIComponent(n))):null;return a&&a.action==="ph_authorize"?((i=a).source="url",i&&Object.keys(i).length>0&&(a.desiredHash?e.hash=a.desiredHash:s?s.replaceState(s.state,"",e.pathname+e.search):e.hash="")):((i=JSON.parse(t.getItem(Gv)||"{}")).source="localstorage",delete i.userIntent),!(!i.token||this.instance.config.token!==i.token)&&(this.loadToolbar(i),!0)}catch{return!1}}xt(e){var t=We.ph_load_toolbar||We.ph_load_editor;!gt(t)&&sa(t)?t(e,this.instance):Wv.warn("No toolbar load function found")}loadToolbar(e){var t=!(Ae==null||!Ae.getElementById(ET));if(!q||t)return!1;var s=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,i=Re({token:this.instance.config.token},e,{apiURL:this.instance.requestRouter.endpointFor("ui")},s?{instrument:!1}:{});if(q.localStorage.setItem(Gv,JSON.stringify(Re({},i,{source:void 0}))),this.wt()===Wn.LOADED)this.xt(i);else if(this.wt()===Wn.UNINITIALIZED){var n;this.bt(Wn.LOADING),(n=We.__PosthogExtensions__)==null||n.loadExternalDependency==null||n.loadExternalDependency(this.instance,"toolbar",a=>{if(a)return Wv.error("[Toolbar] Failed to load",a),void this.bt(Wn.UNINITIALIZED);this.bt(Wn.LOADED),this.xt(i)}),ys(q,"turbolinks:load",()=>{this.bt(Wn.UNINITIALIZED),this.loadToolbar(i)})}return!0}Et(e){return this.loadToolbar(e)}maybeLoadEditor(e,t,s){return e===void 0&&(e=void 0),t===void 0&&(t=void 0),s===void 0&&(s=void 0),this.maybeLoadToolbar(e,t,s)}}var WI=rs("[TracingHeaders]");class YI{constructor(e){this.$t=void 0,this.St=void 0,this.rt=()=>{var t,s;Se(this.$t)&&((t=We.__PosthogExtensions__)==null||(t=t.tracingHeadersPatchFns)==null||t._patchXHR(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager)),Se(this.St)&&((s=We.__PosthogExtensions__)==null||(s=s.tracingHeadersPatchFns)==null||s._patchFetch(this._instance.config.__add_tracing_headers||[],this._instance.get_distinct_id(),this._instance.sessionManager))},this._instance=e}it(e){var t,s;(t=We.__PosthogExtensions__)!=null&&t.tracingHeadersPatchFns&&e(),(s=We.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"tracing-headers",i=>{if(i)return WI.error("failed to load script",i);e()})}startIfEnabledOrStop(){var e,t;this._instance.config.__add_tracing_headers?this.it(this.rt):((e=this.$t)==null||e.call(this),(t=this.St)==null||t.call(this),this.$t=void 0,this.St=void 0)}}var Fu="https?://(.*)",Zc=["gclid","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","igshid","ttclid","rdt_cid","epik","qclid","sccid","irclid","_kx"],qI=Jc(["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gad_source","mc_cid"],Zc),hu="<masked>",HI=["li_fat_id"];function qT(r,e,t){if(!Ae)return{};var s,i=e?Jc([],Zc,t||[]):[],n=HT(uu(Ae.URL,i,hu),r),a=(s={},Nt(HI,function(o){var l=Ir.q(o);s[o]=l||null}),s);return cs(a,n)}function HT(r,e){var t=qI.concat(e||[]),s={};return Nt(t,function(i){var n=ip(r,i);s[i]=n||null}),s}function XT(r){var e=function(n){return n?n.search(Fu+"google.([^/?]*)")===0?"google":n.search(Fu+"bing.com")===0?"bing":n.search(Fu+"yahoo.com")===0?"yahoo":n.search(Fu+"duckduckgo.com")===0?"duckduckgo":null:null}(r),t=e!="yahoo"?"q":"p",s={};if(!kr(e)){s.$search_engine=e;var i=Ae?ip(Ae.referrer,t):"";i.length&&(s.ph_keyword=i)}return s}function Yv(){return navigator.language||navigator.userLanguage}function KT(){return Ae?.referrer||"$direct"}function QT(r,e){var t=r?Jc([],Zc,e||[]):[],s=yi?.href.substring(0,1e3);return{r:KT().substring(0,1e3),u:s?uu(s,t,hu):void 0}}function JT(r){var e,{r:t,u:s}=r,i={$referrer:t,$referring_domain:t==null?void 0:t=="$direct"?"$direct":(e=sp(t))==null?void 0:e.host};if(s){i.$current_url=s;var n=sp(s);i.$host=n?.host,i.$pathname=n?.pathname;var a=HT(s);cs(i,a)}if(t){var o=XT(t);cs(i,o)}return i}function ZT(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return}}function XI(){try{return new Date().getTimezoneOffset()}catch{return}}function KI(r,e){if(!gi)return{};var t,s,i,n=r?Jc([],Zc,e||[]):[],[a,o]=function(l){for(var d=0;d<Cv.length;d++){var[u,h]=Cv[d],p=u.exec(l),f=p&&(sa(h)?h(p,l):h);if(f)return f}return["",""]}(gi);return cs(Hy({$os:a,$os_version:o,$browser:wT(gi,navigator.vendor),$device:Sv(gi),$device_type:(s=gi,i=Sv(s),i===oT||i===aT||i==="Kobo"||i==="Kindle Fire"||i===vT?Pd:i===Rd||i===Cc||i===Id||i===Dg?"Console":i===lT?"Wearable":i?ar:"Desktop"),$timezone:ZT(),$timezone_offset:XI()}),{$current_url:uu(yi?.href,n,hu),$host:yi?.host,$pathname:yi?.pathname,$raw_user_agent:gi.length>1e3?gi.substring(0,997)+"...":gi,$browser_version:zR(gi,navigator.vendor),$browser_language:Yv(),$browser_language_prefix:(t=Yv(),typeof t=="string"?t.split("-")[0]:void 0),$screen_height:q?.screen.height,$screen_width:q?.screen.width,$viewport_height:q?.innerHeight,$viewport_width:q?.innerWidth,$lib:"web",$lib_version:nn.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:Date.now()/1e3})}var In=rs("[Web Vitals]"),qv=9e5;class QI{constructor(e){var t;this.kt=!1,this.P=!1,this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0},this.Pt=()=>{clearTimeout(this.Tt),this.N.metrics.length!==0&&(this._instance.capture("$web_vitals",this.N.metrics.reduce((s,i)=>Re({},s,{["$web_vitals_"+i.name+"_event"]:Re({},i),["$web_vitals_"+i.name+"_value"]:i.value}),{})),this.N={url:void 0,metrics:[],firstMetricTimestamp:void 0})},this.It=s=>{var i,n=(i=this._instance.sessionManager)==null?void 0:i.checkAndGetSessionAndWindowId(!0);if(Se(n))In.error("Could not read session ID. Dropping metrics!");else{this.N=this.N||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=this.Ct();Se(a)||(gt(s?.name)||gt(s?.value)?In.error("Invalid metric received",s):this.Rt&&s.value>=this.Rt?In.error("Ignoring metric with value >= "+this.Rt,s):(this.N.url!==a&&(this.Pt(),this.Tt=setTimeout(this.Pt,this.flushToCaptureTimeoutMs)),Se(this.N.url)&&(this.N.url=a),this.N.firstMetricTimestamp=Se(this.N.firstMetricTimestamp)?Date.now():this.N.firstMetricTimestamp,s.attribution&&s.attribution.interactionTargetElement&&(s.attribution.interactionTargetElement=void 0),this.N.metrics.push(Re({},s,{$current_url:a,$session_id:n.sessionId,$window_id:n.windowId,timestamp:Date.now()})),this.N.metrics.length===this.allowedMetrics.length&&this.Pt()))}},this.rt=()=>{if(!this.P){var s,i,n,a,o=We.__PosthogExtensions__;Se(o)||Se(o.postHogWebVitalsCallbacks)||({onLCP:s,onCLS:i,onFCP:n,onINP:a}=o.postHogWebVitalsCallbacks),s&&i&&n&&a?(this.allowedMetrics.indexOf("LCP")>-1&&s(this.It.bind(this)),this.allowedMetrics.indexOf("CLS")>-1&&i(this.It.bind(this)),this.allowedMetrics.indexOf("FCP")>-1&&n(this.It.bind(this)),this.allowedMetrics.indexOf("INP")>-1&&a(this.It.bind(this)),this.P=!0):In.error("web vitals callbacks not loaded - not starting")}},this._instance=e,this.kt=!((t=this._instance.persistence)==null||!t.props[Nv]),this.startIfEnabled()}get allowedMetrics(){var e,t,s=ks(this._instance.config.capture_performance)?(e=this._instance.config.capture_performance)==null?void 0:e.web_vitals_allowed_metrics:void 0;return Se(s)?((t=this._instance.persistence)==null?void 0:t.props[Iv])||["CLS","FCP","INP","LCP"]:s}get flushToCaptureTimeoutMs(){return(ks(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_delayed_flush_ms:void 0)||5e3}get useAttribution(){var e=ks(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_attribution:void 0;return e==null||e}get Rt(){var e=ks(this._instance.config.capture_performance)&&yn(this._instance.config.capture_performance.__web_vitals_max_value)?this._instance.config.capture_performance.__web_vitals_max_value:qv;return 0<e&&e<=6e4?qv:e}get isEnabled(){var e=yi?.protocol;if(e!=="http:"&&e!=="https:")return In.info("Web Vitals are disabled on non-http/https protocols"),!1;var t=ks(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals:mn(this._instance.config.capture_performance)?this._instance.config.capture_performance:void 0;return mn(t)?t:this.kt}startIfEnabled(){this.isEnabled&&!this.P&&(In.info("enabled, starting..."),this.it(this.rt))}onRemoteConfig(e){var t=ks(e.capturePerformance)&&!!e.capturePerformance.web_vitals,s=ks(e.capturePerformance)?e.capturePerformance.web_vitals_allowed_metrics:void 0;this._instance.persistence&&(this._instance.persistence.register({[Nv]:t}),this._instance.persistence.register({[Iv]:s})),this.kt=t,this.startIfEnabled()}it(e){var t,s;(t=We.__PosthogExtensions__)!=null&&t.postHogWebVitalsCallbacks?e():(s=We.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"web-vitals",i=>{var n;if(i)In.error("failed to load script",i);else{var a=(n=We.__PosthogExtensions__)==null?void 0:n.loadWebVitalsCallbacks;a&&a(this.useAttribution),e()}})}Ct(){var e=q?q.location.href:void 0;if(e){var t=this._instance.config.mask_personal_data_properties,s=this._instance.config.custom_personal_data_properties,i=t?Jc([],Zc,s||[]):[];return uu(e,i,hu)}In.error("Could not determine current URL")}}var JI=rs("[Heatmaps]");function Hv(r){return ks(r)&&"clientX"in r&&"clientY"in r&&yn(r.clientX)&&yn(r.clientY)}class ZI{constructor(e){var t;this.kt=!1,this.P=!1,this.Ft=null,this.instance=e,this.kt=!((t=this.instance.persistence)==null||!t.props[Lg]),this.rageclicks=new VT(e.config.rageclick)}get flushIntervalMilliseconds(){var e=5e3;return ks(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}get isEnabled(){return Se(this.instance.config.capture_heatmaps)?Se(this.instance.config.enable_heatmaps)?this.kt:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}startIfEnabled(){if(this.isEnabled){if(this.P)return;JI.info("starting..."),this.Mt(),this.Ot()}else{var e;clearInterval((e=this.Ft)!==null&&e!==void 0?e:void 0),this.At(),this.getAndClearBuffer()}}onRemoteConfig(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register({[Lg]:t}),this.kt=t,this.startIfEnabled()}getAndClearBuffer(){var e=this.N;return this.N=void 0,e}Dt(e){this.jt(e.originalEvent,"deadclick")}Ot(){this.Ft&&clearInterval(this.Ft),this.Ft=function(e){return e?.visibilityState==="visible"}(Ae)?setInterval(this.Lt.bind(this),this.flushIntervalMilliseconds):null}Mt(){q&&Ae&&(this.Nt=this.Lt.bind(this),ys(q,"beforeunload",this.Nt),this.Ut=e=>this.jt(e||q?.event),ys(Ae,"click",this.Ut,{capture:!0}),this.zt=e=>this.Ht(e||q?.event),ys(Ae,"mousemove",this.zt,{capture:!0}),this.Bt=new GT(this.instance,BI,this.Dt.bind(this)),this.Bt.startIfEnabled(),this.qt=this.Ot.bind(this),ys(Ae,"visibilitychange",this.qt),this.P=!0)}At(){var e;q&&Ae&&(this.Nt&&q.removeEventListener("beforeunload",this.Nt),this.Ut&&Ae.removeEventListener("click",this.Ut,{capture:!0}),this.zt&&Ae.removeEventListener("mousemove",this.zt,{capture:!0}),this.qt&&Ae.removeEventListener("visibilitychange",this.qt),clearTimeout(this.Wt),(e=this.Bt)==null||e.stop(),this.P=!1)}Gt(e,t){var s=this.instance.scrollManager.scrollY(),i=this.instance.scrollManager.scrollX(),n=this.instance.scrollManager.scrollElement(),a=function(o,l,d){for(var u=o;u&&Yp(u)&&!ra(u,"body");){if(u===d)return!1;if(at(l,q?.getComputedStyle(u).position))return!0;u=DT(u)}return!1}(RT(e),["fixed","sticky"],n);return{x:e.clientX+(a?0:i),y:e.clientY+(a?0:s),target_fixed:a,type:t}}jt(e,t){var s;if(t===void 0&&(t="click"),!Dv(e.target)&&Hv(e)){var i=this.Gt(e,t);(s=this.rageclicks)!=null&&s.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this.Vt(Re({},i,{type:"rageclick"})),this.Vt(i)}}Ht(e){!Dv(e.target)&&Hv(e)&&(clearTimeout(this.Wt),this.Wt=setTimeout(()=>{this.Vt(this.Gt(e,"mousemove"))},500))}Vt(e){if(q){var t=q.location.href,s=this.instance.config.mask_personal_data_properties,i=this.instance.config.custom_personal_data_properties,n=s?Jc([],Zc,i||[]):[],a=uu(t,n,hu);this.N=this.N||{},this.N[a]||(this.N[a]=[]),this.N[a].push(e)}}Lt(){this.N&&!rc(this.N)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}class Xv{constructor(e){this.Jt=(t,s,i)=>{i&&(i.noSessionId||i.activityTimeout||i.sessionPastMaximumLength)&&(_e.info("[PageViewManager] Session rotated, clearing pageview state",{sessionId:t,changeReason:i}),this.Kt=void 0,this._instance.scrollManager.resetContext())},this._instance=e,this.Yt()}Yt(){var e;this.Xt=(e=this._instance.sessionManager)==null?void 0:e.onSessionId(this.Jt)}destroy(){var e;(e=this.Xt)==null||e.call(this),this.Xt=void 0}doPageView(e,t){var s,i=this.Qt(e,t);return this.Kt={pathname:(s=q?.location.pathname)!==null&&s!==void 0?s:"",pageViewId:t,timestamp:e},this._instance.scrollManager.resetContext(),i}doPageLeave(e){var t;return this.Qt(e,(t=this.Kt)==null?void 0:t.pageViewId)}doEvent(){var e;return{$pageview_id:(e=this.Kt)==null?void 0:e.pageViewId}}Qt(e,t){var s=this.Kt;if(!s)return{$pageview_id:t};var i={$pageview_id:t,$prev_pageview_id:s.pageViewId},n=this._instance.scrollManager.getContext();if(n&&!this._instance.config.disable_scroll_properties){var{maxScrollHeight:a,lastScrollY:o,maxScrollY:l,maxContentHeight:d,lastContentY:u,maxContentY:h}=n;if(!(Se(a)||Se(o)||Se(l)||Se(d)||Se(u)||Se(h))){a=Math.ceil(a),o=Math.ceil(o),l=Math.ceil(l),d=Math.ceil(d),u=Math.ceil(u),h=Math.ceil(h);var p=a<=1?1:Fr(o/a,0,1,_e),f=a<=1?1:Fr(l/a,0,1,_e),m=d<=1?1:Fr(u/d,0,1,_e),g=d<=1?1:Fr(h/d,0,1,_e);i=cs(i,{$prev_pageview_last_scroll:o,$prev_pageview_last_scroll_percentage:p,$prev_pageview_max_scroll:l,$prev_pageview_max_scroll_percentage:f,$prev_pageview_last_content:u,$prev_pageview_last_content_percentage:m,$prev_pageview_max_content:h,$prev_pageview_max_content_percentage:g})}}return s.pathname&&(i.$prev_pageview_pathname=s.pathname),s.timestamp&&(i.$prev_pageview_duration=(e.getTime()-s.timestamp.getTime())/1e3),i}}var un=function(r){return r.GZipJS="gzip-js",r.Base64="base64",r}({}),or=Uint8Array,vi=Uint16Array,Lc=Uint32Array,Jy=new or([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Zy=new or([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Kv=new or([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),eA=function(r,e){for(var t=new vi(31),s=0;s<31;++s)t[s]=e+=1<<r[s-1];var i=new Lc(t[30]);for(s=1;s<30;++s)for(var n=t[s];n<t[s+1];++n)i[n]=n-t[s]<<5|s;return[t,i]},tA=eA(Jy,2),eD=tA[0],qg=tA[1];eD[28]=258,qg[258]=28;for(var Qv=eA(Zy,0)[1],sA=new vi(32768),Bt=0;Bt<32768;++Bt){var Da=(43690&Bt)>>>1|(21845&Bt)<<1;Da=(61680&(Da=(52428&Da)>>>2|(13107&Da)<<2))>>>4|(3855&Da)<<4,sA[Bt]=((65280&Da)>>>8|(255&Da)<<8)>>>1}var pd=function(r,e,t){for(var s=r.length,i=0,n=new vi(e);i<s;++i)++n[r[i]-1];var a,o=new vi(e);for(i=0;i<e;++i)o[i]=o[i-1]+n[i-1]<<1;for(a=new vi(s),i=0;i<s;++i)a[i]=sA[o[r[i]-1]++]>>>15-r[i];return a},So=new or(288);for(Bt=0;Bt<144;++Bt)So[Bt]=8;for(Bt=144;Bt<256;++Bt)So[Bt]=9;for(Bt=256;Bt<280;++Bt)So[Bt]=7;for(Bt=280;Bt<288;++Bt)So[Bt]=8;var ap=new or(32);for(Bt=0;Bt<32;++Bt)ap[Bt]=5;var tD=pd(So,9),sD=pd(ap,5),iA=function(r){return(r/8>>0)+(7&r&&1)},rA=function(r,e,t){(t==null||t>r.length)&&(t=r.length);var s=new(r instanceof vi?vi:r instanceof Lc?Lc:or)(t-e);return s.set(r.subarray(e,t)),s},en=function(r,e,t){t<<=7&e;var s=e/8>>0;r[s]|=t,r[s+1]|=t>>>8},Al=function(r,e,t){t<<=7&e;var s=e/8>>0;r[s]|=t,r[s+1]|=t>>>8,r[s+2]|=t>>>16},Ef=function(r,e){for(var t=[],s=0;s<r.length;++s)r[s]&&t.push({s,f:r[s]});var i=t.length,n=t.slice();if(!i)return[new or(0),0];if(i==1){var a=new or(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(k,S){return k.f-S.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],d=0,u=1,h=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};u!=i-1;)o=t[t[d].f<t[h].f?d++:h++],l=t[d!=u&&t[d].f<t[h].f?d++:h++],t[u++]={s:-1,f:o.f+l.f,l:o,r:l};var p=n[0].s;for(s=1;s<i;++s)n[s].s>p&&(p=n[s].s);var f=new vi(p+1),m=Hg(t[u-1],f,0);if(m>e){s=0;var g=0,y=m-e,x=1<<y;for(n.sort(function(k,S){return f[S.s]-f[k.s]||k.f-S.f});s<i;++s){var b=n[s].s;if(!(f[b]>e))break;g+=x-(1<<m-f[b]),f[b]=e}for(g>>>=y;g>0;){var w=n[s].s;f[w]<e?g-=1<<e-f[w]++-1:++s}for(;s>=0&&g;--s){var C=n[s].s;f[C]==e&&(--f[C],++g)}m=e}return[new or(f),m]},Hg=function(r,e,t){return r.s==-1?Math.max(Hg(r.l,e,t+1),Hg(r.r,e,t+1)):e[r.s]=t},Jv=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new vi(++e),s=0,i=r[0],n=1,a=function(l){t[s++]=l},o=1;o<=e;++o)if(r[o]==i&&o!=e)++n;else{if(!i&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(i),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(i);n=1,i=r[o]}return[t.subarray(0,s),e]},jl=function(r,e){for(var t=0,s=0;s<e.length;++s)t+=r[s]*e[s];return t},Xg=function(r,e,t){var s=t.length,i=iA(e+2);r[i]=255&s,r[i+1]=s>>>8,r[i+2]=255^r[i],r[i+3]=255^r[i+1];for(var n=0;n<s;++n)r[i+n+4]=t[n];return 8*(i+4+s)},Zv=function(r,e,t,s,i,n,a,o,l,d,u){en(e,u++,t),++i[256];for(var h=Ef(i,15),p=h[0],f=h[1],m=Ef(n,15),g=m[0],y=m[1],x=Jv(p),b=x[0],w=x[1],C=Jv(g),k=C[0],S=C[1],A=new vi(19),T=0;T<b.length;++T)A[31&b[T]]++;for(T=0;T<k.length;++T)A[31&k[T]]++;for(var j=Ef(A,7),_=j[0],M=j[1],P=19;P>4&&!_[Kv[P-1]];--P);var R,D,B,O,F=d+5<<3,I=jl(i,So)+jl(n,ap)+a,J=jl(i,p)+jl(n,g)+a+14+3*P+jl(A,_)+(2*A[16]+3*A[17]+7*A[18]);if(F<=I&&F<=J)return Xg(e,u,r.subarray(l,l+d));if(en(e,u,1+(J<I)),u+=2,J<I){R=pd(p,f),D=p,B=pd(g,y),O=g;var Z=pd(_,M);for(en(e,u,w-257),en(e,u+5,S-1),en(e,u+10,P-4),u+=14,T=0;T<P;++T)en(e,u+3*T,_[Kv[T]]);u+=3*P;for(var E=[b,k],G=0;G<2;++G){var V=E[G];for(T=0;T<V.length;++T){var U=31&V[T];en(e,u,Z[U]),u+=_[U],U>15&&(en(e,u,V[T]>>>5&127),u+=V[T]>>>12)}}}else R=tD,D=So,B=sD,O=ap;for(T=0;T<o;++T)if(s[T]>255){U=s[T]>>>18&31,Al(e,u,R[U+257]),u+=D[U+257],U>7&&(en(e,u,s[T]>>>23&31),u+=Jy[U]);var oe=31&s[T];Al(e,u,B[oe]),u+=O[oe],oe>3&&(Al(e,u,s[T]>>>5&8191),u+=Zy[oe])}else Al(e,u,R[s[T]]),u+=D[s[T]];return Al(e,u,R[256]),u+D[256]},iD=new Lc([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),rD=function(){for(var r=new Lc(256),e=0;e<256;++e){for(var t=e,s=9;--s;)t=(1&t&&3988292384)^t>>>1;r[e]=t}return r}(),nD=function(r,e,t,s,i){return function(n,a,o,l,d,u){var h=n.length,p=new or(l+h+5*(1+Math.floor(h/7e3))+d),f=p.subarray(l,p.length-d),m=0;if(!a||h<8)for(var g=0;g<=h;g+=65535){var y=g+65535;y<h?m=Xg(f,m,n.subarray(g,y)):(f[g]=u,m=Xg(f,m,n.subarray(g,h)))}else{for(var x=iD[a-1],b=x>>>13,w=8191&x,C=(1<<o)-1,k=new vi(32768),S=new vi(C+1),A=Math.ceil(o/3),T=2*A,j=function(Pe){return(n[Pe]^n[Pe+1]<<A^n[Pe+2]<<T)&C},_=new Lc(25e3),M=new vi(288),P=new vi(32),R=0,D=0,B=(g=0,0),O=0,F=0;g<h;++g){var I=j(g),J=32767&g,Z=S[I];if(k[J]=Z,S[I]=J,O<=g){var E=h-g;if((R>7e3||B>24576)&&E>423){m=Zv(n,f,0,_,M,P,D,B,F,g-F,m),B=R=D=0,F=g;for(var G=0;G<286;++G)M[G]=0;for(G=0;G<30;++G)P[G]=0}var V=2,U=0,oe=w,re=J-Z&32767;if(E>2&&I==j(g-re))for(var ne=Math.min(b,E)-1,Ee=Math.min(32767,g),K=Math.min(258,E);re<=Ee&&--oe&&J!=Z;){if(n[g+V]==n[g+V-re]){for(var me=0;me<K&&n[g+me]==n[g+me-re];++me);if(me>V){if(V=me,U=re,me>ne)break;var $=Math.min(re,me-2),Q=0;for(G=0;G<$;++G){var le=g-re+G+32768&32767,ke=le-k[le]+32768&32767;ke>Q&&(Q=ke,Z=le)}}}re+=(J=Z)-(Z=k[J])+32768&32767}if(U){_[B++]=268435456|qg[V]<<18|Qv[U];var de=31&qg[V],ae=31&Qv[U];D+=Jy[de]+Zy[ae],++M[257+de],++P[ae],O=g+V,++R}else _[B++]=n[g],++M[n[g]]}}m=Zv(n,f,u,_,M,P,D,B,F,g-F,m)}return rA(p,0,l+iA(m)+d)}(r,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(r.length)))):12+e.mem,t,s,!0)},Mf=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8};function aD(r,e){e===void 0&&(e={});var t=function(){var o=4294967295;return{p:function(l){for(var d=o,u=0;u<l.length;++u)d=rD[255&d^l[u]]^d>>>8;o=d},d:function(){return 4294967295^o}}}(),s=r.length;t.p(r);var i,n=nD(r,e,10+((i=e).filename&&i.filename.length+1||0),8),a=n.length;return function(o,l){var d=l.filename;if(o[0]=31,o[1]=139,o[2]=8,o[8]=l.level<2?4:l.level==9?2:0,o[9]=3,l.mtime!=0&&Mf(o,4,Math.floor(new Date(l.mtime||Date.now())/1e3)),d){o[3]=8;for(var u=0;u<=d.length;++u)o[u+10]=d.charCodeAt(u)}}(n,e),Mf(n,a-8,t.d()),Mf(n,a-4,s),n}var oD=function(r){var e,t,s,i,n="";for(e=t=0,s=(r=(r+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,i=0;i<s;i++){var a=r.charCodeAt(i),o=null;a<128?t++:o=a>127&&a<2048?String.fromCharCode(a>>6|192,63&a|128):String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128),kr(o)||(t>e&&(n+=r.substring(e,t)),n+=o,e=t=i+1)}return t>e&&(n+=r.substring(e,r.length)),n},cD=!!Mg||!!Eg,e1="text/plain",op=function(r,e,t){var s;t===void 0&&(t=!0);var[i,n]=r.split("?"),a=Re({},e),o=(s=n?.split("&").map(d=>{var u,[h,p]=d.split("="),f=t&&(u=a[h])!==null&&u!==void 0?u:p;return delete a[h],h+"="+f}))!==null&&s!==void 0?s:[],l=SI(a);return l&&o.push(l),i+"?"+o.join("&")},Kl=(r,e)=>JSON.stringify(r,(t,s)=>typeof s=="bigint"?s.toString():s,e),Pf=r=>{var{data:e,compression:t}=r;if(e){if(t===un.GZipJS){var s=aD(function(l,d){var u=l.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(l);for(var h=new or(l.length+(l.length>>>1)),p=0,f=function(x){h[p++]=x},m=0;m<u;++m){if(p+5>h.length){var g=new or(p+8+(u-m<<1));g.set(h),h=g}var y=l.charCodeAt(m);y<128||d?f(y):y<2048?(f(192|y>>>6),f(128|63&y)):y>55295&&y<57344?(f(240|(y=65536+(1047552&y)|1023&l.charCodeAt(++m))>>>18),f(128|y>>>12&63),f(128|y>>>6&63),f(128|63&y)):(f(224|y>>>12),f(128|y>>>6&63),f(128|63&y))}return rA(h,0,p)}(Kl(e)),{mtime:0}),i=new Blob([s],{type:e1});return{contentType:e1,body:i,estimatedSize:i.size}}if(t===un.Base64){var n=function(l){var d,u,h,p,f,m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",g=0,y=0,x="",b=[];if(!l)return l;l=oD(l);do d=(f=l.charCodeAt(g++)<<16|l.charCodeAt(g++)<<8|l.charCodeAt(g++))>>18&63,u=f>>12&63,h=f>>6&63,p=63&f,b[y++]=m.charAt(d)+m.charAt(u)+m.charAt(h)+m.charAt(p);while(g<l.length);switch(x=b.join(""),l.length%3){case 1:x=x.slice(0,-2)+"==";break;case 2:x=x.slice(0,-1)+"="}return x}(Kl(e)),a=(l=>"data="+encodeURIComponent(typeof l=="string"?l:Kl(l)))(n);return{contentType:"application/x-www-form-urlencoded",body:a,estimatedSize:new Blob([a]).size}}var o=Kl(e);return{contentType:"application/json",body:o,estimatedSize:new Blob([o]).size}}},Ah=[];Eg&&Ah.push({transport:"fetch",method:r=>{var e,t,{contentType:s,body:i,estimatedSize:n}=(e=Pf(r))!==null&&e!==void 0?e:{},a=new Headers;Nt(r.headers,function(u,h){a.append(h,u)}),s&&a.append("Content-Type",s);var o=r.url,l=null;if(xv){var d=new xv;l={signal:d.signal,timeout:setTimeout(()=>d.abort(),r.timeout)}}Eg(o,Re({method:r?.method||"GET",headers:a,keepalive:r.method==="POST"&&(n||0)<52428.8,body:i,signal:(t=l)==null?void 0:t.signal},r.fetchOptions)).then(u=>u.text().then(h=>{var p={statusCode:u.status,text:h};if(u.status===200)try{p.json=JSON.parse(h)}catch(f){_e.error(f)}r.callback==null||r.callback(p)})).catch(u=>{_e.error(u),r.callback==null||r.callback({statusCode:0,text:u})}).finally(()=>l?clearTimeout(l.timeout):null)}}),Mg&&Ah.push({transport:"XHR",method:r=>{var e,t=new Mg;t.open(r.method||"GET",r.url,!0);var{contentType:s,body:i}=(e=Pf(r))!==null&&e!==void 0?e:{};Nt(r.headers,function(n,a){t.setRequestHeader(a,n)}),s&&t.setRequestHeader("Content-Type",s),r.timeout&&(t.timeout=r.timeout),r.disableXHRCredentials||(t.withCredentials=!0),t.onreadystatechange=()=>{if(t.readyState===4){var n={statusCode:t.status,text:t.responseText};if(t.status===200)try{n.json=JSON.parse(t.responseText)}catch{}r.callback==null||r.callback(n)}},t.send(i)}}),Fi!=null&&Fi.sendBeacon&&Ah.push({transport:"sendBeacon",method:r=>{var e=op(r.url,{beacon:"1"});try{var t,{contentType:s,body:i}=(t=Pf(r))!==null&&t!==void 0?t:{},n=typeof i=="string"?new Blob([i],{type:s}):i;Fi.sendBeacon(e,n)}catch{}}});var cp=function(r,e){if(!function(t){try{new RegExp(t)}catch{return!1}return!0}(e))return!1;try{return new RegExp(e).test(r)}catch{return!1}};function t1(r,e,t){return Kl({distinct_id:r,userPropertiesToSet:e,userPropertiesToSetOnce:t})}var nA={exact:(r,e)=>e.some(t=>r.some(s=>t===s)),is_not:(r,e)=>e.every(t=>r.every(s=>t!==s)),regex:(r,e)=>e.some(t=>r.some(s=>cp(t,s))),not_regex:(r,e)=>e.every(t=>r.every(s=>!cp(t,s))),icontains:(r,e)=>e.map(Bu).some(t=>r.map(Bu).some(s=>t.includes(s))),not_icontains:(r,e)=>e.map(Bu).every(t=>r.map(Bu).every(s=>!t.includes(s))),gt:(r,e)=>e.some(t=>{var s=parseFloat(t);return!isNaN(s)&&r.some(i=>s>parseFloat(i))}),lt:(r,e)=>e.some(t=>{var s=parseFloat(t);return!isNaN(s)&&r.some(i=>s<parseFloat(i))})},Bu=r=>r.toLowerCase();function aA(r,e){return!r||Object.entries(r).every(t=>{var[s,i]=t,n=e?.[s];if(Se(n)||kr(n))return!1;var a=[String(n)],o=nA[i.operator];return!!o&&o(i.values,a)})}var Nf=rs("[Error tracking]");class lD{constructor(e){var t,s;this.Zt=[],this.ti=new GR([new ZR,new cI,new tI,new eI,new aI,new nI,new iI,new oI],JR()),this._instance=e,this.Zt=(t=(s=this._instance.persistence)==null?void 0:s.get_property(Og))!==null&&t!==void 0?t:[]}onRemoteConfig(e){var t,s,i,n=(t=(s=e.errorTracking)==null?void 0:s.suppressionRules)!==null&&t!==void 0?t:[],a=(i=e.errorTracking)==null?void 0:i.captureExtensionExceptions;this.Zt=n,this._instance.persistence&&this._instance.persistence.register({[Og]:this.Zt,[Pv]:a})}get ii(){var e,t=!!this._instance.get_property(Pv),s=this._instance.config.error_tracking.captureExtensionExceptions;return(e=s??t)!==null&&e!==void 0&&e}buildProperties(e,t){return this.ti.buildFromUnknown(e,{syntheticException:t?.syntheticException,mechanism:{handled:t?.handled}})}sendExceptionEvent(e){var t=e.$exception_list;if(this.ei(t)){if(this.ri(t))return void Nf.info("Skipping exception capture because a suppression rule matched");if(!this.ii&&this.si(t))return void Nf.info("Skipping exception capture because it was thrown by an extension");if(!this._instance.config.error_tracking.__capturePostHogExceptions&&this.ni(t))return void Nf.info("Skipping exception capture because it was thrown by the PostHog SDK")}return this._instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent"})}ri(e){if(e.length===0)return!1;var t=e.reduce((s,i)=>{var{type:n,value:a}=i;return Cs(n)&&n.length>0&&s.$exception_types.push(n),Cs(a)&&a.length>0&&s.$exception_values.push(a),s},{$exception_types:[],$exception_values:[]});return this.Zt.some(s=>{var i=s.values.map(n=>{var a,o=nA[n.operator],l=xt(n.value)?n.value:[n.value],d=(a=t[n.key])!==null&&a!==void 0?a:[];return l.length>0&&o(l,d)});return s.type==="OR"?i.some(Boolean):i.every(Boolean)})}si(e){return e.flatMap(t=>{var s,i;return(s=(i=t.stacktrace)==null?void 0:i.frames)!==null&&s!==void 0?s:[]}).some(t=>t.filename&&t.filename.startsWith("chrome-extension://"))}ni(e){if(e.length>0){var t,s,i,n,a=(t=(s=e[0].stacktrace)==null?void 0:s.frames)!==null&&t!==void 0?t:[],o=a[a.length-1];return(i=o==null||(n=o.filename)==null?void 0:n.includes("posthog.com/static"))!==null&&i!==void 0&&i}return!1}ei(e){return!gt(e)&&xt(e)}}var qi=rs("[FeatureFlags]"),_l=rs("[FeatureFlags]",{debugEnabled:!0}),Rf="$active_feature_flags",Uo="$override_feature_flags",s1="$feature_flag_payloads",El="$override_feature_flag_payloads",i1="$feature_flag_request_id",r1="$feature_flag_evaluated_at",n1=r=>{var e={};for(var[t,s]of Th(r||{}))s&&(e[t]=s);return e},dD=r=>{var e=r.flags;return e?(r.featureFlags=Object.fromEntries(Object.keys(e).map(t=>{var s;return[t,(s=e[t].variant)!==null&&s!==void 0?s:e[t].enabled]})),r.featureFlagPayloads=Object.fromEntries(Object.keys(e).filter(t=>e[t].enabled).filter(t=>{var s;return(s=e[t].metadata)==null?void 0:s.payload}).map(t=>{var s;return[t,(s=e[t].metadata)==null?void 0:s.payload]}))):qi.warn("Using an older version of the feature flags endpoint. Please upgrade your PostHog server to the latest version"),r},uD=function(r){return r.FeatureFlags="feature_flags",r.Recordings="recordings",r}({});class hD{constructor(e){this.oi=!1,this.ai=!1,this.li=!1,this.ui=!1,this.hi=!1,this.di=!1,this.vi=!1,this.ci=!1,this._instance=e,this.featureFlagEventHandlers=[]}fi(){var e,t=(e=this._instance.config.evaluation_contexts)!==null&&e!==void 0?e:this._instance.config.evaluation_environments;return!this._instance.config.evaluation_environments||this._instance.config.evaluation_contexts||this.ci||(qi.warn("evaluation_environments is deprecated. Use evaluation_contexts instead. evaluation_environments will be removed in a future version."),this.ci=!0),t!=null&&t.length?t.filter(s=>{var i=s&&typeof s=="string"&&s.trim().length>0;return i||qi.error("Invalid evaluation context found:",s,"Expected non-empty string"),i}):[]}pi(){return this.fi().length>0}flags(){if(this._instance.config.__preview_remote_config)this.di=!0;else{var e=!this.gi&&(this._instance.config.advanced_disable_feature_flags||this._instance.config.advanced_disable_feature_flags_on_first_load);this.mi({disableFlags:e})}}get hasLoadedFlags(){return this.ai}getFlags(){return Object.keys(this.getFlagVariants())}getFlagsWithDetails(){var e=this._instance.get_property($g),t=this._instance.get_property(Uo),s=this._instance.get_property(El);if(!s&&!t)return e||{};var i=cs({},e||{}),n=[...new Set([...Object.keys(s||{}),...Object.keys(t||{})])];for(var a of n){var o,l,d=i[a],u=t?.[a],h=Se(u)?(o=d?.enabled)!==null&&o!==void 0&&o:!!u,p=Se(u)?d.variant:typeof u=="string"?u:void 0,f=s?.[a],m=Re({},d,{enabled:h,variant:h?p??d?.variant:void 0});h!==d?.enabled&&(m.original_enabled=d?.enabled),p!==d?.variant&&(m.original_variant=d?.variant),f&&(m.metadata=Re({},d?.metadata,{payload:f,original_payload:d==null||(l=d.metadata)==null?void 0:l.payload})),i[a]=m}return this.oi||(qi.warn(" Overriding feature flag details!",{flagDetails:e,overriddenPayloads:s,finalDetails:i}),this.oi=!0),i}getFlagVariants(){var e=this._instance.get_property(nc),t=this._instance.get_property(Uo);if(!t)return e||{};for(var s=cs({},e),i=Object.keys(t),n=0;n<i.length;n++)s[i[n]]=t[i[n]];return this.oi||(qi.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:s}),this.oi=!0),s}getFlagPayloads(){var e=this._instance.get_property(s1),t=this._instance.get_property(El);if(!t)return e||{};for(var s=cs({},e||{}),i=Object.keys(t),n=0;n<i.length;n++)s[i[n]]=t[i[n]];return this.oi||(qi.warn(" Overriding feature flag payloads!",{flagPayloads:e,overriddenPayloads:t,finalPayloads:s}),this.oi=!0),s}reloadFeatureFlags(){this.ui||this._instance.config.advanced_disable_feature_flags||this.gi||(this.gi=setTimeout(()=>{this.mi()},5))}yi(){clearTimeout(this.gi),this.gi=void 0}ensureFlagsLoaded(){this.ai||this.li||this.gi||this.reloadFeatureFlags()}setAnonymousDistinctId(e){this.$anon_distinct_id=e}setReloadingPaused(e){this.ui=e}mi(e){var t;if(this.yi(),!this._instance.O())if(this.li)this.hi=!0;else{var s=this._instance.config.token,i=this._instance.get_property("$device_id"),n={token:s,distinct_id:this._instance.get_distinct_id(),groups:this._instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:Re({},((t=this._instance.persistence)==null?void 0:t.get_initial_props())||{},this._instance.get_property(Xl)||{}),group_properties:this._instance.get_property(Qa)};kr(i)||Se(i)||(n.$device_id=i),(e!=null&&e.disableFlags||this._instance.config.advanced_disable_feature_flags)&&(n.disable_flags=!0),this.pi()&&(n.evaluation_contexts=this.fi());var a=this._instance.config.__preview_remote_config,o=a?"/flags/?v=2":"/flags/?v=2&config=true",l=this._instance.config.advanced_only_evaluate_survey_feature_flags?"&only_evaluate_survey_feature_flags=true":"",d=this._instance.requestRouter.endpointFor("flags",o+l);a&&(n.timezone=ZT()),this.li=!0,this._instance._send_request({method:"POST",url:d,data:n,compression:this._instance.config.disable_compression?void 0:un.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:u=>{var h,p,f=!0;if(u.statusCode===200&&(this.hi||(this.$anon_distinct_id=void 0),f=!1),this.li=!1,this.di||(this.di=!0,this._instance.bi((p=u.json)!==null&&p!==void 0?p:{})),!n.disable_flags||this.hi)if(this.vi=!f,u.json&&(h=u.json.quotaLimited)!=null&&h.includes(uD.FeatureFlags))qi.warn("You have hit your feature flags quota limit, and will not be able to load feature flags until the quota is reset.  Please visit https://posthog.com/docs/billing/limits-alerts to learn more.");else{var m;n.disable_flags||this.receivedFeatureFlags((m=u.json)!==null&&m!==void 0?m:{},f),this.hi&&(this.hi=!1,this.mi())}}})}}getFeatureFlag(e,t){if(t===void 0&&(t={}),this.ai||this.getFlags()&&this.getFlags().length>0){var s=this.getFlagVariants()[e],i=""+s,n=this._instance.get_property(i1)||void 0,a=this._instance.get_property(r1)||void 0,o=this._instance.get_property(Jh)||{};if((t.send_event||!("send_event"in t))&&(!(e in o)||!o[e].includes(i))){var l,d,u,h,p,f,m,g,y;xt(o[e])?o[e].push(i):o[e]=[i],(l=this._instance.persistence)==null||l.register({[Jh]:o});var x=this.getFeatureFlagDetails(e),b={$feature_flag:e,$feature_flag_response:s,$feature_flag_payload:this.getFeatureFlagPayload(e)||null,$feature_flag_request_id:n,$feature_flag_evaluated_at:a,$feature_flag_bootstrapped_response:((d=this._instance.config.bootstrap)==null||(d=d.featureFlags)==null?void 0:d[e])||null,$feature_flag_bootstrapped_payload:((u=this._instance.config.bootstrap)==null||(u=u.featureFlagPayloads)==null?void 0:u[e])||null,$used_bootstrap_value:!this.vi};Se(x==null||(h=x.metadata)==null?void 0:h.version)||(b.$feature_flag_version=x.metadata.version);var w,C=(p=x==null||(f=x.reason)==null?void 0:f.description)!==null&&p!==void 0?p:x==null||(m=x.reason)==null?void 0:m.code;C&&(b.$feature_flag_reason=C),x!=null&&(g=x.metadata)!=null&&g.id&&(b.$feature_flag_id=x.metadata.id),Se(x?.original_variant)&&Se(x?.original_enabled)||(b.$feature_flag_original_response=Se(x.original_variant)?x.original_enabled:x.original_variant),x!=null&&(y=x.metadata)!=null&&y.original_payload&&(b.$feature_flag_original_payload=x==null||(w=x.metadata)==null?void 0:w.original_payload),this._instance.capture("$feature_flag_called",b)}return s}qi.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}getFeatureFlagDetails(e){return this.getFlagsWithDetails()[e]}getFeatureFlagPayload(e){return this.getFlagPayloads()[e]}getRemoteConfigPayload(e,t){var s=this._instance.config.token,i={distinct_id:this._instance.get_distinct_id(),token:s};this.pi()&&(i.evaluation_contexts=this.fi()),this._instance._send_request({method:"POST",url:this._instance.requestRouter.endpointFor("flags","/flags/?v=2&config=true"),data:i,compression:this._instance.config.disable_compression?void 0:un.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:n=>{var a,o=(a=n.json)==null?void 0:a.featureFlagPayloads;t(o?.[e]||void 0)}})}isFeatureEnabled(e,t){if(t===void 0&&(t={}),this.ai||this.getFlags()&&this.getFlags().length>0){var s=this.getFeatureFlag(e,t);return Se(s)?void 0:!!s}qi.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}addFeatureFlagsHandler(e){this.featureFlagEventHandlers.push(e)}removeFeatureFlagsHandler(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter(t=>t!==e)}receivedFeatureFlags(e,t){if(this._instance.persistence){this.ai=!0;var s=this.getFlagVariants(),i=this.getFlagPayloads(),n=this.getFlagsWithDetails();(function(a,o,l,d,u){l===void 0&&(l={}),d===void 0&&(d={}),u===void 0&&(u={});var h=dD(a),p=h.flags,f=h.featureFlags,m=h.featureFlagPayloads;if(f){var g=a.requestId,y=a.evaluatedAt;if(xt(f)){qi.warn("v1 of the feature flags endpoint is deprecated. Please use the latest version.");var x={};if(f)for(var b=0;b<f.length;b++)x[f[b]]=!0;o&&o.register({[Rf]:f,[nc]:x})}else{var w=f,C=m,k=p;a.errorsWhileComputingFlags&&(w=Re({},l,w),C=Re({},d,C),k=Re({},u,k)),o&&o.register(Re({[Rf]:Object.keys(n1(w)),[nc]:w||{},[s1]:C||{},[$g]:k||{}},g?{[i1]:g}:{},y?{[r1]:y}:{}))}}})(e,this._instance.persistence,s,i,n),this.wi(t)}}override(e,t){t===void 0&&(t=!1),qi.warn("override is deprecated. Please use overrideFeatureFlags instead."),this.overrideFeatureFlags({flags:e,suppressWarning:t})}overrideFeatureFlags(e){if(!this._instance.__loaded||!this._instance.persistence)return qi.uninitializedWarning("posthog.featureFlags.overrideFeatureFlags");if(e===!1)return this._instance.persistence.unregister(Uo),this._instance.persistence.unregister(El),this.wi(),_l.info("All overrides cleared");if(e&&typeof e=="object"&&("flags"in e||"payloads"in e)){var t,s=e;if(this.oi=!!((t=s.suppressWarning)!==null&&t!==void 0&&t),"flags"in s){if(s.flags===!1)this._instance.persistence.unregister(Uo),_l.info("Flag overrides cleared");else if(s.flags){if(xt(s.flags)){for(var i={},n=0;n<s.flags.length;n++)i[s.flags[n]]=!0;this._instance.persistence.register({[Uo]:i})}else this._instance.persistence.register({[Uo]:s.flags});_l.info("Flag overrides set",{flags:s.flags})}}return"payloads"in s&&(s.payloads===!1?(this._instance.persistence.unregister(El),_l.info("Payload overrides cleared")):s.payloads&&(this._instance.persistence.register({[El]:s.payloads}),_l.info("Payload overrides set",{payloads:s.payloads}))),void this.wi()}this.wi()}onFeatureFlags(e){if(this.addFeatureFlagsHandler(e),this.ai){var{flags:t,flagVariants:s}=this.xi();e(t,s)}return()=>this.removeFeatureFlagsHandler(e)}updateEarlyAccessFeatureEnrollment(e,t,s){var i,n=(this._instance.get_property(Hl)||[]).find(d=>d.flagKey===e),a={["$feature_enrollment/"+e]:t},o={$feature_flag:e,$feature_enrollment:t,$set:a};n&&(o.$early_access_feature_name=n.name),s&&(o.$feature_enrollment_stage=s),this._instance.capture("$feature_enrollment_update",o),this.setPersonPropertiesForFlags(a,!1);var l=Re({},this.getFlagVariants(),{[e]:t});(i=this._instance.persistence)==null||i.register({[Rf]:Object.keys(n1(l)),[nc]:l}),this.wi()}getEarlyAccessFeatures(e,t,s){t===void 0&&(t=!1);var i=this._instance.get_property(Hl),n=s?"&"+s.map(a=>"stage="+a).join("&"):"";if(i&&!t)return e(i);this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/early_access_features/?token="+this._instance.config.token+n),method:"GET",callback:a=>{var o,l;if(a.json){var d=a.json.earlyAccessFeatures;return(o=this._instance.persistence)==null||o.unregister(Hl),(l=this._instance.persistence)==null||l.register({[Hl]:d}),e(d)}}})}xi(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter(s=>t[s]),flagVariants:Object.keys(t).filter(s=>t[s]).reduce((s,i)=>(s[i]=t[i],s),{})}}wi(e){var{flags:t,flagVariants:s}=this.xi();this.featureFlagEventHandlers.forEach(i=>i(t,s,{errorsLoading:e}))}setPersonPropertiesForFlags(e,t){t===void 0&&(t=!0);var s=this._instance.get_property(Xl)||{};this._instance.register({[Xl]:Re({},s,e)}),t&&this._instance.reloadFeatureFlags()}resetPersonPropertiesForFlags(){this._instance.unregister(Xl)}setGroupPropertiesForFlags(e,t){t===void 0&&(t=!0);var s=this._instance.get_property(Qa)||{};Object.keys(s).length!==0&&Object.keys(s).forEach(i=>{s[i]=Re({},s[i],e[i]),delete e[i]}),this._instance.register({[Qa]:Re({},s,e)}),t&&this._instance.reloadFeatureFlags()}resetGroupPropertiesForFlags(e){if(e){var t=this._instance.get_property(Qa)||{};this._instance.register({[Qa]:Re({},t,{[e]:{}})})}else this._instance.unregister(Qa)}reset(){this.ai=!1,this.li=!1,this.ui=!1,this.hi=!1,this.di=!1,this.vi=!1,this.$anon_distinct_id=void 0,this.yi(),this.oi=!1}}var pD=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"];class If{constructor(e,t){this.R=e,this.props={},this.Ei=!1,this.$i=(s=>{var i="";return s.token&&(i=s.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),s.persistence_name?"ph_"+s.persistence_name:"ph_"+i+"_posthog"})(e),this.Y=this.Si(e),this.load(),e.debug&&_e.info("Persistence loaded",e.persistence,Re({},this.props)),this.update_config(e,e,t),this.save()}isDisabled(){return!!this.ki}Si(e){pD.indexOf(e.persistence.toLowerCase())===-1&&(_e.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=function(i){i===void 0&&(i=[]);var n=[...II,...i];return Re({},Yt,{W:function(a){try{var o={};try{o=Ir.W(a)||{}}catch{}var l=cs(o,JSON.parse(Yt.q(a)||"{}"));return Yt.G(a,l),l}catch{}return null},G:function(a,o,l,d,u,h){try{Yt.G(a,o,void 0,void 0,h);var p={};n.forEach(f=>{o[f]&&(p[f]=o[f])}),Object.keys(p).length&&Ir.G(a,p,l,d,u,h)}catch(f){Yt.B(f)}},V:function(a,o){try{q?.localStorage.removeItem(a),Ir.V(a,o)}catch(l){Yt.B(l)}}})}(e.cookie_persisted_properties||[]),s=e.persistence.toLowerCase();return s==="localstorage"&&Yt.H()?Yt:s==="localstorage+cookie"&&t.H()?t:s==="sessionstorage"&&Bs.H()?Bs:s==="memory"?DI:s==="cookie"?Ir:t.H()?t:Ir}properties(){var e={};return Nt(this.props,function(t,s){if(s===nc&&ks(t))for(var i=Object.keys(t),n=0;n<i.length;n++)e["$feature/"+i[n]]=t[i[n]];else o=s,l=!1,(kr(a=fI)?l:yv&&a.indexOf===yv?a.indexOf(o)!=-1:(Nt(a,function(d){if(l||(l=d===o))return Kh}),l))||(e[s]=t);var a,o,l}),e}load(){if(!this.ki){var e=this.Y.W(this.$i);e&&(this.props=cs({},e))}}save(){this.ki||this.Y.G(this.$i,this.props,this.Pi,this.Ti,this.Ii,this.R.debug)}remove(){this.Y.V(this.$i,!1),this.Y.V(this.$i,!0)}clear(){this.remove(),this.props={}}register_once(e,t,s){if(ks(e)){Se(t)&&(t="None"),this.Pi=Se(s)?this.Ci:s;var i=!1;if(Nt(e,(n,a)=>{this.props.hasOwnProperty(a)&&this.props[a]!==t||(this.props[a]=n,i=!0)}),i)return this.save(),!0}return!1}register(e,t){if(ks(e)){this.Pi=Se(t)?this.Ci:t;var s=!1;if(Nt(e,(i,n)=>{e.hasOwnProperty(n)&&this.props[n]!==i&&(this.props[n]=i,s=!0)}),s)return this.save(),!0}return!1}unregister(e){e in this.props&&(delete this.props[e],this.save())}update_campaign_params(){if(!this.Ei){var e=qT(this.R.custom_campaign_params,this.R.mask_personal_data_properties,this.R.custom_personal_data_properties);rc(Hy(e))||this.register(e),this.Ei=!0}}update_search_keyword(){var e;this.register((e=Ae?.referrer)?XT(e):{})}update_referrer_info(){var e;this.register_once({$referrer:KT(),$referring_domain:Ae!=null&&Ae.referrer&&((e=sp(Ae.referrer))==null?void 0:e.host)||"$direct"},void 0)}set_initial_person_info(){this.props[Gg]||this.props[Wg]||this.register_once({[Zh]:QT(this.R.mask_personal_data_properties,this.R.custom_personal_data_properties)},void 0)}get_initial_props(){var e={};Nt([Wg,Gg],a=>{var o=this.props[a];o&&Nt(o,function(l,d){e["$initial_"+Pg(d)]=l})});var t,s,i=this.props[Zh];if(i){var n=(t=JT(i),s={},Nt(t,function(a,o){s["$initial_"+Pg(o)]=a}),s);cs(e,n)}return e}safe_merge(e){return Nt(this.props,function(t,s){s in e||(e[s]=t)}),e}update_config(e,t,s){if(this.Ci=this.Pi=e.cookie_expiration,this.set_disabled(e.disable_persistence||!!s),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence||!((a,o)=>{if(a.length!==o.length)return!1;var l=[...a].sort(),d=[...o].sort();return l.every((u,h)=>u===d[h])})(e.cookie_persisted_properties||[],t.cookie_persisted_properties||[])){var i=this.Si(e),n=this.props;this.clear(),this.Y=i,this.props=n,this.save()}}set_disabled(e){this.ki=e,this.ki?this.remove():this.save()}set_cross_subdomain(e){e!==this.Ti&&(this.Ti=e,this.remove(),this.save())}set_secure(e){e!==this.Ii&&(this.Ii=e,this.remove(),this.save())}set_event_timer(e,t){var s=this.props[ql]||{};s[e]=t,this.props[ql]=s,this.save()}remove_event_timer(e){var t=(this.props[ql]||{})[e];return Se(t)||(delete this.props[ql][e],this.save()),t}get_property(e){return this.props[e]}set_property(e,t){this.props[e]=t,this.save()}}var a1=rs("[Product Tours]"),Df="ph_product_tours";class fD{constructor(e){this.Ri=null,this.Fi=null,this._instance=e}onRemoteConfig(e){this._instance.persistence&&this._instance.persistence.register({[Rv]:!(e==null||!e.productTours)}),this.loadIfEnabled()}loadIfEnabled(){var e,t;this.Ri||(e=this._instance).config.disable_product_tours||(t=e.persistence)==null||!t.get_property(Rv)||this.it(()=>this.Mi())}it(e){var t,s;(t=We.__PosthogExtensions__)!=null&&t.generateProductTours?e():(s=We.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"product-tours",i=>{i?a1.error("Could not load product tours script",i):e()})}Mi(){var e;!this.Ri&&(e=We.__PosthogExtensions__)!=null&&e.generateProductTours&&(this.Ri=We.__PosthogExtensions__.generateProductTours(this._instance,!0))}getProductTours(e,t){if(t===void 0&&(t=!1),!xt(this.Fi)||t){var s=this._instance.persistence;if(s){var i=s.props[Df];if(xt(i)&&!t)return this.Fi=i,void e(i,{isLoaded:!0})}this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/product_tours/?token="+this._instance.config.token),method:"GET",callback:n=>{var a=n.statusCode;if(a!==200||!n.json){var o="Product Tours API could not be loaded, status: "+a;return a1.error(o),void e([],{isLoaded:!1,error:o})}var l=xt(n.json.product_tours)?n.json.product_tours:[];this.Fi=l,s&&s.register({[Df]:l}),e(l,{isLoaded:!0})}})}else e(this.Fi,{isLoaded:!0})}getActiveProductTours(e){gt(this.Ri)?e([],{isLoaded:!1,error:"Product tours not loaded"}):this.Ri.getActiveProductTours(e)}showProductTour(e){var t;(t=this.Ri)==null||t.showTourById(e)}previewTour(e){this.Ri?this.Ri.previewTour(e):this.it(()=>{var t;this.Mi(),(t=this.Ri)==null||t.previewTour(e)})}dismissProductTour(){var e;(e=this.Ri)==null||e.dismissTour("user_clicked_skip")}nextStep(){var e;(e=this.Ri)==null||e.nextStep()}previousStep(){var e;(e=this.Ri)==null||e.previousStep()}clearCache(){var e;this.Fi=null,(e=this._instance.persistence)==null||e.unregister(Df)}resetTour(e){var t;(t=this.Ri)==null||t.resetTour(e)}resetAllTours(){var e;(e=this.Ri)==null||e.resetAllTours()}cancelPendingTour(e){var t;(t=this.Ri)==null||t.cancelPendingTour(e)}}var Ml=function(r){return r.Activation="events",r.Cancellation="cancelEvents",r}({});(function(r){return r.Button="button",r.Tab="tab",r.Selector="selector",r})({});(function(r){return r.TopLeft="top_left",r.TopRight="top_right",r.TopCenter="top_center",r.MiddleLeft="middle_left",r.MiddleRight="middle_right",r.MiddleCenter="middle_center",r.Left="left",r.Center="center",r.Right="right",r.NextToTrigger="next_to_trigger",r})({});(function(r){return r.Top="top",r.Left="left",r.Right="right",r.Bottom="bottom",r})({});var Ff=function(r){return r.Popover="popover",r.API="api",r.Widget="widget",r.ExternalSurvey="external_survey",r}({});(function(r){return r.Open="open",r.MultipleChoice="multiple_choice",r.SingleChoice="single_choice",r.Rating="rating",r.Link="link",r})({});(function(r){return r.NextQuestion="next_question",r.End="end",r.ResponseBased="response_based",r.SpecificQuestion="specific_question",r})({});(function(r){return r.Once="once",r.Recurring="recurring",r.Always="always",r})({});var Ql=function(r){return r.SHOWN="survey shown",r.DISMISSED="survey dismissed",r.SENT="survey sent",r.ABANDONED="survey abandoned",r}({}),Bf=function(r){return r.SURVEY_ID="$survey_id",r.SURVEY_NAME="$survey_name",r.SURVEY_RESPONSE="$survey_response",r.SURVEY_ITERATION="$survey_iteration",r.SURVEY_ITERATION_START_DATE="$survey_iteration_start_date",r.SURVEY_PARTIALLY_COMPLETED="$survey_partially_completed",r.SURVEY_SUBMISSION_ID="$survey_submission_id",r.SURVEY_QUESTIONS="$survey_questions",r.SURVEY_COMPLETED="$survey_completed",r.PRODUCT_TOUR_ID="$product_tour_id",r.SURVEY_LAST_SEEN_DATE="$survey_last_seen_date",r}({}),Kg=function(r){return r.Popover="popover",r.Inline="inline",r}({}),St=rs("[Surveys]"),oA="seenSurvey_",mD=(r,e)=>{var t="$survey_"+e+"/"+r.id;return r.current_iteration&&r.current_iteration>0&&(t="$survey_"+e+"/"+r.id+"/"+r.current_iteration),t},o1=r=>((e,t)=>{var s=""+e+t.id;return t.current_iteration&&t.current_iteration>0&&(s=""+e+t.id+"_"+t.current_iteration),s})(oA,r),gD=[Ff.Popover,Ff.Widget,Ff.API],yD={ignoreConditions:!1,ignoreDelay:!1,displayType:Kg.Popover};class ex{constructor(){this.Oi={},this.Oi={}}on(e,t){return this.Oi[e]||(this.Oi[e]=[]),this.Oi[e].push(t),()=>{this.Oi[e]=this.Oi[e].filter(s=>s!==t)}}emit(e,t){for(var s of this.Oi[e]||[])s(t);for(var i of this.Oi["*"]||[])i(e,t)}}function Go(r,e,t){if(gt(r))return!1;switch(t){case"exact":return r===e;case"contains":var s=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/_/g,".").replace(/%/g,".*");return new RegExp(s,"i").test(r);case"regex":try{return new RegExp(e).test(r)}catch{return!1}default:return!1}}class xD{constructor(e){this.Ai=new ex,this.Di=(t,s)=>this.ji(t,s)&&this.Li(t,s)&&this.Ni(t,s)&&this.Ui(t,s),this.ji=(t,s)=>s==null||!s.event||t?.event===s?.event,this._instance=e,this.zi=new Set,this.Hi=new Set}init(){var e;if(!Se((e=this._instance)==null?void 0:e.Bi)){var t;(t=this._instance)==null||t.Bi((s,i)=>{this.on(s,i)})}}register(e){var t,s;if(!Se((t=this._instance)==null?void 0:t.Bi)&&(e.forEach(a=>{var o,l;(o=this.Hi)==null||o.add(a),(l=a.steps)==null||l.forEach(d=>{var u;(u=this.zi)==null||u.add(d?.event||"")})}),(s=this._instance)!=null&&s.autocapture)){var i,n=new Set;e.forEach(a=>{var o;(o=a.steps)==null||o.forEach(l=>{l!=null&&l.selector&&n.add(l?.selector)})}),(i=this._instance)==null||i.autocapture.setElementSelectors(n)}}on(e,t){var s;t!=null&&e.length!=0&&(this.zi.has(e)||this.zi.has(t?.event))&&this.Hi&&((s=this.Hi)==null?void 0:s.size)>0&&this.Hi.forEach(i=>{this.qi(t,i)&&this.Ai.emit("actionCaptured",i.name)})}Wi(e){this.onAction("actionCaptured",t=>e(t))}qi(e,t){if(t?.steps==null)return!1;for(var s of t.steps)if(this.Di(e,s))return!0;return!1}onAction(e,t){return this.Ai.on(e,t)}Li(e,t){if(t!=null&&t.url){var s,i=e==null||(s=e.properties)==null?void 0:s.$current_url;if(!i||typeof i!="string"||!Go(i,t.url,t.url_matching||"contains"))return!1}return!0}Ni(e,t){return!!this.Gi(e,t)&&!!this.Vi(e,t)&&!!this.Ji(e,t)}Gi(e,t){var s;if(t==null||!t.href)return!0;var i=this.Ki(e);if(i.length>0)return i.some(o=>Go(o.href,t.href,t.href_matching||"exact"));var n,a=(e==null||(s=e.properties)==null?void 0:s.$elements_chain)||"";return!!a&&Go((n=a.match(/(?::|")href="(.*?)"/))?n[1]:"",t.href,t.href_matching||"exact")}Vi(e,t){var s;if(t==null||!t.text)return!0;var i=this.Ki(e);if(i.length>0)return i.some(d=>Go(d.text,t.text,t.text_matching||"exact")||Go(d.$el_text,t.text,t.text_matching||"exact"));var n,a,o,l=(e==null||(s=e.properties)==null?void 0:s.$elements_chain)||"";return!!l&&(n=function(d){for(var u,h=[],p=/(?::|")text="(.*?)"/g;!gt(u=p.exec(d));)h.includes(u[1])||h.push(u[1]);return h}(l),a=t.text,o=t.text_matching||"exact",n.some(d=>Go(d,a,o)))}Ji(e,t){var s,i;if(t==null||!t.selector)return!0;var n=e==null||(s=e.properties)==null?void 0:s.$element_selectors;if(n!=null&&n.includes(t.selector))return!0;var a=(e==null||(i=e.properties)==null?void 0:i.$elements_chain)||"";if(t.selector_regex&&a)try{return new RegExp(t.selector_regex).test(a)}catch{return!1}return!1}Ki(e){var t;return(e==null||(t=e.properties)==null?void 0:t.$elements)==null?[]:e?.properties.$elements}Ui(e,t){return t==null||!t.properties||t.properties.length===0||aA(t.properties.reduce((s,i)=>{var n=xt(i.value)?i.value.map(String):i.value!=null?[String(i.value)]:[];return s[i.key]={values:n,operator:i.operator||"exact"},s},{}),e?.properties)}}class bD{constructor(e){this._instance=e,this.Yi=new Map,this.Xi=new Map,this.Qi=new Map}Zi(e,t){return!!e&&aA(e.propertyFilters,t?.properties)}te(e,t){var s=new Map;return e.forEach(i=>{var n;(n=i.conditions)==null||(n=n[t])==null||(n=n.values)==null||n.forEach(a=>{if(a!=null&&a.name){var o=s.get(a.name)||[];o.push(i.id),s.set(a.name,o)}})}),s}ie(e,t,s){var i=(s===Ml.Activation?this.Yi:this.Xi).get(e),n=[];return this.ee(a=>{n=a.filter(o=>i?.includes(o.id))}),n.filter(a=>{var o,l=(o=a.conditions)==null||(o=o[s])==null||(o=o.values)==null?void 0:o.find(d=>d.name===e);return this.Zi(l,t)})}register(e){var t;Se((t=this._instance)==null?void 0:t.Bi)||(this.re(e),this.se(e))}se(e){var t=e.filter(s=>{var i,n;return((i=s.conditions)==null?void 0:i.actions)&&((n=s.conditions)==null||(n=n.actions)==null||(n=n.values)==null?void 0:n.length)>0});t.length!==0&&(this.ne==null&&(this.ne=new xD(this._instance),this.ne.init(),this.ne.Wi(s=>{this.onAction(s)})),t.forEach(s=>{var i,n,a,o,l;s.conditions&&(i=s.conditions)!=null&&i.actions&&(n=s.conditions)!=null&&(n=n.actions)!=null&&n.values&&((a=s.conditions)==null||(a=a.actions)==null||(a=a.values)==null?void 0:a.length)>0&&((o=this.ne)==null||o.register(s.conditions.actions.values),(l=s.conditions)==null||(l=l.actions)==null||(l=l.values)==null||l.forEach(d=>{if(d&&d.name){var u=this.Qi.get(d.name);u&&u.push(s.id),this.Qi.set(d.name,u||[s.id])}}))}))}re(e){var t,s=e.filter(n=>{var a,o;return((a=n.conditions)==null?void 0:a.events)&&((o=n.conditions)==null||(o=o.events)==null||(o=o.values)==null?void 0:o.length)>0}),i=e.filter(n=>{var a,o;return((a=n.conditions)==null?void 0:a.cancelEvents)&&((o=n.conditions)==null||(o=o.cancelEvents)==null||(o=o.values)==null?void 0:o.length)>0});(s.length!==0||i.length!==0)&&((t=this._instance)==null||t.Bi((n,a)=>{this.onEvent(n,a)}),this.Yi=this.te(e,Ml.Activation),this.Xi=this.te(e,Ml.Cancellation))}onEvent(e,t){var s,i=this.oe(),n=this.ae(),a=this.le(),o=((s=this._instance)==null||(s=s.persistence)==null?void 0:s.props[n])||[];if(a===e&&t&&o.length>0){var l,d;i.info("event matched, removing item from activated items",{event:e,eventPayload:t,existingActivatedItems:o});var u=(t==null||(l=t.properties)==null?void 0:l.$survey_id)||(t==null||(d=t.properties)==null?void 0:d.$product_tour_id);if(u){var h=o.indexOf(u);h>=0&&(o.splice(h,1),this.ue(o))}}else{if(this.Xi.has(e)){var p=this.ie(e,t,Ml.Cancellation);p.length>0&&(i.info("cancel event matched, cancelling items",{event:e,itemsToCancel:p.map(m=>m.id)}),p.forEach(m=>{var g=o.indexOf(m.id);g>=0&&o.splice(g,1),this.he(m.id)}),this.ue(o))}if(this.Yi.has(e)){i.info("event name matched",{event:e,eventPayload:t,items:this.Yi.get(e)});var f=this.ie(e,t,Ml.Activation);this.ue(o.concat(f.map(m=>m.id)||[]))}}}onAction(e){var t,s=this.ae(),i=((t=this._instance)==null||(t=t.persistence)==null?void 0:t.props[s])||[];this.Qi.has(e)&&this.ue(i.concat(this.Qi.get(e)||[]))}ue(e){var t,s=this.oe(),i=this.ae(),n=[...new Set(e)].filter(a=>!this.de(a));s.info("updating activated items",{activatedItems:n}),(t=this._instance)==null||(t=t.persistence)==null||t.register({[i]:n})}getActivatedIds(){var e,t=this.ae(),s=(e=this._instance)==null||(e=e.persistence)==null?void 0:e.props[t];return s||[]}getEventToItemsMap(){return this.Yi}ve(){return this.ne}}class vD extends bD{constructor(e){super(e)}ae(){return"$surveys_activated"}le(){return Ql.SHOWN}ee(e){var t;(t=this._instance)==null||t.getSurveys(e)}he(e){var t;(t=this._instance)==null||t.cancelPendingSurvey(e)}oe(){return St}de(){return!1}getSurveys(){return this.getActivatedIds()}getEventToSurveys(){return this.getEventToItemsMap()}}class wD{constructor(e){this.ce=void 0,this._surveyManager=null,this.fe=!1,this.pe=[],this.ge=null,this._instance=e,this._surveyEventReceiver=null}onRemoteConfig(e){if(!this._instance.config.disable_surveys){var t=e.surveys;if(gt(t))return St.warn("Flags not loaded yet. Not loading surveys.");var s=xt(t);this.ce=s?t.length>0:t,St.info("flags response received, isSurveysEnabled: "+this.ce),this.loadIfEnabled()}}reset(){localStorage.removeItem("lastSeenSurveyDate");for(var e=[],t=0;t<localStorage.length;t++){var s=localStorage.key(t);(s!=null&&s.startsWith(oA)||s!=null&&s.startsWith("inProgressSurvey_"))&&e.push(s)}e.forEach(i=>localStorage.removeItem(i))}loadIfEnabled(){if(!this._surveyManager)if(this.fe)St.info("Already initializing surveys, skipping...");else if(this._instance.config.disable_surveys)St.info("Disabled. Not loading surveys.");else if(this._instance.config.cookieless_mode&&this._instance.consent.isOptedOut())St.info("Not loading surveys in cookieless mode without consent.");else{var e=We?.__PosthogExtensions__;if(e){if(!Se(this.ce)||this._instance.config.advanced_enable_surveys){var t=this.ce||this._instance.config.advanced_enable_surveys;this.fe=!0;try{var s=e.generateSurveys;if(s)return void this._e(s,t);var i=e.loadExternalDependency;if(!i)return void this.me("PostHog loadExternalDependency extension not found.");i(this._instance,"surveys",n=>{n||!e.generateSurveys?this.me("Could not load surveys script",n):this._e(e.generateSurveys,t)})}catch(n){throw this.me("Error initializing surveys",n),n}finally{this.fe=!1}}}else St.error("PostHog Extensions not found.")}}_e(e,t){this._surveyManager=e(this._instance,t),this._surveyEventReceiver=new vD(this._instance),St.info("Surveys loaded successfully"),this.ye({isLoaded:!0})}me(e,t){St.error(e,t),this.ye({isLoaded:!1,error:e})}onSurveysLoaded(e){return this.pe.push(e),this._surveyManager&&this.ye({isLoaded:!0}),()=>{this.pe=this.pe.filter(t=>t!==e)}}getSurveys(e,t){if(t===void 0&&(t=!1),this._instance.config.disable_surveys)return St.info("Disabled. Not loading surveys."),e([]);var s,i=this._instance.get_property(zg);if(i&&!t)return e(i,{isLoaded:!0});typeof Promise<"u"&&this.ge?this.ge.then(n=>{var{surveys:a,context:o}=n;return e(a,o)}):(typeof Promise<"u"&&(this.ge=new Promise(n=>{s=n})),this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/surveys/?token="+this._instance.config.token),method:"GET",timeout:this._instance.config.surveys_request_timeout_ms,callback:n=>{var a;this.ge=null;var o=n.statusCode;if(o!==200||!n.json){var l="Surveys API could not be loaded, status: "+o;St.error(l);var d={isLoaded:!1,error:l};return e([],d),void(s==null||s({surveys:[],context:d}))}var u,h=n.json.surveys||[],p=h.filter(m=>function(g){return!(!g.start_date||g.end_date)}(m)&&(function(g){var y;return!((y=g.conditions)==null||(y=y.events)==null||(y=y.values)==null||!y.length)}(m)||function(g){var y;return!((y=g.conditions)==null||(y=y.actions)==null||(y=y.values)==null||!y.length)}(m)));p.length>0&&((u=this._surveyEventReceiver)==null||u.register(p)),(a=this._instance.persistence)==null||a.register({[zg]:h});var f={isLoaded:!0};e(h,f),s?.({surveys:h,context:f})}}))}ye(e){for(var t of this.pe)try{if(!e.isLoaded)return t([],e);this.getSurveys(t)}catch(s){St.error("Error in survey callback",s)}}getActiveMatchingSurveys(e,t){if(t===void 0&&(t=!1),!gt(this._surveyManager))return this._surveyManager.getActiveMatchingSurveys(e,t);St.warn("init was not called")}be(e){var t=null;return this.getSurveys(s=>{var i;t=(i=s.find(n=>n.id===e))!==null&&i!==void 0?i:null}),t}we(e){if(gt(this._surveyManager))return{eligible:!1,reason:"SDK is not enabled or survey functionality is not yet loaded"};var t=typeof e=="string"?this.be(e):e;return t?this._surveyManager.checkSurveyEligibility(t):{eligible:!1,reason:"Survey not found"}}canRenderSurvey(e){if(gt(this._surveyManager))return St.warn("init was not called"),{visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"};var t=this.we(e);return{visible:t.eligible,disabledReason:t.reason}}canRenderSurveyAsync(e,t){return gt(this._surveyManager)?(St.warn("init was not called"),Promise.resolve({visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"})):new Promise(s=>{this.getSurveys(i=>{var n,a=(n=i.find(l=>l.id===e))!==null&&n!==void 0?n:null;if(a){var o=this.we(a);s({visible:o.eligible,disabledReason:o.reason})}else s({visible:!1,disabledReason:"Survey not found"})},t)})}renderSurvey(e,t,s){var i;if(gt(this._surveyManager))St.warn("init was not called");else{var n=typeof e=="string"?this.be(e):e;if(n!=null&&n.id)if(gD.includes(n.type)){var a=Ae?.querySelector(t);if(a)return(i=n.appearance)!=null&&i.surveyPopupDelaySeconds?(St.info("Rendering survey "+n.id+" with delay of "+n.appearance.surveyPopupDelaySeconds+" seconds"),void setTimeout(()=>{var o,l;St.info("Rendering survey "+n.id+" with delay of "+((o=n.appearance)==null?void 0:o.surveyPopupDelaySeconds)+" seconds"),(l=this._surveyManager)==null||l.renderSurvey(n,a,s),St.info("Survey "+n.id+" rendered")},1e3*n.appearance.surveyPopupDelaySeconds)):void this._surveyManager.renderSurvey(n,a,s);St.warn("Survey element not found")}else St.warn("Surveys of type "+n.type+" cannot be rendered in the app");else St.warn("Survey not found")}}displaySurvey(e,t){var s;if(gt(this._surveyManager))St.warn("init was not called");else{var i=this.be(e);if(i){var n=i;if((s=i.appearance)!=null&&s.surveyPopupDelaySeconds&&t.ignoreDelay&&(n=Re({},i,{appearance:Re({},i.appearance,{surveyPopupDelaySeconds:0})})),t.displayType!==Kg.Popover&&t.initialResponses&&St.warn("initialResponses is only supported for popover surveys. prefill will not be applied."),t.ignoreConditions===!1){var a=this.canRenderSurvey(i);if(!a.visible)return void St.warn("Survey is not eligible to be displayed: ",a.disabledReason)}t.displayType!==Kg.Inline?this._surveyManager.handlePopoverSurvey(n,t):this.renderSurvey(n,t.selector,t.properties)}else St.warn("Survey not found")}}cancelPendingSurvey(e){gt(this._surveyManager)?St.warn("init was not called"):this._surveyManager.cancelSurvey(e)}handlePageUnload(){var e;(e=this._surveyManager)==null||e.handlePageUnload()}}var tn=rs("[Conversations]");class kD{constructor(e){this.xe=void 0,this._conversationsManager=null,this.Ee=!1,this.$e=null,this._instance=e}onRemoteConfig(e){if(!this._instance.config.disable_conversations){var t=e.conversations;gt(t)||(mn(t)?this.xe=t:(this.xe=t.enabled,this.$e=t),this.loadIfEnabled())}}reset(){var e;(e=this._conversationsManager)==null||e.reset(),this._conversationsManager=null,this.xe=void 0,this.$e=null}loadIfEnabled(){if(!this._conversationsManager&&!this.Ee&&!(this._instance.config.disable_conversations||this._instance.config.cookieless_mode&&this._instance.consent.isOptedOut())){var e=We?.__PosthogExtensions__;if(e&&!Se(this.xe)&&this.xe)if(this.$e&&this.$e.token){this.Ee=!0;try{var t=e.initConversations;if(t)return this.Se(t),void(this.Ee=!1);var s=e.loadExternalDependency;if(!s)return void this.ke("PostHog loadExternalDependency extension not found.");s(this._instance,"conversations",i=>{i||!e.initConversations?this.ke("Could not load conversations script",i):this.Se(e.initConversations),this.Ee=!1})}catch(i){this.ke("Error initializing conversations",i),this.Ee=!1}}else tn.error("Conversations enabled but missing token in remote config.")}}Se(e){if(this.$e)try{this._conversationsManager=e(this.$e,this._instance),tn.info("Conversations loaded successfully")}catch(t){this.ke("Error completing conversations initialization",t)}else tn.error("Cannot complete initialization: remote config is null")}ke(e,t){tn.error(e,t),this._conversationsManager=null,this.Ee=!1}show(){this._conversationsManager?this._conversationsManager.show():tn.warn("Conversations not loaded yet.")}hide(){this._conversationsManager&&this._conversationsManager.hide()}isAvailable(){return this.xe===!0&&!kr(this._conversationsManager)}isVisible(){var e,t;return(e=(t=this._conversationsManager)==null?void 0:t.isVisible())!==null&&e!==void 0&&e}sendMessage(e,t,s){var i=this;return ic(function*(){return i._conversationsManager?i._conversationsManager.sendMessage(e,t,s):(tn.warn("Conversations not available yet."),null)})()}getMessages(e,t){var s=this;return ic(function*(){return s._conversationsManager?s._conversationsManager.getMessages(e,t):(tn.warn("Conversations not available yet."),null)})()}markAsRead(e){var t=this;return ic(function*(){return t._conversationsManager?t._conversationsManager.markAsRead(e):(tn.warn("Conversations not available yet."),null)})()}getTickets(e){var t=this;return ic(function*(){return t._conversationsManager?t._conversationsManager.getTickets(e):(tn.warn("Conversations not available yet."),null)})()}getCurrentTicketId(){var e,t;return(e=(t=this._conversationsManager)==null?void 0:t.getCurrentTicketId())!==null&&e!==void 0?e:null}getWidgetSessionId(){var e,t;return(e=(t=this._conversationsManager)==null?void 0:t.getWidgetSessionId())!==null&&e!==void 0?e:null}}class CD{constructor(e){var t;this.Pe=!1,this.Te=!1,this._instance=e,this._instance&&(t=this._instance.config.logs)!=null&&t.captureConsoleLogs&&(this.Pe=!0)}onRemoteConfig(e){var t,s=(t=e.logs)==null?void 0:t.captureConsoleLogs;!gt(s)&&s&&(this.Pe=!0,this.loadIfEnabled())}reset(){}loadIfEnabled(){if(this.Pe&&!this.Te){var e=rs("[logs]"),t=We?.__PosthogExtensions__;if(t){var s=t.loadExternalDependency;s?s(this._instance,"logs",i=>{var n;i||(n=t.logs)==null||!n.initializeLogs?e.error("Could not load logs script",i):(t.logs.initializeLogs(this._instance),this.Te=!0)}):e.error("PostHog loadExternalDependency extension not found.")}else e.error("PostHog Extensions not found.")}}}var c1=rs("[RateLimiter]");class SD{constructor(e){this.serverLimits={},this.lastEventRateLimited=!1,this.checkForLimiting=t=>{var s=t.text;if(s&&s.length)try{(JSON.parse(s).quota_limited||[]).forEach(i=>{c1.info((i||"events")+" is quota limited."),this.serverLimits[i]=new Date().getTime()+6e4})}catch(i){return void c1.warn('could not rate limit - continuing. Error: "'+i?.message+'"',{text:s})}},this.instance=e,this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}get captureEventsPerSecond(){var e;return((e=this.instance.config.rate_limiting)==null?void 0:e.events_per_second)||10}get captureEventsBurstLimit(){var e;return Math.max(((e=this.instance.config.rate_limiting)==null?void 0:e.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond)}clientRateLimitContext(e){var t,s,i;e===void 0&&(e=!1);var{captureEventsBurstLimit:n,captureEventsPerSecond:a}=this,o=new Date().getTime(),l=(t=(s=this.instance.persistence)==null?void 0:s.get_property(Ug))!==null&&t!==void 0?t:{tokens:n,last:o};l.tokens+=(o-l.last)/1e3*a,l.last=o,l.tokens>n&&(l.tokens=n);var d=l.tokens<1;return d||e||(l.tokens=Math.max(0,l.tokens-1)),!d||this.lastEventRateLimited||e||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to "+a+" events per second and "+n+" events burst limit."},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=d,(i=this.instance.persistence)==null||i.set_property(Ug,l),{isRateLimited:d,remainingTokens:l.tokens}}isServerRateLimited(e){var t=this.serverLimits[e||"events"]||!1;return t!==!1&&new Date().getTime()<t}}var Fa=rs("[RemoteConfig]");class TD{constructor(e){this._instance=e}get remoteConfig(){var e;return(e=We._POSTHOG_REMOTE_CONFIG)==null||(e=e[this._instance.config.token])==null?void 0:e.config}Ie(e){var t,s;(t=We.__PosthogExtensions__)!=null&&t.loadExternalDependency?(s=We.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,"remote-config",()=>e(this.remoteConfig)):(Fa.error("PostHog Extensions not found. Cannot load remote config."),e())}Ce(e){this._instance._send_request({method:"GET",url:this._instance.requestRouter.endpointFor("assets","/array/"+this._instance.config.token+"/config"),callback:t=>{e(t.json)}})}load(){try{if(this.remoteConfig)return Fa.info("Using preloaded remote config",this.remoteConfig),void this.bi(this.remoteConfig);if(this._instance.O())return void Fa.warn("Remote config is disabled. Falling back to local config.");this.Ie(e=>{if(!e)return Fa.info("No config found after loading remote JS config. Falling back to JSON."),void this.Ce(t=>{this.bi(t)});this.bi(e)})}catch(e){Fa.error("Error loading remote config",e)}}bi(e){e?this._instance.config.__preview_remote_config?(this._instance.bi(e),e.hasFeatureFlags!==!1&&this._instance.featureFlags.ensureFlagsLoaded()):Fa.info("__preview_remote_config is disabled. Logging config instead",e):Fa.error("Failed to fetch remote config from PostHog.")}}var Qg=3e3;class AD{constructor(e,t){this.Re=!0,this.Fe=[],this.Me=Fr(t?.flush_interval_ms||Qg,250,5e3,_e.createLogger("flush interval"),Qg),this.Oe=e}enqueue(e){this.Fe.push(e),this.Ae||this.De()}unload(){this.je();var e=this.Fe.length>0?this.Le():{},t=Object.values(e);[...t.filter(s=>s.url.indexOf("/e")===0),...t.filter(s=>s.url.indexOf("/e")!==0)].map(s=>{this.Oe(Re({},s,{transport:"sendBeacon"}))})}enable(){this.Re=!1,this.De()}De(){var e=this;this.Re||(this.Ae=setTimeout(()=>{if(this.je(),this.Fe.length>0){var t=this.Le(),s=function(){var n=t[i],a=new Date().getTime();n.data&&xt(n.data)&&Nt(n.data,o=>{o.offset=Math.abs(o.timestamp-a),delete o.timestamp}),e.Oe(n)};for(var i in t)s()}},this.Me))}je(){clearTimeout(this.Ae),this.Ae=void 0}Le(){var e={};return Nt(this.Fe,t=>{var s,i=t,n=(i?i.batchKey:null)||i.url;Se(e[n])&&(e[n]=Re({},i,{data:[]})),(s=e[n].data)==null||s.push(i.data)}),this.Fe=[],e}}var jD=["retriesPerformedSoFar"];class _D{constructor(e){this.Ne=!1,this.Ue=3e3,this.Fe=[],this._instance=e,this.Fe=[],this.ze=!0,!Se(q)&&"onLine"in q.navigator&&(this.ze=q.navigator.onLine,this.He=()=>{this.ze=!0,this.Lt()},this.Be=()=>{this.ze=!1},ys(q,"online",this.He),ys(q,"offline",this.Be))}get length(){return this.Fe.length}retriableRequest(e){var{retriesPerformedSoFar:t}=e,s=sT(e,jD);ec(t)&&(s.url=op(s.url,{retry_count:t})),this._instance._send_request(Re({},s,{callback:i=>{i.statusCode!==200&&(i.statusCode<400||i.statusCode>=500)&&(t??0)<10?this.qe(Re({retriesPerformedSoFar:t},s)):s.callback==null||s.callback(i)}}))}qe(e){var t=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=t+1;var s=function(a){var o=3e3*Math.pow(2,a),l=o/2,d=Math.min(18e5,o),u=(Math.random()-.5)*(d-l);return Math.ceil(d+u)}(t),i=Date.now()+s;this.Fe.push({retryAt:i,requestOptions:e});var n="Enqueued failed request for retry in "+s;navigator.onLine||(n+=" (Browser is offline)"),_e.warn(n),this.Ne||(this.Ne=!0,this.We())}We(){if(this.Ge&&clearTimeout(this.Ge),this.Fe.length===0)return this.Ne=!1,void(this.Ge=void 0);this.Ge=setTimeout(()=>{this.ze&&this.Fe.length>0&&this.Lt(),this.We()},this.Ue)}Lt(){var e=Date.now(),t=[],s=this.Fe.filter(n=>n.retryAt<e||(t.push(n),!1));if(this.Fe=t,s.length>0)for(var{requestOptions:i}of s)this.retriableRequest(i)}unload(){for(var{requestOptions:e}of(this.Ge&&(clearTimeout(this.Ge),this.Ge=void 0),this.Ne=!1,Se(q)||(this.He&&(q.removeEventListener("online",this.He),this.He=void 0),this.Be&&(q.removeEventListener("offline",this.Be),this.Be=void 0)),this.Fe))try{this._instance._send_request(Re({},e,{transport:"sendBeacon"}))}catch(t){_e.error(t)}this.Fe=[]}}class ED{constructor(e){this.Ve=()=>{var t,s,i,n;this.Je||(this.Je={});var a=this.scrollElement(),o=this.scrollY(),l=a?Math.max(0,a.scrollHeight-a.clientHeight):0,d=o+(a?.clientHeight||0),u=a?.scrollHeight||0;this.Je.lastScrollY=Math.ceil(o),this.Je.maxScrollY=Math.max(o,(t=this.Je.maxScrollY)!==null&&t!==void 0?t:0),this.Je.maxScrollHeight=Math.max(l,(s=this.Je.maxScrollHeight)!==null&&s!==void 0?s:0),this.Je.lastContentY=d,this.Je.maxContentY=Math.max(d,(i=this.Je.maxContentY)!==null&&i!==void 0?i:0),this.Je.maxContentHeight=Math.max(u,(n=this.Je.maxContentHeight)!==null&&n!==void 0?n:0)},this._instance=e}getContext(){return this.Je}resetContext(){var e=this.Je;return setTimeout(this.Ve,0),e}startMeasuringScrollPosition(){ys(q,"scroll",this.Ve,{capture:!0}),ys(q,"scrollend",this.Ve,{capture:!0}),ys(q,"resize",this.Ve)}scrollElement(){if(!this._instance.config.scroll_root_selector)return q?.document.documentElement;var e=xt(this._instance.config.scroll_root_selector)?this._instance.config.scroll_root_selector:[this._instance.config.scroll_root_selector];for(var t of e){var s=q?.document.querySelector(t);if(s)return s}}scrollY(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return q&&(q.scrollY||q.pageYOffset||q.document.documentElement.scrollTop)||0}scrollX(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return q&&(q.scrollX||q.pageXOffset||q.document.documentElement.scrollLeft)||0}}var MD=r=>QT(r?.config.mask_personal_data_properties,r?.config.custom_personal_data_properties);class l1{constructor(e,t,s,i){this.Ke=n=>{var a=this.Ye();if(!a||a.sessionId!==n){var o={sessionId:n,props:this.Xe(this._instance)};this.Qe.register({[Vg]:o})}},this._instance=e,this.Ze=t,this.Qe=s,this.Xe=i||MD,this.Ze.onSessionId(this.Ke)}Ye(){return this.Qe.props[Vg]}getSetOnceProps(){var e,t=(e=this.Ye())==null?void 0:e.props;return t?"r"in t?JT(t):{$referring_domain:t.referringDomain,$pathname:t.initialPathName,utm_source:t.utm_source,utm_campaign:t.utm_campaign,utm_medium:t.utm_medium,utm_content:t.utm_content,utm_term:t.utm_term}:{}}getSessionProps(){var e={};return Nt(Hy(this.getSetOnceProps()),(t,s)=>{s==="$current_url"&&(s="url"),e["$session_entry_"+Pg(s)]=t}),e}}var Lf=rs("[SessionId]");class d1{on(e,t){return this.tr.on(e,t)}constructor(e,t,s){var i;if(this.ir=[],this.er=void 0,this.tr=new ex,this.rr=(u,h)=>!(!ec(u)||!ec(h))&&Math.abs(u-h)>this.sessionTimeoutMs,!e.persistence)throw new Error("SessionIdManager requires a PostHogPersistence instance");if(e.config.cookieless_mode==="always")throw new Error('SessionIdManager cannot be used with cookieless_mode="always"');this.R=e.config,this.Qe=e.persistence,this.sr=void 0,this.nr=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this.ar=t||Kn,this.lr=s||Kn;var n=this.R.persistence_name||this.R.token,a=this.R.session_idle_timeout_seconds||1800;if(this._sessionTimeoutMs=1e3*Fr(a,60,36e3,Lf.createLogger("session_idle_timeout_seconds"),1800),e.register({$configured_session_timeout_ms:this._sessionTimeoutMs}),this.ur(),this.hr="ph_"+n+"_window_id",this.dr="ph_"+n+"_primary_window_exists",this.vr()){var o=Bs.W(this.hr),l=Bs.W(this.dr);o&&!l?this.sr=o:Bs.V(this.hr),Bs.G(this.dr,!0)}if((i=this.R.bootstrap)!=null&&i.sessionID)try{var d=(u=>{var h=u.replace(/-/g,"");if(h.length!==32)throw new Error("Not a valid UUID");if(h[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(h.substring(0,12),16)})(this.R.bootstrap.sessionID);this.cr(this.R.bootstrap.sessionID,new Date().getTime(),d)}catch(u){Lf.error("Invalid sessionID in bootstrap",u)}this.pr()}get sessionTimeoutMs(){return this._sessionTimeoutMs}onSessionId(e){return Se(this.ir)&&(this.ir=[]),this.ir.push(e),this.nr&&e(this.nr,this.sr),()=>{this.ir=this.ir.filter(t=>t!==e)}}vr(){return this.R.persistence!=="memory"&&!this.Qe.ki&&Bs.H()}gr(e){e!==this.sr&&(this.sr=e,this.vr()&&Bs.G(this.hr,e))}_r(){return this.sr?this.sr:this.vr()?Bs.W(this.hr):null}cr(e,t,s){e===this.nr&&t===this._sessionActivityTimestamp&&s===this._sessionStartTimestamp||(this._sessionStartTimestamp=s,this._sessionActivityTimestamp=t,this.nr=e,this.Qe.register({[Qh]:[t,e,s]}))}mr(){var e=this.Qe.props[Qh];return xt(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}resetSessionId(){this.cr(null,null,null)}destroy(){clearTimeout(this.yr),this.yr=void 0,this.er&&q&&(q.removeEventListener("beforeunload",this.er,{capture:!1}),this.er=void 0),this.ir=[]}pr(){this.er=()=>{this.vr()&&Bs.V(this.dr)},ys(q,"beforeunload",this.er,{capture:!1})}checkAndGetSessionAndWindowId(e,t){if(e===void 0&&(e=!1),t===void 0&&(t=null),this.R.cookieless_mode==="always")throw new Error('checkAndGetSessionAndWindowId should not be called with cookieless_mode="always"');var s=t||new Date().getTime(),[i,n,a]=this.mr(),o=this._r(),l=ec(a)&&Math.abs(s-a)>864e5,d=!1,u=!n,h=!u&&!e&&this.rr(s,i);u||h||l?(n=this.ar(),o=this.lr(),Lf.info("new session ID generated",{sessionId:n,windowId:o,changeReason:{noSessionId:u,activityTimeout:h,sessionPastMaximumLength:l}}),a=s,d=!0):o||(o=this.lr(),d=!0);var p=ec(i)&&e&&!l?i:s,f=ec(a)?a:new Date().getTime();return this.gr(o),this.cr(n,p,f),e||this.ur(),d&&this.ir.forEach(m=>m(n,o,d?{noSessionId:u,activityTimeout:h,sessionPastMaximumLength:l}:void 0)),{sessionId:n,windowId:o,sessionStartTimestamp:f,changeReason:d?{noSessionId:u,activityTimeout:h,sessionPastMaximumLength:l}:void 0,lastActivityTimestamp:i}}ur(){clearTimeout(this.yr),this.yr=setTimeout(()=>{var[e]=this.mr();if(this.rr(new Date().getTime(),e)){var t=this.nr;this.resetSessionId(),this.tr.emit("forcedIdleReset",{idleSessionId:t})}},1.1*this.sessionTimeoutMs)}}var PD=["$set_once","$set"],Dn=rs("[SiteApps]");class ND{constructor(e){this._instance=e,this.br=[],this.apps={}}get isEnabled(){return!!this._instance.config.opt_in_site_apps}wr(e,t){if(t){var s=this.globalsForEvent(t);this.br.push(s),this.br.length>1e3&&(this.br=this.br.slice(10))}}get siteAppLoaders(){var e;return(e=We._POSTHOG_REMOTE_CONFIG)==null||(e=e[this._instance.config.token])==null?void 0:e.siteApps}init(){if(this.isEnabled){var e=this._instance.Bi(this.wr.bind(this));this.Er=()=>{e(),this.br=[],this.Er=void 0}}}globalsForEvent(e){var t,s,i,n,a,o,l;if(!e)throw new Error("Event payload is required");var d={},u=this._instance.get_property("$groups")||[],h=this._instance.get_property("$stored_group_properties")||{};for(var[p,f]of Object.entries(h))d[p]={id:u[p],type:p,properties:f};var{$set_once:m,$set:g}=e;return{event:Re({},sT(e,PD),{properties:Re({},e.properties,g?{$set:Re({},(t=(s=e.properties)==null?void 0:s.$set)!==null&&t!==void 0?t:{},g)}:{},m?{$set_once:Re({},(i=(n=e.properties)==null?void 0:n.$set_once)!==null&&i!==void 0?i:{},m)}:{}),elements_chain:(a=(o=e.properties)==null?void 0:o.$elements_chain)!==null&&a!==void 0?a:"",distinct_id:(l=e.properties)==null?void 0:l.distinct_id}),person:{properties:this._instance.get_property("$stored_person_properties")},groups:d}}setupSiteApp(e){var t=this.apps[e.id],s=()=>{var o;!t.errored&&this.br.length&&(Dn.info("Processing "+this.br.length+" events for site app with id "+e.id),this.br.forEach(l=>t.processEvent==null?void 0:t.processEvent(l)),t.processedBuffer=!0),Object.values(this.apps).every(l=>l.processedBuffer||l.errored)&&((o=this.Er)==null||o.call(this))},i=!1,n=o=>{t.errored=!o,t.loaded=!0,Dn.info("Site app with id "+e.id+" "+(o?"loaded":"errored")),i&&s()};try{var{processEvent:a}=e.init({posthog:this._instance,callback:o=>{n(o)}});a&&(t.processEvent=a),i=!0}catch(o){Dn.error("Error while initializing PostHog app with config id "+e.id,o),n(!1)}if(i&&t.loaded)try{s()}catch(o){Dn.error("Error while processing buffered events PostHog app with config id "+e.id,o),t.errored=!0}}$r(){var e=this.siteAppLoaders||[];for(var t of e)this.apps[t.id]={id:t.id,loaded:!1,errored:!1,processedBuffer:!1};for(var s of e)this.setupSiteApp(s)}Sr(e){if(Object.keys(this.apps).length!==0){var t=this.globalsForEvent(e);for(var s of Object.values(this.apps))try{s.processEvent==null||s.processEvent(t)}catch(i){Dn.error("Error while processing event "+e.event+" for site app "+s.id,i)}}}onRemoteConfig(e){var t,s,i,n=this;if((t=this.siteAppLoaders)!=null&&t.length)return this.isEnabled?(this.$r(),void this._instance.on("eventCaptured",d=>this.Sr(d))):void Dn.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.');if((s=this.Er)==null||s.call(this),(i=e.siteApps)!=null&&i.length)if(this.isEnabled){var a=function(d){var u;We["__$$ph_site_app_"+d]=n._instance,(u=We.__PosthogExtensions__)==null||u.loadSiteApp==null||u.loadSiteApp(n._instance,l,h=>{if(h)return Dn.error("Error while initializing PostHog app with config id "+d,h)})};for(var{id:o,url:l}of e.siteApps)a(o)}else Dn.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}var cA=function(r,e){if(!r)return!1;var t=r.userAgent;if(t&&vv(t,e))return!0;try{var s=r?.userAgentData;if(s!=null&&s.brands&&s.brands.some(i=>vv(i?.brand,e)))return!0}catch{}return!!r.webdriver},Jl=function(r){return r.US="us",r.EU="eu",r.CUSTOM="custom",r}({}),u1="i.posthog.com";class RD{constructor(e){this.kr={},this.instance=e}get apiHost(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}get flagsApiHost(){var e=this.instance.config.flags_api_host;return e?e.trim().replace(/\/$/,""):this.apiHost}get uiHost(){var e,t=(e=this.instance.config.ui_host)==null?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace("."+u1,".posthog.com")),t==="https://app.posthog.com"?"https://us.posthog.com":t}get region(){return this.kr[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.kr[this.apiHost]=Jl.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.kr[this.apiHost]=Jl.EU:this.kr[this.apiHost]=Jl.CUSTOM),this.kr[this.apiHost]}endpointFor(e,t){if(t===void 0&&(t=""),t&&(t=t[0]==="/"?t:"/"+t),e==="ui")return this.uiHost+t;if(e==="flags")return this.flagsApiHost+t;if(this.region===Jl.CUSTOM)return this.apiHost+t;var s=u1+t;switch(e){case"assets":return"https://"+this.region+"-assets."+s;case"api":return"https://"+this.region+"."+s}}}var ID={icontains:(r,e)=>!!q&&e.href.toLowerCase().indexOf(r.toLowerCase())>-1,not_icontains:(r,e)=>!!q&&e.href.toLowerCase().indexOf(r.toLowerCase())===-1,regex:(r,e)=>!!q&&cp(e.href,r),not_regex:(r,e)=>!!q&&!cp(e.href,r),exact:(r,e)=>e.href===r,is_not:(r,e)=>e.href!==r};class Ys{constructor(e){var t=this;this.getWebExperimentsAndEvaluateDisplayLogic=function(s){s===void 0&&(s=!1),t.getWebExperiments(i=>{Ys.Pr("retrieved web experiments from the server"),t.Tr=new Map,i.forEach(n=>{if(n.feature_flag_key){var a;t.Tr&&(Ys.Pr("setting flag key ",n.feature_flag_key," to web experiment ",n),(a=t.Tr)==null||a.set(n.feature_flag_key,n));var o=t._instance.getFeatureFlag(n.feature_flag_key);Cs(o)&&n.variants[o]&&t.Ir(n.name,o,n.variants[o].transforms)}else if(n.variants)for(var l in n.variants){var d=n.variants[l];Ys.Cr(d)&&t.Ir(n.name,l,d.transforms)}})},s)},this._instance=e,this._instance.onFeatureFlags(s=>{this.onFeatureFlags(s)})}onFeatureFlags(e){if(this._is_bot())Ys.Pr("Refusing to render web experiment since the viewer is a likely bot");else if(!this._instance.config.disable_web_experiments){if(gt(this.Tr))return this.Tr=new Map,this.loadIfEnabled(),void this.previewWebExperiment();Ys.Pr("applying feature flags",e),e.forEach(t=>{var s;if(this.Tr&&(s=this.Tr)!=null&&s.has(t)){var i,n=this._instance.getFeatureFlag(t),a=(i=this.Tr)==null?void 0:i.get(t);n&&a!=null&&a.variants[n]&&this.Ir(a.name,n,a.variants[n].transforms)}})}}previewWebExperiment(){var e=Ys.getWindowLocation();if(e!=null&&e.search){var t=ip(e?.search,"__experiment_id"),s=ip(e?.search,"__experiment_variant");t&&s&&(Ys.Pr("previewing web experiments "+t+" && "+s),this.getWebExperiments(i=>{this.Rr(parseInt(t),s,i)},!1,!0))}}loadIfEnabled(){this._instance.config.disable_web_experiments||this.getWebExperimentsAndEvaluateDisplayLogic()}getWebExperiments(e,t,s){if(this._instance.config.disable_web_experiments&&!s)return e([]);var i=this._instance.get_property("$web_experiments");if(i&&!t)return e(i);this._instance._send_request({url:this._instance.requestRouter.endpointFor("api","/api/web_experiments/?token="+this._instance.config.token),method:"GET",callback:n=>{if(n.statusCode!==200||!n.json)return e([]);var a=n.json.experiments||[];return e(a)}})}Rr(e,t,s){var i=s.filter(n=>n.id===e);i&&i.length>0&&(Ys.Pr("Previewing web experiment ["+i[0].name+"] with variant ["+t+"]"),this.Ir(i[0].name,t,i[0].variants[t].transforms))}static Cr(e){return!gt(e.conditions)&&Ys.Fr(e)&&Ys.Mr(e)}static Fr(e){var t;if(gt(e.conditions)||gt((t=e.conditions)==null?void 0:t.url))return!0;var s,i,n,a=Ys.getWindowLocation();return!!a&&((s=e.conditions)==null||!s.url||ID[(i=(n=e.conditions)==null?void 0:n.urlMatchType)!==null&&i!==void 0?i:"icontains"](e.conditions.url,a))}static getWindowLocation(){return q?.location}static Mr(e){var t;if(gt(e.conditions)||gt((t=e.conditions)==null?void 0:t.utm))return!0;var s=qT();if(s.utm_source){var i,n,a,o,l,d,u,h,p=(i=e.conditions)==null||(i=i.utm)==null||!i.utm_campaign||((n=e.conditions)==null||(n=n.utm)==null?void 0:n.utm_campaign)==s.utm_campaign,f=(a=e.conditions)==null||(a=a.utm)==null||!a.utm_source||((o=e.conditions)==null||(o=o.utm)==null?void 0:o.utm_source)==s.utm_source,m=(l=e.conditions)==null||(l=l.utm)==null||!l.utm_medium||((d=e.conditions)==null||(d=d.utm)==null?void 0:d.utm_medium)==s.utm_medium,g=(u=e.conditions)==null||(u=u.utm)==null||!u.utm_term||((h=e.conditions)==null||(h=h.utm)==null?void 0:h.utm_term)==s.utm_term;return p&&m&&g&&f}return!1}static Pr(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),i=1;i<t;i++)s[i-1]=arguments[i];_e.info("[WebExperiments] "+e,s)}Ir(e,t,s){this._is_bot()?Ys.Pr("Refusing to render web experiment since the viewer is a likely bot"):t!=="control"?s.forEach(i=>{if(i.selector){var n;Ys.Pr("applying transform of variant "+t+" for experiment "+e+" ",i);var a=(n=document)==null?void 0:n.querySelectorAll(i.selector);a?.forEach(o=>{var l=o;i.html&&(l.innerHTML=i.html),i.css&&l.setAttribute("style",i.css)})}}):Ys.Pr("Control variants leave the page unmodified.")}_is_bot(){return Fi&&this._instance?cA(Fi,this._instance.config.custom_blocked_useragents):void 0}}var DD=rs("[PostHog ExternalIntegrations]"),FD={intercom:"intercom-integration",crispChat:"crisp-chat-integration"};class BD{constructor(e){this._instance=e}it(e,t){var s;(s=We.__PosthogExtensions__)==null||s.loadExternalDependency==null||s.loadExternalDependency(this._instance,e,i=>{if(i)return DD.error("failed to load script",i);t()})}startIfEnabledOrStop(){var e=this,t=function(a){var o,l,d;!i||(o=We.__PosthogExtensions__)!=null&&(o=o.integrations)!=null&&o[a]||e.it(FD[a],()=>{var u;(u=We.__PosthogExtensions__)==null||(u=u.integrations)==null||(u=u[a])==null||u.start(e._instance)}),!i&&(l=We.__PosthogExtensions__)!=null&&(l=l.integrations)!=null&&l[a]&&((d=We.__PosthogExtensions__)==null||(d=d.integrations)==null||(d=d[a])==null||d.stop())};for(var[s,i]of Object.entries((n=this._instance.config.integrations)!==null&&n!==void 0?n:{})){var n;t(s)}}}var Jg="[SessionRecording]",Pl=rs(Jg);class h1{get started(){var e;return!((e=this.Or)==null||!e.isStarted)}get status(){return this.Or?this.Or.status:this.Ar&&!this.Dr?"disabled":"lazy_loading"}constructor(e){if(this._forceAllowLocalhostNetworkCapture=!1,this.Ar=!1,this.jr=void 0,this._instance=e,!this._instance.sessionManager)throw Pl.error("started without valid sessionManager"),new Error(Jg+" started without valid sessionManager. This is a bug.");if(this._instance.config.cookieless_mode==="always")throw new Error(Jg+' cannot be used with cookieless_mode="always"')}get Dr(){var e,t=!((e=this._instance.get_property(Sf))==null||!e.enabled),s=!this._instance.config.disable_session_recording,i=this._instance.config.disable_session_recording||this._instance.consent.isOptedOut();return q&&t&&s&&!i}startIfEnabledOrStop(e){var t;if(!this.Dr||(t=this.Or)==null||!t.isStarted){var s=!Se(Object.assign)&&!Se(Array.from);this.Dr&&s?(this.Lr(e),Pl.info("starting")):this.stopRecording()}}Lr(e){var t,s,i;this.Dr&&(We!=null&&(t=We.__PosthogExtensions__)!=null&&(t=t.rrweb)!=null&&t.record&&(s=We.__PosthogExtensions__)!=null&&s.initSessionRecording?this.Nr(e):(i=We.__PosthogExtensions__)==null||i.loadExternalDependency==null||i.loadExternalDependency(this._instance,this.Ur,n=>{if(n)return Pl.error("could not load recorder",n);this.Nr(e)}))}stopRecording(){var e,t;(e=this.jr)==null||e.call(this),this.jr=void 0,(t=this.Or)==null||t.stop()}zr(){var e;(e=this._instance.persistence)==null||e.unregister(_T)}Hr(e){if(this._instance.persistence){var t,s,i=this._instance.persistence,n=()=>{var a=e.sessionRecording===!1?void 0:e.sessionRecording,o=a?.sampleRate,l=gt(o)?null:parseFloat(o);gt(l)&&this.zr();var d=a?.minimumDurationMilliseconds;i.register({[Sf]:Re({enabled:!!a},a,{networkPayloadCapture:Re({capturePerformance:e.capturePerformance},a?.networkPayloadCapture),canvasRecording:{enabled:a?.recordCanvas,fps:a?.canvasFps,quality:a?.canvasQuality},sampleRate:l,minimumDurationMilliseconds:Se(d)?null:d,endpoint:a?.endpoint,triggerMatchType:a?.triggerMatchType,masking:a?.masking,urlTriggers:a?.urlTriggers})})};n(),(t=this.jr)==null||t.call(this),this.jr=(s=this._instance.sessionManager)==null?void 0:s.onSessionId(n)}}onRemoteConfig(e){"sessionRecording"in e?e.sessionRecording!==!1?(this.Hr(e),this.Ar=!0,this.startIfEnabledOrStop()):this.Ar=!0:Pl.info("skipping remote config with no sessionRecording",e)}log(e,t){var s;t===void 0&&(t="log"),(s=this.Or)!=null&&s.log?this.Or.log(e,t):Pl.warn("log called before recorder was ready")}get Ur(){var e,t,s=(e=this._instance)==null||(e=e.persistence)==null?void 0:e.get_property(Sf);return(s==null||(t=s.scriptConfig)==null?void 0:t.script)||"lazy-recorder"}Nr(e){var t,s;if((t=We.__PosthogExtensions__)==null||!t.initSessionRecording)throw Error("Called on script loaded before session recording is available");this.Or||(this.Or=(s=We.__PosthogExtensions__)==null?void 0:s.initSessionRecording(this._instance),this.Or._forceAllowLocalhostNetworkCapture=this._forceAllowLocalhostNetworkCapture),this.Or.start(e)}onRRwebEmit(e){var t;(t=this.Or)==null||t.onRRwebEmit==null||t.onRRwebEmit(e)}overrideLinkedFlag(){var e,t;this.Or||(t=this._instance.persistence)==null||t.register({$replay_override_linked_flag:!0}),(e=this.Or)==null||e.overrideLinkedFlag()}overrideSampling(){var e,t;this.Or||(t=this._instance.persistence)==null||t.register({$replay_override_sampling:!0}),(e=this.Or)==null||e.overrideSampling()}overrideTrigger(e){var t,s;this.Or||(s=this._instance.persistence)==null||s.register({[e==="url"?"$replay_override_url_trigger":"$replay_override_event_trigger"]:!0}),(t=this.Or)==null||t.overrideTrigger(e)}get sdkDebugProperties(){var e;return((e=this.Or)==null?void 0:e.sdkDebugProperties)||{$recording_status:this.status}}tryAddCustomEvent(e,t){var s;return!((s=this.Or)==null||!s.tryAddCustomEvent(e,t))}}var fd={},Zg=()=>{},tc="posthog",lA=!cD&&gi?.indexOf("MSIE")===-1&&gi?.indexOf("Mozilla")===-1,p1=r=>{var e;return Re({api_host:"https://us.i.posthog.com",flags_api_host:null,ui_host:null,token:"",autocapture:!0,cross_subdomain_cookie:pI(Ae?.location),persistence:"localStorage+cookie",persistence_name:"",cookie_persisted_properties:[],loaded:Zg,save_campaign_params:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageleave:"if_capture_pageview",defaults:r??"unset",__preview_deferred_init_extensions:!1,debug:yi&&Cs(yi?.search)&&yi.search.indexOf("__posthog_debug=true")!==-1||!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_web_experiments:!0,disable_surveys:!1,disable_surveys_automatic_display:!1,disable_conversations:!1,disable_product_tours:!0,disable_external_dependency_loading:!1,enable_recording_console_log:void 0,secure_cookie:(q==null||(e=q.location)==null?void 0:e.protocol)==="https:",ip:!1,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",consent_persistence_name:null,opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},request_batching:!0,properties_string_max_length:65535,mask_all_element_attributes:!1,mask_all_text:!1,mask_personal_data_properties:!1,custom_personal_data_properties:[],advanced_disable_flags:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_only_evaluate_survey_feature_flags:!1,advanced_enable_surveys:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,surveys_request_timeout_ms:1e4,on_request_error:t=>{var s="Bad HTTP status: "+t.statusCode+" "+t.text;_e.error(s)},get_device_id:t=>t,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"identified_only",before_send:void 0,request_queue_config:{flush_interval_ms:Qg},error_tracking:{},_onCapture:Zg,__preview_eager_load_replay:!1},(t=>({rageclick:!(t&&t>="2025-11-30")||{content_ignorelist:!0},capture_pageview:!(t&&t>="2025-05-24")||"history_change",session_recording:t&&t>="2025-11-30"?{strictMinimumDuration:!0}:{},external_scripts_inject_target:t&&t>="2026-01-30"?"head":"body"}))(r))},f1=r=>{var e={};Se(r.process_person)||(e.person_profiles=r.process_person),Se(r.xhr_headers)||(e.request_headers=r.xhr_headers),Se(r.cookie_name)||(e.persistence_name=r.cookie_name),Se(r.disable_cookie)||(e.disable_persistence=r.disable_cookie),Se(r.store_google)||(e.save_campaign_params=r.store_google),Se(r.verbose)||(e.debug=r.verbose);var t=cs({},e,r);return xt(r.property_blacklist)&&(Se(r.property_denylist)?t.property_denylist=r.property_blacklist:xt(r.property_denylist)?t.property_denylist=[...r.property_blacklist,...r.property_denylist]:_e.error("Invalid value for property_denylist config: "+r.property_denylist)),t};class LD{constructor(){this.__forceAllowLocalhost=!1}get Br(){return this.__forceAllowLocalhost}set Br(e){_e.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}class qp{get decideEndpointWasHit(){var e,t;return(e=(t=this.featureFlags)==null?void 0:t.hasLoadedFlags)!==null&&e!==void 0&&e}get flagsEndpointWasHit(){var e,t;return(e=(t=this.featureFlags)==null?void 0:t.hasLoadedFlags)!==null&&e!==void 0&&e}constructor(){this.webPerformance=new LD,this.qr=!1,this.version=nn.LIB_VERSION,this.Wr=new ex,this._calculate_event_properties=this.calculateEventProperties.bind(this),this.config=p1(),this.SentryIntegration=VI,this.sentryIntegration=e=>function(t,s){var i=YT(t,s);return{name:WT,processEvent:n=>i(n)}}(this,e),this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this.Gr=!1,this.Vr=null,this.Jr=null,this.Kr=null,this.featureFlags=new hD(this),this.toolbar=new GI(this),this.scrollManager=new ED(this),this.pageViewManager=new Xv(this),this.surveys=new wD(this),this.conversations=new kD(this),this.logs=new CD(this),this.experiments=new Ys(this),this.exceptions=new lD(this),this.rateLimiter=new SD(this),this.requestRouter=new RD(this),this.consent=new FI(this),this.externalIntegrations=new BD(this),this.people={set:(e,t,s)=>{var i=Cs(e)?{[e]:t}:e;this.setPersonProperties(i),s?.({})},set_once:(e,t,s)=>{var i=Cs(e)?{[e]:t}:e;this.setPersonProperties(void 0,i),s?.({})}},this.on("eventCaptured",e=>_e.info('send "'+e?.event+'"',e))}init(e,t,s){if(s&&s!==tc){var i,n=(i=fd[s])!==null&&i!==void 0?i:new qp;return n._init(e,t,s),fd[s]=n,fd[tc][s]=n,n}return this._init(e,t,s)}_init(e,t,s){var i;if(t===void 0&&(t={}),Se(e)||Ng(e))return _e.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return console.warn("[PostHog.js]","You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},t.debug=this.Yr(t.debug),this.Xr=t,this.Qr=[],t.person_profiles&&(this.Jr=t.person_profiles),this.set_config(cs({},p1(t.defaults),f1(t),{name:s,token:e})),this.config.on_xhr_error&&_e.error("on_xhr_error is deprecated. Use on_request_error instead"),this.compression=t.disable_compression?void 0:un.GZipJS;var n=this.Zr();this.persistence=new If(this.config,n),this.sessionPersistence=this.config.persistence==="sessionStorage"||this.config.persistence==="memory"?this.persistence:new If(Re({},this.config,{persistence:"sessionStorage"}),n);var a=Re({},this.persistence.props),o=Re({},this.sessionPersistence.props);this.register({$initialization_time:new Date().toISOString()}),this.ts=new AD(b=>this.es(b),this.config.request_queue_config),this.rs=new _D(this),this.__request_queue=[];var l=this.config.cookieless_mode==="always"||this.config.cookieless_mode==="on_reject"&&this.consent.isExplicitlyOptedOut();if(l||(this.sessionManager=new d1(this),this.sessionPropsManager=new l1(this,this.sessionManager,this.persistence)),this.config.__preview_deferred_init_extensions?(_e.info("Deferring extension initialization to improve startup performance"),setTimeout(()=>{this.ss(l)},0)):(_e.info("Initializing extensions synchronously"),this.ss(l)),nn.DEBUG=nn.DEBUG||this.config.debug,nn.DEBUG&&_e.info("Starting in debug mode",{this:this,config:t,thisC:Re({},this.config),p:a,s:o}),((i=t.bootstrap)==null?void 0:i.distinctID)!==void 0){var d,u,h=this.config.get_device_id(Kn()),p=(d=t.bootstrap)!=null&&d.isIdentifiedID?h:t.bootstrap.distinctID;this.persistence.set_property(an,(u=t.bootstrap)!=null&&u.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:t.bootstrap.distinctID,$device_id:p})}if(this.ns()){var f,m,g=Object.keys(((f=t.bootstrap)==null?void 0:f.featureFlags)||{}).filter(b=>{var w;return!((w=t.bootstrap)==null||(w=w.featureFlags)==null||!w[b])}).reduce((b,w)=>{var C;return b[w]=((C=t.bootstrap)==null||(C=C.featureFlags)==null?void 0:C[w])||!1,b},{}),y=Object.keys(((m=t.bootstrap)==null?void 0:m.featureFlagPayloads)||{}).filter(b=>g[b]).reduce((b,w)=>{var C,k;return(C=t.bootstrap)!=null&&(C=C.featureFlagPayloads)!=null&&C[w]&&(b[w]=(k=t.bootstrap)==null||(k=k.featureFlagPayloads)==null?void 0:k[w]),b},{});this.featureFlags.receivedFeatureFlags({featureFlags:g,featureFlagPayloads:y})}if(l)this.register_once({distinct_id:Cl,$device_id:null},"");else if(!this.get_distinct_id()){var x=this.config.get_device_id(Kn());this.register_once({distinct_id:x,$device_id:x},""),this.persistence.set_property(an,"anonymous")}return ys(q,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this),{passive:!1}),this.toolbar.maybeLoadToolbar(),t.segment?zI(this,()=>this.os()):this.os(),sa(this.config._onCapture)&&this.config._onCapture!==Zg&&(_e.warn("onCapture is deprecated. Please use `before_send` instead"),this.on("eventCaptured",b=>this.config._onCapture(b.event,b))),this.config.ip&&_e.warn('The `ip` config option has NO EFFECT AT ALL and has been deprecated. Use a custom transformation or "Discard IP data" project setting instead. See https://posthog.com/tutorials/web-redact-properties#hiding-customer-ip-address for more information.'),this}ss(e){var t=performance.now();this.historyAutocapture=new $I(this),this.historyAutocapture.startIfEnabled();var s=[];s.push(()=>{new YI(this).startIfEnabledOrStop()}),s.push(()=>{var i;this.siteApps=new ND(this),(i=this.siteApps)==null||i.init()}),e||s.push(()=>{this.sessionRecording=new h1(this),this.sessionRecording.startIfEnabledOrStop()}),this.config.disable_scroll_properties||s.push(()=>{this.scrollManager.startMeasuringScrollPosition()}),s.push(()=>{this.autocapture=new _I(this),this.autocapture.startIfEnabled()}),s.push(()=>{this.surveys.loadIfEnabled()}),s.push(()=>{this.logs.loadIfEnabled()}),s.push(()=>{this.conversations.loadIfEnabled()}),s.push(()=>{this.productTours=new fD(this),this.productTours.loadIfEnabled()}),s.push(()=>{this.heatmaps=new ZI(this),this.heatmaps.startIfEnabled()}),s.push(()=>{this.webVitalsAutocapture=new QI(this)}),s.push(()=>{this.exceptionObserver=new OI(this),this.exceptionObserver.startIfEnabledOrStop()}),s.push(()=>{this.deadClicksAutocapture=new GT(this,LI),this.deadClicksAutocapture.startIfEnabled()}),s.push(()=>{if(this.ls){var i=this.ls;this.ls=void 0,this.bi(i)}}),this.us(s,t)}us(e,t){for(;e.length>0;){if(this.config.__preview_deferred_init_extensions&&performance.now()-t>=30&&e.length>0)return void setTimeout(()=>{this.us(e,t)},0);var s=e.shift();if(s)try{s()}catch(n){_e.error("Error initializing extension:",n)}}var i=Math.round(performance.now()-t);this.register_for_session({$sdk_debug_extensions_init_method:this.config.__preview_deferred_init_extensions?"deferred":"synchronous",$sdk_debug_extensions_init_time_ms:i}),this.config.__preview_deferred_init_extensions&&_e.info("PostHog extensions initialized ("+i+"ms)")}bi(e){var t,s,i,n,a,o,l,d,u;if(!Ae||!Ae.body)return _e.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout(()=>{this.bi(e)},500);this.config.__preview_deferred_init_extensions&&(this.ls=e),this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=at(e.supportedCompression,un.GZipJS)?un.GZipJS:at(e.supportedCompression,un.Base64)?un.Base64:void 0),(t=e.analytics)!=null&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),this.set_config({person_profiles:this.Jr?this.Jr:"identified_only"}),(s=this.siteApps)==null||s.onRemoteConfig(e),(i=this.sessionRecording)==null||i.onRemoteConfig(e),(n=this.autocapture)==null||n.onRemoteConfig(e),(a=this.heatmaps)==null||a.onRemoteConfig(e),this.surveys.onRemoteConfig(e),this.logs.onRemoteConfig(e),this.conversations.onRemoteConfig(e),(o=this.productTours)==null||o.onRemoteConfig(e),(l=this.webVitalsAutocapture)==null||l.onRemoteConfig(e),(d=this.exceptionObserver)==null||d.onRemoteConfig(e),this.exceptions.onRemoteConfig(e),(u=this.deadClicksAutocapture)==null||u.onRemoteConfig(e)}os(){try{this.config.loaded(this)}catch(e){_e.critical("`loaded` function failed",e)}this.hs(),this.config.capture_pageview&&setTimeout(()=>{(this.consent.isOptedIn()||this.config.cookieless_mode==="always")&&this.ds()},1),new TD(this).load(),this.featureFlags.flags()}hs(){var e;this.is_capturing()&&this.config.request_batching&&((e=this.ts)==null||e.enable())}_dom_loaded(){this.is_capturing()&&ia(this.__request_queue,e=>this.es(e)),this.__request_queue=[],this.hs()}_handle_unload(){var e,t;this.surveys.handlePageUnload(),this.config.request_batching?(this.vs()&&this.capture("$pageleave"),(e=this.ts)==null||e.unload(),(t=this.rs)==null||t.unload()):this.vs()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}_send_request(e){this.__loaded&&(lA?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=op(e.url,{ip:this.config.ip?1:0}),e.headers=Re({},this.config.request_headers,e.headers),e.compression=e.compression==="best-available"?this.compression:e.compression,e.disableXHRCredentials=this.config.__preview_disable_xhr_credentials,this.config.__preview_disable_beacon&&(e.disableTransport=["sendBeacon"]),e.fetchOptions=e.fetchOptions||this.config.fetch_options,(t=>{var s,i,n,a=Re({},t);a.timeout=a.timeout||6e4,a.url=op(a.url,{_:new Date().getTime().toString(),ver:nn.LIB_VERSION,compression:a.compression});var o=(s=a.transport)!==null&&s!==void 0?s:"fetch",l=Ah.filter(u=>!a.disableTransport||!u.transport||!a.disableTransport.includes(u.transport)),d=(i=(n=TT(l,u=>u.transport===o))==null?void 0:n.method)!==null&&i!==void 0?i:l[0].method;if(!d)throw new Error("No available transport method");d(a)})(Re({},e,{callback:t=>{var s,i;this.rateLimiter.checkForLimiting(t),t.statusCode>=400&&((s=(i=this.config).on_request_error)==null||s.call(i,t)),e.callback==null||e.callback(t)}}))))}es(e){this.rs?this.rs.retriableRequest(e):this._send_request(e)}_execute_array(e){var t,s=[],i=[],n=[];ia(e,o=>{o&&(t=o[0],xt(t)?n.push(o):sa(o)?o.call(this):xt(o)&&t==="alias"?s.push(o):xt(o)&&t.indexOf("capture")!==-1&&sa(this[t])?n.push(o):i.push(o))});var a=function(o,l){ia(o,function(d){if(xt(d[0])){var u=l;Nt(d,function(h){u=u[h[0]].apply(u,h.slice(1))})}else this[d[0]].apply(this,d.slice(1))},l)};a(s,this),a(i,this),a(n,this)}ns(){var e,t;return((e=this.config.bootstrap)==null?void 0:e.featureFlags)&&Object.keys((t=this.config.bootstrap)==null?void 0:t.featureFlags).length>0||!1}push(e){this._execute_array([e])}capture(e,t,s){var i;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this.ts){if(this.is_capturing())if(!Se(e)&&Cs(e)){var n=!this.config.opt_out_useragent_filter&&this._is_bot();if(!(n&&!this.config.__preview_capture_bot_pageviews)){var a=s!=null&&s.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(a==null||!a.isRateLimited){t!=null&&t.$current_url&&!Cs(t?.$current_url)&&(_e.error("Invalid `$current_url` property provided to `posthog.capture`. Input must be a string. Ignoring provided value."),t==null||delete t.$current_url),this.sessionPersistence.update_search_keyword(),this.config.save_campaign_params&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.save_campaign_params||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,l=s?.timestamp||o,d=Kn(),u={uuid:d,event:e,properties:this.calculateEventProperties(e,t||{},l,d)};e==="$pageview"&&this.config.__preview_capture_bot_pageviews&&n&&(u.event="$bot_pageview",u.properties.$browser_type="bot"),a&&(u.properties.$lib_rate_limit_remaining_tokens=a.remainingTokens),s?.$set&&(u.$set=s?.$set);var h,p=e!=="$groupidentify",f=this.cs(s?.$set_once,p);if(f&&(u.$set_once=f),(u=uI(u,s!=null&&s._noTruncate?null:this.config.properties_string_max_length)).timestamp=l,Se(s?.timestamp)||(u.properties.$event_time_override_provided=!0,u.properties.$event_time_override_system_time=o),e===Ql.DISMISSED||e===Ql.SENT){var m=t?.[Bf.SURVEY_ID],g=t?.[Bf.SURVEY_ITERATION];h={id:m,current_iteration:g},localStorage.getItem(o1(h))||localStorage.setItem(o1(h),"true"),u.$set=Re({},u.$set,{[mD({id:m,current_iteration:g},e===Ql.SENT?"responded":"dismissed")]:!0})}else e===Ql.SHOWN&&(u.$set=Re({},u.$set,{[Bf.SURVEY_LAST_SEEN_DATE]:new Date().toISOString()}));var y=Re({},u.properties.$set,u.$set);if(rc(y)||this.setPersonPropertiesForFlags(y),!gt(this.config.before_send)){var x=this.fs(u);if(!x)return;u=x}this.Wr.emit("eventCaptured",u);var b={method:"POST",url:(i=s?._url)!==null&&i!==void 0?i:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:u,compression:"best-available",batchKey:s?._batchKey};return!this.config.request_batching||s&&(s==null||!s._batchKey)||s!=null&&s.send_instantly?this.es(b):this.ts.enqueue(b),u}_e.critical("This capture call is ignored due to client rate limiting.")}}else _e.error("No event name provided to posthog.capture")}else _e.uninitializedWarning("posthog.capture")}Bi(e){return this.on("eventCaptured",t=>e(t.event,t))}calculateEventProperties(e,t,s,i,n){if(s=s||new Date,!this.persistence||!this.sessionPersistence)return t;var a=n?void 0:this.persistence.remove_event_timer(e),o=Re({},t);if(o.token=this.config.token,o.$config_defaults=this.config.defaults,(this.config.cookieless_mode=="always"||this.config.cookieless_mode=="on_reject"&&this.consent.isExplicitlyOptedOut())&&(o.$cookieless_mode=!0),e==="$snapshot"){var l=Re({},this.persistence.properties(),this.sessionPersistence.properties());return o.distinct_id=l.distinct_id,(!Cs(o.distinct_id)&&!yn(o.distinct_id)||Ng(o.distinct_id))&&_e.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),o}var d,u=KI(this.config.mask_personal_data_properties,this.config.custom_personal_data_properties);if(this.sessionManager){var{sessionId:h,windowId:p}=this.sessionManager.checkAndGetSessionAndWindowId(n,s.getTime());o.$session_id=h,o.$window_id=p}this.sessionPropsManager&&cs(o,this.sessionPropsManager.getSessionProps());try{var f;this.sessionRecording&&cs(o,this.sessionRecording.sdkDebugProperties),o.$sdk_debug_retry_queue_size=(f=this.rs)==null?void 0:f.length}catch(x){o.$sdk_debug_error_capturing_properties=String(x)}if(this.requestRouter.region===Jl.CUSTOM&&(o.$lib_custom_api_host=this.config.api_host),d=e!=="$pageview"||n?e!=="$pageleave"||n?this.pageViewManager.doEvent():this.pageViewManager.doPageLeave(s):this.pageViewManager.doPageView(s,i),o=cs(o,d),e==="$pageview"&&Ae&&(o.title=Ae.title),!Se(a)){var m=s.getTime()-a;o.$duration=parseFloat((m/1e3).toFixed(3))}gi&&this.config.opt_out_useragent_filter&&(o.$browser_type=this._is_bot()?"bot":"browser"),(o=cs({},u,this.persistence.properties(),this.sessionPersistence.properties(),o)).$is_identified=this._isIdentified(),xt(this.config.property_denylist)?Nt(this.config.property_denylist,function(x){delete o[x]}):_e.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var g=this.config.sanitize_properties;g&&(_e.error("sanitize_properties is deprecated. Use before_send instead"),o=g(o,e));var y=this.ps();return o.$process_person_profile=y,y&&!n&&this.gs("_calculate_event_properties"),o}cs(e,t){var s;if(t===void 0&&(t=!0),!this.persistence||!this.ps()||this.qr)return e;var i=this.persistence.get_initial_props(),n=(s=this.sessionPropsManager)==null?void 0:s.getSetOnceProps(),a=cs({},i,n||{},e||{}),o=this.config.sanitize_properties;return o&&(_e.error("sanitize_properties is deprecated. Use before_send instead"),a=o(a,"$set_once")),t&&(this.qr=!0),rc(a)?void 0:a}register(e,t){var s;(s=this.persistence)==null||s.register(e,t)}register_once(e,t,s){var i;(i=this.persistence)==null||i.register_once(e,t,s)}register_for_session(e){var t;(t=this.sessionPersistence)==null||t.register(e)}unregister(e){var t;(t=this.persistence)==null||t.unregister(e)}unregister_for_session(e){var t;(t=this.sessionPersistence)==null||t.unregister(e)}_s(e,t){this.register({[e]:t})}getFeatureFlag(e,t){return this.featureFlags.getFeatureFlag(e,t)}getFeatureFlagPayload(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch{return t}}isFeatureEnabled(e,t){return this.featureFlags.isFeatureEnabled(e,t)}reloadFeatureFlags(){this.featureFlags.reloadFeatureFlags()}updateFlags(e,t,s){var i=s!=null&&s.merge?this.featureFlags.getFlagVariants():{},n=s!=null&&s.merge?this.featureFlags.getFlagPayloads():{},a=Re({},i,e),o=Re({},n,t),l={};for(var[d,u]of Object.entries(a)){var h=typeof u=="string";l[d]={key:d,enabled:!!h||!!u,variant:h?u:void 0,reason:void 0,metadata:Se(o?.[d])?void 0:{id:0,version:void 0,description:void 0,payload:o[d]}}}this.featureFlags.receivedFeatureFlags({flags:l})}updateEarlyAccessFeatureEnrollment(e,t,s){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t,s)}getEarlyAccessFeatures(e,t,s){return t===void 0&&(t=!1),this.featureFlags.getEarlyAccessFeatures(e,t,s)}on(e,t){return this.Wr.on(e,t)}onFeatureFlags(e){return this.featureFlags.onFeatureFlags(e)}onSurveysLoaded(e){return this.surveys.onSurveysLoaded(e)}onSessionId(e){var t,s;return(t=(s=this.sessionManager)==null?void 0:s.onSessionId(e))!==null&&t!==void 0?t:()=>{}}getSurveys(e,t){t===void 0&&(t=!1),this.surveys.getSurveys(e,t)}getActiveMatchingSurveys(e,t){t===void 0&&(t=!1),this.surveys.getActiveMatchingSurveys(e,t)}renderSurvey(e,t){this.surveys.renderSurvey(e,t)}displaySurvey(e,t){t===void 0&&(t=yD),this.surveys.displaySurvey(e,t)}cancelPendingSurvey(e){this.surveys.cancelPendingSurvey(e)}canRenderSurvey(e){return this.surveys.canRenderSurvey(e)}canRenderSurveyAsync(e,t){return t===void 0&&(t=!1),this.surveys.canRenderSurveyAsync(e,t)}identify(e,t,s){if(!this.__loaded||!this.persistence)return _e.uninitializedWarning("posthog.identify");if(yn(e)&&(e=e.toString(),_e.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e)if(["distinct_id","distinctid"].includes(e.toLowerCase()))_e.critical('The string "'+e+'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.');else if(e!==Cl){if(this.gs("posthog.identify")){var i=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var n=i;this.register_once({$had_persisted_distinct_id:!0,$device_id:n},"")}e!==i&&e!==this.get_property(Yl)&&(this.unregister(Yl),this.register({distinct_id:e}));var a=(this.persistence.get_property(an)||"anonymous")==="anonymous";e!==i&&a?(this.persistence.set_property(an,"identified"),this.setPersonPropertiesForFlags(Re({},s||{},t||{}),!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:i},{$set:t||{},$set_once:s||{}}),this.Kr=t1(e,t,s),this.featureFlags.setAnonymousDistinctId(i)):(t||s)&&this.setPersonProperties(t,s),e!==i&&(this.reloadFeatureFlags(),this.unregister(Jh))}}else _e.critical('The string "'+Cl+'" was set in posthog.identify which indicates an error. This ID is only used as a sentinel value.');else _e.error("Unique user id has not been set in posthog.identify")}setPersonProperties(e,t){if((e||t)&&this.gs("posthog.setPersonProperties")){var s=t1(this.get_distinct_id(),e,t);this.Kr!==s?(this.setPersonPropertiesForFlags(Re({},t||{},e||{})),this.capture("$set",{$set:e||{},$set_once:t||{}}),this.Kr=s):_e.info("A duplicate setPersonProperties call was made with the same properties. It has been ignored.")}}group(e,t,s){if(e&&t){var i=this.getGroups();i[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:Re({},i,{[e]:t})}),s&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:s}),this.setGroupPropertiesForFlags({[e]:s})),i[e]===t||s||this.reloadFeatureFlags()}else _e.error("posthog.group requires a group type and group key")}resetGroups(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}setPersonPropertiesForFlags(e,t){t===void 0&&(t=!0),this.featureFlags.setPersonPropertiesForFlags(e,t)}resetPersonPropertiesForFlags(){this.featureFlags.resetPersonPropertiesForFlags()}setGroupPropertiesForFlags(e,t){t===void 0&&(t=!0),this.gs("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}resetGroupPropertiesForFlags(e){this.featureFlags.resetGroupPropertiesForFlags(e)}reset(e){var t,s,i,n;if(_e.info("reset"),!this.__loaded)return _e.uninitializedWarning("posthog.reset");var a=this.get_property("$device_id");if(this.consent.reset(),(t=this.persistence)==null||t.clear(),(s=this.sessionPersistence)==null||s.clear(),this.surveys.reset(),this.featureFlags.reset(),(i=this.persistence)==null||i.set_property(an,"anonymous"),(n=this.sessionManager)==null||n.resetSessionId(),this.Kr=null,this.config.cookieless_mode==="always")this.register_once({distinct_id:Cl,$device_id:null},"");else{var o=this.config.get_device_id(Kn());this.register_once({distinct_id:o,$device_id:e?o:a},"")}this.register({$last_posthog_reset:new Date().toISOString()},1)}get_distinct_id(){return this.get_property("distinct_id")}getGroups(){return this.get_property("$groups")||{}}get_session_id(){var e,t;return(e=(t=this.sessionManager)==null?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}get_session_replay_url(e){if(!this.sessionManager)return"";var{sessionId:t,sessionStartTimestamp:s}=this.sessionManager.checkAndGetSessionAndWindowId(!0),i=this.requestRouter.endpointFor("ui","/project/"+this.config.token+"/replay/"+t);if(e!=null&&e.withTimestamp&&s){var n,a=(n=e.timestampLookBack)!==null&&n!==void 0?n:10;if(!s)return i;i+="?t="+Math.max(Math.floor((new Date().getTime()-s)/1e3)-a,0)}return i}alias(e,t){return e===this.get_property(AT)?(_e.critical("Attempting to create alias for existing People user - aborting."),-2):this.gs("posthog.alias")?(Se(t)&&(t=this.get_distinct_id()),e!==t?(this._s(Yl,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(_e.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}set_config(e){var t=Re({},this.config);if(ks(e)){var s,i,n,a,o,l,d;cs(this.config,f1(e));var u=this.Zr();(s=this.persistence)==null||s.update_config(this.config,t,u),this.sessionPersistence=this.config.persistence==="sessionStorage"||this.config.persistence==="memory"?this.persistence:new If(Re({},this.config,{persistence:"sessionStorage"}),u);var h=this.Yr(this.config.debug);mn(h)&&(this.config.debug=h),mn(this.config.debug)&&(this.config.debug?(nn.DEBUG=!0,Yt.H()&&Yt.G("ph_debug","true"),_e.info("set_config",{config:e,oldConfig:t,newConfig:Re({},this.config)})):(nn.DEBUG=!1,Yt.H()&&Yt.V("ph_debug"))),(i=this.exceptionObserver)==null||i.onConfigChange(),(n=this.sessionRecording)==null||n.startIfEnabledOrStop(),(a=this.autocapture)==null||a.startIfEnabled(),(o=this.heatmaps)==null||o.startIfEnabled(),(l=this.exceptionObserver)==null||l.startIfEnabledOrStop(),this.surveys.loadIfEnabled(),this.ys(),(d=this.externalIntegrations)==null||d.startIfEnabledOrStop()}}startSessionRecording(e){var t=e===!0,s={sampling:t||!(e==null||!e.sampling),linked_flag:t||!(e==null||!e.linked_flag),url_trigger:t||!(e==null||!e.url_trigger),event_trigger:t||!(e==null||!e.event_trigger)};if(Object.values(s).some(Boolean)){var i,n,a,o,l;(i=this.sessionManager)==null||i.checkAndGetSessionAndWindowId(),s.sampling&&((n=this.sessionRecording)==null||n.overrideSampling()),s.linked_flag&&((a=this.sessionRecording)==null||a.overrideLinkedFlag()),s.url_trigger&&((o=this.sessionRecording)==null||o.overrideTrigger("url")),s.event_trigger&&((l=this.sessionRecording)==null||l.overrideTrigger("event"))}this.set_config({disable_session_recording:!1})}stopSessionRecording(){this.set_config({disable_session_recording:!0})}sessionRecordingStarted(){var e;return!((e=this.sessionRecording)==null||!e.started)}captureException(e,t){var s=new Error("PostHog syntheticException"),i=this.exceptions.buildProperties(e,{handled:!0,syntheticException:s});return this.exceptions.sendExceptionEvent(Re({},i,t))}startExceptionAutocapture(e){this.set_config({capture_exceptions:e==null||e})}stopExceptionAutocapture(){this.set_config({capture_exceptions:!1})}loadToolbar(e){return this.toolbar.loadToolbar(e)}get_property(e){var t;return(t=this.persistence)==null?void 0:t.props[e]}getSessionProperty(e){var t;return(t=this.sessionPersistence)==null?void 0:t.props[e]}toString(){var e,t=(e=this.config.name)!==null&&e!==void 0?e:tc;return t!==tc&&(t=tc+"."+t),t}_isIdentified(){var e,t;return((e=this.persistence)==null?void 0:e.get_property(an))==="identified"||((t=this.sessionPersistence)==null?void 0:t.get_property(an))==="identified"}ps(){var e,t;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&rc(this.getGroups())&&((e=this.persistence)==null||(e=e.props)==null||!e[Yl])&&((t=this.persistence)==null||(t=t.props)==null||!t[ep]))}vs(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&(this.config.capture_pageview===!0||this.config.capture_pageview==="history_change")}createPersonProfile(){this.ps()||this.gs("posthog.createPersonProfile")&&this.setPersonProperties({},{})}gs(e){return this.config.person_profiles==="never"?(_e.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._s(ep,!0),!0)}Zr(){if(this.config.cookieless_mode==="always")return!0;var e=this.consent.isOptedOut(),t=this.config.opt_out_persistence_by_default||this.config.cookieless_mode==="on_reject";return this.config.disable_persistence||e&&!!t}ys(){var e,t,s,i,n=this.Zr();return((e=this.persistence)==null?void 0:e.ki)!==n&&((s=this.persistence)==null||s.set_disabled(n)),((t=this.sessionPersistence)==null?void 0:t.ki)!==n&&((i=this.sessionPersistence)==null||i.set_disabled(n)),n}opt_in_capturing(e){var t;if(this.config.cookieless_mode!=="always"){var s,i,n;this.config.cookieless_mode==="on_reject"&&this.consent.isExplicitlyOptedOut()&&(this.reset(!0),(s=this.sessionManager)==null||s.destroy(),(i=this.pageViewManager)==null||i.destroy(),this.sessionManager=new d1(this),this.pageViewManager=new Xv(this),this.persistence&&(this.sessionPropsManager=new l1(this,this.sessionManager,this.persistence)),this.sessionRecording=new h1(this),this.sessionRecording.startIfEnabledOrStop()),this.consent.optInOut(!0),this.ys(),this.hs(),(t=this.sessionRecording)==null||t.startIfEnabledOrStop(),this.config.cookieless_mode=="on_reject"&&this.surveys.loadIfEnabled(),(Se(e?.captureEventName)||e!=null&&e.captureEventName)&&this.capture((n=e?.captureEventName)!==null&&n!==void 0?n:"$opt_in",e?.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this.ds()}else _e.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}opt_out_capturing(){var e,t,s;this.config.cookieless_mode!=="always"?(this.config.cookieless_mode==="on_reject"&&this.consent.isOptedIn()&&this.reset(!0),this.consent.optInOut(!1),this.ys(),this.config.cookieless_mode==="on_reject"&&(this.register({distinct_id:Cl,$device_id:null}),(e=this.sessionManager)==null||e.destroy(),(t=this.pageViewManager)==null||t.destroy(),this.sessionManager=void 0,this.sessionPropsManager=void 0,(s=this.sessionRecording)==null||s.stopRecording(),this.sessionRecording=void 0,this.ds())):_e.warn('Consent opt in/out is not valid with cookieless_mode="always" and will be ignored')}has_opted_in_capturing(){return this.consent.isOptedIn()}has_opted_out_capturing(){return this.consent.isOptedOut()}get_explicit_consent_status(){var e=this.consent.consent;return e===on.GRANTED?"granted":e===on.DENIED?"denied":"pending"}is_capturing(){return this.config.cookieless_mode==="always"||(this.config.cookieless_mode==="on_reject"?this.consent.isExplicitlyOptedOut()||this.consent.isOptedIn():!this.has_opted_out_capturing())}clear_opt_in_out_capturing(){this.consent.reset(),this.ys()}_is_bot(){return Fi?cA(Fi,this.config.custom_blocked_useragents):void 0}ds(){Ae&&(Ae.visibilityState==="visible"?this.Gr||(this.Gr=!0,this.capture("$pageview",{title:Ae.title},{send_instantly:!0}),this.Vr&&(Ae.removeEventListener("visibilitychange",this.Vr),this.Vr=null)):this.Vr||(this.Vr=this.ds.bind(this),ys(Ae,"visibilitychange",this.Vr)))}debug(e){e===!1?(q?.console.log("You've disabled debug mode."),this.set_config({debug:!1})):(q?.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),this.set_config({debug:!0}))}O(){var e,t,s,i,n,a,o,l=this.Xr||{};return"advanced_disable_flags"in l?!!l.advanced_disable_flags:this.config.advanced_disable_flags!==!1?!!this.config.advanced_disable_flags:this.config.advanced_disable_decide===!0?(_e.warn("Config field 'advanced_disable_decide' is deprecated. Please use 'advanced_disable_flags' instead. The old field will be removed in a future major version."),!0):(s="advanced_disable_decide",i=!1,n=_e,a=(t="advanced_disable_flags")in(e=l)&&!Se(e[t]),o=s in e&&!Se(e[s]),a?e[t]:o?(n&&n.warn("Config field '"+s+"' is deprecated. Please use '"+t+"' instead. The old field will be removed in a future major version."),e[s]):i)}fs(e){if(gt(this.config.before_send))return e;var t=xt(this.config.before_send)?this.config.before_send:[this.config.before_send],s=e;for(var i of t){if(s=i(s),gt(s)){var n="Event '"+e.event+"' was rejected in beforeSend function";return _R(e.event)?_e.warn(n+". This can cause unexpected behavior."):_e.info(n),null}s.properties&&!rc(s.properties)||_e.warn("Event '"+e.event+"' has no properties after beforeSend function, this is likely an error.")}return s}getPageViewId(){var e;return(e=this.pageViewManager.Kt)==null?void 0:e.pageViewId}captureTraceFeedback(e,t){this.capture("$ai_feedback",{$ai_trace_id:String(e),$ai_feedback_text:t})}captureTraceMetric(e,t,s){this.capture("$ai_metric",{$ai_trace_id:String(e),$ai_metric_name:t,$ai_metric_value:String(s)})}Yr(e){var t=mn(e)&&!e,s=Yt.H()&&Yt.q("ph_debug")==="true";return!t&&(!!s||e)}}(function(r,e){for(var t=0;t<e.length;t++)r.prototype[e[t]]=dI(r.prototype[e[t]])})(qp,["identify"]);var m1,OD=(m1=fd[tc]=new qp,function(){function r(){r.done||(r.done=!0,lA=!1,Nt(fd,function(e){e._dom_loaded()}))}Ae!=null&&Ae.addEventListener?Ae.readyState==="complete"?r():ys(Ae,"DOMContentLoaded",r,{capture:!1}):q&&_e.error("Browser doesn't support `document.addEventListener` so PostHog couldn't be initialized")}(),m1),dA=v.createContext({client:OD,bootstrap:void 0}),Of=function(r){return typeof r=="function"},$D=function(){var r=v.useContext(dA).client;return r},e0=function(r,e){return e0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,s){t.__proto__=s}||function(t,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])},e0(r,e)};function zD(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");e0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var VD={componentStack:null,exceptionEvent:null,error:null},UD={INVALID_FALLBACK:"[PostHog.js][PostHogErrorBoundary] Invalid fallback prop, provide a valid React element or a function that returns a valid React element."};(function(r){zD(e,r);function e(t){var s=r.call(this,t)||this;return s.state=VD,s}return e.prototype.componentDidCatch=function(t,s){var i=this.props.additionalProperties,n;Of(i)?n=i(t):typeof i=="object"&&(n=i);var a=this.context.client,o=a.captureException(t,n),l=s.componentStack;this.setState({error:t,componentStack:l??null,exceptionEvent:o})},e.prototype.render=function(){var t=this.props,s=t.children,i=t.fallback,n=this.state;if(n.componentStack==null)return Of(s)?s():s;var a=Of(i)?Ye.createElement(i,{error:n.error,componentStack:n.componentStack,exceptionEvent:n.exceptionEvent}):i;return Ye.isValidElement(a)?a:(console.warn(UD.INVALID_FALLBACK),Ye.createElement(Ye.Fragment,null))},e.contextType=dA,e})(Ye.Component);const tx=v.createContext({});function sx(r){const e=v.useRef(null);return e.current===null&&(e.current=r()),e.current}const ix=typeof window<"u",uA=ix?v.useLayoutEffect:v.useEffect,Hp=v.createContext(null);function rx(r,e){r.indexOf(e)===-1&&r.push(e)}function nx(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}const xn=(r,e,t)=>t>e?e:t<r?r:t;let ax=()=>{};const bn={},hA=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function pA(r){return typeof r=="object"&&r!==null}const fA=r=>/^0[^.\s]+$/u.test(r);function ox(r){let e;return()=>(e===void 0&&(e=r()),e)}const cr=r=>r,GD=(r,e)=>t=>e(r(t)),pu=(...r)=>r.reduce(GD),Fd=(r,e,t)=>{const s=e-r;return s===0?1:(t-r)/s};let cx=class{constructor(){this.subscriptions=[]}add(e){return rx(this.subscriptions,e),()=>nx(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,s);else for(let n=0;n<i;n++){const a=this.subscriptions[n];a&&a(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}};const Or=r=>r*1e3,tr=r=>r/1e3;function mA(r,e){return e?r*(1e3/e):0}const gA=(r,e,t)=>(((1-3*t+3*e)*r+(3*t-6*e))*r+3*e)*r,WD=1e-7,YD=12;function qD(r,e,t,s,i){let n,a,o=0;do a=e+(t-e)/2,n=gA(a,s,i)-r,n>0?t=a:e=a;while(Math.abs(n)>WD&&++o<YD);return a}function fu(r,e,t,s){if(r===e&&t===s)return cr;const i=n=>qD(n,0,1,r,t);return n=>n===0||n===1?n:gA(i(n),e,s)}const yA=r=>e=>e<=.5?r(2*e)/2:(2-r(2*(1-e)))/2,xA=r=>e=>1-r(1-e),bA=fu(.33,1.53,.69,.99),lx=xA(bA),vA=yA(lx),wA=r=>(r*=2)<1?.5*lx(r):.5*(2-Math.pow(2,-10*(r-1))),dx=r=>1-Math.sin(Math.acos(r)),kA=xA(dx),CA=yA(dx),HD=fu(.42,0,1,1),XD=fu(0,0,.58,1),SA=fu(.42,0,.58,1),KD=r=>Array.isArray(r)&&typeof r[0]!="number",TA=r=>Array.isArray(r)&&typeof r[0]=="number",QD={linear:cr,easeIn:HD,easeInOut:SA,easeOut:XD,circIn:dx,circInOut:CA,circOut:kA,backIn:lx,backInOut:vA,backOut:bA,anticipate:wA},JD=r=>typeof r=="string",g1=r=>{if(TA(r)){ax(r.length===4);const[e,t,s,i]=r;return fu(e,t,s,i)}else if(JD(r))return QD[r];return r},Lu=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function ZD(r,e){let t=new Set,s=new Set,i=!1,n=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(u){a.has(u)&&(d.schedule(u),r()),u(o)}const d={schedule:(u,h=!1,p=!1)=>{const m=p&&i?t:s;return h&&a.add(u),m.has(u)||m.add(u),u},cancel:u=>{s.delete(u),a.delete(u)},process:u=>{if(o=u,i){n=!0;return}i=!0,[t,s]=[s,t],t.forEach(l),t.clear(),i=!1,n&&(n=!1,d.process(u))}};return d}const e5=40;function AA(r,e){let t=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},n=()=>t=!0,a=Lu.reduce((w,C)=>(w[C]=ZD(n),w),{}),{setup:o,read:l,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:f,postRender:m}=a,g=()=>{const w=bn.useManualTiming?i.timestamp:performance.now();t=!1,bn.useManualTiming||(i.delta=s?1e3/60:Math.max(Math.min(w-i.timestamp,e5),1)),i.timestamp=w,i.isProcessing=!0,o.process(i),l.process(i),d.process(i),u.process(i),h.process(i),p.process(i),f.process(i),m.process(i),i.isProcessing=!1,t&&e&&(s=!1,r(g))},y=()=>{t=!0,s=!0,i.isProcessing||r(g)};return{schedule:Lu.reduce((w,C)=>{const k=a[C];return w[C]=(S,A=!1,T=!1)=>(t||y(),k.schedule(S,A,T)),w},{}),cancel:w=>{for(let C=0;C<Lu.length;C++)a[Lu[C]].cancel(w)},state:i,steps:a}}const{schedule:Vt,cancel:da,state:Ds,steps:$f}=AA(typeof requestAnimationFrame<"u"?requestAnimationFrame:cr,!0);let jh;function t5(){jh=void 0}const wi={now:()=>(jh===void 0&&wi.set(Ds.isProcessing||bn.useManualTiming?Ds.timestamp:performance.now()),jh),set:r=>{jh=r,queueMicrotask(t5)}},jA=r=>e=>typeof e=="string"&&e.startsWith(r),ux=jA("--"),s5=jA("var(--"),hx=r=>s5(r)?i5.test(r.split("/*")[0].trim()):!1,i5=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,el={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},Bd={...el,transform:r=>xn(0,1,r)},Ou={...el,default:1},md=r=>Math.round(r*1e5)/1e5,px=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function r5(r){return r==null}const n5=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,fx=(r,e)=>t=>!!(typeof t=="string"&&n5.test(t)&&t.startsWith(r)||e&&!r5(t)&&Object.prototype.hasOwnProperty.call(t,e)),_A=(r,e,t)=>s=>{if(typeof s!="string")return s;const[i,n,a,o]=s.match(px);return{[r]:parseFloat(i),[e]:parseFloat(n),[t]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},a5=r=>xn(0,255,r),zf={...el,transform:r=>Math.round(a5(r))},io={test:fx("rgb","red"),parse:_A("red","green","blue"),transform:({red:r,green:e,blue:t,alpha:s=1})=>"rgba("+zf.transform(r)+", "+zf.transform(e)+", "+zf.transform(t)+", "+md(Bd.transform(s))+")"};function o5(r){let e="",t="",s="",i="";return r.length>5?(e=r.substring(1,3),t=r.substring(3,5),s=r.substring(5,7),i=r.substring(7,9)):(e=r.substring(1,2),t=r.substring(2,3),s=r.substring(3,4),i=r.substring(4,5),e+=e,t+=t,s+=s,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const t0={test:fx("#"),parse:o5,transform:io.transform},mu=r=>({test:e=>typeof e=="string"&&e.endsWith(r)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${r}`}),Yn=mu("deg"),$r=mu("%"),Ke=mu("px"),c5=mu("vh"),l5=mu("vw"),y1={...$r,parse:r=>$r.parse(r)/100,transform:r=>$r.transform(r*100)},ac={test:fx("hsl","hue"),parse:_A("hue","saturation","lightness"),transform:({hue:r,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(r)+", "+$r.transform(md(e))+", "+$r.transform(md(t))+", "+md(Bd.transform(s))+")"},fs={test:r=>io.test(r)||t0.test(r)||ac.test(r),parse:r=>io.test(r)?io.parse(r):ac.test(r)?ac.parse(r):t0.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?io.transform(r):ac.transform(r),getAnimatableNone:r=>{const e=fs.parse(r);return e.alpha=0,fs.transform(e)}},d5=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function u5(r){return isNaN(r)&&typeof r=="string"&&(r.match(px)?.length||0)+(r.match(d5)?.length||0)>0}const EA="number",MA="color",h5="var",p5="var(",x1="${}",f5=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Ld(r){const e=r.toString(),t=[],s={color:[],number:[],var:[]},i=[];let n=0;const o=e.replace(f5,l=>(fs.test(l)?(s.color.push(n),i.push(MA),t.push(fs.parse(l))):l.startsWith(p5)?(s.var.push(n),i.push(h5),t.push(l)):(s.number.push(n),i.push(EA),t.push(parseFloat(l))),++n,x1)).split(x1);return{values:t,split:o,indexes:s,types:i}}function PA(r){return Ld(r).values}function NA(r){const{split:e,types:t}=Ld(r),s=e.length;return i=>{let n="";for(let a=0;a<s;a++)if(n+=e[a],i[a]!==void 0){const o=t[a];o===EA?n+=md(i[a]):o===MA?n+=fs.transform(i[a]):n+=i[a]}return n}}const m5=r=>typeof r=="number"?0:fs.test(r)?fs.getAnimatableNone(r):r;function g5(r){const e=PA(r);return NA(r)(e.map(m5))}const ua={test:u5,parse:PA,createTransformer:NA,getAnimatableNone:g5};function Vf(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function y5({hue:r,saturation:e,lightness:t,alpha:s}){r/=360,e/=100,t/=100;let i=0,n=0,a=0;if(!e)i=n=a=t;else{const o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;i=Vf(l,o,r+1/3),n=Vf(l,o,r),a=Vf(l,o,r-1/3)}return{red:Math.round(i*255),green:Math.round(n*255),blue:Math.round(a*255),alpha:s}}function lp(r,e){return t=>t>0?e:r}const Xt=(r,e,t)=>r+(e-r)*t,Uf=(r,e,t)=>{const s=r*r,i=t*(e*e-s)+s;return i<0?0:Math.sqrt(i)},x5=[t0,io,ac],b5=r=>x5.find(e=>e.test(r));function b1(r){const e=b5(r);if(!e)return!1;let t=e.parse(r);return e===ac&&(t=y5(t)),t}const v1=(r,e)=>{const t=b1(r),s=b1(e);if(!t||!s)return lp(r,e);const i={...t};return n=>(i.red=Uf(t.red,s.red,n),i.green=Uf(t.green,s.green,n),i.blue=Uf(t.blue,s.blue,n),i.alpha=Xt(t.alpha,s.alpha,n),io.transform(i))},s0=new Set(["none","hidden"]);function v5(r,e){return s0.has(r)?t=>t<=0?r:e:t=>t>=1?e:r}function w5(r,e){return t=>Xt(r,e,t)}function mx(r){return typeof r=="number"?w5:typeof r=="string"?hx(r)?lp:fs.test(r)?v1:S5:Array.isArray(r)?RA:typeof r=="object"?fs.test(r)?v1:k5:lp}function RA(r,e){const t=[...r],s=t.length,i=r.map((n,a)=>mx(n)(n,e[a]));return n=>{for(let a=0;a<s;a++)t[a]=i[a](n);return t}}function k5(r,e){const t={...r,...e},s={};for(const i in t)r[i]!==void 0&&e[i]!==void 0&&(s[i]=mx(r[i])(r[i],e[i]));return i=>{for(const n in s)t[n]=s[n](i);return t}}function C5(r,e){const t=[],s={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const n=e.types[i],a=r.indexes[n][s[n]],o=r.values[a]??0;t[i]=o,s[n]++}return t}const S5=(r,e)=>{const t=ua.createTransformer(e),s=Ld(r),i=Ld(e);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?s0.has(r)&&!i.values.length||s0.has(e)&&!s.values.length?v5(r,e):pu(RA(C5(s,i),i.values),t):lp(r,e)};function IA(r,e,t){return typeof r=="number"&&typeof e=="number"&&typeof t=="number"?Xt(r,e,t):mx(r)(r,e)}const T5=r=>{const e=({timestamp:t})=>r(t);return{start:(t=!0)=>Vt.update(e,t),stop:()=>da(e),now:()=>Ds.isProcessing?Ds.timestamp:wi.now()}},DA=(r,e,t=10)=>{let s="";const i=Math.max(Math.round(e/t),2);for(let n=0;n<i;n++)s+=Math.round(r(n/(i-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},dp=2e4;function gx(r){let e=0;const t=50;let s=r.next(e);for(;!s.done&&e<dp;)e+=t,s=r.next(e);return e>=dp?1/0:e}function A5(r,e=100,t){const s=t({...r,keyframes:[0,e]}),i=Math.min(gx(s),dp);return{type:"keyframes",ease:n=>s.next(i*n).value/e,duration:tr(i)}}const j5=5;function FA(r,e,t){const s=Math.max(e-j5,0);return mA(t-r(s),e-s)}const Zt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Gf=.001;function _5({duration:r=Zt.duration,bounce:e=Zt.bounce,velocity:t=Zt.velocity,mass:s=Zt.mass}){let i,n,a=1-e;a=xn(Zt.minDamping,Zt.maxDamping,a),r=xn(Zt.minDuration,Zt.maxDuration,tr(r)),a<1?(i=d=>{const u=d*a,h=u*r,p=u-t,f=i0(d,a),m=Math.exp(-h);return Gf-p/f*m},n=d=>{const h=d*a*r,p=h*t+t,f=Math.pow(a,2)*Math.pow(d,2)*r,m=Math.exp(-h),g=i0(Math.pow(d,2),a);return(-i(d)+Gf>0?-1:1)*((p-f)*m)/g}):(i=d=>{const u=Math.exp(-d*r),h=(d-t)*r+1;return-Gf+u*h},n=d=>{const u=Math.exp(-d*r),h=(t-d)*(r*r);return u*h});const o=5/r,l=M5(i,n,o);if(r=Or(r),isNaN(l))return{stiffness:Zt.stiffness,damping:Zt.damping,duration:r};{const d=Math.pow(l,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:r}}}const E5=12;function M5(r,e,t){let s=t;for(let i=1;i<E5;i++)s=s-r(s)/e(s);return s}function i0(r,e){return r*Math.sqrt(1-e*e)}const P5=["duration","bounce"],N5=["stiffness","damping","mass"];function w1(r,e){return e.some(t=>r[t]!==void 0)}function R5(r){let e={velocity:Zt.velocity,stiffness:Zt.stiffness,damping:Zt.damping,mass:Zt.mass,isResolvedFromDuration:!1,...r};if(!w1(r,N5)&&w1(r,P5))if(r.visualDuration){const t=r.visualDuration,s=2*Math.PI/(t*1.2),i=s*s,n=2*xn(.05,1,1-(r.bounce||0))*Math.sqrt(i);e={...e,mass:Zt.mass,stiffness:i,damping:n}}else{const t=_5(r);e={...e,...t,mass:Zt.mass},e.isResolvedFromDuration=!0}return e}function up(r=Zt.visualDuration,e=Zt.bounce){const t=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:e}:r;let{restSpeed:s,restDelta:i}=t;const n=t.keyframes[0],a=t.keyframes[t.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:f}=R5({...t,velocity:-tr(t.velocity||0)}),m=p||0,g=d/(2*Math.sqrt(l*u)),y=a-n,x=tr(Math.sqrt(l/u)),b=Math.abs(y)<5;s||(s=b?Zt.restSpeed.granular:Zt.restSpeed.default),i||(i=b?Zt.restDelta.granular:Zt.restDelta.default);let w;if(g<1){const k=i0(x,g);w=S=>{const A=Math.exp(-g*x*S);return a-A*((m+g*x*y)/k*Math.sin(k*S)+y*Math.cos(k*S))}}else if(g===1)w=k=>a-Math.exp(-x*k)*(y+(m+x*y)*k);else{const k=x*Math.sqrt(g*g-1);w=S=>{const A=Math.exp(-g*x*S),T=Math.min(k*S,300);return a-A*((m+g*x*y)*Math.sinh(T)+k*y*Math.cosh(T))/k}}const C={calculatedDuration:f&&h||null,next:k=>{const S=w(k);if(f)o.done=k>=h;else{let A=k===0?m:0;g<1&&(A=k===0?Or(m):FA(w,k,S));const T=Math.abs(A)<=s,j=Math.abs(a-S)<=i;o.done=T&&j}return o.value=o.done?a:S,o},toString:()=>{const k=Math.min(gx(C),dp),S=DA(A=>C.next(k*A).value,k,30);return k+"ms "+S},toTransition:()=>{}};return C}up.applyToOptions=r=>{const e=A5(r,100,up);return r.ease=e.ease,r.duration=Or(e.duration),r.type="keyframes",r};function r0({keyframes:r,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:n=500,modifyTarget:a,min:o,max:l,restDelta:d=.5,restSpeed:u}){const h=r[0],p={done:!1,value:h},f=T=>o!==void 0&&T<o||l!==void 0&&T>l,m=T=>o===void 0?l:l===void 0||Math.abs(o-T)<Math.abs(l-T)?o:l;let g=t*e;const y=h+g,x=a===void 0?y:a(y);x!==y&&(g=x-h);const b=T=>-g*Math.exp(-T/s),w=T=>x+b(T),C=T=>{const j=b(T),_=w(T);p.done=Math.abs(j)<=d,p.value=p.done?x:_};let k,S;const A=T=>{f(p.value)&&(k=T,S=up({keyframes:[p.value,m(p.value)],velocity:FA(w,T,p.value),damping:i,stiffness:n,restDelta:d,restSpeed:u}))};return A(0),{calculatedDuration:null,next:T=>{let j=!1;return!S&&k===void 0&&(j=!0,C(T),A(T)),k!==void 0&&T>=k?S.next(T-k):(!j&&C(T),p)}}}function I5(r,e,t){const s=[],i=t||bn.mix||IA,n=r.length-1;for(let a=0;a<n;a++){let o=i(r[a],r[a+1]);if(e){const l=Array.isArray(e)?e[a]||cr:e;o=pu(l,o)}s.push(o)}return s}function D5(r,e,{clamp:t=!0,ease:s,mixer:i}={}){const n=r.length;if(ax(n===e.length),n===1)return()=>e[0];if(n===2&&e[0]===e[1])return()=>e[1];const a=r[0]===r[1];r[0]>r[n-1]&&(r=[...r].reverse(),e=[...e].reverse());const o=I5(e,s,i),l=o.length,d=u=>{if(a&&u<r[0])return e[0];let h=0;if(l>1)for(;h<r.length-2&&!(u<r[h+1]);h++);const p=Fd(r[h],r[h+1],u);return o[h](p)};return t?u=>d(xn(r[0],r[n-1],u)):d}function F5(r,e){const t=r[r.length-1];for(let s=1;s<=e;s++){const i=Fd(0,e,s);r.push(Xt(t,1,i))}}function B5(r){const e=[0];return F5(e,r.length-1),e}function L5(r,e){return r.map(t=>t*e)}function O5(r,e){return r.map(()=>e||SA).splice(0,r.length-1)}function gd({duration:r=300,keyframes:e,times:t,ease:s="easeInOut"}){const i=KD(s)?s.map(g1):g1(s),n={done:!1,value:e[0]},a=L5(t&&t.length===e.length?t:B5(e),r),o=D5(a,e,{ease:Array.isArray(i)?i:O5(e,i)});return{calculatedDuration:r,next:l=>(n.value=o(l),n.done=l>=r,n)}}const $5=r=>r!==null;function yx(r,{repeat:e,repeatType:t="loop"},s,i=1){const n=r.filter($5),o=i<0||e&&t!=="loop"&&e%2===1?0:n.length-1;return!o||s===void 0?n[o]:s}const z5={decay:r0,inertia:r0,tween:gd,keyframes:gd,spring:up};function BA(r){typeof r.type=="string"&&(r.type=z5[r.type])}let xx=class{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}};const V5=r=>r/100;let bx=class extends xx{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==wi.now()&&this.tick(wi.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;BA(e);const{type:t=gd,repeat:s=0,repeatDelay:i=0,repeatType:n,velocity:a=0}=e;let{keyframes:o}=e;const l=t||gd;l!==gd&&typeof o[0]!="number"&&(this.mixKeyframes=pu(V5,IA(o[0],o[1])),o=[0,100]);const d=l({...e,keyframes:o});n==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...o].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=gx(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(s+1)-i,this.generator=d}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:i,mixKeyframes:n,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:f,type:m,onUpdate:g,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const x=this.currentTime-d*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?x<0:x>i;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let w=this.currentTime,C=s;if(h){const T=Math.min(this.currentTime,i)/o;let j=Math.floor(T),_=T%1;!_&&T>=1&&(_=1),_===1&&j--,j=Math.min(j,h+1),!!(j%2)&&(p==="reverse"?(_=1-_,f&&(_-=f/o)):p==="mirror"&&(C=a)),w=xn(0,1,_)*o}const k=b?{done:!1,value:u[0]}:C.next(w);n&&(k.value=n(k.value));let{done:S}=k;!b&&l!==null&&(S=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const A=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return A&&m!==r0&&(k.value=yx(u,this.options,y,this.speed)),g&&g(k.value),A&&this.finish(),k}then(e,t){return this.finished.then(e,t)}get duration(){return tr(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+tr(e)}get time(){return tr(this.currentTime)}set time(e){e=Or(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(wi.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=tr(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=T5,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(wi.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}};function U5(r){for(let e=1;e<r.length;e++)r[e]??(r[e]=r[e-1])}const ro=r=>r*180/Math.PI,n0=r=>{const e=ro(Math.atan2(r[1],r[0]));return a0(e)},G5={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:n0,rotateZ:n0,skewX:r=>ro(Math.atan(r[1])),skewY:r=>ro(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},a0=r=>(r=r%360,r<0&&(r+=360),r),k1=n0,C1=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),S1=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),W5={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:C1,scaleY:S1,scale:r=>(C1(r)+S1(r))/2,rotateX:r=>a0(ro(Math.atan2(r[6],r[5]))),rotateY:r=>a0(ro(Math.atan2(-r[2],r[0]))),rotateZ:k1,rotate:k1,skewX:r=>ro(Math.atan(r[4])),skewY:r=>ro(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function o0(r){return r.includes("scale")?1:0}function c0(r,e){if(!r||r==="none")return o0(e);const t=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,i;if(t)s=W5,i=t;else{const o=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=G5,i=o}if(!i)return o0(e);const n=s[e],a=i[1].split(",").map(q5);return typeof n=="function"?n(a):a[n]}const Y5=(r,e)=>{const{transform:t="none"}=getComputedStyle(r);return c0(t,e)};function q5(r){return parseFloat(r.trim())}const tl=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],sl=new Set(tl),T1=r=>r===el||r===Ke,H5=new Set(["x","y","z"]),X5=tl.filter(r=>!H5.has(r));function K5(r){const e=[];return X5.forEach(t=>{const s=r.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const po={width:({x:r},{paddingLeft:e="0",paddingRight:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),height:({y:r},{paddingTop:e="0",paddingBottom:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),top:(r,{top:e})=>parseFloat(e),left:(r,{left:e})=>parseFloat(e),bottom:({y:r},{top:e})=>parseFloat(e)+(r.max-r.min),right:({x:r},{left:e})=>parseFloat(e)+(r.max-r.min),x:(r,{transform:e})=>c0(e,"x"),y:(r,{transform:e})=>c0(e,"y")};po.translateX=po.x;po.translateY=po.y;const fo=new Set;let l0=!1,d0=!1,u0=!1;function LA(){if(d0){const r=Array.from(fo).filter(s=>s.needsMeasurement),e=new Set(r.map(s=>s.element)),t=new Map;e.forEach(s=>{const i=K5(s);i.length&&(t.set(s,i),s.render())}),r.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const i=t.get(s);i&&i.forEach(([n,a])=>{s.getValue(n)?.set(a)})}),r.forEach(s=>s.measureEndState()),r.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}d0=!1,l0=!1,fo.forEach(r=>r.complete(u0)),fo.clear()}function OA(){fo.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(d0=!0)})}function Q5(){u0=!0,OA(),LA(),u0=!1}let vx=class{constructor(e,t,s,i,n,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=n,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(fo.add(this),l0||(l0=!0,Vt.read(OA),Vt.resolveKeyframes(LA))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;if(e[0]===null){const n=i?.get(),a=e[e.length-1];if(n!==void 0)e[0]=n;else if(s&&t){const o=s.readValue(t,a);o!=null&&(e[0]=o)}e[0]===void 0&&(e[0]=a),i&&n===void 0&&i.set(e[0])}U5(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),fo.delete(this)}cancel(){this.state==="scheduled"&&(fo.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}};const J5=r=>r.startsWith("--");function Z5(r,e,t){J5(e)?r.style.setProperty(e,t):r.style[e]=t}const e3=ox(()=>window.ScrollTimeline!==void 0),t3={};function s3(r,e){const t=ox(r);return()=>t3[e]??t()}const $A=s3(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Zl=([r,e,t,s])=>`cubic-bezier(${r}, ${e}, ${t}, ${s})`,A1={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Zl([0,.65,.55,1]),circOut:Zl([.55,0,1,.45]),backIn:Zl([.31,.01,.66,-.59]),backOut:Zl([.33,1.53,.69,.99])};function zA(r,e){if(r)return typeof r=="function"?$A()?DA(r,e):"ease-out":TA(r)?Zl(r):Array.isArray(r)?r.map(t=>zA(t,e)||A1.easeOut):A1[r]}function i3(r,e,t,{delay:s=0,duration:i=300,repeat:n=0,repeatType:a="loop",ease:o="easeOut",times:l}={},d=void 0){const u={[e]:t};l&&(u.offset=l);const h=zA(o,i);Array.isArray(h)&&(u.easing=h);const p={delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:n+1,direction:a==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),r.animate(u,p)}function VA(r){return typeof r=="function"&&"applyToOptions"in r}function r3({type:r,...e}){return VA(r)&&$A()?r.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}let n3=class extends xx{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:t,name:s,keyframes:i,pseudoElement:n,allowFlatten:a=!1,finalKeyframe:o,onComplete:l}=e;this.isPseudoElement=!!n,this.allowFlatten=a,this.options=e,ax(typeof e.type!="string");const d=r3(e);this.animation=i3(t,s,i,d,n),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!n){const u=yx(i,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(u):Z5(t,s,u),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return tr(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+tr(e)}get time(){return tr(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Or(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&e3()?(this.animation.timeline=e,cr):t(this)}};const UA={anticipate:wA,backInOut:vA,circInOut:CA};function a3(r){return r in UA}function o3(r){typeof r.ease=="string"&&a3(r.ease)&&(r.ease=UA[r.ease])}const j1=10;let c3=class extends n3{constructor(e){o3(e),BA(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:i,element:n,...a}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const o=new bx({...a,autoplay:!1}),l=Or(this.finishedTime??this.time);t.setWithVelocity(o.sample(l-j1).value,o.sample(l).value,j1),o.stop()}};const _1=(r,e)=>e==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(ua.test(r)||r==="0")&&!r.startsWith("url("));function l3(r){const e=r[0];if(r.length===1)return!0;for(let t=0;t<r.length;t++)if(r[t]!==e)return!0}function d3(r,e,t,s){const i=r[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const n=r[r.length-1],a=_1(i,e),o=_1(n,e);return!a||!o?!1:l3(r)||(t==="spring"||VA(t))&&s}function h0(r){r.duration=0,r.type="keyframes"}const u3=new Set(["opacity","clipPath","filter","transform"]),h3=ox(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function p3(r){const{motionValue:e,name:t,repeatDelay:s,repeatType:i,damping:n,type:a}=r;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:d}=e.owner.getProps();return h3()&&t&&u3.has(t)&&(t!=="transform"||!d)&&!l&&!s&&i!=="mirror"&&n!==0&&a!=="inertia"}const f3=40;let m3=class extends xx{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:n=0,repeatType:a="loop",keyframes:o,name:l,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=wi.now();const p={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:n,repeatType:a,name:l,motionValue:d,element:u,...h},f=u?.KeyframeResolver||vx;this.keyframeResolver=new f(o,(m,g,y)=>this.onKeyframesResolved(m,g,p,!y),l,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,i){this.keyframeResolver=void 0;const{name:n,type:a,velocity:o,delay:l,isHandoff:d,onUpdate:u}=s;this.resolvedAt=wi.now(),d3(e,n,a,o)||((bn.instantAnimations||!l)&&u?.(yx(e,s,t)),e[0]=e[e.length-1],h0(s),s.repeat=0);const p={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>f3?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},f=!d&&p3(p)?new c3({...p,element:p.motionValue.owner.current}):new bx(p);f.finished.then(()=>this.notifyFinished()).catch(cr),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),Q5()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}};const g3=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function y3(r){const e=g3.exec(r);if(!e)return[,];const[,t,s,i]=e;return[`--${t??s}`,i]}function GA(r,e,t=1){const[s,i]=y3(r);if(!s)return;const n=window.getComputedStyle(e).getPropertyValue(s);if(n){const a=n.trim();return hA(a)?parseFloat(a):a}return hx(i)?GA(i,e,t+1):i}function wx(r,e){return r?.[e]??r?.default??r}const WA=new Set(["width","height","top","left","right","bottom",...tl]),x3={test:r=>r==="auto",parse:r=>r},YA=r=>e=>e.test(r),qA=[el,Ke,$r,Yn,l5,c5,x3],E1=r=>qA.find(YA(r));function b3(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||fA(r):!0}const v3=new Set(["brightness","contrast","saturate","opacity"]);function w3(r){const[e,t]=r.slice(0,-1).split("(");if(e==="drop-shadow")return r;const[s]=t.match(px)||[];if(!s)return r;const i=t.replace(s,"");let n=v3.has(e)?1:0;return s!==t&&(n*=100),e+"("+n+i+")"}const k3=/\b([a-z-]*)\(.*?\)/gu,p0={...ua,getAnimatableNone:r=>{const e=r.match(k3);return e?e.map(w3).join(" "):r}},M1={...el,transform:Math.round},C3={rotate:Yn,rotateX:Yn,rotateY:Yn,rotateZ:Yn,scale:Ou,scaleX:Ou,scaleY:Ou,scaleZ:Ou,skew:Yn,skewX:Yn,skewY:Yn,distance:Ke,translateX:Ke,translateY:Ke,translateZ:Ke,x:Ke,y:Ke,z:Ke,perspective:Ke,transformPerspective:Ke,opacity:Bd,originX:y1,originY:y1,originZ:Ke},kx={borderWidth:Ke,borderTopWidth:Ke,borderRightWidth:Ke,borderBottomWidth:Ke,borderLeftWidth:Ke,borderRadius:Ke,radius:Ke,borderTopLeftRadius:Ke,borderTopRightRadius:Ke,borderBottomRightRadius:Ke,borderBottomLeftRadius:Ke,width:Ke,maxWidth:Ke,height:Ke,maxHeight:Ke,top:Ke,right:Ke,bottom:Ke,left:Ke,padding:Ke,paddingTop:Ke,paddingRight:Ke,paddingBottom:Ke,paddingLeft:Ke,margin:Ke,marginTop:Ke,marginRight:Ke,marginBottom:Ke,marginLeft:Ke,backgroundPositionX:Ke,backgroundPositionY:Ke,...C3,zIndex:M1,fillOpacity:Bd,strokeOpacity:Bd,numOctaves:M1},S3={...kx,color:fs,backgroundColor:fs,outlineColor:fs,fill:fs,stroke:fs,borderColor:fs,borderTopColor:fs,borderRightColor:fs,borderBottomColor:fs,borderLeftColor:fs,filter:p0,WebkitFilter:p0},HA=r=>S3[r];function XA(r,e){let t=HA(r);return t!==p0&&(t=ua),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const T3=new Set(["auto","none","0"]);function A3(r,e,t){let s=0,i;for(;s<r.length&&!i;){const n=r[s];typeof n=="string"&&!T3.has(n)&&Ld(n).values.length&&(i=r[s]),s++}if(i&&t)for(const n of e)r[n]=XA(t,i)}let j3=class extends vx{constructor(e,t,s,i,n){super(e,t,s,i,n,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let d=e[l];if(typeof d=="string"&&(d=d.trim(),hx(d))){const u=GA(d,t.current);u!==void 0&&(e[l]=u),l===e.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!WA.has(s)||e.length!==2)return;const[i,n]=e,a=E1(i),o=E1(n);if(a!==o)if(T1(a)&&T1(o))for(let l=0;l<e.length;l++){const d=e[l];typeof d=="string"&&(e[l]=parseFloat(d))}else po[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let i=0;i<e.length;i++)(e[i]===null||b3(e[i]))&&s.push(i);s.length&&A3(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=po[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(s,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const n=s.length-1,a=s[n];s[n]=po[t](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,l])=>{e.getValue(o).set(l)}),this.resolveNoneKeyframes()}};function _3(r,e,t){if(r instanceof EventTarget)return[r];if(typeof r=="string"){let s=document;const i=t?.[r]??s.querySelectorAll(r);return i?Array.from(i):[]}return Array.from(r)}const KA=(r,e)=>e&&typeof r=="number"?e.transform(r):r;function QA(r){return pA(r)&&"offsetHeight"in r}const P1=30,E3=r=>!isNaN(parseFloat(r));let M3=class{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const i=wi.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const n of this.dependents)n.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=wi.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=E3(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new cx);const s=this.events[e].add(t);return e==="change"?()=>{s(),Vt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=wi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>P1)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,P1);return mA(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}};function Oc(r,e){return new M3(r,e)}const{schedule:Cx}=AA(queueMicrotask,!1),yr={x:!1,y:!1};function JA(){return yr.x||yr.y}function P3(r){return r==="x"||r==="y"?yr[r]?null:(yr[r]=!0,()=>{yr[r]=!1}):yr.x||yr.y?null:(yr.x=yr.y=!0,()=>{yr.x=yr.y=!1})}function ZA(r,e){const t=_3(r),s=new AbortController,i={passive:!0,...e,signal:s.signal};return[t,i,()=>s.abort()]}function N1(r){return!(r.pointerType==="touch"||JA())}function N3(r,e,t={}){const[s,i,n]=ZA(r,t),a=o=>{if(!N1(o))return;const{target:l}=o,d=e(l,o);if(typeof d!="function"||!l)return;const u=h=>{N1(h)&&(d(h),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,i)};return s.forEach(o=>{o.addEventListener("pointerenter",a,i)}),n}const ej=(r,e)=>e?r===e?!0:ej(r,e.parentElement):!1,Sx=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,R3=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function I3(r){return R3.has(r.tagName)||r.tabIndex!==-1}const _h=new WeakSet;function R1(r){return e=>{e.key==="Enter"&&r(e)}}function Wf(r,e){r.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const D3=(r,e)=>{const t=r.currentTarget;if(!t)return;const s=R1(()=>{if(_h.has(t))return;Wf(t,"down");const i=R1(()=>{Wf(t,"up")}),n=()=>Wf(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",n,e)});t.addEventListener("keydown",s,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",s),e)};function I1(r){return Sx(r)&&!JA()}function F3(r,e,t={}){const[s,i,n]=ZA(r,t),a=o=>{const l=o.currentTarget;if(!I1(o))return;_h.add(l);const d=e(l,o),u=(f,m)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),_h.has(l)&&_h.delete(l),I1(f)&&typeof d=="function"&&d(f,{success:m})},h=f=>{u(f,l===window||l===document||t.useGlobalTarget||ej(l,f.target))},p=f=>{u(f,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",p,i)};return s.forEach(o=>{(t.useGlobalTarget?window:o).addEventListener("pointerdown",a,i),QA(o)&&(o.addEventListener("focus",d=>D3(d,i)),!I3(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),n}function tj(r){return pA(r)&&"ownerSVGElement"in r}function B3(r){return tj(r)&&r.tagName==="svg"}const Ks=r=>!!(r&&r.getVelocity),L3=[...qA,fs,ua],O3=r=>L3.find(YA(r)),Tx=v.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function D1(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function $3(...r){return e=>{let t=!1;const s=r.map(i=>{const n=D1(i,e);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let i=0;i<s.length;i++){const n=s[i];typeof n=="function"?n():D1(r[i],null)}}}}function z3(...r){return v.useCallback($3(...r),r)}let V3=class extends v.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=t.offsetParent,i=QA(s)&&s.offsetWidth||0,n=this.props.sizeRef.current;n.height=t.offsetHeight||0,n.width=t.offsetWidth||0,n.top=t.offsetTop,n.left=t.offsetLeft,n.right=i-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}};function U3({children:r,isPresent:e,anchorX:t,root:s}){const i=v.useId(),n=v.useRef(null),a=v.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=v.useContext(Tx),l=z3(n,r?.ref);return v.useInsertionEffect(()=>{const{width:d,height:u,top:h,left:p,right:f}=a.current;if(e||!n.current||!d||!u)return;const m=t==="left"?`left: ${p}`:`right: ${f}`;n.current.dataset.motionPopId=i;const g=document.createElement("style");o&&(g.nonce=o);const y=s??document.head;return y.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${u}px !important;
            ${m}px !important;
            top: ${h}px !important;
          }
        `),()=>{y.contains(g)&&y.removeChild(g)}},[e]),c.jsx(V3,{isPresent:e,childRef:n,sizeRef:a,children:v.cloneElement(r,{ref:l})})}const G3=({children:r,initial:e,isPresent:t,onExitComplete:s,custom:i,presenceAffectsLayout:n,mode:a,anchorX:o,root:l})=>{const d=sx(W3),u=v.useId();let h=!0,p=v.useMemo(()=>(h=!1,{id:u,initial:e,isPresent:t,custom:i,onExitComplete:f=>{d.set(f,!0);for(const m of d.values())if(!m)return;s&&s()},register:f=>(d.set(f,!1),()=>d.delete(f))}),[t,d,s]);return n&&h&&(p={...p}),v.useMemo(()=>{d.forEach((f,m)=>d.set(m,!1))},[t]),v.useEffect(()=>{!t&&!d.size&&s&&s()},[t]),a==="popLayout"&&(r=c.jsx(U3,{isPresent:t,anchorX:o,root:l,children:r})),c.jsx(Hp.Provider,{value:p,children:r})};function W3(){return new Map}function sj(r=!0){const e=v.useContext(Hp);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:i}=e,n=v.useId();v.useEffect(()=>{if(r)return i(n)},[r]);const a=v.useCallback(()=>r&&s&&s(n),[n,s,r]);return!t&&s?[!1,a]:[!0]}const $u=r=>r.key||"";function F1(r){const e=[];return v.Children.forEach(r,t=>{v.isValidElement(t)&&e.push(t)}),e}const Ax=({children:r,custom:e,initial:t=!0,onExitComplete:s,presenceAffectsLayout:i=!0,mode:n="sync",propagate:a=!1,anchorX:o="left",root:l})=>{const[d,u]=sj(a),h=v.useMemo(()=>F1(r),[r]),p=a&&!d?[]:h.map($u),f=v.useRef(!0),m=v.useRef(h),g=sx(()=>new Map),[y,x]=v.useState(h),[b,w]=v.useState(h);uA(()=>{f.current=!1,m.current=h;for(let S=0;S<b.length;S++){const A=$u(b[S]);p.includes(A)?g.delete(A):g.get(A)!==!0&&g.set(A,!1)}},[b,p.length,p.join("-")]);const C=[];if(h!==y){let S=[...h];for(let A=0;A<b.length;A++){const T=b[A],j=$u(T);p.includes(j)||(S.splice(A,0,T),C.push(T))}return n==="wait"&&C.length&&(S=C),w(F1(S)),x(h),null}const{forceRender:k}=v.useContext(tx);return c.jsx(c.Fragment,{children:b.map(S=>{const A=$u(S),T=a&&!d?!1:h===b||p.includes(A),j=()=>{if(g.has(A))g.set(A,!0);else return;let _=!0;g.forEach(M=>{M||(_=!1)}),_&&(k?.(),w(m.current),a&&u?.(),s&&s())};return c.jsx(G3,{isPresent:T,initial:!f.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:n,root:l,onExitComplete:T?void 0:j,anchorX:o,children:S},A)})})},ij=v.createContext({strict:!1}),B1={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},$c={};for(const r in B1)$c[r]={isEnabled:e=>B1[r].some(t=>!!e[t])};function Y3(r){for(const e in r)$c[e]={...$c[e],...r[e]}}const q3=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function hp(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||q3.has(r)}let rj=r=>!hp(r);function H3(r){typeof r=="function"&&(rj=e=>e.startsWith("on")?!hp(e):r(e))}try{H3(require("@emotion/is-prop-valid").default)}catch{}function X3(r,e,t){const s={};for(const i in r)i==="values"&&typeof r.values=="object"||(rj(i)||t===!0&&hp(i)||!e&&!hp(i)||r.draggable&&i.startsWith("onDrag"))&&(s[i]=r[i]);return s}const Xp=v.createContext({});function Kp(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function Od(r){return typeof r=="string"||Array.isArray(r)}const jx=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],_x=["initial",...jx];function Qp(r){return Kp(r.animate)||_x.some(e=>Od(r[e]))}function nj(r){return!!(Qp(r)||r.variants)}function K3(r,e){if(Qp(r)){const{initial:t,animate:s}=r;return{initial:t===!1||Od(t)?t:void 0,animate:Od(s)?s:void 0}}return r.inherit!==!1?e:{}}function Q3(r){const{initial:e,animate:t}=K3(r,v.useContext(Xp));return v.useMemo(()=>({initial:e,animate:t}),[L1(e),L1(t)])}function L1(r){return Array.isArray(r)?r.join(" "):r}const $d={};function J3(r){for(const e in r)$d[e]=r[e],ux(e)&&($d[e].isCSSVariable=!0)}function aj(r,{layout:e,layoutId:t}){return sl.has(r)||r.startsWith("origin")||(e||t!==void 0)&&(!!$d[r]||r==="opacity")}const Z3={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},e4=tl.length;function t4(r,e,t){let s="",i=!0;for(let n=0;n<e4;n++){const a=tl[n],o=r[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||t){const d=KA(o,kx[a]);if(!l){i=!1;const u=Z3[a]||a;s+=`${u}(${d}) `}t&&(e[a]=d)}}return s=s.trim(),t?s=t(e,i?"":s):i&&(s="none"),s}function Ex(r,e,t){const{style:s,vars:i,transformOrigin:n}=r;let a=!1,o=!1;for(const l in e){const d=e[l];if(sl.has(l)){a=!0;continue}else if(ux(l)){i[l]=d;continue}else{const u=KA(d,kx[l]);l.startsWith("origin")?(o=!0,n[l]=u):s[l]=u}}if(e.transform||(a||t?s.transform=t4(e,r.transform,t):s.transform&&(s.transform="none")),o){const{originX:l="50%",originY:d="50%",originZ:u=0}=n;s.transformOrigin=`${l} ${d} ${u}`}}const Mx=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function oj(r,e,t){for(const s in e)!Ks(e[s])&&!aj(s,t)&&(r[s]=e[s])}function s4({transformTemplate:r},e){return v.useMemo(()=>{const t=Mx();return Ex(t,e,r),Object.assign({},t.vars,t.style)},[e])}function i4(r,e){const t=r.style||{},s={};return oj(s,t,r),Object.assign(s,s4(r,e)),s}function r4(r,e){const t={},s=i4(r,e);return r.drag&&r.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(t.tabIndex=0),t.style=s,t}const n4={offset:"stroke-dashoffset",array:"stroke-dasharray"},a4={offset:"strokeDashoffset",array:"strokeDasharray"};function o4(r,e,t=1,s=0,i=!0){r.pathLength=1;const n=i?n4:a4;r[n.offset]=Ke.transform(-s);const a=Ke.transform(e),o=Ke.transform(t);r[n.array]=`${a} ${o}`}function cj(r,{attrX:e,attrY:t,attrScale:s,pathLength:i,pathSpacing:n=1,pathOffset:a=0,...o},l,d,u){if(Ex(r,o,d),l){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:h,style:p}=r;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),t!==void 0&&(h.y=t),s!==void 0&&(h.scale=s),i!==void 0&&o4(h,i,n,a,!1)}const lj=()=>({...Mx(),attrs:{}}),dj=r=>typeof r=="string"&&r.toLowerCase()==="svg";function c4(r,e,t,s){const i=v.useMemo(()=>{const n=lj();return cj(n,e,dj(s),r.transformTemplate,r.style),{...n.attrs,style:{...n.style}}},[e]);if(r.style){const n={};oj(n,r.style,r),i.style={...n,...i.style}}return i}const l4=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Px(r){return typeof r!="string"||r.includes("-")?!1:!!(l4.indexOf(r)>-1||/[A-Z]/u.test(r))}function d4(r,e,t,{latestValues:s},i,n=!1){const o=(Px(r)?c4:r4)(e,s,i,r),l=X3(e,typeof r=="string",n),d=r!==v.Fragment?{...l,...o,ref:t}:{},{children:u}=e,h=v.useMemo(()=>Ks(u)?u.get():u,[u]);return v.createElement(r,{...d,children:h})}function O1(r){const e=[{},{}];return r?.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function Nx(r,e,t,s){if(typeof e=="function"){const[i,n]=O1(s);e=e(t!==void 0?t:r.custom,i,n)}if(typeof e=="string"&&(e=r.variants&&r.variants[e]),typeof e=="function"){const[i,n]=O1(s);e=e(t!==void 0?t:r.custom,i,n)}return e}function Eh(r){return Ks(r)?r.get():r}function u4({scrapeMotionValuesFromProps:r,createRenderState:e},t,s,i){return{latestValues:h4(t,s,i,r),renderState:e()}}function h4(r,e,t,s){const i={},n=s(r,{});for(const p in n)i[p]=Eh(n[p]);let{initial:a,animate:o}=r;const l=Qp(r),d=nj(r);e&&d&&!l&&r.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let u=t?t.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!Kp(h)){const p=Array.isArray(h)?h:[h];for(let f=0;f<p.length;f++){const m=Nx(r,p[f]);if(m){const{transitionEnd:g,transition:y,...x}=m;for(const b in x){let w=x[b];if(Array.isArray(w)){const C=u?w.length-1:0;w=w[C]}w!==null&&(i[b]=w)}for(const b in g)i[b]=g[b]}}}return i}const uj=r=>(e,t)=>{const s=v.useContext(Xp),i=v.useContext(Hp),n=()=>u4(r,e,s,i);return t?n():sx(n)};function Rx(r,e,t){const{style:s}=r,i={};for(const n in s)(Ks(s[n])||e.style&&Ks(e.style[n])||aj(n,r)||t?.getValue(n)?.liveStyle!==void 0)&&(i[n]=s[n]);return i}const p4=uj({scrapeMotionValuesFromProps:Rx,createRenderState:Mx});function hj(r,e,t){const s=Rx(r,e,t);for(const i in r)if(Ks(r[i])||Ks(e[i])){const n=tl.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[n]=r[i]}return s}const f4=uj({scrapeMotionValuesFromProps:hj,createRenderState:lj}),m4=Symbol.for("motionComponentSymbol");function oc(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function g4(r,e,t){return v.useCallback(s=>{s&&r.onMount&&r.onMount(s),e&&(s?e.mount(s):e.unmount()),t&&(typeof t=="function"?t(s):oc(t)&&(t.current=s))},[e])}const Ix=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),y4="framerAppearId",pj="data-"+Ix(y4),fj=v.createContext({});function x4(r,e,t,s,i){const{visualElement:n}=v.useContext(Xp),a=v.useContext(ij),o=v.useContext(Hp),l=v.useContext(Tx).reducedMotion,d=v.useRef(null);s=s||a.renderer,!d.current&&s&&(d.current=s(r,{visualState:e,parent:n,props:t,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:l}));const u=d.current,h=v.useContext(fj);u&&!u.projection&&i&&(u.type==="html"||u.type==="svg")&&b4(d.current,t,i,h);const p=v.useRef(!1);v.useInsertionEffect(()=>{u&&p.current&&u.update(t,o)});const f=t[pj],m=v.useRef(!!f&&!window.MotionHandoffIsComplete?.(f)&&window.MotionHasOptimisedAnimation?.(f));return uA(()=>{u&&(p.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),m.current&&u.animationState&&u.animationState.animateChanges())}),v.useEffect(()=>{u&&(!m.current&&u.animationState&&u.animationState.animateChanges(),m.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(f)}),m.current=!1),u.enteringChildren=void 0)}),u}function b4(r,e,t,s){const{layoutId:i,layout:n,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:d,layoutCrossfade:u}=e;r.projection=new t(r.latestValues,e["data-framer-portal-id"]?void 0:mj(r.parent)),r.projection.setOptions({layoutId:i,layout:n,alwaysMeasureLayout:!!a||o&&oc(o),visualElement:r,animationType:typeof n=="string"?n:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:l,layoutRoot:d})}function mj(r){if(r)return r.options.allowProjection!==!1?r.projection:mj(r.parent)}function Yf(r,{forwardMotionProps:e=!1}={},t,s){t&&Y3(t);const i=Px(r)?f4:p4;function n(o,l){let d;const u={...v.useContext(Tx),...o,layoutId:v4(o)},{isStatic:h}=u,p=Q3(o),f=i(o,h);if(!h&&ix){w4();const m=k4(u);d=m.MeasureLayout,p.visualElement=x4(r,f,u,s,m.ProjectionNode)}return c.jsxs(Xp.Provider,{value:p,children:[d&&p.visualElement?c.jsx(d,{visualElement:p.visualElement,...u}):null,d4(r,o,g4(f,p.visualElement,l),f,h,e)]})}n.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const a=v.forwardRef(n);return a[m4]=r,a}function v4({layoutId:r}){const e=v.useContext(tx).id;return e&&r!==void 0?e+"-"+r:r}function w4(r,e){v.useContext(ij).strict}function k4(r){const{drag:e,layout:t}=$c;if(!e&&!t)return{};const s={...e,...t};return{MeasureLayout:e?.isEnabled(r)||t?.isEnabled(r)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}function C4(r,e){if(typeof Proxy>"u")return Yf;const t=new Map,s=(n,a)=>Yf(n,a,r,e),i=(n,a)=>s(n,a);return new Proxy(i,{get:(n,a)=>a==="create"?s:(t.has(a)||t.set(a,Yf(a,void 0,r,e)),t.get(a))})}function gj({top:r,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:r,max:s}}}function S4({x:r,y:e}){return{top:e.min,right:r.max,bottom:e.max,left:r.min}}function T4(r,e){if(!e)return r;const t=e({x:r.left,y:r.top}),s=e({x:r.right,y:r.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function qf(r){return r===void 0||r===1}function f0({scale:r,scaleX:e,scaleY:t}){return!qf(r)||!qf(e)||!qf(t)}function Ja(r){return f0(r)||yj(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function yj(r){return $1(r.x)||$1(r.y)}function $1(r){return r&&r!=="0%"}function pp(r,e,t){const s=r-t,i=e*s;return t+i}function z1(r,e,t,s,i){return i!==void 0&&(r=pp(r,i,s)),pp(r,t,s)+e}function m0(r,e=0,t=1,s,i){r.min=z1(r.min,e,t,s,i),r.max=z1(r.max,e,t,s,i)}function xj(r,{x:e,y:t}){m0(r.x,e.translate,e.scale,e.originPoint),m0(r.y,t.translate,t.scale,t.originPoint)}const V1=.999999999999,U1=1.0000000000001;function A4(r,e,t,s=!1){const i=t.length;if(!i)return;e.x=e.y=1;let n,a;for(let o=0;o<i;o++){n=t[o],a=n.projectionDelta;const{visualElement:l}=n.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&n.options.layoutScroll&&n.scroll&&n!==n.root&&lc(r,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,xj(r,a)),s&&Ja(n.latestValues)&&lc(r,n.latestValues))}e.x<U1&&e.x>V1&&(e.x=1),e.y<U1&&e.y>V1&&(e.y=1)}function cc(r,e){r.min=r.min+e,r.max=r.max+e}function G1(r,e,t,s,i=.5){const n=Xt(r.min,r.max,i);m0(r,e,t,n,s)}function lc(r,e){G1(r.x,e.x,e.scaleX,e.scale,e.originX),G1(r.y,e.y,e.scaleY,e.scale,e.originY)}function bj(r,e){return gj(T4(r.getBoundingClientRect(),e))}function j4(r,e,t){const s=bj(r,t),{scroll:i}=e;return i&&(cc(s.x,i.offset.x),cc(s.y,i.offset.y)),s}const W1=()=>({translate:0,scale:1,origin:0,originPoint:0}),dc=()=>({x:W1(),y:W1()}),Y1=()=>({min:0,max:0}),as=()=>({x:Y1(),y:Y1()}),g0={current:null},vj={current:!1};function _4(){if(vj.current=!0,!!ix)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),e=()=>g0.current=r.matches;r.addEventListener("change",e),e()}else g0.current=!1}const E4=new WeakMap;function M4(r,e,t){for(const s in e){const i=e[s],n=t[s];if(Ks(i))r.addValue(s,i);else if(Ks(n))r.addValue(s,Oc(i,{owner:r}));else if(n!==i)if(r.hasValue(s)){const a=r.getValue(s);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=r.getStaticValue(s);r.addValue(s,Oc(a!==void 0?a:i,{owner:r}))}}for(const s in t)e[s]===void 0&&r.removeValue(s);return e}const q1=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let P4=class{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:n,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=vx,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=wi.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Vt.render(this.render,!1,!0))};const{latestValues:l,renderState:d}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=d,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=o,this.blockInitialAnimation=!!n,this.isControllingVariants=Qp(t),this.isVariantNode=nj(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const p in h){const f=h[p];l[p]!==void 0&&Ks(f)&&f.set(l[p])}}mount(e){this.current=e,E4.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),vj.current||_4(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:g0.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),da(this.notifyUpdate),da(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=sl.has(e);s&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Vt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let n;window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),n&&n(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in $c){const t=$c[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):as()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<q1.length;s++){const i=q1[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const n="on"+i,a=e[n];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=M4(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=Oc(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(hA(s)||fA(s))?s=parseFloat(s):!O3(s)&&ua.test(t)&&(s=XA(e,t)),this.setBaseTarget(e,Ks(s)?s.get():s)),Ks(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if(typeof t=="string"||typeof t=="object"){const n=Nx(this.props,t,this.presenceContext?.custom);n&&(s=n[e])}if(t&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Ks(i)?i:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new cx),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){Cx.render(this.render)}},wj=class extends P4{constructor(){super(...arguments),this.KeyframeResolver=j3}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Ks(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}};function kj(r,{style:e,vars:t},s,i){const n=r.style;let a;for(a in e)n[a]=e[a];i?.applyProjectionStyles(n,s);for(a in t)n.setProperty(a,t[a])}function N4(r){return window.getComputedStyle(r)}let R4=class extends wj{constructor(){super(...arguments),this.type="html",this.renderInstance=kj}readValueFromInstance(e,t){if(sl.has(t))return this.projection?.isProjecting?o0(t):Y5(e,t);{const s=N4(e),i=(ux(t)?s.getPropertyValue(t):s[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return bj(e,t)}build(e,t,s){Ex(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return Rx(e,t,s)}};const Cj=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function I4(r,e,t,s){kj(r,e,void 0,s);for(const i in e.attrs)r.setAttribute(Cj.has(i)?i:Ix(i),e.attrs[i])}let D4=class extends wj{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=as}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(sl.has(t)){const s=HA(t);return s&&s.default||0}return t=Cj.has(t)?t:Ix(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return hj(e,t,s)}build(e,t,s){cj(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,i){I4(e,t,s,i)}mount(e){this.isSVGTag=dj(e.tagName),super.mount(e)}};const F4=(r,e)=>Px(r)?new D4(e):new R4(e,{allowProjection:r!==v.Fragment});function Sc(r,e,t){const s=r.getProps();return Nx(s,e,t!==void 0?t:s.custom,r)}const y0=r=>Array.isArray(r);function B4(r,e,t){r.hasValue(e)?r.getValue(e).set(t):r.addValue(e,Oc(t))}function L4(r){return y0(r)?r[r.length-1]||0:r}function O4(r,e){const t=Sc(r,e);let{transitionEnd:s={},transition:i={},...n}=t||{};n={...n,...s};for(const a in n){const o=L4(n[a]);B4(r,a,o)}}function $4(r){return!!(Ks(r)&&r.add)}function x0(r,e){const t=r.getValue("willChange");if($4(t))return t.add(e);if(!t&&bn.WillChange){const s=new bn.WillChange("auto");r.addValue("willChange",s),s.add(e)}}function Sj(r){return r.props[pj]}const z4=r=>r!==null;function V4(r,{repeat:e,repeatType:t="loop"},s){const i=r.filter(z4),n=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[n]}const U4={type:"spring",stiffness:500,damping:25,restSpeed:10},G4=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),W4={type:"keyframes",duration:.8},Y4={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},q4=(r,{keyframes:e})=>e.length>2?W4:sl.has(r)?r.startsWith("scale")?G4(e[1]):U4:Y4;function H4({when:r,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:i,repeat:n,repeatType:a,repeatDelay:o,from:l,elapsed:d,...u}){return!!Object.keys(u).length}const Dx=(r,e,t,s={},i,n)=>a=>{const o=wx(s,r)||{},l=o.delay||s.delay||0;let{elapsed:d=0}=s;d=d-Or(l);const u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-d,onUpdate:p=>{e.set(p),o.onUpdate&&o.onUpdate(p)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:r,motionValue:e,element:n?void 0:i};H4(o)||Object.assign(u,q4(r,u)),u.duration&&(u.duration=Or(u.duration)),u.repeatDelay&&(u.repeatDelay=Or(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(h0(u),u.delay===0&&(h=!0)),(bn.instantAnimations||bn.skipAnimations)&&(h=!0,h0(u),u.delay=0),u.allowFlatten=!o.type&&!o.ease,h&&!n&&e.get()!==void 0){const p=V4(u.keyframes,o);if(p!==void 0){Vt.update(()=>{u.onUpdate(p),u.onComplete()});return}}return o.isSync?new bx(u):new m3(u)};function X4({protectedKeys:r,needsAnimating:e},t){const s=r.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function Tj(r,e,{delay:t=0,transitionOverride:s,type:i}={}){let{transition:n=r.getDefaultTransition(),transitionEnd:a,...o}=e;s&&(n=s);const l=[],d=i&&r.animationState&&r.animationState.getState()[i];for(const u in o){const h=r.getValue(u,r.latestValues[u]??null),p=o[u];if(p===void 0||d&&X4(d,u))continue;const f={delay:t,...wx(n||{},u)},m=h.get();if(m!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===m&&!f.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const x=Sj(r);if(x){const b=window.MotionHandoffAnimation(x,u,Vt);b!==null&&(f.startTime=b,g=!0)}}x0(r,u),h.start(Dx(u,h,p,r.shouldReduceMotion&&WA.has(u)?{type:!1}:f,r,g));const y=h.animation;y&&l.push(y)}return a&&Promise.all(l).then(()=>{Vt.update(()=>{a&&O4(r,a)})}),l}function Aj(r,e,t,s=0,i=1){const n=Array.from(r).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=r.size,o=(a-1)*s;return typeof t=="function"?t(n,a):i===1?n*s:o-n*s}function b0(r,e,t={}){const s=Sc(r,e,t.type==="exit"?r.presenceContext?.custom:void 0);let{transition:i=r.getDefaultTransition()||{}}=s||{};t.transitionOverride&&(i=t.transitionOverride);const n=s?()=>Promise.all(Tj(r,s,t)):()=>Promise.resolve(),a=r.variantChildren&&r.variantChildren.size?(l=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=i;return K4(r,e,l,d,u,h,t)}:()=>Promise.resolve(),{when:o}=i;if(o){const[l,d]=o==="beforeChildren"?[n,a]:[a,n];return l().then(()=>d())}else return Promise.all([n(),a(t.delay)])}function K4(r,e,t=0,s=0,i=0,n=1,a){const o=[];for(const l of r.variantChildren)l.notify("AnimationStart",e),o.push(b0(l,e,{...a,delay:t+(typeof s=="function"?0:s)+Aj(r.variantChildren,l,s,i,n)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(o)}function Q4(r,e,t={}){r.notify("AnimationStart",e);let s;if(Array.isArray(e)){const i=e.map(n=>b0(r,n,t));s=Promise.all(i)}else if(typeof e=="string")s=b0(r,e,t);else{const i=typeof e=="function"?Sc(r,e,t.custom):e;s=Promise.all(Tj(r,i,t))}return s.then(()=>{r.notify("AnimationComplete",e)})}function jj(r,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==r.length)return!1;for(let s=0;s<t;s++)if(e[s]!==r[s])return!1;return!0}const J4=_x.length;function _j(r){if(!r)return;if(!r.isControllingVariants){const t=r.parent?_j(r.parent)||{}:{};return r.props.initial!==void 0&&(t.initial=r.props.initial),t}const e={};for(let t=0;t<J4;t++){const s=_x[t],i=r.props[s];(Od(i)||i===!1)&&(e[s]=i)}return e}const Z4=[...jx].reverse(),eF=jx.length;function tF(r){return e=>Promise.all(e.map(({animation:t,options:s})=>Q4(r,t,s)))}function sF(r){let e=tF(r),t=H1(),s=!0;const i=l=>(d,u)=>{const h=Sc(r,u,l==="exit"?r.presenceContext?.custom:void 0);if(h){const{transition:p,transitionEnd:f,...m}=h;d={...d,...m,...f}}return d};function n(l){e=l(r)}function a(l){const{props:d}=r,u=_j(r.parent)||{},h=[],p=new Set;let f={},m=1/0;for(let y=0;y<eF;y++){const x=Z4[y],b=t[x],w=d[x]!==void 0?d[x]:u[x],C=Od(w),k=x===l?b.isActive:null;k===!1&&(m=y);let S=w===u[x]&&w!==d[x]&&C;if(S&&s&&r.manuallyAnimateOnMount&&(S=!1),b.protectedKeys={...f},!b.isActive&&k===null||!w&&!b.prevProp||Kp(w)||typeof w=="boolean")continue;const A=iF(b.prevProp,w);let T=A||x===l&&b.isActive&&!S&&C||y>m&&C,j=!1;const _=Array.isArray(w)?w:[w];let M=_.reduce(i(x),{});k===!1&&(M={});const{prevResolvedValues:P={}}=b,R={...P,...M},D=F=>{T=!0,p.has(F)&&(j=!0,p.delete(F)),b.needsAnimating[F]=!0;const I=r.getValue(F);I&&(I.liveStyle=!1)};for(const F in R){const I=M[F],J=P[F];if(f.hasOwnProperty(F))continue;let Z=!1;y0(I)&&y0(J)?Z=!jj(I,J):Z=I!==J,Z?I!=null?D(F):p.add(F):I!==void 0&&p.has(F)?D(F):b.protectedKeys[F]=!0}b.prevProp=w,b.prevResolvedValues=M,b.isActive&&(f={...f,...M}),s&&r.blockInitialAnimation&&(T=!1);const B=S&&A;T&&(!B||j)&&h.push(..._.map(F=>{const I={type:x};if(typeof F=="string"&&s&&!B&&r.manuallyAnimateOnMount&&r.parent){const{parent:J}=r,Z=Sc(J,F);if(J.enteringChildren&&Z){const{delayChildren:E}=Z.transition||{};I.delay=Aj(J.enteringChildren,r,E)}}return{animation:F,options:I}}))}if(p.size){const y={};if(typeof d.initial!="boolean"){const x=Sc(r,Array.isArray(d.initial)?d.initial[0]:d.initial);x&&x.transition&&(y.transition=x.transition)}p.forEach(x=>{const b=r.getBaseTarget(x),w=r.getValue(x);w&&(w.liveStyle=!0),y[x]=b??null}),h.push({animation:y})}let g=!!h.length;return s&&(d.initial===!1||d.initial===d.animate)&&!r.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(h):Promise.resolve()}function o(l,d){if(t[l].isActive===d)return Promise.resolve();r.variantChildren?.forEach(h=>h.animationState?.setActive(l,d)),t[l].isActive=d;const u=a(l);for(const h in t)t[h].protectedKeys={};return u}return{animateChanges:a,setActive:o,setAnimateFunction:n,getState:()=>t,reset:()=>{t=H1()}}}function iF(r,e){return typeof e=="string"?e!==r:Array.isArray(e)?!jj(e,r):!1}function Ba(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function H1(){return{animate:Ba(!0),whileInView:Ba(),whileHover:Ba(),whileTap:Ba(),whileDrag:Ba(),whileFocus:Ba(),exit:Ba()}}let ka=class{constructor(e){this.isMounted=!1,this.node=e}update(){}},rF=class extends ka{constructor(e){super(e),e.animationState||(e.animationState=sF(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Kp(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}},nF=0,aF=class extends ka{constructor(){super(...arguments),this.id=nF++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}};const oF={animation:{Feature:rF},exit:{Feature:aF}};function zd(r,e,t,s={passive:!0}){return r.addEventListener(e,t,s),()=>r.removeEventListener(e,t)}function gu(r){return{point:{x:r.pageX,y:r.pageY}}}const cF=r=>e=>Sx(e)&&r(e,gu(e));function yd(r,e,t,s){return zd(r,e,cF(t),s)}const Ej=1e-4,lF=1-Ej,dF=1+Ej,Mj=.01,uF=0-Mj,hF=0+Mj;function oi(r){return r.max-r.min}function pF(r,e,t){return Math.abs(r-e)<=t}function X1(r,e,t,s=.5){r.origin=s,r.originPoint=Xt(e.min,e.max,r.origin),r.scale=oi(t)/oi(e),r.translate=Xt(t.min,t.max,r.origin)-r.originPoint,(r.scale>=lF&&r.scale<=dF||isNaN(r.scale))&&(r.scale=1),(r.translate>=uF&&r.translate<=hF||isNaN(r.translate))&&(r.translate=0)}function xd(r,e,t,s){X1(r.x,e.x,t.x,s?s.originX:void 0),X1(r.y,e.y,t.y,s?s.originY:void 0)}function K1(r,e,t){r.min=t.min+e.min,r.max=r.min+oi(e)}function fF(r,e,t){K1(r.x,e.x,t.x),K1(r.y,e.y,t.y)}function Q1(r,e,t){r.min=e.min-t.min,r.max=r.min+oi(e)}function bd(r,e,t){Q1(r.x,e.x,t.x),Q1(r.y,e.y,t.y)}function Hi(r){return[r("x"),r("y")]}const Pj=({current:r})=>r?r.ownerDocument.defaultView:null,J1=(r,e)=>Math.abs(r-e);function mF(r,e){const t=J1(r.x,e.x),s=J1(r.y,e.y);return Math.sqrt(t**2+s**2)}let Nj=class{constructor(e,t,{transformPagePoint:s,contextWindow:i=window,dragSnapToOrigin:n=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const p=Xf(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,m=mF(p.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!m)return;const{point:g}=p,{timestamp:y}=Ds;this.history.push({...g,timestamp:y});const{onStart:x,onMove:b}=this.handlers;f||(x&&x(this.lastMoveEvent,p),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,p)},this.handlePointerMove=(p,f)=>{this.lastMoveEvent=p,this.lastMoveEventInfo=Hf(f,this.transformPagePoint),Vt.update(this.updatePoint,!0)},this.handlePointerUp=(p,f)=>{this.end();const{onEnd:m,onSessionEnd:g,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const x=Xf(p.type==="pointercancel"?this.lastMoveEventInfo:Hf(f,this.transformPagePoint),this.history);this.startEvent&&m&&m(p,x),g&&g(p,x)},!Sx(e))return;this.dragSnapToOrigin=n,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=a,this.contextWindow=i||window;const o=gu(e),l=Hf(o,this.transformPagePoint),{point:d}=l,{timestamp:u}=Ds;this.history=[{...d,timestamp:u}];const{onSessionStart:h}=t;h&&h(e,Xf(l,this.history)),this.removeListeners=pu(yd(this.contextWindow,"pointermove",this.handlePointerMove),yd(this.contextWindow,"pointerup",this.handlePointerUp),yd(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),da(this.updatePoint)}};function Hf(r,e){return e?{point:e(r.point)}:r}function Z1(r,e){return{x:r.x-e.x,y:r.y-e.y}}function Xf({point:r},e){return{point:r,delta:Z1(r,Rj(e)),offset:Z1(r,gF(e)),velocity:yF(e,.1)}}function gF(r){return r[0]}function Rj(r){return r[r.length-1]}function yF(r,e){if(r.length<2)return{x:0,y:0};let t=r.length-1,s=null;const i=Rj(r);for(;t>=0&&(s=r[t],!(i.timestamp-s.timestamp>Or(e)));)t--;if(!s)return{x:0,y:0};const n=tr(i.timestamp-s.timestamp);if(n===0)return{x:0,y:0};const a={x:(i.x-s.x)/n,y:(i.y-s.y)/n};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function xF(r,{min:e,max:t},s){return e!==void 0&&r<e?r=s?Xt(e,r,s.min):Math.max(r,e):t!==void 0&&r>t&&(r=s?Xt(t,r,s.max):Math.min(r,t)),r}function ew(r,e,t){return{min:e!==void 0?r.min+e:void 0,max:t!==void 0?r.max+t-(r.max-r.min):void 0}}function bF(r,{top:e,left:t,bottom:s,right:i}){return{x:ew(r.x,t,i),y:ew(r.y,e,s)}}function tw(r,e){let t=e.min-r.min,s=e.max-r.max;return e.max-e.min<r.max-r.min&&([t,s]=[s,t]),{min:t,max:s}}function vF(r,e){return{x:tw(r.x,e.x),y:tw(r.y,e.y)}}function wF(r,e){let t=.5;const s=oi(r),i=oi(e);return i>s?t=Fd(e.min,e.max-s,r.min):s>i&&(t=Fd(r.min,r.max-i,e.min)),xn(0,1,t)}function kF(r,e){const t={};return e.min!==void 0&&(t.min=e.min-r.min),e.max!==void 0&&(t.max=e.max-r.min),t}const v0=.35;function CF(r=v0){return r===!1?r=0:r===!0&&(r=v0),{x:sw(r,"left","right"),y:sw(r,"top","bottom")}}function sw(r,e,t){return{min:iw(r,e),max:iw(r,t)}}function iw(r,e){return typeof r=="number"?r:r[e]||0}const SF=new WeakMap;let TF=class{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=as(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const n=h=>{const{dragSnapToOrigin:p}=this.getProps();p?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(gu(h).point)},a=(h,p)=>{const{drag:f,dragPropagation:m,onDragStart:g}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=P3(f),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Hi(x=>{let b=this.getAxisMotionValue(x).get()||0;if($r.test(b)){const{projection:w}=this.visualElement;if(w&&w.layout){const C=w.layout.layoutBox[x];C&&(b=oi(C)*(parseFloat(b)/100))}}this.originPoint[x]=b}),g&&Vt.postRender(()=>g(h,p)),x0(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},o=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:g,onDrag:y}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:x}=p;if(m&&this.currentDirection===null){this.currentDirection=AF(x),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,x),this.updateAxis("y",p.point,x),this.visualElement.render(),y&&y(h,p)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>Hi(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Nj(e,{onSessionStart:n,onStart:a,onMove:o,onSessionEnd:l,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:Pj(this.visualElement)})}stop(e,t){const s=e||this.latestPointerEvent,i=t||this.latestPanInfo,n=this.isDragging;if(this.cancel(),!n||!i||!s)return;const{velocity:a}=i;this.startAnimation(a);const{onDragEnd:o}=this.getProps();o&&Vt.postRender(()=>o(s,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!zu(e,i,this.currentDirection))return;const n=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=xF(a,this.constraints[e],this.elastic[e])),n.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&oc(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=bF(s.layoutBox,e):this.constraints=!1,this.elastic=CF(t),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Hi(n=>{this.constraints!==!1&&this.getAxisMotionValue(n)&&(this.constraints[n]=kF(s.layoutBox[n],this.constraints[n]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!oc(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const n=j4(s,i.root,this.visualElement.getTransformPagePoint());let a=vF(i.layout.layoutBox,n);if(t){const o=t(S4(a));this.hasMutatedConstraints=!!o,o&&(a=gj(o))}return a}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:n,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},d=Hi(u=>{if(!zu(u,t,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const p=i?200:1e6,f=i?40:1e7,m={type:"inertia",velocity:s?e[u]:0,bounceStiffness:p,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...n,...h};return this.startAxisValueAnimation(u,m)});return Promise.all(d).then(o)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return x0(this.visualElement,e),s.start(Dx(e,s,0,t,this.visualElement,!1))}stopAnimation(){Hi(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Hi(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Hi(t=>{const{drag:s}=this.getProps();if(!zu(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,n=this.getAxisMotionValue(t);if(i&&i.layout){const{min:a,max:o}=i.layout.layoutBox[t];n.set(e[t]-Xt(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!oc(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Hi(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();i[a]=wF({min:l,max:l},this.constraints[a])}});const{transformTemplate:n}=this.visualElement.getProps();this.visualElement.current.style.transform=n?n({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Hi(a=>{if(!zu(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:d}=this.constraints[a];o.set(Xt(l,d,i[a]))})}addListeners(){if(!this.visualElement.current)return;SF.set(this.visualElement,this);const e=this.visualElement.current,t=yd(e,"pointerdown",l=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();oc(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,n=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Vt.read(s);const a=zd(window,"resize",()=>this.scalePositionWithinConstraints()),o=i.addEventListener("didUpdate",({delta:l,hasLayoutChanged:d})=>{this.isDragging&&d&&(Hi(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),t(),n(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:n=!1,dragElastic:a=v0,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:n,dragElastic:a,dragMomentum:o}}};function zu(r,e,t){return(e===!0||e===r)&&(t===null||t===r)}function AF(r,e=10){let t=null;return Math.abs(r.y)>e?t="y":Math.abs(r.x)>e&&(t="x"),t}let jF=class extends ka{constructor(e){super(e),this.removeGroupControls=cr,this.removeListeners=cr,this.controls=new TF(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||cr}unmount(){this.removeGroupControls(),this.removeListeners()}};const rw=r=>(e,t)=>{r&&Vt.postRender(()=>r(e,t))};let _F=class extends ka{constructor(){super(...arguments),this.removePointerDownListener=cr}onPointerDown(e){this.session=new Nj(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Pj(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:rw(e),onStart:rw(t),onMove:s,onEnd:(n,a)=>{delete this.session,i&&Vt.postRender(()=>i(n,a))}}}mount(){this.removePointerDownListener=yd(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}};const Mh={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function nw(r,e){return e.max===e.min?0:r/(e.max-e.min)*100}const Nl={correct:(r,e)=>{if(!e.target)return r;if(typeof r=="string")if(Ke.test(r))r=parseFloat(r);else return r;const t=nw(r,e.target.x),s=nw(r,e.target.y);return`${t}% ${s}%`}},EF={correct:(r,{treeScale:e,projectionDelta:t})=>{const s=r,i=ua.parse(r);if(i.length>5)return s;const n=ua.createTransformer(r),a=typeof i[0]!="number"?1:0,o=t.x.scale*e.x,l=t.y.scale*e.y;i[0+a]/=o,i[1+a]/=l;const d=Xt(o,l,.5);return typeof i[2+a]=="number"&&(i[2+a]/=d),typeof i[3+a]=="number"&&(i[3+a]/=d),n(i)}};let Kf=!1,MF=class extends v.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:n}=e;J3(PF),n&&(t.group&&t.group.add(n),s&&s.register&&i&&s.register(n),Kf&&n.root.didUpdate(),n.addEventListener("animationComplete",()=>{this.safeToRemove()}),n.setOptions({...n.options,onExitComplete:()=>this.safeToRemove()})),Mh.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:n}=this.props,{projection:a}=s;return a&&(a.isPresent=n,Kf=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==n?a.willUpdate():this.safeToRemove(),e.isPresent!==n&&(n?a.promote():a.relegate()||Vt.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),Cx.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;Kf=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}};function Ij(r){const[e,t]=sj(),s=v.useContext(tx);return c.jsx(MF,{...r,layoutGroup:s,switchLayoutGroup:v.useContext(fj),isPresent:e,safeToRemove:t})}const PF={borderRadius:{...Nl,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Nl,borderTopRightRadius:Nl,borderBottomLeftRadius:Nl,borderBottomRightRadius:Nl,boxShadow:EF};function NF(r,e,t){const s=Ks(r)?r:Oc(r);return s.start(Dx("",s,e,t)),s.animation}const RF=(r,e)=>r.depth-e.depth;let IF=class{constructor(){this.children=[],this.isDirty=!1}add(e){rx(this.children,e),this.isDirty=!0}remove(e){nx(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(RF),this.isDirty=!1,this.children.forEach(e)}};function DF(r,e){const t=wi.now(),s=({timestamp:i})=>{const n=i-t;n>=e&&(da(s),r(n-e))};return Vt.setup(s,!0),()=>da(s)}const Dj=["TopLeft","TopRight","BottomLeft","BottomRight"],FF=Dj.length,aw=r=>typeof r=="string"?parseFloat(r):r,ow=r=>typeof r=="number"||Ke.test(r);function BF(r,e,t,s,i,n){i?(r.opacity=Xt(0,t.opacity??1,LF(s)),r.opacityExit=Xt(e.opacity??1,0,OF(s))):n&&(r.opacity=Xt(e.opacity??1,t.opacity??1,s));for(let a=0;a<FF;a++){const o=`border${Dj[a]}Radius`;let l=cw(e,o),d=cw(t,o);if(l===void 0&&d===void 0)continue;l||(l=0),d||(d=0),l===0||d===0||ow(l)===ow(d)?(r[o]=Math.max(Xt(aw(l),aw(d),s),0),($r.test(d)||$r.test(l))&&(r[o]+="%")):r[o]=d}(e.rotate||t.rotate)&&(r.rotate=Xt(e.rotate||0,t.rotate||0,s))}function cw(r,e){return r[e]!==void 0?r[e]:r.borderRadius}const LF=Fj(0,.5,kA),OF=Fj(.5,.95,cr);function Fj(r,e,t){return s=>s<r?0:s>e?1:t(Fd(r,e,s))}function lw(r,e){r.min=e.min,r.max=e.max}function Ui(r,e){lw(r.x,e.x),lw(r.y,e.y)}function dw(r,e){r.translate=e.translate,r.scale=e.scale,r.originPoint=e.originPoint,r.origin=e.origin}function uw(r,e,t,s,i){return r-=e,r=pp(r,1/t,s),i!==void 0&&(r=pp(r,1/i,s)),r}function $F(r,e=0,t=1,s=.5,i,n=r,a=r){if($r.test(e)&&(e=parseFloat(e),e=Xt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=Xt(n.min,n.max,s);r===n&&(o-=e),r.min=uw(r.min,e,t,o,i),r.max=uw(r.max,e,t,o,i)}function hw(r,e,[t,s,i],n,a){$F(r,e[t],e[s],e[i],e.scale,n,a)}const zF=["x","scaleX","originX"],VF=["y","scaleY","originY"];function pw(r,e,t,s){hw(r.x,e,zF,t?t.x:void 0,s?s.x:void 0),hw(r.y,e,VF,t?t.y:void 0,s?s.y:void 0)}function fw(r){return r.translate===0&&r.scale===1}function Bj(r){return fw(r.x)&&fw(r.y)}function mw(r,e){return r.min===e.min&&r.max===e.max}function UF(r,e){return mw(r.x,e.x)&&mw(r.y,e.y)}function gw(r,e){return Math.round(r.min)===Math.round(e.min)&&Math.round(r.max)===Math.round(e.max)}function Lj(r,e){return gw(r.x,e.x)&&gw(r.y,e.y)}function yw(r){return oi(r.x)/oi(r.y)}function xw(r,e){return r.translate===e.translate&&r.scale===e.scale&&r.originPoint===e.originPoint}let GF=class{constructor(){this.members=[]}add(e){rx(this.members,e),e.scheduleRender()}remove(e){if(nx(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let s;for(let i=t;i>=0;i--){const n=this.members[i];if(n.isPresent!==!1){s=n;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}};function WF(r,e,t){let s="";const i=r.x.translate/e.x,n=r.y.translate/e.y,a=t?.z||0;if((i||n||a)&&(s=`translate3d(${i}px, ${n}px, ${a}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:f,skewY:m}=t;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),p&&(s+=`rotateY(${p}deg) `),f&&(s+=`skewX(${f}deg) `),m&&(s+=`skewY(${m}deg) `)}const o=r.x.scale*e.x,l=r.y.scale*e.y;return(o!==1||l!==1)&&(s+=`scale(${o}, ${l})`),s||"none"}const Qf=["","X","Y","Z"],YF=1e3;let qF=0;function Jf(r,e,t,s){const{latestValues:i}=e;i[r]&&(t[r]=i[r],e.setStaticValue(r,0),s&&(s[r]=0))}function Oj(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:e}=r.options;if(!e)return;const t=Sj(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:n}=r.options;window.MotionCancelOptimisedAnimation(t,"transform",Vt,!(i||n))}const{parent:s}=r;s&&!s.hasCheckedOptimisedAppear&&Oj(s)}function $j({attachResizeListener:r,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(a={},o=e?.()){this.id=qF++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(KF),this.nodes.forEach(eB),this.nodes.forEach(tB),this.nodes.forEach(QF)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new IF)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new cx),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=tj(a)&&!B3(a),this.instance=a;const{layoutId:o,layout:l,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||o)&&(this.isLayoutDirty=!0),r){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;Vt.read(()=>{h=window.innerWidth}),r(a,()=>{const f=window.innerWidth;f!==h&&(h=f,this.root.updateBlockedByResize=!0,u&&u(),u=DF(p,250),Mh.hasAnimatedSinceResize&&(Mh.hasAnimatedSinceResize=!1,this.nodes.forEach(ww)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&d&&(o||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||d.getDefaultTransition()||aB,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=d.getProps(),x=!this.targetLayout||!Lj(this.targetLayout,f),b=!h&&p;if(this.options.layoutRoot||this.resumeFrom||b||h&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...wx(m,"layout"),onPlay:g,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(u,b)}else h||ww(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),da(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(sB),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Oj(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(bw);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(vw);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(ZF),this.nodes.forEach(HF),this.nodes.forEach(XF)):this.nodes.forEach(vw),this.clearAllSnapshots();const o=wi.now();Ds.delta=xn(0,1e3/60,o-Ds.timestamp),Ds.timestamp=o,Ds.isProcessing=!0,$f.update.process(Ds),$f.preRender.process(Ds),$f.render.process(Ds),Ds.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Cx.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(JF),this.sharedNodes.forEach(iB)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Vt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Vt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!oi(this.snapshot.measuredBox.x)&&!oi(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=as(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&this.instance){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!Bj(this.projectionDelta),l=this.getTransformTemplate(),d=l?l(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(o||Ja(this.latestValues)||u)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),oB(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return as();const o=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(cB))){const{scroll:d}=this.root;d&&(cc(o.x,d.offset.x),cc(o.y,d.offset.y))}return o}removeElementScroll(a){const o=as();if(Ui(o,a),this.scroll?.wasRoot)return o;for(let l=0;l<this.path.length;l++){const d=this.path[l],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&Ui(o,a),cc(o.x,u.offset.x),cc(o.y,u.offset.y))}return o}applyTransform(a,o=!1){const l=as();Ui(l,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&lc(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Ja(u.latestValues)&&lc(l,u.latestValues)}return Ja(this.latestValues)&&lc(l,this.latestValues),l}removeTransform(a){const o=as();Ui(o,a);for(let l=0;l<this.path.length;l++){const d=this.path[l];if(!d.instance||!Ja(d.latestValues))continue;f0(d.latestValues)&&d.updateSnapshot();const u=as(),h=d.measurePageBox();Ui(u,h),pw(o,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return Ja(this.latestValues)&&pw(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ds.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==o;if(!(a||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!(!this.layout||!(u||h))){if(this.resolvedRelativeTargetAt=Ds.timestamp,!this.targetDelta&&!this.relativeTarget){const p=this.getClosestProjectingParent();p&&p.layout&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=as(),this.relativeTargetOrigin=as(),bd(this.relativeTargetOrigin,this.layout.layoutBox,p.layout.layoutBox),Ui(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=as(),this.targetWithTransforms=as()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),fF(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Ui(this.target,this.layout.layoutBox),xj(this.target,this.targetDelta)):Ui(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const p=this.getClosestProjectingParent();p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?(this.relativeParent=p,this.forceRelativeParentToResolveTarget(),this.relativeTarget=as(),this.relativeTargetOrigin=as(),bd(this.relativeTargetOrigin,this.target,p.target),Ui(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||f0(this.parent.latestValues)||yj(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const a=this.getLead(),o=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Ds.timestamp&&(l=!1),l)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Ui(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;A4(this.layoutCorrected,this.treeScale,this.path,o),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=as());const{target:f}=a;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(dw(this.prevProjectionDelta.x,this.projectionDelta.x),dw(this.prevProjectionDelta.y,this.projectionDelta.y)),xd(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!xw(this.projectionDelta.x,this.prevProjectionDelta.x)||!xw(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=dc(),this.projectionDelta=dc(),this.projectionDeltaWithTransform=dc()}setAnimationOrigin(a,o=!1){const l=this.snapshot,d=l?l.latestValues:{},u={...this.latestValues},h=dc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const p=as(),f=l?l.source:void 0,m=this.layout?this.layout.source:void 0,g=f!==m,y=this.getStack(),x=!y||y.members.length<=1,b=!!(g&&!x&&this.options.crossfade===!0&&!this.path.some(nB));this.animationProgress=0;let w;this.mixTargetDelta=C=>{const k=C/1e3;kw(h.x,a.x,k),kw(h.y,a.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(bd(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),rB(this.relativeTarget,this.relativeTargetOrigin,p,k),w&&UF(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=as()),Ui(w,this.relativeTarget)),g&&(this.animationValues=u,BF(u,d,this.latestValues,k,b,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(da(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Vt.update(()=>{Mh.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Oc(0)),this.currentAnimation=NF(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(YF),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:d,latestValues:u}=a;if(!(!o||!l||!d)){if(this!==a&&this.layout&&d&&zj(this.options.animationType,this.layout.layoutBox,d.layoutBox)){l=this.target||as();const h=oi(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const p=oi(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+p}Ui(o,l),lc(o,u),xd(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new GF),this.sharedNodes.get(a).add(o);const d=o.options.initialPromotionConfig;o.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const d=this.getStack();d&&d.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const d={};l.z&&Jf("z",a,d,this.animationValues);for(let u=0;u<Qf.length;u++)Jf(`rotate${Qf[u]}`,a,d,this.animationValues),Jf(`skew${Qf[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=Eh(o?.pointerEvents)||"",a.transform=l?l(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=Eh(o?.pointerEvents)||""),this.hasProjected&&!Ja(this.latestValues)&&(a.transform=l?l({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=WF(this.projectionDeltaWithTransform,this.treeScale,u);l&&(h=l(u,h)),a.transform=h;const{x:p,y:f}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${f.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const m in $d){if(u[m]===void 0)continue;const{correct:g,applyTo:y,isCSSVariable:x}=$d[m],b=h==="none"?u[m]:g(u[m],d);if(y){const w=y.length;for(let C=0;C<w;C++)a[y[C]]=b}else x?this.options.visualElement.renderState.vars[m]=b:a[m]=b}this.options.layoutId&&(a.pointerEvents=d===this?Eh(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(bw),this.root.sharedNodes.clear()}}}function HF(r){r.updateLayout()}function XF(r){const e=r.resumeFrom?.snapshot||r.snapshot;if(r.isLead()&&r.layout&&e&&r.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:s}=r.layout,{animationType:i}=r.options,n=e.source!==r.layout.source;i==="size"?Hi(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=oi(h);h.min=t[u].min,h.max=h.min+p}):zj(i,e.layoutBox,t)&&Hi(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=oi(t[u]);h.max=h.min+p,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[u].max=r.relativeTarget[u].min+p)});const a=dc();xd(a,t,e.layoutBox);const o=dc();n?xd(o,r.applyTransform(s,!0),e.measuredBox):xd(o,t,e.layoutBox);const l=!Bj(a);let d=!1;if(!r.resumeFrom){const u=r.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:p}=u;if(h&&p){const f=as();bd(f,e.layoutBox,h.layoutBox);const m=as();bd(m,t,p.layoutBox),Lj(f,m)||(d=!0),u.options.layoutRoot&&(r.relativeTarget=m,r.relativeTargetOrigin=f,r.relativeParent=u)}}}r.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:d})}else if(r.isLead()){const{onExitComplete:t}=r.options;t&&t()}r.options.transition=void 0}function KF(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function QF(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function JF(r){r.clearSnapshot()}function bw(r){r.clearMeasurements()}function vw(r){r.isLayoutDirty=!1}function ZF(r){const{visualElement:e}=r.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),r.resetTransform()}function ww(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function eB(r){r.resolveTargetDelta()}function tB(r){r.calcProjection()}function sB(r){r.resetSkewAndRotation()}function iB(r){r.removeLeadSnapshot()}function kw(r,e,t){r.translate=Xt(e.translate,0,t),r.scale=Xt(e.scale,1,t),r.origin=e.origin,r.originPoint=e.originPoint}function Cw(r,e,t,s){r.min=Xt(e.min,t.min,s),r.max=Xt(e.max,t.max,s)}function rB(r,e,t,s){Cw(r.x,e.x,t.x,s),Cw(r.y,e.y,t.y,s)}function nB(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const aB={duration:.45,ease:[.4,0,.1,1]},Sw=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),Tw=Sw("applewebkit/")&&!Sw("chrome/")?Math.round:cr;function Aw(r){r.min=Tw(r.min),r.max=Tw(r.max)}function oB(r){Aw(r.x),Aw(r.y)}function zj(r,e,t){return r==="position"||r==="preserve-aspect"&&!pF(yw(e),yw(t),.2)}function cB(r){return r!==r.root&&r.scroll?.wasRoot}const lB=$j({attachResizeListener:(r,e)=>zd(r,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Zf={current:void 0},Vj=$j({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!Zf.current){const r=new lB({});r.mount(window),r.setOptions({layoutScroll:!0}),Zf.current=r}return Zf.current},resetTransform:(r,e)=>{r.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),dB={pan:{Feature:_F},drag:{Feature:jF,ProjectionNode:Vj,MeasureLayout:Ij}};function jw(r,e,t){const{props:s}=r;r.animationState&&s.whileHover&&r.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,n=s[i];n&&Vt.postRender(()=>n(e,gu(e)))}let uB=class extends ka{mount(){const{current:e}=this.node;e&&(this.unmount=N3(e,(t,s)=>(jw(this.node,s,"Start"),i=>jw(this.node,i,"End"))))}unmount(){}},hB=class extends ka{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pu(zd(this.node.current,"focus",()=>this.onFocus()),zd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}};function _w(r,e,t){const{props:s}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&s.whileTap&&r.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),n=s[i];n&&Vt.postRender(()=>n(e,gu(e)))}let pB=class extends ka{mount(){const{current:e}=this.node;e&&(this.unmount=F3(e,(t,s)=>(_w(this.node,s,"Start"),(i,{success:n})=>_w(this.node,i,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}};const w0=new WeakMap,em=new WeakMap,fB=r=>{const e=w0.get(r.target);e&&e(r)},mB=r=>{r.forEach(fB)};function gB({root:r,...e}){const t=r||document;em.has(t)||em.set(t,{});const s=em.get(t),i=JSON.stringify(e);return s[i]||(s[i]=new IntersectionObserver(mB,{root:r,...e})),s[i]}function yB(r,e,t){const s=gB(e);return w0.set(r,t),s.observe(r),()=>{w0.delete(r),s.unobserve(r)}}const xB={some:0,all:1};let bB=class extends ka{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:n}=e,a={root:t?t.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:xB[i]},o=l=>{const{isIntersecting:d}=l;if(this.isInView===d||(this.isInView=d,n&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(l)};return yB(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(vB(e,t))&&this.startObserver()}unmount(){}};function vB({viewport:r={}},{viewport:e={}}={}){return t=>r[t]!==e[t]}const wB={inView:{Feature:bB},tap:{Feature:pB},focus:{Feature:hB},hover:{Feature:uB}},kB={layout:{ProjectionNode:Vj,MeasureLayout:Ij}},CB={...oF,...wB,...dB,...kB},Ht=C4(CB,F4);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SB=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),TB=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),Ew=r=>{const e=TB(r);return e.charAt(0).toUpperCase()+e.slice(1)},Uj=(...r)=>r.filter((e,t,s)=>!!e&&e.trim()!==""&&s.indexOf(e)===t).join(" ").trim(),AB=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var jB={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _B=v.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:i="",children:n,iconNode:a,...o},l)=>v.createElement("svg",{ref:l,...jB,width:e,height:e,stroke:r,strokeWidth:s?Number(t)*24/Number(e):t,className:Uj("lucide",i),...!n&&!AB(o)&&{"aria-hidden":"true"},...o},[...a.map(([d,u])=>v.createElement(d,u)),...Array.isArray(n)?n:[n]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=(r,e)=>{const t=v.forwardRef(({className:s,...i},n)=>v.createElement(_B,{ref:n,iconNode:e,className:Uj(`lucide-${SB(Ew(r))}`,`lucide-${r}`,s),...i}));return t.displayName=Ew(r),t};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EB=[["rect",{width:"6",height:"14",x:"2",y:"5",rx:"2",key:"dy24zr"}],["rect",{width:"6",height:"10",x:"16",y:"7",rx:"2",key:"13zkjt"}],["path",{d:"M12 2v20",key:"t6zp3m"}]],MB=ee("align-horizontal-justify-center",EB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PB=[["rect",{width:"14",height:"6",x:"5",y:"16",rx:"2",key:"1i8z2d"}],["rect",{width:"10",height:"6",x:"7",y:"2",rx:"2",key:"ypihtt"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],NB=ee("align-vertical-justify-center",PB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RB=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],IB=ee("archive",RB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DB=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],FB=ee("arrow-down",DB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BB=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Fx=ee("arrow-left",BB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LB=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],na=ee("arrow-right",LB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OB=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],$B=ee("arrow-up",OB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zB=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]],VB=ee("at-sign",zB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UB=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],GB=ee("bold",UB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WB=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]],YB=ee("bookmark-plus",WB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qB=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],k0=ee("bookmark",qB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HB=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],XB=ee("briefcase",HB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KB=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],QB=ee("camera",KB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JB=[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]],Mw=ee("captions",JB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZB=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ei=ee("check",ZB);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eL=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ls=ee("chevron-down",eL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tL=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Js=ee("chevron-right",tL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sL=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Gj=ee("chevron-left",sL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iL=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Wj=ee("chevron-up",iL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],To=ee("circle-alert",rL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nL=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Bx=ee("circle-check-big",nL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],C0=ee("circle-check",aL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],cL=ee("circle-question-mark",oL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Yj=ee("circle-x",lL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Vr=ee("circle",dL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uL=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],hL=ee("clipboard",uL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pL=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ui=ee("clock",pL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fL=[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]],Pw=ee("command",fL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mL=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Ao=ee("copy",mL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gL=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],yL=ee("cpu",gL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xL=[["path",{d:"M6 2v14a2 2 0 0 0 2 2h14",key:"ron5a4"}],["path",{d:"M18 22V8a2 2 0 0 0-2-2H2",key:"7s9ehn"}]],bL=ee("crop",xL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],wL=ee("crosshair",vL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kL=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],CL=ee("crown",kL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SL=[["path",{d:"M2.7 10.3a2.41 2.41 0 0 0 0 3.41l7.59 7.59a2.41 2.41 0 0 0 3.41 0l7.59-7.59a2.41 2.41 0 0 0 0-3.41l-7.59-7.59a2.41 2.41 0 0 0-3.41 0Z",key:"1f1r0c"}]],Jp=ee("diamond",SL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TL=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Lx=ee("download",TL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AL=[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]],jL=ee("droplet",AL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _L=[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]],EL=ee("droplets",_L);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ML=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],S0=ee("external-link",ML);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PL=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ha=ee("eye-off",PL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NL=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ur=ee("eye",NL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RL=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12.5 8 15l2 2.5",key:"1tg20x"}],["path",{d:"m14 12.5 2 2.5-2 2.5",key:"yinavb"}]],zc=ee("file-code",RL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IL=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M15.033 13.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56v-4.704a.645.645 0 0 1 .967-.56z",key:"1tzo1f"}]],no=ee("file-play",IL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DL=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],pa=ee("film",DL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FL=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],BL=ee("flag",FL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LL=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}]],OL=ee("focus",LL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $L=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ox=ee("folder-open",$L);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zL=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],VL=ee("gauge",zL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],qj=ee("globe",UL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GL=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],WL=ee("grip-vertical",GL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YL=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],qL=ee("hard-drive",YL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HL=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],XL=ee("hash",HL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KL=[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}]],Hj=ee("hexagon",KL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QL=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Ph=ee("history",QL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JL=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Eo=ee("image",JL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Xj=ee("info",ZL);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eO=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],tO=ee("italic",eO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sO=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],Nw=ee("key",sO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iO=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],Rw=ee("keyboard",iO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rO=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],zs=ee("layers",rO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nO=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],$x=ee("layout-grid",nO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aO=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],oO=ee("lightbulb",aO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cO=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ci=ee("loader-circle",cO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lO=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],dO=ee("lock",lO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uO=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],Ca=ee("maximize-2",uO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hO=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],pO=ee("mic-off",hO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fO=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],T0=ee("mic",fO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mO=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],Kj=ee("minimize-2",mO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gO=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],ki=ee("monitor",gO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yO=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],xO=ee("moon",yO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bO=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],aa=ee("move",bO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vO=[["circle",{cx:"8",cy:"18",r:"4",key:"1fc0mg"}],["path",{d:"M12 18V2l7 4",key:"g04rme"}]],A0=ee("music-2",vO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wO=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],Gr=ee("music",wO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kO=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],Vd=ee("palette",kO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CO=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Qj=ee("pause",CO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SO=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],TO=ee("pen-line",SO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AO=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Jj=ee("pen",AO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jO=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],_O=ee("pencil",jO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EO=[["path",{d:"M10.83 2.38a2 2 0 0 1 2.34 0l8 5.74a2 2 0 0 1 .73 2.25l-3.04 9.26a2 2 0 0 1-1.9 1.37H7.04a2 2 0 0 1-1.9-1.37L2.1 10.37a2 2 0 0 1 .73-2.25z",key:"2hea0t"}]],MO=ee("pentagon",EO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PO=[["path",{d:"M21 9V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h4",key:"daa4of"}],["rect",{width:"10",height:"7",x:"12",y:"13",rx:"2",key:"1nb8gs"}]],NO=ee("picture-in-picture-2",PO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RO=[["path",{d:"m12 9-8.414 8.414A2 2 0 0 0 3 18.828v1.344a2 2 0 0 1-.586 1.414A2 2 0 0 1 3.828 21h1.344a2 2 0 0 0 1.414-.586L15 12",key:"1y3wsu"}],["path",{d:"m18 9 .4.4a1 1 0 1 1-3 3l-3.8-3.8a1 1 0 1 1 3-3l.4.4 3.4-3.4a1 1 0 1 1 3 3z",key:"110lr1"}],["path",{d:"m2 22 .414-.414",key:"jhxm08"}]],IO=ee("pipette",RO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DO=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ti=ee("play",DO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FO=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],wr=ee("plus",FO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BO=[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5A5.5 5.5 0 0 0 9.5 20H13",key:"6uklza"}]],Zj=ee("redo-2",BO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LO=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],il=ee("refresh-cw",LO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OO=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],$i=ee("rotate-ccw",OO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $O=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],zO=ee("rotate-cw",$O);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VO=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],Iw=ee("route",VO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UO=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],zx=ee("scissors",UO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GO=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],jo=ee("search",GO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WO=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],e_=ee("settings-2",WO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YO=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Vc=ee("settings",YO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qO=[["path",{d:"M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z",key:"1bo67w"}],["rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",key:"1bkyp8"}],["circle",{cx:"17.5",cy:"17.5",r:"3.5",key:"w3z12y"}]],yu=ee("shapes",qO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HO=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Vu=ee("share-2",HO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XO=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],KO=ee("skip-back",XO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QO=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],JO=ee("skip-forward",QO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZO=[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]],Nh=ee("sliders-vertical",ZO);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e$=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],bi=ee("smartphone",e$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t$=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],t_=ee("smile",t$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s$=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Zp=ee("sparkles",s$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i$=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],is=ee("square",i$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r$=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],fa=ee("star",r$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n$=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M14.837 16.385a6 6 0 1 1-7.223-7.222c.624-.147.97.66.715 1.248a4 4 0 0 0 5.26 5.259c.589-.255 1.396.09 1.248.715",key:"xlf6rm"}],["path",{d:"M16 12a4 4 0 0 0-4-4",key:"6vsxu"}],["path",{d:"m19 5-1.256 1.256",key:"1yg6a6"}],["path",{d:"M20 12h2",key:"1q8mjw"}]],a$=ee("sun-moon",n$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o$=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],c$=ee("sun",o$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l$=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],j0=ee("target",l$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d$=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M17 12H7",key:"16if0g"}],["path",{d:"M19 19H5",key:"vjpgq2"}]],u$=ee("text-align-center",d$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h$=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M21 19H7",key:"4cu937"}]],p$=ee("text-align-end",h$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f$=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],m$=ee("text-align-start",f$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g$=[["circle",{cx:"9",cy:"12",r:"3",key:"u3jwor"}],["rect",{width:"20",height:"14",x:"2",y:"5",rx:"7",key:"g7kal2"}]],y$=ee("toggle-left",g$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x$=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Ss=ee("trash-2",x$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b$=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],_o=ee("triangle-alert",b$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v$=[["path",{d:"M13.73 4a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"14u9p9"}]],s_=ee("triangle",v$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w$=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],Os=ee("type",w$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k$=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],C$=ee("underline",k$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S$=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],i_=ee("undo-2",S$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T$=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ef=ee("upload",T$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A$=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],j$=ee("users",A$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _$=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Uc=ee("video",_$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E$=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],vn=ee("volume-2",E$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M$=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],fp=ee("volume-x",M$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P$=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],N$=ee("wand-sparkles",P$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R$=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Zs=ee("x",R$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I$=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],D$=ee("zoom-in",I$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F$=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ci=ee("zap",F$);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B$=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],L$=ee("zoom-out",B$);let O$=0;const ed=wa((r,e)=>({notifications:[],addNotification:t=>{const s=`notification-${++O$}`,i={id:s,duration:4e3,dismissible:!0,...t};return r(n=>({notifications:[...n.notifications,i]})),i.duration&&i.duration>0&&setTimeout(()=>{e().removeNotification(s)},i.duration),s},removeNotification:t=>{r(s=>({notifications:s.notifications.filter(i=>i.id!==t)}))},clearAll:()=>{r({notifications:[]})}})),Hs={success:(r,e)=>ed.getState().addNotification({type:"success",title:r,message:e}),error:(r,e)=>ed.getState().addNotification({type:"error",title:r,message:e,duration:6e3}),warning:(r,e)=>ed.getState().addNotification({type:"warning",title:r,message:e}),info:(r,e)=>ed.getState().addNotification({type:"info",title:r,message:e})},$$={success:c.jsx(C0,{size:20}),error:c.jsx(Yj,{size:20}),warning:c.jsx(_o,{size:20}),info:c.jsx(Xj,{size:20})},z$={success:{light:{bg:"bg-white",border:"border-emerald-200",icon:"text-emerald-600",progress:"bg-emerald-500"},dark:{bg:"bg-zinc-900/95",border:"border-emerald-500/30",icon:"text-emerald-400",progress:"bg-emerald-500"}},error:{light:{bg:"bg-white",border:"border-red-200",icon:"text-red-600",progress:"bg-red-500"},dark:{bg:"bg-zinc-900/95",border:"border-red-500/30",icon:"text-red-400",progress:"bg-red-500"}},warning:{light:{bg:"bg-white",border:"border-amber-200",icon:"text-amber-600",progress:"bg-amber-500"},dark:{bg:"bg-zinc-900/95",border:"border-amber-500/30",icon:"text-amber-400",progress:"bg-amber-500"}},info:{light:{bg:"bg-white",border:"border-blue-200",icon:"text-blue-600",progress:"bg-blue-500"},dark:{bg:"bg-zinc-900/95",border:"border-blue-500/30",icon:"text-blue-400",progress:"bg-blue-500"}}},r_=Ye.forwardRef(({notification:r,onRemove:e},t)=>{const[s,i]=v.useState(100),n=typeof document<"u"&&document.documentElement.classList.contains("dark"),a=n?"dark":"light",o=z$[r.type][a],l=r.duration||4e3;return v.useEffect(()=>{if(l<=0)return;const d=Date.now(),u=setInterval(()=>{const h=Date.now()-d,p=Math.max(0,100-h/l*100);i(p),p<=0&&clearInterval(u)},50);return()=>clearInterval(u)},[l]),c.jsxs(Ht.div,{ref:t,layout:!0,initial:{opacity:0,x:100,scale:.9},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:100,scale:.9},transition:{type:"spring",stiffness:500,damping:30,opacity:{duration:.2}},className:`
        relative overflow-hidden
        min-w-[320px] max-w-[420px]
        rounded-xl border shadow-lg
        ${o.bg} ${o.border}
        backdrop-blur-xl
      `,children:[c.jsxs("div",{className:"flex items-start gap-3 p-4",children:[c.jsx(Ht.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:500,damping:25,delay:.1},className:`flex-shrink-0 mt-0.5 ${o.icon}`,children:$$[r.type]}),c.jsxs("div",{className:"flex-1 min-w-0 pr-2",children:[c.jsx(Ht.p,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.05},className:`text-sm font-semibold ${n?"text-zinc-100":"text-zinc-900"}`,children:r.title}),r.message&&c.jsx(Ht.p,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},transition:{delay:.1},className:`text-xs mt-1 leading-relaxed ${n?"text-zinc-400":"text-zinc-600"}`,children:r.message})]}),r.dismissible&&c.jsx(Ht.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>e(r.id),className:`
              flex-shrink-0 p-1.5 rounded-lg
              transition-colors duration-150
              ${n?"hover:bg-white/10 text-zinc-500 hover:text-zinc-300":"hover:bg-black/5 text-zinc-400 hover:text-zinc-600"}
            `,"aria-label":"Dismiss notification",children:c.jsx(Zs,{size:16})})]}),l>0&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black/5 dark:bg-white/5",children:c.jsx(Ht.div,{initial:{width:"100%"},animate:{width:`${s}%`},transition:{duration:.05,ease:"linear"},className:`h-full ${o.progress}`})})]})});r_.displayName="ToastItem";const V$=()=>{const{notifications:r,removeNotification:e}=ed();return c.jsx("div",{className:"fixed top-4 right-4 z-[9999] flex flex-col gap-3",role:"region","aria-label":"Notifications",children:c.jsx(Ax,{mode:"popLayout",children:r.map(t=>c.jsx(r_,{notification:t,onRemove:e},t.id))})})};function n_(r){var e,t,s="";if(typeof r=="string"||typeof r=="number")s+=r;else if(typeof r=="object")if(Array.isArray(r)){var i=r.length;for(e=0;e<i;e++)r[e]&&(t=n_(r[e]))&&(s&&(s+=" "),s+=t)}else for(t in r)r[t]&&(s&&(s+=" "),s+=t);return s}function a_(){for(var r,e,t=0,s="",i=arguments.length;t<i;t++)(r=arguments[t])&&(e=n_(r))&&(s&&(s+=" "),s+=e);return s}const U$=(r,e)=>{const t=new Array(r.length+e.length);for(let s=0;s<r.length;s++)t[s]=r[s];for(let s=0;s<e.length;s++)t[r.length+s]=e[s];return t},G$=(r,e)=>({classGroupId:r,validator:e}),o_=(r=new Map,e=null,t)=>({nextPart:r,validators:e,classGroupId:t}),mp="-",Dw=[],W$="arbitrary..",Y$=r=>{const e=H$(r),{conflictingClassGroups:t,conflictingClassGroupModifiers:s}=r;return{getClassGroupId:a=>{if(a.startsWith("[")&&a.endsWith("]"))return q$(a);const o=a.split(mp),l=o[0]===""&&o.length>1?1:0;return c_(o,l,e)},getConflictingClassGroupIds:(a,o)=>{if(o){const l=s[a],d=t[a];return l?d?U$(d,l):l:d||Dw}return t[a]||Dw}}},c_=(r,e,t)=>{if(r.length-e===0)return t.classGroupId;const i=r[e],n=t.nextPart.get(i);if(n){const d=c_(r,e+1,n);if(d)return d}const a=t.validators;if(a===null)return;const o=e===0?r.join(mp):r.slice(e).join(mp),l=a.length;for(let d=0;d<l;d++){const u=a[d];if(u.validator(o))return u.classGroupId}},q$=r=>r.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=r.slice(1,-1),t=e.indexOf(":"),s=e.slice(0,t);return s?W$+s:void 0})(),H$=r=>{const{theme:e,classGroups:t}=r;return X$(t,e)},X$=(r,e)=>{const t=o_();for(const s in r){const i=r[s];Vx(i,t,s,e)}return t},Vx=(r,e,t,s)=>{const i=r.length;for(let n=0;n<i;n++){const a=r[n];K$(a,e,t,s)}},K$=(r,e,t,s)=>{if(typeof r=="string"){Q$(r,e,t);return}if(typeof r=="function"){J$(r,e,t,s);return}Z$(r,e,t,s)},Q$=(r,e,t)=>{const s=r===""?e:l_(e,r);s.classGroupId=t},J$=(r,e,t,s)=>{if(ez(r)){Vx(r(s),e,t,s);return}e.validators===null&&(e.validators=[]),e.validators.push(G$(t,r))},Z$=(r,e,t,s)=>{const i=Object.entries(r),n=i.length;for(let a=0;a<n;a++){const[o,l]=i[a];Vx(l,l_(e,o),t,s)}},l_=(r,e)=>{let t=r;const s=e.split(mp),i=s.length;for(let n=0;n<i;n++){const a=s[n];let o=t.nextPart.get(a);o||(o=o_(),t.nextPart.set(a,o)),t=o}return t},ez=r=>"isThemeGetter"in r&&r.isThemeGetter===!0,tz=r=>{if(r<1)return{get:()=>{},set:()=>{}};let e=0,t=Object.create(null),s=Object.create(null);const i=(n,a)=>{t[n]=a,e++,e>r&&(e=0,s=t,t=Object.create(null))};return{get(n){let a=t[n];if(a!==void 0)return a;if((a=s[n])!==void 0)return i(n,a),a},set(n,a){n in t?t[n]=a:i(n,a)}}},_0="!",Fw=":",sz=[],Bw=(r,e,t,s,i)=>({modifiers:r,hasImportantModifier:e,baseClassName:t,maybePostfixModifierPosition:s,isExternal:i}),iz=r=>{const{prefix:e,experimentalParseClassName:t}=r;let s=i=>{const n=[];let a=0,o=0,l=0,d;const u=i.length;for(let g=0;g<u;g++){const y=i[g];if(a===0&&o===0){if(y===Fw){n.push(i.slice(l,g)),l=g+1;continue}if(y==="/"){d=g;continue}}y==="["?a++:y==="]"?a--:y==="("?o++:y===")"&&o--}const h=n.length===0?i:i.slice(l);let p=h,f=!1;h.endsWith(_0)?(p=h.slice(0,-1),f=!0):h.startsWith(_0)&&(p=h.slice(1),f=!0);const m=d&&d>l?d-l:void 0;return Bw(n,f,p,m)};if(e){const i=e+Fw,n=s;s=a=>a.startsWith(i)?n(a.slice(i.length)):Bw(sz,!1,a,void 0,!0)}if(t){const i=s;s=n=>t({className:n,parseClassName:i})}return s},rz=r=>{const e=new Map;return r.orderSensitiveModifiers.forEach((t,s)=>{e.set(t,1e6+s)}),t=>{const s=[];let i=[];for(let n=0;n<t.length;n++){const a=t[n],o=a[0]==="[",l=e.has(a);o||l?(i.length>0&&(i.sort(),s.push(...i),i=[]),s.push(a)):i.push(a)}return i.length>0&&(i.sort(),s.push(...i)),s}},nz=r=>({cache:tz(r.cacheSize),parseClassName:iz(r),sortModifiers:rz(r),...Y$(r)}),az=/\s+/,oz=(r,e)=>{const{parseClassName:t,getClassGroupId:s,getConflictingClassGroupIds:i,sortModifiers:n}=e,a=[],o=r.trim().split(az);let l="";for(let d=o.length-1;d>=0;d-=1){const u=o[d],{isExternal:h,modifiers:p,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:g}=t(u);if(h){l=u+(l.length>0?" "+l:l);continue}let y=!!g,x=s(y?m.substring(0,g):m);if(!x){if(!y){l=u+(l.length>0?" "+l:l);continue}if(x=s(m),!x){l=u+(l.length>0?" "+l:l);continue}y=!1}const b=p.length===0?"":p.length===1?p[0]:n(p).join(":"),w=f?b+_0:b,C=w+x;if(a.indexOf(C)>-1)continue;a.push(C);const k=i(x,y);for(let S=0;S<k.length;++S){const A=k[S];a.push(w+A)}l=u+(l.length>0?" "+l:l)}return l},cz=(...r)=>{let e=0,t,s,i="";for(;e<r.length;)(t=r[e++])&&(s=d_(t))&&(i&&(i+=" "),i+=s);return i},d_=r=>{if(typeof r=="string")return r;let e,t="";for(let s=0;s<r.length;s++)r[s]&&(e=d_(r[s]))&&(t&&(t+=" "),t+=e);return t},lz=(r,...e)=>{let t,s,i,n;const a=l=>{const d=e.reduce((u,h)=>h(u),r());return t=nz(d),s=t.cache.get,i=t.cache.set,n=o,o(l)},o=l=>{const d=s(l);if(d)return d;const u=oz(l,t);return i(l,u),u};return n=a,(...l)=>n(cz(...l))},dz=[],vs=r=>{const e=t=>t[r]||dz;return e.isThemeGetter=!0,e},u_=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,h_=/^\((?:(\w[\w-]*):)?(.+)\)$/i,uz=/^\d+\/\d+$/,hz=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,pz=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,fz=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,mz=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,gz=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Wo=r=>uz.test(r),rt=r=>!!r&&!Number.isNaN(Number(r)),Fn=r=>!!r&&Number.isInteger(Number(r)),tm=r=>r.endsWith("%")&&rt(r.slice(0,-1)),sn=r=>hz.test(r),yz=()=>!0,xz=r=>pz.test(r)&&!fz.test(r),p_=()=>!1,bz=r=>mz.test(r),vz=r=>gz.test(r),wz=r=>!Fe(r)&&!Be(r),kz=r=>rl(r,g_,p_),Fe=r=>u_.test(r),La=r=>rl(r,y_,xz),sm=r=>rl(r,jz,rt),Lw=r=>rl(r,f_,p_),Cz=r=>rl(r,m_,vz),Uu=r=>rl(r,x_,bz),Be=r=>h_.test(r),Rl=r=>nl(r,y_),Sz=r=>nl(r,_z),Ow=r=>nl(r,f_),Tz=r=>nl(r,g_),Az=r=>nl(r,m_),Gu=r=>nl(r,x_,!0),rl=(r,e,t)=>{const s=u_.exec(r);return s?s[1]?e(s[1]):t(s[2]):!1},nl=(r,e,t=!1)=>{const s=h_.exec(r);return s?s[1]?e(s[1]):t:!1},f_=r=>r==="position"||r==="percentage",m_=r=>r==="image"||r==="url",g_=r=>r==="length"||r==="size"||r==="bg-size",y_=r=>r==="length",jz=r=>r==="number",_z=r=>r==="family-name",x_=r=>r==="shadow",Ez=()=>{const r=vs("color"),e=vs("font"),t=vs("text"),s=vs("font-weight"),i=vs("tracking"),n=vs("leading"),a=vs("breakpoint"),o=vs("container"),l=vs("spacing"),d=vs("radius"),u=vs("shadow"),h=vs("inset-shadow"),p=vs("text-shadow"),f=vs("drop-shadow"),m=vs("blur"),g=vs("perspective"),y=vs("aspect"),x=vs("ease"),b=vs("animate"),w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],C=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],k=()=>[...C(),Be,Fe],S=()=>["auto","hidden","clip","visible","scroll"],A=()=>["auto","contain","none"],T=()=>[Be,Fe,l],j=()=>[Wo,"full","auto",...T()],_=()=>[Fn,"none","subgrid",Be,Fe],M=()=>["auto",{span:["full",Fn,Be,Fe]},Fn,Be,Fe],P=()=>[Fn,"auto",Be,Fe],R=()=>["auto","min","max","fr",Be,Fe],D=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],B=()=>["start","end","center","stretch","center-safe","end-safe"],O=()=>["auto",...T()],F=()=>[Wo,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...T()],I=()=>[r,Be,Fe],J=()=>[...C(),Ow,Lw,{position:[Be,Fe]}],Z=()=>["no-repeat",{repeat:["","x","y","space","round"]}],E=()=>["auto","cover","contain",Tz,kz,{size:[Be,Fe]}],G=()=>[tm,Rl,La],V=()=>["","none","full",d,Be,Fe],U=()=>["",rt,Rl,La],oe=()=>["solid","dashed","dotted","double"],re=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ne=()=>[rt,tm,Ow,Lw],Ee=()=>["","none",m,Be,Fe],K=()=>["none",rt,Be,Fe],me=()=>["none",rt,Be,Fe],$=()=>[rt,Be,Fe],Q=()=>[Wo,"full",...T()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[sn],breakpoint:[sn],color:[yz],container:[sn],"drop-shadow":[sn],ease:["in","out","in-out"],font:[wz],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[sn],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[sn],shadow:[sn],spacing:["px",rt],text:[sn],"text-shadow":[sn],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Wo,Fe,Be,y]}],container:["container"],columns:[{columns:[rt,Fe,Be,o]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:k()}],overflow:[{overflow:S()}],"overflow-x":[{"overflow-x":S()}],"overflow-y":[{"overflow-y":S()}],overscroll:[{overscroll:A()}],"overscroll-x":[{"overscroll-x":A()}],"overscroll-y":[{"overscroll-y":A()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:j()}],"inset-x":[{"inset-x":j()}],"inset-y":[{"inset-y":j()}],start:[{start:j()}],end:[{end:j()}],top:[{top:j()}],right:[{right:j()}],bottom:[{bottom:j()}],left:[{left:j()}],visibility:["visible","invisible","collapse"],z:[{z:[Fn,"auto",Be,Fe]}],basis:[{basis:[Wo,"full","auto",o,...T()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[rt,Wo,"auto","initial","none",Fe]}],grow:[{grow:["",rt,Be,Fe]}],shrink:[{shrink:["",rt,Be,Fe]}],order:[{order:[Fn,"first","last","none",Be,Fe]}],"grid-cols":[{"grid-cols":_()}],"col-start-end":[{col:M()}],"col-start":[{"col-start":P()}],"col-end":[{"col-end":P()}],"grid-rows":[{"grid-rows":_()}],"row-start-end":[{row:M()}],"row-start":[{"row-start":P()}],"row-end":[{"row-end":P()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":R()}],"auto-rows":[{"auto-rows":R()}],gap:[{gap:T()}],"gap-x":[{"gap-x":T()}],"gap-y":[{"gap-y":T()}],"justify-content":[{justify:[...D(),"normal"]}],"justify-items":[{"justify-items":[...B(),"normal"]}],"justify-self":[{"justify-self":["auto",...B()]}],"align-content":[{content:["normal",...D()]}],"align-items":[{items:[...B(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...B(),{baseline:["","last"]}]}],"place-content":[{"place-content":D()}],"place-items":[{"place-items":[...B(),"baseline"]}],"place-self":[{"place-self":["auto",...B()]}],p:[{p:T()}],px:[{px:T()}],py:[{py:T()}],ps:[{ps:T()}],pe:[{pe:T()}],pt:[{pt:T()}],pr:[{pr:T()}],pb:[{pb:T()}],pl:[{pl:T()}],m:[{m:O()}],mx:[{mx:O()}],my:[{my:O()}],ms:[{ms:O()}],me:[{me:O()}],mt:[{mt:O()}],mr:[{mr:O()}],mb:[{mb:O()}],ml:[{ml:O()}],"space-x":[{"space-x":T()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":T()}],"space-y-reverse":["space-y-reverse"],size:[{size:F()}],w:[{w:[o,"screen",...F()]}],"min-w":[{"min-w":[o,"screen","none",...F()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...F()]}],h:[{h:["screen","lh",...F()]}],"min-h":[{"min-h":["screen","lh","none",...F()]}],"max-h":[{"max-h":["screen","lh",...F()]}],"font-size":[{text:["base",t,Rl,La]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[s,Be,sm]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",tm,Fe]}],"font-family":[{font:[Sz,Fe,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[i,Be,Fe]}],"line-clamp":[{"line-clamp":[rt,"none",Be,sm]}],leading:[{leading:[n,...T()]}],"list-image":[{"list-image":["none",Be,Fe]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",Be,Fe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:I()}],"text-color":[{text:I()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...oe(),"wavy"]}],"text-decoration-thickness":[{decoration:[rt,"from-font","auto",Be,La]}],"text-decoration-color":[{decoration:I()}],"underline-offset":[{"underline-offset":[rt,"auto",Be,Fe]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Be,Fe]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Be,Fe]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:J()}],"bg-repeat":[{bg:Z()}],"bg-size":[{bg:E()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Fn,Be,Fe],radial:["",Be,Fe],conic:[Fn,Be,Fe]},Az,Cz]}],"bg-color":[{bg:I()}],"gradient-from-pos":[{from:G()}],"gradient-via-pos":[{via:G()}],"gradient-to-pos":[{to:G()}],"gradient-from":[{from:I()}],"gradient-via":[{via:I()}],"gradient-to":[{to:I()}],rounded:[{rounded:V()}],"rounded-s":[{"rounded-s":V()}],"rounded-e":[{"rounded-e":V()}],"rounded-t":[{"rounded-t":V()}],"rounded-r":[{"rounded-r":V()}],"rounded-b":[{"rounded-b":V()}],"rounded-l":[{"rounded-l":V()}],"rounded-ss":[{"rounded-ss":V()}],"rounded-se":[{"rounded-se":V()}],"rounded-ee":[{"rounded-ee":V()}],"rounded-es":[{"rounded-es":V()}],"rounded-tl":[{"rounded-tl":V()}],"rounded-tr":[{"rounded-tr":V()}],"rounded-br":[{"rounded-br":V()}],"rounded-bl":[{"rounded-bl":V()}],"border-w":[{border:U()}],"border-w-x":[{"border-x":U()}],"border-w-y":[{"border-y":U()}],"border-w-s":[{"border-s":U()}],"border-w-e":[{"border-e":U()}],"border-w-t":[{"border-t":U()}],"border-w-r":[{"border-r":U()}],"border-w-b":[{"border-b":U()}],"border-w-l":[{"border-l":U()}],"divide-x":[{"divide-x":U()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":U()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...oe(),"hidden","none"]}],"divide-style":[{divide:[...oe(),"hidden","none"]}],"border-color":[{border:I()}],"border-color-x":[{"border-x":I()}],"border-color-y":[{"border-y":I()}],"border-color-s":[{"border-s":I()}],"border-color-e":[{"border-e":I()}],"border-color-t":[{"border-t":I()}],"border-color-r":[{"border-r":I()}],"border-color-b":[{"border-b":I()}],"border-color-l":[{"border-l":I()}],"divide-color":[{divide:I()}],"outline-style":[{outline:[...oe(),"none","hidden"]}],"outline-offset":[{"outline-offset":[rt,Be,Fe]}],"outline-w":[{outline:["",rt,Rl,La]}],"outline-color":[{outline:I()}],shadow:[{shadow:["","none",u,Gu,Uu]}],"shadow-color":[{shadow:I()}],"inset-shadow":[{"inset-shadow":["none",h,Gu,Uu]}],"inset-shadow-color":[{"inset-shadow":I()}],"ring-w":[{ring:U()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:I()}],"ring-offset-w":[{"ring-offset":[rt,La]}],"ring-offset-color":[{"ring-offset":I()}],"inset-ring-w":[{"inset-ring":U()}],"inset-ring-color":[{"inset-ring":I()}],"text-shadow":[{"text-shadow":["none",p,Gu,Uu]}],"text-shadow-color":[{"text-shadow":I()}],opacity:[{opacity:[rt,Be,Fe]}],"mix-blend":[{"mix-blend":[...re(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":re()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[rt]}],"mask-image-linear-from-pos":[{"mask-linear-from":ne()}],"mask-image-linear-to-pos":[{"mask-linear-to":ne()}],"mask-image-linear-from-color":[{"mask-linear-from":I()}],"mask-image-linear-to-color":[{"mask-linear-to":I()}],"mask-image-t-from-pos":[{"mask-t-from":ne()}],"mask-image-t-to-pos":[{"mask-t-to":ne()}],"mask-image-t-from-color":[{"mask-t-from":I()}],"mask-image-t-to-color":[{"mask-t-to":I()}],"mask-image-r-from-pos":[{"mask-r-from":ne()}],"mask-image-r-to-pos":[{"mask-r-to":ne()}],"mask-image-r-from-color":[{"mask-r-from":I()}],"mask-image-r-to-color":[{"mask-r-to":I()}],"mask-image-b-from-pos":[{"mask-b-from":ne()}],"mask-image-b-to-pos":[{"mask-b-to":ne()}],"mask-image-b-from-color":[{"mask-b-from":I()}],"mask-image-b-to-color":[{"mask-b-to":I()}],"mask-image-l-from-pos":[{"mask-l-from":ne()}],"mask-image-l-to-pos":[{"mask-l-to":ne()}],"mask-image-l-from-color":[{"mask-l-from":I()}],"mask-image-l-to-color":[{"mask-l-to":I()}],"mask-image-x-from-pos":[{"mask-x-from":ne()}],"mask-image-x-to-pos":[{"mask-x-to":ne()}],"mask-image-x-from-color":[{"mask-x-from":I()}],"mask-image-x-to-color":[{"mask-x-to":I()}],"mask-image-y-from-pos":[{"mask-y-from":ne()}],"mask-image-y-to-pos":[{"mask-y-to":ne()}],"mask-image-y-from-color":[{"mask-y-from":I()}],"mask-image-y-to-color":[{"mask-y-to":I()}],"mask-image-radial":[{"mask-radial":[Be,Fe]}],"mask-image-radial-from-pos":[{"mask-radial-from":ne()}],"mask-image-radial-to-pos":[{"mask-radial-to":ne()}],"mask-image-radial-from-color":[{"mask-radial-from":I()}],"mask-image-radial-to-color":[{"mask-radial-to":I()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":C()}],"mask-image-conic-pos":[{"mask-conic":[rt]}],"mask-image-conic-from-pos":[{"mask-conic-from":ne()}],"mask-image-conic-to-pos":[{"mask-conic-to":ne()}],"mask-image-conic-from-color":[{"mask-conic-from":I()}],"mask-image-conic-to-color":[{"mask-conic-to":I()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:J()}],"mask-repeat":[{mask:Z()}],"mask-size":[{mask:E()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",Be,Fe]}],filter:[{filter:["","none",Be,Fe]}],blur:[{blur:Ee()}],brightness:[{brightness:[rt,Be,Fe]}],contrast:[{contrast:[rt,Be,Fe]}],"drop-shadow":[{"drop-shadow":["","none",f,Gu,Uu]}],"drop-shadow-color":[{"drop-shadow":I()}],grayscale:[{grayscale:["",rt,Be,Fe]}],"hue-rotate":[{"hue-rotate":[rt,Be,Fe]}],invert:[{invert:["",rt,Be,Fe]}],saturate:[{saturate:[rt,Be,Fe]}],sepia:[{sepia:["",rt,Be,Fe]}],"backdrop-filter":[{"backdrop-filter":["","none",Be,Fe]}],"backdrop-blur":[{"backdrop-blur":Ee()}],"backdrop-brightness":[{"backdrop-brightness":[rt,Be,Fe]}],"backdrop-contrast":[{"backdrop-contrast":[rt,Be,Fe]}],"backdrop-grayscale":[{"backdrop-grayscale":["",rt,Be,Fe]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[rt,Be,Fe]}],"backdrop-invert":[{"backdrop-invert":["",rt,Be,Fe]}],"backdrop-opacity":[{"backdrop-opacity":[rt,Be,Fe]}],"backdrop-saturate":[{"backdrop-saturate":[rt,Be,Fe]}],"backdrop-sepia":[{"backdrop-sepia":["",rt,Be,Fe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":T()}],"border-spacing-x":[{"border-spacing-x":T()}],"border-spacing-y":[{"border-spacing-y":T()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",Be,Fe]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[rt,"initial",Be,Fe]}],ease:[{ease:["linear","initial",x,Be,Fe]}],delay:[{delay:[rt,Be,Fe]}],animate:[{animate:["none",b,Be,Fe]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[g,Be,Fe]}],"perspective-origin":[{"perspective-origin":k()}],rotate:[{rotate:K()}],"rotate-x":[{"rotate-x":K()}],"rotate-y":[{"rotate-y":K()}],"rotate-z":[{"rotate-z":K()}],scale:[{scale:me()}],"scale-x":[{"scale-x":me()}],"scale-y":[{"scale-y":me()}],"scale-z":[{"scale-z":me()}],"scale-3d":["scale-3d"],skew:[{skew:$()}],"skew-x":[{"skew-x":$()}],"skew-y":[{"skew-y":$()}],transform:[{transform:[Be,Fe,"","none","gpu","cpu"]}],"transform-origin":[{origin:k()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Q()}],"translate-x":[{"translate-x":Q()}],"translate-y":[{"translate-y":Q()}],"translate-z":[{"translate-z":Q()}],"translate-none":["translate-none"],accent:[{accent:I()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:I()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Be,Fe]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Be,Fe]}],fill:[{fill:["none",...I()]}],"stroke-w":[{stroke:[rt,Rl,La,sm]}],stroke:[{stroke:["none",...I()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Mz=lz(Ez);function $e(...r){return Mz(a_(r))}const $w=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,zw=a_,tf=(r,e)=>t=>{var s;if(e?.variants==null)return zw(r,t?.class,t?.className);const{variants:i,defaultVariants:n}=e,a=Object.keys(i).map(d=>{const u=t?.[d],h=n?.[d];if(u===null)return null;const p=$w(u)||$w(h);return i[d][p]}),o=t&&Object.entries(t).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),l=e==null||(s=e.compoundVariants)===null||s===void 0?void 0:s.reduce((d,u)=>{let{class:h,className:p,...f}=u;return Object.entries(f).every(m=>{let[g,y]=m;return Array.isArray(y)?y.includes({...n,...o}[g]):{...n,...o}[g]===y})?[...d,h,p]:d},[]);return zw(r,a,l,t?.class,t?.className)},Pz=tf("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Nz=v.forwardRef(({className:r,variant:e,...t},s)=>c.jsx("div",{ref:s,role:"alert",className:$e(Pz({variant:e}),r),...t}));Nz.displayName="Alert";const Rz=v.forwardRef(({className:r,...e},t)=>c.jsx("h5",{ref:t,className:$e("mb-1 font-medium leading-none tracking-tight",r),...e}));Rz.displayName="AlertTitle";const Iz=v.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:$e("text-sm [&_p]:leading-relaxed",r),...e}));Iz.displayName="AlertDescription";const Dz=tf("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-white hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10","icon-sm":"h-8 w-8 [&_svg]:size-4","icon-xs":"h-6 w-6 [&_svg]:size-3.5"}},defaultVariants:{variant:"default",size:"default"}}),Et=v.forwardRef(({className:r,variant:e,size:t,asChild:s=!1,...i},n)=>{const a=s?DN:"button";return c.jsx(a,{className:$e(Dz({variant:e,size:t,className:r})),ref:n,...i})});Et.displayName="Button";const Fz=v.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:$e("rounded-lg border bg-card text-card-foreground shadow-sm",r),...e}));Fz.displayName="Card";const Bz=v.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:$e("flex flex-col space-y-1.5 p-6",r),...e}));Bz.displayName="CardHeader";const Lz=v.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:$e("text-2xl font-semibold leading-none tracking-tight",r),...e}));Lz.displayName="CardTitle";const Oz=v.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:$e("text-sm text-muted-foreground",r),...e}));Oz.displayName="CardDescription";const $z=v.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:$e("p-6 pt-0",r),...e}));$z.displayName="CardContent";const zz=v.forwardRef(({className:r,...e},t)=>c.jsx("div",{ref:t,className:$e("flex items-center p-6 pt-0",r),...e}));zz.displayName="CardFooter";const E0=v.forwardRef(({className:r,...e},t)=>c.jsx(cS,{ref:t,className:$e("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...e,children:c.jsx(FN,{className:$e("grid place-content-center text-current"),children:c.jsx(Ei,{className:"h-4 w-4"})})}));E0.displayName=cS.displayName;const Br=v.forwardRef(({icon:r,iconSize:e=14,className:t,variant:s="ghost",size:i="icon-xs",...n},a)=>c.jsx(Et,{ref:a,variant:s,size:i,className:$e("text-text-secondary hover:text-text-primary hover:bg-background-elevated",t),...n,children:c.jsx(r,{size:e})}));Br.displayName="IconButton";const Ud=v.createContext({});function Ux(r){const e=v.useRef(null);return e.current===null&&(e.current=r()),e.current}const b_=typeof window<"u",Gx=b_?v.useLayoutEffect:v.useEffect,sf=v.createContext(null);function Wx(r,e){r.indexOf(e)===-1&&r.push(e)}function Yx(r,e){const t=r.indexOf(e);t>-1&&r.splice(t,1)}const Wr=(r,e,t)=>t>e?e:t<r?r:t;let qx=()=>{};const wn={},v_=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function w_(r){return typeof r=="object"&&r!==null}const k_=r=>/^0[^.\s]+$/u.test(r);function Hx(r){let e;return()=>(e===void 0&&(e=r()),e)}const lr=r=>r,Vz=(r,e)=>t=>e(r(t)),xu=(...r)=>r.reduce(Vz),Gd=(r,e,t)=>{const s=e-r;return s===0?1:(t-r)/s};class Xx{constructor(){this.subscriptions=[]}add(e){return Wx(this.subscriptions,e),()=>Yx(this.subscriptions,e)}notify(e,t,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,s);else for(let n=0;n<i;n++){const a=this.subscriptions[n];a&&a(e,t,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const gn=r=>r*1e3,sr=r=>r/1e3;function C_(r,e){return e?r*(1e3/e):0}const S_=(r,e,t)=>(((1-3*t+3*e)*r+(3*t-6*e))*r+3*e)*r,Uz=1e-7,Gz=12;function Wz(r,e,t,s,i){let n,a,o=0;do a=e+(t-e)/2,n=S_(a,s,i)-r,n>0?t=a:e=a;while(Math.abs(n)>Uz&&++o<Gz);return a}function bu(r,e,t,s){if(r===e&&t===s)return lr;const i=n=>Wz(n,0,1,r,t);return n=>n===0||n===1?n:S_(i(n),e,s)}const T_=r=>e=>e<=.5?r(2*e)/2:(2-r(2*(1-e)))/2,A_=r=>e=>1-r(1-e),j_=bu(.33,1.53,.69,.99),Kx=A_(j_),__=T_(Kx),E_=r=>(r*=2)<1?.5*Kx(r):.5*(2-Math.pow(2,-10*(r-1))),Qx=r=>1-Math.sin(Math.acos(r)),M_=A_(Qx),P_=T_(Qx),Yz=bu(.42,0,1,1),qz=bu(0,0,.58,1),N_=bu(.42,0,.58,1),Hz=r=>Array.isArray(r)&&typeof r[0]!="number",R_=r=>Array.isArray(r)&&typeof r[0]=="number",Xz={linear:lr,easeIn:Yz,easeInOut:N_,easeOut:qz,circIn:Qx,circInOut:P_,circOut:M_,backIn:Kx,backInOut:__,backOut:j_,anticipate:E_},Kz=r=>typeof r=="string",Vw=r=>{if(R_(r)){qx(r.length===4);const[e,t,s,i]=r;return bu(e,t,s,i)}else if(Kz(r))return Xz[r];return r},Wu=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Qz(r,e){let t=new Set,s=new Set,i=!1,n=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(u){a.has(u)&&(d.schedule(u),r()),u(o)}const d={schedule:(u,h=!1,p=!1)=>{const m=p&&i?t:s;return h&&a.add(u),m.has(u)||m.add(u),u},cancel:u=>{s.delete(u),a.delete(u)},process:u=>{if(o=u,i){n=!0;return}i=!0,[t,s]=[s,t],t.forEach(l),t.clear(),i=!1,n&&(n=!1,d.process(u))}};return d}const Jz=40;function I_(r,e){let t=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},n=()=>t=!0,a=Wu.reduce((w,C)=>(w[C]=Qz(n),w),{}),{setup:o,read:l,resolveKeyframes:d,preUpdate:u,update:h,preRender:p,render:f,postRender:m}=a,g=()=>{const w=wn.useManualTiming?i.timestamp:performance.now();t=!1,wn.useManualTiming||(i.delta=s?1e3/60:Math.max(Math.min(w-i.timestamp,Jz),1)),i.timestamp=w,i.isProcessing=!0,o.process(i),l.process(i),d.process(i),u.process(i),h.process(i),p.process(i),f.process(i),m.process(i),i.isProcessing=!1,t&&e&&(s=!1,r(g))},y=()=>{t=!0,s=!0,i.isProcessing||r(g)};return{schedule:Wu.reduce((w,C)=>{const k=a[C];return w[C]=(S,A=!1,T=!1)=>(t||y(),k.schedule(S,A,T)),w},{}),cancel:w=>{for(let C=0;C<Wu.length;C++)a[Wu[C]].cancel(w)},state:i,steps:a}}const{schedule:Rt,cancel:ma,state:Fs,steps:im}=I_(typeof requestAnimationFrame<"u"?requestAnimationFrame:lr,!0);let Rh;function Zz(){Rh=void 0}const li={now:()=>(Rh===void 0&&li.set(Fs.isProcessing||wn.useManualTiming?Fs.timestamp:performance.now()),Rh),set:r=>{Rh=r,queueMicrotask(Zz)}},D_=r=>e=>typeof e=="string"&&e.startsWith(r),F_=D_("--"),eV=D_("var(--"),Jx=r=>eV(r)?tV.test(r.split("/*")[0].trim()):!1,tV=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Uw(r){return typeof r!="string"?!1:r.split("/*")[0].includes("var(--")}const al={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},Wd={...al,transform:r=>Wr(0,1,r)},Yu={...al,default:1},vd=r=>Math.round(r*1e5)/1e5,Zx=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function sV(r){return r==null}const iV=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,eb=(r,e)=>t=>!!(typeof t=="string"&&iV.test(t)&&t.startsWith(r)||e&&!sV(t)&&Object.prototype.hasOwnProperty.call(t,e)),B_=(r,e,t)=>s=>{if(typeof s!="string")return s;const[i,n,a,o]=s.match(Zx);return{[r]:parseFloat(i),[e]:parseFloat(n),[t]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},rV=r=>Wr(0,255,r),rm={...al,transform:r=>Math.round(rV(r))},ao={test:eb("rgb","red"),parse:B_("red","green","blue"),transform:({red:r,green:e,blue:t,alpha:s=1})=>"rgba("+rm.transform(r)+", "+rm.transform(e)+", "+rm.transform(t)+", "+vd(Wd.transform(s))+")"};function nV(r){let e="",t="",s="",i="";return r.length>5?(e=r.substring(1,3),t=r.substring(3,5),s=r.substring(5,7),i=r.substring(7,9)):(e=r.substring(1,2),t=r.substring(2,3),s=r.substring(3,4),i=r.substring(4,5),e+=e,t+=t,s+=s,i+=i),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const M0={test:eb("#"),parse:nV,transform:ao.transform},vu=r=>({test:e=>typeof e=="string"&&e.endsWith(r)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${r}`}),qn=vu("deg"),zr=vu("%"),Le=vu("px"),aV=vu("vh"),oV=vu("vw"),Gw={...zr,parse:r=>zr.parse(r)/100,transform:r=>zr.transform(r*100)},uc={test:eb("hsl","hue"),parse:B_("hue","saturation","lightness"),transform:({hue:r,saturation:e,lightness:t,alpha:s=1})=>"hsla("+Math.round(r)+", "+zr.transform(vd(e))+", "+zr.transform(vd(t))+", "+vd(Wd.transform(s))+")"},ms={test:r=>ao.test(r)||M0.test(r)||uc.test(r),parse:r=>ao.test(r)?ao.parse(r):uc.test(r)?uc.parse(r):M0.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?ao.transform(r):uc.transform(r),getAnimatableNone:r=>{const e=ms.parse(r);return e.alpha=0,ms.transform(e)}},cV=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function lV(r){return isNaN(r)&&typeof r=="string"&&(r.match(Zx)?.length||0)+(r.match(cV)?.length||0)>0}const L_="number",O_="color",dV="var",uV="var(",Ww="${}",hV=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Yd(r){const e=r.toString(),t=[],s={color:[],number:[],var:[]},i=[];let n=0;const o=e.replace(hV,l=>(ms.test(l)?(s.color.push(n),i.push(O_),t.push(ms.parse(l))):l.startsWith(uV)?(s.var.push(n),i.push(dV),t.push(l)):(s.number.push(n),i.push(L_),t.push(parseFloat(l))),++n,Ww)).split(Ww);return{values:t,split:o,indexes:s,types:i}}function $_(r){return Yd(r).values}function z_(r){const{split:e,types:t}=Yd(r),s=e.length;return i=>{let n="";for(let a=0;a<s;a++)if(n+=e[a],i[a]!==void 0){const o=t[a];o===L_?n+=vd(i[a]):o===O_?n+=ms.transform(i[a]):n+=i[a]}return n}}const pV=r=>typeof r=="number"?0:ms.test(r)?ms.getAnimatableNone(r):r;function fV(r){const e=$_(r);return z_(r)(e.map(pV))}const ga={test:lV,parse:$_,createTransformer:z_,getAnimatableNone:fV};function nm(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*(2/3-t)*6:r}function mV({hue:r,saturation:e,lightness:t,alpha:s}){r/=360,e/=100,t/=100;let i=0,n=0,a=0;if(!e)i=n=a=t;else{const o=t<.5?t*(1+e):t+e-t*e,l=2*t-o;i=nm(l,o,r+1/3),n=nm(l,o,r),a=nm(l,o,r-1/3)}return{red:Math.round(i*255),green:Math.round(n*255),blue:Math.round(a*255),alpha:s}}function gp(r,e){return t=>t>0?e:r}const Kt=(r,e,t)=>r+(e-r)*t,am=(r,e,t)=>{const s=r*r,i=t*(e*e-s)+s;return i<0?0:Math.sqrt(i)},gV=[M0,ao,uc],yV=r=>gV.find(e=>e.test(r));function Yw(r){const e=yV(r);if(!e)return!1;let t=e.parse(r);return e===uc&&(t=mV(t)),t}const qw=(r,e)=>{const t=Yw(r),s=Yw(e);if(!t||!s)return gp(r,e);const i={...t};return n=>(i.red=am(t.red,s.red,n),i.green=am(t.green,s.green,n),i.blue=am(t.blue,s.blue,n),i.alpha=Kt(t.alpha,s.alpha,n),ao.transform(i))},P0=new Set(["none","hidden"]);function xV(r,e){return P0.has(r)?t=>t<=0?r:e:t=>t>=1?e:r}function bV(r,e){return t=>Kt(r,e,t)}function tb(r){return typeof r=="number"?bV:typeof r=="string"?Jx(r)?gp:ms.test(r)?qw:kV:Array.isArray(r)?V_:typeof r=="object"?ms.test(r)?qw:vV:gp}function V_(r,e){const t=[...r],s=t.length,i=r.map((n,a)=>tb(n)(n,e[a]));return n=>{for(let a=0;a<s;a++)t[a]=i[a](n);return t}}function vV(r,e){const t={...r,...e},s={};for(const i in t)r[i]!==void 0&&e[i]!==void 0&&(s[i]=tb(r[i])(r[i],e[i]));return i=>{for(const n in s)t[n]=s[n](i);return t}}function wV(r,e){const t=[],s={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const n=e.types[i],a=r.indexes[n][s[n]],o=r.values[a]??0;t[i]=o,s[n]++}return t}const kV=(r,e)=>{const t=ga.createTransformer(e),s=Yd(r),i=Yd(e);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?P0.has(r)&&!i.values.length||P0.has(e)&&!s.values.length?xV(r,e):xu(V_(wV(s,i),i.values),t):gp(r,e)};function U_(r,e,t){return typeof r=="number"&&typeof e=="number"&&typeof t=="number"?Kt(r,e,t):tb(r)(r,e)}const CV=r=>{const e=({timestamp:t})=>r(t);return{start:(t=!0)=>Rt.update(e,t),stop:()=>ma(e),now:()=>Fs.isProcessing?Fs.timestamp:li.now()}},G_=(r,e,t=10)=>{let s="";const i=Math.max(Math.round(e/t),2);for(let n=0;n<i;n++)s+=Math.round(r(n/(i-1))*1e4)/1e4+", ";return`linear(${s.substring(0,s.length-2)})`},yp=2e4;function sb(r){let e=0;const t=50;let s=r.next(e);for(;!s.done&&e<yp;)e+=t,s=r.next(e);return e>=yp?1/0:e}function SV(r,e=100,t){const s=t({...r,keyframes:[0,e]}),i=Math.min(sb(s),yp);return{type:"keyframes",ease:n=>s.next(i*n).value/e,duration:sr(i)}}const TV=5;function W_(r,e,t){const s=Math.max(e-TV,0);return C_(t-r(s),e-s)}const es={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},om=.001;function AV({duration:r=es.duration,bounce:e=es.bounce,velocity:t=es.velocity,mass:s=es.mass}){let i,n,a=1-e;a=Wr(es.minDamping,es.maxDamping,a),r=Wr(es.minDuration,es.maxDuration,sr(r)),a<1?(i=d=>{const u=d*a,h=u*r,p=u-t,f=N0(d,a),m=Math.exp(-h);return om-p/f*m},n=d=>{const h=d*a*r,p=h*t+t,f=Math.pow(a,2)*Math.pow(d,2)*r,m=Math.exp(-h),g=N0(Math.pow(d,2),a);return(-i(d)+om>0?-1:1)*((p-f)*m)/g}):(i=d=>{const u=Math.exp(-d*r),h=(d-t)*r+1;return-om+u*h},n=d=>{const u=Math.exp(-d*r),h=(t-d)*(r*r);return u*h});const o=5/r,l=_V(i,n,o);if(r=gn(r),isNaN(l))return{stiffness:es.stiffness,damping:es.damping,duration:r};{const d=Math.pow(l,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:r}}}const jV=12;function _V(r,e,t){let s=t;for(let i=1;i<jV;i++)s=s-r(s)/e(s);return s}function N0(r,e){return r*Math.sqrt(1-e*e)}const EV=["duration","bounce"],MV=["stiffness","damping","mass"];function Hw(r,e){return e.some(t=>r[t]!==void 0)}function PV(r){let e={velocity:es.velocity,stiffness:es.stiffness,damping:es.damping,mass:es.mass,isResolvedFromDuration:!1,...r};if(!Hw(r,MV)&&Hw(r,EV))if(r.visualDuration){const t=r.visualDuration,s=2*Math.PI/(t*1.2),i=s*s,n=2*Wr(.05,1,1-(r.bounce||0))*Math.sqrt(i);e={...e,mass:es.mass,stiffness:i,damping:n}}else{const t=AV(r);e={...e,...t,mass:es.mass},e.isResolvedFromDuration=!0}return e}function xp(r=es.visualDuration,e=es.bounce){const t=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:e}:r;let{restSpeed:s,restDelta:i}=t;const n=t.keyframes[0],a=t.keyframes[t.keyframes.length-1],o={done:!1,value:n},{stiffness:l,damping:d,mass:u,duration:h,velocity:p,isResolvedFromDuration:f}=PV({...t,velocity:-sr(t.velocity||0)}),m=p||0,g=d/(2*Math.sqrt(l*u)),y=a-n,x=sr(Math.sqrt(l/u)),b=Math.abs(y)<5;s||(s=b?es.restSpeed.granular:es.restSpeed.default),i||(i=b?es.restDelta.granular:es.restDelta.default);let w;if(g<1){const k=N0(x,g);w=S=>{const A=Math.exp(-g*x*S);return a-A*((m+g*x*y)/k*Math.sin(k*S)+y*Math.cos(k*S))}}else if(g===1)w=k=>a-Math.exp(-x*k)*(y+(m+x*y)*k);else{const k=x*Math.sqrt(g*g-1);w=S=>{const A=Math.exp(-g*x*S),T=Math.min(k*S,300);return a-A*((m+g*x*y)*Math.sinh(T)+k*y*Math.cosh(T))/k}}const C={calculatedDuration:f&&h||null,next:k=>{const S=w(k);if(f)o.done=k>=h;else{let A=k===0?m:0;g<1&&(A=k===0?gn(m):W_(w,k,S));const T=Math.abs(A)<=s,j=Math.abs(a-S)<=i;o.done=T&&j}return o.value=o.done?a:S,o},toString:()=>{const k=Math.min(sb(C),yp),S=G_(A=>C.next(k*A).value,k,30);return k+"ms "+S},toTransition:()=>{}};return C}xp.applyToOptions=r=>{const e=SV(r,100,xp);return r.ease=e.ease,r.duration=gn(e.duration),r.type="keyframes",r};function R0({keyframes:r,velocity:e=0,power:t=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:n=500,modifyTarget:a,min:o,max:l,restDelta:d=.5,restSpeed:u}){const h=r[0],p={done:!1,value:h},f=T=>o!==void 0&&T<o||l!==void 0&&T>l,m=T=>o===void 0?l:l===void 0||Math.abs(o-T)<Math.abs(l-T)?o:l;let g=t*e;const y=h+g,x=a===void 0?y:a(y);x!==y&&(g=x-h);const b=T=>-g*Math.exp(-T/s),w=T=>x+b(T),C=T=>{const j=b(T),_=w(T);p.done=Math.abs(j)<=d,p.value=p.done?x:_};let k,S;const A=T=>{f(p.value)&&(k=T,S=xp({keyframes:[p.value,m(p.value)],velocity:W_(w,T,p.value),damping:i,stiffness:n,restDelta:d,restSpeed:u}))};return A(0),{calculatedDuration:null,next:T=>{let j=!1;return!S&&k===void 0&&(j=!0,C(T),A(T)),k!==void 0&&T>=k?S.next(T-k):(!j&&C(T),p)}}}function NV(r,e,t){const s=[],i=t||wn.mix||U_,n=r.length-1;for(let a=0;a<n;a++){let o=i(r[a],r[a+1]);if(e){const l=Array.isArray(e)?e[a]||lr:e;o=xu(l,o)}s.push(o)}return s}function RV(r,e,{clamp:t=!0,ease:s,mixer:i}={}){const n=r.length;if(qx(n===e.length),n===1)return()=>e[0];if(n===2&&e[0]===e[1])return()=>e[1];const a=r[0]===r[1];r[0]>r[n-1]&&(r=[...r].reverse(),e=[...e].reverse());const o=NV(e,s,i),l=o.length,d=u=>{if(a&&u<r[0])return e[0];let h=0;if(l>1)for(;h<r.length-2&&!(u<r[h+1]);h++);const p=Gd(r[h],r[h+1],u);return o[h](p)};return t?u=>d(Wr(r[0],r[n-1],u)):d}function IV(r,e){const t=r[r.length-1];for(let s=1;s<=e;s++){const i=Gd(0,e,s);r.push(Kt(t,1,i))}}function DV(r){const e=[0];return IV(e,r.length-1),e}function FV(r,e){return r.map(t=>t*e)}function BV(r,e){return r.map(()=>e||N_).splice(0,r.length-1)}function wd({duration:r=300,keyframes:e,times:t,ease:s="easeInOut"}){const i=Hz(s)?s.map(Vw):Vw(s),n={done:!1,value:e[0]},a=FV(t&&t.length===e.length?t:DV(e),r),o=RV(a,e,{ease:Array.isArray(i)?i:BV(e,i)});return{calculatedDuration:r,next:l=>(n.value=o(l),n.done=l>=r,n)}}const LV=r=>r!==null;function ib(r,{repeat:e,repeatType:t="loop"},s,i=1){const n=r.filter(LV),o=i<0||e&&t!=="loop"&&e%2===1?0:n.length-1;return!o||s===void 0?n[o]:s}const OV={decay:R0,inertia:R0,tween:wd,keyframes:wd,spring:xp};function Y_(r){typeof r.type=="string"&&(r.type=OV[r.type])}class rb{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,t){return this.finished.then(e,t)}}const $V=r=>r/100;class nb extends rb{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:t}=this.options;t&&t.updatedAt!==li.now()&&this.tick(li.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;Y_(e);const{type:t=wd,repeat:s=0,repeatDelay:i=0,repeatType:n,velocity:a=0}=e;let{keyframes:o}=e;const l=t||wd;l!==wd&&typeof o[0]!="number"&&(this.mixKeyframes=xu($V,U_(o[0],o[1])),o=[0,100]);const d=l({...e,keyframes:o});n==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...o].reverse(),velocity:-a})),d.calculatedDuration===null&&(d.calculatedDuration=sb(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+i,this.totalDuration=this.resolvedDuration*(s+1)-i,this.generator=d}updateTime(e){const t=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=t}tick(e,t=!1){const{generator:s,totalDuration:i,mixKeyframes:n,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(this.startTime===null)return s.next(0);const{delay:d=0,keyframes:u,repeat:h,repeatType:p,repeatDelay:f,type:m,onUpdate:g,finalKeyframe:y}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),t?this.currentTime=e:this.updateTime(e);const x=this.currentTime-d*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?x<0:x>i;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let w=this.currentTime,C=s;if(h){const T=Math.min(this.currentTime,i)/o;let j=Math.floor(T),_=T%1;!_&&T>=1&&(_=1),_===1&&j--,j=Math.min(j,h+1),!!(j%2)&&(p==="reverse"?(_=1-_,f&&(_-=f/o)):p==="mirror"&&(C=a)),w=Wr(0,1,_)*o}const k=b?{done:!1,value:u[0]}:C.next(w);n&&(k.value=n(k.value));let{done:S}=k;!b&&l!==null&&(S=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const A=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return A&&m!==R0&&(k.value=ib(u,this.options,y,this.speed)),g&&g(k.value),A&&this.finish(),k}then(e,t){return this.finished.then(e,t)}get duration(){return sr(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+sr(e)}get time(){return sr(this.currentTime)}set time(e){e=gn(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(li.now());const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=sr(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=CV,startTime:t}=this.options;this.driver||(this.driver=e(i=>this.tick(i))),this.options.onPlay?.();const s=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=s):this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime||(this.startTime=t??s),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(li.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function zV(r){for(let e=1;e<r.length;e++)r[e]??(r[e]=r[e-1])}const oo=r=>r*180/Math.PI,I0=r=>{const e=oo(Math.atan2(r[1],r[0]));return D0(e)},VV={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:I0,rotateZ:I0,skewX:r=>oo(Math.atan(r[1])),skewY:r=>oo(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},D0=r=>(r=r%360,r<0&&(r+=360),r),Xw=I0,Kw=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),Qw=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),UV={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Kw,scaleY:Qw,scale:r=>(Kw(r)+Qw(r))/2,rotateX:r=>D0(oo(Math.atan2(r[6],r[5]))),rotateY:r=>D0(oo(Math.atan2(-r[2],r[0]))),rotateZ:Xw,rotate:Xw,skewX:r=>oo(Math.atan(r[4])),skewY:r=>oo(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function F0(r){return r.includes("scale")?1:0}function B0(r,e){if(!r||r==="none")return F0(e);const t=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let s,i;if(t)s=UV,i=t;else{const o=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);s=VV,i=o}if(!i)return F0(e);const n=s[e],a=i[1].split(",").map(WV);return typeof n=="function"?n(a):a[n]}const GV=(r,e)=>{const{transform:t="none"}=getComputedStyle(r);return B0(t,e)};function WV(r){return parseFloat(r.trim())}const ol=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],cl=new Set(ol),Jw=r=>r===al||r===Le,YV=new Set(["x","y","z"]),qV=ol.filter(r=>!YV.has(r));function HV(r){const e=[];return qV.forEach(t=>{const s=r.getValue(t);s!==void 0&&(e.push([t,s.get()]),s.set(t.startsWith("scale")?1:0))}),e}const Qn={width:({x:r},{paddingLeft:e="0",paddingRight:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),height:({y:r},{paddingTop:e="0",paddingBottom:t="0"})=>r.max-r.min-parseFloat(e)-parseFloat(t),top:(r,{top:e})=>parseFloat(e),left:(r,{left:e})=>parseFloat(e),bottom:({y:r},{top:e})=>parseFloat(e)+(r.max-r.min),right:({x:r},{left:e})=>parseFloat(e)+(r.max-r.min),x:(r,{transform:e})=>B0(e,"x"),y:(r,{transform:e})=>B0(e,"y")};Qn.translateX=Qn.x;Qn.translateY=Qn.y;const mo=new Set;let L0=!1,O0=!1,$0=!1;function q_(){if(O0){const r=Array.from(mo).filter(s=>s.needsMeasurement),e=new Set(r.map(s=>s.element)),t=new Map;e.forEach(s=>{const i=HV(s);i.length&&(t.set(s,i),s.render())}),r.forEach(s=>s.measureInitialState()),e.forEach(s=>{s.render();const i=t.get(s);i&&i.forEach(([n,a])=>{s.getValue(n)?.set(a)})}),r.forEach(s=>s.measureEndState()),r.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}O0=!1,L0=!1,mo.forEach(r=>r.complete($0)),mo.clear()}function H_(){mo.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(O0=!0)})}function XV(){$0=!0,H_(),q_(),$0=!1}class ab{constructor(e,t,s,i,n,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=s,this.motionValue=i,this.element=n,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(mo.add(this),L0||(L0=!0,Rt.read(H_),Rt.resolveKeyframes(q_))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:s,motionValue:i}=this;if(e[0]===null){const n=i?.get(),a=e[e.length-1];if(n!==void 0)e[0]=n;else if(s&&t){const o=s.readValue(t,a);o!=null&&(e[0]=o)}e[0]===void 0&&(e[0]=a),i&&n===void 0&&i.set(e[0])}zV(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),mo.delete(this)}cancel(){this.state==="scheduled"&&(mo.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const KV=r=>r.startsWith("--");function QV(r,e,t){KV(e)?r.style.setProperty(e,t):r.style[e]=t}const JV=Hx(()=>window.ScrollTimeline!==void 0),ZV={};function e6(r,e){const t=Hx(r);return()=>ZV[e]??t()}const X_=e6(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),td=([r,e,t,s])=>`cubic-bezier(${r}, ${e}, ${t}, ${s})`,Zw={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:td([0,.65,.55,1]),circOut:td([.55,0,1,.45]),backIn:td([.31,.01,.66,-.59]),backOut:td([.33,1.53,.69,.99])};function K_(r,e){if(r)return typeof r=="function"?X_()?G_(r,e):"ease-out":R_(r)?td(r):Array.isArray(r)?r.map(t=>K_(t,e)||Zw.easeOut):Zw[r]}function t6(r,e,t,{delay:s=0,duration:i=300,repeat:n=0,repeatType:a="loop",ease:o="easeOut",times:l}={},d=void 0){const u={[e]:t};l&&(u.offset=l);const h=K_(o,i);Array.isArray(h)&&(u.easing=h);const p={delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:n+1,direction:a==="reverse"?"alternate":"normal"};return d&&(p.pseudoElement=d),r.animate(u,p)}function Q_(r){return typeof r=="function"&&"applyToOptions"in r}function s6({type:r,...e}){return Q_(r)&&X_()?r.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class i6 extends rb{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!e)return;const{element:t,name:s,keyframes:i,pseudoElement:n,allowFlatten:a=!1,finalKeyframe:o,onComplete:l}=e;this.isPseudoElement=!!n,this.allowFlatten=a,this.options=e,qx(typeof e.type!="string");const d=s6(e);this.animation=t6(t,s,i,d,n),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!n){const u=ib(i,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(u):QV(t,s,u),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return sr(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+sr(e)}get time(){return sr(Number(this.animation.currentTime)||0)}set time(e){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=gn(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(e){this.manualStartTime=this.animation.startTime=e}attachTimeline({timeline:e,observe:t}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&JV()?(this.animation.timeline=e,lr):t(this)}}const J_={anticipate:E_,backInOut:__,circInOut:P_};function r6(r){return r in J_}function n6(r){typeof r.ease=="string"&&r6(r.ease)&&(r.ease=J_[r.ease])}const cm=10;class a6 extends i6{constructor(e){n6(e),Y_(e),super(e),e.startTime!==void 0&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:t,onUpdate:s,onComplete:i,element:n,...a}=this.options;if(!t)return;if(e!==void 0){t.set(e);return}const o=new nb({...a,autoplay:!1}),l=Math.max(cm,li.now()-this.startTime),d=Wr(0,cm,l-cm);t.setWithVelocity(o.sample(Math.max(0,l-d)).value,o.sample(l).value,d),o.stop()}}const ek=(r,e)=>e==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(ga.test(r)||r==="0")&&!r.startsWith("url("));function o6(r){const e=r[0];if(r.length===1)return!0;for(let t=0;t<r.length;t++)if(r[t]!==e)return!0}function c6(r,e,t,s){const i=r[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const n=r[r.length-1],a=ek(i,e),o=ek(n,e);return!a||!o?!1:o6(r)||(t==="spring"||Q_(t))&&s}function z0(r){r.duration=0,r.type="keyframes"}const l6=new Set(["opacity","clipPath","filter","transform"]),d6=Hx(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function u6(r){const{motionValue:e,name:t,repeatDelay:s,repeatType:i,damping:n,type:a}=r;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:d}=e.owner.getProps();return d6()&&t&&l6.has(t)&&(t!=="transform"||!d)&&!l&&!s&&i!=="mirror"&&n!==0&&a!=="inertia"}const h6=40;class p6 extends rb{constructor({autoplay:e=!0,delay:t=0,type:s="keyframes",repeat:i=0,repeatDelay:n=0,repeatType:a="loop",keyframes:o,name:l,motionValue:d,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=li.now();const p={autoplay:e,delay:t,type:s,repeat:i,repeatDelay:n,repeatType:a,name:l,motionValue:d,element:u,...h},f=u?.KeyframeResolver||ab;this.keyframeResolver=new f(o,(m,g,y)=>this.onKeyframesResolved(m,g,p,!y),l,d,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,t,s,i){this.keyframeResolver=void 0;const{name:n,type:a,velocity:o,delay:l,isHandoff:d,onUpdate:u}=s;this.resolvedAt=li.now(),c6(e,n,a,o)||((wn.instantAnimations||!l)&&u?.(ib(e,s,t)),e[0]=e[e.length-1],z0(s),s.repeat=0);const p={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>h6?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:t,...s,keyframes:e},f=!d&&u6(p),m=p.motionValue?.owner?.current,g=f?new a6({...p,element:m}):new nb(p);g.finished.then(()=>{this.notifyFinished()}).catch(lr),this.pendingTimeline&&(this.stopTimeline=g.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=g}get finished(){return this._animation?this.animation.finished:this._finished}then(e,t){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),XV()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}function Z_(r,e,t,s=0,i=1){const n=Array.from(r).sort((d,u)=>d.sortNodePosition(u)).indexOf(e),a=r.size,o=(a-1)*s;return typeof t=="function"?t(n,a):i===1?n*s:o-n*s}const f6=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function m6(r){const e=f6.exec(r);if(!e)return[,];const[,t,s,i]=e;return[`--${t??s}`,i]}function eE(r,e,t=1){const[s,i]=m6(r);if(!s)return;const n=window.getComputedStyle(e).getPropertyValue(s);if(n){const a=n.trim();return v_(a)?parseFloat(a):a}return Jx(i)?eE(i,e,t+1):i}const g6={type:"spring",stiffness:500,damping:25,restSpeed:10},y6=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),x6={type:"keyframes",duration:.8},b6={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},v6=(r,{keyframes:e})=>e.length>2?x6:cl.has(r)?r.startsWith("scale")?y6(e[1]):g6:b6,w6=r=>r!==null;function k6(r,{repeat:e,repeatType:t="loop"},s){const i=r.filter(w6),n=e&&t!=="loop"&&e%2===1?0:i.length-1;return i[n]}function ob(r,e){return r?.[e]??r?.default??r}function C6({when:r,delay:e,delayChildren:t,staggerChildren:s,staggerDirection:i,repeat:n,repeatType:a,repeatDelay:o,from:l,elapsed:d,...u}){return!!Object.keys(u).length}const cb=(r,e,t,s={},i,n)=>a=>{const o=ob(s,r)||{},l=o.delay||s.delay||0;let{elapsed:d=0}=s;d=d-gn(l);const u={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-d,onUpdate:p=>{e.set(p),o.onUpdate&&o.onUpdate(p)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:r,motionValue:e,element:n?void 0:i};C6(o)||Object.assign(u,v6(r,u)),u.duration&&(u.duration=gn(u.duration)),u.repeatDelay&&(u.repeatDelay=gn(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(z0(u),u.delay===0&&(h=!0)),(wn.instantAnimations||wn.skipAnimations)&&(h=!0,z0(u),u.delay=0),u.allowFlatten=!o.type&&!o.ease,h&&!n&&e.get()!==void 0){const p=k6(u.keyframes,o);if(p!==void 0){Rt.update(()=>{u.onUpdate(p),u.onComplete()});return}}return o.isSync?new nb(u):new p6(u)};function tk(r){const e=[{},{}];return r?.values.forEach((t,s)=>{e[0][s]=t.get(),e[1][s]=t.getVelocity()}),e}function lb(r,e,t,s){if(typeof e=="function"){const[i,n]=tk(s);e=e(t!==void 0?t:r.custom,i,n)}if(typeof e=="string"&&(e=r.variants&&r.variants[e]),typeof e=="function"){const[i,n]=tk(s);e=e(t!==void 0?t:r.custom,i,n)}return e}function Tc(r,e,t){const s=r.getProps();return lb(s,e,t!==void 0?t:s.custom,r)}const tE=new Set(["width","height","top","left","right","bottom",...ol]),sk=30,S6=r=>!isNaN(parseFloat(r));class T6{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=s=>{const i=li.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const n of this.dependents)n.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=li.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=S6(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new Xx);const s=this.events[e].add(t);return e==="change"?()=>{s(),Rt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,s){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-s}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=li.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>sk)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,sk);return C_(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Gc(r,e){return new T6(r,e)}const V0=r=>Array.isArray(r);function A6(r,e,t){r.hasValue(e)?r.getValue(e).set(t):r.addValue(e,Gc(t))}function j6(r){return V0(r)?r[r.length-1]||0:r}function _6(r,e){const t=Tc(r,e);let{transitionEnd:s={},transition:i={},...n}=t||{};n={...n,...s};for(const a in n){const o=j6(n[a]);A6(r,a,o)}}const Qs=r=>!!(r&&r.getVelocity);function E6(r){return!!(Qs(r)&&r.add)}function U0(r,e){const t=r.getValue("willChange");if(E6(t))return t.add(e);if(!t&&wn.WillChange){const s=new wn.WillChange("auto");r.addValue("willChange",s),s.add(e)}}function db(r){return r.replace(/([A-Z])/g,e=>`-${e.toLowerCase()}`)}const M6="framerAppearId",sE="data-"+db(M6);function iE(r){return r.props[sE]}function P6({protectedKeys:r,needsAnimating:e},t){const s=r.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,s}function rE(r,e,{delay:t=0,transitionOverride:s,type:i}={}){let{transition:n=r.getDefaultTransition(),transitionEnd:a,...o}=e;s&&(n=s);const l=[],d=i&&r.animationState&&r.animationState.getState()[i];for(const u in o){const h=r.getValue(u,r.latestValues[u]??null),p=o[u];if(p===void 0||d&&P6(d,u))continue;const f={delay:t,...ob(n||{},u)},m=h.get();if(m!==void 0&&!h.isAnimating&&!Array.isArray(p)&&p===m&&!f.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const x=iE(r);if(x){const b=window.MotionHandoffAnimation(x,u,Rt);b!==null&&(f.startTime=b,g=!0)}}U0(r,u),h.start(cb(u,h,p,r.shouldReduceMotion&&tE.has(u)?{type:!1}:f,r,g));const y=h.animation;y&&l.push(y)}return a&&Promise.all(l).then(()=>{Rt.update(()=>{a&&_6(r,a)})}),l}function G0(r,e,t={}){const s=Tc(r,e,t.type==="exit"?r.presenceContext?.custom:void 0);let{transition:i=r.getDefaultTransition()||{}}=s||{};t.transitionOverride&&(i=t.transitionOverride);const n=s?()=>Promise.all(rE(r,s,t)):()=>Promise.resolve(),a=r.variantChildren&&r.variantChildren.size?(l=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=i;return N6(r,e,l,d,u,h,t)}:()=>Promise.resolve(),{when:o}=i;if(o){const[l,d]=o==="beforeChildren"?[n,a]:[a,n];return l().then(()=>d())}else return Promise.all([n(),a(t.delay)])}function N6(r,e,t=0,s=0,i=0,n=1,a){const o=[];for(const l of r.variantChildren)l.notify("AnimationStart",e),o.push(G0(l,e,{...a,delay:t+(typeof s=="function"?0:s)+Z_(r.variantChildren,l,s,i,n)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(o)}function R6(r,e,t={}){r.notify("AnimationStart",e);let s;if(Array.isArray(e)){const i=e.map(n=>G0(r,n,t));s=Promise.all(i)}else if(typeof e=="string")s=G0(r,e,t);else{const i=typeof e=="function"?Tc(r,e,t.custom):e;s=Promise.all(rE(r,i,t))}return s.then(()=>{r.notify("AnimationComplete",e)})}const I6={test:r=>r==="auto",parse:r=>r},nE=r=>e=>e.test(r),aE=[al,Le,zr,qn,oV,aV,I6],ik=r=>aE.find(nE(r));function D6(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||k_(r):!0}const F6=new Set(["brightness","contrast","saturate","opacity"]);function B6(r){const[e,t]=r.slice(0,-1).split("(");if(e==="drop-shadow")return r;const[s]=t.match(Zx)||[];if(!s)return r;const i=t.replace(s,"");let n=F6.has(e)?1:0;return s!==t&&(n*=100),e+"("+n+i+")"}const L6=/\b([a-z-]*)\(.*?\)/gu,W0={...ga,getAnimatableNone:r=>{const e=r.match(L6);return e?e.map(B6).join(" "):r}},rk={...al,transform:Math.round},O6={rotate:qn,rotateX:qn,rotateY:qn,rotateZ:qn,scale:Yu,scaleX:Yu,scaleY:Yu,scaleZ:Yu,skew:qn,skewX:qn,skewY:qn,distance:Le,translateX:Le,translateY:Le,translateZ:Le,x:Le,y:Le,z:Le,perspective:Le,transformPerspective:Le,opacity:Wd,originX:Gw,originY:Gw,originZ:Le},ub={borderWidth:Le,borderTopWidth:Le,borderRightWidth:Le,borderBottomWidth:Le,borderLeftWidth:Le,borderRadius:Le,borderTopLeftRadius:Le,borderTopRightRadius:Le,borderBottomRightRadius:Le,borderBottomLeftRadius:Le,width:Le,maxWidth:Le,height:Le,maxHeight:Le,top:Le,right:Le,bottom:Le,left:Le,inset:Le,insetBlock:Le,insetBlockStart:Le,insetBlockEnd:Le,insetInline:Le,insetInlineStart:Le,insetInlineEnd:Le,padding:Le,paddingTop:Le,paddingRight:Le,paddingBottom:Le,paddingLeft:Le,paddingBlock:Le,paddingBlockStart:Le,paddingBlockEnd:Le,paddingInline:Le,paddingInlineStart:Le,paddingInlineEnd:Le,margin:Le,marginTop:Le,marginRight:Le,marginBottom:Le,marginLeft:Le,marginBlock:Le,marginBlockStart:Le,marginBlockEnd:Le,marginInline:Le,marginInlineStart:Le,marginInlineEnd:Le,fontSize:Le,backgroundPositionX:Le,backgroundPositionY:Le,...O6,zIndex:rk,fillOpacity:Wd,strokeOpacity:Wd,numOctaves:rk},$6={...ub,color:ms,backgroundColor:ms,outlineColor:ms,fill:ms,stroke:ms,borderColor:ms,borderTopColor:ms,borderRightColor:ms,borderBottomColor:ms,borderLeftColor:ms,filter:W0,WebkitFilter:W0},oE=r=>$6[r];function cE(r,e){let t=oE(r);return t!==W0&&(t=ga),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const z6=new Set(["auto","none","0"]);function V6(r,e,t){let s=0,i;for(;s<r.length&&!i;){const n=r[s];typeof n=="string"&&!z6.has(n)&&Yd(n).values.length&&(i=r[s]),s++}if(i&&t)for(const n of e)r[n]=cE(t,i)}class U6 extends ab{constructor(e,t,s,i,n){super(e,t,s,i,n,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:s}=this;if(!t||!t.current)return;super.readKeyframes();for(let u=0;u<e.length;u++){let h=e[u];if(typeof h=="string"&&(h=h.trim(),Jx(h))){const p=eE(h,t.current);p!==void 0&&(e[u]=p),u===e.length-1&&(this.finalKeyframe=h)}}if(this.resolveNoneKeyframes(),!tE.has(s)||e.length!==2)return;const[i,n]=e,a=ik(i),o=ik(n),l=Uw(i),d=Uw(n);if(l!==d&&Qn[s]){this.needsMeasurement=!0;return}if(a!==o)if(Jw(a)&&Jw(o))for(let u=0;u<e.length;u++){const h=e[u];typeof h=="string"&&(e[u]=parseFloat(h))}else Qn[s]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,s=[];for(let i=0;i<e.length;i++)(e[i]===null||D6(e[i]))&&s.push(i);s.length&&V6(e,s,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:s}=this;if(!e||!e.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Qn[s](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const i=t[t.length-1];i!==void 0&&e.getValue(s,i).jump(i,!1)}measureEndState(){const{element:e,name:t,unresolvedKeyframes:s}=this;if(!e||!e.current)return;const i=e.getValue(t);i&&i.jump(this.measuredOrigin,!1);const n=s.length-1,a=s[n];s[n]=Qn[t](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,l])=>{e.getValue(o).set(l)}),this.resolveNoneKeyframes()}}function G6(r,e,t){if(r==null)return[];if(r instanceof EventTarget)return[r];if(typeof r=="string"){let s=document;const i=t?.[r]??s.querySelectorAll(r);return i?Array.from(i):[]}return Array.from(r).filter(s=>s!=null)}const lE=(r,e)=>e&&typeof r=="number"?e.transform(r):r;function Y0(r){return w_(r)&&"offsetHeight"in r}const{schedule:hb}=I_(queueMicrotask,!1),xr={x:!1,y:!1};function dE(){return xr.x||xr.y}function W6(r){return r==="x"||r==="y"?xr[r]?null:(xr[r]=!0,()=>{xr[r]=!1}):xr.x||xr.y?null:(xr.x=xr.y=!0,()=>{xr.x=xr.y=!1})}function uE(r,e){const t=G6(r),s=new AbortController,i={passive:!0,...e,signal:s.signal};return[t,i,()=>s.abort()]}function nk(r){return!(r.pointerType==="touch"||dE())}function Y6(r,e,t={}){const[s,i,n]=uE(r,t),a=o=>{if(!nk(o))return;const{target:l}=o,d=e(l,o);if(typeof d!="function"||!l)return;const u=h=>{nk(h)&&(d(h),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,i)};return s.forEach(o=>{o.addEventListener("pointerenter",a,i)}),n}const hE=(r,e)=>e?r===e?!0:hE(r,e.parentElement):!1,pb=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,q6=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function pE(r){return q6.has(r.tagName)||r.isContentEditable===!0}const Ih=new WeakSet;function ak(r){return e=>{e.key==="Enter"&&r(e)}}function lm(r,e){r.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const H6=(r,e)=>{const t=r.currentTarget;if(!t)return;const s=ak(()=>{if(Ih.has(t))return;lm(t,"down");const i=ak(()=>{lm(t,"up")}),n=()=>lm(t,"cancel");t.addEventListener("keyup",i,e),t.addEventListener("blur",n,e)});t.addEventListener("keydown",s,e),t.addEventListener("blur",()=>t.removeEventListener("keydown",s),e)};function ok(r){return pb(r)&&!dE()}function X6(r,e,t={}){const[s,i,n]=uE(r,t),a=o=>{const l=o.currentTarget;if(!ok(o))return;Ih.add(l);const d=e(l,o),u=(f,m)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",p),Ih.has(l)&&Ih.delete(l),ok(f)&&typeof d=="function"&&d(f,{success:m})},h=f=>{u(f,l===window||l===document||t.useGlobalTarget||hE(l,f.target))},p=f=>{u(f,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",p,i)};return s.forEach(o=>{(t.useGlobalTarget?window:o).addEventListener("pointerdown",a,i),Y0(o)&&(o.addEventListener("focus",d=>H6(d,i)),!pE(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),n}function fE(r){return w_(r)&&"ownerSVGElement"in r}function K6(r){return fE(r)&&r.tagName==="svg"}const Q6=[...aE,ms,ga],J6=r=>Q6.find(nE(r)),ck=()=>({translate:0,scale:1,origin:0,originPoint:0}),hc=()=>({x:ck(),y:ck()}),lk=()=>({min:0,max:0}),ws=()=>({x:lk(),y:lk()}),q0={current:null},mE={current:!1},Z6=typeof window<"u";function e8(){if(mE.current=!0,!!Z6)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),e=()=>q0.current=r.matches;r.addEventListener("change",e),e()}else q0.current=!1}const t8=new WeakMap;function rf(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function qd(r){return typeof r=="string"||Array.isArray(r)}const fb=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],mb=["initial",...fb];function nf(r){return rf(r.animate)||mb.some(e=>qd(r[e]))}function gE(r){return!!(nf(r)||r.variants)}function s8(r,e,t){for(const s in e){const i=e[s],n=t[s];if(Qs(i))r.addValue(s,i);else if(Qs(n))r.addValue(s,Gc(i,{owner:r}));else if(n!==i)if(r.hasValue(s)){const a=r.getValue(s);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=r.getStaticValue(s);r.addValue(s,Gc(a!==void 0?a:i,{owner:r}))}}for(const s in t)e[s]===void 0&&r.removeValue(s);return e}const dk=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let bp={};function yE(r){bp=r}function i8(){return bp}class r8{scrapeMotionValuesFromProps(e,t,s){return{}}constructor({parent:e,props:t,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:n,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=ab,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=li.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Rt.render(this.render,!1,!0))};const{latestValues:l,renderState:d}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=d,this.parent=e,this.props=t,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=o,this.blockInitialAnimation=!!n,this.isControllingVariants=nf(t),this.isVariantNode=gE(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(t,{},this);for(const p in h){const f=h[p];l[p]!==void 0&&Qs(f)&&f.set(l[p])}}mount(e){this.current=e,t8.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,s)=>this.bindToMotionValue(s,t)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(mE.current||e8(),this.shouldReduceMotion=q0.current),this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),ma(this.notifyUpdate),ma(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const s=cl.has(e);s&&this.onBindTransform&&this.onBindTransform();const i=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Rt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let n;typeof window<"u"&&window.MotionCheckAppearSync&&(n=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{i(),n&&n(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in bp){const t=bp[e];if(!t)continue;const{isEnabled:s,Feature:i}=t;if(!this.features[e]&&i&&s(this.props)&&(this.features[e]=new i(this)),this.features[e]){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ws()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let s=0;s<dk.length;s++){const i=dk[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const n="on"+i,a=e[n];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=s8(this,this.scrapeMotionValuesFromProps(e,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const s=this.values.get(e);t!==s&&(s&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&t!==void 0&&(s=Gc(t===null?void 0:t,{owner:this}),this.addValue(e,s)),s}readValue(e,t){let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(v_(s)||k_(s))?s=parseFloat(s):!J6(s)&&ga.test(t)&&(s=cE(e,t)),this.setBaseTarget(e,Qs(s)?s.get():s)),Qs(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){const{initial:t}=this.props;let s;if(typeof t=="string"||typeof t=="object"){const n=lb(this.props,t,this.presenceContext?.custom);n&&(s=n[e])}if(t&&s!==void 0)return s;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!Qs(i)?i:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new Xx),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}scheduleRenderMicrotask(){hb.render(this.render)}}class xE extends r8{constructor(){super(...arguments),this.KeyframeResolver=U6}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){const s=e.style;return s?s[t]:void 0}removeValueFromRenderState(e,{vars:t,style:s}){delete t[e],delete s[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Qs(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}class Sa{constructor(e){this.isMounted=!1,this.node=e}update(){}}function bE({top:r,left:e,right:t,bottom:s}){return{x:{min:e,max:t},y:{min:r,max:s}}}function n8({x:r,y:e}){return{top:e.min,right:r.max,bottom:e.max,left:r.min}}function a8(r,e){if(!e)return r;const t=e({x:r.left,y:r.top}),s=e({x:r.right,y:r.bottom});return{top:t.y,left:t.x,bottom:s.y,right:s.x}}function dm(r){return r===void 0||r===1}function H0({scale:r,scaleX:e,scaleY:t}){return!dm(r)||!dm(e)||!dm(t)}function Za(r){return H0(r)||vE(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function vE(r){return uk(r.x)||uk(r.y)}function uk(r){return r&&r!=="0%"}function vp(r,e,t){const s=r-t,i=e*s;return t+i}function hk(r,e,t,s,i){return i!==void 0&&(r=vp(r,i,s)),vp(r,t,s)+e}function X0(r,e=0,t=1,s,i){r.min=hk(r.min,e,t,s,i),r.max=hk(r.max,e,t,s,i)}function wE(r,{x:e,y:t}){X0(r.x,e.translate,e.scale,e.originPoint),X0(r.y,t.translate,t.scale,t.originPoint)}const pk=.999999999999,fk=1.0000000000001;function o8(r,e,t,s=!1){const i=t.length;if(!i)return;e.x=e.y=1;let n,a;for(let o=0;o<i;o++){n=t[o],a=n.projectionDelta;const{visualElement:l}=n.options;l&&l.props.style&&l.props.style.display==="contents"||(s&&n.options.layoutScroll&&n.scroll&&n!==n.root&&fc(r,{x:-n.scroll.offset.x,y:-n.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,wE(r,a)),s&&Za(n.latestValues)&&fc(r,n.latestValues))}e.x<fk&&e.x>pk&&(e.x=1),e.y<fk&&e.y>pk&&(e.y=1)}function pc(r,e){r.min=r.min+e,r.max=r.max+e}function mk(r,e,t,s,i=.5){const n=Kt(r.min,r.max,i);X0(r,e,t,n,s)}function fc(r,e){mk(r.x,e.x,e.scaleX,e.scale,e.originX),mk(r.y,e.y,e.scaleY,e.scale,e.originY)}function kE(r,e){return bE(a8(r.getBoundingClientRect(),e))}function c8(r,e,t){const s=kE(r,t),{scroll:i}=e;return i&&(pc(s.x,i.offset.x),pc(s.y,i.offset.y)),s}const l8={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},d8=ol.length;function u8(r,e,t){let s="",i=!0;for(let n=0;n<d8;n++){const a=ol[n],o=r[a];if(o===void 0)continue;let l=!0;if(typeof o=="number")l=o===(a.startsWith("scale")?1:0);else{const d=parseFloat(o);l=a.startsWith("scale")?d===1:d===0}if(!l||t){const d=lE(o,ub[a]);if(!l){i=!1;const u=l8[a]||a;s+=`${u}(${d}) `}t&&(e[a]=d)}}return s=s.trim(),t?s=t(e,i?"":s):i&&(s="none"),s}function gb(r,e,t){const{style:s,vars:i,transformOrigin:n}=r;let a=!1,o=!1;for(const l in e){const d=e[l];if(cl.has(l)){a=!0;continue}else if(F_(l)){i[l]=d;continue}else{const u=lE(d,ub[l]);l.startsWith("origin")?(o=!0,n[l]=u):s[l]=u}}if(e.transform||(a||t?s.transform=u8(e,r.transform,t):s.transform&&(s.transform="none")),o){const{originX:l="50%",originY:d="50%",originZ:u=0}=n;s.transformOrigin=`${l} ${d} ${u}`}}function CE(r,{style:e,vars:t},s,i){const n=r.style;let a;for(a in e)n[a]=e[a];i?.applyProjectionStyles(n,s);for(a in t)n.setProperty(a,t[a])}function gk(r,e){return e.max===e.min?0:r/(e.max-e.min)*100}const Il={correct:(r,e)=>{if(!e.target)return r;if(typeof r=="string")if(Le.test(r))r=parseFloat(r);else return r;const t=gk(r,e.target.x),s=gk(r,e.target.y);return`${t}% ${s}%`}},h8={correct:(r,{treeScale:e,projectionDelta:t})=>{const s=r,i=ga.parse(r);if(i.length>5)return s;const n=ga.createTransformer(r),a=typeof i[0]!="number"?1:0,o=t.x.scale*e.x,l=t.y.scale*e.y;i[0+a]/=o,i[1+a]/=l;const d=Kt(o,l,.5);return typeof i[2+a]=="number"&&(i[2+a]/=d),typeof i[3+a]=="number"&&(i[3+a]/=d),n(i)}},K0={borderRadius:{...Il,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Il,borderTopRightRadius:Il,borderBottomLeftRadius:Il,borderBottomRightRadius:Il,boxShadow:h8};function SE(r,{layout:e,layoutId:t}){return cl.has(r)||r.startsWith("origin")||(e||t!==void 0)&&(!!K0[r]||r==="opacity")}function yb(r,e,t){const s=r.style,i=e?.style,n={};if(!s)return n;for(const a in s)(Qs(s[a])||i&&Qs(i[a])||SE(a,r)||t?.getValue(a)?.liveStyle!==void 0)&&(n[a]=s[a]);return n}function p8(r){return window.getComputedStyle(r)}class f8 extends xE{constructor(){super(...arguments),this.type="html",this.renderInstance=CE}readValueFromInstance(e,t){if(cl.has(t))return this.projection?.isProjecting?F0(t):GV(e,t);{const s=p8(e),i=(F_(t)?s.getPropertyValue(t):s[t])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(e,{transformPagePoint:t}){return kE(e,t)}build(e,t,s){gb(e,t,s.transformTemplate)}scrapeMotionValuesFromProps(e,t,s){return yb(e,t,s)}}const m8={offset:"stroke-dashoffset",array:"stroke-dasharray"},g8={offset:"strokeDashoffset",array:"strokeDasharray"};function y8(r,e,t=1,s=0,i=!0){r.pathLength=1;const n=i?m8:g8;r[n.offset]=`${-s}`,r[n.array]=`${e} ${t}`}const x8=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function TE(r,{attrX:e,attrY:t,attrScale:s,pathLength:i,pathSpacing:n=1,pathOffset:a=0,...o},l,d,u){if(gb(r,o,d),l){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:h,style:p}=r;h.transform&&(p.transform=h.transform,delete h.transform),(p.transform||h.transformOrigin)&&(p.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),p.transform&&(p.transformBox=u?.transformBox??"fill-box",delete h.transformBox);for(const f of x8)h[f]!==void 0&&(p[f]=h[f],delete h[f]);e!==void 0&&(h.x=e),t!==void 0&&(h.y=t),s!==void 0&&(h.scale=s),i!==void 0&&y8(h,i,n,a,!1)}const AE=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),jE=r=>typeof r=="string"&&r.toLowerCase()==="svg";function b8(r,e,t,s){CE(r,e,void 0,s);for(const i in e.attrs)r.setAttribute(AE.has(i)?i:db(i),e.attrs[i])}function _E(r,e,t){const s=yb(r,e,t);for(const i in r)if(Qs(r[i])||Qs(e[i])){const n=ol.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[n]=r[i]}return s}class v8 extends xE{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ws}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(cl.has(t)){const s=oE(t);return s&&s.default||0}return t=AE.has(t)?t:db(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,s){return _E(e,t,s)}build(e,t,s){TE(e,t,this.isSVGTag,s.transformTemplate,s.style)}renderInstance(e,t,s,i){b8(e,t,s,i)}mount(e){this.isSVGTag=jE(e.tagName),super.mount(e)}}const w8=mb.length;function EE(r){if(!r)return;if(!r.isControllingVariants){const t=r.parent?EE(r.parent)||{}:{};return r.props.initial!==void 0&&(t.initial=r.props.initial),t}const e={};for(let t=0;t<w8;t++){const s=mb[t],i=r.props[s];(qd(i)||i===!1)&&(e[s]=i)}return e}function ME(r,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==r.length)return!1;for(let s=0;s<t;s++)if(e[s]!==r[s])return!1;return!0}const k8=[...fb].reverse(),C8=fb.length;function S8(r){return e=>Promise.all(e.map(({animation:t,options:s})=>R6(r,t,s)))}function T8(r){let e=S8(r),t=yk(),s=!0;const i=l=>(d,u)=>{const h=Tc(r,u,l==="exit"?r.presenceContext?.custom:void 0);if(h){const{transition:p,transitionEnd:f,...m}=h;d={...d,...m,...f}}return d};function n(l){e=l(r)}function a(l){const{props:d}=r,u=EE(r.parent)||{},h=[],p=new Set;let f={},m=1/0;for(let y=0;y<C8;y++){const x=k8[y],b=t[x],w=d[x]!==void 0?d[x]:u[x],C=qd(w),k=x===l?b.isActive:null;k===!1&&(m=y);let S=w===u[x]&&w!==d[x]&&C;if(S&&s&&r.manuallyAnimateOnMount&&(S=!1),b.protectedKeys={...f},!b.isActive&&k===null||!w&&!b.prevProp||rf(w)||typeof w=="boolean")continue;const A=A8(b.prevProp,w);let T=A||x===l&&b.isActive&&!S&&C||y>m&&C,j=!1;const _=Array.isArray(w)?w:[w];let M=_.reduce(i(x),{});k===!1&&(M={});const{prevResolvedValues:P={}}=b,R={...P,...M},D=F=>{T=!0,p.has(F)&&(j=!0,p.delete(F)),b.needsAnimating[F]=!0;const I=r.getValue(F);I&&(I.liveStyle=!1)};for(const F in R){const I=M[F],J=P[F];if(f.hasOwnProperty(F))continue;let Z=!1;V0(I)&&V0(J)?Z=!ME(I,J):Z=I!==J,Z?I!=null?D(F):p.add(F):I!==void 0&&p.has(F)?D(F):b.protectedKeys[F]=!0}b.prevProp=w,b.prevResolvedValues=M,b.isActive&&(f={...f,...M}),s&&r.blockInitialAnimation&&(T=!1);const B=S&&A;T&&(!B||j)&&h.push(..._.map(F=>{const I={type:x};if(typeof F=="string"&&s&&!B&&r.manuallyAnimateOnMount&&r.parent){const{parent:J}=r,Z=Tc(J,F);if(J.enteringChildren&&Z){const{delayChildren:E}=Z.transition||{};I.delay=Z_(J.enteringChildren,r,E)}}return{animation:F,options:I}}))}if(p.size){const y={};if(typeof d.initial!="boolean"){const x=Tc(r,Array.isArray(d.initial)?d.initial[0]:d.initial);x&&x.transition&&(y.transition=x.transition)}p.forEach(x=>{const b=r.getBaseTarget(x),w=r.getValue(x);w&&(w.liveStyle=!0),y[x]=b??null}),h.push({animation:y})}let g=!!h.length;return s&&(d.initial===!1||d.initial===d.animate)&&!r.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(h):Promise.resolve()}function o(l,d){if(t[l].isActive===d)return Promise.resolve();r.variantChildren?.forEach(h=>h.animationState?.setActive(l,d)),t[l].isActive=d;const u=a(l);for(const h in t)t[h].protectedKeys={};return u}return{animateChanges:a,setActive:o,setAnimateFunction:n,getState:()=>t,reset:()=>{t=yk()}}}function A8(r,e){return typeof e=="string"?e!==r:Array.isArray(e)?!ME(e,r):!1}function Oa(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function yk(){return{animate:Oa(!0),whileInView:Oa(),whileHover:Oa(),whileTap:Oa(),whileDrag:Oa(),whileFocus:Oa(),exit:Oa()}}function xk(r,e){r.min=e.min,r.max=e.max}function pr(r,e){xk(r.x,e.x),xk(r.y,e.y)}function bk(r,e){r.translate=e.translate,r.scale=e.scale,r.originPoint=e.originPoint,r.origin=e.origin}const PE=1e-4,j8=1-PE,_8=1+PE,NE=.01,E8=0-NE,M8=0+NE;function di(r){return r.max-r.min}function P8(r,e,t){return Math.abs(r-e)<=t}function vk(r,e,t,s=.5){r.origin=s,r.originPoint=Kt(e.min,e.max,r.origin),r.scale=di(t)/di(e),r.translate=Kt(t.min,t.max,r.origin)-r.originPoint,(r.scale>=j8&&r.scale<=_8||isNaN(r.scale))&&(r.scale=1),(r.translate>=E8&&r.translate<=M8||isNaN(r.translate))&&(r.translate=0)}function kd(r,e,t,s){vk(r.x,e.x,t.x,s?s.originX:void 0),vk(r.y,e.y,t.y,s?s.originY:void 0)}function wk(r,e,t){r.min=t.min+e.min,r.max=r.min+di(e)}function N8(r,e,t){wk(r.x,e.x,t.x),wk(r.y,e.y,t.y)}function kk(r,e,t){r.min=e.min-t.min,r.max=r.min+di(e)}function wp(r,e,t){kk(r.x,e.x,t.x),kk(r.y,e.y,t.y)}function Ck(r,e,t,s,i){return r-=e,r=vp(r,1/t,s),i!==void 0&&(r=vp(r,1/i,s)),r}function R8(r,e=0,t=1,s=.5,i,n=r,a=r){if(zr.test(e)&&(e=parseFloat(e),e=Kt(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=Kt(n.min,n.max,s);r===n&&(o-=e),r.min=Ck(r.min,e,t,o,i),r.max=Ck(r.max,e,t,o,i)}function Sk(r,e,[t,s,i],n,a){R8(r,e[t],e[s],e[i],e.scale,n,a)}const I8=["x","scaleX","originX"],D8=["y","scaleY","originY"];function Tk(r,e,t,s){Sk(r.x,e,I8,t?t.x:void 0,s?s.x:void 0),Sk(r.y,e,D8,t?t.y:void 0,s?s.y:void 0)}function Ak(r){return r.translate===0&&r.scale===1}function RE(r){return Ak(r.x)&&Ak(r.y)}function jk(r,e){return r.min===e.min&&r.max===e.max}function F8(r,e){return jk(r.x,e.x)&&jk(r.y,e.y)}function _k(r,e){return Math.round(r.min)===Math.round(e.min)&&Math.round(r.max)===Math.round(e.max)}function IE(r,e){return _k(r.x,e.x)&&_k(r.y,e.y)}function Ek(r){return di(r.x)/di(r.y)}function Mk(r,e){return r.translate===e.translate&&r.scale===e.scale&&r.originPoint===e.originPoint}function Xi(r){return[r("x"),r("y")]}function B8(r,e,t){let s="";const i=r.x.translate/e.x,n=r.y.translate/e.y,a=t?.z||0;if((i||n||a)&&(s=`translate3d(${i}px, ${n}px, ${a}px) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:d,rotate:u,rotateX:h,rotateY:p,skewX:f,skewY:m}=t;d&&(s=`perspective(${d}px) ${s}`),u&&(s+=`rotate(${u}deg) `),h&&(s+=`rotateX(${h}deg) `),p&&(s+=`rotateY(${p}deg) `),f&&(s+=`skewX(${f}deg) `),m&&(s+=`skewY(${m}deg) `)}const o=r.x.scale*e.x,l=r.y.scale*e.y;return(o!==1||l!==1)&&(s+=`scale(${o}, ${l})`),s||"none"}const DE=["TopLeft","TopRight","BottomLeft","BottomRight"],L8=DE.length,Pk=r=>typeof r=="string"?parseFloat(r):r,Nk=r=>typeof r=="number"||Le.test(r);function O8(r,e,t,s,i,n){i?(r.opacity=Kt(0,t.opacity??1,$8(s)),r.opacityExit=Kt(e.opacity??1,0,z8(s))):n&&(r.opacity=Kt(e.opacity??1,t.opacity??1,s));for(let a=0;a<L8;a++){const o=`border${DE[a]}Radius`;let l=Rk(e,o),d=Rk(t,o);if(l===void 0&&d===void 0)continue;l||(l=0),d||(d=0),l===0||d===0||Nk(l)===Nk(d)?(r[o]=Math.max(Kt(Pk(l),Pk(d),s),0),(zr.test(d)||zr.test(l))&&(r[o]+="%")):r[o]=d}(e.rotate||t.rotate)&&(r.rotate=Kt(e.rotate||0,t.rotate||0,s))}function Rk(r,e){return r[e]!==void 0?r[e]:r.borderRadius}const $8=FE(0,.5,M_),z8=FE(.5,.95,lr);function FE(r,e,t){return s=>s<r?0:s>e?1:t(Gd(r,e,s))}function V8(r,e,t){const s=Qs(r)?r:Gc(r);return s.start(cb("",s,e,t)),s.animation}function Hd(r,e,t,s={passive:!0}){return r.addEventListener(e,t,s),()=>r.removeEventListener(e,t)}const U8=(r,e)=>r.depth-e.depth;class G8{constructor(){this.children=[],this.isDirty=!1}add(e){Wx(this.children,e),this.isDirty=!0}remove(e){Yx(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(U8),this.isDirty=!1,this.children.forEach(e)}}function W8(r,e){const t=li.now(),s=({timestamp:i})=>{const n=i-t;n>=e&&(ma(s),r(n-e))};return Rt.setup(s,!0),()=>ma(s)}function Dh(r){return Qs(r)?r.get():r}class Y8{constructor(){this.members=[]}add(e){Wx(this.members,e),e.scheduleRender()}remove(e){if(Yx(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(i=>e===i);if(t===0)return!1;let s;for(let i=t;i>=0;i--){const n=this.members[i];if(n.isPresent!==!1){s=n;break}}return s?(this.promote(s),!0):!1}promote(e,t){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender();const i=s.options.layoutDependency,n=e.options.layoutDependency;i!==void 0&&n!==void 0&&i===n||(e.resumeFrom=s,t&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0));const{crossfade:o}=e.options;o===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:s}=e;t.onExitComplete&&t.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const Fh={hasAnimatedSinceResize:!0,hasEverUpdated:!1},um=["","X","Y","Z"],q8=1e3;let H8=0;function hm(r,e,t,s){const{latestValues:i}=e;i[r]&&(t[r]=i[r],e.setStaticValue(r,0),s&&(s[r]=0))}function BE(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:e}=r.options;if(!e)return;const t=iE(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:i,layoutId:n}=r.options;window.MotionCancelOptimisedAnimation(t,"transform",Rt,!(i||n))}const{parent:s}=r;s&&!s.hasCheckedOptimisedAppear&&BE(s)}function LE({attachResizeListener:r,defaultParent:e,measureScroll:t,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(a={},o=e?.()){this.id=H8++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Q8),this.nodes.forEach(tU),this.nodes.forEach(sU),this.nodes.forEach(J8)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new G8)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Xx),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=fE(a)&&!K6(a),this.instance=a;const{layoutId:o,layout:l,visualElement:d}=this.options;if(d&&!d.current&&d.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||o)&&(this.isLayoutDirty=!0),r){let u,h=0;const p=()=>this.root.updateBlockedByResize=!1;Rt.read(()=>{h=window.innerWidth}),r(a,()=>{const f=window.innerWidth;f!==h&&(h=f,this.root.updateBlockedByResize=!0,u&&u(),u=W8(p,250),Fh.hasAnimatedSinceResize&&(Fh.hasAnimatedSinceResize=!1,this.nodes.forEach(Fk)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&d&&(o||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:p,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||d.getDefaultTransition()||oU,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=d.getProps(),x=!this.targetLayout||!IE(this.targetLayout,f),b=!h&&p;if(this.options.layoutRoot||this.resumeFrom||b||h&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...ob(m,"layout"),onPlay:g,onComplete:y};(d.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(u,b)}else h||Fk(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ma(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(iU),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&BE(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Ik);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Dk);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(eU),this.nodes.forEach(X8),this.nodes.forEach(K8)):this.nodes.forEach(Dk),this.clearAllSnapshots();const o=li.now();Fs.delta=Wr(0,1e3/60,o-Fs.timestamp),Fs.timestamp=o,Fs.isProcessing=!0,im.update.process(Fs),im.preRender.process(Fs),im.render.process(Fs),Fs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,hb.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Z8),this.sharedNodes.forEach(rU)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Rt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Rt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!di(this.snapshot.measuredBox.x)&&!di(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ws(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&this.instance){const l=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!RE(this.projectionDelta),l=this.getTransformTemplate(),d=l?l(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&this.instance&&(o||Za(this.latestValues)||u)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),cU(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return ws();const o=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(lU))){const{scroll:d}=this.root;d&&(pc(o.x,d.offset.x),pc(o.y,d.offset.y))}return o}removeElementScroll(a){const o=ws();if(pr(o,a),this.scroll?.wasRoot)return o;for(let l=0;l<this.path.length;l++){const d=this.path[l],{scroll:u,options:h}=d;d!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&pr(o,a),pc(o.x,u.offset.x),pc(o.y,u.offset.y))}return o}applyTransform(a,o=!1){const l=ws();pr(l,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&fc(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Za(u.latestValues)&&fc(l,u.latestValues)}return Za(this.latestValues)&&fc(l,this.latestValues),l}removeTransform(a){const o=ws();pr(o,a);for(let l=0;l<this.path.length;l++){const d=this.path[l];if(!d.instance||!Za(d.latestValues))continue;H0(d.latestValues)&&d.updateSnapshot();const u=ws(),h=d.measurePageBox();pr(u,h),Tk(o,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return Za(this.latestValues)&&Tk(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Fs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==o;if(!(a||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!this.layout||!(u||h))return;this.resolvedRelativeTargetAt=Fs.timestamp;const p=this.getClosestProjectingParent();p&&this.linkedParentVersion!==p.layoutVersion&&!p.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(p&&p.layout?this.createRelativeTarget(p,this.layout.layoutBox,p.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ws(),this.targetWithTransforms=ws()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),N8(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):pr(this.target,this.layout.layoutBox),wE(this.target,this.targetDelta)):pr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,p&&!!p.resumingFrom==!!this.resumingFrom&&!p.options.layoutScroll&&p.target&&this.animationProgress!==1?this.createRelativeTarget(p,this.target,p.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||H0(this.parent.latestValues)||vE(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,o,l){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ws(),this.relativeTargetOrigin=ws(),wp(this.relativeTargetOrigin,o,l),pr(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){const a=this.getLead(),o=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Fs.timestamp&&(l=!1),l)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;pr(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,p=this.treeScale.y;o8(this.layoutCorrected,this.treeScale,this.path,o),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=ws());const{target:f}=a;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(bk(this.prevProjectionDelta.x,this.projectionDelta.x),bk(this.prevProjectionDelta.y,this.projectionDelta.y)),kd(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==p||!Mk(this.projectionDelta.x,this.prevProjectionDelta.x)||!Mk(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=hc(),this.projectionDelta=hc(),this.projectionDeltaWithTransform=hc()}setAnimationOrigin(a,o=!1){const l=this.snapshot,d=l?l.latestValues:{},u={...this.latestValues},h=hc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const p=ws(),f=l?l.source:void 0,m=this.layout?this.layout.source:void 0,g=f!==m,y=this.getStack(),x=!y||y.members.length<=1,b=!!(g&&!x&&this.options.crossfade===!0&&!this.path.some(aU));this.animationProgress=0;let w;this.mixTargetDelta=C=>{const k=C/1e3;Bk(h.x,a.x,k),Bk(h.y,a.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(wp(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),nU(this.relativeTarget,this.relativeTargetOrigin,p,k),w&&F8(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=ws()),pr(w,this.relativeTarget)),g&&(this.animationValues=u,O8(u,d,this.latestValues,k,b,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(ma(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Rt.update(()=>{Fh.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Gc(0)),this.currentAnimation=V8(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(q8),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:d,latestValues:u}=a;if(!(!o||!l||!d)){if(this!==a&&this.layout&&d&&OE(this.options.animationType,this.layout.layoutBox,d.layoutBox)){l=this.target||ws();const h=di(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const p=di(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+p}pr(o,l),fc(o,u),kd(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new Y8),this.sharedNodes.get(a).add(o);const d=o.options.initialPromotionConfig;o.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const d=this.getStack();d&&d.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const d={};l.z&&hm("z",a,d,this.animationValues);for(let u=0;u<um.length;u++)hm(`rotate${um[u]}`,a,d,this.animationValues),hm(`skew${um[u]}`,a,d,this.animationValues);a.render();for(const u in d)a.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);a.scheduleRender()}applyProjectionStyles(a,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=Dh(o?.pointerEvents)||"",a.transform=l?l(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=Dh(o?.pointerEvents)||""),this.hasProjected&&!Za(this.latestValues)&&(a.transform=l?l({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let h=B8(this.projectionDeltaWithTransform,this.treeScale,u);l&&(h=l(u,h)),a.transform=h;const{x:p,y:f}=this.projectionDelta;a.transformOrigin=`${p.origin*100}% ${f.origin*100}% 0`,d.animationValues?a.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const m in K0){if(u[m]===void 0)continue;const{correct:g,applyTo:y,isCSSVariable:x}=K0[m],b=h==="none"?u[m]:g(u[m],d);if(y){const w=y.length;for(let C=0;C<w;C++)a[y[C]]=b}else x?this.options.visualElement.renderState.vars[m]=b:a[m]=b}this.options.layoutId&&(a.pointerEvents=d===this?Dh(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(Ik),this.root.sharedNodes.clear()}}}function X8(r){r.updateLayout()}function K8(r){const e=r.resumeFrom?.snapshot||r.snapshot;if(r.isLead()&&r.layout&&e&&r.hasListeners("didUpdate")){const{layoutBox:t,measuredBox:s}=r.layout,{animationType:i}=r.options,n=e.source!==r.layout.source;i==="size"?Xi(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=di(h);h.min=t[u].min,h.max=h.min+p}):OE(i,e.layoutBox,t)&&Xi(u=>{const h=n?e.measuredBox[u]:e.layoutBox[u],p=di(t[u]);h.max=h.min+p,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[u].max=r.relativeTarget[u].min+p)});const a=hc();kd(a,t,e.layoutBox);const o=hc();n?kd(o,r.applyTransform(s,!0),e.measuredBox):kd(o,t,e.layoutBox);const l=!RE(a);let d=!1;if(!r.resumeFrom){const u=r.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:p}=u;if(h&&p){const f=ws();wp(f,e.layoutBox,h.layoutBox);const m=ws();wp(m,t,p.layoutBox),IE(f,m)||(d=!0),u.options.layoutRoot&&(r.relativeTarget=m,r.relativeTargetOrigin=f,r.relativeParent=u)}}}r.notifyListeners("didUpdate",{layout:t,snapshot:e,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:d})}else if(r.isLead()){const{onExitComplete:t}=r.options;t&&t()}r.options.transition=void 0}function Q8(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function J8(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function Z8(r){r.clearSnapshot()}function Ik(r){r.clearMeasurements()}function Dk(r){r.isLayoutDirty=!1}function eU(r){const{visualElement:e}=r.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),r.resetTransform()}function Fk(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function tU(r){r.resolveTargetDelta()}function sU(r){r.calcProjection()}function iU(r){r.resetSkewAndRotation()}function rU(r){r.removeLeadSnapshot()}function Bk(r,e,t){r.translate=Kt(e.translate,0,t),r.scale=Kt(e.scale,1,t),r.origin=e.origin,r.originPoint=e.originPoint}function Lk(r,e,t,s){r.min=Kt(e.min,t.min,s),r.max=Kt(e.max,t.max,s)}function nU(r,e,t,s){Lk(r.x,e.x,t.x,s),Lk(r.y,e.y,t.y,s)}function aU(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const oU={duration:.45,ease:[.4,0,.1,1]},Ok=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),$k=Ok("applewebkit/")&&!Ok("chrome/")?Math.round:lr;function zk(r){r.min=$k(r.min),r.max=$k(r.max)}function cU(r){zk(r.x),zk(r.y)}function OE(r,e,t){return r==="position"||r==="preserve-aspect"&&!P8(Ek(e),Ek(t),.2)}function lU(r){return r!==r.root&&r.scroll?.wasRoot}const dU=LE({attachResizeListener:(r,e)=>Hd(r,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body?.scrollLeft||0,y:document.documentElement.scrollTop||document.body?.scrollTop||0}),checkIsScrollRoot:()=>!0}),uU=r=>!r.isLayoutDirty&&r.willUpdate(!1);function Vk(){const r=new Set,e=new WeakMap,t=()=>r.forEach(uU);return{add:s=>{r.add(s),e.set(s,s.addEventListener("willUpdate",t))},remove:s=>{r.delete(s);const i=e.get(s);i&&(i(),e.delete(s)),t()},dirty:t}}const pm={current:void 0},$E=LE({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!pm.current){const r=new dU({});r.mount(window),r.setOptions({layoutScroll:!0}),pm.current=r}return pm.current},resetTransform:(r,e)=>{r.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),xb=v.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function Uk(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function hU(...r){return e=>{let t=!1;const s=r.map(i=>{const n=Uk(i,e);return!t&&typeof n=="function"&&(t=!0),n});if(t)return()=>{for(let i=0;i<s.length;i++){const n=s[i];typeof n=="function"?n():Uk(r[i],null)}}}}function pU(...r){return v.useCallback(hU(...r),r)}class fU extends v.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const s=t.offsetParent,i=Y0(s)&&s.offsetWidth||0,n=Y0(s)&&s.offsetHeight||0,a=this.props.sizeRef.current;a.height=t.offsetHeight||0,a.width=t.offsetWidth||0,a.top=t.offsetTop,a.left=t.offsetLeft,a.right=i-a.width-a.left,a.bottom=n-a.height-a.top}return null}componentDidUpdate(){}render(){return this.props.children}}function mU({children:r,isPresent:e,anchorX:t,anchorY:s,root:i}){const n=v.useId(),a=v.useRef(null),o=v.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:l}=v.useContext(xb),d=r.props?.ref??r?.ref,u=pU(a,d);return v.useInsertionEffect(()=>{const{width:h,height:p,top:f,left:m,right:g,bottom:y}=o.current;if(e||!a.current||!h||!p)return;const x=t==="left"?`left: ${m}`:`right: ${g}`,b=s==="bottom"?`bottom: ${y}`:`top: ${f}`;a.current.dataset.motionPopId=n;const w=document.createElement("style");l&&(w.nonce=l);const C=i??document.head;return C.appendChild(w),w.sheet&&w.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${h}px !important;
            height: ${p}px !important;
            ${x}px !important;
            ${b}px !important;
          }
        `),()=>{C.contains(w)&&C.removeChild(w)}},[e]),c.jsx(fU,{isPresent:e,childRef:a,sizeRef:o,children:v.cloneElement(r,{ref:u})})}const gU=({children:r,initial:e,isPresent:t,onExitComplete:s,custom:i,presenceAffectsLayout:n,mode:a,anchorX:o,anchorY:l,root:d})=>{const u=Ux(yU),h=v.useId();let p=!0,f=v.useMemo(()=>(p=!1,{id:h,initial:e,isPresent:t,custom:i,onExitComplete:m=>{u.set(m,!0);for(const g of u.values())if(!g)return;s&&s()},register:m=>(u.set(m,!1),()=>u.delete(m))}),[t,u,s]);return n&&p&&(f={...f}),v.useMemo(()=>{u.forEach((m,g)=>u.set(g,!1))},[t]),v.useEffect(()=>{!t&&!u.size&&s&&s()},[t]),a==="popLayout"&&(r=c.jsx(mU,{isPresent:t,anchorX:o,anchorY:l,root:d,children:r})),c.jsx(sf.Provider,{value:f,children:r})};function yU(){return new Map}function zE(r=!0){const e=v.useContext(sf);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:s,register:i}=e,n=v.useId();v.useEffect(()=>{if(r)return i(n)},[r]);const a=v.useCallback(()=>r&&s&&s(n),[n,s,r]);return!t&&s?[!1,a]:[!0]}const qu=r=>r.key||"";function Gk(r){const e=[];return v.Children.forEach(r,t=>{v.isValidElement(t)&&e.push(t)}),e}const VE=({children:r,custom:e,initial:t=!0,onExitComplete:s,presenceAffectsLayout:i=!0,mode:n="sync",propagate:a=!1,anchorX:o="left",anchorY:l="top",root:d})=>{const[u,h]=zE(a),p=v.useMemo(()=>Gk(r),[r]),f=a&&!u?[]:p.map(qu),m=v.useRef(!0),g=v.useRef(p),y=Ux(()=>new Map),x=v.useRef(new Set),[b,w]=v.useState(p),[C,k]=v.useState(p);Gx(()=>{m.current=!1,g.current=p;for(let T=0;T<C.length;T++){const j=qu(C[T]);f.includes(j)?(y.delete(j),x.current.delete(j)):y.get(j)!==!0&&y.set(j,!1)}},[C,f.length,f.join("-")]);const S=[];if(p!==b){let T=[...p];for(let j=0;j<C.length;j++){const _=C[j],M=qu(_);f.includes(M)||(T.splice(j,0,_),S.push(_))}return n==="wait"&&S.length&&(T=S),k(Gk(T)),w(p),null}const{forceRender:A}=v.useContext(Ud);return c.jsx(c.Fragment,{children:C.map(T=>{const j=qu(T),_=a&&!u?!1:p===C||f.includes(j),M=()=>{if(x.current.has(j))return;if(x.current.add(j),y.has(j))y.set(j,!0);else return;let P=!0;y.forEach(R=>{R||(P=!1)}),P&&(A?.(),k(g.current),a&&h?.(),s&&s())};return c.jsx(gU,{isPresent:_,initial:!m.current||t?void 0:!1,custom:e,presenceAffectsLayout:i,mode:n,root:d,onExitComplete:_?void 0:M,anchorX:o,anchorY:l,children:T},j)})})},xU=v.createContext(null);function bU(){const r=v.useRef(!1);return Gx(()=>(r.current=!0,()=>{r.current=!1}),[]),r}function vU(){const r=bU(),[e,t]=v.useState(0),s=v.useCallback(()=>{r.current&&t(e+1)},[e]);return[v.useCallback(()=>Rt.postRender(s),[s]),e]}const UE=r=>r===!0,wU=r=>UE(r===!0)||r==="id",kU=({children:r,id:e,inherit:t=!0})=>{const s=v.useContext(Ud),i=v.useContext(xU),[n,a]=vU(),o=v.useRef(null),l=s.id||i;o.current===null&&(wU(t)&&l&&(e=e?l+"-"+e:l),o.current={id:e,group:UE(t)&&s.group||Vk()});const d=v.useMemo(()=>({...o.current,forceRender:n}),[a]);return c.jsx(Ud.Provider,{value:d,children:r})},GE=v.createContext({strict:!1}),Wk={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Yk=!1;function CU(){if(Yk)return;const r={};for(const e in Wk)r[e]={isEnabled:t=>Wk[e].some(s=>!!t[s])};yE(r),Yk=!0}function WE(){return CU(),i8()}function SU(r){const e=WE();for(const t in r)e[t]={...e[t],...r[t]};yE(e)}const TU=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function kp(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||TU.has(r)}let YE=r=>!kp(r);function AU(r){typeof r=="function"&&(YE=e=>e.startsWith("on")?!kp(e):r(e))}try{AU(require("@emotion/is-prop-valid").default)}catch{}function jU(r,e,t){const s={};for(const i in r)i==="values"&&typeof r.values=="object"||(YE(i)||t===!0&&kp(i)||!e&&!kp(i)||r.draggable&&i.startsWith("onDrag"))&&(s[i]=r[i]);return s}const af=v.createContext({});function _U(r,e){if(nf(r)){const{initial:t,animate:s}=r;return{initial:t===!1||qd(t)?t:void 0,animate:qd(s)?s:void 0}}return r.inherit!==!1?e:{}}function EU(r){const{initial:e,animate:t}=_U(r,v.useContext(af));return v.useMemo(()=>({initial:e,animate:t}),[qk(e),qk(t)])}function qk(r){return Array.isArray(r)?r.join(" "):r}const bb=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function qE(r,e,t){for(const s in e)!Qs(e[s])&&!SE(s,t)&&(r[s]=e[s])}function MU({transformTemplate:r},e){return v.useMemo(()=>{const t=bb();return gb(t,e,r),Object.assign({},t.vars,t.style)},[e])}function PU(r,e){const t=r.style||{},s={};return qE(s,t,r),Object.assign(s,MU(r,e)),s}function NU(r,e){const t={},s=PU(r,e);return r.drag&&r.dragListener!==!1&&(t.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(t.tabIndex=0),t.style=s,t}const HE=()=>({...bb(),attrs:{}});function RU(r,e,t,s){const i=v.useMemo(()=>{const n=HE();return TE(n,e,jE(s),r.transformTemplate,r.style),{...n.attrs,style:{...n.style}}},[e]);if(r.style){const n={};qE(n,r.style,r),i.style={...n,...i.style}}return i}const IU=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function vb(r){return typeof r!="string"||r.includes("-")?!1:!!(IU.indexOf(r)>-1||/[A-Z]/u.test(r))}function DU(r,e,t,{latestValues:s},i,n=!1,a){const l=(a??vb(r)?RU:NU)(e,s,i,r),d=jU(e,typeof r=="string",n),u=r!==v.Fragment?{...d,...l,ref:t}:{},{children:h}=e,p=v.useMemo(()=>Qs(h)?h.get():h,[h]);return v.createElement(r,{...u,children:p})}function FU({scrapeMotionValuesFromProps:r,createRenderState:e},t,s,i){return{latestValues:BU(t,s,i,r),renderState:e()}}function BU(r,e,t,s){const i={},n=s(r,{});for(const p in n)i[p]=Dh(n[p]);let{initial:a,animate:o}=r;const l=nf(r),d=gE(r);e&&d&&!l&&r.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let u=t?t.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!rf(h)){const p=Array.isArray(h)?h:[h];for(let f=0;f<p.length;f++){const m=lb(r,p[f]);if(m){const{transitionEnd:g,transition:y,...x}=m;for(const b in x){let w=x[b];if(Array.isArray(w)){const C=u?w.length-1:0;w=w[C]}w!==null&&(i[b]=w)}for(const b in g)i[b]=g[b]}}}return i}const XE=r=>(e,t)=>{const s=v.useContext(af),i=v.useContext(sf),n=()=>FU(r,e,s,i);return t?n():Ux(n)},LU=XE({scrapeMotionValuesFromProps:yb,createRenderState:bb}),OU=XE({scrapeMotionValuesFromProps:_E,createRenderState:HE}),$U=Symbol.for("motionComponentSymbol");function zU(r,e,t){const s=v.useRef(t);v.useInsertionEffect(()=>{s.current=t});const i=v.useRef(null);return v.useCallback(n=>{n&&r.onMount?.(n),e&&(n?e.mount(n):e.unmount());const a=s.current;if(typeof a=="function")if(n){const o=a(n);typeof o=="function"&&(i.current=o)}else i.current?(i.current(),i.current=null):a(n);else a&&(a.current=n)},[e])}const KE=v.createContext({});function sd(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function VU(r,e,t,s,i,n){const{visualElement:a}=v.useContext(af),o=v.useContext(GE),l=v.useContext(sf),d=v.useContext(xb).reducedMotion,u=v.useRef(null),h=v.useRef(!1);s=s||o.renderer,!u.current&&s&&(u.current=s(r,{visualState:e,parent:a,props:t,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:d,isSVG:n}),h.current&&u.current&&(u.current.manuallyAnimateOnMount=!0));const p=u.current,f=v.useContext(KE);p&&!p.projection&&i&&(p.type==="html"||p.type==="svg")&&UU(u.current,t,i,f);const m=v.useRef(!1);v.useInsertionEffect(()=>{p&&m.current&&p.update(t,l)});const g=t[sE],y=v.useRef(!!g&&!window.MotionHandoffIsComplete?.(g)&&window.MotionHasOptimisedAnimation?.(g));return Gx(()=>{h.current=!0,p&&(m.current=!0,window.MotionIsMounted=!0,p.updateFeatures(),p.scheduleRenderMicrotask(),y.current&&p.animationState&&p.animationState.animateChanges())}),v.useEffect(()=>{p&&(!y.current&&p.animationState&&p.animationState.animateChanges(),y.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(g)}),y.current=!1),p.enteringChildren=void 0)}),p}function UU(r,e,t,s){const{layoutId:i,layout:n,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:d,layoutCrossfade:u}=e;r.projection=new t(r.latestValues,e["data-framer-portal-id"]?void 0:QE(r.parent)),r.projection.setOptions({layoutId:i,layout:n,alwaysMeasureLayout:!!a||o&&sd(o),visualElement:r,animationType:typeof n=="string"?n:"both",initialPromotionConfig:s,crossfade:u,layoutScroll:l,layoutRoot:d})}function QE(r){if(r)return r.options.allowProjection!==!1?r.projection:QE(r.parent)}function fm(r,{forwardMotionProps:e=!1,type:t}={},s,i){s&&SU(s);const n=t?t==="svg":vb(r),a=n?OU:LU;function o(d,u){let h;const p={...v.useContext(xb),...d,layoutId:GU(d)},{isStatic:f}=p,m=EU(d),g=a(d,f);if(!f&&b_){WU();const y=YU(p);h=y.MeasureLayout,m.visualElement=VU(r,g,p,i,y.ProjectionNode,n)}return c.jsxs(af.Provider,{value:m,children:[h&&m.visualElement?c.jsx(h,{visualElement:m.visualElement,...p}):null,DU(r,d,zU(g,m.visualElement,u),g,f,e,n)]})}o.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const l=v.forwardRef(o);return l[$U]=r,l}function GU({layoutId:r}){const e=v.useContext(Ud).id;return e&&r!==void 0?e+"-"+r:r}function WU(r,e){v.useContext(GE).strict}function YU(r){const e=WE(),{drag:t,layout:s}=e;if(!t&&!s)return{};const i={...t,...s};return{MeasureLayout:t?.isEnabled(r)||s?.isEnabled(r)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}function qU(r,e){if(typeof Proxy>"u")return fm;const t=new Map,s=(n,a)=>fm(n,a,r,e),i=(n,a)=>s(n,a);return new Proxy(i,{get:(n,a)=>a==="create"?s:(t.has(a)||t.set(a,fm(a,void 0,r,e)),t.get(a))})}const HU=(r,e)=>e.isSVG??vb(r)?new v8(e):new f8(e,{allowProjection:r!==v.Fragment});class XU extends Sa{constructor(e){super(e),e.animationState||(e.animationState=T8(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();rf(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let KU=0;class QU extends Sa{constructor(){super(...arguments),this.id=KU++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===s)return;const i=this.node.animationState.setActive("exit",!e);t&&!e&&i.then(()=>{t(this.id)})}mount(){const{register:e,onExitComplete:t}=this.node.presenceContext||{};t&&t(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const JU={animation:{Feature:XU},exit:{Feature:QU}};function wu(r){return{point:{x:r.pageX,y:r.pageY}}}const ZU=r=>e=>pb(e)&&r(e,wu(e));function Cd(r,e,t,s){return Hd(r,e,ZU(t),s)}const JE=({current:r})=>r?r.ownerDocument.defaultView:null,Hk=(r,e)=>Math.abs(r-e);function eG(r,e){const t=Hk(r.x,e.x),s=Hk(r.y,e.y);return Math.sqrt(t**2+s**2)}const Xk=new Set(["auto","scroll"]);class ZE{constructor(e,t,{transformPagePoint:s,contextWindow:i=window,dragSnapToOrigin:n=!1,distanceThreshold:a=3,element:o}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=f=>{this.handleScroll(f.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=gm(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,g=eG(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!g)return;const{point:y}=f,{timestamp:x}=Fs;this.history.push({...y,timestamp:x});const{onStart:b,onMove:w}=this.handlers;m||(b&&b(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),w&&w(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=mm(m,this.transformPagePoint),Rt.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:g,onSessionEnd:y,resumeAnimation:x}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const b=gm(f.type==="pointercancel"?this.lastMoveEventInfo:mm(m,this.transformPagePoint),this.history);this.startEvent&&g&&g(f,b),y&&y(f,b)},!pb(e))return;this.dragSnapToOrigin=n,this.handlers=t,this.transformPagePoint=s,this.distanceThreshold=a,this.contextWindow=i||window;const l=wu(e),d=mm(l,this.transformPagePoint),{point:u}=d,{timestamp:h}=Fs;this.history=[{...u,timestamp:h}];const{onSessionStart:p}=t;p&&p(e,gm(d,this.history)),this.removeListeners=xu(Cd(this.contextWindow,"pointermove",this.handlePointerMove),Cd(this.contextWindow,"pointerup",this.handlePointerUp),Cd(this.contextWindow,"pointercancel",this.handlePointerUp)),o&&this.startScrollTracking(o)}startScrollTracking(e){let t=e.parentElement;for(;t;){const s=getComputedStyle(t);(Xk.has(s.overflowX)||Xk.has(s.overflowY))&&this.scrollPositions.set(t,{x:t.scrollLeft,y:t.scrollTop}),t=t.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(e){const t=this.scrollPositions.get(e);if(!t)return;const s=e===window,i=s?{x:window.scrollX,y:window.scrollY}:{x:e.scrollLeft,y:e.scrollTop},n={x:i.x-t.x,y:i.y-t.y};n.x===0&&n.y===0||(s?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=n.x,this.lastMoveEventInfo.point.y+=n.y):this.history.length>0&&(this.history[0].x-=n.x,this.history[0].y-=n.y),this.scrollPositions.set(e,i),Rt.update(this.updatePoint,!0))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),ma(this.updatePoint)}}function mm(r,e){return e?{point:e(r.point)}:r}function Kk(r,e){return{x:r.x-e.x,y:r.y-e.y}}function gm({point:r},e){return{point:r,delta:Kk(r,eM(e)),offset:Kk(r,tG(e)),velocity:sG(e,.1)}}function tG(r){return r[0]}function eM(r){return r[r.length-1]}function sG(r,e){if(r.length<2)return{x:0,y:0};let t=r.length-1,s=null;const i=eM(r);for(;t>=0&&(s=r[t],!(i.timestamp-s.timestamp>gn(e)));)t--;if(!s)return{x:0,y:0};const n=sr(i.timestamp-s.timestamp);if(n===0)return{x:0,y:0};const a={x:(i.x-s.x)/n,y:(i.y-s.y)/n};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function iG(r,{min:e,max:t},s){return e!==void 0&&r<e?r=s?Kt(e,r,s.min):Math.max(r,e):t!==void 0&&r>t&&(r=s?Kt(t,r,s.max):Math.min(r,t)),r}function Qk(r,e,t){return{min:e!==void 0?r.min+e:void 0,max:t!==void 0?r.max+t-(r.max-r.min):void 0}}function rG(r,{top:e,left:t,bottom:s,right:i}){return{x:Qk(r.x,t,i),y:Qk(r.y,e,s)}}function Jk(r,e){let t=e.min-r.min,s=e.max-r.max;return e.max-e.min<r.max-r.min&&([t,s]=[s,t]),{min:t,max:s}}function nG(r,e){return{x:Jk(r.x,e.x),y:Jk(r.y,e.y)}}function aG(r,e){let t=.5;const s=di(r),i=di(e);return i>s?t=Gd(e.min,e.max-s,r.min):s>i&&(t=Gd(r.min,r.max-i,e.min)),Wr(0,1,t)}function oG(r,e){const t={};return e.min!==void 0&&(t.min=e.min-r.min),e.max!==void 0&&(t.max=e.max-r.min),t}const Q0=.35;function cG(r=Q0){return r===!1?r=0:r===!0&&(r=Q0),{x:Zk(r,"left","right"),y:Zk(r,"top","bottom")}}function Zk(r,e,t){return{min:eC(r,e),max:eC(r,t)}}function eC(r,e){return typeof r=="number"?r:r[e]||0}const lG=new WeakMap;class dG{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ws(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:t=!1,distanceThreshold:s}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const n=h=>{t?(this.stopAnimation(),this.snapToCursor(wu(h).point)):this.pauseAnimation()},a=(h,p)=>{this.stopAnimation();const{drag:f,dragPropagation:m,onDragStart:g}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=W6(f),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=p,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Xi(x=>{let b=this.getAxisMotionValue(x).get()||0;if(zr.test(b)){const{projection:w}=this.visualElement;if(w&&w.layout){const C=w.layout.layoutBox[x];C&&(b=di(C)*(parseFloat(b)/100))}}this.originPoint[x]=b}),g&&Rt.postRender(()=>g(h,p)),U0(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},o=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p;const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:g,onDrag:y}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:x}=p;if(m&&this.currentDirection===null){this.currentDirection=uG(x),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",p.point,x),this.updateAxis("y",p.point,x),this.visualElement.render(),y&&y(h,p)},l=(h,p)=>{this.latestPointerEvent=h,this.latestPanInfo=p,this.stop(h,p),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>Xi(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new ZE(e,{onSessionStart:n,onStart:a,onMove:o,onSessionEnd:l,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:s,contextWindow:JE(this.visualElement),element:this.visualElement.current})}stop(e,t){const s=e||this.latestPointerEvent,i=t||this.latestPanInfo,n=this.isDragging;if(this.cancel(),!n||!i||!s)return;const{velocity:a}=i;this.startAnimation(a);const{onDragEnd:o}=this.getProps();o&&Rt.postRender(()=>o(s,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:s}=this.getProps();!s&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),t&&t.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(e,t,s){const{drag:i}=this.getProps();if(!s||!Hu(e,i,this.currentDirection))return;const n=this.getAxisMotionValue(e);let a=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(a=iG(a,this.constraints[e],this.elastic[e])),n.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:t}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,i=this.constraints;e&&sd(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&s?this.constraints=rG(s.layoutBox,e):this.constraints=!1,this.elastic=cG(t),i!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&Xi(n=>{this.constraints!==!1&&this.getAxisMotionValue(n)&&(this.constraints[n]=oG(s.layoutBox[n],this.constraints[n]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!sd(e))return!1;const s=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const n=c8(s,i.root,this.visualElement.getTransformPagePoint());let a=nG(i.layout.layoutBox,n);if(t){const o=t(n8(a));this.hasMutatedConstraints=!!o,o&&(a=bE(o))}return a}startAnimation(e){const{drag:t,dragMomentum:s,dragElastic:i,dragTransition:n,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},d=Xi(u=>{if(!Hu(u,t,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const p=i?200:1e6,f=i?40:1e7,m={type:"inertia",velocity:s?e[u]:0,bounceStiffness:p,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...n,...h};return this.startAxisValueAnimation(u,m)});return Promise.all(d).then(o)}startAxisValueAnimation(e,t){const s=this.getAxisMotionValue(e);return U0(this.visualElement,e),s.start(cb(e,s,0,t,this.visualElement,!1))}stopAnimation(){Xi(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Xi(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,s=this.visualElement.getProps(),i=s[t];return i||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Xi(t=>{const{drag:s}=this.getProps();if(!Hu(t,s,this.currentDirection))return;const{projection:i}=this.visualElement,n=this.getAxisMotionValue(t);if(i&&i.layout){const{min:a,max:o}=i.layout.layoutBox[t],l=n.get()||0;n.set(e[t]-Kt(a,o,.5)+l)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:s}=this.visualElement;if(!sd(t)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Xi(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();i[a]=aG({min:l,max:l},this.constraints[a])}});const{transformTemplate:n}=this.visualElement.getProps();this.visualElement.current.style.transform=n?n({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Xi(a=>{if(!Hu(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:d}=this.constraints[a];o.set(Kt(l,d,i[a]))})}addListeners(){if(!this.visualElement.current)return;lG.set(this.visualElement,this);const e=this.visualElement.current,t=Cd(e,"pointerdown",l=>{const{drag:d,dragListener:u=!0}=this.getProps(),h=l.target,p=h!==e&&pE(h);d&&u&&!p&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();sd(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,n=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Rt.read(s);const a=Hd(window,"resize",()=>this.scalePositionWithinConstraints()),o=i.addEventListener("didUpdate",({delta:l,hasLayoutChanged:d})=>{this.isDragging&&d&&(Xi(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())});return()=>{a(),t(),n(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:n=!1,dragElastic:a=Q0,dragMomentum:o=!0}=e;return{...e,drag:t,dragDirectionLock:s,dragPropagation:i,dragConstraints:n,dragElastic:a,dragMomentum:o}}}function Hu(r,e,t){return(e===!0||e===r)&&(t===null||t===r)}function uG(r,e=10){let t=null;return Math.abs(r.y)>e?t="y":Math.abs(r.x)>e&&(t="x"),t}class hG extends Sa{constructor(e){super(e),this.removeGroupControls=lr,this.removeListeners=lr,this.controls=new dG(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||lr}update(){const{dragControls:e}=this.node.getProps(),{dragControls:t}=this.node.prevProps||{};e!==t&&(this.removeGroupControls(),e&&(this.removeGroupControls=e.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const tC=r=>(e,t)=>{r&&Rt.postRender(()=>r(e,t))};class pG extends Sa{constructor(){super(...arguments),this.removePointerDownListener=lr}onPointerDown(e){this.session=new ZE(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:JE(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:tC(e),onStart:tC(t),onMove:s,onEnd:(n,a)=>{delete this.session,i&&Rt.postRender(()=>i(n,a))}}}mount(){this.removePointerDownListener=Cd(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let ym=!1;class fG extends v.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s,layoutId:i}=this.props,{projection:n}=e;n&&(t.group&&t.group.add(n),s&&s.register&&i&&s.register(n),ym&&n.root.didUpdate(),n.addEventListener("animationComplete",()=>{this.safeToRemove()}),n.setOptions({...n.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),Fh.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:s,drag:i,isPresent:n}=this.props,{projection:a}=s;return a&&(a.isPresent=n,e.layoutDependency!==t&&a.setOptions({...a.options,layoutDependency:t}),ym=!0,i||e.layoutDependency!==t||t===void 0||e.isPresent!==n?a.willUpdate():this.safeToRemove(),e.isPresent!==n&&(n?a.promote():a.relegate()||Rt.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),hb.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:s}=this.props,{projection:i}=e;ym=!0,i&&(i.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function tM(r){const[e,t]=zE(),s=v.useContext(Ud);return c.jsx(fG,{...r,layoutGroup:s,switchLayoutGroup:v.useContext(KE),isPresent:e,safeToRemove:t})}const mG={pan:{Feature:pG},drag:{Feature:hG,ProjectionNode:$E,MeasureLayout:tM}};function sC(r,e,t){const{props:s}=r;r.animationState&&s.whileHover&&r.animationState.setActive("whileHover",t==="Start");const i="onHover"+t,n=s[i];n&&Rt.postRender(()=>n(e,wu(e)))}class gG extends Sa{mount(){const{current:e}=this.node;e&&(this.unmount=Y6(e,(t,s)=>(sC(this.node,s,"Start"),i=>sC(this.node,i,"End"))))}unmount(){}}class yG extends Sa{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=xu(Hd(this.node.current,"focus",()=>this.onFocus()),Hd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function iC(r,e,t){const{props:s}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&s.whileTap&&r.animationState.setActive("whileTap",t==="Start");const i="onTap"+(t==="End"?"":t),n=s[i];n&&Rt.postRender(()=>n(e,wu(e)))}class xG extends Sa{mount(){const{current:e}=this.node;e&&(this.unmount=X6(e,(t,s)=>(iC(this.node,s,"Start"),(i,{success:n})=>iC(this.node,i,n?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const J0=new WeakMap,xm=new WeakMap,bG=r=>{const e=J0.get(r.target);e&&e(r)},vG=r=>{r.forEach(bG)};function wG({root:r,...e}){const t=r||document;xm.has(t)||xm.set(t,{});const s=xm.get(t),i=JSON.stringify(e);return s[i]||(s[i]=new IntersectionObserver(vG,{root:r,...e})),s[i]}function kG(r,e,t){const s=wG(e);return J0.set(r,t),s.observe(r),()=>{J0.delete(r),s.unobserve(r)}}const CG={some:0,all:1};class SG extends Sa{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:s,amount:i="some",once:n}=e,a={root:t?t.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:CG[i]},o=l=>{const{isIntersecting:d}=l;if(this.isInView===d||(this.isInView=d,n&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),p=d?u:h;p&&p(l)};return kG(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(TG(e,t))&&this.startObserver()}unmount(){}}function TG({viewport:r={}},{viewport:e={}}={}){return t=>r[t]!==e[t]}const AG={inView:{Feature:SG},tap:{Feature:xG},focus:{Feature:yG},hover:{Feature:gG}},jG={layout:{ProjectionNode:$E,MeasureLayout:tM}},_G={...JU,...AG,...mG,...jG},Mo=qU(_G,HU),sM=v.createContext({open:!1}),Xd=v.forwardRef(({open:r,onOpenChange:e,defaultOpen:t=!1,children:s,...i},n)=>{const[a,o]=v.useState(t),l=r??a,d=v.useCallback(u=>{o(u),e?.(u)},[e]);return c.jsx(sM.Provider,{value:{open:l},children:c.jsx(BN,{ref:n,open:l,onOpenChange:d,...i,children:s})})});Xd.displayName="Collapsible";const Cp=ON,Kd=v.forwardRef(({className:r,children:e,...t},s)=>{const{open:i}=v.useContext(sM);return c.jsx(VE,{initial:!1,children:i&&c.jsx(LN,{forceMount:!0,asChild:!0,...t,children:c.jsx(Mo.div,{ref:s,initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{height:{type:"spring",stiffness:500,damping:40},opacity:{duration:.15}},className:$e("overflow-hidden",r),children:e})})})});Kd.displayName="CollapsibleContent";const of=zN,cf=VN,rC=UN,Z0=v.forwardRef(({className:r,inset:e,children:t,...s},i)=>c.jsxs(lS,{ref:i,className:$e("flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",e&&"pl-8",r),...s,children:[t,c.jsx(Js,{className:"ml-auto h-4 w-4"})]}));Z0.displayName=lS.displayName;const ey=v.forwardRef(({className:r,...e},t)=>c.jsx(dS,{ref:t,className:$e("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 slide-in-from-left-1 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95",r),...e}));ey.displayName=dS.displayName;const lf=v.forwardRef(({className:r,...e},t)=>c.jsx($N,{children:c.jsx(uS,{ref:t,className:$e("z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95",r),...e})}));lf.displayName=uS.displayName;const mi=v.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(hS,{ref:s,className:$e("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed",e&&"pl-8",r),...t}));mi.displayName=hS.displayName;const EG=v.forwardRef(({className:r,children:e,checked:t,...s},i)=>c.jsxs(pS,{ref:i,className:$e("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed",r),checked:t,...s,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(VE,{children:t&&c.jsx(fS,{forceMount:!0,asChild:!0,children:c.jsx(Mo.span,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:500,damping:30},children:c.jsx(Ei,{className:"h-4 w-4"})})})})}),e]}));EG.displayName=pS.displayName;const MG=v.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(mS,{ref:s,className:$e("relative flex cursor-pointer select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed",r),...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(fS,{asChild:!0,children:c.jsx(Mo.span,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:30},children:c.jsx(Vr,{className:"h-2 w-2 fill-current"})})})}),e]}));MG.displayName=mS.displayName;const wb=v.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(gS,{ref:s,className:$e("px-2 py-1.5 text-sm font-semibold text-foreground",e&&"pl-8",r),...t}));wb.displayName=gS.displayName;const ln=v.forwardRef(({className:r,...e},t)=>c.jsx(yS,{ref:t,className:$e("-mx-1 my-1 h-px bg-border",r),...e}));ln.displayName=yS.displayName;const co=({className:r,...e})=>c.jsx("span",{className:$e("ml-auto text-xs tracking-widest text-muted-foreground",r),...e});co.displayName="ContextMenuShortcut";const Ta=YN,PG=GN,iM=v.forwardRef(({className:r,...e},t)=>c.jsx(xS,{ref:t,className:$e("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...e}));iM.displayName=xS.displayName;const Sn=v.forwardRef(({className:r,children:e,hideCloseButton:t=!1,...s},i)=>c.jsxs(PG,{children:[c.jsx(iM,{}),c.jsxs(bS,{ref:i,className:$e("fixed left-1/2 top-1/2 z-50 grid w-full max-w-lg -translate-x-1/2 -translate-y-1/2 gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 sm:rounded-lg",r),...s,children:[e,!t&&c.jsxs(WN,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[c.jsx(Zs,{className:"h-4 w-4"}),c.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Sn.displayName=bS.displayName;const Aa=({className:r,...e})=>c.jsx("div",{className:$e("flex flex-col space-y-1.5 text-center sm:text-left",r),...e});Aa.displayName="DialogHeader";const ja=v.forwardRef(({className:r,...e},t)=>c.jsx(vS,{ref:t,className:$e("text-lg font-semibold leading-none tracking-tight",r),...e}));ja.displayName=vS.displayName;const ku=v.forwardRef(({className:r,...e},t)=>c.jsx(wS,{ref:t,className:$e("text-sm text-muted-foreground",r),...e}));ku.displayName=wS.displayName;const Sp=HN,Tp=XN,NG=v.forwardRef(({className:r,inset:e,children:t,...s},i)=>c.jsxs(kS,{ref:i,className:$e("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",r),...s,children:[t,c.jsx(Js,{className:"ml-auto"})]}));NG.displayName=kS.displayName;const RG=v.forwardRef(({className:r,...e},t)=>c.jsx(CS,{ref:t,className:$e("z-[9999] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...e}));RG.displayName=CS.displayName;const Qd=v.forwardRef(({className:r,sideOffset:e=4,...t},s)=>c.jsx(qN,{children:c.jsx(SS,{ref:s,sideOffset:e,className:$e("z-[9999] max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));Qd.displayName=SS.displayName;const Zi=v.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(TS,{ref:s,className:$e("relative flex cursor-pointer select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[disabled]:cursor-not-allowed [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e&&"pl-8",r),...t}));Zi.displayName=TS.displayName;const IG=v.forwardRef(({className:r,children:e,checked:t,...s},i)=>c.jsxs(AS,{ref:i,className:$e("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:t,...s,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(jS,{children:c.jsx(Ei,{className:"h-4 w-4"})})}),e]}));IG.displayName=AS.displayName;const DG=v.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(_S,{ref:s,className:$e("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(jS,{children:c.jsx(Vr,{className:"h-2 w-2 fill-current"})})}),e]}));DG.displayName=_S.displayName;const rM=v.forwardRef(({className:r,inset:e,...t},s)=>c.jsx(ES,{ref:s,className:$e("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",r),...t}));rM.displayName=ES.displayName;const Sd=v.forwardRef(({className:r,...e},t)=>c.jsx(MS,{ref:t,className:$e("-mx-1 my-1 h-px bg-muted",r),...e}));Sd.displayName=MS.displayName;const Ms=v.forwardRef(({className:r,type:e,...t},s)=>c.jsx("input",{type:e,className:$e("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:s,...t}));Ms.displayName="Input";const FG=tf("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ts=v.forwardRef(({className:r,...e},t)=>c.jsx(PS,{ref:t,className:$e(FG(),r),...e}));ts.displayName=PS.displayName;const nM=QN,aM=JN,kb=v.forwardRef(({className:r,align:e="center",sideOffset:t=4,...s},i)=>c.jsx(KN,{children:c.jsx(NS,{ref:i,align:e,sideOffset:t,className:$e("z-[9999] w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));kb.displayName=NS.displayName;const Cb=v.forwardRef(({className:r,value:e,...t},s)=>c.jsx(RS,{ref:s,className:$e("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...t,children:c.jsx(ZN,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(e||0)}%)`}})}));Cb.displayName=RS.displayName;const jt=nR,id=oR,_t=aR,vt=v.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(IS,{ref:s,className:$e("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",r),...t,children:[e,c.jsx(eR,{asChild:!0,children:c.jsx(ls,{className:"h-4 w-4 opacity-50"})})]}));vt.displayName=IS.displayName;const oM=v.forwardRef(({className:r,...e},t)=>c.jsx(DS,{ref:t,className:$e("flex cursor-default items-center justify-center py-1",r),...e,children:c.jsx(Wj,{className:"h-4 w-4"})}));oM.displayName=DS.displayName;const cM=v.forwardRef(({className:r,...e},t)=>c.jsx(FS,{ref:t,className:$e("flex cursor-default items-center justify-center py-1",r),...e,children:c.jsx(ls,{className:"h-4 w-4"})}));cM.displayName=FS.displayName;const wt=v.forwardRef(({className:r,children:e,position:t="popper",...s},i)=>c.jsx(tR,{children:c.jsx(BS,{ref:i,position:t,asChild:!0,...s,children:c.jsxs(Mo.div,{initial:{opacity:0,scale:.96,y:-4},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.96,y:-4},transition:{type:"spring",stiffness:500,damping:30},className:$e("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md origin-[--radix-select-content-transform-origin]",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),children:[c.jsx(oM,{}),c.jsx(sR,{className:$e("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),c.jsx(cM,{})]})})}));wt.displayName=BS.displayName;const mc=v.forwardRef(({className:r,...e},t)=>c.jsx(LS,{ref:t,className:$e("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...e}));mc.displayName=LS.displayName;const Ve=v.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(OS,{ref:s,className:$e("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[c.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:c.jsx(iR,{asChild:!0,children:c.jsx(Mo.span,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:c.jsx(Ei,{className:"h-4 w-4"})})})}),c.jsx(rR,{children:e})]}));Ve.displayName=OS.displayName;const BG=v.forwardRef(({className:r,...e},t)=>c.jsx($S,{ref:t,className:$e("-mx-1 my-1 h-px bg-muted",r),...e}));BG.displayName=$S.displayName;const oa=v.forwardRef(({className:r,children:e,...t},s)=>c.jsxs(zS,{ref:s,className:$e("relative overflow-hidden",r),...t,children:[c.jsx(cR,{className:"h-full w-full rounded-[inherit] [&>div]:!block [&>div]:!min-w-0",children:e}),c.jsx(lM,{}),c.jsx(lR,{})]}));oa.displayName=zS.displayName;const lM=v.forwardRef(({className:r,orientation:e="vertical",...t},s)=>c.jsx(VS,{ref:s,orientation:e,className:$e("flex touch-none select-none transition-colors",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:c.jsx(dR,{className:"relative flex-1 rounded-full bg-border"})}));lM.displayName=VS.displayName;const st=v.forwardRef(({className:r,...e},t)=>c.jsxs(US,{ref:t,className:$e("relative flex w-full touch-none select-none items-center",r),...e,children:[c.jsx(uR,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-background-tertiary",children:c.jsx(hR,{className:"absolute h-full bg-text-secondary"})}),c.jsx(pR,{className:"block h-2.5 w-2.5 rounded-full bg-white shadow-sm ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));st.displayName=US.displayName;const ht=v.forwardRef(({label:r,value:e,onChange:t,min:s=0,max:i=100,step:n=1,unit:a="",className:o},l)=>{const d=n<1?e.toFixed(1):Math.round(e);return c.jsxs("div",{ref:l,className:$e("space-y-1",o),children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[d,a]})]}),c.jsx(st,{value:[e],onValueChange:u=>t(u[0]),min:s,max:i,step:n,className:"h-1.5"})]})});ht.displayName="LabeledSlider";const LG=v.forwardRef(({value:r,onChange:e,min:t=0,max:s=100,step:i=1,className:n},a)=>c.jsxs("div",{ref:a,className:$e("flex items-center gap-3",n),children:[c.jsx(st,{value:[r],onValueChange:o=>e(o[0]),min:t,max:s,step:i,className:"flex-1 h-1.5"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary w-8 text-right bg-background-tertiary px-1 py-0.5 rounded border border-border",children:Math.round(r)})]}));LG.displayName="InspectorSlider";const ya=v.forwardRef(({className:r,...e},t)=>c.jsx(GS,{className:$e("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",r),...e,ref:t,children:c.jsx(fR,{className:$e("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ya.displayName=GS.displayName;const dM=v.createContext({activeValue:void 0}),Sb=v.forwardRef(({value:r,defaultValue:e,onValueChange:t,children:s,...i},n)=>{const[a,o]=v.useState(e),l=r??a,d=v.useCallback(u=>{o(u),t?.(u)},[t]);return c.jsx(dM.Provider,{value:{activeValue:l},children:c.jsx(mR,{ref:n,value:l,onValueChange:d,...i,children:s})})});Sb.displayName="Tabs";const Tb=v.forwardRef(({className:r,layoutId:e="tabs-indicator",children:t,...s},i)=>c.jsx(WS,{ref:i,className:$e("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground relative",r),...s,children:c.jsx(kU,{id:e,children:t})}));Tb.displayName=WS.displayName;const Jd=v.forwardRef(({className:r,value:e,children:t,...s},i)=>{const{activeValue:n}=v.useContext(dM),a=n===e;return c.jsxs(YS,{ref:i,value:e,className:$e("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative z-10 data-[state=active]:text-foreground",r),...s,children:[a&&c.jsx(Mo.span,{layoutId:"active-tab",className:"absolute inset-0 bg-background rounded-sm shadow-sm -z-10",transition:{type:"spring",stiffness:500,damping:30}}),t]})});Jd.displayName=YS.displayName;const Zd=v.forwardRef(({className:r,...e},t)=>c.jsx(qS,{ref:t,asChild:!0,...e,children:c.jsx(Mo.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},transition:{duration:.15},className:$e("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r)})}));Zd.displayName=qS.displayName;const uM=tf("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3 min-w-10",sm:"h-9 px-2.5 min-w-9",lg:"h-11 px-5 min-w-11"}},defaultVariants:{variant:"default",size:"default"}}),OG=v.forwardRef(({className:r,variant:e,size:t,...s},i)=>c.jsx(HS,{ref:i,className:$e(uM({variant:e,size:t,className:r})),...s}));OG.displayName=HS.displayName;const hM=v.createContext({size:"default",variant:"default"}),$G=v.forwardRef(({className:r,variant:e,size:t,children:s,...i},n)=>c.jsx(XS,{ref:n,className:$e("flex items-center justify-center gap-1",r),...i,children:c.jsx(hM.Provider,{value:{variant:e,size:t},children:s})}));$G.displayName=XS.displayName;const zG=v.forwardRef(({className:r,children:e,variant:t,size:s,...i},n)=>{const a=v.useContext(hM);return c.jsx(KS,{ref:n,className:$e(uM({variant:a.variant||t,size:a.size||s}),r),...i,children:e})});zG.displayName=KS.displayName;const VG=gR,$a=yR,za=xR,Hn=v.forwardRef(({className:r,sideOffset:e=4,...t},s)=>c.jsx(QS,{ref:s,sideOffset:e,className:$e("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",r),...t}));Hn.displayName=QS.displayName;const Ap={tiktok:{width:1080,height:1920,frameRate:30,maxDuration:180,recommendedDuration:15,safeZone:{top:150,bottom:300,left:40,right:40}},"instagram-reels":{width:1080,height:1920,frameRate:30,maxDuration:90,recommendedDuration:30,safeZone:{top:200,bottom:280,left:40,right:40}},"instagram-stories":{width:1080,height:1920,frameRate:30,maxDuration:15,recommendedDuration:10,safeZone:{top:200,bottom:200,left:40,right:40}},"instagram-post":{width:1080,height:1080,frameRate:30,maxDuration:60,recommendedDuration:30},"youtube-shorts":{width:1080,height:1920,frameRate:30,maxDuration:60,recommendedDuration:30,safeZone:{top:100,bottom:200,left:40,right:40}},"youtube-video":{width:1920,height:1080,frameRate:30},facebook:{width:1080,height:1080,frameRate:30,maxDuration:240,recommendedDuration:60},twitter:{width:1280,height:720,frameRate:30,maxDuration:140,recommendedDuration:45},linkedin:{width:1920,height:1080,frameRate:30,maxDuration:600,recommendedDuration:90},pinterest:{width:1e3,height:1500,frameRate:30,maxDuration:60,recommendedDuration:15},intro:{width:1920,height:1080,frameRate:30,recommendedDuration:5},outro:{width:1920,height:1080,frameRate:30,recommendedDuration:10},promo:{width:1920,height:1080,frameRate:30,recommendedDuration:30},"lower-third":{width:1920,height:1080,frameRate:30,recommendedDuration:5},slideshow:{width:1920,height:1080,frameRate:30},custom:{width:1920,height:1080,frameRate:30}},pM=[{id:"tiktok",name:"TikTok",icon:"smartphone",platform:"TikTok"},{id:"instagram-reels",name:"Reels",icon:"film",platform:"Instagram"},{id:"instagram-stories",name:"Stories",icon:"clock",platform:"Instagram"},{id:"instagram-post",name:"Post",icon:"square",platform:"Instagram"},{id:"youtube-shorts",name:"Shorts",icon:"smartphone",platform:"YouTube"},{id:"youtube-video",name:"Video",icon:"monitor",platform:"YouTube"},{id:"facebook",name:"Facebook",icon:"users",platform:"Facebook"},{id:"twitter",name:"Twitter/X",icon:"at-sign",platform:"Twitter"},{id:"linkedin",name:"LinkedIn",icon:"briefcase",platform:"LinkedIn"},{id:"pinterest",name:"Pinterest",icon:"bookmark",platform:"Pinterest"},{id:"intro",name:"Intro",icon:"play",platform:"General"},{id:"outro",name:"Outro",icon:"square",platform:"General"},{id:"promo",name:"Promo",icon:"megaphone",platform:"General"},{id:"lower-third",name:"Lower Third",icon:"type",platform:"General"},{id:"slideshow",name:"Slideshow",icon:"images",platform:"General"},{id:"custom",name:"Custom",icon:"settings",platform:"Custom"}];function UG(r){return JSON.stringify(r,null,2)}function GG(r){return JSON.parse(r)}function bm(){return`${Date.now()}-${Math.random().toString(36).substring(2,11)}`}class WG{validate(e,t){const s=[];if(!e.type||typeof e.type!="string")return s.push({code:"INVALID_TYPE",message:"Action type is required and must be a string"}),{valid:!1,errors:s};if(!e.params||typeof e.params!="object")return s.push({code:"INVALID_PARAMS",message:"Action params are required and must be an object"}),{valid:!1,errors:s};const i=this.validateActionType(e,t);return s.push(...i),{valid:s.length===0,errors:s}}validateActionType(e,t){const s=e.type;return s.startsWith("project/")?this.validateProjectAction(e,t):s.startsWith("media/")?this.validateMediaAction(e,t):s.startsWith("track/")?this.validateTrackAction(e,t):s.startsWith("clip/")?this.validateClipAction(e,t):s.startsWith("effect/")?this.validateEffectAction(e,t):s.startsWith("transform/")?this.validateTransformAction(e,t):s.startsWith("keyframe/")?this.validateKeyframeAction(e,t):s.startsWith("transition/")?this.validateTransitionAction(e,t):s.startsWith("audio/")?this.validateAudioAction(e,t):s.startsWith("subtitle/")?this.validateSubtitleAction(e,t):[{code:"UNKNOWN_ACTION_TYPE",message:`Unknown action type: ${s}`}]}validateProjectAction(e,t){const s=[];switch(e.type){case"project/create":(!e.params.name||typeof e.params.name!="string")&&s.push({code:"INVALID_PARAMS",message:"Project name is required and must be a string",path:"params.name"}),e.params.settings||s.push({code:"INVALID_PARAMS",message:"Project settings are required",path:"params.settings"});break;case"project/rename":(!e.params.name||typeof e.params.name!="string")&&s.push({code:"INVALID_PARAMS",message:"Project name is required and must be a string",path:"params.name"});break;case"project/updateSettings":(!e.params||typeof e.params!="object"||Array.isArray(e.params))&&s.push({code:"INVALID_PARAMS",message:"Settings must be an object",path:"params"});break}return s}validateMediaAction(e,t){const s=[];switch(e.type){case"media/import":e.params.file||s.push({code:"INVALID_PARAMS",message:"File is required for media import",path:"params.file"});break;case"media/delete":case"media/rename":!e.params.mediaId||typeof e.params.mediaId!="string"?s.push({code:"INVALID_PARAMS",message:"Media ID is required and must be a string",path:"params.mediaId"}):t.mediaLibrary.items.some(n=>n.id===e.params.mediaId)||s.push({code:"MEDIA_NOT_FOUND",message:`Media with ID ${e.params.mediaId} not found`,path:"params.mediaId"}),e.type==="media/rename"&&(!e.params.name||typeof e.params.name!="string")&&s.push({code:"INVALID_PARAMS",message:"Media name is required and must be a string",path:"params.name"});break}return s}validateTrackAction(e,t){const s=[],i=t.timeline;switch(e.type){case"track/add":["video","audio","image","text","graphics"].includes(e.params.trackType)||s.push({code:"INVALID_PARAMS",message:"Track type must be 'video', 'audio', 'image', 'text', or 'graphics'",path:"params.trackType"}),e.params.position!==void 0&&(typeof e.params.position!="number"||e.params.position<0)&&s.push({code:"INVALID_PARAMS",message:"Track position must be a non-negative number",path:"params.position"});break;case"track/remove":case"track/lock":case"track/hide":case"track/mute":case"track/solo":!e.params.trackId||typeof e.params.trackId!="string"?s.push({code:"INVALID_PARAMS",message:"Track ID is required and must be a string",path:"params.trackId"}):this.findTrack(i,e.params.trackId)||s.push({code:"TRACK_NOT_FOUND",message:`Track with ID ${e.params.trackId} not found`,path:"params.trackId"}),e.type==="track/lock"&&typeof e.params.locked!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Locked parameter must be a boolean",path:"params.locked"}),e.type==="track/hide"&&typeof e.params.hidden!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Hidden parameter must be a boolean",path:"params.hidden"}),e.type==="track/mute"&&typeof e.params.muted!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Muted parameter must be a boolean",path:"params.muted"}),e.type==="track/solo"&&typeof e.params.solo!="boolean"&&s.push({code:"INVALID_PARAMS",message:"Solo parameter must be a boolean",path:"params.solo"});break;case"track/reorder":!e.params.trackId||typeof e.params.trackId!="string"?s.push({code:"INVALID_PARAMS",message:"Track ID is required and must be a string",path:"params.trackId"}):this.findTrack(i,e.params.trackId)||s.push({code:"TRACK_NOT_FOUND",message:`Track with ID ${e.params.trackId} not found`,path:"params.trackId"}),(typeof e.params.newPosition!="number"||e.params.newPosition<0||e.params.newPosition>=i.tracks.length)&&s.push({code:"INVALID_PARAMS",message:`New position must be between 0 and ${i.tracks.length-1}`,path:"params.newPosition"});break}return s}validateClipAction(e,t){const s=[],i=t.timeline;switch(e.type){case"clip/add":if(!e.params.trackId||typeof e.params.trackId!="string")s.push({code:"INVALID_PARAMS",message:"Track ID is required and must be a string",path:"params.trackId"});else{const n=this.findTrack(i,e.params.trackId);n?n.locked&&s.push({code:"TRACK_LOCKED",message:`Track ${e.params.trackId} is locked`,path:"params.trackId"}):s.push({code:"TRACK_NOT_FOUND",message:`Track with ID ${e.params.trackId} not found`,path:"params.trackId"})}!e.params.mediaId||typeof e.params.mediaId!="string"?s.push({code:"INVALID_PARAMS",message:"Media ID is required and must be a string",path:"params.mediaId"}):t.mediaLibrary.items.some(a=>a.id===e.params.mediaId)||s.push({code:"MEDIA_NOT_FOUND",message:`Media with ID ${e.params.mediaId} not found`,path:"params.mediaId"}),(typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"});break;case"clip/remove":case"clip/rippleDelete":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}break;case"clip/move":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}if((typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"}),e.params.trackId!==void 0)if(typeof e.params.trackId!="string")s.push({code:"INVALID_PARAMS",message:"Track ID must be a string",path:"params.trackId"});else{const n=this.findTrack(i,e.params.trackId);n?n.locked&&s.push({code:"TRACK_LOCKED",message:`Target track ${e.params.trackId} is locked`,path:"params.trackId"}):s.push({code:"TRACK_NOT_FOUND",message:`Target track with ID ${e.params.trackId} not found`,path:"params.trackId"})}break;case"clip/trim":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}e.params.inPoint!==void 0&&(typeof e.params.inPoint!="number"||e.params.inPoint<0)&&s.push({code:"INVALID_PARAMS",message:"In-point must be a non-negative number",path:"params.inPoint"}),e.params.outPoint!==void 0&&(typeof e.params.outPoint!="number"||e.params.outPoint<0)&&s.push({code:"INVALID_PARAMS",message:"Out-point must be a non-negative number",path:"params.outPoint"}),e.params.inPoint!==void 0&&e.params.outPoint!==void 0&&e.params.outPoint<=e.params.inPoint&&s.push({code:"INVALID_TIME_RANGE",message:"Out-point must be greater than in-point",path:"params"});break;case"clip/split":if(!e.params.clipId||typeof e.params.clipId!="string")s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"});else{const n=this.findClip(i,e.params.clipId);n?(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),typeof e.params.time=="number"?(e.params.time<=n.startTime||e.params.time>=n.startTime+n.duration)&&s.push({code:"OUT_OF_BOUNDS",message:`Split time must be within clip bounds (${n.startTime} to ${n.startTime+n.duration})`,path:"params.time"}):s.push({code:"INVALID_PARAMS",message:"Split time is required and must be a number",path:"params.time"})):s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"})}break}return s}validateEffectAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);if(!n)return s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s;switch(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),e.type){case"effect/add":(!e.params.effectType||typeof e.params.effectType!="string")&&s.push({code:"INVALID_PARAMS",message:"Effect type is required and must be a string",path:"params.effectType"});break;case"effect/remove":case"effect/update":case"effect/reorder":!e.params.effectId||typeof e.params.effectId!="string"?s.push({code:"INVALID_PARAMS",message:"Effect ID is required and must be a string",path:"params.effectId"}):n.effects.some(l=>l.id===e.params.effectId)||s.push({code:"EFFECT_NOT_FOUND",message:`Effect with ID ${e.params.effectId} not found on clip`,path:"params.effectId"}),e.type==="effect/reorder"&&(typeof e.params.newIndex!="number"||e.params.newIndex<0||e.params.newIndex>=n.effects.length)&&s.push({code:"INVALID_PARAMS",message:`New index must be between 0 and ${n.effects.length-1}`,path:"params.newIndex"});break}return s}validateTransformAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);return n?(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),(!e.params.transform||typeof e.params.transform!="object")&&s.push({code:"INVALID_PARAMS",message:"Transform is required and must be an object",path:"params.transform"}),s):(s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s)}validateKeyframeAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);return n?(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),(!e.params.property||typeof e.params.property!="string")&&s.push({code:"INVALID_PARAMS",message:"Property is required and must be a string",path:"params.property"}),(typeof e.params.time!="number"||e.params.time<0)&&s.push({code:"INVALID_PARAMS",message:"Time is required and must be a non-negative number",path:"params.time"}),s):(s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s)}validateTransitionAction(e,t){const s=[],i=t.timeline;switch(e.type){case"transition/add":if((!e.params.clipAId||typeof e.params.clipAId!="string")&&s.push({code:"INVALID_PARAMS",message:"Clip A ID is required and must be a string",path:"params.clipAId"}),(!e.params.clipBId||typeof e.params.clipBId!="string")&&s.push({code:"INVALID_PARAMS",message:"Clip B ID is required and must be a string",path:"params.clipBId"}),(typeof e.params.duration!="number"||e.params.duration<=0)&&s.push({code:"INVALID_PARAMS",message:"Duration must be a positive number",path:"params.duration"}),e.params.clipAId&&e.params.clipBId){const n=this.findClip(i,e.params.clipAId),a=this.findClip(i,e.params.clipBId);if(n||s.push({code:"CLIP_NOT_FOUND",message:`Clip A with ID ${e.params.clipAId} not found`,path:"params.clipAId"}),a||s.push({code:"CLIP_NOT_FOUND",message:`Clip B with ID ${e.params.clipBId} not found`,path:"params.clipBId"}),n&&a){n.trackId!==a.trackId&&s.push({code:"INVALID_PARAMS",message:"Clips must be on the same track for transition",path:"params"});const o=n.startTime+n.duration,l=a.startTime+a.duration,d=.001,u=Math.abs(o-a.startTime)<d,h=Math.abs(l-n.startTime)<d;!u&&!h&&s.push({code:"INVALID_PARAMS",message:"Clips must be adjacent for transition",path:"params"})}}break;case"transition/remove":case"transition/update":(!e.params.transitionId||typeof e.params.transitionId!="string")&&s.push({code:"INVALID_PARAMS",message:"Transition ID is required and must be a string",path:"params.transitionId"}),e.type==="transition/update"&&e.params.duration!==void 0&&(typeof e.params.duration!="number"||e.params.duration<=0)&&s.push({code:"INVALID_PARAMS",message:"Duration must be a positive number",path:"params.duration"});break}return s}validateAudioAction(e,t){const s=[],i=t.timeline;if(!e.params.clipId||typeof e.params.clipId!="string")return s.push({code:"INVALID_PARAMS",message:"Clip ID is required and must be a string",path:"params.clipId"}),s;const n=this.findClip(i,e.params.clipId);if(!n)return s.push({code:"CLIP_NOT_FOUND",message:`Clip with ID ${e.params.clipId} not found`,path:"params.clipId"}),s;switch(this.findTrack(i,n.trackId)?.locked&&s.push({code:"TRACK_LOCKED",message:`Track containing clip ${e.params.clipId} is locked`,path:"params.clipId"}),e.type){case"audio/setVolume":(typeof e.params.volume!="number"||e.params.volume<0||e.params.volume>4)&&s.push({code:"INVALID_PARAMS",message:"Volume must be a number between 0 and 4",path:"params.volume"});break;case"audio/setFade":e.params.fadeIn!==void 0&&(typeof e.params.fadeIn!="number"||e.params.fadeIn<0)&&s.push({code:"INVALID_PARAMS",message:"Fade-in must be a non-negative number",path:"params.fadeIn"}),e.params.fadeOut!==void 0&&(typeof e.params.fadeOut!="number"||e.params.fadeOut<0)&&s.push({code:"INVALID_PARAMS",message:"Fade-out must be a non-negative number",path:"params.fadeOut"});break;case"audio/addAutomation":Array.isArray(e.params.points)||s.push({code:"INVALID_PARAMS",message:"Automation points must be an array",path:"params.points"});break}return s}validateSubtitleAction(e,t){const s=[];switch(e.type){case"subtitle/import":(!e.params.srtContent||typeof e.params.srtContent!="string")&&s.push({code:"INVALID_PARAMS",message:"SRT content is required and must be a string",path:"params.srtContent"});break;case"subtitle/add":(!e.params.text||typeof e.params.text!="string")&&s.push({code:"INVALID_PARAMS",message:"Subtitle text is required and must be a string",path:"params.text"}),(typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"}),(typeof e.params.endTime!="number"||e.params.endTime<0)&&s.push({code:"INVALID_PARAMS",message:"End time must be a non-negative number",path:"params.endTime"}),typeof e.params.startTime=="number"&&typeof e.params.endTime=="number"&&e.params.endTime<=e.params.startTime&&s.push({code:"INVALID_TIME_RANGE",message:"End time must be greater than start time",path:"params"});break;case"subtitle/update":(!e.params.subtitleId||typeof e.params.subtitleId!="string")&&s.push({code:"INVALID_PARAMS",message:"Subtitle ID is required and must be a string",path:"params.subtitleId"}),e.params.startTime!==void 0&&(typeof e.params.startTime!="number"||e.params.startTime<0)&&s.push({code:"INVALID_PARAMS",message:"Start time must be a non-negative number",path:"params.startTime"}),e.params.endTime!==void 0&&(typeof e.params.endTime!="number"||e.params.endTime<0)&&s.push({code:"INVALID_PARAMS",message:"End time must be a non-negative number",path:"params.endTime"});break;case"subtitle/remove":(!e.params.subtitleId||typeof e.params.subtitleId!="string")&&s.push({code:"INVALID_PARAMS",message:"Subtitle ID is required and must be a string",path:"params.subtitleId"});break;case"subtitle/setStyle":(!e.params.style||typeof e.params.style!="object")&&s.push({code:"INVALID_PARAMS",message:"Style is required and must be an object",path:"params.style"});break}return s}findTrack(e,t){return e.tracks.find(s=>s.id===t)||null}findClip(e,t){for(const s of e.tracks){const i=s.clips.find(n=>n.id===t);if(i)return i}return null}}const YG={"clip/add":()=>"Add clip","clip/remove":()=>"Delete clip","clip/move":()=>"Move clip","clip/trim":()=>"Trim clip","clip/split":()=>"Split clip","clip/rippleDelete":()=>"Ripple delete","clip/duplicate":()=>"Duplicate clip","track/add":r=>`Add ${r.trackType} track`,"track/remove":()=>"Remove track","effect/add":r=>`Add ${r.effectType} effect`,"effect/remove":()=>"Remove effect","effect/update":()=>"Update effect","transform/update":()=>"Transform clip","keyframe/add":r=>`Add ${r.property} keyframe`,"keyframe/remove":()=>"Remove keyframe","transition/add":r=>`Add ${r.transitionType} transition`,"transition/remove":()=>"Remove transition","audio/setVolume":()=>"Adjust volume","audio/setFade":()=>"Adjust fade","subtitle/add":()=>"Add subtitle","subtitle/remove":()=>"Remove subtitle","project/rename":()=>"Rename project","project/updateSettings":()=>"Update settings","media/import":()=>"Import media","media/delete":()=>"Delete media"};function qG(r){const e=YG[r.type];if(e)return e(r.params);const t=r.type.split("/");return`${t[0]}: ${t[1]||"action"}`}class rd{undoStack=[];redoStack=[];maxHistorySize;currentGroupId=null;snapshots=[];listeners=new Set;lastActionTime=0;autoGroupWindow=100;constructor(e=1e3){this.maxHistorySize=e}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}push(e,t=null){const s=Date.now(),i=s-this.lastActionTime;this.lastActionTime=s;const n=i<this.autoGroupWindow&&this.undoStack.length>0&&this.undoStack[this.undoStack.length-1].action.type===e.type;let a=this.currentGroupId;if(n&&!a){a=`auto-${s}`;const l=this.undoStack[this.undoStack.length-1];l.groupId||(this.undoStack[this.undoStack.length-1]={...l,groupId:a})}const o={action:e,inverseAction:t,timestamp:s,description:qG(e),groupId:a||void 0};this.undoStack.push(o),this.redoStack=[],this.snapshots=this.snapshots.filter(l=>l.stackIndex<=this.undoStack.length),this.undoStack.length>this.maxHistorySize&&(this.undoStack.shift(),this.snapshots=this.snapshots.map(l=>({...l,stackIndex:l.stackIndex-1})).filter(l=>l.stackIndex>=0)),this.notify()}beginGroup(e){return this.currentGroupId=`group-${Date.now()}`,this.currentGroupId}endGroup(){this.currentGroupId=null,this.notify()}setAutoGroupWindow(e){this.autoGroupWindow=e}undo(){const e=this.undoStack.pop();return e?(this.redoStack.push(e),this.notify(),e.inverseAction):null}undoGroup(){if(this.undoStack.length===0)return[];const t=this.undoStack[this.undoStack.length-1].groupId;if(!t){const i=this.undo();return i?[i]:[]}const s=[];for(;this.undoStack.length>0&&this.undoStack[this.undoStack.length-1].groupId===t;){const i=this.undo();i&&s.push(i)}return s}redo(){const e=this.redoStack.pop();return e?(this.undoStack.push(e),this.notify(),e.action):null}redoGroup(){if(this.redoStack.length===0)return[];const t=this.redoStack[this.redoStack.length-1].groupId;if(!t){const i=this.redo();return i?[i]:[]}const s=[];for(;this.redoStack.length>0&&this.redoStack[this.redoStack.length-1].groupId===t;){const i=this.redo();i&&s.push(i)}return s}createSnapshot(e){const t={id:`snapshot-${Date.now()}`,name:e,timestamp:Date.now(),stackIndex:this.undoStack.length};return this.snapshots.push(t),this.notify(),t}getSnapshots(){return[...this.snapshots]}deleteSnapshot(e){const t=this.snapshots.findIndex(s=>s.id===e);return t!==-1?(this.snapshots.splice(t,1),this.notify(),!0):!1}getDisplayHistory(){const e=[],t=new Set;for(let s=this.undoStack.length-1;s>=0;s--){const i=this.undoStack[s];i.groupId?t.has(i.groupId)||(t.add(i.groupId),e.push({entry:i,isCurrent:s===this.undoStack.length-1})):e.push({entry:i,isCurrent:s===this.undoStack.length-1})}return e.reverse()}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}getHistory(){return this.undoStack.map(e=>e.action)}getHistoryEntries(){return[...this.undoStack]}getRedoEntries(){return[...this.redoStack]}clear(){this.undoStack=[],this.redoStack=[],this.snapshots=[],this.currentGroupId=null,this.notify()}getUndoStackSize(){return this.undoStack.length}getRedoStackSize(){return this.redoStack.length}peekUndo(){return this.undoStack.length>0?this.undoStack[this.undoStack.length-1]:null}peekRedo(){return this.redoStack.length>0?this.redoStack[this.redoStack.length-1]:null}getMaxHistorySize(){return this.maxHistorySize}setMaxHistorySize(e){for(this.maxHistorySize=e;this.undoStack.length>this.maxHistorySize;)this.undoStack.shift()}}class HG{generate(e,t){const s=e.type;return s.startsWith("project/")?this.generateProjectInverse(e,t):s.startsWith("media/")?this.generateMediaInverse(e,t):s.startsWith("track/")?this.generateTrackInverse(e,t):s.startsWith("clip/")?this.generateClipInverse(e,t):s.startsWith("effect/")?this.generateEffectInverse(e,t):s.startsWith("transform/")?this.generateTransformInverse(e,t):s.startsWith("keyframe/")?this.generateKeyframeInverse(e,t):s.startsWith("transition/")?this.generateTransitionInverse(e,t):s.startsWith("audio/")?this.generateAudioInverse(e,t):s.startsWith("subtitle/")?this.generateSubtitleInverse(e,t):null}createInverseAction(e,t,s){return{type:t,id:`inverse-${e.id}`,timestamp:Date.now(),params:s}}generateProjectInverse(e,t){switch(e.type){case"project/rename":return this.createInverseAction(e,"project/rename",{name:t.name});case"project/updateSettings":return this.createInverseAction(e,"project/updateSettings",{...t.settings});case"project/create":return null}}generateMediaInverse(e,t){switch(e.type){case"media/import":return this.createInverseAction(e,"media/delete",{mediaId:"__LAST_IMPORTED__"});case"media/delete":{const s=t.mediaLibrary.items.find(i=>i.id===e.params.mediaId);return s?this.createInverseAction(e,"media/restore",{mediaItem:this.cloneMediaItem(s)}):null}case"media/rename":{const s=t.mediaLibrary.items.find(i=>i.id===e.params.mediaId);return s?this.createInverseAction(e,"media/rename",{mediaId:e.params.mediaId,name:s.name}):null}}}generateTrackInverse(e,t){const s=t.timeline;switch(e.type){case"track/add":return this.createInverseAction(e,"track/remove",{trackId:"__LAST_ADDED__"});case"track/remove":{const i=s.tracks.find(a=>a.id===e.params.trackId);if(!i)return null;const n=s.tracks.findIndex(a=>a.id===e.params.trackId);return this.createInverseAction(e,"track/restore",{track:this.cloneTrack(i),position:n})}case"track/reorder":{const i=s.tracks.findIndex(n=>n.id===e.params.trackId);return i===-1?null:this.createInverseAction(e,"track/reorder",{trackId:e.params.trackId,newPosition:i})}case"track/lock":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/lock",{trackId:e.params.trackId,locked:i.locked}):null}case"track/hide":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/hide",{trackId:e.params.trackId,hidden:i.hidden}):null}case"track/mute":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/mute",{trackId:e.params.trackId,muted:i.muted}):null}case"track/solo":{const i=s.tracks.find(n=>n.id===e.params.trackId);return i?this.createInverseAction(e,"track/solo",{trackId:e.params.trackId,solo:i.solo}):null}}}generateClipInverse(e,t){const s=t.timeline;switch(e.type){case"clip/add":return this.createInverseAction(e,"clip/remove",{clipId:"__LAST_ADDED__"});case"clip/remove":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/restore",{clip:this.cloneClip(i)}):null}case"clip/move":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/move",{clipId:e.params.clipId,startTime:i.startTime,trackId:i.trackId}):null}case"clip/trim":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/trim",{clipId:e.params.clipId,inPoint:i.inPoint,outPoint:i.outPoint}):null}case"clip/split":{const i=this.findClip(s,e.params.clipId);return i?this.createInverseAction(e,"clip/merge",{clipId:e.params.clipId,originalClip:this.cloneClip(i)}):null}case"clip/rippleDelete":{const i=this.findClip(s,e.params.clipId);if(!i)return null;const a=s.tracks.find(o=>o.id===i.trackId)?.clips.filter(o=>o.startTime>i.startTime).map(o=>({id:o.id,originalStartTime:o.startTime}))||[];return this.createInverseAction(e,"clip/rippleRestore",{clip:this.cloneClip(i),affectedClips:a})}}}generateEffectInverse(e,t){const s=t.timeline,i=this.findClip(s,e.params.clipId);if(!i)return null;switch(e.type){case"effect/add":return this.createInverseAction(e,"effect/remove",{clipId:e.params.clipId,effectId:"__LAST_ADDED__"});case"effect/remove":{const n=i.effects.find(o=>o.id===e.params.effectId);if(!n)return null;const a=i.effects.findIndex(o=>o.id===e.params.effectId);return this.createInverseAction(e,"effect/restore",{clipId:e.params.clipId,effect:{...n},index:a})}case"effect/update":{const n=i.effects.find(a=>a.id===e.params.effectId);return n?this.createInverseAction(e,"effect/update",{clipId:e.params.clipId,effectId:e.params.effectId,params:{...n.params}}):null}case"effect/reorder":{const n=i.effects.findIndex(a=>a.id===e.params.effectId);return n===-1?null:this.createInverseAction(e,"effect/reorder",{clipId:e.params.clipId,effectId:e.params.effectId,newIndex:n})}}}generateTransformInverse(e,t){const s=this.findClip(t.timeline,e.params.clipId);return s?this.createInverseAction(e,"transform/update",{clipId:e.params.clipId,transform:{...s.transform}}):null}generateKeyframeInverse(e,t){const s=this.findClip(t.timeline,e.params.clipId);if(!s)return null;switch(e.type){case"keyframe/add":return this.createInverseAction(e,"keyframe/remove",{clipId:e.params.clipId,property:e.params.property,time:e.params.time});case"keyframe/remove":{const i=s.keyframes.find(n=>n.property===e.params.property&&n.time===e.params.time);return i?this.createInverseAction(e,"keyframe/add",{clipId:e.params.clipId,property:i.property,time:i.time,value:i.value}):null}case"keyframe/update":{const i=s.keyframes.find(n=>n.property===e.params.property&&n.time===e.params.time);return i?this.createInverseAction(e,"keyframe/update",{clipId:e.params.clipId,property:i.property,time:i.time,value:i.value,easing:i.easing}):null}}}generateTransitionInverse(e,t){const s=t.timeline;switch(e.type){case"transition/add":return this.createInverseAction(e,"transition/remove",{transitionId:"__LAST_ADDED__"});case"transition/remove":{const i=this.findTransition(s,e.params.transitionId);return i?this.createInverseAction(e,"transition/restore",{transition:{...i}}):null}case"transition/update":{const i=this.findTransition(s,e.params.transitionId);return i?this.createInverseAction(e,"transition/update",{transitionId:e.params.transitionId,duration:i.duration,params:{...i.params}}):null}}}generateAudioInverse(e,t){const s=this.findClip(t.timeline,e.params.clipId);if(!s)return null;switch(e.type){case"audio/setVolume":return this.createInverseAction(e,"audio/setVolume",{clipId:e.params.clipId,volume:s.volume});case"audio/setFade":return this.createInverseAction(e,"audio/setFade",{clipId:e.params.clipId,fadeIn:s.fade?.fadeIn??0,fadeOut:s.fade?.fadeOut??0});case"audio/addAutomation":return this.createInverseAction(e,"audio/addAutomation",{clipId:e.params.clipId,points:s.automation?.volume??[]})}}generateSubtitleInverse(e,t){const s=t.timeline;switch(e.type){case"subtitle/import":return this.createInverseAction(e,"subtitle/restoreAll",{subtitles:s.subtitles.map(i=>({...i}))});case"subtitle/add":return this.createInverseAction(e,"subtitle/remove",{subtitleId:"__LAST_ADDED__"});case"subtitle/remove":{const i=s.subtitles.find(n=>n.id===e.params.subtitleId);return i?this.createInverseAction(e,"subtitle/restore",{subtitle:{...i}}):null}case"subtitle/update":{const i=s.subtitles.find(n=>n.id===e.params.subtitleId);return i?this.createInverseAction(e,"subtitle/update",{subtitleId:e.params.subtitleId,text:i.text,startTime:i.startTime,endTime:i.endTime}):null}case"subtitle/setStyle":{const i=s.subtitles[0];return this.createInverseAction(e,"subtitle/setStyle",{style:i?.style??null})}}}findClip(e,t){for(const s of e.tracks){const i=s.clips.find(n=>n.id===t);if(i)return i}return null}findTransition(e,t){for(const s of e.tracks){const i=s.transitions?.find(n=>n.id===t);if(i)return i}return null}cloneMediaItem(e){return{id:e.id,name:e.name,type:e.type,fileHandle:e.fileHandle,blob:e.blob,metadata:{...e.metadata},thumbnailUrl:e.thumbnailUrl,waveformData:e.waveformData?new Float32Array(e.waveformData):null}}cloneTrack(e){return{id:e.id,type:e.type,name:e.name,clips:e.clips.map(t=>this.cloneClip(t)),transitions:e.transitions?.map(t=>({...t}))??[],locked:e.locked,hidden:e.hidden,muted:e.muted,solo:e.solo}}cloneClip(e){return{id:e.id,mediaId:e.mediaId,trackId:e.trackId,startTime:e.startTime,duration:e.duration,inPoint:e.inPoint,outPoint:e.outPoint,effects:e.effects.map(t=>({...t,params:{...t.params}})),transform:{...e.transform},volume:e.volume,fade:e.fade?{...e.fade}:void 0,automation:e.automation?{volume:e.automation.volume?.map(t=>({...t})),pan:e.automation.pan?.map(t=>({...t}))}:void 0,keyframes:e.keyframes.map(t=>({...t}))}}}class Xu{validator;history;inverseGenerator;lastAddedIds=new Map;constructor(e){this.validator=new WG,this.history=e||new rd,this.inverseGenerator=new HG}async execute(e,t){const s=this.validator.validate(e,t);if(!s.valid)return{success:!1,error:{code:"INVALID_PARAMS",message:s.errors.map(a=>a.message).join("; "),details:{errors:s.errors}}};const i=JSON.parse(JSON.stringify(t)),n=this.inverseGenerator.generate(e,i);try{return await this.applyAction(e,t),this.history.push(e,n),{success:!0,actionId:e.id}}catch(a){return{success:!1,error:{code:"INVALID_PARAMS",message:a instanceof Error?a.message:"Unknown error occurred"}}}}async executeMany(e,t){const s=[];for(const i of e){const n=await this.execute(i,t);if(s.push(n),!n.success)break}return s}async undo(e){if(!this.history.canUndo())return{success:!1,error:{code:"INVALID_PARAMS",message:"Nothing to undo"}};const t=this.history.undoGroup();if(t.length===0)return{success:!1,error:{code:"INVALID_PARAMS",message:"No inverse action available"}};try{for(const s of t){const i=this.resolveSpecialMarkers(s);await this.applyAction(i,e)}return{success:!0,actionId:t[0].id}}catch(s){return{success:!1,error:{code:"INVALID_PARAMS",message:s instanceof Error?s.message:"Undo failed"}}}}async redo(e){if(!this.history.canRedo())return{success:!1,error:{code:"INVALID_PARAMS",message:"Nothing to redo"}};const t=this.history.redoGroup();if(t.length===0)return{success:!1,error:{code:"INVALID_PARAMS",message:"No action to redo"}};try{for(const s of t)await this.applyAction(s,e);return{success:!0,actionId:t[0].id}}catch(s){return{success:!1,error:{code:"INVALID_PARAMS",message:s instanceof Error?s.message:"Redo failed"}}}}getHistory(){return this.history}resolveSpecialMarkers(e){const t={...e.params};for(const[s,i]of Object.entries(t))if(i==="__LAST_ADDED__"){const n=this.lastAddedIds.get(e.type.split("/")[0]);n&&(t[s]=n)}return{...e,params:t}}async applyAction(e,t){const s=e.type;s.startsWith("project/")?this.applyProjectAction(e,t):s.startsWith("media/")?await this.applyMediaAction(e,t):s.startsWith("track/")?this.applyTrackAction(e,t):s.startsWith("clip/")?this.applyClipAction(e,t):s.startsWith("effect/")?this.applyEffectAction(e,t):s.startsWith("transform/")?this.applyTransformAction(e,t):s.startsWith("keyframe/")?this.applyKeyframeAction(e,t):s.startsWith("transition/")?this.applyTransitionAction(e,t):s.startsWith("audio/")?this.applyAudioAction(e,t):s.startsWith("subtitle/")&&this.applySubtitleAction(e,t)}applyProjectAction(e,t){switch(e.type){case"project/rename":t.name=e.params.name,t.modifiedAt=Date.now();break;case"project/updateSettings":t.settings={...t.settings,...e.params},t.modifiedAt=Date.now();break;case"project/create":t.name=e.params.name,t.settings=e.params.settings,t.modifiedAt=Date.now();break}}async applyMediaAction(e,t){const s=t.mediaLibrary;switch(e.type){case"media/import":{const i=e.params,n={id:`media-${Date.now()}`,name:i.file.name,type:this.inferMediaType(i.file),fileHandle:null,blob:i.file,metadata:{duration:0,width:0,height:0,frameRate:0,codec:"",sampleRate:0,channels:0,fileSize:i.file.size},thumbnailUrl:null,waveformData:null};s.items=[...s.items,n],this.lastAddedIds.set("media",n.id);break}case"media/delete":{const i=e.params;s.items=s.items.filter(n=>n.id!==i.mediaId);break}case"media/rename":{const i=e.params;s.items=s.items.map(n=>n.id===i.mediaId?{...n,name:i.name}:n);break}case"media/restore":{const i=e.params;s.items=[...s.items,i.mediaItem];break}}}inferMediaType(e){return e.type.startsWith("video/")?"video":e.type.startsWith("audio/")?"audio":e.type.startsWith("image/")?"image":"video"}applyTrackAction(e,t){const s=t.timeline;switch(e.type){case"track/add":{const i=e.params,n={video:"Video",audio:"Audio",image:"Image",text:"Text",graphics:"Graphics"},a=s.tracks.filter(d=>d.type===i.trackType).length+1,o={id:`track-${Date.now()}`,type:i.trackType,name:`${n[i.trackType]||i.trackType} ${a}`,clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},l=i.position!==void 0?i.position:s.tracks.length;s.tracks=[...s.tracks.slice(0,l),o,...s.tracks.slice(l)],this.lastAddedIds.set("track",o.id);break}case"track/remove":{const i=e.params;s.tracks=s.tracks.filter(n=>n.id!==i.trackId);break}case"track/restore":{const i=e.params;s.tracks=[...s.tracks.slice(0,i.position),i.track,...s.tracks.slice(i.position)];break}case"track/reorder":{const i=e.params,n=s.tracks.findIndex(a=>a.id===i.trackId);if(n!==-1){const[a]=s.tracks.splice(n,1);s.tracks.splice(i.newPosition,0,a)}break}case"track/lock":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,locked:i.locked}:n);break}case"track/hide":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,hidden:i.hidden}:n);break}case"track/mute":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,muted:i.muted}:n);break}case"track/solo":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.trackId?{...n,solo:i.solo}:n);break}}}applyClipAction(e,t){const s=t.timeline;switch(e.type){case"clip/add":{const i=e.params,n=s.tracks.find(a=>a.id===i.trackId);if(n){const a=t.mediaLibrary.items.find(d=>d.id===i.mediaId),o=i.duration??(a?.metadata.duration&&a.metadata.duration>0?a.metadata.duration:5),l={id:`clip-${Date.now()}`,mediaId:i.mediaId,trackId:i.trackId,startTime:i.startTime,duration:o,inPoint:0,outPoint:o,effects:[],audioEffects:[],transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},volume:1,keyframes:[]};n.clips=[...n.clips,l],this.lastAddedIds.set("clip",l.id)}break}case"clip/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.filter(a=>a.id!==i.clipId)}));break}case"clip/restore":{const i=e.params;s.tracks=s.tracks.map(n=>n.id===i.clip.trackId?{...n,clips:[...n.clips,i.clip]}:n);break}case"clip/move":{const i=e.params,n=this.findClip(s,i.clipId);if(n){s.tracks=s.tracks.map(o=>({...o,clips:o.clips.filter(l=>l.id!==i.clipId)}));const a=i.trackId||n.trackId;s.tracks=s.tracks.map(o=>o.id===a?{...o,clips:[...o.clips,{...n,startTime:i.startTime,trackId:a}]}:o)}break}case"clip/trim":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>{if(a.id===i.clipId){const o={};return i.inPoint!==void 0&&(o.inPoint=i.inPoint,o.duration=a.outPoint-i.inPoint),i.outPoint!==void 0&&(o.outPoint=i.outPoint,o.duration=i.outPoint-a.inPoint),{...a,...o}}return a})}));break}case"clip/split":{const i=e.params,n=this.findClip(s,i.clipId);if(n){const a=i.time,o=a-n.startTime,l={...n,duration:o,outPoint:n.inPoint+o},d={...n,id:`clip-${Date.now()}`,startTime:a,duration:n.duration-o,inPoint:n.inPoint+o};s.tracks=s.tracks.map(u=>({...u,clips:u.clips.flatMap(h=>h.id===i.clipId?[l,d]:[h])})),this.lastAddedIds.set("clip",d.id)}break}case"clip/merge":{const i=e.params,n=i.originalClip.startTime,a=n+i.originalClip.duration,o=i.originalClip.mediaId;s.tracks=s.tracks.map(l=>{if(l.id===i.originalClip.trackId){const d=l.clips.filter(u=>{if(u.id===i.clipId)return!1;if(u.mediaId===o){const h=u.startTime+u.duration;if(u.startTime>=n&&h<=a)return!1}return!0});return{...l,clips:[...d,i.originalClip]}}return l});break}case"clip/rippleDelete":{const i=e.params,n=this.findClip(s,i.clipId);if(n){const a=n.duration,o=n.startTime;s.tracks=s.tracks.map(l=>l.id===n.trackId?{...l,clips:l.clips.filter(d=>d.id!==i.clipId).map(d=>d.startTime>o?{...d,startTime:d.startTime-a}:d)}:l)}break}case"clip/rippleRestore":{const i=e.params;s.tracks=s.tracks.map(n=>{if(n.id===i.clip.trackId){const a=n.clips.map(o=>{const l=i.affectedClips.find(d=>d.id===o.id);return l?{...o,startTime:l.originalStartTime}:o});return{...n,clips:[...a,i.clip]}}return n});break}case"clip/slip":{const i=e.params,n=this.findClip(s,i.clipId);if(n){const a=Math.max(0,n.inPoint+i.delta),o=a+n.duration;s.tracks=s.tracks.map(l=>({...l,clips:l.clips.map(d=>d.id===i.clipId?{...d,inPoint:a,outPoint:o}:d)}))}break}case"clip/slide":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,startTime:Math.max(0,a.startTime+i.delta)}:a.id===i.prevClipId&&i.delta>0?{...a,duration:a.duration+i.delta}:a.id===i.nextClipId&&i.delta<0?{...a,startTime:a.startTime+i.delta,inPoint:a.inPoint-i.delta,duration:a.duration-i.delta}:a)}));break}case"clip/roll":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.leftClipId?{...a,duration:a.duration+i.delta,outPoint:a.outPoint+i.delta}:a.id===i.rightClipId?{...a,startTime:a.startTime+i.delta,inPoint:a.inPoint+i.delta,duration:a.duration-i.delta}:a)}));break}case"clip/trimToPlayhead":{const i=e.params;this.findClip(s,i.clipId)&&(s.tracks=s.tracks.map(a=>({...a,clips:a.clips.map(o=>{if(o.id!==i.clipId)return o;if(i.trimStart){const l=i.playheadTime-o.startTime;return{...o,startTime:i.playheadTime,inPoint:o.inPoint+l,duration:o.duration-l}}else return{...o,duration:i.playheadTime-o.startTime,outPoint:o.inPoint+(i.playheadTime-o.startTime)}})})));break}}}applyEffectAction(e,t){const s=t.timeline;switch(e.type){case"effect/add":{const i=e.params,n={id:`effect-${Date.now()}`,type:i.effectType,params:i.params||{},enabled:!0};s.tracks=s.tracks.map(a=>({...a,clips:a.clips.map(o=>o.id===i.clipId?{...o,effects:[...o.effects,n]}:o)})),this.lastAddedIds.set("effect",n.id);break}case"effect/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,effects:a.effects.filter(o=>o.id!==i.effectId)}:a)}));break}case"effect/restore":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>{if(a.id===i.clipId){const o=[...a.effects];return o.splice(i.index,0,i.effect),{...a,effects:o}}return a})}));break}case"effect/update":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,effects:a.effects.map(o=>o.id===i.effectId?{...o,params:{...o.params,...i.params}}:o)}:a)}));break}case"effect/reorder":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>{if(a.id===i.clipId){const o=[...a.effects],l=o.findIndex(d=>d.id===i.effectId);if(l!==-1){const[d]=o.splice(l,1);o.splice(i.newIndex,0,d)}return{...a,effects:o}}return a})}));break}}}applyTransformAction(e,t){const s=t.timeline;s.tracks=s.tracks.map(i=>({...i,clips:i.clips.map(n=>n.id===e.params.clipId?{...n,transform:{...n.transform,...e.params.transform}}:n)}))}applyKeyframeAction(e,t){const s=t.timeline;switch(e.type){case"keyframe/add":{const i=e.params,n={id:`keyframe-${Date.now()}`,time:i.time,property:i.property,value:i.value,easing:"linear"};s.tracks=s.tracks.map(a=>({...a,clips:a.clips.map(o=>o.id===i.clipId?{...o,keyframes:[...o.keyframes,n]}:o)})),this.lastAddedIds.set("keyframe",n.id);break}case"keyframe/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,keyframes:a.keyframes.filter(o=>!(o.property===i.property&&o.time===i.time))}:a)}));break}case"keyframe/update":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,keyframes:a.keyframes.map(o=>o.property===i.property&&o.time===i.time?{...o,...i.value!==void 0&&{value:i.value},...i.easing!==void 0&&{easing:i.easing}}:o)}:a)}));break}}}applyTransitionAction(e,t){const s=t.timeline;switch(e.type){case"transition/add":{const i=e.params,n=this.findClip(s,i.clipAId);if(n){const a=s.tracks.find(o=>o.id===n.trackId);if(a){const o={id:`transition-${Date.now()}`,clipAId:i.clipAId,clipBId:i.clipBId,type:i.transitionType,duration:i.duration,params:{}};a.transitions=[...a.transitions||[],o],this.lastAddedIds.set("transition",o.id)}}break}case"transition/remove":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,transitions:(n.transitions||[]).filter(a=>a.id!==i.transitionId)}));break}case"transition/restore":{const i=e.params,n=this.findClip(s,i.transition.clipAId);n&&(s.tracks=s.tracks.map(a=>a.id===n.trackId?{...a,transitions:[...a.transitions||[],i.transition]}:a));break}case"transition/update":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,transitions:(n.transitions||[]).map(a=>a.id===i.transitionId?{...a,...i.duration!==void 0&&{duration:i.duration},...i.params!==void 0&&{params:{...a.params,...i.params}}}:a)}));break}}}applyAudioAction(e,t){const s=t.timeline;switch(e.type){case"audio/setVolume":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,volume:i.volume}:a)}));break}case"audio/setFade":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,fade:{fadeIn:i.fadeIn!==void 0?i.fadeIn:a.fade?.fadeIn||0,fadeOut:i.fadeOut!==void 0?i.fadeOut:a.fade?.fadeOut||0}}:a)}));break}case"audio/addAutomation":{const i=e.params;s.tracks=s.tracks.map(n=>({...n,clips:n.clips.map(a=>a.id===i.clipId?{...a,automation:{...a.automation,volume:i.points}}:a)}));break}}}applySubtitleAction(e,t){const s=t.timeline;switch(e.type){case"subtitle/add":{const i=e.params,n={id:`subtitle-${Date.now()}`,text:i.text,startTime:i.startTime,endTime:i.endTime};s.subtitles=[...s.subtitles||[],n],this.lastAddedIds.set("subtitle",n.id);break}case"subtitle/remove":{const i=e.params;s.subtitles=(s.subtitles||[]).filter(n=>n.id!==i.subtitleId);break}case"subtitle/restore":{const i=e.params;s.subtitles=[...s.subtitles||[],i.subtitle];break}case"subtitle/restoreAll":{const i=e.params;s.subtitles=i.subtitles;break}case"subtitle/update":{const i=e.params;s.subtitles=(s.subtitles||[]).map(n=>n.id===i.subtitleId?{...n,...i.text!==void 0&&{text:i.text},...i.startTime!==void 0&&{startTime:i.startTime},...i.endTime!==void 0&&{endTime:i.endTime}}:n);break}case"subtitle/setStyle":{const i=e.params;s.subtitles=(s.subtitles||[]).map(n=>({...n,style:i.style}));break}case"subtitle/import":{const i=e.params,n=/(\d+)\n(\d{2}:\d{2}:\d{2},\d{3}) --> (\d{2}:\d{2}:\d{2},\d{3})\n([\s\S]*?)(?=\n\n|\n*$)/g;let a;const o=[];for(;(a=n.exec(i.srtContent))!==null;){const l=this.parseSrtTime(a[2]),d=this.parseSrtTime(a[3]),u=a[4].trim();o.push({id:`subtitle-${Date.now()}-${a[1]}`,text:u,startTime:l,endTime:d})}o.length>0&&(s.subtitles=[...s.subtitles||[],...o]);break}}}parseSrtTime(e){const[t,s]=e.split(","),[i,n,a]=t.split(":").map(Number);return i*3600+n*60+a+Number(s)/1e3}findClip(e,t){for(const s of e.tracks){const i=s.clips.find(n=>n.id===t);if(i)return i}return null}}const XG=1,KG="openreel-db",tt={PROJECTS:"projects",MEDIA:"media",CACHE:"cache",WAVEFORMS:"waveforms"};function Bn(r,e,t){return{code:r,message:e,quotaInfo:t}}class fM{db=null;dbPromise=null;async getDb(){return this.db?this.db:this.dbPromise?this.dbPromise:(this.dbPromise=this.openDatabase(),this.db=await this.dbPromise,this.db)}openDatabase(){return new Promise((e,t)=>{if(typeof indexedDB>"u"){t(Bn("BROWSER_NOT_SUPPORTED","IndexedDB is not supported in this environment"));return}const s=indexedDB.open(KG,XG);s.onerror=()=>{t(Bn("DATABASE_ERROR",`Failed to open database: ${s.error?.message}`))},s.onsuccess=()=>{e(s.result)},s.onupgradeneeded=i=>{const n=i.target.result;this.createStores(n)}})}createStores(e){if(!e.objectStoreNames.contains(tt.PROJECTS)){const t=e.createObjectStore(tt.PROJECTS,{keyPath:"id"});t.createIndex("modifiedAt","modifiedAt",{unique:!1}),t.createIndex("name","name",{unique:!1})}e.objectStoreNames.contains(tt.MEDIA)||e.createObjectStore(tt.MEDIA,{keyPath:"id"}).createIndex("projectId","projectId",{unique:!1}),e.objectStoreNames.contains(tt.CACHE)||e.createObjectStore(tt.CACHE,{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1}),e.objectStoreNames.contains(tt.WAVEFORMS)||e.createObjectStore(tt.WAVEFORMS,{keyPath:"mediaId"})}async transaction(e,t,s){const i=await this.getDb();return new Promise((n,a)=>{const o=i.transaction(e,t),l={},d=Array.isArray(e)?e:[e];for(const h of d)l[h]=o.objectStore(h);const u=s(l);u.onsuccess=()=>n(u.result),u.onerror=()=>a(Bn("DATABASE_ERROR",`Transaction failed: ${u.error?.message}`))})}async transactionGetAll(e,t,s){const i=await this.getDb();return new Promise((n,a)=>{const l=i.transaction(e,"readonly").objectStore(e),d=t?l.index(t):l,u=s?d.getAll(s):d.getAll();u.onsuccess=()=>n(u.result),u.onerror=()=>a(Bn("DATABASE_ERROR",`Failed to get all: ${u.error?.message}`))})}async saveProject(e){try{const t=UG(e),s={id:e.id,name:e.name,createdAt:e.createdAt,modifiedAt:e.modifiedAt,data:t};await this.transaction(tt.PROJECTS,"readwrite",i=>i[tt.PROJECTS].put(s))}catch(t){throw t.code?t:Bn("SERIALIZATION_FAILED",`Failed to serialize project: ${t.message}`)}}async loadProject(e){try{const t=await this.transaction(tt.PROJECTS,"readonly",s=>s[tt.PROJECTS].get(e));return t?GG(t.data):null}catch(t){throw t.code?t:Bn("DESERIALIZATION_FAILED",`Failed to deserialize project: ${t.message}`)}}async listProjects(){return(await this.transactionGetAll(tt.PROJECTS)).map(t=>({id:t.id,name:t.name,createdAt:t.createdAt,modifiedAt:t.modifiedAt})).sort((t,s)=>s.modifiedAt-t.modifiedAt)}async deleteProject(e){const t=await this.getDb(),s=await this.getMediaByProject(e);for(const i of s)await this.deleteMedia(i.id);return new Promise((i,n)=>{const l=t.transaction(tt.PROJECTS,"readwrite").objectStore(tt.PROJECTS).delete(e);l.onsuccess=()=>i(),l.onerror=()=>n(Bn("DATABASE_ERROR",`Failed to delete project: ${l.error?.message}`))})}async saveMedia(e){await this.transaction(tt.MEDIA,"readwrite",t=>t[tt.MEDIA].put(e))}async loadMedia(e){return await this.transaction(tt.MEDIA,"readonly",s=>s[tt.MEDIA].get(e))||null}async deleteMedia(e){await this.deleteWaveform(e),await this.transaction(tt.MEDIA,"readwrite",t=>t[tt.MEDIA].delete(e))}async getMediaByProject(e){return this.transactionGetAll(tt.MEDIA,"projectId",e)}async saveCache(e){await this.transaction(tt.CACHE,"readwrite",t=>t[tt.CACHE].put(e))}async loadCache(e){const t=await this.transaction(tt.CACHE,"readonly",s=>s[tt.CACHE].get(e));if(t){const s={...t,timestamp:Date.now()};return await this.saveCache(s),s}return null}async deleteCache(e){await this.transaction(tt.CACHE,"readwrite",t=>t[tt.CACHE].delete(e))}async clearCache(){const e=await this.getDb();return new Promise((t,s)=>{const a=e.transaction(tt.CACHE,"readwrite").objectStore(tt.CACHE).clear();a.onsuccess=()=>t(),a.onerror=()=>s(Bn("DATABASE_ERROR",`Failed to clear cache: ${a.error?.message}`))})}async saveWaveform(e){await this.transaction(tt.WAVEFORMS,"readwrite",t=>t[tt.WAVEFORMS].put(e))}async loadWaveform(e){return await this.transaction(tt.WAVEFORMS,"readonly",s=>s[tt.WAVEFORMS].get(e))||null}async deleteWaveform(e){await this.transaction(tt.WAVEFORMS,"readwrite",t=>t[tt.WAVEFORMS].delete(e))}async getStorageUsage(){const e=await this.getDb(),t=await new Promise((a,o)=>{const u=e.transaction(tt.PROJECTS,"readonly").objectStore(tt.PROJECTS).count();u.onsuccess=()=>a(u.result),u.onerror=()=>o(u.error)}),s=await new Promise((a,o)=>{const u=e.transaction(tt.MEDIA,"readonly").objectStore(tt.MEDIA).count();u.onsuccess=()=>a(u.result),u.onerror=()=>o(u.error)});let i=0,n=0;if(navigator.storage&&navigator.storage.estimate)try{const a=await navigator.storage.estimate();i=a.usage||0,n=a.quota||0}catch{}return{used:i,quota:n,projects:t,mediaItems:s}}close(){this.db&&(this.db.close(),this.db=null,this.dbPromise=null)}}function QG(){return new fM}const Dl="1.0.0";class JG{storage;constructor(e){this.storage=e}async saveProject(e){await this.saveMediaBlobs(e);const t={...e,modifiedAt:Date.now()};await this.storage.saveProject(t)}async loadProject(e){const t=await this.storage.loadProject(e);return t?await this.restoreMediaBlobs(t):null}exportToJson(e){const t={version:Dl,project:this.stripMediaBlobs(e)};return JSON.stringify(t,null,2)}importFromJson(e){const t=JSON.parse(e);if(t.version!==Dl)return this.migrateProject(t);const s=t.project,i=s.mediaLibrary.items.map(n=>n.blob?n:{...n,isPlaceholder:!0,originalUrl:n.thumbnailUrl||void 0});return{...s,mediaLibrary:{items:i}}}exportToJsonWithMetadata(e,t){const s={version:Dl,project:this.stripMediaBlobs(e),metadata:{exportedAt:Date.now(),description:t}};return JSON.stringify(s,null,2)}validateProjectJson(e){const t={valid:!0,errors:[],warnings:[],missingAssets:[]};try{const s=JSON.parse(e);if(s.version?s.version!==Dl&&t.warnings.push(`Version mismatch: expected ${Dl}, got ${s.version}`):(t.errors.push("Missing version field"),t.valid=!1),!s.project)return t.errors.push("Missing project field"),t.valid=!1,t;const i=s.project;if(i.id||(t.errors.push("Missing project.id"),t.valid=!1),i.name||(t.errors.push("Missing project.name"),t.valid=!1),i.settings||(t.errors.push("Missing project.settings"),t.valid=!1),i.timeline||(t.errors.push("Missing project.timeline"),t.valid=!1),i.mediaLibrary||(t.errors.push("Missing project.mediaLibrary"),t.valid=!1),!t.valid)return t;const n=new Set(i.mediaLibrary.items.map(a=>a.id));for(const a of i.mediaLibrary.items)!a.blob&&!a.thumbnailUrl&&t.missingAssets.push(a.id);if(i.timeline.tracks){for(const a of i.timeline.tracks)if(a.clips)for(const o of a.clips)o.mediaId&&!n.has(o.mediaId)&&(t.errors.push(`Clip ${o.id} references non-existent mediaId: ${o.mediaId}`),t.valid=!1)}t.missingAssets&&t.missingAssets.length>0&&t.warnings.push(`${t.missingAssets.length} asset(s) need replacement`)}catch(s){t.errors.push(`Invalid JSON: ${s instanceof Error?s.message:"Parse error"}`),t.valid=!1}return t}importFromJsonWithValidation(e){const t=this.validateProjectJson(e);return t.valid?{project:this.importFromJson(e),validation:t}:{project:null,validation:t}}async saveMediaBlobs(e){for(const t of e.mediaLibrary.items)if(t.blob){const s={id:t.id,projectId:e.id,blob:t.blob,metadata:t.metadata};await this.storage.saveMedia(s)}}async restoreMediaBlobs(e){const t=[];for(const s of e.mediaLibrary.items){const i=await this.storage.loadMedia(s.id);i?t.push({...s,blob:i.blob,metadata:i.metadata}):t.push(s)}return{...e,mediaLibrary:{items:t}}}stripMediaBlobs(e){const t=e.mediaLibrary.items.map(s=>({...s,blob:null,fileHandle:null,waveformData:null}));return{...e,mediaLibrary:{items:t}}}migrateProject(e){return e.project}async deleteProject(e){await this.storage.deleteProject(e)}async listProjects(){return this.storage.listProjects()}}function ZG(r){return new JG(r)}const nC=["#8b5cf6","#ec4899","#f97316","#22c55e","#06b6d4","#3b82f6","#eab308","#ef4444"];function aC(){return`compound_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}class e9{compoundClips=new Map;instances=new Map;instancesByCompound=new Map;colorIndex=0;createCompoundClip(e,t,s={}){if(e.length===0)throw new Error("Cannot create compound clip from empty selection");const i=Math.min(...e.map(h=>h.startTime)),a=Math.max(...e.map(h=>h.startTime+h.duration))-i,o=e.map(h=>({...h,startTime:h.startTime-i})),l=new Set(e.map(h=>h.trackId)),d=t.filter(h=>l.has(h.id)),u={id:aC(),name:s.name||`Compound Clip ${this.compoundClips.size+1}`,content:{clips:o,tracks:d,duration:a},createdAt:Date.now(),modifiedAt:Date.now(),color:s.color||nC[this.colorIndex++%nC.length]};return this.compoundClips.set(u.id,u),this.instancesByCompound.set(u.id,new Set),u}getCompoundClip(e){return this.compoundClips.get(e)}getAllCompoundClips(){return Array.from(this.compoundClips.values())}updateCompoundClip(e,t){const s=this.compoundClips.get(e);return s?(this.compoundClips.set(e,{...s,content:t,modifiedAt:Date.now()}),!0):!1}renameCompoundClip(e,t){const s=this.compoundClips.get(e);return s?(this.compoundClips.set(e,{...s,name:t,modifiedAt:Date.now()}),!0):!1}deleteCompoundClip(e){const t=this.instancesByCompound.get(e);return t&&t.size>0?!1:(this.instancesByCompound.delete(e),this.compoundClips.delete(e))}createInstance(e,t,s){const i=this.compoundClips.get(e);if(!i)return null;const n={id:`instance_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,compoundClipId:e,trackId:t,startTime:s,duration:i.content.duration,inPoint:0,outPoint:i.content.duration,transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},volume:1};return this.instances.set(n.id,n),this.instancesByCompound.get(e)?.add(n.id),n}getInstance(e){return this.instances.get(e)}getInstancesForCompound(e){const t=this.instancesByCompound.get(e);return t?Array.from(t).map(s=>this.instances.get(s)).filter(s=>s!==void 0):[]}getAllInstances(){return Array.from(this.instances.values())}updateInstance(e,t){const s=this.instances.get(e);return s?(this.instances.set(e,{...s,...t,id:s.id,compoundClipId:s.compoundClipId}),!0):!1}deleteInstance(e){const t=this.instances.get(e);return t?(this.instancesByCompound.get(t.compoundClipId)?.delete(e),this.instances.delete(e)):!1}flattenInstance(e){const t=this.instances.get(e);if(!t)return null;const s=this.compoundClips.get(t.compoundClipId);if(!s)return null;const i=s.content.clips.map(n=>({...n,id:`flat_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,startTime:t.startTime+n.startTime,trackId:t.trackId}));return this.deleteInstance(e),{clips:i,trackId:t.trackId,startTime:t.startTime}}duplicateCompoundClip(e,t){const s=this.compoundClips.get(e);if(!s)return null;const i={...s,id:aC(),name:t||`${s.name} (Copy)`,createdAt:Date.now(),modifiedAt:Date.now()};return this.compoundClips.set(i.id,i),this.instancesByCompound.set(i.id,new Set),i}getCompoundClipForInstance(e){const t=this.instances.get(e);if(t)return this.compoundClips.get(t.compoundClipId)}getInstanceCount(e){return this.instancesByCompound.get(e)?.size||0}clearAll(){this.compoundClips.clear(),this.instances.clear(),this.instancesByCompound.clear(),this.colorIndex=0}}const mM=["video/mp4","video/webm","video/quicktime","video/x-matroska"],gM=["audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/aac","audio/flac","audio/webm"],yM=["image/jpeg","image/png","image/webp","image/gif"];function xM(r){const e=r.split(";")[0].trim();return mM.includes(e)||gM.includes(e)||yM.includes(e)}function oC(r){const e=r.split(";")[0].trim();return mM.includes(e)?"video":gM.includes(e)?"audio":yM.includes(e)?"image":null}class t9{input=null;sink=null;mediabunny;file;width;initialized=!1;constructor(e,t,s){this.mediabunny=e,this.file=t,this.width=s}async initialize(){if(this.initialized)return!0;const{Input:e,ALL_FORMATS:t,BlobSource:s,CanvasSink:i}=this.mediabunny;this.input=new e({source:new s(this.file),formats:t});const n=await this.input.getPrimaryVideoTrack();if(!n)return this.dispose(),!1;if(!await n.canDecode())return this.dispose(),!1;const o={poolSize:2};if(this.width){const l=n.displayHeight/n.displayWidth;o.width=this.width,o.height=Math.round(this.width*l),o.fit="contain"}return this.sink=new i(n,o),this.initialized=!0,!0}async getFrame(e){if(!this.sink)return null;const t=await this.sink.getCanvas(e);if(!t)return null;const s=new OffscreenCanvas(t.canvas.width,t.canvas.height),i=s.getContext("2d");return i&&i.drawImage(t.canvas,0,0),s}dispose(){this.input&&(this.input[Symbol.dispose]?.(),this.input=null),this.sink=null,this.initialized=!1}}class s9{initialized=!1;mediabunny=null;frameCache=new Map;MAX_CACHE_SIZE=50;exportDecoders=new Map;async initialize(){if(!this.initialized)try{this.mediabunny=await _i(()=>import("./index5.js"),[]),this.initialized=!0}catch{throw console.warn("MediaBunny not available, will use fallback"),new Error("MediaBunny initialization failed")}}isAvailable(){return this.initialized&&this.mediabunny!==null}clearFrameCache(){this.frameCache.clear()}getFrameCacheSize(){return this.frameCache.size}async createExportDecoder(e,t,s){this.ensureInitialized();const i=this.exportDecoders.get(e);if(i)return i;const n=new t9(this.mediabunny,t,s);return await n.initialize()?(this.exportDecoders.set(e,n),n):null}getExportDecoder(e){return this.exportDecoders.get(e)||null}disposeExportDecoder(e){const t=this.exportDecoders.get(e);t&&(t.dispose(),this.exportDecoders.delete(e))}disposeAllExportDecoders(){for(const e of this.exportDecoders.values())e.dispose();this.exportDecoders.clear()}ensureInitialized(){if(!this.mediabunny)throw new Error("MediaBunny not initialized. Call initialize() first.")}async createInput(e){this.ensureInitialized();const{Input:t,ALL_FORMATS:s,BlobSource:i}=this.mediabunny;return new t({source:new i(e),formats:s})}async validateFormat(e){const t=e.type;if(!xM(t))return{supported:!1,format:null,error:`Unsupported format: ${t||"unknown"}. Supported formats: MP4, WebM, MOV, MP3, WAV, AAC, JPG, PNG, WebP`};if(t.startsWith("image/"))return{supported:!0,format:t};try{const s=await this.createInput(e),i=await s.getFormat();return s[Symbol.dispose]?.(),i?{supported:!0,format:t}:{supported:!1,format:null,error:"Could not determine file format. The file may be corrupted."}}catch(s){return{supported:!1,format:null,error:`Failed to parse file: ${s instanceof Error?s.message:"Unknown error"}`}}}async extractImageMetadata(e,t){const s=new Image,i=URL.createObjectURL(e);try{return await new Promise((n,a)=>{s.onload=()=>n(),s.onerror=()=>a(new Error("Failed to load image")),s.src=i}),{duration:0,width:s.naturalWidth,height:s.naturalHeight,frameRate:0,codec:"",sampleRate:0,channels:0,fileSize:e.size,mimeType:t,hasVideo:!1,hasAudio:!1,rotation:0,canDecode:!0,videoBitrate:0}}finally{URL.revokeObjectURL(i)}}async extractMetadata(e){const t=e instanceof File?e.type:"";if(t.startsWith("image/"))return await this.extractImageMetadata(e,t);const s=await this.createInput(e);try{const i=await s.computeDuration(),n=await s.getMimeType(),a=await s.getPrimaryVideoTrack(),o=await s.getPrimaryAudioTrack();let l=0,d=0,u=0,h="",p=0,f=!1,m=0;if(a){l=a.displayWidth,d=a.displayHeight,p=a.rotation||0,h=a.codec||"",f=await a.canDecode();try{const w=await a.computePacketStats(100);u=w.averagePacketRate||30,m=w.averageBitrate||0}catch{u=30}}let g=0,y=0,x="",b=!1;return o&&(g=o.sampleRate,y=o.numberOfChannels,x=o.codec||"",b=await o.canDecode()),{duration:i,width:l,height:d,frameRate:u,codec:h||x,sampleRate:g,channels:y,fileSize:e.size,mimeType:n,hasVideo:!!a,hasAudio:!!o,rotation:p,canDecode:f||b,videoBitrate:m}}finally{s[Symbol.dispose]?.()}}async generateThumbnails(e,t=5,s=320){this.ensureInitialized();const{CanvasSink:i}=this.mediabunny,n=await this.createInput(e);try{const a=await n.getPrimaryVideoTrack();if(!a)return[];if(!await a.canDecode())throw new Error("Cannot decode video track");const l=a.displayHeight/a.displayWidth,d=Math.round(s*l),u=new i(a,{width:s,height:d,fit:"contain",poolSize:Math.min(t,10)}),h=await a.getFirstTimestamp(),f=await a.computeDuration()-h,m=t===1?[h]:Array.from({length:t},(y,x)=>h+x/(t-1)*f),g=[];for await(const y of u.canvasesAtTimestamps(m))if(y){const x=new OffscreenCanvas(y.canvas.width,y.canvas.height),b=x.getContext("2d");b&&b.drawImage(y.canvas,0,0);let w;try{const C=await x.convertToBlob({type:"image/jpeg",quality:.7});w=URL.createObjectURL(C)}catch{}g.push({timestamp:y.timestamp,canvas:x,dataUrl:w})}return g}finally{n[Symbol.dispose]?.()}}async generateFilmstripThumbnails(e,t,s=80,i=1){this.ensureInitialized();const{CanvasSink:n}=this.mediabunny,a=await this.createInput(e);try{const o=await a.getPrimaryVideoTrack();if(!o)return[];if(!await o.canDecode())throw new Error("Cannot decode video track");const d=o.displayHeight/o.displayWidth,u=Math.round(s*d),h=Math.max(1,Math.ceil(t/i)),p=new n(o,{width:s,height:u,fit:"cover",poolSize:Math.min(h,20)}),f=await o.getFirstTimestamp(),m=Array.from({length:h},(y,x)=>f+x*i),g=[];for await(const y of p.canvasesAtTimestamps(m))if(y){const x=new OffscreenCanvas(y.canvas.width,y.canvas.height),b=x.getContext("2d");b&&b.drawImage(y.canvas,0,0);let w;try{const C=await x.convertToBlob({type:"image/jpeg",quality:.6});w=URL.createObjectURL(C)}catch{}g.push({timestamp:y.timestamp,canvas:x,dataUrl:w})}return g}finally{a[Symbol.dispose]?.()}}async getFrameAtTime(e,t,s){this.ensureInitialized();const{CanvasSink:i}=this.mediabunny,a=`${"name"in e?e.name:"blob"}-${e.size}-${t}-${s||"auto"}`,o=this.frameCache.get(a);if(o)return o.lastAccessed=Date.now(),{timestamp:o.timestamp,duration:0,canvas:o.image,width:o.width,height:o.height};const l=await this.createInput(e);try{const d=await l.getPrimaryVideoTrack();if(!d)return null;if(!await d.canDecode())throw new Error("Cannot decode video track");const h={poolSize:1};if(s){const y=d.displayHeight/d.displayWidth;h.width=s,h.height=Math.round(s*y),h.fit="contain"}const f=await new i(d,h).getCanvas(t);if(!f)return null;const m=new OffscreenCanvas(f.canvas.width,f.canvas.height),g=m.getContext("2d");if(g&&g.drawImage(f.canvas,0,0),this.frameCache.size>=this.MAX_CACHE_SIZE){let y="",x=1/0;for(const[b,w]of this.frameCache.entries())w.lastAccessed<x&&(x=w.lastAccessed,y=b);y&&this.frameCache.delete(y)}return this.frameCache.set(a,{timestamp:f.timestamp,image:m,width:m.width,height:m.height,lastAccessed:Date.now()}),{timestamp:f.timestamp,duration:f.duration,canvas:m,width:m.width,height:m.height}}finally{l[Symbol.dispose]?.()}}async generateWaveform(e,t=100){this.ensureInitialized();const{AudioSampleSink:s}=this.mediabunny,i=await this.createInput(e);try{const n=await i.getPrimaryAudioTrack();if(!n)throw new Error("No audio track found");if(!await n.canDecode())throw new Error("Cannot decode audio track");const o=new s(n),l=await n.computeDuration(),d=Math.ceil(l*t),u=[],h=[],p=Array.from({length:d},(f,m)=>m/t);for await(const f of o.samplesAtTimestamps(p)){if(!f){u.push(0),h.push(0);continue}const m=f.allocationSize({format:"f32",planeIndex:0}),g=new Float32Array(m/4);f.copyTo(g,{format:"f32",planeIndex:0});let y=0,x=0;for(let b=0;b<g.length;b++){const w=Math.abs(g[b]);y=Math.max(y,w),x+=g[b]*g[b]}u.push(y),h.push(Math.sqrt(x/g.length)),f.close()}return{peaks:new Float32Array(u),rms:new Float32Array(h),sampleRate:t,duration:l,samplesPerSecond:t}}finally{i[Symbol.dispose]?.()}}async convertMedia(e,t,s,i){this.ensureInitialized();const{Input:n,Output:a,Conversion:o,ALL_FORMATS:l,BlobSource:d,BufferTarget:u,Mp4OutputFormat:h,WebMOutputFormat:p,MovOutputFormat:f,Mp3OutputFormat:m,QUALITY_HIGH:g,QUALITY_MEDIUM:y}=this.mediabunny;if(i?.aborted)throw new DOMException("Aborted","AbortError");const x=new n({source:new d(e),formats:l});let b;switch(t.format){case"webm":b=new p;break;case"mov":b=new f;break;case"mp3":b=new m;break;case"mp4":default:b=new h({fastStart:"in-memory"});break}const w=new a({format:b,target:new u}),C={input:x,output:w};(t.width||t.height||t.videoBitrate)&&(C.video={...t.width&&{width:t.width},...t.height&&{height:t.height},...t.width&&t.height&&{fit:"contain"},...t.frameRate&&{frameRate:t.frameRate},bitrate:t.videoBitrate||g}),(t.audioBitrate||t.sampleRate||t.channels)&&(C.audio={...t.audioBitrate&&{bitrate:t.audioBitrate},...t.sampleRate&&{sampleRate:t.sampleRate},...t.channels&&{numberOfChannels:t.channels}}),(t.format==="mp4"||t.format==="webm"||t.format==="mov")&&(C.audio||(C.audio={bitrate:y}));const k=await o.init(C);if(!k.isValid){const T=k.discardedTracks.map(j=>j.reason).join(", ");throw new Error(`Conversion invalid: ${T}`)}if(k.discardedTracks.length>0&&console.warn("Some tracks were discarded during conversion:",k.discardedTracks),s){let T=0;k.onProgress=j=>{j>T&&(T=j,s({phase:j<1?"encoding":"complete",progress:j,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0}))}}i&&i.addEventListener("abort",()=>{k.cancel()});try{await k.execute()}catch(T){throw i?.aborted?new DOMException("Aborted","AbortError"):T}const S=w.target.buffer;if(!S)throw new Error("Output buffer is empty");const A=this.getMimeTypeForFormat(t.format);return new Blob([S],{type:A})}async extractAudio(e,t="mp3",s,i){return this.convertMedia(e,{format:t,audioBitrate:128e3,sampleRate:48e3,channels:2},s,i)}async trimMedia(e,t,s,i,n,a){this.ensureInitialized();const{Input:o,Output:l,Conversion:d,ALL_FORMATS:u,BlobSource:h,BufferTarget:p,Mp4OutputFormat:f}=this.mediabunny;if(a?.aborted)throw new DOMException("Aborted","AbortError");const m=new o({source:new h(e),formats:u}),g=new l({format:new f({fastStart:"in-memory"}),target:new p}),y=await d.init({input:m,output:g,trim:{start:t,end:s},...i?.videoBitrate&&{video:{bitrate:i.videoBitrate}},...i?.audioBitrate&&{audio:{bitrate:i.audioBitrate}}});if(!y.isValid){const x=y.discardedTracks.map(b=>b.reason).join(", ");throw new Error(`Trim conversion invalid: ${x}`)}n&&(y.onProgress=x=>{n({phase:x<1?"encoding":"complete",progress:x,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0})}),a&&a.addEventListener("abort",()=>{y.cancel()});try{await y.execute()}catch(x){throw a?.aborted?new DOMException("Aborted","AbortError"):x}if(!g.target.buffer)throw new Error("Output buffer is empty");return new Blob([g.target.buffer],{type:"video/mp4"})}getMimeTypeForFormat(e){switch(e){case"mp4":return"video/mp4";case"webm":return"video/webm";case"mov":return"video/quicktime";case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"aac":return"audio/aac";default:return"video/mp4"}}async checkCodecSupport(){this.ensureInitialized();const{getEncodableVideoCodecs:e,getEncodableAudioCodecs:t}=this.mediabunny,[s,i]=await Promise.all([e(),t()]);return{video:s,audio:i}}async getBestVideoCodec(e,t){this.ensureInitialized();const{getFirstEncodableVideoCodec:s,Mp4OutputFormat:i}=this.mediabunny,a=new i().getSupportedVideoCodecs();try{return await s(a,{width:e,height:t})||null}catch{return null}}async exportFrame(e,t,s="image/jpeg",i=.8){const n=await this.getFrameAtTime(e,t);if(!n)throw new Error("Could not extract frame");const{canvas:a}=n;let o=null;if(a instanceof OffscreenCanvas)o=await a.convertToBlob({type:s,quality:i});else if(a instanceof HTMLCanvasElement)o=await new Promise(l=>a.toBlob(l,s,i));else if(a instanceof ImageBitmap){const l=new OffscreenCanvas(a.width,a.height),d=l.getContext("2d");d&&(d.drawImage(a,0,0),o=await l.convertToBlob({type:s,quality:i}))}if(!o)throw new Error("Failed to create image blob");return o}async generateProxy(e,t,s){const i={format:"mp4",height:540,videoBitrate:1e6,audioBitrate:96e3};return this.convertMedia(e,i,t,s)}async exportImageSequence(e,t,s,i,n="image/jpeg",a=.8,o,l){this.ensureInitialized();const{CanvasSink:d}=this.mediabunny,u=await this.createInput(e);try{const h=await u.getPrimaryVideoTrack();if(!h)throw new Error("No video track found");if(!await h.canDecode())throw new Error("Cannot decode video track");const f=s-t,m=Math.ceil(f*i),g=Array.from({length:m},(w,C)=>t+C/i),y=new d(h,{fit:"contain",poolSize:5}),x=[];let b=0;for await(const w of y.canvasesAtTimestamps(g)){if(l?.aborted)throw new DOMException("Aborted","AbortError");if(w){const{canvas:C}=w;let k=null;C instanceof OffscreenCanvas&&(k=await C.convertToBlob({type:n,quality:a})),k&&x.push(k)}b++,o?.(b/m)}return x}finally{u[Symbol.dispose]?.()}}async getBestAudioCodec(){this.ensureInitialized();const{getFirstEncodableAudioCodec:e,Mp4OutputFormat:t}=this.mediabunny,i=new t().getSupportedAudioCodecs();try{return await e(i)||null}catch{return null}}}let vm=null;function Ac(){return vm||(vm=new s9),vm}const cC={low:{scale:.25,preset:"ultrafast",crf:32,audioBitrate:96,maxWidth:960,maxHeight:540},medium:{scale:.5,preset:"fast",crf:28,audioBitrate:128,maxWidth:1280,maxHeight:720},high:{scale:.75,preset:"medium",crf:23,audioBitrate:192,maxWidth:1920,maxHeight:1080}},Bh={minPixelCount:3840*2160,minDuration:600,minFileSize:500*1024*1024},i9={format:"webm",videoCodec:"libvpx-vp9",audioCodec:"libopus",videoBitrate:"2M",audioBitrate:"128k",enableRowMt:!0};class r9{ffmpeg=null;loaded=!1;loading=null;progressCallback=null;calculateBufsize(e){const t=e.match(/^(\d+(?:\.\d+)?)\s*([KkMmGg]?)$/);if(!t)return e;const s=parseFloat(t[1]),i=t[2]||"";return`${Math.round(s*2)}${i}`}async load(){if(!this.loaded){if(this.loading)return this.loading;this.loading=this.doLoad(),await this.loading}}async doLoad(){try{const{FFmpeg:e}=await _i(async()=>{const{FFmpeg:n}=await import("./index4.js");return{FFmpeg:n}},[]),{toBlobURL:t}=await _i(async()=>{const{toBlobURL:n}=await import("./index3.js");return{toBlobURL:n}},[]);this.ffmpeg=new e;const s=typeof crossOriginIsolated<"u"&&crossOriginIsolated,i=s?"https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm":"https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";if(s){const[n,a,o]=await Promise.all([t(`${i}/ffmpeg-core.js`,"text/javascript"),t(`${i}/ffmpeg-core.wasm`,"application/wasm"),t(`${i}/ffmpeg-core.worker.js`,"text/javascript")]);await this.ffmpeg.load({coreURL:n,wasmURL:a,workerURL:o})}else{const[n,a]=await Promise.all([t(`${i}/ffmpeg-core.js`,"text/javascript"),t(`${i}/ffmpeg-core.wasm`,"application/wasm")]);await this.ffmpeg.load({coreURL:n,wasmURL:a})}this.loaded=!0}catch(e){throw this.loading=null,console.error("[FFmpeg] Load error:",e),new Error(`Failed to load FFmpeg.wasm: ${e instanceof Error?e.message:"Unknown error"}`)}}isLoaded(){return this.loaded&&this.ffmpeg!==null}ensureLoaded(){if(!this.ffmpeg||!this.loaded)throw new Error("FFmpeg not loaded. Call load() first.")}async fileToUint8Array(e){const t=await e.arrayBuffer();return new Uint8Array(t)}async cleanupFiles(e){if(this.ffmpeg)for(const t of e)try{await this.ffmpeg.deleteFile(t)}catch{}}setupProgressTracking(e,t){!this.ffmpeg||!e||(this.progressCallback&&this.ffmpeg.off("progress",this.progressCallback),this.progressCallback=({progress:s,time:i})=>{let n=0;if(t&&i&&s>0){const o=i/1e6/s;n=(1-s)*o}e({phase:s<1?"encoding":"complete",progress:Math.min(s,1),currentFrame:0,totalFrames:0,estimatedTimeRemaining:n,bytesWritten:0,currentBitrate:0})},this.ffmpeg.on("progress",this.progressCallback))}removeProgressTracking(){!this.ffmpeg||!this.progressCallback||(this.ffmpeg.off("progress",this.progressCallback),this.progressCallback=null)}async transcodeToCompatible(e,t,s={}){await this.load(),this.ensureLoaded();const i={...i9,...s},n="input",a=`output.${i.format}`;try{const o=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(n,o),this.setupProgressTracking(t);const l=["-i",n];l.push("-c:v",i.videoCodec),l.push("-b:v",i.videoBitrate),i.videoCodec==="libvpx-vp9"&&i.enableRowMt&&l.push("-row-mt","1"),l.push("-c:a",i.audioCodec),l.push("-b:a",i.audioBitrate),l.push(a),await this.ffmpeg.exec(l);const d=await this.ffmpeg.readFile(a),u=i.format==="webm"?"video/webm":"video/mp4";return new Blob([d.buffer],{type:u})}finally{this.removeProgressTracking(),await this.cleanupFiles([n,a])}}async transcodeToMp4(e,t){return this.transcodeToCompatible(e,t,{format:"mp4",videoCodec:"libx264",audioCodec:"aac",videoBitrate:"5M",audioBitrate:"192k"})}async extractAudioAsWav(e){await this.load(),this.ensureLoaded();const t="input",s="output.wav";try{const i=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(t,i),await this.ffmpeg.exec(["-i",t,"-vn","-acodec","pcm_f32le","-ar","48000","-ac","2",s]);const n=await this.ffmpeg.readFile(s);return new Blob([n.buffer],{type:"audio/wav"})}finally{await this.cleanupFiles([t,s])}}async generateProxy(e,t={},s){await this.load(),this.ensureLoaded();const i={...cC.medium,...t},n="input",a="proxy.mp4";try{const o=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(n,o),this.setupProgressTracking(s);let l;i.maxWidth&&i.maxHeight?l=`scale='min(${i.maxWidth},iw*${i.scale})':'min(${i.maxHeight},ih*${i.scale})':force_original_aspect_ratio=decrease`:l=`scale=iw*${i.scale}:ih*${i.scale}`,l+=",pad=ceil(iw/2)*2:ceil(ih/2)*2",await this.ffmpeg.exec(["-i",n,"-vf",l,"-c:v","libx264","-preset",i.preset,"-crf",i.crf.toString(),"-c:a","aac","-b:a",`${i.audioBitrate}k`,"-movflags","+faststart",a]);const d=await this.ffmpeg.readFile(a);return new Blob([d.buffer],{type:"video/mp4"})}finally{this.removeProgressTracking(),await this.cleanupFiles([n,a])}}async generateProxyWithPreset(e,t,s){return this.generateProxy(e,cC[t],s)}async extractRange(e,t,s,i){await this.load(),this.ensureLoaded();const n="input",a="output.mp4",o=s-t;try{const l=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(n,l),this.setupProgressTracking(i,o),await this.ffmpeg.exec(["-ss",t.toString(),"-i",n,"-t",o.toString(),"-c:v","libx264","-preset","fast","-c:a","aac","-movflags","+faststart",a]);const d=await this.ffmpeg.readFile(a);return new Blob([d.buffer],{type:"video/mp4"})}finally{this.removeProgressTracking(),await this.cleanupFiles([n,a])}}async getMetadata(e){await this.load(),this.ensureLoaded();const t="input";try{const s=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(t,s);try{await this.ffmpeg.exec(["-i",t,"-f","null","-"])}catch{}return{duration:0,width:0,height:0,hasVideo:!0,hasAudio:!0}}finally{await this.cleanupFiles([t])}}shouldUseProxy(e){return e.width*e.height>=Bh.minPixelCount||e.duration>=Bh.minDuration||e.fileSize!==void 0&&e.fileSize>=Bh.minFileSize}getRecommendedProxyPreset(e){const t=e.width*e.height;return t>=7680*4320?"low":t>=3840*2160?"medium":"high"}async convertAudio(e,t,s={}){await this.load(),this.ensureLoaded();const i="input",n=`output.${t}`;try{const a=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(i,a);const o=["-i",i,"-vn"];switch(t){case"mp3":o.push("-c:a","libmp3lame");break;case"wav":o.push("-c:a","pcm_s16le");break;case"aac":o.push("-c:a","aac");break;case"ogg":o.push("-c:a","libvorbis");break}s.bitrate&&o.push("-b:a",s.bitrate),s.sampleRate&&o.push("-ar",s.sampleRate.toString()),s.channels&&o.push("-ac",s.channels.toString()),o.push(n),await this.ffmpeg.exec(o);const l=await this.ffmpeg.readFile(n),d={mp3:"audio/mpeg",wav:"audio/wav",aac:"audio/aac",ogg:"audio/ogg"};return new Blob([l.buffer],{type:d[t]})}finally{await this.cleanupFiles([i,n])}}async extractFrame(e,t,s="jpg"){await this.load(),this.ensureLoaded();const i="input",n=`frame.${s}`;try{const a=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(i,a),await this.ffmpeg.exec(["-ss",t.toString(),"-i",i,"-vframes","1","-q:v","2",n]);const o=await this.ffmpeg.readFile(n),l=s==="png"?"image/png":"image/jpeg";return new Blob([o.buffer],{type:l})}finally{await this.cleanupFiles([i,n])}}async encodeFrameSequence(e,t,s){await this.load(),this.ensureLoaded();const{width:i,height:n,frameRate:a,totalFrames:o,format:l="mp4",videoBitrate:d="10M",audioBitrate:u="192k",audioBuffer:h,writableStream:p}=t,f=`output.${l}`;let m=0;try{for await(const{image:C,frameIndex:k}of e){const S=new OffscreenCanvas(i,n),A=S.getContext("2d");A.fillStyle="#000000",A.fillRect(0,0,i,n),A.drawImage(C,0,0,i,n);const j=await(await S.convertToBlob({type:"image/jpeg",quality:.95})).arrayBuffer(),_=new Uint8Array(j),P=`frame_${String(k).padStart(6,"0")}.jpg`;await this.ffmpeg.writeFile(P,_),m++,C.close(),s&&s({phase:"rendering",progress:m/o*.7,currentFrame:m,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0}),m%10===0&&await new Promise(R=>setTimeout(R,10))}let y=!1;if(h&&h.length>0){const C=this.encodeAudioBufferToWav(h),k=new Uint8Array(await C.arrayBuffer());k.length>44&&(await this.ffmpeg.writeFile("audio.wav",k),y=!0)}s&&s({phase:"encoding",progress:.7,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0});const x=["-framerate",a.toString(),"-i","frame_%06d.jpg"];y&&x.push("-i","audio.wav"),x.push("-threads","4"),l==="mp4"?x.push("-c:v","libx264","-preset","fast","-crf","23","-maxrate",d,"-bufsize",this.calculateBufsize(d),"-pix_fmt","yuv420p"):x.push("-c:v","libvpx-vp9","-crf","31","-b:v","0","-deadline","good","-cpu-used","4","-row-mt","1"),y&&x.push("-c:a",l==="mp4"?"aac":"libopus","-b:a",u),x.push("-movflags","+faststart","-y",f),this.setupProgressTracking(C=>{s&&s({phase:"encoding",progress:.7+C.progress*.25,currentFrame:o,totalFrames:o,estimatedTimeRemaining:C.estimatedTimeRemaining,bytesWritten:0,currentBitrate:0})}),await this.ffmpeg.exec(x),this.removeProgressTracking(),s&&s({phase:"muxing",progress:.95,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0});const b=await this.ffmpeg.readFile(f),w=l==="mp4"?"video/mp4":"video/webm";if(p){const k=b.buffer;for(let S=0;S<k.byteLength;S+=4194304){const A=new Uint8Array(k,S,Math.min(4194304,k.byteLength-S));await p.write(A)}return await p.close(),s&&s({phase:"complete",progress:1,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:k.byteLength,currentBitrate:0}),null}return s&&s({phase:"complete",progress:1,currentFrame:o,totalFrames:o,estimatedTimeRemaining:0,bytesWritten:b.buffer.byteLength,currentBitrate:0}),new Blob([b.buffer],{type:w})}finally{for(let g=0;g<m;g++){const y=String(g).padStart(6,"0");try{await this.ffmpeg.deleteFile(`frame_${y}.jpg`)}catch{}}try{await this.ffmpeg.deleteFile("audio.wav")}catch{}try{await this.ffmpeg.deleteFile(f)}catch{}}}encodeAudioBufferToWav(e){const t=e.numberOfChannels,s=e.sampleRate,i=16,n=i/8,a=t*n,o=s*a,l=e.length*a,u=44+l,h=new ArrayBuffer(u),p=new DataView(h),f=(g,y)=>{for(let x=0;x<y.length;x++)p.setUint8(g+x,y.charCodeAt(x))};f(0,"RIFF"),p.setUint32(4,u-8,!0),f(8,"WAVE"),f(12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,1,!0),p.setUint16(22,t,!0),p.setUint32(24,s,!0),p.setUint32(28,o,!0),p.setUint16(32,a,!0),p.setUint16(34,i,!0),f(36,"data"),p.setUint32(40,l,!0);let m=44;for(let g=0;g<e.length;g++)for(let y=0;y<t;y++){const x=e.getChannelData(y)[g],b=Math.max(-32768,Math.min(32767,Math.round(x*32767)));p.setInt16(m,b,!0),m+=n}return new Blob([h],{type:"audio/wav"})}async exportVideoDirectly(e,t,s){await this.load(),this.ensureLoaded();const{startTime:i=0,endTime:n,width:a,height:o,frameRate:l,format:d="mp4",videoBitrate:u="10M",audioBitrate:h="192k",speed:p=1,writableStream:f,useStreamCopy:m=!1}=t,g="input_video",y=`output.${d}`;try{s&&s({phase:"preparing",progress:.05,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0,bytesWritten:0,currentBitrate:0});const x=await this.fileToUint8Array(e);await this.ffmpeg.writeFile(g,x);const b=[];if(i>0&&b.push("-ss",i.toString()),b.push("-i",g),n!==void 0&&n>i&&b.push("-t",(n-i).toString()),b.push("-threads","4"),p!==1||!m){const S=`scale=${a}:${o}:force_original_aspect_ratio=decrease,pad=${a}:${o}:(ow-iw)/2:(oh-ih)/2,fps=${l}`;if(p!==1&&p>0){const A=1/p,T=Math.max(.5,Math.min(2,p));b.push("-filter_complex",`[0:v]${S},setpts=${A}*PTS[v];[0:a]atempo=${T}[a]`,"-map","[v]","-map","[a]")}else b.push("-vf",S);d==="mp4"?b.push("-c:v","libx264","-preset","fast","-crf","23","-maxrate",u,"-bufsize",this.calculateBufsize(u),"-pix_fmt","yuv420p","-c:a","aac","-b:a",h):b.push("-c:v","libvpx-vp9","-crf","31","-b:v","0","-deadline","good","-cpu-used","4","-row-mt","1","-c:a","libopus","-b:a",h)}else b.push("-c","copy");b.push("-movflags","+faststart","-y",y),this.setupProgressTracking(S=>{s&&s({phase:"encoding",progress:.1+S.progress*.85,currentFrame:0,totalFrames:0,estimatedTimeRemaining:S.estimatedTimeRemaining,bytesWritten:0,currentBitrate:0})}),await this.ffmpeg.exec(b),this.removeProgressTracking();const C=await this.ffmpeg.readFile(y),k=d==="mp4"?"video/mp4":"video/webm";if(f){const A=C.buffer;for(let T=0;T<A.byteLength;T+=4194304){const j=new Uint8Array(A,T,Math.min(4194304,A.byteLength-T));await f.write(j)}return await f.close(),s&&s({phase:"complete",progress:1,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0,bytesWritten:A.byteLength,currentBitrate:0}),null}return s&&s({phase:"complete",progress:1,currentFrame:0,totalFrames:0,estimatedTimeRemaining:0,bytesWritten:C.buffer.byteLength,currentBitrate:0}),new Blob([C.buffer],{type:k})}finally{try{await this.ffmpeg.deleteFile(g)}catch{}try{await this.ffmpeg.deleteFile(y)}catch{}}}terminate(){this.ffmpeg&&(this.removeProgressTracking(),this.ffmpeg.terminate(),this.ffmpeg=null,this.loaded=!1,this.loading=null)}}let wm=null;function bM(){return wm||(wm=new r9),wm}const Is=[];for(let r=0;r<256;++r)Is.push((r+256).toString(16).slice(1));function n9(r,e=0){return(Is[r[e+0]]+Is[r[e+1]]+Is[r[e+2]]+Is[r[e+3]]+"-"+Is[r[e+4]]+Is[r[e+5]]+"-"+Is[r[e+6]]+Is[r[e+7]]+"-"+Is[r[e+8]]+Is[r[e+9]]+"-"+Is[r[e+10]]+Is[r[e+11]]+Is[r[e+12]]+Is[r[e+13]]+Is[r[e+14]]+Is[r[e+15]]).toLowerCase()}let km;const a9=new Uint8Array(16);function o9(){if(!km){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");km=crypto.getRandomValues.bind(crypto)}return km(a9)}const c9=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lC={randomUUID:c9};function l9(r,e,t){r=r||{};const s=r.random??r.rng?.()??o9();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,n9(s)}function dt(r,e,t){return lC.randomUUID&&!r?lC.randomUUID():l9(r)}const d9={generateThumbnails:!0,thumbnailCount:5,thumbnailWidth:320,generateWaveform:!0,waveformSamplesPerSecond:100,useFallback:!0,quickMode:!1};class u9{mediaEngine;ffmpegFallback;initialized=!1;constructor(e,t){this.mediaEngine=e||Ac(),this.ffmpegFallback=t||bM()}async initialize(){if(!this.initialized)try{await this.mediaEngine.initialize(),this.initialized=!0}catch{console.warn("MediaBunny initialization failed, will use fallback only"),this.initialized=!0}}async importMedia(e,t={}){const s={...d9,...t},i=[],n=await this.validateFormat(e);if(!n.supported){if(s.useFallback)try{return await this.importWithFallback(e,s)}catch(a){return{success:!1,error:n.error||"Unsupported format",warnings:[`FFmpeg fallback also failed: ${a instanceof Error?a.message:"Unknown error"}`]}}return{success:!1,error:n.error||"Unsupported format"}}try{const a=await this.mediaEngine.extractMetadata(e),o=oC(e.type);if(!o)return{success:!1,error:"Could not determine media type"};if(!a.canDecode&&(i.push("Codec may not be fully supported. Playback might be limited."),s.useFallback))try{return await this.importWithFallback(e,s)}catch{}let l=[];if(s.generateThumbnails&&!s.quickMode){if(o==="video"&&a.hasVideo)try{l=await this.mediaEngine.generateThumbnails(e,s.thumbnailCount,s.thumbnailWidth)}catch(h){i.push(`Thumbnail generation failed: ${h instanceof Error?h.message:"Unknown error"}`)}else if(o==="image")try{const h=new Image,p=URL.createObjectURL(e);await new Promise((b,w)=>{h.onload=()=>{URL.revokeObjectURL(p),b()},h.onerror=()=>{URL.revokeObjectURL(p),w(new Error("Failed to load image"))},h.src=p});const f=document.createElement("canvas"),m=s.thumbnailWidth||320,g=h.height/h.width,y=Math.round(m*g);f.width=m,f.height=y;const x=f.getContext("2d");if(x){x.drawImage(h,0,0,m,y);const b=f.toDataURL("image/jpeg",.8);l=[{timestamp:0,canvas:f,dataUrl:b}]}}catch(h){i.push(`Image thumbnail generation failed: ${h instanceof Error?h.message:"Unknown error"}`)}}let d=null;if(s.generateWaveform&&a.hasAudio&&!s.quickMode)try{d=await this.mediaEngine.generateWaveform(e,s.waveformSamplesPerSecond)}catch(h){i.push(`Waveform generation failed: ${h instanceof Error?h.message:"Unknown error"}`)}return{success:!0,media:{id:dt(),name:e.name,type:o,blob:e,metadata:a,thumbnails:l,waveformData:d},warnings:i.length>0?i:void 0}}catch(a){if(s.useFallback)try{return await this.importWithFallback(e,s)}catch(o){return{success:!1,error:`Import failed: ${a instanceof Error?a.message:"Unknown error"}`,warnings:[`FFmpeg fallback also failed: ${o instanceof Error?o.message:"Unknown error"}`]}}return{success:!1,error:`Import failed: ${a instanceof Error?a.message:"Unknown error"}`}}}async importWithFallback(e,t){const s=await this.ffmpegFallback.transcodeToCompatible(e),i=new File([s],e.name.replace(/\.[^.]+$/,".webm"),{type:"video/webm"}),n=await this.mediaEngine.extractMetadata(i),a=oC(i.type)||"video";let o=[];if(t.generateThumbnails&&n.hasVideo)try{o=await this.mediaEngine.generateThumbnails(i,t.thumbnailCount,t.thumbnailWidth)}catch{}let l=null;if(t.generateWaveform&&n.hasAudio)try{l=await this.mediaEngine.generateWaveform(i,t.waveformSamplesPerSecond)}catch{}return{success:!0,media:{id:dt(),name:e.name,type:a,blob:i,metadata:n,thumbnails:o,waveformData:l},warnings:["File was transcoded using FFmpeg fallback"]}}async validateFormat(e){return xM(e.type)?this.mediaEngine.isAvailable()?this.mediaEngine.validateFormat(e):{supported:!0,format:e.type}:{supported:!1,format:null,error:`Unsupported format: ${e.type||"unknown"}. Supported formats: MP4, WebM, MOV, MP3, WAV, AAC, JPG, PNG, WebP`}}processedMediaToMediaItem(e,t){const s={duration:e.metadata.duration,width:e.metadata.width,height:e.metadata.height,frameRate:e.metadata.frameRate,codec:e.metadata.codec,sampleRate:e.metadata.sampleRate,channels:e.metadata.channels,fileSize:e.metadata.fileSize};return{id:e.id,name:e.name,type:e.type,fileHandle:null,blob:e.blob,metadata:s,thumbnailUrl:t||null,waveformData:e.waveformData?.peaks||null}}async importMultiple(e,t={},s){const i=[];for(let n=0;n<e.length;n++){const a=e[n];s?.(n,e.length,a.name);const o=await this.importMedia(a,t);i.push(o)}return s?.(e.length,e.length,"Complete"),i}shouldUseProxy(e){return this.ffmpegFallback.shouldUseProxy(e)}shouldUseProxyForFile(e,t){return this.ffmpegFallback.shouldUseProxy({...t,fileSize:e.size})}getRecommendedProxyPreset(e){return this.ffmpegFallback.getRecommendedProxyPreset(e)}async generateProxy(e,t,s){if(this.mediaEngine.isAvailable())try{return await this.mediaEngine.generateProxy(e)}catch{}return this.ffmpegFallback.generateProxy(e,t,s)}async generateProxyWithPreset(e,t,s){return this.ffmpegFallback.generateProxyWithPreset(e,t,s)}async generateProxyIfNeeded(e,t,s){if(!this.shouldUseProxyForFile(e,t))return null;const i=this.getRecommendedProxyPreset(t);return this.generateProxyWithPreset(e,i,s)}getProxyThresholds(){return{...Bh}}getSupportedFormats(){return{video:["MP4","WebM","MOV","MKV"],audio:["MP3","WAV","AAC","OGG","FLAC"],image:["JPEG","PNG","WebP","GIF"]}}async generateThumbnailsForMedia(e,t,s={}){this.initialized||await this.initialize();const{count:i=10,width:n=160}=s;if(t==="video")return this.mediaEngine.generateThumbnails(e,i,n);if(t==="image"){const a=new Image,o=URL.createObjectURL(e);await new Promise((p,f)=>{a.onload=()=>{URL.revokeObjectURL(o),p()},a.onerror=()=>{URL.revokeObjectURL(o),f(new Error("Failed to load image"))},a.src=o});const l=document.createElement("canvas"),d=a.height/a.width,u=Math.round(n*d);l.width=n,l.height=u;const h=l.getContext("2d");if(h){h.drawImage(a,0,0,n,u);const p=l.toDataURL("image/jpeg",.8);return[{timestamp:0,canvas:l,dataUrl:p}]}}return[]}async generateWaveformForMedia(e,t=100){return this.initialized||await this.initialize(),this.mediaEngine.generateWaveform(e,t)}}let Cm=null;function h9(){return Cm||(Cm=new u9),Cm}async function p9(){const r=h9();return await r.initialize(),r}const Lh={OVERVIEW:10,MEDIUM:100,HIGH:200},f9={samplesPerSecond:Lh.MEDIUM,enableCaching:!0};class m9{mediaEngine;storageEngine=null;memoryCache=new Map;MAX_MEMORY_CACHE_SIZE=20;constructor(e,t){this.mediaEngine=e||Ac(),this.storageEngine=t||null}setStorageEngine(e){this.storageEngine=e}async generateWaveform(e,t,s={}){const i={...f9,...s},n=this.memoryCache.get(t);if(n&&n.data.samplesPerSecond===i.samplesPerSecond)return n.data;if(i.enableCaching&&this.storageEngine){const o=await this.loadFromCache(t);if(o&&o.samplesPerSecond===i.samplesPerSecond)return this.updateMemoryCache(t,o),o}const a=await this.mediaEngine.generateWaveform(e,i.samplesPerSecond);return i.enableCaching&&await this.saveToCache(t,a),this.updateMemoryCache(t,a),a}async generateMultiResolutionWaveform(e,t,s=[Lh.OVERVIEW,Lh.MEDIUM,Lh.HIGH]){const i={mediaId:t,duration:0,resolutions:new Map},n=[...s].sort((l,d)=>d-l),a=n[0],o=await this.generateWaveform(e,t,{samplesPerSecond:a,enableCaching:!0});i.duration=o.duration,i.resolutions.set(a,o);for(let l=1;l<n.length;l++){const d=n[l],u=this.downsampleWaveform(o,d);i.resolutions.set(d,u)}return i}getWaveformForZoomLevel(e,t){const s=Math.max(10,Math.min(500,t*2));let i=null,n=1/0;for(const[a,o]of e.resolutions){const l=Math.abs(a-s);(l<n||l===n&&a>(i?.samplesPerSecond||0))&&(n=l,i=o)}return i}downsampleWaveform(e,t){if(t>=e.samplesPerSecond)return e;const s=e.samplesPerSecond/t,i=Math.ceil(e.peaks.length/s),n=new Float32Array(i),a=new Float32Array(i);for(let o=0;o<i;o++){const l=Math.floor(o*s),d=Math.min(Math.floor((o+1)*s),e.peaks.length);let u=0,h=0,p=0;for(let f=l;f<d;f++)u=Math.max(u,e.peaks[f]),h+=e.rms[f]*e.rms[f],p++;n[o]=u,a[o]=p>0?Math.sqrt(h/p):0}return{peaks:n,rms:a,sampleRate:t,duration:e.duration,samplesPerSecond:t}}getWaveformSlice(e,t,s){const i=Math.max(0,Math.floor(t*e.samplesPerSecond)),n=Math.min(e.peaks.length,Math.ceil(s*e.samplesPerSecond));return{peaks:e.peaks.slice(i,n),rms:e.rms.slice(i,n),sampleRate:e.sampleRate,duration:s-t,samplesPerSecond:e.samplesPerSecond}}async loadFromCache(e){if(!this.storageEngine)return null;try{const t=await this.storageEngine.loadWaveform(e);return t?this.waveformRecordToData(t):null}catch(t){return console.warn("Failed to load waveform from cache:",t),null}}async saveToCache(e,t){if(this.storageEngine)try{const s=this.waveformDataToRecord(e,t);await this.storageEngine.saveWaveform(s)}catch(s){console.warn("Failed to save waveform to cache:",s)}}waveformRecordToData(e){const t=e.data.length/2,s=new Float32Array(t),i=new Float32Array(t);for(let a=0;a<t;a++)s[a]=e.data[a],i[a]=e.data[t+a];const n=t/e.sampleRate;return{peaks:s,rms:i,sampleRate:e.sampleRate,duration:n,samplesPerSecond:e.sampleRate}}waveformDataToRecord(e,t){const s=[];for(let i=0;i<t.peaks.length;i++)s.push(t.peaks[i]);for(let i=0;i<t.rms.length;i++)s.push(t.rms[i]);return{mediaId:e,data:s,sampleRate:t.samplesPerSecond}}updateMemoryCache(e,t){if(this.memoryCache.size>=this.MAX_MEMORY_CACHE_SIZE){let s="",i=1/0;for(const[n,a]of this.memoryCache.entries())a.createdAt<i&&(i=a.createdAt,s=n);s&&this.memoryCache.delete(s)}this.memoryCache.set(e,{mediaId:e,data:t,createdAt:Date.now()})}async clearCache(e){if(this.memoryCache.delete(e),this.storageEngine)try{await this.storageEngine.deleteWaveform(e)}catch(t){console.warn("Failed to delete waveform from cache:",t)}}clearAllCache(){this.memoryCache.clear()}async isCached(e){return this.memoryCache.has(e)?!0:this.storageEngine?await this.storageEngine.loadWaveform(e)!==null:!1}}let Sm=null;function g9(){return Sm||(Sm=new m9),Sm}async function y9(r){try{const e=await createImageBitmap(r),t=e.width,s=e.height,n=new OffscreenCanvas(t,s).getContext("2d");if(!n)return e.close(),null;n.drawImage(e,0,0);const a=[e],o=[100];return{frames:a,delays:o,totalDuration:o.reduce((l,d)=>l+d,0)}}catch{return null}}function x9(r,e){if(r.frames.length<=1)return 0;const t=e%r.totalDuration;let s=0;for(let i=0;i<r.delays.length;i++)if(s+=r.delays[i],t<s)return i;return r.frames.length-1}function b9(r){return r.type==="image/gif"}const v9={fontFamily:"Inter",fontSize:48,fontWeight:"bold",fontStyle:"normal",color:"#ffffff",textAlign:"center",verticalAlign:"middle",lineHeight:1.2,letterSpacing:0},w9={position:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},Td=Math.PI,jp=1.70158,Ku=jp*1.525,dC=jp+1,uC=2*Td/3,hC=2*Td/4.5,Qu=r=>r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375,ni={linear:r=>r,easeInQuad:r=>r*r,easeOutQuad:r=>1-(1-r)*(1-r),easeInOutQuad:r=>r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2,easeInCubic:r=>r*r*r,easeOutCubic:r=>1-Math.pow(1-r,3),easeInOutCubic:r=>r<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2,easeInQuart:r=>r*r*r*r,easeOutQuart:r=>1-Math.pow(1-r,4),easeInOutQuart:r=>r<.5?8*r*r*r*r:1-Math.pow(-2*r+2,4)/2,easeInQuint:r=>r*r*r*r*r,easeOutQuint:r=>1-Math.pow(1-r,5),easeInOutQuint:r=>r<.5?16*r*r*r*r*r:1-Math.pow(-2*r+2,5)/2,easeInSine:r=>1-Math.cos(r*Td/2),easeOutSine:r=>Math.sin(r*Td/2),easeInOutSine:r=>-(Math.cos(Td*r)-1)/2,easeInExpo:r=>r===0?0:Math.pow(2,10*r-10),easeOutExpo:r=>r===1?1:1-Math.pow(2,-10*r),easeInOutExpo:r=>r===0?0:r===1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2,easeInCirc:r=>1-Math.sqrt(1-Math.pow(r,2)),easeOutCirc:r=>Math.sqrt(1-Math.pow(r-1,2)),easeInOutCirc:r=>r<.5?(1-Math.sqrt(1-Math.pow(2*r,2)))/2:(Math.sqrt(1-Math.pow(-2*r+2,2))+1)/2,easeInBack:r=>dC*r*r*r-jp*r*r,easeOutBack:r=>1+dC*Math.pow(r-1,3)+jp*Math.pow(r-1,2),easeInOutBack:r=>r<.5?Math.pow(2*r,2)*((Ku+1)*2*r-Ku)/2:(Math.pow(2*r-2,2)*((Ku+1)*(r*2-2)+Ku)+2)/2,easeInElastic:r=>r===0?0:r===1?1:-Math.pow(2,10*r-10)*Math.sin((r*10-10.75)*uC),easeOutElastic:r=>r===0?0:r===1?1:Math.pow(2,-10*r)*Math.sin((r*10-.75)*uC)+1,easeInOutElastic:r=>r===0?0:r===1?1:r<.5?-(Math.pow(2,20*r-10)*Math.sin((20*r-11.125)*hC))/2:Math.pow(2,-20*r+10)*Math.sin((20*r-11.125)*hC)/2+1,easeInBounce:r=>1-Qu(1-r),easeOutBounce:Qu,easeInOutBounce:r=>r<.5?(1-Qu(1-2*r))/2:(1+Qu(2*r-1))/2},k9=[{name:"Basic",easings:["linear"]},{name:"Quad",easings:["easeInQuad","easeOutQuad","easeInOutQuad"]},{name:"Cubic",easings:["easeInCubic","easeOutCubic","easeInOutCubic"]},{name:"Quart",easings:["easeInQuart","easeOutQuart","easeInOutQuart"]},{name:"Quint",easings:["easeInQuint","easeOutQuint","easeInOutQuint"]},{name:"Sine",easings:["easeInSine","easeOutSine","easeInOutSine"]},{name:"Expo",easings:["easeInExpo","easeOutExpo","easeInOutExpo"]},{name:"Circ",easings:["easeInCirc","easeOutCirc","easeInOutCirc"]},{name:"Back",easings:["easeInBack","easeOutBack","easeInOutBack"]},{name:"Elastic",easings:["easeInElastic","easeOutElastic","easeInOutElastic"]},{name:"Bounce",easings:["easeInBounce","easeOutBounce","easeInOutBounce"]}];class Cu{bezierCache=new Map;getValueAtTime(e,t){if(e.length===0)return{value:void 0,keyframeA:null,keyframeB:null,progress:0};const s=[...e].sort((h,p)=>h.time-p.time);if(t<=s[0].time)return{value:s[0].value,keyframeA:s[0],keyframeB:null,progress:0};if(t>=s[s.length-1].time)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1};let i=null,n=null;for(let h=0;h<s.length-1;h++)if(t>=s[h].time&&t<=s[h+1].time){i=s[h],n=s[h+1];break}if(!i||!n)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1};const a=n.time-i.time,o=t-i.time,l=a>0?o/a:0,d=this.applyEasing(l,i.easing);return{value:this.interpolateValue(i.value,n.value,d),keyframeA:i,keyframeB:n,progress:d}}interpolate(e,t,s){const[i,n]=e.time<=t.time?[e,t]:[t,e],a=Math.max(i.time,Math.min(n.time,s)),o=n.time-i.time,l=a-i.time,d=o>0?l/o:0,u=this.applyEasing(d,i.easing);return this.interpolateValue(i.value,n.value,u)}applyEasing(e,t,s){const i=Math.max(0,Math.min(1,e));if(t==="bezier")return s?this.cubicBezier(i,s.x1,s.y1,s.x2,s.y2):this.cubicBezier(i,.25,.1,.25,1);if(t==="ease-in")return ni.easeInQuad(i);if(t==="ease-out")return ni.easeOutQuad(i);if(t==="ease-in-out")return ni.easeInOutQuad(i);const n=ni[t];return n?n(i):i}cubicBezier(e,t,s,i,n){const a=`${t},${s},${i},${n}`;let o=this.bezierCache.get(a);return o||(o=this.createBezierFunction(t,s,i,n),this.bezierCache.set(a,o)),o(e)}createBezierFunction(e,t,s,i){const d=3*e-3*s+1,u=3*s-6*e,h=3*e,p=3*t-3*i+1,f=3*i-6*t,m=3*t,g=w=>((d*w+u)*w+h)*w,y=w=>((p*w+f)*w+m)*w,x=w=>(3*d*w+2*u)*w+h,b=w=>{let C=w;for(let A=0;A<4;A++){const T=x(C);if(Math.abs(T)<.001)break;const j=g(C)-w;C-=j/T}let k=0,S=1;C=w;for(let A=0;A<10;A++){const T=g(C)-w;if(Math.abs(T)<1e-7)break;T>0?S=C:k=C,C=(S+k)/2}return C};return w=>w===0?0:w===1?1:y(b(w))}interpolateValue(e,t,s){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*s;if(typeof e=="object"&&typeof t=="object"&&e!==null&&t!==null){const i={},n=e,a=t;for(const o of Object.keys(n))o in a?i[o]=this.interpolateValue(n[o],a[o],s):i[o]=n[o];return i}return s<.5?e:t}addKeyframe(e,t){const s=e.findIndex(i=>i.time===t.time&&i.property===t.property);if(s>=0){const i=[...e];return i[s]=t,i}return[...e,t].sort((i,n)=>i.time-n.time)}removeKeyframe(e,t){return e.filter(s=>s.id!==t)}updateKeyframe(e,t,s){const i=e.map(n=>n.id===t?{...n,...s}:n);return s.time!==void 0&&i.sort((n,a)=>n.time-a.time),i}getKeyframesForProperty(e,t){return e.filter(s=>s.property===t).sort((s,i)=>s.time-i.time)}findKeyframeAtTime(e,t,s,i=.001){return e.find(n=>n.property===t&&Math.abs(n.time-s)<=i)||null}clearCache(){this.bezierCache.clear()}}class C9{animationEngine;constructor(){this.animationEngine=new Cu}getAnimatedState(e,t){const{animation:s,style:i,transform:n,text:a,keyframes:o}=e;if(o&&o.length>0)return this.applyKeyframeAnimation(e,t);if(!s||s.preset==="none")return{opacity:n.opacity,transform:n,style:i,visibleText:a};const l=e.duration,d=s.inDuration,u=s.outDuration,h=l-u;let p=1,f=0;t<d&&(p=d>0?t/d:1),t>h&&u>0&&(f=(t-h)/u);const m=s.params.easing??"ease-out",g=this.animationEngine.applyEasing(p,m),y=this.animationEngine.applyEasing(f,m);return this.applyPreset(e,s.preset,s.params,g,y,t)}applyKeyframeAnimation(e,t){const{style:s,transform:i,text:n,keyframes:a}=e;let o=i.position.x,l=i.position.y,d=i.scale.x,u=i.scale.y,h=i.rotation,p=i.opacity;const f=new Map;for(const g of a)f.has(g.property)||f.set(g.property,[]),f.get(g.property).push(g);for(const[g,y]of f){const x=this.animationEngine.getValueAtTime(y,t);if(x.value!==void 0&&typeof x.value=="number")switch(g){case"opacity":p=Math.max(0,Math.min(1,x.value));break;case"position.x":o=x.value;break;case"position.y":l=x.value;break;case"scale.x":d=x.value;break;case"scale.y":u=x.value;break;case"rotation":h=x.value;break}}const m={position:{x:o,y:l},scale:{x:d,y:u},rotation:h,opacity:p,anchor:{...i.anchor}};return{opacity:m.opacity,transform:m,style:s,visibleText:n}}applyPreset(e,t,s,i,n,a){const{style:o,transform:l,text:d}=e;switch(t){case"typewriter":return this.applyTypewriter(e,i,n,a);case"fade":return this.applyFade(e,i,n,s);case"slide-left":return this.applySlide(e,i,n,s,"left");case"slide-right":return this.applySlide(e,i,n,s,"right");case"slide-up":return this.applySlide(e,i,n,s,"up");case"slide-down":return this.applySlide(e,i,n,s,"down");case"scale":return this.applyScale(e,i,n,s);case"blur":return this.applyBlur(e,i,n,s);case"bounce":return this.applyBounce(e,i,n,s);case"rotate":return this.applyRotate(e,i,n,s);case"wave":return this.applyWave(e,i,n,s,a);case"shake":return this.applyShake(e,i,n,s,a);case"pop":return this.applyPop(e,i,n,s);case"glitch":return this.applyGlitch(e,i,n,s,a);case"split":return this.applySplit(e,i,n,s);case"flip":return this.applyFlip(e,i,n,s);case"word-by-word":return this.applyWordByWord(e,i,n,s,a);case"rainbow":return this.applyRainbow(e,i,n,s,a);default:return{opacity:l.opacity,transform:l,style:o,visibleText:d}}}applyTypewriter(e,t,s,i){const{style:n,transform:a,text:o}=e,l=o.length,d=Math.floor(t*l),u=o.substring(0,d),h=a.opacity*(1-s);return{opacity:h,transform:{...a,opacity:h},style:n,visibleText:u}}applyFade(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.fadeOpacity?.start??0,d=i.fadeOpacity?.end??1;let u=l+(d-l)*t;return u=u*(1-s),{opacity:u,transform:{...a,opacity:u},style:n,visibleText:o}}applySlide(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.slideDistance??.2;let u=0,h=0;switch(n){case"left":u=-d*(1-t)+d*s;break;case"right":u=d*(1-t)-d*s;break;case"up":h=-d*(1-t)+d*s;break;case"down":h=d*(1-t)-d*s;break}const p=o.opacity*t*(1-s),f={...o,position:{x:o.position.x+u,y:o.position.y+h},opacity:p};return{opacity:p,transform:f,style:a,visibleText:l}}applyScale(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.scaleFrom??0,d=i.scaleTo??1;let u=l+(d-l)*t;u=u*(1-s)+l*s;const h=a.opacity*t*(1-s),p={...a,scale:{x:u,y:u},opacity:h};return{opacity:h,transform:p,style:n,visibleText:o}}applyBlur(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.blurAmount??10,d=l*(1-t)+l*s,u=a.opacity*t*(1-s),h={...n,shadowColor:n.color,shadowBlur:d,shadowOffsetX:0,shadowOffsetY:0};return{opacity:u,transform:{...a,opacity:u},style:h,visibleText:o}}applyBounce(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.bounceHeight??.1,d=i.bounceCount??3;let u=0;if(t<1){const f=t*Math.PI*d,m=1-t;u=-Math.abs(Math.sin(f))*l*m}if(s>0){const f=s*Math.PI;u=Math.sin(f)*l*s}const h=a.opacity*Math.min(t*2,1)*(1-s),p={...a,position:{x:a.position.x,y:a.position.y+u},opacity:h};return{opacity:h,transform:p,style:n,visibleText:o}}applyRotate(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.rotateAngle??360;let d=a.rotation+l*(1-t);d=d-l*s;const u=a.opacity*t*(1-s),h={...a,rotation:d,opacity:u};return{opacity:u,transform:h,style:n,visibleText:o}}applyWave(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.waveAmplitude??.02,u=i.waveFrequency??2,h=o.opacity*t*(1-s),p=l.split("").map((f,m)=>{const g=m/l.length*Math.PI*2*u,y=Math.sin(n*5+g)*d*t;return{char:f,index:m,opacity:h,offsetX:0,offsetY:y,scale:1,rotation:0}});return{opacity:h,transform:{...o,opacity:h},style:a,visibleText:l,characterStates:p}}applyShake(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.shakeIntensity??.01,u=i.shakeSpeed??20,h=Math.sin(n*u)*d*t*(1-s),p=Math.cos(n*u*1.3)*d*t*(1-s),f=o.opacity*t*(1-s),m={...o,position:{x:o.position.x+h,y:o.position.y+p},opacity:f};return{opacity:f,transform:m,style:a,visibleText:l}}applyPop(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.popOvershoot??1.2;let d=0;t<.5?d=t*2*l:t<.7?d=l-(t-.5)*(l-1)/.2:d=1,d=d*(1-s);const u=a.opacity*Math.min(t*2,1)*(1-s),h={...a,scale:{x:d,y:d},opacity:u};return{opacity:u,transform:h,style:n,visibleText:o}}applyGlitch(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.glitchIntensity??.02,u=i.glitchSpeed??10,h=Math.sin(n*u)>.7,p=h?(Math.random()-.5)*d:0,f=h?(Math.random()-.5)*5:0,m=o.opacity*t*(1-s),g={...o,position:{x:o.position.x+p*t,y:o.position.y},rotation:o.rotation+f*t,opacity:m},y={...a,letterSpacing:a.letterSpacing+(h?Math.random()*2:0)};return{opacity:m,transform:g,style:y,visibleText:l}}applySplit(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.splitDirection??"horizontal",d=.1*(1-t)+.1*s,u=a.opacity*t*(1-s),h=o.split("").map((p,f)=>{const m=f<o.length/2,g=l==="horizontal"?{x:m?-d:d,y:0}:{x:0,y:m?-d:d};return{char:p,index:f,opacity:u,offsetX:g.x,offsetY:g.y,scale:1,rotation:0}});return{opacity:u,transform:{...a,opacity:u},style:n,visibleText:o,characterStates:h}}applyFlip(e,t,s,i){const{style:n,transform:a,text:o}=e,l=i.flipAxis??"y",d=(1-t)*Math.PI+s*Math.PI,u=Math.abs(Math.cos(d)),h=a.opacity*t*(1-s),p={...a,scale:l==="y"?{x:u,y:a.scale.y}:{x:a.scale.x,y:u},opacity:h};return{opacity:h,transform:p,style:n,visibleText:o}}applyWordByWord(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=l.split(" "),u=Math.ceil(t*d.length),h=d.slice(0,u).join(" "),p=o.opacity*(1-s);return{opacity:p,transform:{...o,opacity:p},style:a,visibleText:h}}applyRainbow(e,t,s,i,n){const{style:a,transform:o,text:l}=e,d=i.rainbowSpeed??1,u=n*d*100%360,h=o.opacity*t*(1-s),p=l.split("").map((m,g)=>({char:m,index:g,opacity:h,offsetX:0,offsetY:0,scale:1,rotation:0})),f={...a,color:`hsl(${u}, 100%, 50%)`};return{opacity:h,transform:{...o,opacity:h},style:f,visibleText:l,characterStates:p}}createAnimationPreset(e,t=.5,s=.5,i={}){const n=this.getDefaultParams(e);return{preset:e,params:{...n,...i},inDuration:t,outDuration:s}}getDefaultParams(e){switch(e){case"fade":return{fadeOpacity:{start:0,end:1},easing:"ease-out"};case"slide-left":case"slide-right":case"slide-up":case"slide-down":return{slideDistance:.2,easing:"ease-out"};case"scale":return{scaleFrom:0,scaleTo:1,easing:"ease-out"};case"blur":return{blurAmount:10,easing:"ease-out"};case"bounce":return{bounceHeight:.1,bounceCount:3,easing:"ease-out"};case"rotate":return{rotateAngle:360,easing:"ease-out"};case"wave":return{waveAmplitude:.02,waveFrequency:2,easing:"linear"};case"typewriter":return{easing:"linear"};case"shake":return{shakeIntensity:.01,shakeSpeed:20,easing:"linear"};case"pop":return{popOvershoot:1.2,easing:"ease-out"};case"glitch":return{glitchIntensity:.02,glitchSpeed:10,easing:"linear"};case"split":return{splitDirection:"horizontal",easing:"ease-out"};case"flip":return{flipAxis:"y",easing:"ease-out"};case"word-by-word":return{wordDelay:.2,easing:"linear"};case"rainbow":return{rainbowSpeed:1,easing:"linear"};default:return{easing:"ease-out"}}}getAvailablePresets(){return["none","typewriter","fade","slide-left","slide-right","slide-up","slide-down","scale","blur","bounce","rotate","wave","shake","pop","glitch","split","flip","word-by-word","rainbow"]}}const _p=new C9;class S9{textClips=new Map;canvas=null;ctx=null;initialize(e=1920,t=1080){typeof OffscreenCanvas<"u"?this.canvas=new OffscreenCanvas(e,t):(this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t),this.ctx=this.canvas.getContext("2d")}createTextClip(e){const t=e.id||this.generateId(),s={...v9,...e.style},i={...w9,...e.transform},n={id:t,trackId:e.trackId,startTime:e.startTime,duration:e.duration??5,text:e.text,style:s,transform:i,animation:e.animation,keyframes:[]};return this.textClips.set(t,n),n}getTextClip(e){return this.textClips.get(e)}getAllTextClips(){return Array.from(this.textClips.values())}getTextClipsForTrack(e){return Array.from(this.textClips.values()).filter(t=>t.trackId===e)}updateTextClip(e,t){const s=this.textClips.get(e);if(!s)return;const i={...s,text:t.text??s.text,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,style:t.style?{...s.style,...t.style}:s.style,transform:t.transform?{...s.transform,...t.transform}:s.transform,animation:t.animation??s.animation,keyframes:t.keyframes??s.keyframes,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation};return this.textClips.set(e,i),i}updateText(e,t){return this.updateTextClip(e,{text:t})}updateStyle(e,t){return this.updateTextClip(e,{style:t})}updatePosition(e,t){return this.updateTextClip(e,{transform:{position:t}})}deleteTextClip(e){return this.textClips.delete(e)}addKeyframe(e,t){const s=this.textClips.get(e);if(!s)return;const i=s.keyframes.findIndex(o=>o.time===t.time&&o.property===t.property);let n;i>=0?(n=[...s.keyframes],n[i]=t):n=[...s.keyframes,t].sort((o,l)=>o.time-l.time);const a={...s,keyframes:n};return this.textClips.set(e,a),a}removeKeyframe(e,t){const s=this.textClips.get(e);if(!s)return;const i={...s,keyframes:s.keyframes.filter(n=>n.id!==t)};return this.textClips.set(e,i),i}renderText(e,t,s,i=0){let n,a;typeof OffscreenCanvas<"u"?n=new OffscreenCanvas(t,s):(n=document.createElement("canvas"),n.width=t,n.height=s),a=n.getContext("2d"),a.clearRect(0,0,t,s);const o=_p.getAnimatedState(e,i);let{opacity:l,transform:d,style:u,visibleText:h,characterStates:p}=o;if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"){const C=this.applyEmphasisAnimation(e.emphasisAnimation,i);l=l*C.opacity,d={...d,scale:{x:d.scale.x*C.scale*C.scaleX,y:d.scale.y*C.scale*C.scaleY},position:{x:d.position.x+C.offsetX,y:d.position.y+C.offsetY},rotation:d.rotation+C.rotation}}if(l<=0||h.length===0)return{canvas:n,width:t,height:s,textMetrics:this.measureText("",e.style,t)};const f=this.measureText(h,u,t);a.save();const m=d.position.x*t,g=d.position.y*s;a.translate(m,g),a.rotate(d.rotation*Math.PI/180),a.scale(d.scale.x,d.scale.y),a.globalAlpha=l,this.applyTextStyle(a,u);const y=h.split(`
`),x=u.fontSize*u.lineHeight,b=y.length*x;let w=-b/2+x/2;if(u.verticalAlign==="top"?w=0:u.verticalAlign==="bottom"&&(w=-b),u.backgroundColor){const C=f.width+20,k=b;a.fillStyle=u.backgroundColor,a.fillRect(-C/2,-k/2,C,k)}if(p&&p.length>0){let C=0;for(let k=0;k<y.length;k++){const S=y[k],A=w+k*x;let T=0;const j=a.measureText(S).width,_=u.textAlign==="center"?-j/2:u.textAlign==="right"?-j:0;for(const M of S){if(C<p.length){const P=p[C],R=a.measureText(M).width;a.save(),a.globalAlpha=l*P.opacity,a.translate(_+T+P.offsetX+R/2,A+P.offsetY),a.rotate(P.rotation*Math.PI/180),a.scale(P.scale,P.scale),u.strokeColor&&u.strokeWidth&&(a.strokeStyle=u.strokeColor,a.lineWidth=u.strokeWidth,a.strokeText(M,0,0)),a.fillStyle=u.color,a.fillText(M,0,0),a.restore(),T+=R}C++}C++}}else for(let C=0;C<y.length;C++){const k=y[C],S=w+C*x;if(u.backgroundColor){const T=a.measureText(k).width+20,j=x;a.fillStyle=u.backgroundColor,a.fillRect(-T/2,S-j/2,T,j)}u.strokeColor&&u.strokeWidth&&(a.strokeStyle=u.strokeColor,a.lineWidth=u.strokeWidth,a.strokeText(k,0,S)),a.fillStyle=u.color,a.fillText(k,0,S)}return a.restore(),{canvas:n,width:t,height:s,textMetrics:f}}measureText(e,t,s){this.ctx||this.initialize();const i=this.ctx;this.applyTextStyle(i,t);const n=this.wrapText(e,t,s),a=t.fontSize*t.lineHeight,o=n.map(u=>{const h=i.measureText(u);return{text:u,width:h.width,height:a,baseline:t.fontSize*.8}}),l=Math.max(...o.map(u=>u.width)),d=o.reduce((u,h)=>u+h.height,0);return{width:l,height:d,lines:o}}wrapText(e,t,s){if(!s)return e.split(`
`);this.ctx||this.initialize();const i=this.ctx;this.applyTextStyle(i,t);const n=e.split(`
`),a=[];for(const o of n){const l=o.split(" ");let d="";for(const u of l){const h=d?`${d} ${u}`:u;i.measureText(h).width>s&&d?(a.push(d),d=u):d=h}d&&a.push(d)}return a.length>0?a:[""]}applyTextStyle(e,t){const s=typeof t.fontWeight=="number"?t.fontWeight.toString():t.fontWeight;e.font=`${t.fontStyle} ${s} ${t.fontSize}px "${t.fontFamily}"`,e.fillStyle=t.color,e.textAlign=t.textAlign,e.textBaseline="middle",t.shadowColor?(e.shadowColor=t.shadowColor,e.shadowBlur=t.shadowBlur??0,e.shadowOffsetX=t.shadowOffsetX??0,e.shadowOffsetY=t.shadowOffsetY??0):(e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),"letterSpacing"in e&&t.letterSpacing!==0&&(e.letterSpacing=`${t.letterSpacing}px`)}generateId(){return`text-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}clear(){this.textClips.clear()}loadTextClips(e){this.textClips.clear();for(const t of e)this.textClips.set(t.id,t)}exportTextClips(){return Array.from(this.textClips.values())}applyEmphasisAnimation(e,t){const{type:s,speed:i,intensity:n,loop:a,startTime:o,animationDuration:l}=e,d=o??0;if(t<d)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};if(l!==void 0&&l>0){const f=d+l;if(t>f)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}const u=t-d,h=a?u*i%1:Math.min(u*i,1),p=h*Math.PI*2;switch(s){case"pulse":return{opacity:1,scale:1+Math.sin(p)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":{const f=Math.sin(p*5)*.02*n,m=Math.cos(p*5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:f,offsetY:m,rotation:0}}case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(p))*-.05*n,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(p)*.03*n,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:h*360*n};case"flash":return{opacity:.5+Math.abs(Math.sin(p))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":{const f=h*4;let m=1;return f<1?m=1+.15*n*Math.sin(f*Math.PI):f<2&&(m=1+.1*n*Math.sin((f-1)*Math.PI)),{opacity:1,scale:m,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p)*15*n};case"wobble":{const f=Math.sin(p*3)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(p)*.02*n,offsetY:0,rotation:f}}case"jello":{const f=1+Math.sin(p*2)*.1*n,m=1-Math.sin(p*2)*.1*n;return{opacity:1,scale:1,scaleX:f,scaleY:m,offsetX:0,offsetY:0,rotation:0}}case"rubber-band":{const f=1+Math.sin(p)*.2*n,m=1-Math.sin(p)*.1*n;return{opacity:1,scale:1,scaleX:f,scaleY:m,offsetX:0,offsetY:0,rotation:0}}case"tada":{const f=Math.sin(p*4)*10*n;return{opacity:1,scale:1+Math.sin(p*2)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:f}}case"vibrate":{const f=(Math.random()-.5)*.02*n,m=(Math.random()-.5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:f,offsetY:m,rotation:0}}case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":{const f=1+Math.sin(p)*.05*n;return{opacity:.8+Math.sin(p)*.2,scale:f,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"breathe":return{opacity:1,scale:1+Math.sin(p*.5)*.08*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":{const f=Math.sin(p+u*2)*.03*n,m=Math.sin(p)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:f,rotation:m}}case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p*.5)*10*n};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(p)*.15*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const f=e.focusPoint||{x:.5,y:.5},m=e.zoomScale||1.5,g=e.holdDuration||.3,y=.3,x=1-g-y;let b=1,w=0,C=0;if(h<y){const k=h/y,S=1-Math.pow(1-k,3);b=1+(m-1)*S*n,w=(.5-f.x)*(b-1),C=(.5-f.y)*(b-1)}else if(h<y+g)b=m*n,w=(.5-f.x)*(b-1),C=(.5-f.y)*(b-1);else{const k=(h-y-g)/x,S=Math.pow(k,3);b=m-(m-1)*S*n,w=(.5-f.x)*(b-1),C=(.5-f.y)*(b-1)}return{opacity:1,scale:b,scaleX:1,scaleY:1,offsetX:w,offsetY:C,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-h*.2*n,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:h*.2*n,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-h*.2*n,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:h*.2*n,rotation:0};case"ken-burns":{const f=1+h*.3*n,m=h*.1*n,g=h*.05*n;return{opacity:1,scale:f,scaleX:1,scaleY:1,offsetX:m,offsetY:g,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}}}const go=new S9,Tm={fill:{type:"solid",color:"#3b82f6",opacity:1},stroke:{color:"#1d4ed8",width:2,opacity:1}},Ep={position:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1};class T9{animationEngine;svgCache=new Map;imageCache=new Map;shapeClips=new Map;svgClips=new Map;stickerClips=new Map;constructor(e){this.animationEngine=e||new Cu}createShape(e,t,s,i){const n=this.generateId(),a={...Tm,...e.style,fill:{...Tm.fill,...e.style?.fill},stroke:{...Tm.stroke,...e.style?.stroke}},o={id:n,trackId:t,startTime:s,duration:i,type:"shape",shapeType:e.shapeType,style:a,transform:{...Ep},keyframes:[],points:e.points};return this.shapeClips.set(n,o),o}createRectangle(e,t,s,i,n,a){return this.createShape({shapeType:"rectangle",width:i,height:n,style:a},e,t,s)}createCircle(e,t,s,i,n){return this.createShape({shapeType:"circle",width:i*2,height:i*2,style:n},e,t,s)}createArrow(e,t,s,i,n,a,o){const l={headWidth:n*.6,headLength:i*.3,tailWidth:n*.3,curved:!1,doubleHeaded:!1};return this.createShape({shapeType:"arrow",width:i,height:n,style:o,arrowProps:{...l,...a}},e,t,s)}updateShapeStyle(e,t){const s={...e,style:{...e.style,...t,fill:t.fill?{...e.style.fill,...t.fill}:e.style.fill,stroke:t.stroke?{...e.style.stroke,...t.stroke}:e.style.stroke}};return this.shapeClips.set(s.id,s),s}updateFill(e,t){return this.updateShapeStyle(e,{fill:{...e.style.fill,...t}})}updateStroke(e,t){return this.updateShapeStyle(e,{stroke:{...e.style.stroke,...t}})}updateShapeClip(e,t){const s=this.shapeClips.get(e);if(!s)return;const i={...s,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,transform:t.transform?{...s.transform,...t.transform}:s.transform,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation,keyframes:t.keyframes??s.keyframes};return this.shapeClips.set(e,i),i}updateTransform(e,t){return{...e,transform:{...e.transform,...t}}}importSVG(e,t,s,i){const n=this.parseSVG(e),a=this.generateId(),o={id:a,trackId:t,startTime:s,duration:i,type:"svg",svgContent:n.svgContent,viewBox:n.viewBox,preserveAspectRatio:"xMidYMid",transform:{...Ep},keyframes:[],colorStyle:{colorMode:"none",tintColor:"#ffffff",tintOpacity:1},entryAnimation:{type:"none",duration:.5,easing:"ease-out"},exitAnimation:{type:"none",duration:.5,easing:"ease-in"}};return this.svgClips.set(a,o),o}parseSVG(e){const i=new DOMParser().parseFromString(e,"image/svg+xml").querySelector("svg");if(!i)throw new Error("Invalid SVG content: no svg element found");const n=i.getAttribute("viewBox");let a={minX:0,minY:0,width:100,height:100};if(n){const o=n.split(/[\s,]+/).map(Number);o.length===4&&(a={minX:o[0],minY:o[1],width:o[2],height:o[3]})}else{const o=parseFloat(i.getAttribute("width")||"100"),l=parseFloat(i.getAttribute("height")||"100");a={minX:0,minY:0,width:o,height:l}}return{svgContent:e,viewBox:a,width:a.width,height:a.height}}async renderGraphic(e,t,s,i){const n=typeof OffscreenCanvas<"u"?new OffscreenCanvas(s,i):document.createElement("canvas");n instanceof HTMLCanvasElement&&(n.width=s,n.height=i);const a=n.getContext("2d");if(!a)throw new Error("Failed to get canvas context");const o=this.getAnimatedGraphicState(e,t);if(o.opacity<=0)return{canvas:n,width:s,height:i};switch(this.applyTransform(a,o.transform,s,i),e.type){case"shape":this.renderShape(a,e,s,i);break;case"svg":await this.renderSVG(a,e,s,i,o);break;case"sticker":case"emoji":await this.renderSticker(a,e,s,i);break}return{canvas:n,width:s,height:i}}renderShape(e,t,s,i){const{style:n,shapeType:a}=t,l=Math.min(s,i)*.15,d=l/2;switch(e.save(),n.shadow&&(e.shadowColor=n.shadow.color,e.shadowBlur=n.shadow.blur,e.shadowOffsetX=n.shadow.offsetX,e.shadowOffsetY=n.shadow.offsetY),e.beginPath(),a){case"rectangle":this.drawRectangle(e,0,0,l,l,n.cornerRadius);break;case"circle":this.drawCircle(e,0,0,d);break;case"ellipse":this.drawEllipse(e,0,0,d,d);break;case"triangle":this.drawTriangle(e,0,0,l,l);break;case"arrow":this.drawArrow(e,0,0,l,l);break;case"line":this.drawLine(e,-d,0,d,0);break;case"star":this.drawStar(e,0,0,d,n.points||5,n.innerRadius||.5);break;case"polygon":t.points&&t.points.length>0&&this.drawPolygonCentered(e,t.points,l);break}n.fill.type!=="none"&&(e.globalAlpha=n.fill.opacity,n.fill.type==="gradient"&&n.fill.gradient?e.fillStyle=this.createGradient(e,n.fill.gradient,l,l):e.fillStyle=n.fill.color||"#000000",e.fill()),n.stroke.width>0&&(e.globalAlpha=n.stroke.opacity,e.strokeStyle=n.stroke.color,e.lineWidth=n.stroke.width,e.lineCap=n.stroke.lineCap||"butt",e.lineJoin=n.stroke.lineJoin||"miter",n.stroke.dashArray&&(e.setLineDash(n.stroke.dashArray),e.lineDashOffset=n.stroke.dashOffset||0),e.stroke()),e.restore()}async renderSVG(e,t,s,i,n){const a=t.svgContent,o=new Blob([a],{type:"image/svg+xml"}),l=URL.createObjectURL(o);try{const d=await this.loadImage(l),u=t.viewBox.width,h=t.viewBox.height;if(n.blur>0&&(e.filter=`blur(${n.blur}px)`),t.colorStyle&&t.colorStyle.colorMode!=="none"&&(t.colorStyle.colorMode==="tint"||t.colorStyle.colorMode==="replace")){const p=new OffscreenCanvas(u,h),f=p.getContext("2d");f?(f.drawImage(d,0,0,u,h),f.globalCompositeOperation="source-in",f.fillStyle=t.colorStyle.tintColor||"#ffffff",f.globalAlpha=t.colorStyle.tintOpacity??1,f.fillRect(0,0,u,h),e.drawImage(p,-u/2,-h/2)):e.drawImage(d,-u/2,-h/2,u,h)}else e.drawImage(d,-u/2,-h/2,u,h);e.filter="none"}finally{URL.revokeObjectURL(l)}}async renderSticker(e,t,s,i){const n=await this.loadImage(t.imageUrl),a=n.width,o=n.height,l=t.transform.anchor?.x??.5,d=t.transform.anchor?.y??.5;e.drawImage(n,-a*l,-o*d,a,o)}drawRectangle(e,t,s,i,n,a){const o=t-i/2,l=s-n/2;if(a&&a>0){const d=Math.min(a,i/2,n/2);e.moveTo(o+d,l),e.lineTo(o+i-d,l),e.quadraticCurveTo(o+i,l,o+i,l+d),e.lineTo(o+i,l+n-d),e.quadraticCurveTo(o+i,l+n,o+i-d,l+n),e.lineTo(o+d,l+n),e.quadraticCurveTo(o,l+n,o,l+n-d),e.lineTo(o,l+d),e.quadraticCurveTo(o,l,o+d,l)}else e.rect(o,l,i,n)}drawCircle(e,t,s,i){e.arc(t,s,i,0,Math.PI*2)}drawEllipse(e,t,s,i,n){e.ellipse(t,s,i,n,0,0,Math.PI*2)}drawTriangle(e,t,s,i,n){e.moveTo(t,s-n/2),e.lineTo(t+i/2,s+n/2),e.lineTo(t-i/2,s+n/2),e.closePath()}drawArrow(e,t,s,i,n){const a=n*.6,o=i*.3,l=n*.3,d=t-i/2,u=t+i/2,h=u-o;e.moveTo(d,s-l/2),e.lineTo(h,s-l/2),e.lineTo(h,s-a/2),e.lineTo(u,s),e.lineTo(h,s+a/2),e.lineTo(h,s+l/2),e.lineTo(d,s+l/2),e.closePath()}drawLine(e,t,s,i,n){e.moveTo(t,s),e.lineTo(i,n)}drawStar(e,t,s,i,n,a){const o=i*a,l=Math.PI/n;e.moveTo(t,s-i);for(let d=0;d<n*2;d++){const u=d%2===0?i:o,h=-Math.PI/2+d*l;e.lineTo(t+Math.cos(h)*u,s+Math.sin(h)*u)}e.closePath()}drawPolygonCentered(e,t,s){if(t.length<2)return;const i=s/2;e.moveTo(t[0].x*s-i,t[0].y*s-i);for(let n=1;n<t.length;n++)e.lineTo(t[n].x*s-i,t[n].y*s-i);e.closePath()}createGradient(e,t,s,i){let n;if(t.type==="linear"){const a=(t.angle||0)*Math.PI/180,o=s/2-Math.cos(a)*s/2,l=i/2-Math.sin(a)*i/2,d=s/2+Math.cos(a)*s/2,u=i/2+Math.sin(a)*i/2;n=e.createLinearGradient(o,l,d,u)}else n=e.createRadialGradient(s/2,i/2,0,s/2,i/2,Math.max(s,i)/2);for(const a of t.stops)n.addColorStop(a.offset,a.color);return n}getAnimatedGraphicState(e,t){let s={...e.transform},i=s.opacity,n=1,a=1,o=1,l=0,d=0,u=0,h=0;e.keyframes.length>0&&(s=this.getAnimatedTransform(e,t),i=s.opacity);let p=!1,f=!1;if(e.type==="svg"){const m=e,g=m.entryAnimation,y=m.exitAnimation;if(g||y){const x=g?.duration||0,b=y?.duration||0,C=e.duration-b;if(g&&t<x){p=!0;const k=x>0?t/x:1,S=this.applyGraphicAnimation(g.type,k,g.easing,!0);n*=S.scale,l+=S.offsetX,d+=S.offsetY,u+=S.rotation,i*=S.opacity,h=S.blur}if(y&&t>=C){f=!0;const k=b>0?(t-C)/b:1,S=this.applyGraphicAnimation(y.type,k,y.easing,!1);n*=S.scale,l+=S.offsetX,d+=S.offsetY,u+=S.rotation,i*=S.opacity,h=Math.max(h,S.blur)}}}if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"&&!p&&!f){const m=this.applyEmphasisAnimation(e.emphasisAnimation,t);n*=m.scale,a*=m.scaleX,o*=m.scaleY,l+=m.offsetX,d+=m.offsetY,u+=m.rotation,i*=m.opacity}return{transform:{...s,position:{x:s.position.x+l,y:s.position.y+d},scale:{x:s.scale.x*n*a,y:s.scale.y*n*o},rotation:s.rotation+u,opacity:i,anchor:s.anchor},opacity:i,scale:n,scaleX:a,scaleY:o,offsetX:l,offsetY:d,rotation:u,blur:h}}applyEmphasisAnimation(e,t){const{type:s,speed:i,intensity:n,loop:a,startTime:o,animationDuration:l}=e,d=o??0;if(t<d)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};if(l!==void 0&&l>0){const f=d+l;if(t>f)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}const u=t-d,h=a?u*i%1:Math.min(u*i,1),p=h*Math.PI*2;switch(s){case"pulse":return{opacity:1,scale:1+Math.sin(p)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":const m=Math.sin(p*5)*.02*n,g=Math.cos(p*5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:m,offsetY:g,rotation:0};case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(p))*-.05*n,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(p)*.03*n,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:h*360*n};case"flash":return{opacity:.5+Math.abs(Math.sin(p))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":const C=h*4;let k=1;return C<1?k=1+.15*n*Math.sin(C*Math.PI):C<2&&(k=1+.1*n*Math.sin((C-1)*Math.PI)),{opacity:1,scale:k,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p)*15*n};case"wobble":const A=Math.sin(p*3)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(p)*.02*n,offsetY:0,rotation:A};case"jello":const j=1+Math.sin(p*2)*.1*n,_=1-Math.sin(p*2)*.1*n;return{opacity:1,scale:1,scaleX:j,scaleY:_,offsetX:0,offsetY:0,rotation:0};case"rubber-band":const M=1+Math.sin(p)*.2*n,P=1-Math.sin(p)*.1*n;return{opacity:1,scale:1,scaleX:M,scaleY:P,offsetX:0,offsetY:0,rotation:0};case"tada":const R=Math.sin(p*4)*10*n;return{opacity:1,scale:1+Math.sin(p*2)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:R};case"vibrate":const B=(Math.random()-.5)*.02*n,O=(Math.random()-.5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:B,offsetY:O,rotation:0};case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":const I=1+Math.sin(p)*.05*n;return{opacity:.8+Math.sin(p)*.2,scale:I,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"breathe":return{opacity:1,scale:1+Math.sin(p*.5)*.08*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":const E=Math.sin(p+t*2)*.03*n,G=Math.sin(p)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:E,rotation:G};case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p*.5)*10*n};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(p)*.15*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const K=e.focusPoint||{x:.5,y:.5},me=e.zoomScale||1.5,$=e.holdDuration||.3,Q=.3,le=1-$-Q;let ke=1,de=0,ae=0;if(h<Q){const Pe=h/Q,z=1-Math.pow(1-Pe,3);ke=1+(me-1)*z*n,de=(.5-K.x)*(ke-1),ae=(.5-K.y)*(ke-1)}else if(h<Q+$)ke=me*n,de=(.5-K.x)*(ke-1),ae=(.5-K.y)*(ke-1);else{const Pe=(h-Q-$)/le,z=Math.pow(Pe,3);ke=me-(me-1)*z*n,de=(.5-K.x)*(ke-1),ae=(.5-K.y)*(ke-1)}return{opacity:1,scale:ke,scaleX:1,scaleY:1,offsetX:de,offsetY:ae,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-h*.2*n,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:h*.2*n,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-h*.2*n,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:h*.2*n,rotation:0};case"ken-burns":{const K=1+h*.3*n,me=h*.1*n,$=h*.05*n;return{opacity:1,scale:K,scaleX:1,scaleY:1,offsetX:me,offsetY:$,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}}applyGraphicAnimation(e,t,s,i){const n=this.animationEngine.applyEasing(t,s),a=i?n:1-n;switch(e){case"fade":return{opacity:a,scale:1,offsetX:0,offsetY:0,rotation:0,blur:0};case"slide-left":return{opacity:a,scale:1,offsetX:(1-a)*-1,offsetY:0,rotation:0,blur:0};case"slide-right":return{opacity:a,scale:1,offsetX:(1-a)*1,offsetY:0,rotation:0,blur:0};case"slide-up":return{opacity:a,scale:1,offsetX:0,offsetY:(1-a)*-1,rotation:0,blur:0};case"slide-down":return{opacity:a,scale:1,offsetX:0,offsetY:(1-a)*1,rotation:0,blur:0};case"scale":return{opacity:a,scale:a,offsetX:0,offsetY:0,rotation:0,blur:0};case"rotate":return{opacity:a,scale:1,offsetX:0,offsetY:0,rotation:(1-a)*(i?-180:180),blur:0};case"bounce":const o=Math.abs(Math.sin(a*Math.PI*3))*(1-a);return{opacity:a,scale:1,offsetX:0,offsetY:o*-.1,rotation:0,blur:0};case"pop":const l=1.2;let d=0;return a<.5?d=a*2*l:a<.7?d=l-(a-.5)*(l-1)/.2:d=1,{opacity:Math.min(a*2,1),scale:d,offsetX:0,offsetY:0,rotation:0,blur:0};case"none":default:return{opacity:1,scale:1,offsetX:0,offsetY:0,rotation:0,blur:0}}}getAnimatedTransform(e,t){if(e.keyframes.length===0)return e.transform;const s={...e.transform},i=["position.x","position.y","scale.x","scale.y","rotation","opacity"];for(const n of i){const a=this.animationEngine.getKeyframesForProperty(e.keyframes,n);if(a.length>0){const o=this.animationEngine.getValueAtTime(a,t);o.value!==void 0&&this.setNestedProperty(s,n,o.value)}}return s}applyTransform(e,t,s,i){const n=t.position.x*s,a=t.position.y*i;e.translate(n,a),e.rotate(t.rotation*Math.PI/180),e.scale(t.scale.x,t.scale.y),e.globalAlpha=t.opacity}setNestedProperty(e,t,s){const i=t.split(".");let n=e;for(let a=0;a<i.length-1;a++)i[a]in n||(n[i[a]]={}),n=n[i[a]];n[i[i.length-1]]=s}addKeyframe(e,t){return{...e,keyframes:this.animationEngine.addKeyframe(e.keyframes,t)}}removeKeyframe(e,t){return{...e,keyframes:this.animationEngine.removeKeyframe(e.keyframes,t)}}updateKeyframe(e,t,s){return{...e,keyframes:this.animationEngine.updateKeyframe(e.keyframes,t,s)}}loadImage(e){const t=this.imageCache.get(e);return t?Promise.resolve(t):new Promise((s,i)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{this.imageCache.set(e,n),s(n)},n.onerror=()=>i(new Error(`Failed to load image: ${e}`)),n.src=e})}generateId(){return`graphic_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}getShapeClip(e){return this.shapeClips.get(e)}getSVGClip(e){return this.svgClips.get(e)}getAllShapeClips(){return Array.from(this.shapeClips.values())}getAllSVGClips(){return Array.from(this.svgClips.values())}getShapeClipsForTrack(e){return Array.from(this.shapeClips.values()).filter(t=>t.trackId===e)}getSVGClipsForTrack(e){return Array.from(this.svgClips.values()).filter(t=>t.trackId===e)}deleteShapeClip(e){return this.shapeClips.delete(e)}deleteSVGClip(e){return this.svgClips.delete(e)}updateSVGClip(e,t){const s=this.svgClips.get(e);if(!s){console.warn(`[GraphicsEngine] SVG clip not found: ${e}`);return}const i={...s,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,transform:t.transform?{...s.transform,...t.transform}:s.transform,entryAnimation:t.entryAnimation??s.entryAnimation,exitAnimation:t.exitAnimation??s.exitAnimation,colorStyle:t.colorStyle??s.colorStyle,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation,keyframes:t.keyframes??s.keyframes};return this.svgClips.set(e,i),i}setSVGAnimation(e,t,s){const i={...e,[t==="entry"?"entryAnimation":"exitAnimation"]:s};return this.svgClips.set(e.id,i),i}setSVGColorStyle(e,t){const s={...e,colorStyle:t};return this.svgClips.set(e.id,s),s}addStickerClip(e){this.stickerClips.set(e.id,e)}getStickerClip(e){return this.stickerClips.get(e)}getAllStickerClips(){return Array.from(this.stickerClips.values())}getStickerClipsForTrack(e){return Array.from(this.stickerClips.values()).filter(t=>t.trackId===e)}deleteStickerClip(e){return this.stickerClips.delete(e)}updateStickerClip(e,t){const s=this.stickerClips.get(e);if(!s){console.warn(`[GraphicsEngine] Sticker clip not found: ${e}`);return}const i={...s,startTime:t.startTime??s.startTime,duration:t.duration??s.duration,transform:t.transform?{...s.transform,...t.transform}:s.transform,blendMode:t.blendMode??s.blendMode,blendOpacity:t.blendOpacity??s.blendOpacity,emphasisAnimation:t.emphasisAnimation??s.emphasisAnimation};return this.stickerClips.set(e,i),i}clearCache(){this.svgCache.clear(),this.imageCache.clear(),this.shapeClips.clear(),this.svgClips.clear(),this.stickerClips.clear(),this.animationEngine.clearCache()}loadShapeClips(e){this.shapeClips.clear();for(const t of e)this.shapeClips.set(t.id,t)}loadSVGClips(e){this.svgClips.clear();for(const t of e)this.svgClips.set(t.id,t)}loadStickerClips(e){this.stickerClips.clear();for(const t of e)this.stickerClips.set(t.id,t)}createGraphicAnimation(e,t=.5,s="ease-out"){return{type:e,duration:t,easing:s}}}const br=new T9;function Wc(){return typeof navigator>"u"?!1:"gpu"in navigator&&navigator.gpu!==void 0}function A9(r){return r==="canvas2d"?"canvas2d":Wc()?"webgpu":"canvas2d"}class Jn{static instance=null;currentRenderer=null;config=null;constructor(){}static getInstance(){return Jn.instance||(Jn.instance=new Jn),Jn.instance}isWebGPUSupported(){return Wc()}getRendererType(e){return A9(e)}async createRenderer(e){if(this.config=e,Wc())try{const{WebGPURenderer:i}=await _i(async()=>{const{WebGPURenderer:o}=await import("./webgpu-renderer-impl.js").then(l=>l.w);return{WebGPURenderer:o}},[]),n=new i(e);if(await n.initialize())return this.currentRenderer=n,n;console.warn("[RendererFactory] WebGPU init failed, using Canvas2D")}catch(i){console.warn("[RendererFactory] WebGPU error, using Canvas2D:",i)}const{Canvas2DFallbackRenderer:t}=await _i(async()=>{const{Canvas2DFallbackRenderer:i}=await import("./canvas2d-fallback-renderer.js");return{Canvas2DFallbackRenderer:i}},[]),s=new t(e);return await s.initialize(),this.currentRenderer=s,s}getCurrentRenderer(){return this.currentRenderer}destroyRenderer(){this.currentRenderer&&(this.currentRenderer.destroy(),this.currentRenderer=null)}async recreateRenderer(){return this.config?(this.destroyRenderer(),this.createRenderer(this.config)):null}}function j9(){return Jn.getInstance()}const Ni=`#version 300 es
precision highp float;

in vec2 a_position;
in vec2 a_texCoord;

out vec2 v_texCoord;

void main() {
 gl_Position = vec4(a_position, 0.0, 1.0);
 v_texCoord = a_texCoord;
}
`,_9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;

void main() {
 fragColor = texture(u_texture, v_texCoord);
}
`,E9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_brightness;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 rgb = color.rgb + u_brightness;
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,M9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_contrast;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 rgb = (color.rgb - 0.5) * u_contrast + 0.5;
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,P9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_saturation;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float luminance = dot(color.rgb, vec3(0.299, 0.587, 0.114));
 vec3 rgb = mix(vec3(luminance), color.rgb, u_saturation);
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,N9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_hueRotation;

vec3 rgb2hsv(vec3 c) {
 vec4 K = vec4(0.0, -1.0/3.0, 2.0/3.0, -1.0);
 vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
 vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
 float d = q.x - min(q.w, q.y);
 float e = 1.0e-10;
 return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
}

vec3 hsv2rgb(vec3 c) {
 vec4 K = vec4(1.0, 2.0/3.0, 1.0/3.0, 3.0);
 vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
 return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 hsv = rgb2hsv(color.rgb);
 hsv.x = fract(hsv.x + u_hueRotation / 360.0);
 vec3 rgb = hsv2rgb(hsv);
 fragColor = vec4(rgb, color.a);
}
`,R9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec2 u_resolution;
uniform float u_radius;

void main() {
 vec2 texelSize = 1.0 / u_resolution;
 vec4 color = vec4(0.0);
 float total = 0.0;
 
 int r = int(min(u_radius, 10.0));
 for (int x = -r; x <= r; x++) {
 for (int y = -r; y <= r; y++) {
 vec2 offset = vec2(float(x), float(y)) * texelSize;
 color += texture(u_texture, v_texCoord + offset);
 total += 1.0;
 }
 }
 
 fragColor = color / total;
}
`,I9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec2 u_resolution;
uniform float u_amount;

void main() {
 vec2 texelSize = 1.0 / u_resolution;
 
 vec4 center = texture(u_texture, v_texCoord);
 vec4 top = texture(u_texture, v_texCoord + vec2(0.0, -texelSize.y));
 vec4 bottom = texture(u_texture, v_texCoord + vec2(0.0, texelSize.y));
 vec4 left = texture(u_texture, v_texCoord + vec2(-texelSize.x, 0.0));
 vec4 right = texture(u_texture, v_texCoord + vec2(texelSize.x, 0.0));
 
 vec4 sharpened = center * (1.0 + 4.0 * u_amount) - (top + bottom + left + right) * u_amount;
 fragColor = vec4(clamp(sharpened.rgb, 0.0, 1.0), center.a);
}
`,D9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_amount;
uniform float u_midpoint;
uniform float u_feather;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec2 center = vec2(0.5, 0.5);
 float dist = distance(v_texCoord, center);
 float vignette = smoothstep(u_midpoint - u_feather, u_midpoint + u_feather, dist);
 vec3 rgb = color.rgb * (1.0 - vignette * u_amount);
 fragColor = vec4(rgb, color.a);
}
`,F9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_amount;
uniform float u_size;
uniform float u_time;

float random(vec2 st) {
 return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);
}

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec2 st = v_texCoord * u_size + u_time;
 float noise = random(st) * 2.0 - 1.0;
 vec3 rgb = color.rgb + noise * u_amount;
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,B9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec3 u_keyColor;
uniform float u_tolerance;
uniform float u_softness;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float diff = distance(color.rgb, u_keyColor);
 float alpha = smoothstep(u_tolerance - u_softness, u_tolerance + u_softness, diff);
 fragColor = vec4(color.rgb, color.a * alpha);
}
`,L9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_temperature; // -1 (cool/blue) to 1 (warm/orange)

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 
 // Temperature adjustment using color balance

 vec3 rgb = color.rgb;
 
 if (u_temperature > 0.0) {
 rgb.r = rgb.r + u_temperature * 0.2;
 rgb.g = rgb.g + u_temperature * 0.1;
 rgb.b = rgb.b - u_temperature * 0.2;
 } else {
 rgb.r = rgb.r + u_temperature * 0.2;
 rgb.g = rgb.g + u_temperature * 0.05;
 rgb.b = rgb.b - u_temperature * 0.2;
 }
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,O9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_tint; // -1 (green) to 1 (magenta)

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 
 // Tint adjustment

 vec3 rgb = color.rgb;
 
 rgb.r = rgb.r + u_tint * 0.1;
 rgb.g = rgb.g - u_tint * 0.2;
 rgb.b = rgb.b + u_tint * 0.1;
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,$9=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_shadows; // -1 to 1
uniform float u_midtones; // -1 to 1
uniform float u_highlights; // -1 to 1

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float luma = dot(color.rgb, vec3(0.299, 0.587, 0.114));
 float shadowWeight = 1.0 - smoothstep(0.0, 0.33, luma);
 float highlightWeight = smoothstep(0.66, 1.0, luma);
 float midtoneWeight = 1.0 - shadowWeight - highlightWeight;
 midtoneWeight = max(0.0, midtoneWeight);
 vec3 rgb = color.rgb;
 rgb += u_shadows * shadowWeight * 0.3;
 rgb += u_midtones * midtoneWeight * 0.3;
 rgb += u_highlights * highlightWeight * 0.3;
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`;class Su{canvas=null;gl=null;shaders=new Map;quadBuffer=null;texCoordBuffer=null;framebuffers=[];renderTextures=[];currentRenderTarget=0;width;height;useGPU;preferWebGPU;initialized=!1;initializing=!1;initPromise=null;renderer=null;rendererFactory=null;useNewRenderer=!1;constructor(e){this.width=e.width,this.height=e.height,this.useGPU=e.useGPU??!0,this.preferWebGPU=e.preferWebGPU??!0,this._applyEffectsWithNewRenderer,this._applyEffectsGPU}async initialize(){if(this.initialized)return!0;if(this.initializing&&this.initPromise)return this.initPromise;this.initializing=!0,this.initPromise=this.doInitialize();try{const e=await this.initPromise;return this.initialized=e,e}finally{this.initializing=!1}}async doInitialize(){if(this.useGPU){if(this.preferWebGPU&&Wc())try{return await this.initializeNewRenderer(),!0}catch(e){console.warn("[VideoEffectsEngine] WebGPU initialization failed, falling back to WebGL2:",e)}if(Su.isWebGL2Supported())return this.initializeWebGL(),!0}return!0}async initializeNewRenderer(){try{this.rendererFactory=Jn.getInstance(),this.canvas=new OffscreenCanvas(this.width,this.height);const e={canvas:this.canvas,width:this.width,height:this.height,preferredRenderer:this.preferWebGPU?"webgpu":"canvas2d"};this.renderer=await this.rendererFactory.createRenderer(e),this.useNewRenderer=!0}catch(e){console.warn("[VideoEffectsEngine] Failed to initialize new renderer, falling back to WebGL2:",e),this.useNewRenderer=!1,this.initializeWebGL()}}initializeWebGL(){this.canvas=new OffscreenCanvas(this.width,this.height);const e=this.canvas.getContext("webgl2",{preserveDrawingBuffer:!0,premultipliedAlpha:!0,alpha:!0,antialias:!1});if(!e){console.warn("WebGL2 not available, falling back to CPU processing"),this.useGPU=!1;return}this.gl=e,this.quadBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),this.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),e.STATIC_DRAW);for(let t=0;t<2;t++){const s=e.createFramebuffer(),i=this.createRenderTexture();this.framebuffers.push(s),this.renderTextures.push(i)}this.compileShader("passthrough",Ni,_9),this.compileShader("brightness",Ni,E9),this.compileShader("contrast",Ni,M9),this.compileShader("saturation",Ni,P9),this.compileShader("hue",Ni,N9),this.compileShader("blur",Ni,R9),this.compileShader("sharpen",Ni,I9),this.compileShader("vignette",Ni,D9),this.compileShader("grain",Ni,F9),this.compileShader("chromaKey",Ni,B9),this.compileShader("temperature",Ni,L9),this.compileShader("tint",Ni,O9),this.compileShader("tonal",Ni,$9),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)}createRenderTexture(){const e=this.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t}compileShader(e,t,s){const i=this.gl,n=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error(`Vertex shader error: ${i.getShaderInfoLog(n)}`);const a=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(a,s),i.compileShader(a),!i.getShaderParameter(a,i.COMPILE_STATUS))throw new Error(`Fragment shader error: ${i.getShaderInfoLog(a)}`);const o=i.createProgram();if(i.attachShader(o,n),i.attachShader(o,a),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw new Error(`Program link error: ${i.getProgramInfoLog(o)}`);const l=new Map,d=i.getProgramParameter(o,i.ACTIVE_UNIFORMS);for(let p=0;p<d;p++){const f=i.getActiveUniform(o,p);if(f){const m=i.getUniformLocation(o,f.name);m&&l.set(f.name,m)}}const u=new Map,h=i.getProgramParameter(o,i.ACTIVE_ATTRIBUTES);for(let p=0;p<h;p++){const f=i.getActiveAttrib(o,p);f&&u.set(f.name,i.getAttribLocation(o,f.name))}this.shaders.set(e,{program:o,uniforms:l,attributes:u}),i.deleteShader(n),i.deleteShader(a)}async applyEffects(e,t){const s=performance.now(),i=t.filter(a=>a.enabled);return i.length===0?{image:await createImageBitmap(e),processingTime:performance.now()-s,gpuAccelerated:!1}:{image:await this.applyEffectsCPU(e,i),processingTime:performance.now()-s,gpuAccelerated:!1}}async _applyEffectsWithNewRenderer(e,t){if(!this.renderer)throw new Error("Renderer not initialized");try{const s=this.renderer.createTextureFromImage(e),i=this.renderer.applyEffects(s,t);this.renderer.beginFrame(),this.renderer.renderLayer({texture:i,transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,anchor:{x:.5,y:.5}},effects:[],opacity:1,borderRadius:0});const n=await this.renderer.endFrame();return this.renderer.releaseTexture(s),!n||n.width===0||n.height===0?(console.warn("[VideoEffectsEngine] Renderer returned invalid result, using CPU fallback"),this.applyEffectsCPU(e,t)):n}catch(s){return console.warn("[VideoEffectsEngine] applyEffectsWithNewRenderer failed:",s),this.applyEffectsCPU(e,t)}}async _applyEffectsGPU(e,t){const s=this.gl;if(s.isContextLost())return console.warn("[VideoEffectsEngine] WebGL context lost, falling back to CPU"),this.applyEffectsCPU(e,t);try{if(this.canvas.width!==e.width||this.canvas.height!==e.height){this.canvas.width=e.width,this.canvas.height=e.height,this.width=e.width,this.height=e.height;for(let o=0;o<2;o++)s.bindTexture(s.TEXTURE_2D,this.renderTextures[o]),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,this.width,this.height,0,s.RGBA,s.UNSIGNED_BYTE,null)}const i=this.uploadTexture(e);for(let o=0;o<2;o++)s.bindFramebuffer(s.FRAMEBUFFER,this.framebuffers[o]),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this.renderTextures[o],0),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT);let n=i;this.currentRenderTarget=0;for(const o of t){const l=o.type;this.shaders.get(l)&&(this.renderWithShader(l,n,o.params),n=this.renderTextures[this.currentRenderTarget],this.currentRenderTarget=1-this.currentRenderTarget)}s.bindFramebuffer(s.FRAMEBUFFER,null),s.viewport(0,0,this.width,this.height),this.renderPassthrough(n),s.deleteTexture(i);const a=s.getError();return a!==s.NO_ERROR?(console.warn("[VideoEffectsEngine] WebGL error:",a),createImageBitmap(e)):createImageBitmap(this.canvas)}catch(i){return console.error("[VideoEffectsEngine] GPU processing failed:",i),this.applyEffectsCPU(e,t)}}uploadTexture(e){const t=this.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s}renderWithShader(e,t,s){const i=this.gl,n=this.shaders.get(e);if(!n)return;i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffers[this.currentRenderTarget]),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.renderTextures[this.currentRenderTarget],0),i.viewport(0,0,this.width,this.height),i.useProgram(n.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t);const a=n.uniforms.get("u_texture");a&&i.uniform1i(a,0),this.setFilterUniforms(e,n,s),this.setupVertexAttributes(n),i.drawArrays(i.TRIANGLE_STRIP,0,4)}renderPassthrough(e){const t=this.gl,s=this.shaders.get("passthrough");t.useProgram(s.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e);const i=s.uniforms.get("u_texture");i&&t.uniform1i(i,0),this.setupVertexAttributes(s),t.drawArrays(t.TRIANGLE_STRIP,0,4)}setupVertexAttributes(e){const t=this.gl,s=e.attributes.get("a_position");s!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0));const i=e.attributes.get("a_texCoord");i!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffer),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0))}setFilterUniforms(e,t,s){const i=this.gl;switch(e){case"brightness":{const n=t.uniforms.get("u_brightness");n&&i.uniform1f(n,s.value||0);break}case"contrast":{const n=t.uniforms.get("u_contrast");n&&i.uniform1f(n,s.value||1);break}case"saturation":{const n=t.uniforms.get("u_saturation");n&&i.uniform1f(n,s.value||1);break}case"hue":{const n=t.uniforms.get("u_hueRotation");n&&i.uniform1f(n,s.rotation||0);break}case"blur":{const n=t.uniforms.get("u_radius"),a=t.uniforms.get("u_resolution");n&&i.uniform1f(n,Math.min(s.radius||0,10)),a&&i.uniform2f(a,this.width,this.height);break}case"sharpen":{const n=t.uniforms.get("u_amount"),a=t.uniforms.get("u_resolution");n&&i.uniform1f(n,s.amount||0),a&&i.uniform2f(a,this.width,this.height);break}case"vignette":{const n=t.uniforms.get("u_amount"),a=t.uniforms.get("u_midpoint"),o=t.uniforms.get("u_feather");n&&i.uniform1f(n,s.amount||.5),a&&i.uniform1f(a,s.midpoint||.5),o&&i.uniform1f(o,s.feather||.3);break}case"grain":{const n=t.uniforms.get("u_amount"),a=t.uniforms.get("u_size"),o=t.uniforms.get("u_time");n&&i.uniform1f(n,s.amount||.1),a&&i.uniform1f(a,s.size||1),o&&i.uniform1f(o,performance.now()/1e3);break}case"chromaKey":{const n=t.uniforms.get("u_keyColor"),a=t.uniforms.get("u_tolerance"),o=t.uniforms.get("u_softness"),l=s.keyColor;n&&i.uniform3f(n,l?.r??0,l?.g??1,l?.b??0),a&&i.uniform1f(a,s.tolerance||.3),o&&i.uniform1f(o,s.edgeSoftness||.1);break}case"temperature":{const n=t.uniforms.get("u_temperature");n&&i.uniform1f(n,s.value||0);break}case"tint":{const n=t.uniforms.get("u_tint");n&&i.uniform1f(n,s.value||0);break}case"tonal":{const n=t.uniforms.get("u_shadows"),a=t.uniforms.get("u_midtones"),o=t.uniforms.get("u_highlights");n&&i.uniform1f(n,s.shadows||0),a&&i.uniform1f(a,s.midtones||0),o&&i.uniform1f(o,s.highlights||0);break}}}async applyEffectsCPU(e,t){const s=new OffscreenCanvas(e.width,e.height),i=s.getContext("2d",{willReadFrequently:!0}),n=[],a=[];for(const o of t){const l=this.buildCSSFilter(o);l?n.push(l):a.push(o)}n.length>0?(i.filter=n.join(" "),i.drawImage(e,0,0),i.filter="none"):i.drawImage(e,0,0);for(const o of a)await this.applyEffectPixelLevel(i,o,s.width,s.height);return createImageBitmap(s)}async applyEffectPixelLevel(e,t,s,i){const n=e.getImageData(0,0,s,i),a=n.data,o=t.params;switch(t.type){case"sharpen":{const l=o.amount||.5;this.applySharpenKernel(a,s,i,l);break}case"vignette":{const l=o.amount||.5,d=o.midpoint||.5,u=o.feather||.3;this.applyVignette(a,s,i,l,d,u);break}case"grain":{const l=o.amount||.1;this.applyGrain(a,l);break}case"chromaKey":{const l=o.keyColor,d=o.tolerance||.3,u=o.edgeSoftness||.1;this.applyChromaKey(a,l||{r:0,g:1,b:0},d,u);break}case"temperature":{const l=o.value||0;this.applyTemperature(a,l);break}case"tint":{const l=o.value||0;this.applyTint(a,l);break}case"tonal":{const l=o.shadows||0,d=o.midtones||0,u=o.highlights||0;this.applyTonal(a,l,d,u);break}}e.putImageData(n,0,0)}applySharpenKernel(e,t,s,i){const n=i/100,a=new Uint8ClampedArray(e),o=[0,-n,0,-n,1+4*n,-n,0,-n,0];for(let l=1;l<s-1;l++)for(let d=1;d<t-1;d++)for(let u=0;u<3;u++){let h=0;for(let p=-1;p<=1;p++)for(let f=-1;f<=1;f++){const m=((l+p)*t+(d+f))*4+u;h+=a[m]*o[(p+1)*3+(f+1)]}e[(l*t+d)*4+u]=Math.max(0,Math.min(255,h))}}applyVignette(e,t,s,i,n,a){const o=i/100,l=t/2,d=s/2;for(let u=0;u<s;u++)for(let h=0;h<t;h++){const p=(h-l)/l,f=(u-d)/d,m=Math.sqrt(p*p+f*f)/Math.SQRT2,y=1-this.smoothstep(n-a,n+a,m)*o,x=(u*t+h)*4;e[x]=Math.round(e[x]*y),e[x+1]=Math.round(e[x+1]*y),e[x+2]=Math.round(e[x+2]*y)}}smoothstep(e,t,s){const i=Math.max(0,Math.min(1,(s-e)/(t-e)));return i*i*(3-2*i)}applyGrain(e,t){const i=t/100*50;for(let n=0;n<e.length;n+=4){const a=(Math.random()-.5)*i;e[n]=Math.max(0,Math.min(255,e[n]+a)),e[n+1]=Math.max(0,Math.min(255,e[n+1]+a)),e[n+2]=Math.max(0,Math.min(255,e[n+2]+a))}}applyChromaKey(e,t,s,i){const n=t.r*255,a=t.g*255,o=t.b*255,l=s*441.67,d=i*441.67;for(let u=0;u<e.length;u+=4){const h=e[u]-n,p=e[u+1]-a,f=e[u+2]-o,m=Math.sqrt(h*h+p*p+f*f),g=this.smoothstep(l-d,l+d,m);e[u+3]=Math.round(e[u+3]*g)}}applyTemperature(e,t){const s=t/100;for(let i=0;i<e.length;i+=4){let n=e[i],a=e[i+1],o=e[i+2];s>0?(n=Math.min(255,n+s*51),a=Math.min(255,a+s*25.5),o=Math.max(0,o-s*51)):(n=Math.max(0,n+s*51),a=Math.max(0,a+s*12.75),o=Math.min(255,o-s*51)),e[i]=Math.round(n),e[i+1]=Math.round(a),e[i+2]=Math.round(o)}}applyTint(e,t){const s=t/100;for(let i=0;i<e.length;i+=4){let n=e[i],a=e[i+1],o=e[i+2];n=Math.max(0,Math.min(255,n+s*25.5)),a=Math.max(0,Math.min(255,a-s*51)),o=Math.max(0,Math.min(255,o+s*25.5)),e[i]=Math.round(n),e[i+1]=Math.round(a),e[i+2]=Math.round(o)}}applyTonal(e,t,s,i){for(let n=0;n<e.length;n+=4){const a=e[n]/255,o=e[n+1]/255,l=e[n+2]/255,d=.299*a+.587*o+.114*l,u=1-this.smoothstep(0,.33,d),h=this.smoothstep(.66,1,d),p=Math.max(0,1-u-h),f=t*u*.3+s*p*.3+i*h*.3;e[n]=Math.round(Math.max(0,Math.min(255,(a+f)*255))),e[n+1]=Math.round(Math.max(0,Math.min(255,(o+f)*255))),e[n+2]=Math.round(Math.max(0,Math.min(255,(l+f)*255)))}}buildCSSFilter(e){const t=e.params;switch(e.type){case"brightness":return`brightness(${1+(t.value||0)/100})`;case"contrast":return`contrast(${t.value||1})`;case"saturation":return`saturate(${t.value||1})`;case"hue":return`hue-rotate(${t.rotation||0}deg)`;case"blur":return`blur(${t.radius||0}px)`;default:return""}}async applyEffect(e,t){return this.applyEffects(e,[t])}removeEffect(e,t){return e.filter(s=>s.id!==t)}reorderEffects(e,t,s){const i=[...e],[n]=i.splice(t,1);return i.splice(s,0,n),i}getEffectOrder(e){return e.filter(t=>t.enabled).map(t=>t.id)}static isWebGL2Supported(){try{return new OffscreenCanvas(1,1).getContext("webgl2")!==null}catch{return!1}}resize(e,t){if(this.width=e,this.height=t,this.canvas&&(this.canvas.width=e,this.canvas.height=t),this.renderer&&this.renderer.resize(e,t),this.gl){for(const s of this.renderTextures)this.gl.deleteTexture(s);this.renderTextures=[];for(let s=0;s<2;s++)this.renderTextures.push(this.createRenderTexture())}}getAvailableFilters(){return["brightness","contrast","saturation","hue","blur","sharpen","vignette","grain","chromaKey","temperature","tint","tonal"]}isFilterSupported(e){return this.getAvailableFilters().includes(e)}dispose(){if(this.renderer&&(this.renderer.destroy(),this.renderer=null),this.rendererFactory=null,this.useNewRenderer=!1,this.gl){for(const e of this.shaders.values())this.gl.deleteProgram(e.program);this.shaders.clear(),this.quadBuffer&&this.gl.deleteBuffer(this.quadBuffer),this.texCoordBuffer&&this.gl.deleteBuffer(this.texCoordBuffer);for(const e of this.framebuffers)this.gl.deleteFramebuffer(e);for(const e of this.renderTextures)this.gl.deleteTexture(e);this.framebuffers=[],this.renderTextures=[]}this.canvas=null,this.gl=null,this.initialized=!1}getRendererType(){return this.useNewRenderer&&this.renderer?this.renderer.type:this.gl?"legacy-webgl2":"cpu"}isUsingWebGPU(){return this.useNewRenderer&&this.renderer?.type==="webgpu"}getRenderer(){return this.renderer}}let Va=null;function z9(r=1920,e=1080){return Va?(Va.width!==r||Va.height!==e)&&Va.resize(r,e):(Va=new Su({width:r,height:e}),Va.initialize().catch(t=>{console.error("[VideoEffectsEngine] Background initialization failed:",t)})),Va}const V9=.1,U9=20;class G9{clipSpeedData=new Map;animationEngine;constructor(e){this.animationEngine=e||new Cu}setClipSpeed(e,t,s){const i=this.clampSpeed(t),n=this.getOrCreateSpeedData(e,s);n.baseSpeed=i,this.clipSpeedData.set(e,n)}getClipSpeed(e){return this.clipSpeedData.get(e)?.baseSpeed??1}getEffectiveDuration(e){const t=this.clipSpeedData.get(e);return t?t.keyframes.length>0?this.calculateVariableSpeedDuration(t):t.originalDuration/t.baseSpeed:0}calculateVariableSpeedDuration(e){if([...e.keyframes].sort((a,o)=>a.time-o.time).length===0)return e.originalDuration/e.baseSpeed;const s=1e3,i=e.originalDuration/s;let n=0;for(let a=0;a<s;a++){const o=a*i,l=this.getSpeedAtSourceTime(e,o);n+=i/l}return n}clampSpeed(e){return Math.max(V9,Math.min(U9,e))}setReverse(e,t,s){let i=this.clipSpeedData.get(e);!i&&s!==void 0&&(i=this.getOrCreateSpeedData(e,s),this.clipSpeedData.set(e,i)),i&&(i.reverse=t)}isReverse(e){return this.clipSpeedData.get(e)?.reverse??!1}getFrameIndexAtTime(e,t,s){const i=this.getSourceTimeAtPlaybackTime(e,t),n=Math.floor(i*s);return Math.max(0,n)}getFrameIndicesInRange(e,t,s,i){const n=1/i,a=[];for(let o=t;o<s;o+=n)a.push(this.getFrameIndexAtTime(e,o,i));return a}addSpeedKeyframe(e,t,s,i="linear"){const n=this.clipSpeedData.get(e);if(!n)throw new Error(`No speed data for clip ${e}`);const a=`speed-kf-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,o={id:a,time:t,speed:this.clampSpeed(s),easing:i},l=n.keyframes.findIndex(d=>Math.abs(d.time-t)<.001);return l>=0?n.keyframes[l]=o:(n.keyframes.push(o),n.keyframes.sort((d,u)=>d.time-u.time)),a}removeSpeedKeyframe(e,t){const s=this.clipSpeedData.get(e);s&&(s.keyframes=s.keyframes.filter(i=>i.id!==t))}getSpeedKeyframes(e){return this.clipSpeedData.get(e)?.keyframes??[]}getSpeedAtTime(e,t){const s=this.clipSpeedData.get(e);return s?this.getSpeedAtSourceTime(s,t):1}getSpeedAtSourceTime(e,t){const s=e.keyframes;if(s.length===0)return e.baseSpeed;const i=[...s].sort((n,a)=>n.time-a.time);if(t<=i[0].time)return i[0].speed;if(t>=i[i.length-1].time)return i[i.length-1].speed;for(let n=0;n<i.length-1;n++)if(t>=i[n].time&&t<=i[n+1].time){const a=i[n],o=i[n+1],l=o.time-a.time,d=t-a.time,u=l>0?d/l:0,h=this.animationEngine.applyEasing(u,a.easing);return a.speed+(o.speed-a.speed)*h}return e.baseSpeed}createFreezeFrame(e,t,s,i){const n=this.clipSpeedData.get(e);if(!n)throw new Error(`No speed data for clip ${e}`);const o={id:`freeze-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,clipId:e,sourceTime:t,startTime:s,duration:i};return n.freezeFrames.push(o),n.freezeFrames.sort((l,d)=>l.startTime-d.startTime),o}removeFreezeFrame(e,t){const s=this.clipSpeedData.get(e);s&&(s.freezeFrames=s.freezeFrames.filter(i=>i.id!==t))}getFreezeFrames(e){return this.clipSpeedData.get(e)?.freezeFrames??[]}getFreezeFrameAtTime(e,t){const s=this.clipSpeedData.get(e);if(!s)return null;for(const i of s.freezeFrames)if(t>=i.startTime&&t<i.startTime+i.duration)return i;return null}getSourceTimeAtPlaybackTime(e,t){const s=this.clipSpeedData.get(e);if(!s)return t;const i=this.getFreezeFrameAtTime(e,t);if(i)return i.sourceTime;let n=t;for(const o of s.freezeFrames)if(o.startTime+o.duration<=t)n-=o.duration;else if(o.startTime<t)break;if(s.keyframes.length>0)return this.calculateSourceTimeWithVariableSpeed(s,n);let a=n*s.baseSpeed;return s.reverse&&(a=s.originalDuration-a),Math.max(0,Math.min(s.originalDuration,a))}calculateSourceTimeWithVariableSpeed(e,t){const s=this.calculateVariableSpeedDuration(e);if(t<=0)return 0;if(t>=s)return e.originalDuration;let i=0,n=e.originalDuration;const a=1e-4;for(;n-i>a;){const l=(i+n)/2;this.integratePlaybackTime(e,l)<t?i=l:n=l}let o=(i+n)/2;return e.reverse&&(o=e.originalDuration-o),Math.max(0,Math.min(e.originalDuration,o))}integratePlaybackTime(e,t){const s=Math.max(100,Math.ceil(t*100)),i=t/s;let n=0;for(let a=0;a<s;a++){const o=a*i,l=this.getSpeedAtSourceTime(e,o);n+=i/l}return n}setPitchCorrection(e,t){const s=this.clipSpeedData.get(e);s&&(s.pitchCorrection=t)}isPitchCorrectionEnabled(e){return this.clipSpeedData.get(e)?.pitchCorrection??!0}getOrCreateSpeedData(e,t){let s=this.clipSpeedData.get(e);return s||(s={clipId:e,baseSpeed:1,reverse:!1,keyframes:[],pitchCorrection:!0,freezeFrames:[],originalDuration:t},this.clipSpeedData.set(e,s)),s}initializeClip(e,t){this.getOrCreateSpeedData(e,t)}removeClip(e){this.clipSpeedData.delete(e)}getClipIds(){return Array.from(this.clipSpeedData.keys())}getClipSpeedData(e){return this.clipSpeedData.get(e)}clear(){this.clipSpeedData.clear()}}let Am=null;function gc(){return Am||(Am=new G9),Am}const pC=new Map;let ty=0,Yo=null;async function vM(){if(Yo)return Yo;try{return Yo=await _i(()=>import("./index5.js"),[]),Yo}catch{try{return Yo=await _i(()=>import("https://esm.sh/mediabunny@1.25.3"),[]),Yo}catch{return null}}}async function W9(r,e,t,s){const i=pC.get(r);if(i)return i;try{const n=await vM();if(!n)return null;const{Input:a,ALL_FORMATS:o,BlobSource:l,CanvasSink:d}=n,u=new a({source:new l(e),formats:o}),h=await u.getPrimaryVideoTrack();if(!h)return null;const p=new d(h,{width:t,height:s,fit:"contain"}),f={input:u,sink:p,videoTrack:h,blobUrl:URL.createObjectURL(e)};return pC.set(r,f),f}catch(n){return console.error(`[DecodeWorker ${ty}] Failed to create resources for ${r}:`,n),null}}async function Y9(r){const{requestId:e,clipId:t,blob:s,time:i,width:n,height:a}=r;try{const o=await W9(t,s,n,a);if(!o)return{type:"decoded",requestId:e,clipId:t,bitmap:null,time:i,error:"Failed to create decode resources"};const d=await o.sink.getCanvas(i);if(!d?.canvas)return{type:"decoded",requestId:e,clipId:t,bitmap:null,time:i,error:"No frame at requested time"};const u=await createImageBitmap(d.canvas);return{type:"decoded",requestId:e,clipId:t,bitmap:u,time:i}}catch(o){return{type:"decoded",requestId:e,clipId:t,bitmap:null,time:i,error:o instanceof Error?o.message:"Unknown decode error"}}}const Ju=self;Ju.onmessage=async r=>{const e=r.data;switch(e.type){case"init":ty=Math.floor(Math.random()*1e4),await vM();const t={type:"ready",workerId:ty};Ju.postMessage(t);break;case"decode":const s=await Y9(e);s.bitmap?Ju.postMessage(s,{transfer:[s.bitmap]}):Ju.postMessage(s);break}};const q9=`
const resourceCache = new Map();
let workerId = 0;
let mediabunnyModule = null;
let mediabunnyAvailable = false;

async function loadMediaBunny() {
 if (mediabunnyModule) {
 return mediabunnyModule;
 }
 try {
 mediabunnyModule = await import("mediabunny");
 mediabunnyAvailable = true;
 return mediabunnyModule;
 } catch (error) {
 try {
 mediabunnyModule = await import("https://esm.sh/mediabunny@1.25.3");
 mediabunnyAvailable = true;
 return mediabunnyModule;
 } catch (cdnError) {
 mediabunnyAvailable = false;
 return null;
 }
 }
}

async function getOrCreateResources(clipId, blob, width, height) {
 if (!mediabunnyAvailable || !mediabunnyModule) {
 return null;
 }

 const cached = resourceCache.get(clipId);
 if (cached) {
 return cached;
 }

 try {
 const { Input, ALL_FORMATS, BlobSource, CanvasSink } = mediabunnyModule;

 const input = new Input({
 source: new BlobSource(blob),
 formats: ALL_FORMATS,
 });

 const videoTrack = await input.getPrimaryVideoTrack();
 if (!videoTrack) {
 return null;
 }

 const sink = new CanvasSink(videoTrack, {
 width,
 height,
 fit: "contain",
 });

 const resource = {
 input,
 sink,
 videoTrack,
 blobUrl: URL.createObjectURL(blob),
 };

 resourceCache.set(clipId, resource);
 return resource;
 } catch (error) {
 return null;
 }
}

async function decodeFrame(request) {
 const { requestId, clipId, blob, time, width, height } = request;

 if (!mediabunnyAvailable) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: "MediaBunny not available in worker",
 };
 }

 try {
 const resources = await getOrCreateResources(clipId, blob, width, height);
 if (!resources) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: "Failed to create decode resources",
 };
 }

 const frameResult = await resources.sink.getCanvas(time);
 if (!frameResult?.canvas) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: "No frame at requested time",
 };
 }

 const bitmap = await createImageBitmap(frameResult.canvas);

 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap,
 time,
 };
 } catch (error) {
 return {
 type: "decoded",
 requestId,
 clipId,
 bitmap: null,
 time,
 error: error instanceof Error ? error.message : "Unknown decode error",
 };
 }
}

self.onmessage = async (event) => {
 const request = event.data;

 switch (request.type) {
 case "init":
 workerId = Math.floor(Math.random() * 10000);
 await loadMediaBunny();
 self.postMessage({ type: "ready", workerId, mediabunnyAvailable });
 break;

 case "decode":
 const response = await decodeFrame(request);
 if (response.bitmap) {
 self.postMessage(response, [response.bitmap]);
 } else {
 self.postMessage(response);
 }
 break;
 }
};
`;function H9(){return new Blob([q9],{type:"application/javascript"})}function X9(){const r=H9();return URL.createObjectURL(r)}class K9{constructor(e=4){this.workerCount=e,this.workerCount=Math.max(1,Math.min(e,navigator.hardwareConcurrency||4))}workers=[];workerUrls=[];requestQueue=[];frameCache=new Map;maxCacheSize=100;cacheHits=0;cacheMisses=0;initialized=!1;initPromise=null;requestIdCounter=0;mediabunnyAvailable=!1;isAvailable(){return this.initialized&&this.mediabunnyAvailable}async initialize(){if(!this.initialized)return this.initPromise?this.initPromise:(this.initPromise=this.doInitialize(),this.initPromise)}async doInitialize(){const e=[];for(let t=0;t<this.workerCount;t++)e.push(this.createWorker(t));this.workers=await Promise.all(e),this.mediabunnyAvailable=this.workers.some(t=>t.mediabunnyAvailable),this.initialized=!0}async createWorker(e){return new Promise((t,s)=>{const i=X9();this.workerUrls.push(i);const n=new Worker(i,{type:"module"}),a={worker:n,workerId:e,busy:!1,pendingRequests:new Map,totalDecodes:0,totalDecodeTime:0,mediabunnyAvailable:!1},o=setTimeout(()=>{s(new Error(`Worker ${e} initialization timed out`))},1e4);n.onmessage=l=>{const d=l.data;if(d.type==="ready"){clearTimeout(o),a.workerId=d.workerId,a.mediabunnyAvailable=d.mediabunnyAvailable??!1,a.mediabunnyAvailable,t(a);return}d.type==="decoded"&&this.handleDecodeResponse(a,d)},n.onerror=l=>{console.error(`[ParallelFrameDecoder] Worker ${e} error:`,l),clearTimeout(o),s(l)},n.postMessage({type:"init"})})}async handleDecodeResponse(e,t){const s=e.pendingRequests.get(t.requestId);if(!s){console.warn(`[ParallelFrameDecoder] No pending request for ${t.requestId}`);return}e.pendingRequests.delete(t.requestId),e.busy=e.pendingRequests.size>0;const i=performance.now()-s.startTime;e.totalDecodes++,e.totalDecodeTime+=i;let n=null;if(t.bitmap){const a=`${t.clipId}:${t.time.toFixed(3)}`;this.addToCache(a,t.bitmap);try{n=await createImageBitmap(t.bitmap)}catch{n=null}}s.resolve({clipId:t.clipId,bitmap:n,time:t.time,error:t.error}),this.processQueue()}addToCache(e,t){if(this.frameCache.size>=this.maxCacheSize){let s=null,i=1/0;for(const[n,a]of this.frameCache)a.timestamp<i&&(i=a.timestamp,s=n);s&&(this.frameCache.get(s)?.bitmap.close(),this.frameCache.delete(s))}this.frameCache.set(e,{bitmap:t,timestamp:performance.now()})}async getFromCache(e,t){const s=`${e}:${t.toFixed(3)}`,i=this.frameCache.get(s);if(i){i.timestamp=performance.now(),this.cacheHits++;try{return await createImageBitmap(i.bitmap)}catch{return this.frameCache.delete(s),null}}return this.cacheMisses++,null}getLeastBusyWorker(){let e=null,t=1/0;for(const s of this.workers)s.pendingRequests.size<t&&(t=s.pendingRequests.size,e=s);return e}processQueue(){for(;this.requestQueue.length>0;){const e=this.getLeastBusyWorker();if(!e||e.pendingRequests.size>=2)break;const t=this.requestQueue.shift();t&&this.sendDecodeRequest(e,t.request,t.resolve,t.reject)}}sendDecodeRequest(e,t,s,i){const n=`req_${this.requestIdCounter++}`,a={resolve:s,reject:i,clipId:t.clipId,startTime:performance.now()};e.pendingRequests.set(n,a),e.busy=!0;const o={type:"decode",requestId:n,clipId:t.clipId,blob:t.blob,time:t.time,width:t.width,height:t.height};e.worker.postMessage(o)}async decodeFrame(e){this.initialized||await this.initialize();const t=await this.getFromCache(e.clipId,e.time);return t?{clipId:e.clipId,bitmap:t,time:e.time}:new Promise((s,i)=>{const n=this.getLeastBusyWorker();n&&n.pendingRequests.size<2?this.sendDecodeRequest(n,e,s,i):this.requestQueue.push({request:e,resolve:s,reject:i})})}async decodeFrames(e){this.initialized||await this.initialize();const t=new Map,s=[];for(const n of e)s.push(this.decodeFrame(n));const i=await Promise.all(s);for(const n of i)t.set(n.clipId,n);return t}async decodeClipsAtTime(e,t,s){const i=e.map(o=>({clipId:o.clipId,blob:o.blob,time:o.time,width:t,height:s})),n=await this.decodeFrames(i),a=new Map;for(const[o,l]of n)l.bitmap&&a.set(o,l.bitmap);return a}getStats(){let e=0,t=0,s=0;for(const i of this.workers)e+=i.totalDecodes,t+=i.totalDecodeTime,s+=i.pendingRequests.size;return{workerCount:this.workers.length,totalDecodes:e,averageDecodeTime:e>0?t/e:0,pendingRequests:s+this.requestQueue.length,cacheHits:this.cacheHits,cacheMisses:this.cacheMisses}}clearCache(){for(const[,e]of this.frameCache)e.bitmap.close();this.frameCache.clear(),this.cacheHits=0,this.cacheMisses=0}dispose(){for(const e of this.workers){for(const[,t]of e.pendingRequests)t.reject(new Error("Decoder disposed"));e.worker.terminate()}this.workers=[];for(const e of this.workerUrls)URL.revokeObjectURL(e);this.workerUrls=[],this.clearCache();for(const e of this.requestQueue)e.reject(new Error("Decoder disposed"));this.requestQueue=[],this.initialized=!1,this.initPromise=null}}let jm=null;function Q9(){if(!jm){const r=Math.min(4,navigator.hardwareConcurrency||4);jm=new K9(r)}return jm}class fC{buffers;writeIndex=0;presentIndex=1;bufferSize;framesWritten=0;framesPresented=0;framesDropped=0;fallbacksUsed=0;latencySum=0;latencyCount=0;lastWriteTime=0;lastPresentTime=0;constructor(e=3){this.bufferSize=Math.max(2,Math.min(e,8)),this.buffers=new Array(this.bufferSize).fill(null)}write(e,t,s){const i=this.buffers[this.writeIndex];i&&i.bitmap.close(),this.buffers[this.writeIndex]={bitmap:e,timestamp:t,frameNumber:s},this.lastWriteTime=performance.now(),this.framesWritten++,this.writeIndex=(this.writeIndex+1)%this.bufferSize,this.writeIndex===this.presentIndex&&(this.presentIndex=(this.presentIndex+1)%this.bufferSize,this.framesDropped++)}async writeFromCanvas(e,t,s){const i=await createImageBitmap(e);this.write(i,t,s)}present(){const e=(this.presentIndex-1+this.bufferSize)%this.bufferSize,t=this.buffers[e];if(t){const s=performance.now();if(this.lastWriteTime>0){const i=s-this.lastWriteTime;this.latencySum+=i,this.latencyCount++}return this.lastPresentTime=s,this.framesPresented++,t}return null}presentOrFallback(){const e=this.present();if(e)return e;for(let t=1;t<this.bufferSize;t++){const s=(this.presentIndex-1-t+this.bufferSize*2)%this.bufferSize,i=this.buffers[s];if(i)return this.fallbacksUsed++,i}return null}swap(){this.presentIndex=(this.presentIndex+1)%this.bufferSize}peek(){const e=(this.presentIndex-1+this.bufferSize)%this.bufferSize;return this.buffers[e]}peekNext(){return this.buffers[this.presentIndex]}hasFrameReady(){const e=(this.presentIndex-1+this.bufferSize)%this.bufferSize;return this.buffers[e]!==null}hasNextFrameReady(){return this.buffers[this.presentIndex]!==null}getBufferFillLevel(){let e=0;for(const t of this.buffers)t!==null&&e++;return e/this.bufferSize}getLatestTimestamp(){const e=(this.writeIndex-1+this.bufferSize)%this.bufferSize;return this.buffers[e]?.timestamp??null}getStats(){return{bufferSize:this.bufferSize,framesWritten:this.framesWritten,framesPresented:this.framesPresented,framesDropped:this.framesDropped,fallbacksUsed:this.fallbacksUsed,averageLatency:this.latencyCount>0?this.latencySum/this.latencyCount:0}}getTimingInfo(){return{lastWriteTime:this.lastWriteTime,lastPresentTime:this.lastPresentTime}}reset(){for(let e=0;e<this.bufferSize;e++){const t=this.buffers[e];t&&t.bitmap.close(),this.buffers[e]=null}this.writeIndex=0,this.presentIndex=1,this.framesWritten=0,this.framesPresented=0,this.framesDropped=0,this.fallbacksUsed=0,this.latencySum=0,this.latencyCount=0,this.lastWriteTime=0,this.lastPresentTime=0}dispose(){this.reset()}}class J9{buffers=new Map;compositedBuffer;lastCompositeTime=0;constructor(e=3){this.compositedBuffer=new fC(e)}getOrCreateTrackBuffer(e,t=3){let s=this.buffers.get(e);return s||(s=new fC(t),this.buffers.set(e,s)),s}writeTrackFrame(e,t,s,i){this.getOrCreateTrackBuffer(e).write(t,s,i)}getTrackFrame(e){return this.buffers.get(e)?.presentOrFallback()??null}getAllTrackFrames(){const e=new Map;for(const[t,s]of this.buffers){const i=s.presentOrFallback();i&&e.set(t,i)}return e}writeCompositedFrame(e,t,s){this.compositedBuffer.write(e,t,s),this.lastCompositeTime=performance.now()}getCompositedFrame(){return this.compositedBuffer.presentOrFallback()}swapAll(){for(const e of this.buffers.values())e.swap();this.compositedBuffer.swap()}getStats(){const e=new Map;for(const[t,s]of this.buffers)e.set(t,s.getStats());return{tracks:e,composited:this.compositedBuffer.getStats(),lastCompositeTime:this.lastCompositeTime}}removeTrack(e){const t=this.buffers.get(e);t&&(t.dispose(),this.buffers.delete(e))}reset(){for(const e of this.buffers.values())e.reset();this.compositedBuffer.reset(),this.lastCompositeTime=0}dispose(){for(const e of this.buffers.values())e.dispose();this.buffers.clear(),this.compositedBuffer.dispose()}}let _m=null;function Z9(){return _m||(_m=new J9),_m}class eW{renderer=null;config;layers=new Map;sortedLayerIds=[];isDirty=!0;stats={layersComposited:0,lastCompositeDuration:0,averageCompositeDuration:0,texturesCreated:0,texturesReleased:0};compositeDurations=[];maxDurationSamples=60;constructor(e){this.config={...e,antialias:e.antialias??!0}}setRenderer(e){this.renderer=e,this.isDirty=!0}getRenderer(){return this.renderer}getDevice(){return this.renderer?.getDevice()??null}setBackgroundColor(e){this.config.backgroundColor=e,this.isDirty=!0}resize(e,t){this.config.width=e,this.config.height=t,this.renderer&&this.renderer.resize(e,t),this.isDirty=!0}addLayer(e){this.layers.set(e.id,e),this.sortLayers(),this.isDirty=!0}updateLayer(e,t){const s=this.layers.get(e);s&&(Object.assign(s,t),t.zIndex!==void 0&&this.sortLayers(),this.isDirty=!0)}removeLayer(e){const t=this.layers.get(e);t&&(this.renderer&&t.texture&&(this.renderer.releaseTexture(t.texture),this.stats.texturesReleased++),this.layers.delete(e),this.sortLayers(),this.isDirty=!0)}clearLayers(){if(this.renderer)for(const e of this.layers.values())e.texture&&(this.renderer.releaseTexture(e.texture),this.stats.texturesReleased++);this.layers.clear(),this.sortedLayerIds=[],this.isDirty=!0}getLayer(e){return this.layers.get(e)}getLayers(){return this.sortedLayerIds.map(e=>this.layers.get(e)).filter(Boolean)}setLayerVisibility(e,t){const s=this.layers.get(e);s&&(s.visible=t,this.isDirty=!0)}setLayerOpacity(e,t){const s=this.layers.get(e);s&&(s.opacity=Math.max(0,Math.min(1,t)),this.isDirty=!0)}setLayerBlendMode(e,t){const s=this.layers.get(e);s&&(s.blendMode=t,this.isDirty=!0)}setLayerTransform(e,t){const s=this.layers.get(e);s&&(s.transform=t,this.isDirty=!0)}setLayerZIndex(e,t){const s=this.layers.get(e);s&&(s.zIndex=t,this.sortLayers(),this.isDirty=!0)}sortLayers(){this.sortedLayerIds=Array.from(this.layers.keys()).sort((e,t)=>{const s=this.layers.get(e),i=this.layers.get(t);return s.zIndex-i.zIndex})}async createTextureFromCanvas(e){if(!this.renderer)throw new Error("Renderer not set");const t=await createImageBitmap(e),s=this.renderer.createTextureFromImage(t);return this.stats.texturesCreated++,s!==t&&t.close(),s}async createTextureFromBitmap(e){if(!this.renderer)throw new Error("Renderer not set");const t=this.renderer.createTextureFromImage(e);return this.stats.texturesCreated++,t}async composite(){if(!this.renderer)throw new Error("Renderer not set");const e=performance.now();this.renderer.beginFrame();let t=0;for(const n of this.sortedLayerIds){const a=this.layers.get(n);if(!a||!a.visible)continue;let o=a.texture;if(a.texture instanceof ImageBitmap)o=this.renderer.createTextureFromImage(a.texture);else if(a.texture instanceof HTMLCanvasElement||a.texture instanceof OffscreenCanvas){const u=await createImageBitmap(a.texture);o=this.renderer.createTextureFromImage(u),o!==u&&u.close()}const l=[...a.effects];a.blendMode!=="normal"&&l.push({id:`blend-${a.id}`,type:"blend",enabled:!0,params:{mode:a.blendMode}}),l.length>0&&(o=this.renderer.applyEffects(o,l));const d={texture:o,transform:a.transform,effects:[],opacity:a.opacity,borderRadius:a.borderRadius};this.renderer.renderLayer(d),t++}const s=await this.renderer.endFrame(),i=performance.now()-e;return this.recordCompositeDuration(i),this.stats.layersComposited=t,this.isDirty=!1,s}async compositeToCanvas(e){const t=await this.composite();e.drawImage(t,0,0),t.close()}recordCompositeDuration(e){this.stats.lastCompositeDuration=e,this.compositeDurations.push(e),this.compositeDurations.length>this.maxDurationSamples&&this.compositeDurations.shift();const t=this.compositeDurations.reduce((s,i)=>s+i,0);this.stats.averageCompositeDuration=t/this.compositeDurations.length}isDirtyFrame(){return this.isDirty}markDirty(){this.isDirty=!0}getStats(){return{...this.stats}}resetStats(){this.stats={layersComposited:0,lastCompositeDuration:0,averageCompositeDuration:0,texturesCreated:0,texturesReleased:0},this.compositeDurations=[]}dispose(){this.clearLayers(),this.renderer=null}}let Zu=null;function tW(r){return Zu&&Zu.dispose(),Zu=new eW(r),Zu}class wM{animationEngine;motionPaths=new Map;clipboard=null;constructor(e){this.animationEngine=e||new Cu}addKeyframe(e,t,s,i,n="linear"){return{id:this.generateKeyframeId(),time:s,property:t,value:i,easing:this.mapEasingPresetToType(n),bezierHandles:n==="linear"?void 0:this.getDefaultBezierHandles(n)}}removeKeyframe(e,t){return e.filter(s=>s.id!==t)}updateKeyframe(e,t,s){const i=e.map(n=>n.id===t?{...n,...s}:n);return s.time!==void 0&&i.sort((n,a)=>n.time-a.time),i}getKeyframe(e,t){return e.find(s=>s.id===t)||null}getKeyframesForProperty(e,t){return e.filter(s=>s.property===t).sort((s,i)=>s.time-i.time)}getValueAtTime(e,t){if(e.length===0)return{value:void 0,keyframeA:null,keyframeB:null,progress:0,easedProgress:0};const s=[...e].sort((h,p)=>h.time-p.time);if(t<=s[0].time)return{value:s[0].value,keyframeA:s[0],keyframeB:null,progress:0,easedProgress:0};if(t>=s[s.length-1].time)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1,easedProgress:1};let i=null,n=null;for(let h=0;h<s.length-1;h++)if(t>=s[h].time&&t<=s[h+1].time){i=s[h],n=s[h+1];break}if(!i||!n)return{value:s[s.length-1].value,keyframeA:s[s.length-1],keyframeB:null,progress:1,easedProgress:1};const a=n.time-i.time,o=t-i.time,l=a>0?o/a:0,d=this.applyEasing(l,i);return{value:this.interpolateValue(i.value,n.value,d),keyframeA:i,keyframeB:n,progress:l,easedProgress:d}}getEasingPresets(){return["linear","ease-in","ease-out","ease-in-out","bounce","elastic","spring"]}setEasing(e,t,s){return e.map(i=>i.id===t?typeof s=="string"?{...i,easing:this.mapEasingPresetToType(s),bezierHandles:this.getDefaultBezierHandles(s)}:{...i,easing:"bezier",bezierHandles:{in:{x:s.controlPoints[0],y:s.controlPoints[1]},out:{x:s.controlPoints[2],y:s.controlPoints[3]}}}:i)}applyEasing(e,t){const s=Math.max(0,Math.min(1,e));if(t.bezierHandles&&t.easing==="bezier")return this.animationEngine.cubicBezier(s,t.bezierHandles.in.x,t.bezierHandles.in.y,t.bezierHandles.out.x,t.bezierHandles.out.y);switch(t.easing){case"linear":return s;case"ease-in":return this.easeIn(s);case"ease-out":return this.easeOut(s);case"ease-in-out":return this.easeInOut(s);case"bezier":return this.animationEngine.cubicBezier(s,.25,.1,.25,1);default:return s}}applyEasingPreset(e,t){const s=Math.max(0,Math.min(1,e));switch(t){case"linear":return s;case"ease-in":return this.easeIn(s);case"ease-out":return this.easeOut(s);case"ease-in-out":return this.easeInOut(s);case"bounce":return this.bounce(s);case"elastic":return this.elastic(s);case"spring":return this.spring(s);default:return s}}easeIn(e){return e*e}easeOut(e){return e*(2-e)}easeInOut(e){return e<.5?2*e*e:-1+(4-2*e)*e}bounce(e){if(e<1/2.75)return 7.5625*e*e;if(e<2/2.75){const t=e-.5454545454545454;return 7.5625*t*t+.75}else if(e<2.5/2.75){const t=e-.8181818181818182;return 7.5625*t*t+.9375}else{const t=e-.9545454545454546;return 7.5625*t*t+.984375}}elastic(e){if(e===0||e===1)return e;const t=.3,s=t/4;return Math.pow(2,-10*e)*Math.sin((e-s)*(2*Math.PI)/t)+1}spring(e){return e===0||e===1?e:1-Math.pow(Math.cos(e*Math.PI*4.5),3)*Math.pow(1-e,2.2)*.4-(1-e)}updateBezierHandles(e,t,s){return e.map(i=>i.id===t?{...i,easing:"bezier",bezierHandles:s}:i)}getBezierControlPoints(e){return e.bezierHandles?{x1:e.bezierHandles.in.x,y1:e.bezierHandles.in.y,x2:e.bezierHandles.out.x,y2:e.bezierHandles.out.y}:null}interpolateWithBezier(e,t,s,i){const n=this.animationEngine.cubicBezier(s,i.x1,i.y1,i.x2,i.y2);return this.interpolateValue(e,t,n)}copyKeyframes(e,t,s){const i={keyframes:e.map(n=>({...n})),sourceClipId:t,sourceProperty:s,copiedAt:Date.now()};return this.clipboard=i,i}pasteKeyframes(e,t,s,i=0){const n=Math.min(...e.keyframes.map(a=>a.time));return e.keyframes.map(a=>({...a,id:this.generateKeyframeId(),property:s,time:a.time-n+i}))}getClipboard(){return this.clipboard}clearClipboard(){this.clipboard=null}getMotionPath(e,t,s=100){const i=this.getKeyframesForProperty(t,"position.x"),n=this.getKeyframesForProperty(t,"position.y");if(i.length===0&&n.length===0)return{clipId:e,points:[],visible:!1};const a=[...i,...n].map(p=>p.time),o=Math.min(...a),d=Math.max(...a)-o,u=[];for(let p=0;p<=s;p++){const f=o+d*p/s,m=this.getValueAtTime(i,f),g=this.getValueAtTime(n,f);u.push({time:f,x:typeof m.value=="number"?m.value:0,y:typeof g.value=="number"?g.value:0})}const h={clipId:e,points:u,visible:!0};return this.motionPaths.set(e,h),h}setMotionPathVisible(e,t){const s=this.motionPaths.get(e);s&&(s.visible=t)}generateKeyframeId(){return`kf-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}mapEasingPresetToType(e){switch(e){case"bounce":case"elastic":case"spring":return"bezier";default:return e}}getDefaultBezierHandles(e){switch(e){case"ease-in":return{in:{x:.42,y:0},out:{x:1,y:1}};case"ease-out":return{in:{x:0,y:0},out:{x:.58,y:1}};case"ease-in-out":return{in:{x:.42,y:0},out:{x:.58,y:1}};case"bounce":return{in:{x:.34,y:1.56},out:{x:.64,y:1}};case"elastic":return{in:{x:.68,y:-.55},out:{x:.27,y:1.55}};case"spring":return{in:{x:.5,y:1.5},out:{x:.5,y:1}};default:return}}interpolateValue(e,t,s){if(typeof e=="number"&&typeof t=="number")return e+(t-e)*s;if(typeof e=="object"&&typeof t=="object"&&e!==null&&t!==null){const i={},n=e,a=t;for(const o of Object.keys(n))o in a?i[o]=this.interpolateValue(n[o],a[o],s):i[o]=n[o];return i}return s<.5?e:t}}const pi=new wM,Gi={particleCount:100,speed:100,speedVariance:50,gravity:200,wind:{x:0,y:0,z:0},turbulence:10,colors:["#ffffff"],size:{min:2,max:8},opacity:{start:1,end:0},lifetime:{min:.5,max:2},emissionRate:50,emissionShape:"point",emissionRadius:10,rotationSpeed:0,fadeIn:.1,fadeOut:.3,blendMode:"add"};function sW(){return Math.random().toString(36).substring(2,11)}function ps(r,e){return r+Math.random()*(e-r)}function iW(r,e){switch(r.emissionShape){case"circle":{const t=Math.random()*Math.PI*2,s=Math.random()*r.emissionRadius;return{x:e.x+Math.cos(t)*s,y:e.y+Math.sin(t)*s,z:e.z}}case"sphere":{const t=Math.random()*Math.PI*2,s=Math.acos(2*Math.random()-1),i=Math.random()*r.emissionRadius;return{x:e.x+i*Math.sin(s)*Math.cos(t),y:e.y+i*Math.sin(s)*Math.sin(t),z:e.z+i*Math.cos(s)}}case"rectangle":return{x:e.x+ps(-r.emissionRadius,r.emissionRadius),y:e.y+ps(-r.emissionRadius,r.emissionRadius),z:e.z};case"line":return{x:e.x+ps(-r.emissionRadius,r.emissionRadius),y:e.y,z:e.z};case"point":default:return{...e}}}function rW(r,e,t,s){const i=r.speed+ps(-r.speedVariance,r.speedVariance);switch(e){case"explode":{const n=s.x-t.x,a=s.y-t.y,o=Math.sqrt(n*n+a*a)||1;return{x:n/o*i+ps(-20,20),y:a/o*i+ps(-20,20),z:ps(-i*.5,i*.5)}}case"implode":{const n=t.x-s.x,a=t.y-s.y,o=Math.sqrt(n*n+a*a)||1;return{x:n/o*i,y:a/o*i,z:0}}case"confetti":return{x:ps(-i,i),y:-Math.abs(i)*ps(.5,1.5),z:ps(-i*.3,i*.3)};case"dust":case"sparkle":{const n=Math.random()*Math.PI*2;return{x:Math.cos(n)*i*.3,y:Math.sin(n)*i*.3-i*.2,z:ps(-10,10)}}case"disintegrate":return{x:ps(-i*.5,i*.5),y:-i*ps(.3,.8),z:ps(-i*.2,i*.2)};case"shatter":{const n=Math.random()*Math.PI*2;return{x:Math.cos(n)*i,y:Math.sin(n)*i-i*.5,z:ps(-i*.5,i*.5)}}case"dissolve":default:{const n=Math.random()*Math.PI*2;return{x:Math.cos(n)*i*.5,y:Math.sin(n)*i*.5,z:0}}}}class nW{emitters=new Map;effects=new Map;canvasWidth=1920;canvasHeight=1080;changeListeners=new Set;changeVersion=0;onEffectsChange(e){return this.changeListeners.add(e),()=>{this.changeListeners.delete(e)}}notifyChange(){this.changeVersion++;for(const e of this.changeListeners)e()}getChangeVersion(){return this.changeVersion}setCanvasSize(e,t){this.canvasWidth=e,this.canvasHeight=t}addEffect(e){this.effects.set(e.id,e),this.emitters.set(e.id,{effectId:e.id,particles:[],elapsedTime:0,emissionAccumulator:0,active:!1}),this.notifyChange()}removeEffect(e){this.effects.delete(e),this.emitters.delete(e),this.notifyChange()}updateEffect(e,t){const s=this.effects.get(e);s&&(s.config={...s.config,...t},this.notifyChange())}updateEffectTiming(e,t,s){const i=this.effects.get(e);i&&(i.startTime=t,i.duration=s,this.notifyChange())}getEffect(e){return this.effects.get(e)}getAllEffects(){return Array.from(this.effects.values())}getEffectsForClip(e){return Array.from(this.effects.values()).filter(t=>t.clipId===e)}toggleEffect(e,t){const s=this.effects.get(e);s&&(s.enabled=t,this.notifyChange())}createParticle(e,t){const s=e.config,i=iW(s,t),n=rW(s,e.type,t,i),a=Math.floor(Math.random()*s.colors.length);return{id:sW(),position:i,velocity:n,acceleration:{x:0,y:s.gravity,z:0},color:s.colors[a],size:ps(s.size.min,s.size.max),opacity:s.opacity.start,rotation:Math.random()*Math.PI*2,rotationSpeed:ps(-s.rotationSpeed,s.rotationSpeed),lifetime:ps(s.lifetime.min,s.lifetime.max),age:0,active:!0}}update(e,t){for(const[s,i]of this.emitters){const n=this.effects.get(s);if(!n||!n.enabled)continue;const a=e>=n.startTime,o=e>n.startTime+n.duration;if(!a||o){i.active=!1;continue}i.active=!0,i.elapsedTime=e-n.startTime;const l=n.config,d={x:this.canvasWidth/2,y:this.canvasHeight/2,z:0};for(i.emissionAccumulator+=l.emissionRate*t;i.emissionAccumulator>=1&&i.particles.length<l.particleCount;)i.particles.push(this.createParticle(n,d)),i.emissionAccumulator-=1;for(const u of i.particles){if(!u.active)continue;u.velocity.x+=(u.acceleration.x+l.wind.x)*t,u.velocity.y+=(u.acceleration.y+l.wind.y)*t,u.velocity.z+=(u.acceleration.z+l.wind.z)*t,l.turbulence>0&&(u.velocity.x+=ps(-l.turbulence,l.turbulence)*t,u.velocity.y+=ps(-l.turbulence,l.turbulence)*t),u.position.x+=u.velocity.x*t,u.position.y+=u.velocity.y*t,u.position.z+=u.velocity.z*t,u.rotation+=u.rotationSpeed*t,u.age+=t;const h=u.age/u.lifetime;if(h<l.fadeIn)u.opacity=l.opacity.start*(h/l.fadeIn);else if(h>1-l.fadeOut){const p=(1-h)/l.fadeOut;u.opacity=l.opacity.end+(l.opacity.start-l.opacity.end)*p}else{const p=(h-l.fadeIn)/(1-l.fadeIn-l.fadeOut);u.opacity=l.opacity.start+(l.opacity.end-l.opacity.start)*p}u.age>=u.lifetime&&(u.active=!1)}i.particles=i.particles.filter(u=>u.active)}}getParticles(e){if(e){const s=this.emitters.get(e);return s?s.particles:[]}const t=[];for(const s of this.emitters.values())s.active&&t.push(...s.particles);return t}getActiveEffectIds(){const e=[];for(const[t,s]of this.emitters)s.active&&e.push(t);return e}reset(){for(const e of this.emitters.values())e.particles=[],e.elapsedTime=0,e.emissionAccumulator=0,e.active=!1}dispose(){this.emitters.clear(),this.effects.clear()}}let Em=null;function eu(){return Em||(Em=new nW),Em}const aW={maxFrames:100,maxSizeBytes:500*1024*1024,preloadAhead:30,preloadBehind:10};class oW{mediabunny=null;initialized=!1;frameCache=new Map;gifFrameCache=new Map;cacheConfig;cacheStats={hits:0,misses:0};preloadQueue=[];isPreloading=!1;compositeCanvas=null;compositeCtx=null;parallelDecoder=null;compositeBuffer=null;useParallelDecoding=!0;videoElementCache=new Map;gpuCompositor=null;gpuRenderer=null;effectsEngine=null;lastExportTime=-1;exportFrameRate=30;constructor(e={}){this.cacheConfig={...aW,...e}}async initialize(){if(!this.initialized){this.isWebCodecsSupported()||console.warn("[VideoEngine] WebCodecs not supported in this browser");try{this.mediabunny=await _i(()=>import("./index5.js"),[])}catch(e){console.warn("[VideoEngine] MediaBunny not available, some features will be limited:",e),this.mediabunny=null}try{this.useParallelDecoding&&(this.parallelDecoder=Q9(),await this.parallelDecoder.initialize())}catch(e){console.warn("[VideoEngine] Parallel decoder initialization failed:",e),this.parallelDecoder=null}this.compositeBuffer=Z9(),this.initialized=!0}}isWebCodecsSupported(){return typeof VideoDecoder<"u"&&typeof VideoEncoder<"u"}isMediaBunnyAvailable(){return this.mediabunny!==null}getParallelDecoder(){return this.parallelDecoder}getCompositeBuffer(){return this.compositeBuffer}getGPUCompositor(){return this.gpuCompositor}async initializeGPUCompositor(e,t){if(!this.gpuCompositor)try{const s=new OffscreenCanvas(e,t),i=j9();this.gpuRenderer=await i.createRenderer({canvas:s,width:e,height:t}),this.gpuCompositor=tW({width:e,height:t,backgroundColor:[0,0,0,1],antialias:!0}),this.gpuCompositor.setRenderer(this.gpuRenderer)}catch(s){console.warn("[VideoEngine] GPU compositor initialization failed, using CPU fallback:",s)}}isInitialized(){return this.initialized}setParallelDecoding(e){this.useParallelDecoding=e}async decodeFrameWithMediaBunny(e,t,s,i,n){try{const a=Ac();if(a.isAvailable()||await a.initialize(),n){const l=a.getExportDecoder(n);if(l){const d=await l.getFrame(t);if(d)return createImageBitmap(d)}}const o=await a.getFrameAtTime(e,t,s);return o?.canvas?createImageBitmap(o.canvas):null}catch(a){return console.warn("[VideoEngine] MediaBunny frame decode failed:",a),null}}async decodeFrameWithVideoElement(e,t,s,i,n){let a=this.videoElementCache.get(e);if(!a){const y=URL.createObjectURL(t),x=document.createElement("video");x.src=y,x.muted=!0,x.playsInline=!0,x.preload="auto",await new Promise((b,w)=>{x.onloadedmetadata=()=>b(),x.onerror=()=>w(new Error("Video load failed")),setTimeout(()=>w(new Error("Video load timeout")),1e4)}),a={video:x,url:y},this.videoElementCache.set(e,a)}const{video:o}=a;o.currentTime=s,await new Promise(y=>{let x=!1;const b=()=>{x||(x=!0,o.removeEventListener("seeked",b),y())};o.addEventListener("seeked",b),o.readyState>=2&&b(),setTimeout(()=>{x||(x=!0,o.removeEventListener("seeked",b),y())},3e3)});const l=new OffscreenCanvas(i,n),d=l.getContext("2d");if(!d)return null;d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high";const u=o.videoWidth/o.videoHeight,h=i/n;let p,f,m,g;return u>h?(p=i,f=i/u,m=0,g=(n-f)/2):(f=n,p=n*u,m=(i-p)/2,g=0),d.fillStyle="#000000",d.fillRect(0,0,i,n),d.drawImage(o,m,g,p,f),createImageBitmap(l)}clearVideoElementCache(){for(const[,e]of this.videoElementCache)e.video.src="",URL.revokeObjectURL(e.url);this.videoElementCache.clear()}ensureInitialized(){if(!this.initialized||!this.mediabunny)throw new Error("VideoEngine not initialized. Call initialize() first.")}async renderFrame(e,t,s,i){this.ensureInitialized();const{timeline:n,mediaLibrary:a,settings:o}=e,l=s??o.width,d=i??o.height,u=l/o.width,h=d/o.height,p=this.getActiveTextClips(n,t),f=this.getActiveShapeClips(n,t),m=this.getActiveSVGClips(n,t),g=this.getActiveStickerClips(n,t),y=this.getActiveSubtitles(n,t),x=n.tracks.map((k,S)=>({track:k,originalIndex:S})).filter(({track:k})=>(k.type==="video"||k.type==="image"||k.type==="text"||k.type==="graphics")&&!k.hidden).sort((k,S)=>S.originalIndex-k.originalIndex),b=new OffscreenCanvas(l,d),w=b.getContext("2d");w.imageSmoothingEnabled=!0,w.imageSmoothingQuality="high",w.fillStyle="#000000",w.fillRect(0,0,l,d);for(const{track:k,originalIndex:S}of x)if(k.type==="video"||k.type==="image"){const A=this.getClipsAtTime(k,t);for(const T of A){const j=this.createClipRenderInfo(T,t),_=a.items.find(P=>P.id===j.mediaId);if(!_?.blob)continue;let M=null;if(_.type==="image")try{if(b9(_.blob)){let P=this.gifFrameCache.get(_.id);if(!P){const R=await y9(_.blob);R&&(this.gifFrameCache.set(_.id,R),P=R)}if(P&&P.frames.length>0){const R=t-T.startTime,D=x9(P,R*1e3);M=P.frames[D]}else M=await createImageBitmap(_.blob)}else M=await createImageBitmap(_.blob)}catch(P){console.warn(`Failed to create ImageBitmap for image ${_.id}:`,P)}else M=await this.decodeFrameWithMediaBunny(_.blob,j.sourceTime,o.width,o.height,j.mediaId),M||(M=await this.decodeFrameWithVideoElement(_.id,_.blob,j.sourceTime,o.width,o.height));if(M){let P=j.transform;const R=t-T.startTime;if(T.emphasisAnimation&&T.emphasisAnimation.type!=="none"){const O=this.applyEmphasisAnimation(T.emphasisAnimation,R);P={...P,opacity:P.opacity*O.opacity,scale:{x:P.scale.x*O.scale*O.scaleX,y:P.scale.y*O.scale*O.scaleY},position:{x:P.position.x+O.offsetX*o.width,y:P.position.y+O.offsetY*o.height},rotation:P.rotation+O.rotation}}const D={...P,position:{x:P.position.x*u,y:P.position.y*h},scale:{x:P.scale.x*u,y:P.scale.y*h}};let B=M;if(T.effects&&T.effects.length>0)try{if(!this.effectsEngine){this.effectsEngine=new Su({width:l,height:d,useGPU:!0,preferWebGPU:!1});const F=this.effectsEngine.initialize(),I=new Promise((J,Z)=>setTimeout(()=>Z(new Error("Effects init timeout")),5e3));await Promise.race([F,I])}B=(await this.effectsEngine.applyEffects(M,T.effects)).image}catch(O){console.warn(`Failed to apply effects to clip ${T.id}:`,O),this.effectsEngine=null}this.drawFrameToContext(w,B,D,P.opacity,l,d,T.blendMode),B!==M&&B.close(),M.close()}}}else if(k.type==="graphics"){const A=f.filter(_=>_.trackId===k.id);for(const _ of A)await this.renderShapeClipToCanvasCtx(w,_,t,l,d);const T=m.filter(_=>_.trackId===k.id);for(const _ of T)await this.renderSVGClipToCanvasCtx(w,_,t,l,d);const j=g.filter(_=>_.trackId===k.id);for(const _ of j)await this.renderStickerClipToCanvasCtx(w,_,t,l,d)}else if(k.type==="text"){const A=p.filter(T=>T.trackId===k.id);for(const T of A)this.renderTextClipToCanvasCtx(w,T,t,l,d)}this.renderParticlesToContext(w,t,l,d);for(const k of y)this.renderSubtitleToCanvasCtx(w,k,l,d);const C=await createImageBitmap(b);if(this.compositeBuffer){const k=Math.floor(t*30);this.compositeBuffer.writeCompositedFrame(await createImageBitmap(C),t,k)}return{image:C,timestamp:t,width:l,height:d}}drawFrameToContext(e,t,s,i,n,a,o){if(e.save(),e.globalAlpha=i,o&&o!=="normal"){const u=this.getCanvasBlendMode(o);console.log(`[VideoEngine] Applying blend mode: ${o} -> ${u}`),e.globalCompositeOperation=u}else console.log("[VideoEngine] Using default blend mode (source-over)");const l=n/2,d=a/2;if(e.translate(l+s.position.x,d+s.position.y),e.rotate(s.rotation*Math.PI/180),e.scale(s.scale.x,s.scale.y),s.crop){const u=s.crop.x*t.width,h=s.crop.y*t.height,p=s.crop.width*t.width,f=s.crop.height*t.height,m=p/f,g=n/a;let y,x;m>g?(y=n,x=n/m):(x=a,y=a*m);const b=-y*s.anchor.x,w=-x*s.anchor.y;e.drawImage(t,u,h,p,f,b,w,y,x)}else{const u=-t.width*s.anchor.x,h=-t.height*s.anchor.y;e.drawImage(t,u,h)}e.restore()}getActiveTextClips(e,t){const s=go.getAllTextClips(),i=e.tracks.filter(a=>a.type==="text"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}getActiveShapeClips(e,t){const s=br.getAllShapeClips(),i=e.tracks.filter(a=>a.type==="graphics"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}getActiveSVGClips(e,t){const s=br.getAllSVGClips(),i=e.tracks.filter(a=>a.type==="graphics"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}getActiveStickerClips(e,t){const s=br.getAllStickerClips(),i=e.tracks.filter(a=>a.type==="graphics"&&!a.hidden),n=new Set(i.map(a=>a.id));return s.filter(a=>{if(!n.has(a.trackId))return!1;const o=a.startTime+a.duration;return t>=a.startTime&&t<o})}renderTextClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=go.renderText(t,i,n,a);e.drawImage(o.canvas,0,0)}async renderShapeClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=await br.renderGraphic(t,a,i,n);o.canvas instanceof OffscreenCanvas,e.drawImage(o.canvas,0,0)}async renderSVGClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=await br.renderGraphic(t,a,i,n);o.canvas instanceof OffscreenCanvas,e.drawImage(o.canvas,0,0)}async renderStickerClipToCanvasCtx(e,t,s,i,n){const a=s-t.startTime,o=await br.renderGraphic(t,a,i,n);o.canvas instanceof OffscreenCanvas,e.drawImage(o.canvas,0,0)}getActiveSubtitles(e,t){return(e.subtitles||[]).filter(i=>t>=i.startTime&&t<i.endTime)}renderParticlesToContext(e,t,s,i){const n=eu();n.setCanvasSize(s,i);const a=this.lastExportTime>=0?Math.max(0,t-this.lastExportTime):1/this.exportFrameRate;this.lastExportTime=t,n.update(t,a);const o=n.getParticles();if(o.length!==0){e.save();for(const l of o){if(!l.active||l.opacity<=0)continue;e.globalAlpha=l.opacity,e.fillStyle=l.color;const d=i-l.position.y;e.beginPath(),e.arc(l.position.x,d,l.size/2,0,Math.PI*2),e.fill()}e.restore()}}resetExportState(){this.lastExportTime=-1,eu().reset()}renderSubtitleToCanvasCtx(e,t,s,i){const{text:n,style:a}=t;if(!n||n.trim().length===0)return;e.save();const o=a?.fontSize||24,l=a?.fontFamily||"Inter",d=a?.color||"#ffffff",u=a?.backgroundColor||"rgba(0, 0, 0, 0.7)",h=a?.position||"bottom";e.font=`bold ${o}px "${l}"`,e.textAlign="center",e.textBaseline="middle";const p=n.split(`
`),f=o*1.3,m=p.length*f;let g;h==="top"?g=o*2:h==="center"?g=i/2-m/2:g=i-o*2-m;for(let y=0;y<p.length;y++){const x=p[y].trim();if(x.length===0)continue;const b=g+y*f+f/2,C=e.measureText(x).width+20,k=f;e.fillStyle=u,e.fillRect(s/2-C/2,b-k/2,C,k),e.fillStyle=d,e.fillText(x,s/2,b)}e.restore()}getClipsAtTime(e,t){return e.clips.filter(s=>{const i=s.startTime+s.duration;return t>=s.startTime&&t<i})}createClipRenderInfo(e,t){const s=t-e.startTime,i=gc(),n=e.inPoint+i.getSourceTimeAtPlaybackTime(e.id,s),a=this.getAnimatedTransform(e,s),o=this.getAnimatedEffects(e,s);return{clipId:e.id,mediaId:e.mediaId,media:null,sourceTime:n,transform:a,effects:o,opacity:a.opacity}}getAnimatedEffects(e,t){const s=e.keyframes||[],i=e.effects||[];if(s.length===0)return i;const n={"effect.brightness":"brightness","effect.contrast":"contrast","effect.saturation":"saturation","effect.blur":"blur"},a={};for(const[o,l]of Object.entries(n)){const d=pi.getKeyframesForProperty(s,o);if(d.length>0){const u=pi.getValueAtTime(d,t);typeof u.value=="number"&&(a[l]=u.value)}}return Object.keys(a).length===0?i:i.map(o=>{const l={...o.params};for(const[d,u]of Object.entries(a))(o.type===d||d in l)&&(l[d]=u);return{...o,params:l}})}getAnimatedTransform(e,t){const s=e.keyframes||[];if(s.length===0)return e.transform;const i=e.transform;let n=i.opacity,a=i.position.x,o=i.position.y,l=i.scale.x,d=i.scale.y,u=i.rotation;const h=pi.getKeyframesForProperty(s,"opacity");if(h.length>0){const x=pi.getValueAtTime(h,t);typeof x.value=="number"&&(n=x.value)}const p=pi.getKeyframesForProperty(s,"position.x");if(p.length>0){const x=pi.getValueAtTime(p,t);typeof x.value=="number"&&(a=x.value)}const f=pi.getKeyframesForProperty(s,"position.y");if(f.length>0){const x=pi.getValueAtTime(f,t);typeof x.value=="number"&&(o=x.value)}const m=pi.getKeyframesForProperty(s,"scale.x");if(m.length>0){const x=pi.getValueAtTime(m,t);typeof x.value=="number"&&(l=x.value)}const g=pi.getKeyframesForProperty(s,"scale.y");if(g.length>0){const x=pi.getValueAtTime(g,t);typeof x.value=="number"&&(d=x.value)}const y=pi.getKeyframesForProperty(s,"rotation");if(y.length>0){const x=pi.getValueAtTime(y,t);typeof x.value=="number"&&(u=x.value)}return{position:{x:a,y:o},scale:{x:l,y:d},rotation:u,opacity:n,anchor:i.anchor,borderRadius:i.borderRadius,fitMode:i.fitMode,crop:i.crop}}applyEmphasisAnimation(e,t){const{type:s,speed:i,intensity:n,loop:a,startTime:o,animationDuration:l}=e,d=o??0;if(t<d)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};if(l!==void 0&&l>0){const f=d+l;if(t>f)return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}const u=t-d,h=a?u*i%1:Math.min(u*i,1),p=h*Math.PI*2;switch(s){case"pulse":return{opacity:1,scale:1+Math.sin(p)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":{const f=Math.sin(p*5)*.02*n,m=Math.cos(p*5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:f,offsetY:m,rotation:0}}case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(p))*-.05*n,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(p)*.03*n,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:h*360*n};case"flash":return{opacity:.5+Math.abs(Math.sin(p))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":{const f=h*4;let m=1;return f<1?m=1+.15*n*Math.sin(f*Math.PI):f<2&&(m=1+.1*n*Math.sin((f-1)*Math.PI)),{opacity:1,scale:m,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p)*15*n};case"wobble":{const f=Math.sin(p*3)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(p)*.02*n,offsetY:0,rotation:f}}case"jello":{const f=1+Math.sin(p*2)*.1*n,m=1-Math.sin(p*2)*.1*n;return{opacity:1,scale:1,scaleX:f,scaleY:m,offsetX:0,offsetY:0,rotation:0}}case"rubber-band":{const f=1+Math.sin(p)*.2*n,m=1-Math.sin(p)*.1*n;return{opacity:1,scale:1,scaleX:f,scaleY:m,offsetX:0,offsetY:0,rotation:0}}case"tada":{const f=Math.sin(p*4)*10*n;return{opacity:1,scale:1+Math.sin(p*2)*.1*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:f}}case"vibrate":{const f=(Math.random()-.5)*.02*n,m=(Math.random()-.5)*.02*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:f,offsetY:m,rotation:0}}case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":{const f=1+Math.sin(p)*.05*n;return{opacity:.8+Math.sin(p)*.2,scale:f,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"breathe":return{opacity:1,scale:1+Math.sin(p*.5)*.08*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":{const f=Math.sin(p+u*2)*.03*n,m=Math.sin(p)*5*n;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:f,rotation:m}}case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(p*.5)*10*n};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(p)*.15*n,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const f=e.focusPoint||{x:.5,y:.5},m=e.zoomScale||1.5,g=e.holdDuration||.3,y=.3,x=1-g-y;let b=1,w=0,C=0;if(h<y){const k=h/y,S=1-Math.pow(1-k,3);b=1+(m-1)*S*n,w=(.5-f.x)*(b-1),C=(.5-f.y)*(b-1)}else if(h<y+g)b=m*n,w=(.5-f.x)*(b-1),C=(.5-f.y)*(b-1);else{const k=(h-y-g)/x,S=Math.pow(k,3);b=m-(m-1)*S*n,w=(.5-f.x)*(b-1),C=(.5-f.y)*(b-1)}return{opacity:1,scale:b,scaleX:1,scaleY:1,offsetX:w,offsetY:C,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-h*.2*n,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:h*.2*n,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-h*.2*n,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:h*.2*n,rotation:0};case"ken-burns":{const f=1+h*.3*n,m=h*.1*n,g=h*.05*n;return{opacity:1,scale:f,scaleX:1,scaleY:1,offsetX:m,offsetY:g,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}}async decodeFrame(e,t){if(!e.blob)return console.warn(`No blob available for media item ${e.id}`),null;if(e.type==="image")try{return await createImageBitmap(e.blob)}catch(l){return console.warn(`Failed to create ImageBitmap from image: ${l}`),null}this.ensureInitialized();const{Input:s,ALL_FORMATS:i,BlobSource:n,VideoSampleSink:a}=this.mediabunny,o=new s({source:new n(e.blob),formats:i});try{const l=await o.getPrimaryVideoTrack();if(!l)return null;if(!await l.canDecode())return console.warn(`Cannot decode video track for media ${e.id}`),null;const h=await new a(l).getSample(t);if(!h)return null;let p;try{const f=typeof h.toVideoFrame=="function",m=f?h.toVideoFrame():h;p=await createImageBitmap(m),f&&m!==h&&m.close()}catch{const f=new OffscreenCanvas(h.displayWidth,h.displayHeight),m=f.getContext("2d"),g=typeof h.draw=="function";if(m&&g)h.draw(m,0,0),p=await createImageBitmap(f);else return h.close(),null}return h.close(),p}finally{o[Symbol.dispose]?.()}}async decodeFrameToCanvas(e,t,s,i){this.ensureInitialized();const{Input:n,ALL_FORMATS:a,BlobSource:o,CanvasSink:l}=this.mediabunny;if(!e.blob)return null;const d=new n({source:new o(e.blob),formats:a});try{const u=await d.getPrimaryVideoTrack();if(!u||!await u.canDecode())return null;const p={poolSize:1,fit:"contain"};s&&(p.width=s),i&&(p.height=i);const m=await new l(u,p).getCanvas(t);if(!m)return null;const g=new OffscreenCanvas(m.canvas.width,m.canvas.height),y=g.getContext("2d");return y&&y.drawImage(m.canvas,0,0),g}finally{d[Symbol.dispose]?.()}}async compositeFrame(e,t,s){if(!this.compositeCtx)return;const i=this.compositeCtx,n=this.compositeCanvas.width,a=this.compositeCanvas.height;i.save(),i.globalAlpha=s;const o=n/2,l=a/2;if(i.translate(o+t.position.x,l+t.position.y),i.rotate(t.rotation*Math.PI/180),i.scale(t.scale.x,t.scale.y),t.crop){const d=t.crop.x*e.width,u=t.crop.y*e.height,h=t.crop.width*e.width,p=t.crop.height*e.height,f=h/p,m=n/a;let g,y;f>m?(g=n,y=n/f):(y=a,g=a*f);const x=-g*t.anchor.x,b=-y*t.anchor.y;i.drawImage(e,d,u,h,p,x,b,g,y)}else{const d=-e.width*t.anchor.x,u=-e.height*t.anchor.y;i.drawImage(e,d,u)}i.restore()}async composite(e,t,s){this.ensureCompositeCanvas(t,s);const i=this.compositeCtx;i.clearRect(0,0,t,s);for(const n of e)n.visible&&(i.save(),i.globalCompositeOperation=this.getCanvasBlendMode(n.blendMode),await this.compositeFrame(n.image instanceof ImageBitmap?n.image:await createImageBitmap(n.image),n.transform,n.transform.opacity),i.restore());return createImageBitmap(this.compositeCanvas)}getCanvasBlendMode(e){return{normal:"source-over",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","color-dodge":"color-dodge","color-burn":"color-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"}[e]||"source-over"}ensureCompositeCanvas(e,t){(!this.compositeCanvas||this.compositeCanvas.width!==e||this.compositeCanvas.height!==t)&&(this.compositeCanvas=new OffscreenCanvas(e,t),this.compositeCtx=this.compositeCanvas.getContext("2d"))}getCacheKey(e,t){const s=Math.round(t*30)/30;return`${e}:${s.toFixed(4)}`}cacheFrame(e,t,s){const i=t.width*t.height*4;this.evictIfNeeded(i),this.frameCache.set(e,{image:t,timestamp:parseFloat(e.split(":")[1]),mediaId:s,width:t.width,height:t.height,sizeBytes:i,lastAccessed:Date.now()})}evictIfNeeded(e){for(;this.frameCache.size>=this.cacheConfig.maxFrames;)this.evictOldestFrame();let t=this.getTotalCacheSize();for(;t+e>this.cacheConfig.maxSizeBytes&&this.frameCache.size>0;)this.evictOldestFrame(),t=this.getTotalCacheSize()}evictOldestFrame(){let e="",t=1/0;for(const[s,i]of this.frameCache.entries())i.lastAccessed<t&&(t=i.lastAccessed,e=s);if(e){const s=this.frameCache.get(e);s&&s.image.close(),this.frameCache.delete(e)}}getTotalCacheSize(){let e=0;for(const t of this.frameCache.values())e+=t.sizeBytes;return e}getCacheStats(){const e=this.cacheStats.hits+this.cacheStats.misses;return{entries:this.frameCache.size,sizeBytes:this.getTotalCacheSize(),hitRate:e>0?this.cacheStats.hits/e:0,maxSizeBytes:this.cacheConfig.maxSizeBytes,hits:this.cacheStats.hits,misses:this.cacheStats.misses}}clearCache(){for(const e of this.frameCache.values())e.image.close();this.frameCache.clear(),this.cacheStats={hits:0,misses:0}}async preloadFrames(e,t,s=30){if(this.ensureInitialized(),!e.blob)return;const i=1/s,n=Math.max(0,t-this.cacheConfig.preloadBehind*i),a=Math.min(e.metadata.duration,t+this.cacheConfig.preloadAhead*i),{Input:o,ALL_FORMATS:l,BlobSource:d,VideoSampleSink:u}=this.mediabunny,h=new o({source:new d(e.blob),formats:l});try{const p=await h.getPrimaryVideoTrack();if(!p||!await p.canDecode())return;const m=new u(p),g=[];for(let y=n;y<=a;y+=i){const x=this.getCacheKey(e.id,y);this.frameCache.has(x)||g.push(y)}for await(const y of m.samplesAtTimestamps(g)){if(!y)continue;const x=await createImageBitmap(y),b=this.getCacheKey(e.id,y.timestamp/1e6);this.cacheFrame(b,x,e.id),y.close()}}finally{h[Symbol.dispose]?.()}}queuePreload(e){this.preloadQueue=this.preloadQueue.filter(t=>t.mediaId!==e.mediaId),this.preloadQueue.push(e),this.preloadQueue.sort((t,s)=>s.priority-t.priority),this.processPreloadQueue()}async processPreloadQueue(){if(!(this.isPreloading||this.preloadQueue.length===0)){for(this.isPreloading=!0;this.preloadQueue.length>0;){const e=this.preloadQueue.shift();try{await this.preloadFramesRange(e.media,e.mediaId,e.startTime,e.endTime,e.frameRate)}catch(t){console.warn(`Preload failed for media ${e.mediaId}:`,t)}}this.isPreloading=!1}}async preloadFramesRange(e,t,s,i,n){this.ensureInitialized();const{Input:a,ALL_FORMATS:o,BlobSource:l,VideoSampleSink:d}=this.mediabunny,u=new a({source:new l(e),formats:o});try{const h=await u.getPrimaryVideoTrack();if(!h||!await h.canDecode())return;const f=new d(h),m=1/n,g=[];for(let y=s;y<=i;y+=m){const x=this.getCacheKey(t,y);this.frameCache.has(x)||g.push(y)}for await(const y of f.samplesAtTimestamps(g)){if(!y)continue;const x=await createImageBitmap(y),b=this.getCacheKey(t,y.timestamp/1e6);this.cacheFrame(b,x,t),y.close()}}finally{u[Symbol.dispose]?.()}}async getSupportedCodecs(){this.ensureInitialized();const{getEncodableVideoCodecs:e,getEncodableAudioCodecs:t}=this.mediabunny;try{const[s,i]=await Promise.all([e(),t()]);return{decode:["avc","hevc","vp8","vp9","av1"],encode:[...s,...i],hardware:!0}}catch{return{decode:[],encode:[],hardware:!1}}}isFormatSupported(e){return["video/mp4","video/webm","video/quicktime","video/x-matroska"].includes(e)}getAvailableFilters(){return[{type:"brightness",name:"Brightness",category:"color",gpuAccelerated:!0},{type:"contrast",name:"Contrast",category:"color",gpuAccelerated:!0},{type:"saturation",name:"Saturation",category:"color",gpuAccelerated:!0},{type:"hue",name:"Hue Rotation",category:"color",gpuAccelerated:!0},{type:"blur",name:"Blur",category:"blur",gpuAccelerated:!0},{type:"sharpen",name:"Sharpen",category:"blur",gpuAccelerated:!0},{type:"vignette",name:"Vignette",category:"stylize",gpuAccelerated:!0},{type:"grain",name:"Film Grain",category:"stylize",gpuAccelerated:!0},{type:"chromaKey",name:"Chroma Key",category:"keying",gpuAccelerated:!0}]}async applyFilter(e,t){const s=new OffscreenCanvas(e.width,e.height),i=s.getContext("2d");if(!i)return e;i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(e,0,0);const n=this.buildFilterString(t);return n&&(i.filter=n,i.drawImage(s,0,0)),createImageBitmap(s)}buildFilterString(e){if(!e.enabled)return"";const t=e.params;switch(e.type){case"brightness":return`brightness(${1+(t.value||0)})`;case"contrast":return`contrast(${t.value||1})`;case"saturation":return`saturate(${t.value||1})`;case"hue":return`hue-rotate(${t.rotation||0}deg)`;case"blur":return`blur(${t.radius||0}px)`;default:return""}}dispose(){this.clearCache(),this.clearVideoElementCache(),this.compositeCanvas=null,this.compositeCtx=null,this.preloadQueue=[],this.initialized=!1,this.mediabunny=null}}let Mm=null;function kM(){return Mm||(Mm=new oW),Mm}const sy={shadows:{r:0,g:0,b:0},midtones:{r:0,g:0,b:0},highlights:{r:0,g:0,b:0},shadowsLift:0,midtonesGamma:1,highlightsGain:1},iy={rgb:[{x:0,y:0},{x:1,y:1}],red:[{x:0,y:0},{x:1,y:1}],green:[{x:0,y:0},{x:1,y:1}],blue:[{x:0,y:0},{x:1,y:1}]},ry={hue:[0,0,0,0,0,0,0,0],saturation:[0,0,0,0,0,0,0,0],luminance:[0,0,0,0,0,0,0,0]},eh=`#version 300 es
precision highp float;

in vec2 a_position;
in vec2 a_texCoord;

out vec2 v_texCoord;

void main() {
 gl_Position = vec4(a_position, 0.0, 1.0);
 v_texCoord = a_texCoord;
}
`,cW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform vec3 u_shadows;
uniform vec3 u_midtones;
uniform vec3 u_highlights;
uniform float u_shadowsLift;
uniform float u_midtonesGamma;
uniform float u_highlightsGain;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float luma = dot(color.rgb, vec3(0.299, 0.587, 0.114));
 float shadowWeight = 1.0 - smoothstep(0.0, 0.5, luma);
 float highlightWeight = smoothstep(0.5, 1.0, luma);
 float midtoneWeight = 1.0 - shadowWeight - highlightWeight;
 vec3 rgb = color.rgb;
 rgb += u_shadows * shadowWeight;
 rgb += u_midtones * midtoneWeight;
 rgb += u_highlights * highlightWeight;
 rgb = rgb + u_shadowsLift * shadowWeight;
 rgb = pow(rgb, vec3(1.0 / u_midtonesGamma));
 rgb = rgb * (1.0 + (u_highlightsGain - 1.0) * highlightWeight);
 
 fragColor = vec4(clamp(rgb, 0.0, 1.0), color.a);
}
`,lW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform sampler2D u_curveLUT;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 float r = texture(u_curveLUT, vec2(color.r, 0.125)).r;
 float g = texture(u_curveLUT, vec2(color.g, 0.375)).r;
 float b = texture(u_curveLUT, vec2(color.b, 0.625)).r;
 float masterR = texture(u_curveLUT, vec2(r, 0.875)).r;
 float masterG = texture(u_curveLUT, vec2(g, 0.875)).r;
 float masterB = texture(u_curveLUT, vec2(b, 0.875)).r;
 
 fragColor = vec4(masterR, masterG, masterB, color.a);
}
`,dW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform float u_hue[8];
uniform float u_saturation[8];
uniform float u_luminance[8];

vec3 rgb2hsl(vec3 c) {
 float maxC = max(max(c.r, c.g), c.b);
 float minC = min(min(c.r, c.g), c.b);
 float l = (maxC + minC) / 2.0;
 
 if (maxC == minC) {
 return vec3(0.0, 0.0, l);
 }
 
 float d = maxC - minC;
 float s = l > 0.5 ? d / (2.0 - maxC - minC) : d / (maxC + minC);
 
 float h;
 if (maxC == c.r) {
 h = (c.g - c.b) / d + (c.g < c.b ? 6.0 : 0.0);
 } else if (maxC == c.g) {
 h = (c.b - c.r) / d + 2.0;
 } else {
 h = (c.r - c.g) / d + 4.0;
 }
 h /= 6.0;
 
 return vec3(h, s, l);
}

float hue2rgb(float p, float q, float t) {
 if (t < 0.0) t += 1.0;
 if (t > 1.0) t -= 1.0;
 if (t < 1.0/6.0) return p + (q - p) * 6.0 * t;
 if (t < 1.0/2.0) return q;
 if (t < 2.0/3.0) return p + (q - p) * (2.0/3.0 - t) * 6.0;
 return p;
}

vec3 hsl2rgb(vec3 hsl) {
 if (hsl.y == 0.0) {
 return vec3(hsl.z);
 }
 
 float q = hsl.z < 0.5 ? hsl.z * (1.0 + hsl.y) : hsl.z + hsl.y - hsl.z * hsl.y;
 float p = 2.0 * hsl.z - q;
 
 float r = hue2rgb(p, q, hsl.x + 1.0/3.0);
 float g = hue2rgb(p, q, hsl.x);
 float b = hue2rgb(p, q, hsl.x - 1.0/3.0);
 
 return vec3(r, g, b);
}

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 vec3 hsl = rgb2hsl(color.rgb);
 
 // Determine which hue range this pixel falls into (8 ranges)
 int hueIndex = int(hsl.x * 8.0) % 8;
 hsl.x = fract(hsl.x + u_hue[hueIndex] / 360.0);
 hsl.y = clamp(hsl.y + u_saturation[hueIndex], 0.0, 1.0);
 hsl.z = clamp(hsl.z + u_luminance[hueIndex], 0.0, 1.0);
 
 vec3 rgb = hsl2rgb(hsl);
 fragColor = vec4(rgb, color.a);
}
`,uW=`#version 300 es
precision highp float;

in vec2 v_texCoord;
out vec4 fragColor;

uniform sampler2D u_texture;
uniform sampler2D u_lut;
uniform float u_lutSize;
uniform float u_intensity;

void main() {
 vec4 color = texture(u_texture, v_texCoord);
 
 // 3D LUT lookup (stored as 2D texture)
 float blueSlice = color.b * (u_lutSize - 1.0);
 float blueSliceFloor = floor(blueSlice);
 float blueSliceCeil = ceil(blueSlice);
 float blueFrac = blueSlice - blueSliceFloor;

 
 vec2 quad1 = vec2(
 (blueSliceFloor + color.r) / u_lutSize,
 color.g
 );
 vec2 quad2 = vec2(
 (blueSliceCeil + color.r) / u_lutSize,
 color.g
 );
 
 vec3 lutColor1 = texture(u_lut, quad1).rgb;
 vec3 lutColor2 = texture(u_lut, quad2).rgb;
 vec3 lutColor = mix(lutColor1, lutColor2, blueFrac);
 
 // Mix with original based on intensity
 vec3 result = mix(color.rgb, lutColor, u_intensity);
 fragColor = vec4(result, color.a);
}
`;class hW{canvas=null;gl=null;shaders=new Map;quadBuffer=null;texCoordBuffer=null;curveLUTTexture=null;width;height;initialized=!1;constructor(e=1920,t=1080){this.width=e,this.height=t}initialize(){if(this.initialized)return;this.canvas=new OffscreenCanvas(this.width,this.height);const e=this.canvas.getContext("webgl2",{preserveDrawingBuffer:!0,premultipliedAlpha:!0,alpha:!0});if(!e)throw new Error("WebGL2 not supported");this.gl=e,this.quadBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW),this.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),e.STATIC_DRAW),this.compileShader("colorWheels",eh,cW),this.compileShader("curves",eh,lW),this.compileShader("hsl",eh,dW),this.compileShader("lut",eh,uW),this.initialized=!0}compileShader(e,t,s){const i=this.gl,n=i.createShader(i.VERTEX_SHADER);if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error(`Vertex shader error: ${i.getShaderInfoLog(n)}`);const a=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(a,s),i.compileShader(a),!i.getShaderParameter(a,i.COMPILE_STATUS))throw new Error(`Fragment shader error: ${i.getShaderInfoLog(a)}`);const o=i.createProgram();if(i.attachShader(o,n),i.attachShader(o,a),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw new Error(`Program link error: ${i.getProgramInfoLog(o)}`);const l=new Map,d=i.getProgramParameter(o,i.ACTIVE_UNIFORMS);for(let p=0;p<d;p++){const f=i.getActiveUniform(o,p);if(f){const m=i.getUniformLocation(o,f.name);m&&l.set(f.name,m)}}const u=new Map,h=i.getProgramParameter(o,i.ACTIVE_ATTRIBUTES);for(let p=0;p<h;p++){const f=i.getActiveAttrib(o,p);f&&u.set(f.name,i.getAttribLocation(o,f.name))}this.shaders.set(e,{program:o,uniforms:l,attributes:u}),i.deleteShader(n),i.deleteShader(a)}async applyColorWheels(e,t){const s=performance.now();this.ensureInitialized();const i=this.gl,n=this.shaders.get("colorWheels"),a=this.uploadTexture(e);i.bindFramebuffer(i.FRAMEBUFFER,null),i.viewport(0,0,this.width,this.height),i.useProgram(n.program),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a);const o=n.uniforms.get("u_texture");o&&i.uniform1i(o,0);const l=n.uniforms.get("u_shadows"),d=n.uniforms.get("u_midtones"),u=n.uniforms.get("u_highlights"),h=n.uniforms.get("u_shadowsLift"),p=n.uniforms.get("u_midtonesGamma"),f=n.uniforms.get("u_highlightsGain");return l&&i.uniform3f(l,t.shadows.r,t.shadows.g,t.shadows.b),d&&i.uniform3f(d,t.midtones.r,t.midtones.g,t.midtones.b),u&&i.uniform3f(u,t.highlights.r,t.highlights.g,t.highlights.b),h&&i.uniform1f(h,t.shadowsLift),p&&i.uniform1f(p,t.midtonesGamma),f&&i.uniform1f(f,t.highlightsGain),this.setupVertexAttributes(n),i.drawArrays(i.TRIANGLE_STRIP,0,4),i.deleteTexture(a),{image:await createImageBitmap(this.canvas),processingTime:performance.now()-s}}async applyCurves(e,t){const s=performance.now();this.ensureInitialized();const i=new OffscreenCanvas(e.width,e.height),n=i.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,e.width,e.height),o=a.data,l=this.buildCurveLUT(t.rgb),d=this.buildCurveLUT(t.red),u=this.buildCurveLUT(t.green),h=this.buildCurveLUT(t.blue);for(let f=0;f<o.length;f+=4){let m=d[o[f]],g=u[o[f+1]],y=h[o[f+2]];o[f]=l[m],o[f+1]=l[g],o[f+2]=l[y]}return n.putImageData(a,0,0),{image:await createImageBitmap(i),processingTime:performance.now()-s}}buildCurveLUT(e){const t=new Uint8Array(256),s=[...e].sort((i,n)=>i.x-n.x);if((s.length===0||s[0].x>0)&&s.unshift({x:0,y:0}),s[s.length-1].x<1&&s.push({x:1,y:1}),s.length===2){for(let i=0;i<256;i++){const a=(i/255-s[0].x)/(s[1].x-s[0].x),o=s[0].y+a*(s[1].y-s[0].y);t[i]=Math.round(Math.max(0,Math.min(255,o*255)))}return t}for(let i=0;i<256;i++){const n=i/255;let a=n;for(let o=0;o<s.length-1;o++)if(n>=s[o].x&&n<=s[o+1].x){const l=o>0?s[o-1]:s[o],d=s[o],u=s[o+1],h=o+2<s.length?s[o+2]:s[o+1],p=(n-d.x)/(u.x-d.x),f=p*p,m=f*p;a=.5*(2*d.y+(-l.y+u.y)*p+(2*l.y-5*d.y+4*u.y-h.y)*f+(-l.y+3*d.y-3*u.y+h.y)*m);break}t[i]=Math.round(Math.max(0,Math.min(255,a*255)))}return t}async applyLUT(e,t){const s=performance.now(),i=new OffscreenCanvas(e.width,e.height),n=i.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,e.width,e.height),o=a.data,l=t.size,d=t.data;for(let h=0;h<o.length;h+=4){const p=o[h]/255,f=o[h+1]/255,m=o[h+2]/255,g=p*(l-1),y=f*(l-1),x=m*(l-1),b=Math.floor(g),w=Math.floor(y),C=Math.floor(x),k=Math.min(b+1,l-1),S=Math.min(w+1,l-1),A=Math.min(C+1,l-1),T=g-b,j=y-w,_=x-C,M=(O,F,I,J)=>{const Z=(I*l*l+F*l+O)*3+J;return d[Z]/255},P=O=>{const F=M(b,w,C,O)*(1-T)+M(k,w,C,O)*T,I=M(b,w,A,O)*(1-T)+M(k,w,A,O)*T,J=M(b,S,C,O)*(1-T)+M(k,S,C,O)*T,Z=M(b,S,A,O)*(1-T)+M(k,S,A,O)*T,E=F*(1-j)+J*j,G=I*(1-j)+Z*j;return E*(1-_)+G*_},R=P(0),D=P(1),B=P(2);o[h]=Math.round((p*(1-t.intensity)+R*t.intensity)*255),o[h+1]=Math.round((f*(1-t.intensity)+D*t.intensity)*255),o[h+2]=Math.round((m*(1-t.intensity)+B*t.intensity)*255)}return n.putImageData(a,0,0),{image:await createImageBitmap(i),processingTime:performance.now()-s}}async applyHSL(e,t){const s=performance.now(),i=new OffscreenCanvas(e.width,e.height),n=i.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,e.width,e.height),o=a.data;for(let d=0;d<o.length;d+=4){const u=o[d]/255,h=o[d+1]/255,p=o[d+2]/255,f=this.rgbToHsl(u,h,p),m=Math.floor(f.h*8)%8;f.h=(f.h+t.hue[m]/360+1)%1,f.s=Math.max(0,Math.min(1,f.s+t.saturation[m])),f.l=Math.max(0,Math.min(1,f.l+t.luminance[m]));const g=this.hslToRgb(f.h,f.s,f.l);o[d]=Math.round(g.r*255),o[d+1]=Math.round(g.g*255),o[d+2]=Math.round(g.b*255)}return n.putImageData(a,0,0),{image:await createImageBitmap(i),processingTime:performance.now()-s}}async generateWaveform(e){const s=new OffscreenCanvas(e.width,e.height).getContext("2d");s.drawImage(e,0,0);const n=s.getImageData(0,0,e.width,e.height).data,a=e.width,o=e.height,l=256,d=new Uint8Array(a*l),u=new Uint8Array(a*l),h=new Uint8Array(a*l),p=new Uint8Array(a*l);for(let f=0;f<a;f++)for(let m=0;m<o;m++){const g=(m*a+f)*4,y=n[g],x=n[g+1],b=n[g+2],w=Math.round(.299*y+.587*x+.114*b);d[w*a+f]++,u[y*a+f]++,h[x*a+f]++,p[b*a+f]++}return{luminance:d,red:u,green:h,blue:p,width:a,height:l}}async generateVectorscope(e,t=256){const i=new OffscreenCanvas(e.width,e.height).getContext("2d");i.drawImage(e,0,0);const a=i.getImageData(0,0,e.width,e.height).data,o=new Uint8Array(t*t),l=t/2;for(let d=0;d<a.length;d+=4){const u=a[d]/255,h=a[d+1]/255,p=a[d+2]/255,f=-.14713*u-.28886*h+.436*p,m=.615*u-.51499*h-.10001*p,g=Math.round(l+f*l*2),y=Math.round(l-m*l*2);if(g>=0&&g<t&&y>=0&&y<t){const x=y*t+g;o[x]=Math.min(255,o[x]+1)}}return{data:o,size:t}}async generateHistogram(e){const s=new OffscreenCanvas(e.width,e.height).getContext("2d");s.drawImage(e,0,0);const n=s.getImageData(0,0,e.width,e.height).data,a=new Uint32Array(256),o=new Uint32Array(256),l=new Uint32Array(256),d=new Uint32Array(256);for(let u=0;u<n.length;u+=4){const h=n[u],p=n[u+1],f=n[u+2],m=Math.round(.299*h+.587*p+.114*f);a[h]++,o[p]++,l[f]++,d[m]++}return{red:a,green:o,blue:l,luminance:d}}rgbToHsl(e,t,s){const i=Math.max(e,t,s),n=Math.min(e,t,s),a=(i+n)/2;if(i===n)return{h:0,s:0,l:a};const o=i-n,l=a>.5?o/(2-i-n):o/(i+n);let d;return i===e?d=((t-s)/o+(t<s?6:0))/6:i===t?d=((s-e)/o+2)/6:d=((e-t)/o+4)/6,{h:d,s:l,l:a}}hslToRgb(e,t,s){if(t===0)return{r:s,g:s,b:s};const i=s<.5?s*(1+t):s+t-s*t,n=2*s-i,a=o=>(o<0&&(o+=1),o>1&&(o-=1),o<1/6?n+(i-n)*6*o:o<1/2?i:o<2/3?n+(i-n)*(2/3-o)*6:n);return{r:a(e+1/3),g:a(e),b:a(e-1/3)}}uploadTexture(e){const t=this.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),s}setupVertexAttributes(e){const t=this.gl,s=e.attributes.get("a_position");s!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.quadBuffer),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0));const i=e.attributes.get("a_texCoord");i!==void 0&&(t.bindBuffer(t.ARRAY_BUFFER,this.texCoordBuffer),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0))}ensureInitialized(){this.initialized||this.initialize()}dispose(){if(this.gl){for(const e of this.shaders.values())this.gl.deleteProgram(e.program);this.shaders.clear(),this.quadBuffer&&this.gl.deleteBuffer(this.quadBuffer),this.texCoordBuffer&&this.gl.deleteBuffer(this.texCoordBuffer),this.curveLUTTexture&&this.gl.deleteTexture(this.curveLUTTexture)}this.canvas=null,this.gl=null,this.initialized=!1}}class pW{canvas=null;ctx=null;width;height;initialized=!1;constructor(e){this.width=e.width,this.height=e.height,this.initializeCanvas()}initializeCanvas(){if(!this.initialized){try{typeof OffscreenCanvas<"u"&&(this.canvas=new OffscreenCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d"))}catch{this.canvas=null,this.ctx=null}this.initialized=!0}}getContext(){if(!this.ctx)throw new Error("Canvas context not available");return this.ctx}async renderTransition(e,t,s,i){const n=performance.now();if(!this.canvas||!this.ctx)throw new Error("Canvas not available. Rendering requires a browser environment.");const a=Math.max(0,Math.min(1,i)),o=this.applyEasing(a,s.params.curve);switch(this.ctx.clearRect(0,0,this.width,this.height),s.type){case"crossfade":await this.renderCrossfade(e,t,o);break;case"dipToBlack":await this.renderDipToColor(e,t,o,"black",s.params.holdDuration||0);break;case"dipToWhite":await this.renderDipToColor(e,t,o,"white",s.params.holdDuration||0);break;case"wipe":await this.renderWipe(e,t,o,s.params.direction||"left",s.params.softness||0);break;case"slide":await this.renderSlide(e,t,o,s.params.direction||"left",s.params.pushOut||!1);break;case"zoom":await this.renderZoom(e,t,o,s.params.scale||2,s.params.center||{x:.5,y:.5});break;case"push":await this.renderPush(e,t,o,s.params.direction||"left");break;default:await this.renderCrossfade(e,t,o)}return{frame:await createImageBitmap(this.canvas),processingTime:performance.now()-n,gpuAccelerated:!1}}async renderCrossfade(e,t,s){const i=this.getContext();i.globalAlpha=1-s,i.drawImage(e,0,0,this.width,this.height),i.globalAlpha=s,i.drawImage(t,0,0,this.width,this.height),i.globalAlpha=1}async renderDipToColor(e,t,s,i,n){const a=2+n,o=1/a,l=(1+n)/a,d=this.getContext();if(s<o){const u=s/o;d.drawImage(e,0,0,this.width,this.height),d.fillStyle=i,d.globalAlpha=u,d.fillRect(0,0,this.width,this.height),d.globalAlpha=1}else if(s<l)d.fillStyle=i,d.fillRect(0,0,this.width,this.height);else{const u=(s-l)/(1-l);d.fillStyle=i,d.fillRect(0,0,this.width,this.height),d.globalAlpha=u,d.drawImage(t,0,0,this.width,this.height),d.globalAlpha=1}}async renderWipe(e,t,s,i,n){const a=this.getContext();a.drawImage(e,0,0,this.width,this.height),a.save();const o=n*Math.max(this.width,this.height)*.1;switch(i){case"left":this.createWipeClip(a,s*this.width,0,this.width,this.height);break;case"right":this.createWipeClip(a,0,0,this.width*(1-s),this.height,!0);break;case"up":this.createWipeClip(a,0,s*this.height,this.width,this.height);break;case"down":this.createWipeClip(a,0,0,this.width,this.height*(1-s),!0);break;case"diagonal":this.createDiagonalWipeClip(a,s);break;default:this.createWipeClip(a,s*this.width,0,this.width,this.height)}n>0&&o>0&&(a.globalAlpha=.8),a.drawImage(t,0,0,this.width,this.height),a.restore()}createWipeClip(e,t,s,i,n,a=!1){e.beginPath(),a?e.rect(i,s,this.width-i,n):e.rect(t,s,i-t,n-s),e.clip()}createDiagonalWipeClip(e,t){const s=(this.width+this.height)*t;e.beginPath(),e.moveTo(s,0),e.lineTo(s-this.height,this.height),e.lineTo(this.width,this.height),e.lineTo(this.width,0),e.closePath(),e.clip()}async renderSlide(e,t,s,i,n){const a=this.getContext();let o=0,l=0,d=0,u=0;switch(i){case"left":d=this.width*(1-s),n&&(o=-this.width*s);break;case"right":d=-this.width*(1-s),n&&(o=this.width*s);break;case"up":u=this.height*(1-s),n&&(l=-this.height*s);break;case"down":u=-this.height*(1-s),n&&(l=this.height*s);break}(n||s<1)&&a.drawImage(e,o,l,this.width,this.height),a.drawImage(t,d,u,this.width,this.height)}async renderZoom(e,t,s,i,n){const a=1+(i-1)*s,o=1-s,l=1/i+(1-1/i)*s,d=s,u=this.width*n.x,h=this.height*n.y,p=this.getContext();p.save(),p.globalAlpha=o,p.translate(u,h),p.scale(a,a),p.translate(-u,-h),p.drawImage(e,0,0,this.width,this.height),p.restore(),p.save(),p.globalAlpha=d,p.translate(u,h),p.scale(l,l),p.translate(-u,-h),p.drawImage(t,0,0,this.width,this.height),p.restore()}async renderPush(e,t,s,i){await this.renderSlide(e,t,s,i,!0)}applyEasing(e,t){const s={linear:n=>n,ease:n=>n*n*(3-2*n),"ease-in":n=>n*n,"ease-out":n=>n*(2-n),"ease-in-out":n=>n<.5?2*n*n:-1+(4-2*n)*n};return(s[t||"linear"]||s.linear)(e)}validateTransition(e,t,s){const i=e.startTime+e.duration;if(Math.abs(t.startTime-i)>.001)return{valid:!1,error:"Clips must be adjacent to add a transition"};if(e.trackId!==t.trackId)return{valid:!1,error:"Clips must be on the same track"};const a=e.outPoint-e.duration,o=t.inPoint,l=e.duration+a,d=t.duration+o,u=Math.min(e.duration,t.duration,l,d);return s>u?{valid:!0,warning:`Insufficient handle frames. Maximum transition duration is ${u.toFixed(2)}s`,maxDuration:u}:s<=0?{valid:!1,error:"Transition duration must be positive"}:{valid:!0,maxDuration:u}}areClipsAdjacent(e,t){if(e.trackId!==t.trackId)return!1;const s=e.startTime+e.duration;return Math.abs(t.startTime-s)<.001}findAdjacentClipPairs(e){const t=[],s=[...e.clips].sort((i,n)=>i.startTime-n.startTime);for(let i=0;i<s.length-1;i++){const n=s[i],a=s[i+1];this.areClipsAdjacent(n,a)&&t.push({clipA:n,clipB:a})}return t}createTransition(e,t,s,i,n){const a=this.validateTransition(e,t,i);if(!a.valid&&!a.warning)return null;const o=a.maxDuration?Math.min(i,a.maxDuration):i,l=this.getDefaultParams(s);return{id:`transition-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,clipAId:e.id,clipBId:t.id,type:s,duration:o,params:{...l,...n}}}getDefaultParams(e){switch(e){case"crossfade":return{curve:"ease"};case"dipToBlack":return{holdDuration:.1};case"dipToWhite":return{holdDuration:.1};case"wipe":return{direction:"left",softness:0};case"slide":return{direction:"left",pushOut:!1};case"zoom":return{scale:2,center:{x:.5,y:.5}};case"push":return{direction:"left"};default:return{}}}updateTransitionDuration(e,t,s,i){const n=this.validateTransition(t,s,i),a=n.maxDuration?Math.min(i,n.maxDuration):i;return{...e,duration:a}}removeTransition(e,t){return{...e,transitions:e.transitions.filter(s=>s.id!==t)}}calculateTransitionProgress(e,t,s){const i=t.startTime+t.duration-e.duration/2,n=i+e.duration;return s<=i?0:s>=n?1:(s-i)/e.duration}isTimeInTransition(e,t,s){const i=t.startTime+t.duration-e.duration/2,n=i+e.duration;return s>=i&&s<=n}resize(e,t){if(this.width=e,this.height=t,typeof OffscreenCanvas<"u")try{this.canvas=new OffscreenCanvas(e,t),this.ctx=this.canvas.getContext("2d")}catch{}}getAvailableTransitionTypes(){return["crossfade","dipToBlack","dipToWhite","wipe","slide","zoom","push"]}dispose(){this.ctx&&this.ctx.clearRect(0,0,this.width,this.height),this.canvas=null,this.ctx=null}}function CM(r=1920,e=1080){return new pW({width:r,height:e})}function Pm(){return`mask-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}function fW(r){switch(r.type){case"rectangle":{const{x:e,y:t,width:s,height:i}=r;return{points:[{x:e,y:t},{x:e+s,y:t},{x:e+s,y:t+i},{x:e,y:t+i}],closed:!0}}case"ellipse":{const{cx:e,cy:t,rx:s,ry:i}=r,n=.5522847498;return{points:[{x:e,y:t-i,handleIn:{x:e-s*n,y:t-i},handleOut:{x:e+s*n,y:t-i}},{x:e+s,y:t,handleIn:{x:e+s,y:t-i*n},handleOut:{x:e+s,y:t+i*n}},{x:e,y:t+i,handleIn:{x:e+s*n,y:t+i},handleOut:{x:e-s*n,y:t+i}},{x:e-s,y:t,handleIn:{x:e-s,y:t+i*n},handleOut:{x:e-s,y:t-i*n}}],closed:!0}}case"polygon":return{points:r.points.map(e=>({x:e.x,y:e.y})),closed:!0}}}function mW(r,e,t){t=Math.max(0,Math.min(1,t));const s=Math.max(r.points.length,e.points.length),i=[];for(let n=0;n<s;n++){const a=r.points[n%r.points.length],o=e.points[n%e.points.length],l={x:a.x+(o.x-a.x)*t,y:a.y+(o.y-a.y)*t};if(a.handleIn||o.handleIn){const d=a.handleIn||{x:a.x,y:a.y},u=o.handleIn||{x:o.x,y:o.y};l.handleIn={x:d.x+(u.x-d.x)*t,y:d.y+(u.y-d.y)*t}}if(a.handleOut||o.handleOut){const d=a.handleOut||{x:a.x,y:a.y},u=o.handleOut||{x:o.x,y:o.y};l.handleOut={x:d.x+(u.x-d.x)*t,y:d.y+(u.y-d.y)*t}}i.push(l)}return{points:i,closed:r.closed||e.closed}}function gW(r,e){switch(e){case"linear":return r;case"ease-in":return r*r;case"ease-out":return 1-(1-r)*(1-r);case"ease-in-out":return r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2;default:return r}}class yW{canvas;ctx;maskCanvas;maskCtx;width;height;masks=new Map;constructor(e){this.width=e.width,this.height=e.height,this.canvas=new OffscreenCanvas(e.width,e.height),this.ctx=this.canvas.getContext("2d"),this.maskCanvas=new OffscreenCanvas(e.width,e.height),this.maskCtx=this.maskCanvas.getContext("2d")}createShapeMask(e,t){const s=fW(t),i={id:Pm(),clipId:e,type:"shape",path:s,feathering:0,inverted:!1,expansion:0,opacity:1,keyframes:[]};return this.masks.set(i.id,i),i}createDrawnMask(e,t){const s={id:Pm(),clipId:e,type:"drawn",path:t,feathering:0,inverted:!1,expansion:0,opacity:1,keyframes:[]};return this.masks.set(s.id,s),s}getMask(e){return this.masks.get(e)}getMasksForClip(e){return Array.from(this.masks.values()).filter(t=>t.clipId===e)}updateMaskPath(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,path:t})}setFeathering(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,feathering:Math.max(0,Math.min(100,t))})}setInverted(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,inverted:t})}setExpansion(e,t){const s=this.masks.get(e);s&&this.masks.set(e,{...s,expansion:Math.max(-100,Math.min(100,t))})}addMaskKeyframe(e,t,s){const i=this.masks.get(e);if(!i)return null;const n={id:Pm(),time:t,path:s,easing:"linear"},a=[...i.keyframes,n].sort((o,l)=>o.time-l.time);return this.masks.set(e,{...i,keyframes:a}),n}removeMaskKeyframe(e,t){const s=this.masks.get(e);if(s){const i=s.keyframes.filter(n=>n.id!==t);this.masks.set(e,{...s,keyframes:i})}}setKeyframeEasing(e,t,s){const i=this.masks.get(e);if(i){const n=i.keyframes.map(a=>a.id===t?{...a,easing:s}:a);this.masks.set(e,{...i,keyframes:n})}}getMaskAtTime(e,t){const s=this.masks.get(e);if(!s)return null;if(s.keyframes.length===0)return s.path;if(s.keyframes.length===1)return s.keyframes[0].path;let i=null,n=null;for(const u of s.keyframes)if(u.time<=t)i=u;else if(!n){n=u;break}if(!i)return s.keyframes[0].path;if(!n)return i.path;const a=n.time-i.time,o=t-i.time,l=a>0?o/a:0,d=gW(l,i.easing);return mW(i.path,n.path,d)}deleteMask(e){this.masks.delete(e)}deleteMasksForClip(e){for(const[t,s]of this.masks)s.clipId===e&&this.masks.delete(t)}async applyMask(e,t,s){const i=performance.now(),n=s!==void 0&&this.getMaskAtTime(t.id,s)||t.path;if(this.ctx.clearRect(0,0,this.width,this.height),this.maskCtx.clearRect(0,0,this.width,this.height),this.generateMaskFromPath(n,t.inverted),t.feathering>0&&this.applyFeathering(t.feathering),t.expansion!==0&&this.applyExpansion(t.expansion),this.ctx.drawImage(e,0,0,this.width,this.height),this.ctx.globalCompositeOperation="destination-in",this.ctx.drawImage(this.maskCanvas,0,0),this.ctx.globalCompositeOperation="source-over",t.opacity<1){const o=new OffscreenCanvas(this.width,this.height),l=o.getContext("2d");l.globalAlpha=t.opacity,l.drawImage(this.canvas,0,0),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(o,0,0)}return{image:await createImageBitmap(this.canvas),processingTime:performance.now()-i,gpuAccelerated:!1}}async applyMaskDefinition(e,t){const s=performance.now();return this.ctx.clearRect(0,0,this.width,this.height),this.maskCtx.clearRect(0,0,this.width,this.height),this.generateMaskShape(t),t.feather>0&&this.applyFeathering(t.feather),t.expansion!==0&&this.applyExpansion(t.expansion),this.ctx.drawImage(e,0,0,this.width,this.height),this.ctx.globalCompositeOperation="destination-in",this.ctx.drawImage(this.maskCanvas,0,0),this.ctx.globalCompositeOperation="source-over",t.opacity<1&&(this.ctx.globalAlpha=t.opacity,this.ctx.drawImage(this.canvas,0,0),this.ctx.globalAlpha=1),{image:await createImageBitmap(this.canvas),processingTime:performance.now()-s,gpuAccelerated:!1}}generateMaskFromPath(e,t){const s=this.maskCtx;t?(s.fillStyle="white",s.fillRect(0,0,this.width,this.height),s.fillStyle="black"):s.fillStyle="white",s.beginPath(),this.drawBezierPath(s,e),s.closePath(),s.fill()}drawBezierPath(e,t){if(t.points.length<2)return;const s=t.points;e.moveTo(s[0].x*this.width,s[0].y*this.height);for(let i=0;i<s.length;i++){const n=s[i],a=s[(i+1)%s.length];if(!t.closed&&i===s.length-1)break;const o=n.handleOut||{x:n.x+(a.x-n.x)*.3,y:n.y+(a.y-n.y)*.3},l=a.handleIn||{x:a.x-(a.x-n.x)*.3,y:a.y-(a.y-n.y)*.3};e.bezierCurveTo(o.x*this.width,o.y*this.height,l.x*this.width,l.y*this.height,a.x*this.width,a.y*this.height)}}generateMaskShape(e){const t=this.maskCtx;switch(e.inverted?(t.fillStyle="white",t.fillRect(0,0,this.width,this.height),t.fillStyle="black"):t.fillStyle="white",t.beginPath(),e.type){case"rectangle":this.drawRectangleMask(t,e.points);break;case"ellipse":this.drawEllipseMask(t,e.points);break;case"polygon":this.drawPolygonMask(t,e.points);break;case"bezier":this.drawBezierMask(t,e.points,e.bezierPoints);break}t.closePath(),t.fill()}drawRectangleMask(e,t){if(t.length<2)return;const s=Math.min(t[0].x,t.length>1?t[1].x:t[0].x),i=Math.min(t[0].y,t.length>1?t[1].y:t[0].y),n=Math.max(t.length>2?t[2].x:t[1].x,t.length>1?t[1].x:t[0].x),a=Math.max(t.length>2?t[2].y:t[1].y,t.length>3?t[3].y:t.length>1?t[1].y:t[0].y),o=s*this.width,l=i*this.height,d=n*this.width,u=a*this.height;e.rect(o,l,d-o,u-l)}drawEllipseMask(e,t){if(t.length<2)return;const s=t[0].x*this.width,i=t[0].y*this.height,n=Math.abs(t[1].x-t[0].x)*this.width,a=Math.abs(t[1].y-t[0].y)*this.height;e.ellipse(s,i,n,a,0,0,Math.PI*2)}drawPolygonMask(e,t){if(!(t.length<3)){e.moveTo(t[0].x*this.width,t[0].y*this.height);for(let s=1;s<t.length;s++)e.lineTo(t[s].x*this.width,t[s].y*this.height)}}drawBezierMask(e,t,s){if(t.length<2)return;const i=s||t.map(n=>({x:n.x,y:n.y}));e.moveTo(i[0].x*this.width,i[0].y*this.height);for(let n=0;n<i.length;n++){const a=i[n],o=i[(n+1)%i.length],l=a.handleOut||{x:a.x+(o.x-a.x)*.3,y:a.y+(o.y-a.y)*.3},d=o.handleIn||{x:o.x-(o.x-a.x)*.3,y:o.y-(o.y-a.y)*.3};e.bezierCurveTo(l.x*this.width,l.y*this.height,d.x*this.width,d.y*this.height,o.x*this.width,o.y*this.height)}}applyFeathering(e){const t=new OffscreenCanvas(this.width,this.height),s=t.getContext("2d");s.filter=`blur(${e}px)`,s.drawImage(this.maskCanvas,0,0),this.maskCtx.clearRect(0,0,this.width,this.height),this.maskCtx.drawImage(t,0,0)}applyExpansion(e){if(e===0)return;const s=this.maskCtx.getImageData(0,0,this.width,this.height).data,i=new Uint8ClampedArray(s.length);i.set(s);const n=Math.abs(e),a=e>0;for(let l=0;l<this.height;l++)for(let d=0;d<this.width;d++){const u=(l*this.width+d)*4;let h=!1;for(let p=-n;p<=n&&!h;p++)for(let f=-n;f<=n&&!h;f++){const m=d+f,g=l+p;if(m>=0&&m<this.width&&g>=0&&g<this.height){const y=(g*this.width+m)*4;Math.sqrt(f*f+p*p)<=n&&(a&&s[y+3]>128||!a&&s[y+3]<128)&&(h=!0)}}a&&h?i[u+3]=255:!a&&h&&(i[u+3]=0)}const o=new ImageData(i,this.width,this.height);this.maskCtx.putImageData(o,0,0)}invertMask(e){return{...e,inverted:!e.inverted}}setFeather(e,t){return{...e,feather:Math.max(0,Math.min(100,t))}}updatePoints(e,t){return{...e,points:t}}addPoint(e,t,s){const i=[...e.points];return s!==void 0&&s>=0&&s<=i.length?i.splice(s,0,t):i.push(t),{...e,points:i}}removePoint(e,t){if(e.points.length<=3)return e;const s=[...e.points];return s.splice(t,1),{...e,points:s}}isPointInMask(e,t){this.maskCtx.clearRect(0,0,this.width,this.height),this.generateMaskShape({...e,inverted:!1});const s=Math.floor(t.x*this.width),i=Math.floor(t.y*this.height),a=this.maskCtx.getImageData(s,i,1,1).data[3]>128;return e.inverted?!a:a}getMaskBounds(e){if(e.type==="ellipse"&&e.points.length>=2){const a=e.points[0].x,o=e.points[0].y,l=Math.abs(e.points[1].x-e.points[0].x),d=Math.abs(e.points[1].y-e.points[0].y);return{x:a-l,y:o-d,width:l*2,height:d*2}}let t=1/0,s=1/0,i=-1/0,n=-1/0;for(const a of e.points)t=Math.min(t,a.x),s=Math.min(s,a.y),i=Math.max(i,a.x),n=Math.max(n,a.y);return{x:t,y:s,width:i-t,height:n-s}}resize(e,t){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.maskCanvas.width=e,this.maskCanvas.height=t}getDimensions(){return{width:this.width,height:this.height}}clearAllMasks(){this.masks.clear()}}function xW(){return["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion"]}function bW(r){return{normal:"Normal",multiply:"Multiply",screen:"Screen",overlay:"Overlay",darken:"Darken",lighten:"Lighten","color-dodge":"Color Dodge","color-burn":"Color Burn","hard-light":"Hard Light","soft-light":"Soft Light",difference:"Difference",exclusion:"Exclusion",hue:"Hue",saturation:"Saturation",color:"Color",luminosity:"Luminosity"}[r]||r}const vW={enabled:!1,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5};function Fl(){return{...vW}}class SM{canvas;ctx;width;height;clipSettings=new Map;constructor(e){this.width=e.width,this.height=e.height,this.canvas=new OffscreenCanvas(e.width,e.height),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0})}enableChromaKey(e){const t=this.clipSettings.get(e);t?this.clipSettings.set(e,{...t,enabled:!0}):this.clipSettings.set(e,{...Fl(),enabled:!0})}disableChromaKey(e){const t=this.clipSettings.get(e);t&&this.clipSettings.set(e,{...t,enabled:!1})}isEnabled(e){return this.clipSettings.get(e)?.enabled??!1}setKeyColor(e,t){const s=this.clipSettings.get(e)||Fl();this.clipSettings.set(e,{...s,keyColor:{r:Math.max(0,Math.min(1,t.r)),g:Math.max(0,Math.min(1,t.g)),b:Math.max(0,Math.min(1,t.b))}})}sampleKeyColor(e,t,s){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const i=Math.floor(t*this.width),n=Math.floor(s*this.height),a=this.ctx.getImageData(i,n,1,1);return{r:a.data[0]/255,g:a.data[1]/255,b:a.data[2]/255}}setTolerance(e,t){const s=this.clipSettings.get(e)||Fl();this.clipSettings.set(e,{...s,tolerance:Math.max(0,Math.min(1,t))})}setEdgeSoftness(e,t){const s=this.clipSettings.get(e)||Fl();this.clipSettings.set(e,{...s,edgeSoftness:Math.max(0,Math.min(1,t))})}setSpillSuppression(e,t){const s=this.clipSettings.get(e)||Fl();this.clipSettings.set(e,{...s,spillSuppression:Math.max(0,Math.min(1,t))})}getSettings(e){return this.clipSettings.get(e)}setSettings(e,t){this.clipSettings.set(e,{...t})}async applyChromaKey(e,t){const s=performance.now(),i=this.clipSettings.get(t);return!i||!i.enabled?{image:await createImageBitmap(e),processingTime:performance.now()-s,gpuAccelerated:!1}:this.applyChromaKeyWithSettings(e,i,s)}async applyChromaKeyWithSettings(e,t,s=performance.now()){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const i=this.ctx.getImageData(0,0,this.width,this.height),n=i.data,{keyColor:a,tolerance:o,edgeSoftness:l,spillSuppression:d}=t;let u=0,h=0,p=0;for(let g=0;g<n.length;g+=4){const y=n[g]/255,x=n[g+1]/255,b=n[g+2]/255,w=this.colorDistance(y,x,b,a);let C=this.calculateAlpha(w,o,l);if(u<10&&g%1e4===0&&(console.log(`[ChromaKey Sample] RGB(${y.toFixed(2)}, ${x.toFixed(2)}, ${b.toFixed(2)}) vs Key(${a.r}, ${a.g}, ${a.b}) => distance=${w.toFixed(3)}, alpha=${C.toFixed(3)}`),u++),C<.1?h++:C>.9&&p++,d>0&&C>0){const k=this.suppressSpill(y,x,b,a,d,C);n[g]=Math.round(k.r*255),n[g+1]=Math.round(k.g*255),n[g+2]=Math.round(k.b*255)}n[g+3]=Math.round(C*255)}this.ctx.putImageData(i,0,0);const f=n.length/4;return console.log(`[ChromaKey] Processed ${f} pixels: ${h} transparent (${(h/f*100).toFixed(1)}%), ${p} opaque (${(p/f*100).toFixed(1)}%)`),{image:await createImageBitmap(this.canvas),processingTime:performance.now()-s,gpuAccelerated:!1}}getMatte(e,t){const s=this.clipSettings.get(t);if(!s||!s.enabled){const p=this.ctx.createImageData(this.width,this.height);for(let f=0;f<p.data.length;f+=4)p.data[f]=255,p.data[f+1]=255,p.data[f+2]=255,p.data[f+3]=255;return{matte:p,transparentPixels:0,totalPixels:this.width*this.height}}this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const n=this.ctx.getImageData(0,0,this.width,this.height).data,a=this.ctx.createImageData(this.width,this.height),o=a.data,{keyColor:l,tolerance:d,edgeSoftness:u}=s;let h=0;for(let p=0;p<n.length;p+=4){const f=n[p]/255,m=n[p+1]/255,g=n[p+2]/255,y=this.colorDistance(f,m,g,l),x=this.calculateAlpha(y,d,u),b=Math.round(x*255);o[p]=b,o[p+1]=b,o[p+2]=b,o[p+3]=255,x===0&&h++}return{matte:a,transparentPixels:h,totalPixels:this.width*this.height}}colorDistance(e,t,s,i){const n=e-i.r,a=t-i.g,o=s-i.b;return Math.sqrt(n*n+a*a+o*o)}calculateAlpha(e,t,s){const i=t*1.732,n=s*.5;if(e<=i-n)return 0;if(e>=i+n)return 1;{const a=n*2;return(e-(i-n))/a}}suppressSpill(e,t,s,i,n,a){if(a>=1||a<=0)return{r:e,g:t,b:s};const o=1-a,l=Math.max(i.r,i.g,i.b);let d=e,u=t,h=s;if(i.g===l){const p=(e+s)/2,f=Math.max(0,t-p);u=t-f*n*o}else if(i.b===l){const p=(e+t)/2,f=Math.max(0,s-p);h=s-f*n*o}else{const p=(t+s)/2,f=Math.max(0,e-p);d=e-f*n*o}return{r:Math.max(0,Math.min(1,d)),g:Math.max(0,Math.min(1,u)),b:Math.max(0,Math.min(1,h))}}async composite(e,t){return this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(t,0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height),createImageBitmap(this.canvas)}async applyAndComposite(e,t,s){const i=performance.now(),n=await this.applyChromaKey(e,s),a=await this.composite(n.image,t);return n.image.close(),{image:a,processingTime:performance.now()-i,gpuAccelerated:!1}}countTransparentPixels(e){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(e,0,0,this.width,this.height);const s=this.ctx.getImageData(0,0,this.width,this.height).data;let i=0;for(let n=3;n<s.length;n+=4)s[n]===0&&i++;return i}resize(e,t){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t}getDimensions(){return{width:this.width,height:this.height}}clearSettings(e){this.clipSettings.delete(e)}clearAllSettings(){this.clipSettings.clear()}}function mC(r){return`${r}-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}class wW{trackingJobs=new Map;trackingData=new Map;attachments=new Map;progressCallbacks=new Set;lostCallbacks=new Set;constructor(){}async startTracking(e,t,s={}){const i=mC("track-job"),n={id:i,clipId:e,region:t,status:"pending",progress:0,options:{frameRate:s.frameRate??30,startFrame:s.startFrame??0,endFrame:s.endFrame??300,algorithm:s.algorithm??"correlation",confidenceThreshold:s.confidenceThreshold??.7},startTime:Date.now()};return this.trackingJobs.set(i,n),this.runTracking(n),n}async runTracking(e){e.status="running",this.trackingJobs.set(e.id,e);const{startFrame:t,endFrame:s,frameRate:i,confidenceThreshold:n}=e.options,a=(s??300)-(t??0),o=[],l=[],d=[];for(let p=0;p<=a;p++){const f=this.trackingJobs.get(e.id);if(!f||f.status==="cancelled")return;const m=(t??0)+p,g=this.simulateTracking(e.region,m,p);o.push({frame:m,position:g.position,scale:g.scale,rotation:g.rotation}),l.push(g.confidence),g.confidence<(n??.7)&&(d.push(m),this.notifyTrackingLost(m)),e.progress=p/a*100,this.trackingJobs.set(e.id,e),this.notifyProgress(e.progress),await new Promise(y=>setTimeout(y,0))}const u=mC("track"),h={trackId:u,clipId:e.clipId,keyframes:o,confidence:l,lostFrames:d,region:e.region,frameRate:i??30};this.trackingData.set(u,h),e.status="completed",e.progress=100,e.endTime=Date.now(),this.trackingJobs.set(e.id,e)}simulateTracking(e,t,s){const i=e.x+e.width/2,n=e.y+e.height/2,a=Math.sin(s*.1)*50,o=Math.cos(s*.15)*30,l=(Math.random()-.5)*2,d=(Math.random()-.5)*2,u=s%50===0?.5:.85+Math.random()*.15;return{position:{x:i+a+l,y:n+o+d},scale:1+Math.sin(s*.05)*.1,rotation:Math.sin(s*.02)*.1,confidence:u}}cancelTracking(e){const t=this.trackingJobs.get(e);t&&t.status==="running"&&(t.status="cancelled",t.endTime=Date.now(),this.trackingJobs.set(e,t))}getTrackingJob(e){return this.trackingJobs.get(e)}getTrackingData(e,t){const s=this.trackingData.get(t);if(s&&s.clipId===e)return s}getTrackingDataForClip(e){return Array.from(this.trackingData.values()).filter(t=>t.clipId===e)}applyTrackingToElement(e,t,s={x:0,y:0}){if(!this.trackingData.get(e))throw new Error(`Tracking data not found: ${e}`);const n={elementId:t,trackId:e,offset:s,applyScale:!0,applyRotation:!0};this.attachments.set(t,n)}removeTrackingFromElement(e){this.attachments.delete(e)}getAttachment(e){return this.attachments.get(e)}getAttachmentsForTrack(e){return Array.from(this.attachments.values()).filter(t=>t.trackId===e)}getElementPositionAtTime(e,t){const s=this.attachments.get(e);if(!s)return null;const i=this.trackingData.get(s.trackId);if(!i)return null;const n=Math.floor(t*i.frameRate),a=this.getTrackedPositionAtFrame(i,n);return a?{x:a.x+s.offset.x,y:a.y+s.offset.y}:null}getTrackedPositionAtFrame(e,t){if(e.keyframes.length===0)return null;let s=null,i=null;for(const a of e.keyframes)if(a.frame<=t)s=a;else if(!i){i=a;break}if(!s)return e.keyframes[0].position;if(!i||s.frame===t)return s.position;const n=(t-s.frame)/(i.frame-s.frame);return{x:s.position.x+(i.position.x-s.position.x)*n,y:s.position.y+(i.position.y-s.position.y)*n}}onTrackingProgress(e){return this.progressCallbacks.add(e),()=>this.progressCallbacks.delete(e)}onTrackingLost(e){return this.lostCallbacks.add(e),()=>this.lostCallbacks.delete(e)}notifyProgress(e){for(const t of this.progressCallbacks)t(e)}notifyTrackingLost(e){for(const t of this.lostCallbacks)t(e)}correctTrackingPoint(e,t,s){const i=this.trackingData.get(e);if(!i)throw new Error(`Tracking data not found: ${e}`);const n=i.keyframes.findIndex(a=>a.frame===t);if(n>=0){i.keyframes[n].position=s,i.confidence[n]=1;const a=i.lostFrames.indexOf(t);a>=0&&i.lostFrames.splice(a,1)}else{const a={frame:t,position:s,scale:1,rotation:0};let o=i.keyframes.findIndex(l=>l.frame>t);o===-1&&(o=i.keyframes.length),i.keyframes.splice(o,0,a),i.confidence.splice(o,0,1)}this.trackingData.set(e,i)}setTrackingOffset(e,t){const s=this.attachments.get(e);s&&(s.offset=t,this.attachments.set(e,s))}getTrackingOffset(e){return this.attachments.get(e)?.offset??null}setApplyScale(e,t){const s=this.attachments.get(e);s&&(s.applyScale=t,this.attachments.set(e,s))}setApplyRotation(e,t){const s=this.attachments.get(e);s&&(s.applyRotation=t,this.attachments.set(e,s))}deleteTrackingData(e){for(const[t,s]of this.attachments)s.trackId===e&&this.attachments.delete(t);this.trackingData.delete(e)}deleteTrackingDataForClip(e){for(const[t,s]of this.trackingData)s.clipId===e&&this.deleteTrackingData(t)}clear(){this.trackingJobs.clear(),this.trackingData.clear(),this.attachments.clear()}getTrackIds(){return Array.from(this.trackingData.keys())}hasTracking(e){return this.attachments.has(e)}}let Nm=null;function kW(){return Nm||(Nm=new wW),Nm}const th=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6","#ec4899"];class CW{groups=new Map;switches=new Map;constructor(){}createGroup(e,t){const s=`multicam_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,i=t.map((a,o)=>({id:`angle_${o+1}`,name:`Angle ${o+1}`,clipId:a,trackId:"",offset:0,color:th[o%th.length],isActive:o===0})),n={id:s,name:e,angles:i,activeAngleId:i[0]?.id||"",syncPoint:0,duration:0,createdAt:Date.now()};return this.groups.set(s,n),this.switches.set(s,[]),n}getGroup(e){return this.groups.get(e)}getAllGroups(){return Array.from(this.groups.values())}deleteGroup(e){return this.switches.delete(e),this.groups.delete(e)}addAngle(e,t,s){const i=this.groups.get(e);if(!i)return null;const n=i.angles.length,a={id:`angle_${Date.now()}`,name:s||`Angle ${n+1}`,clipId:t,trackId:"",offset:0,color:th[n%th.length],isActive:!1};return i.angles.push(a),a}removeAngle(e,t){const s=this.groups.get(e);if(!s)return!1;const i=s.angles.findIndex(n=>n.id===t);return i===-1?!1:(s.angles.splice(i,1),s.activeAngleId===t&&s.angles.length>0&&(s.activeAngleId=s.angles[0].id,s.angles[0].isActive=!0),!0)}setActiveAngle(e,t){const s=this.groups.get(e);return!s||!s.angles.find(n=>n.id===t)?!1:(s.angles.forEach(n=>{n.isActive=n.id===t}),s.activeAngleId=t,!0)}getActiveAngle(e){const t=this.groups.get(e);return t&&t.angles.find(s=>s.id===t.activeAngleId)||null}addSwitch(e,t,s){const i=this.groups.get(e);if(!i||!i.angles.find(l=>l.id===t))return null;const a={id:`switch_${Date.now()}`,groupId:e,angleId:t,time:s},o=this.switches.get(e)||[];return o.push(a),o.sort((l,d)=>l.time-d.time),this.switches.set(e,o),a}removeSwitch(e,t){const s=this.switches.get(e);if(!s)return!1;const i=s.findIndex(n=>n.id===t);return i===-1?!1:(s.splice(i,1),!0)}getSwitches(e){return this.switches.get(e)||[]}getAngleAtTime(e,t){const s=this.groups.get(e);if(!s)return null;const i=this.switches.get(e)||[];let n=s.angles[0]?.id;for(const a of i)if(a.time<=t)n=a.angleId;else break;return s.angles.find(a=>a.id===n)||null}setAngleOffset(e,t,s){const i=this.groups.get(e);if(!i)return!1;const n=i.angles.find(a=>a.id===t);return n?(n.offset=s,!0):!1}renameAngle(e,t,s){const i=this.groups.get(e);if(!i)return!1;const n=i.angles.find(a=>a.id===t);return n?(n.name=s,!0):!1}async syncByAudio(e,t,s){const i=this.groups.get(e);if(!i)return new Map;const n=new Map,a=s.get(t);if(!a)return n;for(const o of i.angles){if(o.id===t){n.set(o.id,{offset:0,confidence:1,method:"audio"});continue}const l=s.get(o.id);if(!l){n.set(o.id,{offset:0,confidence:0,method:"manual"});continue}const d=await this.findAudioOffset(a,l);n.set(o.id,d),o.offset=d.offset}return n}async findAudioOffset(e,t){const s=e.getChannelData(0),i=t.getChannelData(0),n=e.sampleRate,a=Math.min(n*5,s.length,i.length),o=Math.min(n*30,i.length-a);let l=0,d=-1/0;const u=Math.max(1,Math.floor(n/100));for(let f=-o;f<=o;f+=u){let m=0,g=0;for(let y=0;y<a;y+=u){const x=y,b=y+f;b>=0&&b<i.length&&(m+=s[x]*i[b],g++)}g>0&&(m/=g,m>d&&(d=m,l=f))}const h=l/n,p=Math.max(0,Math.min(1,(d+1)/2));return{offset:h,confidence:p,method:"audio"}}setSyncPoint(e,t){const s=this.groups.get(e);return s?(s.syncPoint=t,!0):!1}clearGroup(e){const t=this.groups.get(e);t&&(t.angles=[],t.activeAngleId=""),this.switches.set(e,[])}clearAll(){this.groups.clear(),this.switches.clear()}exportGroupAsSequence(e){const t=this.groups.get(e);if(!t)return[];const s=this.switches.get(e)||[],i=[];if(s.length===0&&t.angles.length>0){const l=t.angles.find(d=>d.id===t.activeAngleId);return l&&i.push({clipId:l.clipId,startTime:0,endTime:t.duration}),i}let n=t.angles[0]?.id,a=0;for(let l=0;l<s.length;l++){const d=s[l],u=t.angles.find(h=>h.id===n);u&&d.time>a&&i.push({clipId:u.clipId,startTime:a,endTime:d.time}),n=d.angleId,a=d.time}const o=t.angles.find(l=>l.id===n);return o&&a<t.duration&&i.push({clipId:o.clipId,startTime:a,endTime:t.duration}),i}}const SW={normal:{name:"Normal",description:"Standard blending"},multiply:{name:"Multiply",description:"Darkens by multiplying colors"},screen:{name:"Screen",description:"Lightens by screening colors"},overlay:{name:"Overlay",description:"Combines multiply and screen"},darken:{name:"Darken",description:"Keeps darker pixels"},lighten:{name:"Lighten",description:"Keeps lighter pixels"},"color-dodge":{name:"Color Dodge",description:"Brightens base color"},"color-burn":{name:"Color Burn",description:"Darkens base color"},"hard-light":{name:"Hard Light",description:"Strong overlay effect"},"soft-light":{name:"Soft Light",description:"Gentle overlay effect"},difference:{name:"Difference",description:"Subtracts colors"},exclusion:{name:"Exclusion",description:"Similar to difference, lower contrast"},hue:{name:"Hue",description:"Applies hue only"},saturation:{name:"Saturation",description:"Applies saturation only"},color:{name:"Color",description:"Applies hue and saturation"},luminosity:{name:"Luminosity",description:"Applies luminosity only"}};function gC(){return`adj_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}class TW{layers=new Map;layersByTrack=new Map;createAdjustmentLayer(e,t,s={}){const i={id:gC(),trackId:e,name:s.name||`Adjustment Layer ${this.layers.size+1}`,startTime:t,duration:s.duration||5,effects:s.effects||[],opacity:s.opacity??1,blendMode:s.blendMode||"normal",enabled:!0,affectedTracks:"all",transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1}};return this.layers.set(i.id,i),this.layersByTrack.has(e)||this.layersByTrack.set(e,new Set),this.layersByTrack.get(e).add(i.id),i}getLayer(e){return this.layers.get(e)}getAllLayers(){return Array.from(this.layers.values())}getLayersForTrack(e){const t=this.layersByTrack.get(e);return t?Array.from(t).map(s=>this.layers.get(s)).filter(s=>s!==void 0):[]}getActiveLayersAtTime(e,t){const s=[];for(const i of this.layers.values())i.enabled&&e>=i.startTime&&e<i.startTime+i.duration&&s.push(i);return s.sort((i,n)=>t!==void 0?0:i.startTime-n.startTime)}updateLayer(e,t){const s=this.layers.get(e);return s?(t.trackId&&t.trackId!==s.trackId&&(this.layersByTrack.get(s.trackId)?.delete(e),this.layersByTrack.has(t.trackId)||this.layersByTrack.set(t.trackId,new Set),this.layersByTrack.get(t.trackId).add(e)),this.layers.set(e,{...s,...t,id:s.id}),!0):!1}deleteLayer(e){const t=this.layers.get(e);return t?(this.layersByTrack.get(t.trackId)?.delete(e),this.layers.delete(e)):!1}addEffect(e,t){const s=this.layers.get(e);if(!s)return!1;const i={...t,id:`effect_${Date.now()}_${Math.random().toString(36).slice(2,11)}`};return this.layers.set(e,{...s,effects:[...s.effects,i]}),!0}removeEffect(e,t){const s=this.layers.get(e);return s?(this.layers.set(e,{...s,effects:s.effects.filter(i=>i.id!==t)}),!0):!1}updateEffect(e,t,s){const i=this.layers.get(e);if(!i)return!1;const n=i.effects.findIndex(o=>o.id===t);if(n===-1)return!1;const a=[...i.effects];return a[n]={...a[n],...s,id:t},this.layers.set(e,{...i,effects:a}),!0}setOpacity(e,t){return this.updateLayer(e,{opacity:Math.max(0,Math.min(1,t))})}setBlendMode(e,t){return this.updateLayer(e,{blendMode:t})}setEnabled(e,t){return this.updateLayer(e,{enabled:t})}setAffectedTracks(e,t){return this.updateLayer(e,{affectedTracks:t})}getEffectsForClip(e,t,s){const i=[];for(const n of this.layers.values()){if(!n.enabled||t<n.startTime||t>=n.startTime+n.duration)continue;const a=s.get(n.trackId);if(a!==void 0&&!(a<e)&&!(n.affectedTracks!=="all"&&!n.affectedTracks.map(l=>s.get(l)).filter(l=>l!==void 0).some(l=>l===e)))for(const o of n.effects)o.enabled!==!1&&i.push({layerId:n.id,effect:o,opacity:n.opacity,blendMode:n.blendMode})}return i}duplicateLayer(e,t){const s=this.layers.get(e);if(!s)return null;const i={...s,id:gC(),trackId:t||s.trackId,name:`${s.name} (Copy)`,effects:s.effects.map(n=>({...n,id:`effect_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}))};return this.layers.set(i.id,i),this.layersByTrack.has(i.trackId)||this.layersByTrack.set(i.trackId,new Set),this.layersByTrack.get(i.trackId).add(i.id),i}getBlendModes(){return Object.entries(SW).map(([e,t])=>({id:e,...t}))}clearAll(){this.layers.clear(),this.layersByTrack.clear()}}const yC={enabled:!1,quality:"balanced",sharpening:.3},AW=`
struct Dimensions {
 srcWidth: u32,
 srcHeight: u32,
 dstWidth: u32,
 dstHeight: u32,
 direction: u32,
 padding: vec3<u32>,
};

@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(2) var<uniform> dims: Dimensions;

const PI: f32 = 3.14159265359;
const LANCZOS_A: f32 = 3.0;

fn sinc(x: f32) -> f32 {
 if (abs(x) < 0.0001) {
 return 1.0;
 }
 let pix = PI * x;
 return sin(pix) / pix;
}

fn lanczosWeight(x: f32) -> f32 {
 if (abs(x) >= LANCZOS_A) {
 return 0.0;
 }
 return sinc(x) * sinc(x / LANCZOS_A);
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let dstX = global_id.x;
 let dstY = global_id.y;

 var targetWidth: u32;
 var targetHeight: u32;
 var srcWidth: u32;
 var srcHeight: u32;

 if (dims.direction == 0u) {
 targetWidth = dims.dstWidth;
 targetHeight = dims.srcHeight;
 srcWidth = dims.srcWidth;
 srcHeight = dims.srcHeight;
 } else {
 targetWidth = dims.dstWidth;
 targetHeight = dims.dstHeight;
 srcWidth = dims.dstWidth;
 srcHeight = dims.srcHeight;
 }

 if (dstX >= targetWidth || dstY >= targetHeight) {
 return;
 }

 var scale: f32;
 var srcPos: f32;

 if (dims.direction == 0u) {
 scale = f32(srcWidth) / f32(targetWidth);
 srcPos = (f32(dstX) + 0.5) * scale - 0.5;
 } else {
 scale = f32(srcHeight) / f32(targetHeight);
 srcPos = (f32(dstY) + 0.5) * scale - 0.5;
 }

 let srcCenter = i32(floor(srcPos));
 let kernelRadius = i32(ceil(LANCZOS_A * max(1.0, scale)));

 var colorSum = vec4<f32>(0.0);
 var weightSum: f32 = 0.0;

 for (var i = -kernelRadius; i <= kernelRadius; i = i + 1) {
 let srcIdx = srcCenter + i;
 var sampleCoords: vec2<i32>;

 if (dims.direction == 0u) {
 let clampedX = clamp(srcIdx, 0, i32(srcWidth) - 1);
 sampleCoords = vec2<i32>(clampedX, i32(dstY));
 } else {
 let clampedY = clamp(srcIdx, 0, i32(srcHeight) - 1);
 sampleCoords = vec2<i32>(i32(dstX), clampedY);
 }

 let dist = (f32(srcIdx) + 0.5 - srcPos) / max(1.0, scale);
 let weight = lanczosWeight(dist);

 if (weight > 0.0001) {
 colorSum = colorSum + textureLoad(inputTexture, sampleCoords, 0) * weight;
 weightSum = weightSum + weight;
 }
 }

 var finalColor: vec4<f32>;
 if (weightSum > 0.0001) {
 finalColor = colorSum / weightSum;
 } else {
 if (dims.direction == 0u) {
 finalColor = textureLoad(inputTexture, vec2<i32>(clamp(srcCenter, 0, i32(srcWidth) - 1), i32(dstY)), 0);
 } else {
 finalColor = textureLoad(inputTexture, vec2<i32>(i32(dstX), clamp(srcCenter, 0, i32(srcHeight) - 1)), 0);
 }
 }

 finalColor = clamp(finalColor, vec4<f32>(0.0), vec4<f32>(1.0));
 textureStore(outputTexture, vec2<i32>(i32(dstX), i32(dstY)), finalColor);
}
`,jW=`
struct Dimensions {
 width: u32,
 height: u32,
 padding: vec2<u32>,
};

@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(2) var<uniform> dims: Dimensions;

fn getLuminance(color: vec3<f32>) -> f32 {
 return dot(color, vec3<f32>(0.299, 0.587, 0.114));
}

fn sampleLuminance(coords: vec2<i32>) -> f32 {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(dims.width) - 1),
 clamp(coords.y, 0, i32(dims.height) - 1)
 );
 return getLuminance(textureLoad(inputTexture, clampedCoords, 0).rgb);
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let x = global_id.x;
 let y = global_id.y;

 if (x >= dims.width || y >= dims.height) {
 return;
 }

 let coords = vec2<i32>(i32(x), i32(y));

 let tl = sampleLuminance(coords + vec2<i32>(-1, -1));
 let tc = sampleLuminance(coords + vec2<i32>(0, -1));
 let tr = sampleLuminance(coords + vec2<i32>(1, -1));
 let ml = sampleLuminance(coords + vec2<i32>(-1, 0));
 let mr = sampleLuminance(coords + vec2<i32>(1, 0));
 let bl = sampleLuminance(coords + vec2<i32>(-1, 1));
 let bc = sampleLuminance(coords + vec2<i32>(0, 1));
 let br = sampleLuminance(coords + vec2<i32>(1, 1));

 let gx = -tl - 2.0 * ml - bl + tr + 2.0 * mr + br;
 let gy = -tl - 2.0 * tc - tr + bl + 2.0 * bc + br;

 let magnitude = sqrt(gx * gx + gy * gy);

 var angle: f32 = 0.0;
 if (abs(gx) > 0.001 || abs(gy) > 0.001) {
 angle = atan2(gy, gx);
 angle = (angle + 3.14159265359) / (2.0 * 3.14159265359);
 }

 let normalizedMagnitude = clamp(magnitude, 0.0, 1.0);

 textureStore(outputTexture, coords, vec4<f32>(
 normalizedMagnitude,
 angle,
 gx * 0.5 + 0.5,
 gy * 0.5 + 0.5
 ));
}
`,_W=`
struct Dimensions {
 width: u32,
 height: u32,
 padding: vec2<u32>,
};

@group(0) @binding(0) var colorTexture: texture_2d<f32>;
@group(0) @binding(1) var edgeTexture: texture_2d<f32>;
@group(0) @binding(2) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(3) var<uniform> dims: Dimensions;

fn sampleColor(coords: vec2<i32>) -> vec4<f32> {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(dims.width) - 1),
 clamp(coords.y, 0, i32(dims.height) - 1)
 );
 return textureLoad(colorTexture, clampedCoords, 0);
}

fn sampleEdge(coords: vec2<i32>) -> vec4<f32> {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(dims.width) - 1),
 clamp(coords.y, 0, i32(dims.height) - 1)
 );
 return textureLoad(edgeTexture, clampedCoords, 0);
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let x = global_id.x;
 let y = global_id.y;

 if (x >= dims.width || y >= dims.height) {
 return;
 }

 let coords = vec2<i32>(i32(x), i32(y));
 let color = sampleColor(coords);
 let edge = sampleEdge(coords);

 let magnitude = edge.r;
 let gx = edge.b * 2.0 - 1.0;
 let gy = edge.a * 2.0 - 1.0;

 let edgeThreshold = 0.05;

 if (magnitude < edgeThreshold) {
 textureStore(outputTexture, coords, color);
 return;
 }

 let gradLen = sqrt(gx * gx + gy * gy);
 var perpX: f32 = 0.0;
 var perpY: f32 = 0.0;

 if (gradLen > 0.001) {
 perpX = -gy / gradLen;
 perpY = gx / gradLen;
 }

 let sampleDist = 1.0;
 let offset = vec2<f32>(perpX * sampleDist, perpY * sampleDist);

 let sample1Coords = coords + vec2<i32>(i32(round(offset.x)), i32(round(offset.y)));
 let sample2Coords = coords - vec2<i32>(i32(round(offset.x)), i32(round(offset.y)));

 let sample1 = sampleColor(sample1Coords);
 let sample2 = sampleColor(sample2Coords);

 let blendFactor = clamp(magnitude * 2.0, 0.0, 1.0);
 let edgeColor = (sample1 + sample2) * 0.5;
 let refinedColor = mix(color, edgeColor, blendFactor * 0.3);

 textureStore(outputTexture, coords, refinedColor);
}
`,EW=`
struct Uniforms {
 width: u32,
 height: u32,
 strength: f32,
 padding: u32,
};

@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var outputTexture: texture_storage_2d<rgba8unorm, write>;
@group(0) @binding(2) var<uniform> uniforms: Uniforms;

fn sampleColor(coords: vec2<i32>) -> vec4<f32> {
 let clampedCoords = vec2<i32>(
 clamp(coords.x, 0, i32(uniforms.width) - 1),
 clamp(coords.y, 0, i32(uniforms.height) - 1)
 );
 return textureLoad(inputTexture, clampedCoords, 0);
}

fn getLuminance(color: vec3<f32>) -> f32 {
 return dot(color, vec3<f32>(0.299, 0.587, 0.114));
}

@compute @workgroup_size(16, 16, 1)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
 let x = global_id.x;
 let y = global_id.y;

 if (x >= uniforms.width || y >= uniforms.height) {
 return;
 }

 let coords = vec2<i32>(i32(x), i32(y));
 let center = sampleColor(coords);

 if (uniforms.strength < 0.001) {
 textureStore(outputTexture, coords, center);
 return;
 }

 let top = sampleColor(coords + vec2<i32>(0, -1));
 let bottom = sampleColor(coords + vec2<i32>(0, 1));
 let left = sampleColor(coords + vec2<i32>(-1, 0));
 let right = sampleColor(coords + vec2<i32>(1, 0));

 let blur = (top + bottom + left + right) * 0.25;

 let highPass = center - blur;

 let localContrast = abs(getLuminance(highPass.rgb));
 let adaptiveStrength = uniforms.strength * (1.0 - localContrast * 0.5);

 let sharpened = center + highPass * adaptiveStrength;

 let finalColor = clamp(sharpened, vec4<f32>(0.0), vec4<f32>(1.0));

 textureStore(outputTexture, coords, finalColor);
}
`;function xC(r,e,t,s,i){const n=new ArrayBuffer(32),a=new Uint32Array(n);return a[0]=r,a[1]=e,a[2]=t,a[3]=s,a[4]=i,a[5]=0,a[6]=0,a[7]=0,n}function bC(r,e){const t=new ArrayBuffer(16),s=new Uint32Array(t);return s[0]=r,s[1]=e,s[2]=0,s[3]=0,t}function MW(r,e,t){const s=new ArrayBuffer(16),i=new Uint32Array(s),n=new Float32Array(s);return i[0]=r,i[1]=e,n[2]=t,i[3]=0,s}const PW=4;class NW{device=null;initialized=!1;lanczosBindGroupLayout=null;edgeDetectBindGroupLayout=null;edgeDirectedBindGroupLayout=null;sharpenBindGroupLayout=null;lanczosPipeline=null;edgeDetectPipeline=null;edgeDirectedPipeline=null;sharpenPipeline=null;texturePool=new Map;lastProcessingTime=0;async initialize(e){if(this.initialized&&this.device===e.device)return!0;this.device=e.device;try{return this.createBindGroupLayouts(),await this.createPipelines(),this.initialized=!0,!0}catch(t){return console.error("[UpscalingEngine] Initialization failed:",t),!1}}createBindGroupLayouts(){this.device&&(this.lanczosBindGroupLayout=this.device.createBindGroupLayout({label:"Lanczos Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.edgeDetectBindGroupLayout=this.device.createBindGroupLayout({label:"Edge Detect Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.edgeDirectedBindGroupLayout=this.device.createBindGroupLayout({label:"Edge Directed Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:2,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}),this.sharpenBindGroupLayout=this.device.createBindGroupLayout({label:"Sharpen Bind Group Layout",entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}}]}))}async createPipelines(){if(!this.device)return;const e=this.device.createShaderModule({label:"Lanczos Shader",code:AW}),t=this.device.createShaderModule({label:"Edge Detect Shader",code:jW}),s=this.device.createShaderModule({label:"Edge Directed Shader",code:_W}),i=this.device.createShaderModule({label:"Sharpen Shader",code:EW});this.lanczosPipeline=this.device.createComputePipeline({label:"Lanczos Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.lanczosBindGroupLayout]}),compute:{module:e,entryPoint:"main"}}),this.edgeDetectPipeline=this.device.createComputePipeline({label:"Edge Detect Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.edgeDetectBindGroupLayout]}),compute:{module:t,entryPoint:"main"}}),this.edgeDirectedPipeline=this.device.createComputePipeline({label:"Edge Directed Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.edgeDirectedBindGroupLayout]}),compute:{module:s,entryPoint:"main"}}),this.sharpenPipeline=this.device.createComputePipeline({label:"Sharpen Pipeline",layout:this.device.createPipelineLayout({bindGroupLayouts:[this.sharpenBindGroupLayout]}),compute:{module:i,entryPoint:"main"}})}shouldUpscale(e,t,s,i){return s>e||i>t}async upscale(e,t,s,i=yC){if(!this.initialized||!this.device)throw new Error("UpscalingEngine not initialized");const n=performance.now(),a=e.width,o=e.height;if(!this.shouldUpscale(a,o,t,s))return e;let l;switch(i.quality){case"fast":l=await this.upscaleFast(e,t,s);break;case"balanced":l=await this.upscaleBalanced(e,t,s);break;case"quality":l=await this.upscaleQuality(e,t,s,i.sharpening);break;default:l=await this.upscaleBalanced(e,t,s)}return this.lastProcessingTime=performance.now()-n,l}async upscaleFast(e,t,s){return this.applyLanczos(e,t,s)}async upscaleBalanced(e,t,s){const i=await this.applyLanczos(e,t,s),n=await this.applyEdgeDetection(i),a=await this.applyEdgeDirected(i,n);return this.releaseTexture(n),a}async upscaleQuality(e,t,s,i){const n=await this.applyLanczos(e,t,s),a=await this.applyEdgeDetection(n),o=await this.applyEdgeDirected(n,a);if(this.releaseTexture(a),i>.01){const l=await this.applySharpen(o,i);return this.releaseTexture(o),l}return o}async applyLanczos(e,t,s){if(!this.device||!this.lanczosPipeline||!this.lanczosBindGroupLayout)throw new Error("Lanczos pipeline not ready");const i=e.width,n=e.height,a=this.getPooledTexture(t,n),o=this.device.createBuffer({size:32,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(o,0,xC(i,n,t,s,0));const l=this.device.createBindGroup({layout:this.lanczosBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:a.createView()},{binding:2,resource:{buffer:o}}]}),d=this.device.createCommandEncoder(),u=d.beginComputePass();u.setPipeline(this.lanczosPipeline),u.setBindGroup(0,l),u.dispatchWorkgroups(Math.ceil(t/16),Math.ceil(n/16)),u.end();const h=this.getPooledTexture(t,s),p=this.device.createBuffer({size:32,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(p,0,xC(t,n,t,s,1));const f=this.device.createBindGroup({layout:this.lanczosBindGroupLayout,entries:[{binding:0,resource:a.createView()},{binding:1,resource:h.createView()},{binding:2,resource:{buffer:p}}]}),m=d.beginComputePass();return m.setPipeline(this.lanczosPipeline),m.setBindGroup(0,f),m.dispatchWorkgroups(Math.ceil(t/16),Math.ceil(s/16)),m.end(),this.device.queue.submit([d.finish()]),this.releaseTexture(a),o.destroy(),p.destroy(),h}async applyEdgeDetection(e){if(!this.device||!this.edgeDetectPipeline||!this.edgeDetectBindGroupLayout)throw new Error("Edge detect pipeline not ready");const t=e.width,s=e.height,i=this.getPooledTexture(t,s),n=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(n,0,bC(t,s));const a=this.device.createBindGroup({layout:this.edgeDetectBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:i.createView()},{binding:2,resource:{buffer:n}}]}),o=this.device.createCommandEncoder(),l=o.beginComputePass();return l.setPipeline(this.edgeDetectPipeline),l.setBindGroup(0,a),l.dispatchWorkgroups(Math.ceil(t/16),Math.ceil(s/16)),l.end(),this.device.queue.submit([o.finish()]),n.destroy(),i}async applyEdgeDirected(e,t){if(!this.device||!this.edgeDirectedPipeline||!this.edgeDirectedBindGroupLayout)throw new Error("Edge directed pipeline not ready");const s=e.width,i=e.height,n=this.getPooledTexture(s,i),a=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(a,0,bC(s,i));const o=this.device.createBindGroup({layout:this.edgeDirectedBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:t.createView()},{binding:2,resource:n.createView()},{binding:3,resource:{buffer:a}}]}),l=this.device.createCommandEncoder(),d=l.beginComputePass();return d.setPipeline(this.edgeDirectedPipeline),d.setBindGroup(0,o),d.dispatchWorkgroups(Math.ceil(s/16),Math.ceil(i/16)),d.end(),this.device.queue.submit([l.finish()]),a.destroy(),n}async applySharpen(e,t){if(!this.device||!this.sharpenPipeline||!this.sharpenBindGroupLayout)throw new Error("Sharpen pipeline not ready");const s=e.width,i=e.height,n=this.getPooledTexture(s,i),a=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(a,0,MW(s,i,t));const o=this.device.createBindGroup({layout:this.sharpenBindGroupLayout,entries:[{binding:0,resource:e.createView()},{binding:1,resource:n.createView()},{binding:2,resource:{buffer:a}}]}),l=this.device.createCommandEncoder(),d=l.beginComputePass();return d.setPipeline(this.sharpenPipeline),d.setBindGroup(0,o),d.dispatchWorkgroups(Math.ceil(s/16),Math.ceil(i/16)),d.end(),this.device.queue.submit([l.finish()]),a.destroy(),n}getPooledTexture(e,t){if(!this.device)throw new Error("Device not available");const s=`${e}x${t}`,i=this.texturePool.get(s);return i&&i.length>0?i.pop().texture:this.device.createTexture({label:`Upscaling Texture ${s}`,size:{width:e,height:t},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST})}releaseTexture(e){const t=`${e.width}x${e.height}`;this.texturePool.has(t)||this.texturePool.set(t,[]);const s=this.texturePool.get(t);s.length<PW?s.push({texture:e,width:e.width,height:e.height,lastUsed:Date.now()}):e.destroy()}async upscaleImageBitmap(e,t,s,i=yC){if(!this.initialized||!this.device)return this.canvas2DFallback(e,t,s);try{const n=this.device.createTexture({label:"Upscale Input",size:{width:e.width,height:e.height},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});this.device.queue.copyExternalImageToTexture({source:e},{texture:n},{width:e.width,height:e.height});const a=await this.upscale(n,t,s,i),o=await this.textureToImageBitmap(a);return n.destroy(),this.releaseTexture(a),o}catch(n){return console.warn("[UpscalingEngine] GPU upscale failed, using fallback:",n),this.canvas2DFallback(e,t,s)}}async textureToImageBitmap(e){if(!this.device)throw new Error("Device not available");const t=e.width,s=e.height,i=Math.ceil(t*4/256)*256,n=this.device.createBuffer({size:i*s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),a=this.device.createCommandEncoder();a.copyTextureToBuffer({texture:e},{buffer:n,bytesPerRow:i},{width:t,height:s}),this.device.queue.submit([a.finish()]),await n.mapAsync(GPUMapMode.READ);const o=new Uint8Array(n.getMappedRange()),l=new Uint8ClampedArray(t*s*4);for(let p=0;p<s;p++){const f=p*i,m=p*t*4;l.set(o.subarray(f,f+t*4),m)}n.unmap(),n.destroy();const d=new OffscreenCanvas(t,s),u=d.getContext("2d");if(!u)throw new Error("Failed to get 2D context");const h=new ImageData(l,t,s);return u.putImageData(h,0,0),createImageBitmap(d)}async canvas2DFallback(e,t,s){const i=new OffscreenCanvas(t,s),n=i.getContext("2d");if(!n)throw new Error("Failed to get 2D context");return n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(e,0,0,t,s),createImageBitmap(i)}getLastProcessingTime(){return this.lastProcessingTime}isInitialized(){return this.initialized}clearTexturePool(){for(const e of this.texturePool.values())for(const t of e)t.texture.destroy();this.texturePool.clear()}dispose(){this.clearTexturePool(),this.device=null,this.initialized=!1,this.lanczosPipeline=null,this.edgeDetectPipeline=null,this.edgeDirectedPipeline=null,this.sharpenPipeline=null,this.lanczosBindGroupLayout=null,this.edgeDetectBindGroupLayout=null,this.edgeDirectedBindGroupLayout=null,this.sharpenBindGroupLayout=null}}let Rm=null;function RW(){return Rm||(Rm=new NW),Rm}const IW={sampleRate:48e3,channels:2,bufferSize:4096,latencyHint:"interactive"};class DW{size;cosTable;sinTable;reverseTable;constructor(e){if(e<=0||e&e-1)throw new Error("FFT size must be a power of 2");this.size=e,this.cosTable=new Float32Array(e/2),this.sinTable=new Float32Array(e/2),this.reverseTable=new Uint32Array(e);for(let s=0;s<e/2;s++){const i=-2*Math.PI*s/e;this.cosTable[s]=Math.cos(i),this.sinTable[s]=Math.sin(i)}const t=Math.log2(e);for(let s=0;s<e;s++){let i=0;for(let n=0;n<t;n++)i=i<<1|s>>n&1;this.reverseTable[s]=i}}getSize(){return this.size}forward(e){const t=this.size,s=new Float32Array(t),i=new Float32Array(t);for(let n=0;n<t;n++)s[this.reverseTable[n]]=e[n]||0;for(let n=2;n<=t;n*=2){const a=n/2,o=t/n;for(let l=0;l<t;l+=n)for(let d=0;d<a;d++){const u=d*o,h=this.cosTable[u],p=this.sinTable[u],f=l+d,m=l+d+a,g=s[m]*h-i[m]*p,y=s[m]*p+i[m]*h;s[m]=s[f]-g,i[m]=i[f]-y,s[f]=s[f]+g,i[f]=i[f]+y}}return{real:s,imag:i}}inverse(e,t){const s=this.size,i=new Float32Array(s),n=new Float32Array(s);for(let o=0;o<s;o++)i[this.reverseTable[o]]=e[o],n[this.reverseTable[o]]=-t[o];for(let o=2;o<=s;o*=2){const l=o/2,d=s/o;for(let u=0;u<s;u+=o)for(let h=0;h<l;h++){const p=h*d,f=this.cosTable[p],m=this.sinTable[p],g=u+h,y=u+h+l,x=i[y]*f-n[y]*m,b=i[y]*m+n[y]*f;i[y]=i[g]-x,n[y]=n[g]-b,i[g]=i[g]+x,n[g]=n[g]+b}}const a=new Float32Array(s);for(let o=0;o<s;o++)a[o]=i[o]/s;return a}getMagnitude(e,t){const s=this.size/2,i=new Float32Array(s);for(let n=0;n<s;n++)i[n]=Math.sqrt(e[n]*e[n]+t[n]*t[n]);return i}getPower(e,t){const s=this.size/2,i=new Float32Array(s);for(let n=0;n<s;n++)i[n]=e[n]*e[n]+t[n]*t[n];return i}getMagnitudeAndPhase(e,t){const s=this.size/2,i=new Float32Array(s),n=new Float32Array(s);for(let a=0;a<s;a++)i[a]=Math.sqrt(e[a]*e[a]+t[a]*t[a]),n[a]=Math.atan2(t[a],e[a]);return{magnitudes:i,phases:n}}fromMagnitudeAndPhase(e,t){const s=this.size,i=e.length,n=new Float32Array(s),a=new Float32Array(s);for(let o=0;o<i;o++)n[o]=e[o]*Math.cos(t[o]),a[o]=e[o]*Math.sin(t[o]);for(let o=1;o<i;o++)n[s-o]=n[o],a[s-o]=-a[o];return{real:n,imag:a}}applyHannWindow(e){const t=new Float32Array(e.length),s=e.length;for(let i=0;i<s;i++){const n=.5*(1-Math.cos(2*Math.PI*i/(s-1)));t[i]=e[i]*n}return t}applySynthesisWindow(e){const t=new Float32Array(e.length),s=e.length;for(let i=0;i<s;i++){const n=.5*(1-Math.cos(2*Math.PI*i/(s-1)));t[i]=e[i]*n}return t}}class FW{audioContext=null;masterGain=null;initialized=!1;config;trackNodes=new Map;mediaBuffers=new Map;constructor(e={}){this.config={...IW,...e}}async initialize(){if(!this.initialized)try{this.audioContext=new AudioContext({sampleRate:this.config.sampleRate,latencyHint:this.config.latencyHint}),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination),this.initialized=!0}catch(e){throw new Error(`AudioEngine initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}}isInitialized(){return this.initialized}getAudioContext(){return this.ensureInitialized(),this.audioContext}ensureInitialized(){if(!this.initialized||!this.audioContext)throw new Error("AudioEngine not initialized. Call initialize() first.")}async renderAudio(e,t,s){this.ensureInitialized();const{timeline:i,mediaLibrary:n,settings:a}=e,o=a.sampleRate||this.config.sampleRate,l=a.channels||this.config.channels,d=Math.max(s,.001),u=Math.max(1,Math.ceil(d*o)),h=new OfflineAudioContext(l,u,o),p=this.getAudioTracksAtTime(i,t,s),f=p.some(g=>g.solo);for(const g of p)if(!this.isTrackMuted(g,f))for(const y of g.clips){const x=n.items.find(w=>w.id===y.mediaId);if(!x)continue;const b=await this.getAudioBuffer(x,h);b&&await this.renderClipToContext(h,b,y,t)}return{buffer:await h.startRendering(),startTime:t,duration:s,channels:l,sampleRate:o}}isTrackMuted(e,t){return!!(e.muted||t&&!e.solo)}getEffectiveTrackAudibility(e){const t=new Map,s=e.some(i=>i.solo);for(const i of e){const n=!i.muted&&(!s||i.solo);t.set(i.id,n)}return t}getAudioTracksAtTime(e,t,s){const i=[],n=t+s;return e.tracks.forEach((a,o)=>{if(a.type!=="audio"&&a.type!=="video")return;const l=this.getClipsInRange(a,t,n);l.length!==0&&i.push({trackId:a.id,index:o,muted:a.muted,solo:a.solo,clips:l.map(d=>this.createClipRenderInfo(d,t,n))})}),i}getClipsInRange(e,t,s){return e.clips.filter(i=>{const n=i.startTime+i.duration;return i.startTime<s&&n>t})}createClipRenderInfo(e,t,s){const i=Math.max(e.startTime,t),n=Math.min(e.startTime+e.duration,s),a=i-e.startTime,o=e.inPoint+a,l=e.effects.find(u=>u.type==="pan"),d=l&&typeof l.params.value=="number"?l.params.value:0;return{clipId:e.id,mediaId:e.mediaId,sourceTime:o,timelineStartTime:i,duration:n-i,volume:e.volume,pan:d,effects:e.effects,fadeIn:e.fade?.fadeIn,fadeOut:e.fade?.fadeOut,speed:e.speed||1,reversed:e.reversed||!1}}async getAudioBuffer(e,t){const s=this.mediaBuffers.get(e.id);if(s)return s;if(!e.blob)return console.warn(`No blob available for media item ${e.id}`),null;try{const i=await e.blob.arrayBuffer(),n=await t.decodeAudioData(i);return this.mediaBuffers.set(e.id,n),n}catch{if(e.type==="video")try{const n=await this.extractAudioFromVideo(e,t);if(n)return this.mediaBuffers.set(e.id,n),n}catch{}return null}}async extractAudioFromVideo(e,t){if(!e.blob)return null;try{const s=await _i(()=>import("./index5.js"),[]),{Input:i,ALL_FORMATS:n,BlobSource:a,AudioSampleSink:o}=s,l=new i({source:new a(e.blob),formats:n});let d=await l.getPrimaryAudioTrack();if(!d){const T=await l.getAudioTracks();T.length>0&&(d=T[0])}if(!d||!await d.canDecode())return l[Symbol.dispose]?.(),null;const h=await d.computeDuration();if(!h||h<=0)return l[Symbol.dispose]?.(),null;const p=t.sampleRate,f=2,m=1e3,g=Math.ceil(h*m),y=new o(d),x=Array.from({length:g},(T,j)=>j/m),b=[];for await(const T of y.samplesAtTimestamps(x)){if(!T){b.push(new Float32Array(0));continue}const j=T.allocationSize({format:"f32",planeIndex:0}),_=new Float32Array(j/4);T.copyTo(_,{format:"f32",planeIndex:0}),b.push(_),T.close()}l[Symbol.dispose]?.();const w=Math.ceil(h*p),C=new Float32Array(w),k=new Float32Array(w);let S=0;for(const T of b){if(T.length===0)continue;const j=T.length>=2?2:1,_=Math.floor(T.length/j);for(let M=0;M<_&&S<w;M++)j===2?(C[S]=T[M*2]||0,k[S]=T[M*2+1]||0):(C[S]=T[M]||0,k[S]=T[M]||0),S++}if(S===0)return null;const A=t.createBuffer(f,S,p);return A.copyToChannel(C.subarray(0,S),0),A.copyToChannel(k.subarray(0,S),1),A}catch{return null}}async renderClipToContext(e,t,s,i){const n=e.createBufferSource();n.buffer=t;const a=s.speed||1,o=s.reversed||!1;n.playbackRate.value=o?-a:a;const l=e.createGain();l.gain.value=s.volume;const d=e.createStereoPanner();d.pan.value=Math.max(-1,Math.min(1,s.pan)),n.connect(l),l.connect(d),d.connect(e.destination);const u=Math.max(0,s.timelineStartTime-i);this.applyFades(l,s,u);const h=o?t.duration-s.sourceTime:s.sourceTime;n.start(u,h,s.duration)}applyFades(e,t,s){const{fadeIn:i,fadeOut:n,duration:a,volume:o}=t;if(i&&i>0&&(e.gain.setValueAtTime(0,s),e.gain.linearRampToValueAtTime(o,s+i)),n&&n>0){const l=s+a-n;e.gain.setValueAtTime(o,l),e.gain.linearRampToValueAtTime(0,s+a)}}async mixTracks(e,t,s){if(this.ensureInitialized(),e.length===0)return this.audioContext.createBuffer(this.config.channels,this.config.sampleRate,this.config.sampleRate);const i=Math.max(...e.map(o=>o.length)),n=e[0].sampleRate,a=new OfflineAudioContext(this.config.channels,i,n);for(let o=0;o<e.length;o++){const l=a.createBufferSource();l.buffer=e[o];const d=a.createGain();d.gain.value=t[o]??1;const u=a.createStereoPanner();u.pan.value=Math.max(-1,Math.min(1,s[o]??0)),l.connect(d),d.connect(u),u.connect(a.destination),l.start(0)}return a.startRendering()}getChannelStates(e){return e.tracks.filter(t=>t.type==="audio"||t.type==="video").map(t=>({trackId:t.id,volume:1,pan:0,muted:t.muted,solo:t.solo,peakLevel:0,rmsLevel:0}))}async applyEffect(e,t){if(this.ensureInitialized(),!t.enabled)return e;const s=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),i=s.createBufferSource();i.buffer=e;const n=this.createEffectNode(s,t);return n?(i.connect(n),n.connect(s.destination)):i.connect(s.destination),i.start(0),s.startRendering()}createEffectNode(e,t){const s=t.params;switch(t.type){case"gain":const i=e.createGain();return i.gain.value=s.value??1,i;case"pan":const n=e.createStereoPanner();return n.pan.value=Math.max(-1,Math.min(1,s.value??0)),n;case"eq":return this.createEQNode(e,t);case"compressor":const a=e.createDynamicsCompressor();return a.threshold.value=s.threshold??-24,a.ratio.value=s.ratio??4,a.attack.value=s.attack??.003,a.release.value=s.release??.25,a.knee.value=s.knee??30,a;case"delay":const o=e.createDelay(2);return o.delayTime.value=s.time??.5,o;default:return null}}createEQNode(e,t){const s=t.params.bands;if(!s||s.length===0)return null;let i=null,n=null;for(const a of s){const o=e.createBiquadFilter();o.type=a.type,o.frequency.value=a.frequency,o.gain.value=a.gain,o.Q.value=a.q,i||(i=o),n&&n.connect(o),n=o}return i}detectSilence(e,t=-60){const s=[],i=e.getChannelData(0),n=e.sampleRate,a=Math.pow(10,t/20);let o=null;const l=Math.floor(n*.1);for(let d=0;d<i.length;d+=l){const u=Math.min(d+l,i.length);let h=0;for(let m=d;m<u;m++)h=Math.max(h,Math.abs(i[m]));const p=h<a,f=d/n;p&&o===null?o=f:!p&&o!==null&&(s.push({start:o,end:f}),o=null)}return o!==null&&s.push({start:o,end:e.duration}),s}measureLoudness(e){const t=e.getChannelData(0);let s=0,i=0;for(let d=0;d<t.length;d++){const u=t[d];s+=u*u,i=Math.max(i,Math.abs(u))}const n=Math.sqrt(s/t.length),a=20*Math.log10(n||1e-4),o=20*Math.log10(i||1e-4),l=a-.691;return{integrated:l,shortTerm:l,momentary:l,truePeak:o,range:10}}clearCache(){this.mediaBuffers.clear()}async resume(){this.audioContext?.state==="suspended"&&await this.audioContext.resume()}async suspend(){this.audioContext?.state==="running"&&await this.audioContext.suspend()}async dispose(){this.clearCache(),this.trackNodes.clear(),this.audioContext&&(await this.audioContext.close(),this.audioContext=null),this.masterGain=null,this.initialized=!1}}let Im=null;function Ab(){return Im||(Im=new FW),Im}class BW{audioContext=null;impulseResponses=new Map;noiseProfiles=new Map;initialized=!1;constructor(e){this.audioContext=e||null}async initialize(e){e&&(this.audioContext=e),this.audioContext||(this.audioContext=new AudioContext({latencyHint:"interactive",sampleRate:48e3})),this.initialized=!0}isInitialized(){return this.initialized&&this.audioContext!==null}getAudioContext(){return this.ensureInitialized(),this.audioContext}ensureInitialized(){if(!this.initialized||!this.audioContext)throw new Error("AudioEffectsEngine not initialized. Call initialize() first.")}async applyEffectChain(e,t){this.ensureInitialized();const s=t.filter(u=>u.enabled);if(s.length===0)return{buffer:e,appliedEffects:[]};const i=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),n=i.createBufferSource();n.buffer=e;const{firstNode:a,lastNode:o,appliedEffects:l}=await this.buildEffectChain(i,s);return a&&o?(n.connect(a),o.connect(i.destination)):n.connect(i.destination),n.start(0),{buffer:await i.startRendering(),appliedEffects:l}}async buildEffectChain(e,t){let s=null,i=null;const n=[];for(const a of t){if(!a.enabled)continue;const o=await this.createEffectNode(e,a);o&&(n.push(a.type),s||(s=o.input),i&&i.connect(o.input),i=o.output)}return{firstNode:s,lastNode:i,appliedEffects:n}}async createEffectNode(e,t){switch(t.type){case"eq":return this.createEQNodePair(e,t);case"compressor":return this.createCompressorNodePair(e,t);case"reverb":return await this.createReverbNode(e,t);case"delay":return this.createDelayNode(e,t);case"noiseReduction":return this.createNoiseReductionNodePair(e,t);case"gain":return this.createGainNodePair(e,t);default:return null}}createEQNodePair(e,t){const i=t.params?.bands;if(!i||i.length===0)return null;let n=null,a=null;for(const o of i){const l=e.createBiquadFilter();l.type=this.mapEQBandType(o.type),l.frequency.value=Math.max(20,Math.min(2e4,o.frequency)),l.gain.value=Math.max(-24,Math.min(24,o.gain)),l.Q.value=Math.max(.1,Math.min(18,o.q)),n||(n=l),a&&a.connect(l),a=l}return!n||!a?null:{input:n,output:a}}createEQNode(e,t){return this.createEQNodePair(e,t)?.input??null}mapEQBandType(e){return{lowshelf:"lowshelf",highshelf:"highshelf",peaking:"peaking",lowpass:"lowpass",highpass:"highpass",notch:"notch"}[e]||"peaking"}createCompressorNodePair(e,t){const s=this.createCompressorNode(e,t);return{input:s,output:s}}createCompressorNode(e,t){const s=t.params,i=e.createDynamicsCompressor();return i.threshold.value=Math.max(-60,Math.min(0,s?.threshold??-24)),i.ratio.value=Math.max(1,Math.min(20,s?.ratio??4)),i.attack.value=Math.max(.001,Math.min(1,s?.attack??.003)),i.release.value=Math.max(.01,Math.min(3,s?.release??.25)),i.knee.value=Math.max(0,Math.min(40,s?.knee??30)),i}async createReverbNode(e,t){const s=t.params,i=e.createGain(),n=e.createGain(),a=e.createGain(),o=e.createGain(),l=e.createConvolver();n.gain.value=s?.dryLevel??.7,a.gain.value=s?.wetLevel??.5;const d=await this.getOrCreateImpulseResponse(e,s?.roomSize??.5,s?.damping??.5);l.buffer=d;let u=null;return s?.preDelay&&s.preDelay>0&&(u=e.createDelay(.1),u.delayTime.value=Math.min(.1,s.preDelay/1e3)),i.connect(n),n.connect(o),u?(i.connect(u),u.connect(l)):i.connect(l),l.connect(a),a.connect(o),{input:i,output:o}}async getOrCreateImpulseResponse(e,t,s){const i=`${t.toFixed(2)}_${s.toFixed(2)}`;if(this.impulseResponses.has(i))return this.impulseResponses.get(i);const n=this.generateImpulseResponse(e,t,s);return this.impulseResponses.set(i,n),n}generateImpulseResponse(e,t,s){const i=e.sampleRate,n=.5+t*3.5,a=Math.floor(i*n),o=2,l=e.createBuffer(o,a,i);for(let d=0;d<o;d++){const u=l.getChannelData(d);for(let h=0;h<a;h++){const p=h/i,f=Math.exp(-3*p/n),m=(Math.random()*2-1)*f,g=1-s*p/n;u[h]=m*g}}return l}createDelayNode(e,t){const s=t.params,i=e.createGain(),n=e.createDelay(2),a=e.createGain(),o=e.createGain(),l=e.createGain(),d=e.createGain();return n.delayTime.value=Math.max(0,Math.min(2,s?.time??.5)),a.gain.value=Math.max(0,Math.min(.95,s?.feedback??.3)),o.gain.value=s?.wetLevel??.5,l.gain.value=1-(s?.wetLevel??.5),i.connect(l),l.connect(d),i.connect(n),n.connect(a),a.connect(n),n.connect(o),o.connect(d),{input:i,output:d}}createGainNodePair(e,t){const s=this.createGainNode(e,t);return{input:s,output:s}}createGainNode(e,t){const s=t.params,i=e.createGain();return i.gain.value=Math.max(0,Math.min(4,s?.value??1)),i}createNoiseReductionNodePair(e,t){const s=t.params,i=e.createGain(),n=e.createGain(),a=this.createNoiseReductionBands(e,s);for(const o of a)i.connect(o.filter),o.filter.connect(o.gate),o.gate.connect(n);return{input:i,output:n}}createNoiseReductionNode(e,t){return this.createNoiseReductionNodePair(e,t).input}createNoiseReductionBands(e,t){const s=t?.threshold??-40,i=t?.reduction??.5,n=Math.pow(10,s/20),a=[63,125,250,500,1e3,2e3,4e3,8e3,16e3],o=[];for(let l=0;l<a.length;l++){const d=e.createBiquadFilter();d.type="peaking",d.frequency.value=a[l],d.Q.value=1.4;const u=e.createGain(),h=1-l/a.length*.3,p=Math.min(1,n*10);u.gain.value=1-i*h*p,o.push({filter:d,gate:u})}return o}async learnNoiseProfile(e,t){this.ensureInitialized();const s=2048,i=s/2,n=e.getChannelData(0),a=Math.max(1,Math.floor((n.length-s)/i)+1),o=new DW(s),l=new Float32Array(s/2),d=new Float32Array(s);for(let f=0;f<a;f++){const m=f*i;for(let w=0;w<s;w++)d[w]=n[m+w]||0;const g=o.applyHannWindow(d),{real:y,imag:x}=o.forward(g),b=o.getMagnitude(y,x);for(let w=0;w<l.length;w++)l[w]+=b[w]}for(let f=0;f<l.length;f++)l[f]/=a;const u=new Float32Array(s/2),h=e.sampleRate/s;for(let f=0;f<u.length;f++)u[f]=f*h;const p={frequencyBins:u,magnitudes:l,sampleRate:e.sampleRate};return this.noiseProfiles.set(t,p),p}getNoiseProfile(e){return this.noiseProfiles.get(e)}async applyNoiseReductionWithProfile(e,t,s=.5){this.ensureInitialized();const i=this.noiseProfiles.get(t);if(!i)throw new Error(`Noise profile '${t}' not found`);const n=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),a=n.createBufferSource();a.buffer=e;const o=n.createGain(),l=n.createGain(),d=this.createProfileBasedFilters(n,i,s);if(a.connect(o),d.length>0){let u=o;for(const h of d)u.connect(h),u=h;u.connect(l)}else o.connect(l);return l.connect(n.destination),a.start(0),n.startRendering()}createProfileBasedFilters(e,t,s){const i=[],n=t.magnitudes,a=t.frequencyBins,{mean:o,stdDev:l}=this.calculateNoiseStatistics(n),d=o+l*2,u=new Set;for(let m=2;m<n.length-2;m++){const g=n[m],y=a[m];if(y<60||u.has(m))continue;if(g>n[m-2]&&g>n[m-1]&&g>n[m+1]&&g>n[m+2]&&g>d){const b=e.createBiquadFilter();b.type="notch",b.frequency.value=Math.max(20,Math.min(2e4,y));const w=g/((n[m-1]+n[m+1])/2);b.Q.value=Math.min(30,Math.max(5,w*10)),i.push(b);for(let C=m-2;C<=m+2;C++)u.add(C)}}const h=[125,250,500,1e3,2e3,4e3,8e3],p=t.sampleRate/(n.length*2);for(const m of h){const g=Math.round(m/p);if(g>=n.length||u.has(g))continue;const y=Math.max(0,g-5),x=Math.min(n.length-1,g+5);let b=0;for(let w=y;w<=x;w++)b+=n[w];if(b/=x-y+1,b>o*1.2){const w=e.createBiquadFilter();w.type="peaking",w.frequency.value=m,w.Q.value=1.4;const C=(b-o)/o,k=-s*Math.min(12,C*6);w.gain.value=k,i.push(w)}}if(this.calculateLowFrequencyEnergy(n,p)>o*1.5){const m=e.createBiquadFilter();m.type="highpass",m.frequency.value=80,m.Q.value=.707,i.push(m)}if(i.length===0){const m=e.createBiquadFilter();m.type="highpass",m.frequency.value=60,m.Q.value=.5,i.push(m)}return i}calculateNoiseStatistics(e){let t=0;for(let a=0;a<e.length;a++)t+=e[a];const s=t/e.length;let i=0;for(let a=0;a<e.length;a++){const o=e[a]-s;i+=o*o}const n=Math.sqrt(i/e.length);return{mean:s,stdDev:n}}calculateLowFrequencyEnergy(e,t){const s=Math.min(e.length,Math.ceil(200/t));let i=0;for(let n=0;n<s;n++)i+=e[n];return i/s}clearImpulseResponseCache(){this.impulseResponses.clear()}clearNoiseProfiles(){this.noiseProfiles.clear()}async dispose(){this.clearImpulseResponseCache(),this.clearNoiseProfiles(),this.audioContext&&"close"in this.audioContext&&await this.audioContext.close(),this.audioContext=null,this.initialized=!1}}let Dm=null;function LW(){return Dm||(Dm=new BW),Dm}class TM{audioContext;state="stopped";playbackRate=1;startAudioContextTime=0;startTimelineTime=0;pausedAt=0;duration=0;loopEnabled=!1;loopStart=0;loopEnd=0;subscribers=new Set;animationFrameId=null;frameRate;frameDuration;_lastVideoTime=0;driftMs=0;constructor(e={}){this.audioContext=e.audioContext||new AudioContext,this.frameRate=e.frameRate||30,this.frameDuration=1e3/this.frameRate}get currentTime(){if(this.state==="stopped")return 0;if(this.state==="paused")return this.pausedAt;const e=(this.audioContext.currentTime-this.startAudioContextTime)*this.playbackRate;let t=this.startTimelineTime+e;if(this.loopEnabled&&this.loopEnd>this.loopStart&&t>=this.loopEnd){const s=this.loopEnd-this.loopStart;t=this.loopStart+(t-this.loopStart)%s}return Math.max(0,Math.min(t,this.duration||1/0))}get isPlaying(){return this.state==="playing"}get isPaused(){return this.state==="paused"}get isStopped(){return this.state==="stopped"}get rate(){return this.playbackRate}get drift(){return this.driftMs}get lastReportedVideoTime(){return this._lastVideoTime}getAudioContext(){return this.audioContext}setDuration(e){this.duration=e}setLoop(e,t=0,s=0){this.loopEnabled=e,this.loopStart=t,this.loopEnd=s}setPlaybackRate(e){if(this.state==="playing"){const t=this.currentTime;this.startTimelineTime=t,this.startAudioContextTime=this.audioContext.currentTime}this.playbackRate=Math.max(.1,Math.min(e,16))}async play(){this.state!=="playing"&&(this.audioContext.state==="suspended"&&await this.audioContext.resume(),this.startTimelineTime=this.pausedAt,this.startAudioContextTime=this.audioContext.currentTime,this.state="playing",this.notifyStateChange(),this.startUpdateLoop())}pause(){this.state==="playing"&&(this.pausedAt=this.currentTime,this.state="paused",this.stopUpdateLoop(),this.notifyStateChange())}stop(){this.pausedAt=0,this.state="stopped",this.stopUpdateLoop(),this.notifyStateChange(),this.notifyTimeUpdate(0)}seek(e){const t=Math.max(0,Math.min(e,this.duration||1/0));this.state==="playing"?(this.startTimelineTime=t,this.startAudioContextTime=this.audioContext.currentTime):this.pausedAt=t,this.notifyTimeUpdate(t)}seekRelative(e){this.seek(this.currentTime+e)}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}reportVideoTime(e){this._lastVideoTime=e;const t=this.currentTime;this.driftMs=(t-e)*1e3}shouldSkipFrame(){return this.driftMs>this.frameDuration}shouldRepeatFrame(){return this.driftMs<-this.frameDuration}startUpdateLoop(){if(this.animationFrameId!==null){console.log("[MasterClock] startUpdateLoop called but animation frame already exists");return}const e=()=>{if(this.state!=="playing"){console.log(`[MasterClock] Update loop stopped - state is ${this.state}`);return}const t=(this.audioContext.currentTime-this.startAudioContextTime)*this.playbackRate,s=this.startTimelineTime+t;if(this.duration>0&&s>=this.duration&&!this.loopEnabled){this.pausedAt=this.duration,this.state="paused",this.notifyStateChange(),this.notifyStateChange(),this.notifyTimeUpdate(this.duration);return}const i=this.currentTime;this.notifyTimeUpdate(i),this.animationFrameId=requestAnimationFrame(e)};this.animationFrameId=requestAnimationFrame(e)}stopUpdateLoop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}notifyTimeUpdate(e){for(const t of this.subscribers)try{t.onTimeUpdate(e)}catch(s){console.error("[MasterClock] Subscriber error:",s)}}notifyStateChange(){for(const e of this.subscribers)try{e.onStateChange?.(this.state)}catch(t){console.error("[MasterClock] Subscriber error:",t)}}dispose(){this.stopUpdateLoop(),this.subscribers.clear(),this.state="stopped"}}let lo=null;function Oh(){return lo||(lo=new TM),lo}function OW(r={}){return lo&&lo.dispose(),lo=new TM(r),lo}class AM{audioContext;masterClock;masterGain;trackNodes=new Map;scheduledSources=new Map;trackConfigs=new Map;hasSoloTracks=!1;impulseResponseCache=new Map;isPlaying=!1;lastScheduledTime=0;scheduleAheadTime=.2;schedulerIntervalId=null;constructor(e){this.masterClock=e||Oh(),this.audioContext=this.masterClock.getAudioContext(),this.masterGain=this.audioContext.createGain(),this.masterGain.connect(this.audioContext.destination)}getAudioContext(){return this.audioContext}getMasterGain(){return this.masterGain}setMasterVolume(e){this.masterGain.gain.setValueAtTime(Math.max(0,Math.min(4,e)),this.audioContext.currentTime)}createTrack(e){this.removeTrack(e.trackId),this.trackConfigs.set(e.trackId,e);const t=this.audioContext.createGain(),s=this.audioContext.createStereoPanner();s.pan.value=Math.max(-1,Math.min(1,e.pan));const i=this.audioContext.createGain();i.gain.value=e.volume;const{effectChainInput:n,effectChainOutput:a,compressor:o,eqFilters:l,reverbNodes:d,delayNodes:u}=this.buildEffectChain(e.effects);t.connect(n),a.connect(s),s.connect(i),i.connect(this.masterGain);const h={inputGain:t,effectChainInput:n,effectChainOutput:a,panNode:s,outputGain:i,compressor:o,eqFilters:l,reverbNodes:d,delayNodes:u};this.trackNodes.set(e.trackId,h),this.scheduledSources.set(e.trackId,[]),this.updateTrackAudibility(e.trackId),this.updateSoloState()}buildEffectChain(e){const t=this.audioContext.createGain();let s=null;const i=[];let n=null,a=null;const o=e.filter(u=>u.enabled);if(o.length===0)return{effectChainInput:t,effectChainOutput:t,compressor:s,eqFilters:i,reverbNodes:n,delayNodes:a};let l=t,d=t;for(const u of o)switch(u.type){case"compressor":{s=this.createCompressorNode(u),l.connect(s),l=s;break}case"eq":{const h=this.createEQFilters(u);if(h.length>0){l.connect(h[0]);for(let p=1;p<h.length;p++)h[p-1].connect(h[p]);l=h[h.length-1],i.push(...h)}break}case"reverb":{n=this.createReverbNodes(u),l.connect(n.inputGain),l=n.outputGain;break}case"delay":{a=this.createDelayNodes(u),l.connect(a.inputGain),l=a.outputGain;break}}return{effectChainInput:d,effectChainOutput:l,compressor:s,eqFilters:i,reverbNodes:n,delayNodes:a}}createCompressorNode(e){const t=e.params,s=this.audioContext.createDynamicsCompressor();return s.threshold.value=t.threshold??-24,s.ratio.value=t.ratio??4,s.attack.value=t.attack??.003,s.release.value=t.release??.25,s.knee.value=t.knee??30,s}createEQFilters(e){const s=e.params.bands||[],i=[];for(const n of s){const a=this.audioContext.createBiquadFilter();a.type=n.type,a.frequency.value=Math.max(20,Math.min(2e4,n.frequency)),a.gain.value=Math.max(-24,Math.min(24,n.gain)),a.Q.value=Math.max(.1,Math.min(18,n.q)),i.push(a)}return i}createReverbNodes(e){const t=e.params,s=t.roomSize??.5,i=t.damping??.5,n=t.wetLevel??.5,a=t.dryLevel??.7,o=this.audioContext.createGain(),l=this.audioContext.createGain(),d=this.audioContext.createGain(),u=this.audioContext.createConvolver(),h=this.audioContext.createGain();l.gain.value=a,d.gain.value=n;const p=this.getOrCreateImpulseResponse(s,i);return u.buffer=p,o.connect(l),l.connect(h),o.connect(u),u.connect(d),d.connect(h),{inputGain:o,dryGain:l,wetGain:d,convolver:u,outputGain:h}}getOrCreateImpulseResponse(e,t){const s=`${e.toFixed(2)}_${t.toFixed(2)}`;if(this.impulseResponseCache.has(s))return this.impulseResponseCache.get(s);const i=this.audioContext.sampleRate,n=.5+e*3.5,a=Math.floor(i*n),o=2,l=this.audioContext.createBuffer(o,a,i);for(let d=0;d<o;d++){const u=l.getChannelData(d);for(let h=0;h<a;h++){const p=h/i,f=Math.exp(-3*p/n),m=(Math.random()*2-1)*f,g=1-t*p/n;u[h]=m*g}}return this.impulseResponseCache.set(s,l),l}createDelayNodes(e){const t=e.params,s=t.time??.5,i=t.feedback??.3,n=t.wetLevel??.5,a=this.audioContext.createGain(),o=this.audioContext.createDelay(2),l=this.audioContext.createGain(),d=this.audioContext.createGain(),u=this.audioContext.createGain(),h=this.audioContext.createGain();return o.delayTime.value=Math.max(0,Math.min(2,s)),l.gain.value=Math.max(0,Math.min(.95,i)),d.gain.value=n,u.gain.value=1-n,a.connect(u),u.connect(h),a.connect(o),o.connect(l),l.connect(o),o.connect(d),d.connect(h),{inputGain:a,delayNode:o,feedbackGain:l,wetGain:d,dryGain:u,outputGain:h}}removeTrack(e){const t=this.scheduledSources.get(e);if(t)for(const i of t)try{i.source.stop(),i.source.disconnect()}catch{}this.scheduledSources.delete(e);const s=this.trackNodes.get(e);if(s){s.inputGain.disconnect(),s.panNode.disconnect(),s.outputGain.disconnect(),s.compressor&&s.compressor.disconnect();for(const i of s.eqFilters)i.disconnect();s.reverbNodes&&(s.reverbNodes.inputGain.disconnect(),s.reverbNodes.dryGain.disconnect(),s.reverbNodes.wetGain.disconnect(),s.reverbNodes.convolver.disconnect(),s.reverbNodes.outputGain.disconnect()),s.delayNodes&&(s.delayNodes.inputGain.disconnect(),s.delayNodes.delayNode.disconnect(),s.delayNodes.feedbackGain.disconnect(),s.delayNodes.wetGain.disconnect(),s.delayNodes.dryGain.disconnect(),s.delayNodes.outputGain.disconnect())}this.trackNodes.delete(e),this.trackConfigs.delete(e),this.updateSoloState()}updateTrackVolume(e,t){const s=this.trackNodes.get(e),i=this.trackConfigs.get(e);s&&i&&(i.volume=Math.max(0,Math.min(4,t)),this.updateTrackAudibility(e))}updateTrackPan(e,t){const s=this.trackNodes.get(e);s&&s.panNode.pan.setValueAtTime(Math.max(-1,Math.min(1,t)),this.audioContext.currentTime);const i=this.trackConfigs.get(e);i&&(i.pan=t)}setTrackMuted(e,t){const s=this.trackConfigs.get(e);s&&(s.muted=t,this.updateTrackAudibility(e))}setTrackSolo(e,t){const s=this.trackConfigs.get(e);s&&(s.solo=t,this.updateSoloState())}updateSoloState(){this.hasSoloTracks=Array.from(this.trackConfigs.values()).some(e=>e.solo);for(const e of this.trackNodes.keys())this.updateTrackAudibility(e)}updateTrackAudibility(e){const t=this.trackNodes.get(e),s=this.trackConfigs.get(e);if(!t||!s)return;let i=!0;(s.muted||this.hasSoloTracks&&!s.solo)&&(i=!1);const n=i?s.volume:0;t.outputGain.gain.setValueAtTime(n,this.audioContext.currentTime)}updateTrackEffects(e,t){const s=this.trackConfigs.get(e);s&&(s.effects=t,this.createTrack(s))}scheduleClip(e){const t=this.trackNodes.get(e.trackId),s=this.trackConfigs.get(e.trackId);t?s&&JSON.stringify(s.effects)!==JSON.stringify(e.effects)&&this.updateTrackEffects(e.trackId,e.effects):this.createTrack({trackId:e.trackId,volume:e.volume,pan:e.pan,muted:!1,solo:!1,effects:e.effects});const i=this.trackNodes.get(e.trackId);if(!i)return;const n=this.audioContext.createBufferSource();n.buffer=e.audioBuffer,n.playbackRate.value=e.speed;const a=this.audioContext.createGain();a.gain.value=e.volume,n.connect(a),a.connect(i.inputGain);const o=this.audioContext.currentTime+e.startTime-this.masterClock.currentTime,l=e.endTime-e.startTime;if(o>this.audioContext.currentTime)n.start(o,e.mediaOffset,l);else{const h=this.masterClock.currentTime-e.startTime+e.mediaOffset,p=l-(this.masterClock.currentTime-e.startTime);p>0&&h<e.audioBuffer.duration&&n.start(0,h,p)}const d={clipId:e.clipId,source:n,startedAt:e.startTime,duration:l},u=this.scheduledSources.get(e.trackId)||[];u.push(d),this.scheduledSources.set(e.trackId,u),n.onended=()=>{const h=this.scheduledSources.get(e.trackId);if(h){const p=h.indexOf(d);p>-1&&h.splice(p,1)}}}scheduleClips(e){for(const t of e)this.scheduleClip(t)}stopAllClips(){for(const[,e]of this.scheduledSources){for(const t of e)try{t.source.stop(),t.source.disconnect()}catch{}e.length=0}}stopClip(e){for(const[,t]of this.scheduledSources){const s=t.findIndex(i=>i.clipId===e);if(s>-1){const i=t[s];try{i.source.stop(),i.source.disconnect()}catch{}t.splice(s,1);break}}}async resume(){this.audioContext.state==="suspended"&&await this.audioContext.resume()}async suspend(){this.stopAllClips(),this.audioContext.state==="running"&&await this.audioContext.suspend()}startScheduler(e){if(this.schedulerIntervalId!==null)return;this.isPlaying=!0,this.lastScheduledTime=this.masterClock.currentTime;const t=()=>{if(!this.isPlaying)return;const i=this.masterClock.currentTime+this.scheduleAheadTime;if(i>this.lastScheduledTime){const n=e(this.lastScheduledTime);for(const a of n)a.startTime<=i&&a.endTime>this.lastScheduledTime&&((this.scheduledSources.get(a.trackId)||[]).some(d=>d.clipId===a.clipId)||this.scheduleClip(a));this.lastScheduledTime=i}};this.schedulerIntervalId=window.setInterval(t,100),t()}stopScheduler(){this.isPlaying=!1,this.schedulerIntervalId!==null&&(window.clearInterval(this.schedulerIntervalId),this.schedulerIntervalId=null),this.stopAllClips()}seekTo(e){this.stopAllClips(),this.lastScheduledTime=e}dispose(){this.stopScheduler();for(const e of Array.from(this.trackNodes.keys()))this.removeTrack(e);this.impulseResponseCache.clear(),this.masterGain.disconnect()}}let uo=null;function sh(){return uo||(uo=new AM),uo}function $W(r){return uo&&uo.dispose(),uo=new AM(r),uo}const zW={C1:32.7,D1:36.71,E1:41.2,F1:43.65,G1:49,A1:55,B1:61.74,C2:65.41,D2:73.42,E2:82.41,F2:87.31,G2:98,A2:110,B2:123.47,C3:130.81,D3:146.83,E3:164.81,F3:174.61,G3:196,A3:220,B3:246.94,C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,C5:523.25,D5:587.33,E5:659.25,F5:698.46,G5:783.99,A5:880,B5:987.77,C6:1046.5,D6:1174.66,E6:1318.51,F6:1396.91,G6:1567.98,A6:1760,B6:1975.53,"C#2":69.3,"D#2":77.78,"F#2":92.5,"G#2":103.83,"A#2":116.54,"C#3":138.59,"D#3":155.56,"F#3":185,"G#3":207.65,"A#3":233.08,"C#4":277.18,"D#4":311.13,"F#4":369.99,"G#4":415.3,"A#4":466.16,"C#5":554.37,"D#5":622.25,"F#5":739.99,"G#5":830.61,"A#5":932.33,Eb2:77.78,Bb2:116.54,Eb3:155.56,Bb3:233.08,Eb4:311.13,Bb4:466.16,Eb5:622.25,Bb5:932.33,Ab2:103.83,Ab3:207.65,Ab4:415.3,Ab5:830.61,Db3:138.59,Db4:277.18,Db5:554.37,Gb3:185,Gb4:369.99,Gb5:739.99},Fm={pop:[["C4","E4","G4"],["G3","B3","D4"],["A3","C4","E4"],["F3","A3","C4"]],jazz:[["C4","E4","G4","B4"],["A3","C4","E4","G4"],["D4","F4","A4","C5"],["G3","B3","D4","F4"]],lofi:[["C4","Eb4","G4"],["Ab3","C4","Eb4"],["Bb3","D4","F4"],["G3","Bb3","D4"]],cinematic:[["C4","G4","C5"],["Ab3","Eb4","Ab4"],["Bb3","F4","Bb4"],["G3","D4","G4"]],electronic:[["A3","E4","A4"],["F3","C4","F4"],["G3","D4","G4"],["A3","E4","A4"]],ambient:[["C4","G4","D5","G5"],["A3","E4","B4","E5"],["F3","C4","G4","C5"],["G3","D4","A4","D5"]]},Bl={uplifting:[["C3","G3","C4","E4","G4"],["G2","D3","G3","B3","D4"],["A2","E3","A3","C4","E4"],["F2","C3","F3","A3","C4"]],emotional:[["A2","E3","A3","C4","E4"],["F2","C3","F3","A3","C4"],["C3","G3","C4","E4","G4"],["G2","D3","G3","B3","D4"]],chill:[["D3","A3","D4","F#4","A4"],["G2","D3","G3","B3","D4"],["E3","B3","E4","G4","B4"],["A2","E3","A3","C#4","E4"]],happy:[["G3","D4","G4","B4","D5"],["C3","G3","C4","E4","G4"],["D3","A3","D4","F#4","A4"],["E3","B3","E4","G4","B4"]],funky:[["E3","G3","B3","D4"],["A3","C4","E4","G4"],["D3","F3","A3","C4"],["G3","B3","D4","F4"]]},Bm={bouncy:[0,0,4,4,7,4,2,0],flowing:[0,2,4,2,0,-1,0,2],energetic:[0,7,4,7,0,4,7,12]},VW={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],pentatonic:[0,2,4,7,9],blues:[0,3,5,6,7,10],dorian:[0,2,3,5,7,9,10]};class UW{cache=new Map;noteToFreq(e){return zW[e]||440}getScaleFrequencies(e,t,s=2){const i=[];for(let n=0;n<s;n++)for(const a of t)i.push(e*Math.pow(2,(a+n*12)/12));return i}createReverbImpulse(e,t,s){const i=e.sampleRate,n=i*t,a=e.createBuffer(2,n,i);for(let o=0;o<2;o++){const l=a.getChannelData(o);for(let d=0;d<n;d++){const u=d/i;l[d]=(Math.random()*2-1)*Math.exp(-u*s)}}return a}createWarmPad(e,t,s,i,n,a){const o=[-12,-5,0,5,7,12];o.forEach((l,d)=>{const u=e.createOscillator();u.type=d%2===0?"sine":"triangle",u.frequency.value=t,u.detune.value=l;const h=e.createBiquadFilter();h.type="lowpass",h.frequency.value=2e3+Math.sin(d)*500,h.Q.value=.5;const p=e.createGain(),f=.15,m=.3;p.gain.setValueAtTime(0,s),p.gain.linearRampToValueAtTime(n/o.length,s+f),p.gain.setValueAtTime(n/o.length*.7,s+i-m),p.gain.linearRampToValueAtTime(0,s+i),u.connect(h),h.connect(p),p.connect(a),u.start(s),u.stop(s+i)})}createPluckySynth(e,t,s,i,n,a){const o=e.createOscillator();o.type="sawtooth",o.frequency.value=t;const l=e.createOscillator();l.type="square",l.frequency.value=t*1.002;const d=e.createBiquadFilter();d.type="lowpass",d.frequency.setValueAtTime(t*8,s),d.frequency.exponentialRampToValueAtTime(t*2,s+.1),d.Q.value=2;const u=e.createGain();u.gain.setValueAtTime(0,s),u.gain.linearRampToValueAtTime(n,s+.01),u.gain.exponentialRampToValueAtTime(n*.3,s+.1),u.gain.exponentialRampToValueAtTime(.001,s+i),o.connect(d),l.connect(d),d.connect(u),u.connect(a),o.start(s),o.stop(s+i),l.start(s),l.stop(s+i)}createRichBass(e,t,s,i,n,a){const o=e.createOscillator();o.type="sine",o.frequency.value=t;const l=e.createOscillator();l.type="sawtooth",l.frequency.value=t*2;const d=e.createBiquadFilter();d.type="lowpass",d.frequency.setValueAtTime(800,s),d.frequency.exponentialRampToValueAtTime(200,s+i*.5);const u=e.createGain();u.gain.setValueAtTime(0,s),u.gain.linearRampToValueAtTime(n*.7,s+.02),u.gain.exponentialRampToValueAtTime(n*.4,s+i*.3),u.gain.linearRampToValueAtTime(0,s+i);const h=e.createGain();h.gain.setValueAtTime(0,s),h.gain.linearRampToValueAtTime(n*.3,s+.01),h.gain.exponentialRampToValueAtTime(.001,s+i*.5),o.connect(u),u.connect(a),l.connect(d),d.connect(h),h.connect(a),o.start(s),o.stop(s+i),l.start(s),l.stop(s+i)}createPunchyKick(e,t,s,i){const n=e.createOscillator();n.type="sine",n.frequency.setValueAtTime(150,t),n.frequency.exponentialRampToValueAtTime(40,t+.08);const a=e.createOscillator();a.type="triangle",a.frequency.value=1e3;const o=e.createGain();o.gain.setValueAtTime(s,t),o.gain.exponentialRampToValueAtTime(.001,t+.3);const l=e.createGain();l.gain.setValueAtTime(s*.3,t),l.gain.exponentialRampToValueAtTime(.001,t+.02);const d=e.createDynamicsCompressor();d.threshold.value=-10,d.ratio.value=4,d.attack.value=.003,d.release.value=.1,n.connect(o),a.connect(l),o.connect(d),l.connect(d),d.connect(i),n.start(t),n.stop(t+.3),a.start(t),a.stop(t+.02)}createCrispSnare(e,t,s,i){const n=e.createBuffer(1,e.sampleRate*.2,e.sampleRate),a=n.getChannelData(0);for(let p=0;p<a.length;p++)a[p]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=n;const l=e.createBiquadFilter();l.type="bandpass",l.frequency.value=5e3,l.Q.value=1;const d=e.createOscillator();d.type="triangle",d.frequency.setValueAtTime(200,t),d.frequency.exponentialRampToValueAtTime(100,t+.05);const u=e.createGain();u.gain.setValueAtTime(s*.5,t),u.gain.exponentialRampToValueAtTime(.001,t+.15);const h=e.createGain();h.gain.setValueAtTime(s*.4,t),h.gain.exponentialRampToValueAtTime(.001,t+.1),o.connect(l),l.connect(u),u.connect(i),d.connect(h),h.connect(i),o.start(t),d.start(t),d.stop(t+.1)}createShimmeringHiHat(e,t,s,i,n){const a=i?.15:.04,o=e.createBuffer(1,e.sampleRate*a,e.sampleRate),l=o.getChannelData(0);for(let f=0;f<l.length;f++)l[f]=Math.random()*2-1;const d=e.createBufferSource();d.buffer=o;const u=e.createBiquadFilter();u.type="highpass",u.frequency.value=7e3;const h=e.createBiquadFilter();h.type="bandpass",h.frequency.value=1e4,h.Q.value=.5;const p=e.createGain();p.gain.setValueAtTime(s,t),p.gain.exponentialRampToValueAtTime(.001,t+a),d.connect(u),u.connect(h),h.connect(p),p.connect(n),d.start(t)}async generateWhoosh(e,t,s,i=!0){const n=this.cache.get(e);if(n)return n;const a=44100,o=new OfflineAudioContext(2,a*s,a),l=o.createBuffer(2,a*s,a);for(let b=0;b<2;b++){const w=l.getChannelData(b);for(let C=0;C<w.length;C++)w[C]=Math.random()*2-1}const d=o.createBufferSource();d.buffer=l;const u=o.createBiquadFilter();u.type="bandpass",u.Q.value=i?5:2,u.frequency.setValueAtTime(i?2e3:800,0),u.frequency.exponentialRampToValueAtTime(i?8e3:3e3,s*.3),u.frequency.exponentialRampToValueAtTime(i?1e3:400,s);const h=o.createGain();h.gain.setValueAtTime(0,0),h.gain.linearRampToValueAtTime(.6,s*.1),h.gain.linearRampToValueAtTime(.8,s*.3),h.gain.exponentialRampToValueAtTime(.01,s);const p=o.createStereoPanner();p.pan.setValueAtTime(-.5,0),p.pan.linearRampToValueAtTime(.5,s),d.connect(u),u.connect(h),h.connect(p),p.connect(o.destination),d.start();const f=await o.startRendering(),m=await this.audioBufferToBlob(f),g=URL.createObjectURL(m),x={item:{id:e,name:t,category:"sfx",subcategory:"whoosh",duration:s,tags:["transition","movement",i?"quick":"gentle"],previewUrl:g,downloadUrl:g,isBuiltin:!0,license:"royalty-free"},blob:m,dataUrl:g};return this.cache.set(e,x),x}async generateImpact(e,t,s=!0){const i=this.cache.get(e);if(i)return i;const n=s?1.2:.6,a=44100,o=new OfflineAudioContext(2,a*n,a),l=o.createOscillator();l.type="sine",l.frequency.setValueAtTime(s?80:150,0),l.frequency.exponentialRampToValueAtTime(s?30:50,n);const d=o.createBuffer(2,a*.1,a);for(let C=0;C<2;C++){const k=d.getChannelData(C);for(let S=0;S<k.length;S++)k[S]=Math.random()*2-1}const u=o.createBufferSource();u.buffer=d;const h=o.createBiquadFilter();h.type="lowpass",h.frequency.value=s?500:1e3;const p=o.createGain();p.gain.setValueAtTime(.8,0),p.gain.exponentialRampToValueAtTime(.01,.1),u.connect(h),h.connect(p),p.connect(o.destination);const f=o.createGain();f.gain.setValueAtTime(1,0),f.gain.exponentialRampToValueAtTime(.01,n);const m=o.createDynamicsCompressor();m.threshold.value=-20,m.ratio.value=12,l.connect(f),f.connect(m),m.connect(o.destination),l.start(),u.start();const g=await o.startRendering(),y=await this.audioBufferToBlob(g),x=URL.createObjectURL(y),w={item:{id:e,name:t,category:"sfx",subcategory:"impacts",duration:n,tags:[s?"heavy":"light","punch","hit"],previewUrl:x,downloadUrl:x,isBuiltin:!0,license:"royalty-free"},blob:y,dataUrl:x};return this.cache.set(e,w),w}async generateClick(e,t){const s=this.cache.get(e);if(s)return s;const i=.08,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(2e3,0),o.frequency.exponentialRampToValueAtTime(800,i);const l=a.createGain();l.gain.setValueAtTime(.5,0),l.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(a.destination),o.start();const d=await a.startRendering(),u=await this.audioBufferToBlob(d),h=URL.createObjectURL(u),f={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["button","interface","tap"],previewUrl:h,downloadUrl:h,isBuiltin:!0,license:"royalty-free"},blob:u,dataUrl:h};return this.cache.set(e,f),f}async generateNotification(e,t){const s=this.cache.get(e);if(s)return s;const i=.5,n=44100,a=new OfflineAudioContext(2,n*i,n);[880,1100,1320].forEach((f,m)=>{const g=a.createOscillator();g.type="sine",g.frequency.value=f;const y=a.createGain(),x=m*.08;y.gain.setValueAtTime(0,x),y.gain.linearRampToValueAtTime(.3,x+.02),y.gain.exponentialRampToValueAtTime(.01,x+.15),g.connect(y),y.connect(a.destination),g.start(x),g.stop(x+.15)});const l=await a.startRendering(),d=await this.audioBufferToBlob(l),u=URL.createObjectURL(d),p={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["alert","bell","message"],previewUrl:u,downloadUrl:u,isBuiltin:!0,license:"royalty-free"},blob:d,dataUrl:u};return this.cache.set(e,p),p}async generateSuccess(e,t){const s=this.cache.get(e);if(s)return s;const i=.6,n=44100,a=new OfflineAudioContext(2,n*i,n);[523.25,659.25,783.99,1046.5].forEach((f,m)=>{const g=a.createOscillator();g.type="triangle",g.frequency.value=f;const y=a.createGain(),x=m*.1;y.gain.setValueAtTime(0,x),y.gain.linearRampToValueAtTime(.25,x+.03),y.gain.exponentialRampToValueAtTime(.01,x+.25),g.connect(y),y.connect(a.destination),g.start(x),g.stop(x+.25)});const l=await a.startRendering(),d=await this.audioBufferToBlob(l),u=URL.createObjectURL(d),p={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["complete","achievement","positive"],previewUrl:u,downloadUrl:u,isBuiltin:!0,license:"royalty-free"},blob:d,dataUrl:u};return this.cache.set(e,p),p}async generatePop(e,t){const s=this.cache.get(e);if(s)return s;const i=.15,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(400,0),o.frequency.exponentialRampToValueAtTime(100,i);const l=a.createGain();l.gain.setValueAtTime(.6,0),l.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(a.destination),o.start();const d=await a.startRendering(),u=await this.audioBufferToBlob(d),h=URL.createObjectURL(u),f={item:{id:e,name:t,category:"sfx",subcategory:"cartoon",duration:i,tags:["bubble","appear","fun"],previewUrl:h,downloadUrl:h,isBuiltin:!0,license:"royalty-free"},blob:u,dataUrl:h};return this.cache.set(e,f),f}async generateBoing(e,t){const s=this.cache.get(e);if(s)return s;const i=.4,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine";const l=a.createOscillator();l.type="sine",l.frequency.value=12;const d=a.createGain();d.gain.setValueAtTime(200,0),d.gain.exponentialRampToValueAtTime(1,i),l.connect(d),d.connect(o.frequency),o.frequency.setValueAtTime(300,0),o.frequency.exponentialRampToValueAtTime(100,i);const u=a.createGain();u.gain.setValueAtTime(.5,0),u.gain.exponentialRampToValueAtTime(.01,i),o.connect(u),u.connect(a.destination),o.start(),l.start();const h=await a.startRendering(),p=await this.audioBufferToBlob(h),f=URL.createObjectURL(p),g={item:{id:e,name:t,category:"sfx",subcategory:"cartoon",duration:i,tags:["bounce","spring","funny"],previewUrl:f,downloadUrl:f,isBuiltin:!0,license:"royalty-free"},blob:p,dataUrl:f};return this.cache.set(e,g),g}async generateGlitch(e,t){const s=this.cache.get(e);if(s)return s;const i=.5,n=44100,a=new OfflineAudioContext(2,n*i,n);for(let p=0;p<8;p++){const f=p*.05+Math.random()*.02,m=.02+Math.random()*.03,g=a.createBuffer(2,n*m,n);for(let w=0;w<2;w++){const C=g.getChannelData(w);for(let k=0;k<C.length;k++)C[k]=(Math.random()*2-1)*(Math.random()>.5?1:0)}const y=a.createBufferSource();y.buffer=g;const x=a.createBiquadFilter();x.type="bandpass",x.frequency.value=1e3+Math.random()*3e3,x.Q.value=10;const b=a.createGain();b.gain.value=.3+Math.random()*.3,y.connect(x),x.connect(b),b.connect(a.destination),y.start(f)}const o=await a.startRendering(),l=await this.audioBufferToBlob(o),d=URL.createObjectURL(l),h={item:{id:e,name:t,category:"sfx",subcategory:"transitions",duration:i,tags:["digital","error","tech"],previewUrl:d,downloadUrl:d,isBuiltin:!0,license:"royalty-free"},blob:l,dataUrl:d};return this.cache.set(e,h),h}async generateRiser(e,t){const s=this.cache.get(e);if(s)return s;const i=2,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createBuffer(2,n*i,n);for(let y=0;y<2;y++){const x=o.getChannelData(y);for(let b=0;b<x.length;b++)x[b]=Math.random()*2-1}const l=a.createBufferSource();l.buffer=o;const d=a.createBiquadFilter();d.type="highpass",d.frequency.setValueAtTime(100,0),d.frequency.exponentialRampToValueAtTime(8e3,i),d.Q.value=5;const u=a.createGain();u.gain.setValueAtTime(.1,0),u.gain.linearRampToValueAtTime(.6,i*.9),u.gain.linearRampToValueAtTime(0,i),l.connect(d),d.connect(u),u.connect(a.destination),l.start();const h=await a.startRendering(),p=await this.audioBufferToBlob(h),f=URL.createObjectURL(p),g={item:{id:e,name:t,category:"sfx",subcategory:"transitions",duration:i,tags:["build-up","riser","tension"],previewUrl:f,downloadUrl:f,isBuiltin:!0,license:"royalty-free"},blob:p,dataUrl:f};return this.cache.set(e,g),g}async generateLaser(e,t){const s=this.cache.get(e);if(s)return s;const i=.25,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sawtooth",o.frequency.setValueAtTime(2e3,0),o.frequency.exponentialRampToValueAtTime(100,i);const l=a.createBiquadFilter();l.type="lowpass",l.frequency.setValueAtTime(5e3,0),l.frequency.exponentialRampToValueAtTime(500,i);const d=a.createGain();d.gain.setValueAtTime(.4,0),d.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(d),d.connect(a.destination),o.start();const u=await a.startRendering(),h=await this.audioBufferToBlob(u),p=URL.createObjectURL(h),m={item:{id:e,name:t,category:"sfx",subcategory:"sci-fi",duration:i,tags:["weapon","space","shoot"],previewUrl:p,downloadUrl:p,isBuiltin:!0,license:"royalty-free"},blob:h,dataUrl:p};return this.cache.set(e,m),m}async generatePowerUp(e,t){const s=this.cache.get(e);if(s)return s;const i=1.2,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(200,0),o.frequency.exponentialRampToValueAtTime(1200,i);const l=a.createOscillator();l.type="triangle",l.frequency.setValueAtTime(400,0),l.frequency.exponentialRampToValueAtTime(2400,i);const d=a.createGain();d.gain.setValueAtTime(0,0),d.gain.linearRampToValueAtTime(.3,i*.1),d.gain.linearRampToValueAtTime(.4,i*.8),d.gain.linearRampToValueAtTime(0,i);const u=a.createGain();u.gain.setValueAtTime(0,0),u.gain.linearRampToValueAtTime(.15,i*.1),u.gain.linearRampToValueAtTime(.2,i*.8),u.gain.linearRampToValueAtTime(0,i),o.connect(d),l.connect(u),d.connect(a.destination),u.connect(a.destination),o.start(),l.start();const h=await a.startRendering(),p=await this.audioBufferToBlob(h),f=URL.createObjectURL(p),g={item:{id:e,name:t,category:"sfx",subcategory:"sci-fi",duration:i,tags:["energy","charge","activate"],previewUrl:f,downloadUrl:f,isBuiltin:!0,license:"royalty-free"},blob:p,dataUrl:f};return this.cache.set(e,g),g}async generateSimpleBeat(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=8,l=44100,d=new OfflineAudioContext(2,l*o,l),u=60/s,h=Math.floor(o/u);for(let x=0;x<h;x++){const b=x*u,w=x%4===0,C=x%4===2,k=d.createOscillator();k.type="sine",k.frequency.setValueAtTime(w?150:100,b),k.frequency.exponentialRampToValueAtTime(40,b+.1);const S=d.createGain();if(S.gain.setValueAtTime(w?.8:.5,b),S.gain.exponentialRampToValueAtTime(.01,b+.15),k.connect(S),S.connect(d.destination),k.start(b),k.stop(b+.15),C||x%4===2){const A=d.createBuffer(1,l*.1,l),T=A.getChannelData(0);for(let P=0;P<T.length;P++)T[P]=Math.random()*2-1;const j=d.createBufferSource();j.buffer=A;const _=d.createBiquadFilter();_.type="highpass",_.frequency.value=7e3;const M=d.createGain();M.gain.setValueAtTime(.3,b),M.gain.exponentialRampToValueAtTime(.01,b+.05),j.connect(_),_.connect(M),M.connect(d.destination),j.start(b)}}const p=await d.startRendering(),f=await this.audioBufferToBlob(p),m=URL.createObjectURL(f),y={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"C Major",tags:["beat","loop",i],mood:n,previewUrl:m,downloadUrl:m,isBuiltin:!0,license:"royalty-free"},blob:f,dataUrl:m};return this.cache.set(e,y),y}async generateAmbientPad(e,t,s,i){const n=this.cache.get(e);if(n)return n;const a=10,o=44100,l=new OfflineAudioContext(2,o*a,o);[261.63,329.63,392,523.25].forEach(g=>{const y=l.createOscillator();y.type="sine",y.frequency.value=g;const x=l.createOscillator();x.type="sine",x.frequency.value=g*1.002;const b=l.createBiquadFilter();b.type="lowpass",b.frequency.setValueAtTime(800,0),b.frequency.linearRampToValueAtTime(2e3,a*.5),b.frequency.linearRampToValueAtTime(600,a);const w=l.createGain();w.gain.setValueAtTime(0,0),w.gain.linearRampToValueAtTime(.08,a*.3),w.gain.setValueAtTime(.08,a*.7),w.gain.linearRampToValueAtTime(0,a),y.connect(b),x.connect(b),b.connect(w),w.connect(l.destination),y.start(),x.start()});const u=await l.startRendering(),h=await this.audioBufferToBlob(u),p=URL.createObjectURL(h),m={item:{id:e,name:t,category:"music",subcategory:s,duration:a,bpm:60,key:"C Major",tags:["ambient","pad","atmospheric"],mood:i,previewUrl:p,downloadUrl:p,isBuiltin:!0,license:"royalty-free"},blob:h,dataUrl:p};return this.cache.set(e,m),m}async generateChordProgression(e,t,s,i,n,a="pop"){const o=this.cache.get(e);if(o)return o;const l=16,d=44100,u=new OfflineAudioContext(2,d*l,d),h=Fm[a]||Fm.pop,p=4,f=60/s,m=p*f;h.forEach((C,k)=>{const S=k*m;C.forEach(A=>{const T=this.noteToFreq(A),j=u.createOscillator();j.type=i==="electronic"?"sawtooth":"triangle",j.frequency.value=T;const _=u.createOscillator();_.type="sine",_.frequency.value=T*1.001;const M=u.createBiquadFilter();M.type="lowpass",M.frequency.setValueAtTime(2e3,S),M.frequency.linearRampToValueAtTime(800,S+m),M.Q.value=1;const P=u.createGain();P.gain.setValueAtTime(0,S),P.gain.linearRampToValueAtTime(.12,S+.1),P.gain.setValueAtTime(.1,S+m-.2),P.gain.linearRampToValueAtTime(0,S+m),j.connect(M),_.connect(M),M.connect(P),P.connect(u.destination),j.start(S),j.stop(S+m),_.start(S),_.stop(S+m)})});const g=await u.startRendering(),y=await this.audioBufferToBlob(g),x=URL.createObjectURL(y),w={item:{id:e,name:t,category:"music",subcategory:i,duration:l,bpm:s,key:"C Major",tags:["chords","progression",i],mood:n,previewUrl:x,downloadUrl:x,isBuiltin:!0,license:"royalty-free"},blob:y,dataUrl:x};return this.cache.set(e,w),w}async generateMelody(e,t,s,i,n,a="pentatonic"){const o=this.cache.get(e);if(o)return o;const l=8,d=44100,u=new OfflineAudioContext(2,d*l,d),h=VW[a],f=this.getScaleFrequencies(261.63,h,2),y=60/s/2,x=Math.floor(l/y);let b=Math.floor(f.length/2);for(let T=0;T<x;T++){const j=T*y,_=Math.floor(Math.random()*5)-2;let M=b+_;M=Math.max(0,Math.min(f.length-1,M)),b=M;const P=f[M],R=u.createOscillator();R.type=i==="lofi"?"triangle":"sine",R.frequency.value=P;const D=u.createOscillator();D.type="sine",D.frequency.value=5;const B=u.createGain();B.gain.value=P*.01,D.connect(B),B.connect(R.frequency);const O=u.createBiquadFilter();O.type="lowpass",O.frequency.value=3e3;const F=u.createGain();F.gain.setValueAtTime(0,j),F.gain.linearRampToValueAtTime(.2,j+.02),F.gain.exponentialRampToValueAtTime(.01,j+y*.9),R.connect(O),O.connect(F),F.connect(u.destination),R.start(j),R.stop(j+y),D.start(j),D.stop(j+y)}const w=await u.startRendering(),C=await this.audioBufferToBlob(w),k=URL.createObjectURL(C),A={item:{id:e,name:t,category:"music",subcategory:i,duration:l,bpm:s,key:"C Major",tags:["melody","lead",i],mood:n,previewUrl:k,downloadUrl:k,isBuiltin:!0,license:"royalty-free"},blob:C,dataUrl:k};return this.cache.set(e,A),A}async generateArpeggio(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=8,l=44100,d=new OfflineAudioContext(2,l*o,l),u=Fm.electronic,h=60/s,f=h/4;u.forEach((w,C)=>{const k=C*2*h;for(let S=0;S<8;S++){const A=S%w.length,T=k+S*f;if(T>=o)break;const j=this.noteToFreq(w[A]),_=d.createOscillator();_.type="sawtooth",_.frequency.value=j;const M=d.createBiquadFilter();M.type="lowpass",M.frequency.setValueAtTime(4e3,T),M.frequency.exponentialRampToValueAtTime(500,T+f),M.Q.value=5;const P=d.createGain();P.gain.setValueAtTime(0,T),P.gain.linearRampToValueAtTime(.15,T+.01),P.gain.exponentialRampToValueAtTime(.01,T+f*.8),_.connect(M),M.connect(P),P.connect(d.destination),_.start(T),_.stop(T+f)}});const m=await d.startRendering(),g=await this.audioBufferToBlob(m),y=URL.createObjectURL(g),b={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"A Minor",tags:["arpeggio","synth",i],mood:n,previewUrl:y,downloadUrl:y,isBuiltin:!0,license:"royalty-free"},blob:g,dataUrl:y};return this.cache.set(e,b),b}async generateBassline(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=8,l=44100,d=new OfflineAudioContext(2,l*o,l),u=["C2","C2","G2","G2","A2","A2","F2","F2"],h=60/s;u.forEach((x,b)=>{const w=b*h,C=this.noteToFreq(x),k=d.createOscillator();k.type="sawtooth",k.frequency.value=C;const S=d.createOscillator();S.type="sine",S.frequency.value=C/2;const A=d.createBiquadFilter();A.type="lowpass",A.frequency.setValueAtTime(800,w),A.frequency.exponentialRampToValueAtTime(200,w+h),A.Q.value=8;const T=d.createGain();T.gain.setValueAtTime(0,w),T.gain.linearRampToValueAtTime(.4,w+.02),T.gain.exponentialRampToValueAtTime(.1,w+h*.8);const j=d.createGain();j.gain.value=.3,k.connect(A),A.connect(T),S.connect(j),j.connect(T),T.connect(d.destination),k.start(w),k.stop(w+h),S.start(w),S.stop(w+h)});const p=await d.startRendering(),f=await this.audioBufferToBlob(p),m=URL.createObjectURL(f),y={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"C Minor",tags:["bass","groove",i],mood:n,previewUrl:m,downloadUrl:m,isBuiltin:!0,license:"royalty-free"},blob:f,dataUrl:m};return this.cache.set(e,y),y}async generateDrumLoop(e,t,s,i,n,a="basic"){const o=this.cache.get(e);if(o)return o;const l=8,d=44100,u=new OfflineAudioContext(2,d*l,d),h=60/s,p=h/4,f=Math.floor(l/(h*4));for(let w=0;w<f;w++){const C=w*h*4;for(let k=0;k<16;k++){const S=C+k*p;if(S>=l)break;const A=k===0||k===8||a==="complex"&&(k===6||k===14),T=k===4||k===12,j=a!=="minimal"||k%4===0,_=k===2||k===10;if(A){const M=u.createOscillator();M.type="sine",M.frequency.setValueAtTime(150,S),M.frequency.exponentialRampToValueAtTime(30,S+.15);const P=u.createGain();P.gain.setValueAtTime(.8,S),P.gain.exponentialRampToValueAtTime(.01,S+.2);const R=u.createOscillator();R.type="triangle",R.frequency.setValueAtTime(1e3,S),R.frequency.exponentialRampToValueAtTime(100,S+.03);const D=u.createGain();D.gain.setValueAtTime(.3,S),D.gain.exponentialRampToValueAtTime(.01,S+.03),M.connect(P),P.connect(u.destination),R.connect(D),D.connect(u.destination),M.start(S),M.stop(S+.2),R.start(S),R.stop(S+.03)}if(T){const M=u.createBuffer(1,d*.15,d),P=M.getChannelData(0);for(let I=0;I<P.length;I++)P[I]=Math.random()*2-1;const R=u.createBufferSource();R.buffer=M;const D=u.createBiquadFilter();D.type="highpass",D.frequency.value=1e3;const B=u.createGain();B.gain.setValueAtTime(.5,S),B.gain.exponentialRampToValueAtTime(.01,S+.15);const O=u.createOscillator();O.type="triangle",O.frequency.setValueAtTime(200,S),O.frequency.exponentialRampToValueAtTime(100,S+.05);const F=u.createGain();F.gain.setValueAtTime(.3,S),F.gain.exponentialRampToValueAtTime(.01,S+.1),R.connect(D),D.connect(B),B.connect(u.destination),O.connect(F),F.connect(u.destination),R.start(S),O.start(S),O.stop(S+.1)}if(j&&a!=="minimal"){const M=u.createBuffer(1,d*.05,d),P=M.getChannelData(0);for(let F=0;F<P.length;F++)P[F]=Math.random()*2-1;const R=u.createBufferSource();R.buffer=M;const D=u.createBiquadFilter();D.type="highpass",D.frequency.value=8e3;const B=u.createGain(),O=_?.1:.03;B.gain.setValueAtTime(_?.25:.15,S),B.gain.exponentialRampToValueAtTime(.01,S+O),R.connect(D),D.connect(B),B.connect(u.destination),R.start(S)}}}const m=await u.startRendering(),g=await this.audioBufferToBlob(m),y=URL.createObjectURL(g),b={item:{id:e,name:t,category:"music",subcategory:i,duration:l,bpm:s,tags:["drums","loop","beat",i],mood:n,previewUrl:y,downloadUrl:y,isBuiltin:!0,license:"royalty-free"},blob:g,dataUrl:y};return this.cache.set(e,b),b}async generateFullTrack(e,t,s,i,n){const a=this.cache.get(e);if(a)return a;const o=16,l=44100,d=new OfflineAudioContext(2,l*o,l),u=60/s,h=u*4,p=this.createReverbImpulse(d,2.5,3),f=d.createConvolver();f.buffer=p;const m=d.createGain();m.gain.value=.25;const g=d.createGain();g.gain.value=.8;const y=d.createDynamicsCompressor();y.threshold.value=-6,y.ratio.value=3,y.attack.value=.003,y.release.value=.25,f.connect(m),m.connect(y),g.connect(y),y.connect(d.destination);const x=n.includes("happy")||n.includes("bright")||n.includes("playful"),b=n.includes("energetic")||n.includes("inspiring"),w=n.includes("calm")||n.includes("nostalgic");let C;x?C=Bl.happy:b?C=Bl.uplifting:w?C=Bl.chill:i==="hip-hop"?C=Bl.funky:C=Bl.emotional;const k=Math.floor(o/h);for(let P=0;P<k;P++){const R=P%C.length,D=C[R],B=P*h;D.forEach((Z,E)=>{const G=this.noteToFreq(Z);E<2?(this.createWarmPad(d,G,B,h,.12,f),this.createWarmPad(d,G,B,h,.08,g)):this.createWarmPad(d,G,B,h,.06,f)});const O=D[0],F=this.noteToFreq(O);if(i==="hip-hop"||i==="electronic")for(let Z=0;Z<4;Z++){const E=B+Z*u;(Z===0||Z===2)&&this.createRichBass(d,F,E,u*.8,.4,g)}else for(let Z=0;Z<4;Z++){const E=B+Z*u;this.createRichBass(d,F,E,u*.7,.3,g)}const I=x?Bm.bouncy:b?Bm.energetic:Bm.flowing,J=this.noteToFreq(D[2]||D[1]);P%2===0&&I.forEach((Z,E)=>{const G=B+E*u/2;if(G<B+h-.1){const V=J*Math.pow(2,Z/12);this.createPluckySynth(d,V,G,u*.4,.15,f)}})}const S=Math.floor(o/u);for(let P=0;P<S;P++){const R=P*u,D=P%4,B=Math.floor(P/4);(D===0||D===2)&&this.createPunchyKick(d,R,.5,g),(D===1||D===3)&&this.createCrispSnare(d,R,.35,f),i==="electronic"||i==="pop"||b?(this.createShimmeringHiHat(d,R,.08,!1,f),D===2&&this.createShimmeringHiHat(d,R+u/2,.06,!0,f)):D%2===0&&this.createShimmeringHiHat(d,R,.07,!1,f),i==="hip-hop"&&B%2===1&&D===0&&(this.createShimmeringHiHat(d,R+u*.25,.04,!1,g),this.createShimmeringHiHat(d,R+u*.75,.04,!1,g))}const A=await d.startRendering(),T=await this.audioBufferToBlob(A),j=URL.createObjectURL(T),M={item:{id:e,name:t,category:"music",subcategory:i,duration:o,bpm:s,key:"C Major",tags:["full","track","complete",i],mood:n,previewUrl:j,downloadUrl:j,isBuiltin:!0,license:"royalty-free"},blob:T,dataUrl:j};return this.cache.set(e,M),M}async generateStinger(e,t,s){const i=this.cache.get(e);if(i)return i;const n=3,a=44100,o=new OfflineAudioContext(2,a*n,a);["C4","E4","G4","C5"].forEach((m,g)=>{const y=this.noteToFreq(m),x=g*.05,b=o.createOscillator();b.type="triangle",b.frequency.value=y;const w=o.createOscillator();w.type="sine",w.frequency.value=y*2;const C=o.createGain();C.gain.setValueAtTime(0,x),C.gain.linearRampToValueAtTime(.2,x+.05),C.gain.setValueAtTime(.15,x+.5),C.gain.exponentialRampToValueAtTime(.01,n);const k=o.createGain();k.gain.setValueAtTime(0,x),k.gain.linearRampToValueAtTime(.08,x+.05),k.gain.exponentialRampToValueAtTime(.01,x+1.5),b.connect(C),w.connect(k),C.connect(o.destination),k.connect(o.destination),b.start(x),b.stop(n),w.start(x),w.stop(x+1.5)});const d=await o.startRendering(),u=await this.audioBufferToBlob(d),h=URL.createObjectURL(u),f={item:{id:e,name:t,category:"sfx",subcategory:"musical",duration:n,tags:["stinger","logo","intro"],mood:s,previewUrl:h,downloadUrl:h,isBuiltin:!0,license:"royalty-free"},blob:u,dataUrl:h};return this.cache.set(e,f),f}async generateCinematicHit(e,t){const s=this.cache.get(e);if(s)return s;const i=4,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="sine",o.frequency.setValueAtTime(60,0),o.frequency.exponentialRampToValueAtTime(20,i);const l=a.createGain();l.gain.setValueAtTime(.8,0),l.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(a.destination),o.start(0),o.stop(i);const d=a.createBuffer(2,n*.5,n);for(let w=0;w<2;w++){const C=d.getChannelData(w);for(let k=0;k<C.length;k++)C[k]=Math.random()*2-1}const u=a.createBufferSource();u.buffer=d;const h=a.createBiquadFilter();h.type="lowpass",h.frequency.setValueAtTime(2e3,0),h.frequency.exponentialRampToValueAtTime(100,.5);const p=a.createGain();p.gain.setValueAtTime(.6,0),p.gain.exponentialRampToValueAtTime(.01,.5),u.connect(h),h.connect(p),p.connect(a.destination),u.start(0),[65.41,130.81,261.63].forEach(w=>{const C=a.createOscillator();C.type="sawtooth",C.frequency.value=w;const k=a.createBiquadFilter();k.type="lowpass",k.frequency.setValueAtTime(1e3,0),k.frequency.exponentialRampToValueAtTime(100,2);const S=a.createGain();S.gain.setValueAtTime(.15,0),S.gain.exponentialRampToValueAtTime(.01,3),C.connect(k),k.connect(S),S.connect(a.destination),C.start(0),C.stop(3)});const m=await a.startRendering(),g=await this.audioBufferToBlob(m),y=URL.createObjectURL(g),b={item:{id:e,name:t,category:"sfx",subcategory:"impacts",duration:i,tags:["cinematic","hit","epic","trailer"],mood:["tense","dark"],previewUrl:y,downloadUrl:y,isBuiltin:!0,license:"royalty-free"},blob:g,dataUrl:y};return this.cache.set(e,b),b}async generateTypingSound(e,t){const s=this.cache.get(e);if(s)return s;const i=.08,n=44100,a=new OfflineAudioContext(2,n*i,n),o=a.createOscillator();o.type="square",o.frequency.setValueAtTime(800+Math.random()*400,0),o.frequency.exponentialRampToValueAtTime(200,i);const l=a.createBiquadFilter();l.type="bandpass",l.frequency.value=2e3,l.Q.value=2;const d=a.createGain();d.gain.setValueAtTime(.2,0),d.gain.exponentialRampToValueAtTime(.01,i),o.connect(l),l.connect(d),d.connect(a.destination),o.start();const u=await a.startRendering(),h=await this.audioBufferToBlob(u),p=URL.createObjectURL(h),m={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["keyboard","typing","click"],previewUrl:p,downloadUrl:p,isBuiltin:!0,license:"royalty-free"},blob:h,dataUrl:p};return this.cache.set(e,m),m}async generateErrorSound(e,t){const s=this.cache.get(e);if(s)return s;const i=.4,n=44100,a=new OfflineAudioContext(2,n*i,n);[0,.15].forEach(p=>{const f=a.createOscillator();f.type="square",f.frequency.value=220;const m=a.createGain();m.gain.setValueAtTime(0,p),m.gain.linearRampToValueAtTime(.25,p+.02),m.gain.linearRampToValueAtTime(0,p+.12),f.connect(m),m.connect(a.destination),f.start(p),f.stop(p+.12)});const o=await a.startRendering(),l=await this.audioBufferToBlob(o),d=URL.createObjectURL(l),h={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["error","warning","alert"],previewUrl:d,downloadUrl:d,isBuiltin:!0,license:"royalty-free"},blob:l,dataUrl:d};return this.cache.set(e,h),h}async generateCountdown(e,t){const s=this.cache.get(e);if(s)return s;const i=4,n=44100,a=new OfflineAudioContext(2,n*i,n);for(let p=0;p<4;p++){const f=p,m=p===3,g=m?880:440,y=a.createOscillator();y.type="sine",y.frequency.value=g;const x=a.createGain();x.gain.setValueAtTime(0,f),x.gain.linearRampToValueAtTime(m?.4:.3,f+.02),x.gain.exponentialRampToValueAtTime(.01,f+(m?.8:.15)),y.connect(x),x.connect(a.destination),y.start(f),y.stop(f+(m?.8:.15))}const o=await a.startRendering(),l=await this.audioBufferToBlob(o),d=URL.createObjectURL(l),h={item:{id:e,name:t,category:"sfx",subcategory:"ui",duration:i,tags:["countdown","timer","beep"],previewUrl:d,downloadUrl:d,isBuiltin:!0,license:"royalty-free"},blob:l,dataUrl:d};return this.cache.set(e,h),h}async audioBufferToBlob(e){const t=e.numberOfChannels,s=e.sampleRate,i=1,n=16,a=n/8,o=t*a,l=s*o,d=e.length*o,h=44+d,p=new ArrayBuffer(h),f=new DataView(p),m=(x,b)=>{for(let w=0;w<b.length;w++)f.setUint8(x+w,b.charCodeAt(w))};m(0,"RIFF"),f.setUint32(4,h-8,!0),m(8,"WAVE"),m(12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,i,!0),f.setUint16(22,t,!0),f.setUint32(24,s,!0),f.setUint32(28,l,!0),f.setUint16(32,o,!0),f.setUint16(34,n,!0),m(36,"data"),f.setUint32(40,d,!0);const g=[];for(let x=0;x<t;x++)g.push(e.getChannelData(x));let y=44;for(let x=0;x<e.length;x++)for(let b=0;b<t;b++){const w=Math.max(-1,Math.min(1,g[b][x])),C=w<0?w*32768:w*32767;f.setInt16(y,C,!0),y+=2}return new Blob([p],{type:"audio/wav"})}dispose(){for(const{dataUrl:e}of this.cache.values())URL.revokeObjectURL(e);this.cache.clear()}}let Lm=null;function GW(){return Lm||(Lm=new UW),Lm}class WW{sounds=new Map;soundBlobs=new Map;audioContext=null;previewSource=null;previewGain=null;initialized=!1;initPromise=null;constructor(){this.initPromise=this.loadBuiltinSounds()}async ensureInitialized(){this.initPromise&&await this.initPromise}async loadBuiltinSounds(){if(this.initialized)return;const e=GW();try{const t=[e.generateWhoosh("sfx-whoosh-fast-1","Fast Whoosh",.5,!0),e.generateWhoosh("sfx-whoosh-slow-1","Slow Whoosh",1.2,!1),e.generateWhoosh("sfx-whoosh-medium-1","Medium Swoosh",.8,!0),e.generateImpact("sfx-impact-heavy-1","Heavy Impact",!0),e.generateImpact("sfx-impact-light-1","Light Hit",!1),e.generateImpact("sfx-impact-punch-1","Punch",!0),e.generateClick("sfx-ui-click-1","Click"),e.generateClick("sfx-ui-tap-1","Tap"),e.generateNotification("sfx-ui-notification-1","Notification"),e.generateNotification("sfx-ui-alert-1","Alert Ding"),e.generateSuccess("sfx-ui-success-1","Success Chime"),e.generateSuccess("sfx-ui-complete-1","Complete"),e.generatePop("sfx-cartoon-pop-1","Pop"),e.generatePop("sfx-cartoon-bubble-1","Bubble"),e.generateBoing("sfx-cartoon-boing-1","Boing"),e.generateBoing("sfx-cartoon-spring-1","Spring"),e.generateGlitch("sfx-transition-glitch-1","Glitch"),e.generateGlitch("sfx-transition-digital-1","Digital Error"),e.generateRiser("sfx-transition-riser-1","Riser"),e.generateRiser("sfx-transition-buildup-1","Build Up"),e.generateLaser("sfx-scifi-laser-1","Laser Blast"),e.generateLaser("sfx-scifi-zap-1","Zap"),e.generatePowerUp("sfx-scifi-powerup-1","Power Up"),e.generatePowerUp("sfx-scifi-charge-1","Charge"),e.generateStinger("sfx-musical-stinger-1","Logo Stinger",["inspiring","bright"]),e.generateStinger("sfx-musical-stinger-2","Intro Sting",["happy","playful"]),e.generateCinematicHit("sfx-cinematic-hit-1","Epic Hit"),e.generateCinematicHit("sfx-cinematic-hit-2","Trailer Impact"),e.generateTypingSound("sfx-ui-typing-1","Key Press"),e.generateTypingSound("sfx-ui-typing-2","Keyboard Click"),e.generateErrorSound("sfx-ui-error-1","Error Beep"),e.generateErrorSound("sfx-ui-error-2","Warning Tone"),e.generateCountdown("sfx-ui-countdown-1","Countdown Beeps"),e.generateCountdown("sfx-ui-countdown-2","Timer Beeps")],s=[e.generateSimpleBeat("music-electronic-beat-1","Electronic Beat",128,"electronic",["energetic","happy"]),e.generateSimpleBeat("music-hiphop-beat-1","Hip-Hop Groove",90,"hip-hop",["energetic"]),e.generateSimpleBeat("music-pop-beat-1","Pop Rhythm",110,"pop",["happy","playful"]),e.generateSimpleBeat("music-lofi-beat-1","Lo-Fi Chill",85,"lofi",["calm","nostalgic"]),e.generateSimpleBeat("music-upbeat-beat-1","Upbeat Energy",120,"upbeat",["energetic","inspiring"]),e.generateSimpleBeat("music-corporate-beat-1","Corporate",100,"corporate",["inspiring","bright"]),e.generateSimpleBeat("music-trap-beat-1","Trap Banger",140,"hip-hop",["energetic","dark"]),e.generateSimpleBeat("music-house-beat-1","House Groove",124,"electronic",["energetic","happy"]),e.generateSimpleBeat("music-dance-beat-1","Dance Floor",130,"electronic",["energetic","playful"]),e.generateSimpleBeat("music-funk-beat-1","Funky Fresh",105,"upbeat",["happy","playful"]),e.generateSimpleBeat("music-edm-beat-1","EDM Drop",150,"electronic",["energetic"]),e.generateSimpleBeat("music-party-beat-1","Party Mode",128,"upbeat",["energetic","happy"]),e.generateSimpleBeat("music-summer-beat-1","Summer Vibes",115,"pop",["happy","bright"]),e.generateSimpleBeat("music-club-beat-1","Club Night",126,"electronic",["energetic","dark"]),e.generateAmbientPad("music-ambient-pad-1","Ambient Pad","ambient",["calm","mysterious"]),e.generateAmbientPad("music-cinematic-pad-1","Cinematic Atmosphere","cinematic",["tense","inspiring"]),e.generateAmbientPad("music-dramatic-pad-1","Dramatic Tension","dramatic",["tense","dark"]),e.generateChordProgression("music-pop-chords-1","Pop Chord Progression",120,"pop",["happy","bright"],"pop"),e.generateChordProgression("music-jazz-chords-1","Jazz Chords",100,"jazz",["calm","nostalgic"],"jazz"),e.generateChordProgression("music-lofi-chords-1","Lo-Fi Chords",80,"lofi",["calm","nostalgic"],"lofi"),e.generateChordProgression("music-cinematic-chords-1","Cinematic Chords",90,"cinematic",["tense","inspiring"],"cinematic"),e.generateChordProgression("music-electronic-chords-1","Electronic Chords",128,"electronic",["energetic","dark"],"electronic"),e.generateChordProgression("music-ambient-chords-1","Ambient Chords",70,"ambient",["calm","mysterious"],"ambient"),e.generateChordProgression("music-uplifting-chords-1","Uplifting Anthem",138,"electronic",["energetic","inspiring"],"pop"),e.generateChordProgression("music-future-chords-1","Future Bass Chords",150,"electronic",["energetic","happy"],"electronic"),e.generateMelody("music-pop-melody-1","Pop Melody",120,"pop",["happy","playful"],"major"),e.generateMelody("music-lofi-melody-1","Lo-Fi Melody",85,"lofi",["calm","nostalgic"],"pentatonic"),e.generateMelody("music-electronic-melody-1","Synth Lead",128,"electronic",["energetic"],"minor"),e.generateMelody("music-blues-melody-1","Blues Melody",95,"jazz",["nostalgic"],"blues"),e.generateMelody("music-euphoric-melody-1","Euphoric Lead",140,"electronic",["energetic","inspiring"],"major"),e.generateMelody("music-catchy-melody-1","Catchy Hook",118,"pop",["happy","playful"],"pentatonic"),e.generateMelody("music-tropical-melody-1","Tropical Vibes",100,"pop",["happy","bright"],"major"),e.generateArpeggio("music-electronic-arp-1","Synth Arpeggio",128,"electronic",["energetic","dark"]),e.generateArpeggio("music-ambient-arp-1","Ambient Arpeggio",100,"ambient",["calm","mysterious"]),e.generateArpeggio("music-trance-arp-1","Trance Arpeggio",140,"electronic",["energetic","inspiring"]),e.generateArpeggio("music-edm-arp-1","EDM Pluck",150,"electronic",["energetic","happy"]),e.generateBassline("music-electronic-bass-1","Electronic Bass",128,"electronic",["energetic","dark"]),e.generateBassline("music-hiphop-bass-1","Hip-Hop Bass",90,"hip-hop",["energetic"]),e.generateBassline("music-lofi-bass-1","Lo-Fi Bass",85,"lofi",["calm"]),e.generateBassline("music-dubstep-bass-1","Wobble Bass",140,"electronic",["energetic","dark"]),e.generateBassline("music-funk-bass-1","Funky Slap Bass",110,"upbeat",["happy","playful"]),e.generateDrumLoop("music-electronic-drums-1","Electronic Drums",128,"electronic",["energetic"],"complex"),e.generateDrumLoop("music-hiphop-drums-1","Hip-Hop Drums",90,"hip-hop",["energetic"],"basic"),e.generateDrumLoop("music-lofi-drums-1","Lo-Fi Drums",85,"lofi",["calm"],"minimal"),e.generateDrumLoop("music-pop-drums-1","Pop Drums",120,"pop",["happy"],"basic"),e.generateDrumLoop("music-cinematic-drums-1","Cinematic Drums",100,"cinematic",["tense"],"complex"),e.generateDrumLoop("music-trap-drums-1","Trap Hi-Hats",145,"hip-hop",["energetic","dark"],"complex"),e.generateDrumLoop("music-house-drums-1","Four on Floor",125,"electronic",["energetic","happy"],"basic"),e.generateDrumLoop("music-breakbeat-drums-1","Breakbeat",135,"electronic",["energetic"],"complex"),e.generateFullTrack("music-summer-vibes","Summer Vibes",118,"pop",["happy","bright"]),e.generateFullTrack("music-golden-hour","Golden Hour",110,"pop",["happy","nostalgic"]),e.generateFullTrack("music-feel-good","Feel Good",120,"upbeat",["happy","energetic"]),e.generateFullTrack("music-good-times","Good Times",124,"upbeat",["happy","playful"]),e.generateFullTrack("music-sunshine","Sunshine",116,"upbeat",["happy","bright"]),e.generateFullTrack("music-celebration","Celebration",128,"upbeat",["energetic","happy"]),e.generateFullTrack("music-victory-lap","Victory Lap",130,"upbeat",["energetic","inspiring"]),e.generateFullTrack("music-on-top","On Top",126,"upbeat",["inspiring","energetic"]),e.generateFullTrack("music-rise-up","Rise Up",122,"upbeat",["happy","inspiring"]),e.generateFullTrack("music-lets-go","Let's Go",132,"upbeat",["energetic"]),e.generateFullTrack("music-party-time","Party Time",128,"electronic",["energetic","happy"]),e.generateFullTrack("music-dance-floor","Dance Floor",126,"electronic",["energetic","playful"]),e.generateFullTrack("music-electric-nights","Electric Nights",130,"electronic",["energetic"]),e.generateFullTrack("music-neon-dreams","Neon Dreams",125,"electronic",["energetic","dark"]),e.generateFullTrack("music-future-wave","Future Wave",135,"electronic",["energetic","inspiring"]),e.generateFullTrack("music-beat-drop","Beat Drop",140,"electronic",["energetic"]),e.generateFullTrack("music-bounce","Bounce",95,"hip-hop",["energetic","playful"]),e.generateFullTrack("music-smooth-flow","Smooth Flow",90,"hip-hop",["calm","playful"]),e.generateFullTrack("music-fresh-start","Fresh Start",98,"hip-hop",["happy","energetic"]),e.generateFullTrack("music-street-groove","Street Groove",92,"hip-hop",["energetic"]),e.generateFullTrack("music-hype-mode","Hype Mode",105,"hip-hop",["energetic","happy"]),e.generateFullTrack("music-chill-wave","Chill Wave",85,"lofi",["calm","nostalgic"]),e.generateFullTrack("music-peaceful-mind","Peaceful Mind",80,"lofi",["calm"]),e.generateFullTrack("music-cozy-vibes","Cozy Vibes",82,"lofi",["calm","happy"]),e.generateFullTrack("music-epic-moment","Epic Moment",90,"cinematic",["inspiring","tense"]),e.generateFullTrack("music-new-beginning","New Beginning",95,"cinematic",["inspiring","bright"])],i=await Promise.all([...t,...s]);for(const n of i)this.sounds.set(n.item.id,n.item),this.soundBlobs.set(n.item.id,n.blob);this.initialized=!0}catch(t){console.error("[SoundLibrary] Failed to generate sounds:",t)}}getSoundBlob(e){return this.soundBlobs.get(e)||null}getAllSounds(){return Array.from(this.sounds.values())}getMusic(){return this.getAllSounds().filter(e=>e.category==="music")}getSFX(){return this.getAllSounds().filter(e=>e.category==="sfx")}getByCategory(e){return this.getAllSounds().filter(t=>t.category===e)}getBySubcategory(e){return this.getAllSounds().filter(t=>t.subcategory===e)}search(e){let t=this.getAllSounds();if(e.category&&(t=t.filter(s=>s.category===e.category)),e.subcategory&&(t=t.filter(s=>s.subcategory===e.subcategory)),e.mood&&e.mood.length>0&&(t=t.filter(s=>s.mood?.some(i=>e.mood.includes(i)))),e.minDuration!==void 0&&(t=t.filter(s=>s.duration>=e.minDuration)),e.maxDuration!==void 0&&(t=t.filter(s=>s.duration<=e.maxDuration)),e.minBpm!==void 0&&(t=t.filter(s=>s.bpm&&s.bpm>=e.minBpm)),e.maxBpm!==void 0&&(t=t.filter(s=>s.bpm&&s.bpm<=e.maxBpm)),e.searchQuery){const s=e.searchQuery.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(s)||i.tags.some(n=>n.toLowerCase().includes(s)))}return t}getSound(e){return this.sounds.get(e)||null}async previewSound(e){if(this.stopPreview(),!!e.previewUrl)try{this.audioContext||(this.audioContext=new AudioContext);const s=await(await fetch(e.previewUrl)).arrayBuffer(),i=await this.audioContext.decodeAudioData(s);this.previewSource=this.audioContext.createBufferSource(),this.previewSource.buffer=i,this.previewGain=this.audioContext.createGain(),this.previewGain.gain.value=.7,this.previewSource.connect(this.previewGain),this.previewGain.connect(this.audioContext.destination),this.previewSource.start()}catch(t){console.error("[SoundLibrary] Preview failed:",t)}}stopPreview(){if(this.previewSource){try{this.previewSource.stop()}catch{}this.previewSource.disconnect(),this.previewSource=null}this.previewGain&&(this.previewGain.disconnect(),this.previewGain=null)}async analyzeAudio(e){const t=e.getChannelData(0),s=e.sampleRate,i=this.generateWaveform(t,200),{bpm:n,beats:a}=this.detectBeats(t,s),o=this.detectKey(t,s);return{bpm:n,key:o,beats:a,waveform:i}}generateWaveform(e,t){const s=[],i=Math.floor(e.length/t);for(let n=0;n<t;n++){const a=n*i,o=a+i;let l=0;for(let d=a;d<o&&d<e.length;d++){const u=Math.abs(e[d]);u>l&&(l=u)}s.push(l)}return s}detectBeats(e,t){const s=[],i=Math.floor(t*.02),n=Math.floor(t*.01),a=[];for(let h=0;h<e.length-i;h+=n){let p=0;for(let f=0;f<i;f++)p+=e[h+f]*e[h+f];a.push(p/i)}const o=a.reduce((h,p)=>h+p,0)/a.length,l=o*1.5;let d=-.5;for(let h=1;h<a.length-1;h++){const p=h*n/t;a[h]>l&&a[h]>a[h-1]&&a[h]>a[h+1]&&p-d>.2&&(s.push({time:p,strength:Math.min(a[h]/o,2),type:s.length%4===0?"downbeat":"beat"}),d=p)}let u=120;if(s.length>=4){const h=[];for(let f=1;f<Math.min(s.length,20);f++)h.push(s[f].time-s[f-1].time);const p=h.reduce((f,m)=>f+m,0)/h.length;u=Math.round(60/p),u=Math.max(60,Math.min(200,u))}return{bpm:u,beats:s}}detectKey(e,t){const s=["C Major","G Major","D Major","A Major","E Major","A Minor","E Minor","D Minor","B Minor","F Major"];return s[Math.floor(Math.random()*s.length)]}addCustomSound(e){const t={...e,isBuiltin:!1};return this.sounds.set(t.id,t),t}removeSound(e){const t=this.sounds.get(e);return t&&!t.isBuiltin?(this.sounds.delete(e),!0):!1}dispose(){this.stopPreview(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.sounds.clear()}}let qs=null,Om=null;async function YW(){if(typeof WebAssembly>"u")return null;try{const r=new URL("data:application/wasm;base64,AGFzbQEAAAABNwlgBH9/f38AYAJ/fwF/YAF/AX1gAX8Bf2ADf39/AGAEf39/fwF9YAR/fX9/AX9gAn99AX1gAAACDQEDZW52BWFib3J0AAADDQwABAEBBQIGAgcDAwgFAwEAAQYGAX8BQQALB4kBCRJjb21wdXRlUk1TRW5lcmdpZXMAAQtzbW9vdGhBcnJheQACD2NhbGN1bGF0ZU1lZGlhbgAGCWZpbmRQZWFrcwAHDWNhbGN1bGF0ZU1lYW4ACA9jYWxjdWxhdGVTdGREZXYACQthbGxvY2F0ZUYzMgAKC2FsbG9jYXRlSTMyAAsGbWVtb3J5AgAIAQwMAQgK5gsMmAICAn0JfyAAKAIIQQJ2IQggAygCCEECdiEKQwAAgD8gAbKVIQUDQCAHIApIBEAgAiAHbCEJQwAAAAAhBEEAIQYgAUEEayELA0AgBiALSARAIAYgCWoiDUEDaiIMIAhIBEAgBCAAKAIEIg4gDUECdGoqAgAiBCAElCANQQFqQQJ0IA5qKgIAIgQgBJSSIA1BAmpBAnQgDmoqAgAiBCAElJIgDEECdCAOaioCACIEIASUkpIhBAsgBkEEaiEGDAELCwNAIAEgBkoEQCAGIAlqIgsgCEgEQCAEIAAoAgQgC0ECdGoqAgAiBCAElJIhBAsgBkEBaiEGDAELCyADKAIEIAdBAnRqIAQgBZSROAIAIAdBAWohBwwBCwsLmwECBH8CfSAAKAIIQQJ2IQQgAkEBdSEFQwAAgD8gArKVIQgDQCADIARIBEBDAAAAACEHIAMgBWpBAWohBiADIAVrIQIDQCACIAZIBEAgByAAKAIEIARBAWsgAiACIAROG0EAIAJBAE4bQQJ0aioCAJIhByACQQFqIQIMAQsLIAEoAgQgA0ECdGogByAIlDgCACADQQFqIQMMAQsLC8oBAQZ/IABB7P///wNLBEBBkAlB0AlB1gBBHhAAAAsgAEEQaiIEQfz///8DSwRAQZAJQdAJQSFBHRAAAAsjACEDIwBBBGoiAiAEQRNqQXBxQQRrIgRqIgU/ACIGQRB0QQ9qQXBxIgdLBEAgBiAFIAdrQf//A2pBgIB8cUEQdiIHIAYgB0obQABBAEgEQCAHQABBAEgEQAALCwsgBSQAIAMgBDYCACACQQRrIgNBADYCBCADQQA2AgggAyABNgIMIAMgADYCECACQRBqC2sBAX8gAEUEQEEMQQMQAyEACyAAQQA2AgAgAEEANgIEIABBADYCCCABQf////8ASwRAQaAIQdAIQRNBORAAAAsgAUECdCIBQQEQAyICQQAgAfwLACAAIAI2AgAgACACNgIEIAAgATYCCCAAC4ACAgR/A30gASACRgRAIAAoAgQgAUECdGoqAgAPCyAAKAIEIAJBAnRqKgIAIQkgAUEBayEFIAEhBANAIAIgBEoEQCAAKAIEIgcgBEECdCIGaioCACIKIAlfBEAgBUEBaiIFQQJ0IAdqIgcqAgAhCCAHIAo4AgAgACgCBCAGaiAIOAIACyAEQQFqIQQMAQsLIAAoAgQiBCAFQQFqIgVBAnRqIgYqAgAhCCAGIAJBAnQiBiAEaioCADgCACAAKAIEIAZqIAg4AgAgAyAFRgR9IAAoAgQgA0ECdGoqAgAFIAMgBUgEfSAAIAEgBUEBayADEAUFIAAgBUEBaiACIAMQBQsLC5MBAQR/IAAoAghBAnYiBEUEQEMAAAAADwtBDEEEEAMgBBAEIQEDQCACIARIBEAgAkECdCIDIAEoAgRqIAMgACgCBGoqAgA4AgAgAkEBaiECDAELCyAEQQF2IQAgBEEBcQR9IAFBACAEQQFrIAAQBQUgAUEAIARBAWsiAiAAQQFrEAUgAUEAIAIgABAFkkMAAAA/lAsLogECBX8BfSAAKAIIQQJ2IQZBACACayEEQQEhBQNAIAUgBkEBa0gEQCAAKAIEIgcgBUECdGoqAgAiCSAFQQFqQQJ0IAdqKgIAXiAJIAVBAWtBAnQgB2oqAgBecSABIAldcSAFIARrIAJOcQRAIAggAygCCEECdkgEQCADKAIEIAhBAnRqIAU2AgAgCEEBaiEIIAUhBAsLIAVBAWohBQwBCwsgCAtHAgJ/AX0gACgCCEECdiICRQRAQwAAAAAPCwNAIAEgAkgEQCADIAAoAgQgAUECdGoqAgCSIQMgAUEBaiEBDAELCyADIAKylQtQAgF9An8gACgCCEECdiIERQRAQwAAAAAPCwNAIAMgBEgEQCACIAAoAgQgA0ECdGoqAgAgAZMiAiAClJIhAiADQQFqIQMMAQsLIAIgBLKVkQsMAEEMQQQQAyAAEAQLDABBDEEFEAMgABAECwcAQfwJJAALC9kBCABBjAgLASwAQZgICyMCAAAAHAAAAEkAbgB2AGEAbABpAGQAIABsAGUAbgBnAHQAaABBvAgLATwAQcgICy0CAAAAJgAAAH4AbABpAGIALwBhAHIAcgBhAHkAYgB1AGYAZgBlAHIALgB0AHMAQfwICwE8AEGICQsvAgAAACgAAABBAGwAbABvAGMAYQB0AGkAbwBuACAAdABvAG8AIABsAGEAcgBnAGUAQbwJCwE8AEHICQslAgAAAB4AAAB+AGwAaQBiAC8AcgB0AC8AcwB0AHUAYgAuAHQAcw==",import.meta.url),e=await fetch(r);if(!e.ok)return null;const t=await e.arrayBuffer(),{instance:s}=await WebAssembly.instantiate(t,{env:{abort:()=>{throw new Error("WASM abort")}}});return s.exports}catch{return null}}async function jM(){return qs?!0:(Om||(Om=YW()),qs=await Om,qs!==null)}function qW(r,e,t,s){const i=r.length,n=s.length,a=1/e;for(let o=0;o<n;o++){const l=o*t;let d=0;for(let u=0;u<e&&l+u<i;u++){const h=r[l+u];d+=h*h}s[o]=Math.sqrt(d*a)}}function HW(r,e,t){const s=r.length,i=t>>1,n=1/t;for(let a=0;a<s;a++){let o=0;const l=a-i,d=a+i+1;for(let u=l;u<d;u++){const h=Math.max(0,Math.min(s-1,u));o+=r[h]}e[a]=o*n}}function XW(r){if(r.length===0)return 0;const e=Float32Array.from(r).sort((s,i)=>s-i),t=r.length>>1;return(r.length&1)===1?e[t]:(e[t-1]+e[t])*.5}function KW(r,e,t,s){const i=r.length;let n=0,a=-t;for(let o=1;o<i-1;o++){const l=r[o],d=r[o-1],u=r[o+1];l>d&&l>u&&l>e&&o-a>=t&&n<s.length&&(s[n]=o,n++,a=o)}return n}function QW(r){if(r.length===0)return 0;let e=0;for(let t=0;t<r.length;t++)e+=r[t];return e/r.length}function JW(r,e){if(r.length===0)return 0;let t=0;for(let s=0;s<r.length;s++){const i=r[s]-e;t+=i*i}return Math.sqrt(t/r.length)}class ZW{useWasm;constructor(){this.useWasm=qs!==null}async ensureWasm(){return this.useWasm?!0:(await jM()&&(this.useWasm=!0),this.useWasm)}computeRMSEnergies(e,t,s,i){this.useWasm&&qs?qs.computeRMSEnergies(e,t,s,i):qW(e,t,s,i)}smoothArray(e,t,s){this.useWasm&&qs?qs.smoothArray(e,t,s):HW(e,t,s)}calculateMedian(e){return this.useWasm&&qs?qs.calculateMedian(e):XW(e)}findPeaks(e,t,s,i){return this.useWasm&&qs?qs.findPeaks(e,t,s,i):KW(e,t,s,i)}calculateMean(e){return this.useWasm&&qs?qs.calculateMean(e):QW(e)}calculateStdDev(e,t){return this.useWasm&&qs?qs.calculateStdDev(e,t):JW(e,t)}}let $m=null;function eY(){return $m||($m=new ZW),$m}const tY={minBpm:60,maxBpm:200,sensitivity:.5,windowSize:2048,hopSize:512};class sY{config;audioContext=null;wasmProcessor;wasmInitialized=!1;constructor(e={}){this.config={...tY,...e},this.wasmProcessor=eY(),this.initWasm()}async initWasm(){if(!this.wasmInitialized)try{await jM(),await this.wasmProcessor.ensureWasm(),this.wasmInitialized=!0}catch{this.wasmInitialized=!1}}async analyzeAudioBuffer(e){const t=e.getChannelData(0),s=e.sampleRate,i=e.duration,n=this.detectOnsets(t,s),{bpm:a,confidence:o}=this.calculateBpm(n,i),l=this.generateBeats(a,i,n),d=this.detectDownbeats(l);return{bpm:a,confidence:o,beats:l,duration:i,downbeats:d}}async analyzeFromBlob(e){this.audioContext||(this.audioContext=new AudioContext);const t=await e.arrayBuffer(),s=await this.audioContext.decodeAudioData(t);return this.analyzeAudioBuffer(s)}async analyzeFromUrl(e){const s=await(await fetch(e)).blob();return this.analyzeFromBlob(s)}detectOnsets(e,t){const{windowSize:s,hopSize:i,sensitivity:n}=this.config,a=[],o=Math.floor((e.length-s)/i),l=new Float32Array(o);this.wasmProcessor.computeRMSEnergies(e,s,i,l);const d=new Float32Array(o);this.wasmProcessor.smoothArray(l,d,5);const u=Array.from(d),h=this.calculateAdaptiveThreshold(u,n);let p=-10;const f=Math.floor(t/i*.1);for(let m=1;m<u.length-1;m++){const g=u[m],y=u[m-1],x=h[m],b=g>u[m-1]&&g>=u[m+1],w=g>x,C=g-y>x*.3,k=m-p>=f;if(b&&w&&C&&k){const S=m*i/t;a.push(S),p=m}}return a}calculateAdaptiveThreshold(e,t){const i=[];for(let n=0;n<e.length;n++){const a=Math.max(0,n-50),o=Math.min(e.length,n+50),l=new Float32Array(e.slice(a,o)),d=this.wasmProcessor.calculateMedian(l),u=this.wasmProcessor.calculateMean(l),h=d+(u-d)*(1-t);i.push(h*(1.5-t*.5))}return i}calculateBpm(e,t){if(e.length<4)return{bpm:120,confidence:0};const s=[];for(let y=1;y<e.length;y++)s.push(e[y]-e[y-1]);const{minBpm:i,maxBpm:n}=this.config,a=60/n,o=60/i,l=s.filter(y=>y>=a&&y<=o);if(l.length<3)return{bpm:120,confidence:0};const d=new Map,u=1;for(const y of l){const x=Math.round(60/y/u)*u;x>=i&&x<=n&&d.set(x,(d.get(x)||0)+1);const b=Math.round(120/y/u)*u;b>=i&&b<=n&&d.set(b,(d.get(b)||0)+.5);const w=Math.round(30/y/u)*u;w>=i&&w<=n&&d.set(w,(d.get(w)||0)+.3)}let h=120,p=0;for(const[y,x]of d)x>p&&(p=x,h=y);const f=t*h/60,m=e.length,g=Math.min(1,Math.max(0,1-Math.abs(f-m)/f));return{bpm:h,confidence:g}}generateBeats(e,t,s){const i=60/e,n=[];let a=0;if(s.length>0){const l=s[0],d=Math.round(l/i);for(a=l-d*i;a<0;)a+=i}let o=0;for(let l=a;l<t;l+=i){const d=this.findNearestOnset(l,s,i*.3),u=d!==null?1:.5;n.push({time:d!==null?d:l,strength:u,index:o}),o++}return n}findNearestOnset(e,t,s){let i=null,n=s;for(const a of t){const o=Math.abs(a-e);o<n&&(n=o,i=a)}return i}detectDownbeats(e){if(e.length<4)return e.filter((i,n)=>n%4===0).map(i=>i.time);const t=[],s=e.filter(i=>i.strength>.7);if(s.length>0){const i=s[0],n=e.findIndex(a=>a.time===i.time);for(let a=n;a<e.length;a+=4)t.push(e[a].time)}else for(let i=0;i<e.length;i+=4)t.push(e[i].time);return t}generateBeatMarkersAtInterval(e,t,s=0,i=4){const n=60/e,a=[];let o=0;for(let l=s;l<t;l+=n){const d=o%i===0;a.push({time:l,strength:d?1:.7,index:o}),o++}return a}snapTimeToNearestBeat(e,t,s=.1){if(t.length===0)return e;let i=t[0],n=Math.abs(t[0].time-e);for(const a of t){const o=Math.abs(a.time-e);o<n&&(n=o,i=a)}return n<=s?i.time:e}getBeatsInRange(e,t,s){return e.filter(i=>i.time>=t&&i.time<=s)}dispose(){this.audioContext&&this.audioContext instanceof AudioContext&&(this.audioContext.close(),this.audioContext=null)}}let zm=null;function _M(){return zm||(zm=new sY),zm}const iY={frameRate:30,audioBufferSize:4096,frameBufferAhead:5,audioLookahead:.1,frameRenderTimeout:100,enableAudio:!0,enableVideo:!0};class rY{videoEngine=null;audioEngine=null;project=null;config;masterClock;clockUnsubscribe=null;realtimeAudioGraph;state="stopped";playbackRate=1;useRealtimeAudio=!0;currentFrame=null;frameRenderTimes=[];droppedFrames=0;scrubDebounceTimer=null;isScrubbing=!1;isRenderingFrame=!1;eventListeners=new Map;displayCanvas=null;displayCtx=null;constructor(e={}){this.config={...iY,...e},this.masterClock=OW({frameRate:this.config.frameRate}),this.realtimeAudioGraph=$W(this.masterClock)}async initialize(e,t){this.videoEngine=e,this.audioEngine=t,this.setupClockSubscription()}getRealtimeAudioGraph(){return this.realtimeAudioGraph}setupClockSubscription(){this.clockUnsubscribe&&this.clockUnsubscribe();const e={onTimeUpdate:t=>{this.handleClockTimeUpdate(t)},onStateChange:t=>{this.handleClockStateChange(t)}};this.clockUnsubscribe=this.masterClock.subscribe(e)}handleClockTimeUpdate(e){if(!(this.state!=="playing"||this.isRenderingFrame)){if(this.project&&this.project.timeline.duration>0&&e>=this.project.timeline.duration){this.pause();return}if(this.masterClock.shouldSkipFrame()){this.droppedFrames++;return}if(this.masterClock.shouldRepeatFrame()){this.emitEvent({type:"timeupdate",time:e,state:this.state});return}this.renderFrameAtTime(e),this.emitEvent({type:"timeupdate",time:e,state:this.state})}}handleClockStateChange(e){const t=this.state;e==="stopped"&&(this.state="stopped",this.stopAudioPlayback(),t!=="stopped"&&(this.emitEvent({type:"stop",time:0,state:this.state}),this.emitEvent({type:"statechange",time:0,state:this.state})))}getMasterClock(){return this.masterClock}setProject(e){this.project=e,this.state="stopped";const t=e.timeline.duration;this.masterClock.setDuration(t),this.clearAudioBuffer()}setDisplayCanvas(e){this.displayCanvas=e,this.displayCtx=e.getContext("2d")}getState(){return this.state}getCurrentTime(){return this.masterClock.currentTime}getCurrentFrame(){return this.currentFrame}isPlaying(){return this.state==="playing"}getIsScrubbing(){return this.isScrubbing}async play(){if(!this.project||!this.videoEngine)throw new Error("PlaybackController not properly initialized");if(this.state==="playing")return;const e=this.project.timeline.duration;this.masterClock.currentTime>=e&&this.masterClock.seek(0),this.state="playing",await this.preloadAudioBuffers(),await this.masterClock.play(),await this.startAudioPlayback();const t=this.masterClock.currentTime;this.emitEvent({type:"play",time:t,state:this.state}),this.emitEvent({type:"statechange",time:t,state:this.state})}pause(){if(this.state!=="playing")return;this.state="paused",this.masterClock.pause(),this.stopAudioPlayback();const e=this.masterClock.currentTime;this.emitEvent({type:"pause",time:e,state:this.state}),this.emitEvent({type:"statechange",time:e,state:this.state})}stop(){const e=this.state;this.state="stopped",this.masterClock.stop(),this.stopAudioPlayback(),this.emitEvent({type:"stop",time:0,state:this.state}),e!==this.state&&this.emitEvent({type:"statechange",time:0,state:this.state})}async togglePlayback(){this.state==="playing"?this.pause():await this.play()}async seek(e){if(!this.project)return;const t=this.state==="playing",s=this.project.timeline.duration,i=Math.max(0,Math.min(e,s));this.masterClock.seek(i),this.realtimeAudioGraph.seekTo(i),t&&(this.stopAudioPlayback(),await this.startAudioPlayback()),await this.renderFrameAtTime(i),this.emitEvent({type:"seek",time:i,state:this.state})}startScrubbing(){this.isScrubbing=!0,this.state==="playing"&&this.pause()}async scrubTo(e){if(!this.project||!this.videoEngine)return{frame:null,renderTime:0,fromCache:!1,timedOut:!1};const t=this.project.timeline.duration,s=Math.max(0,Math.min(e,t));return this.masterClock.seek(s),this.realtimeAudioGraph.seekTo(s),this.emitEvent({type:"timeupdate",time:s,state:this.state}),this.renderFrameWithTimeout(s)}endScrubbing(){this.isScrubbing=!1,this.scrubDebounceTimer&&(clearTimeout(this.scrubDebounceTimer),this.scrubDebounceTimer=null)}setPlaybackRate(e){this.playbackRate=Math.max(.1,Math.min(4,e)),this.masterClock.setPlaybackRate(this.playbackRate)}getPlaybackRate(){return this.playbackRate}getStats(){const e=this.frameRenderTimes.length>0?this.frameRenderTimes.reduce((t,s)=>t+s,0)/this.frameRenderTimes.length:0;return{currentTime:this.masterClock.currentTime,duration:this.project?.timeline.duration??0,state:this.state,fps:this.calculateFPS(),droppedFrames:this.droppedFrames,audioBufferHealth:this.calculateAudioBufferHealth(),videoBufferHealth:1,avgFrameRenderTime:e}}addEventListener(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e).add(t)}removeEventListener(e,t){this.eventListeners.get(e)?.delete(t)}dispose(){this.stop(),this.clockUnsubscribe&&(this.clockUnsubscribe(),this.clockUnsubscribe=null),this.masterClock.dispose(),this.realtimeAudioGraph.dispose(),this.clearAudioBuffer(),this.eventListeners.clear(),this.currentFrame?.image.close(),this.currentFrame=null,this.displayCanvas=null,this.displayCtx=null,this.videoEngine=null,this.audioEngine=null,this.project=null}async renderFrameAtTime(e){if(!this.project||!this.videoEngine||this.isRenderingFrame)return;this.isRenderingFrame=!0;const t=performance.now();try{const s=await this.videoEngine.renderFrame(this.project,e),i=performance.now()-t;this.trackFrameRenderTime(i),this.masterClock.reportVideoTime(e),this.currentFrame&&this.currentFrame!==s&&this.currentFrame.image.close(),this.currentFrame=s,this.drawFrameToCanvas(s),this.emitEvent({type:"framerendered",time:e,state:this.state,frame:s})}catch(s){console.error("Frame render error:",s),this.droppedFrames++}finally{this.isRenderingFrame=!1}}async renderFrameWithTimeout(e){if(!this.project||!this.videoEngine)return{frame:null,renderTime:0,fromCache:!1,timedOut:!1};const t=performance.now();try{const s=new Promise((a,o)=>{setTimeout(()=>{o(new Error("Frame render timeout"))},this.config.frameRenderTimeout)}),i=await Promise.race([this.videoEngine.renderFrame(this.project,e),s]),n=performance.now()-t;return this.trackFrameRenderTime(n),this.currentFrame&&this.currentFrame!==i&&this.currentFrame.image.close(),this.currentFrame=i,this.drawFrameToCanvas(i),{frame:i,renderTime:n,fromCache:!1,timedOut:!1}}catch(s){const i=performance.now()-t;return s instanceof Error&&s.message==="Frame render timeout"?{frame:null,renderTime:i,fromCache:!1,timedOut:!0}:(console.error("Frame render error:",s),{frame:null,renderTime:i,fromCache:!1,timedOut:!1})}}drawFrameToCanvas(e){!this.displayCanvas||!this.displayCtx||((this.displayCanvas.width!==e.width||this.displayCanvas.height!==e.height)&&(this.displayCanvas.width=e.width,this.displayCanvas.height=e.height),this.displayCtx.drawImage(e.image,0,0))}async startAudioPlayback(){!this.config.enableAudio||!this.project||this.useRealtimeAudio&&(await this.realtimeAudioGraph.resume(),this.setupTracksInAudioGraph(),this.realtimeAudioGraph.startScheduler(e=>this.getAudioClipsAtTime(e)))}setupTracksInAudioGraph(){if(!this.project)return;const e=this.project.timeline.tracks.some(t=>t.solo);for(const t of this.project.timeline.tracks)t.type!=="audio"&&t.type!=="video"||(this.realtimeAudioGraph.createTrack({trackId:t.id,volume:1,pan:0,muted:t.muted,solo:t.solo,effects:[]}),e&&this.realtimeAudioGraph.setTrackSolo(t.id,t.solo))}getAudioClipsAtTime(e){if(!this.project||!this.audioEngine)return[];const t=[],{timeline:s,mediaLibrary:i}=this.project;for(const n of s.tracks)if(!(n.type!=="audio"&&n.type!=="video"))for(const a of n.clips){const o=a.startTime+a.duration;if(o<=e||a.startTime>e+1)continue;const l=i.items.find(u=>u.id===a.mediaId);if(!l?.blob)continue;const d=this.getOrDecodeAudioBuffer(l);d&&t.push({clipId:a.id,trackId:n.id,audioBuffer:d,startTime:a.startTime,endTime:o,mediaOffset:a.inPoint,volume:a.volume,pan:0,effects:a.audioEffects||[],speed:a.speed??1})}return t}audioBufferCache=new Map;audioDecodePromises=new Map;async preloadAudioBuffers(){if(!this.project)return;const{timeline:e,mediaLibrary:t}=this.project,s=new Set;for(const n of e.tracks)if(!(n.type!=="audio"&&n.type!=="video"))for(const a of n.clips){const o=t.items.find(l=>l.id===a.mediaId);o?.blob&&!this.audioBufferCache.has(o.id)&&s.add(o.id)}const i=[];for(const n of s){const a=t.items.find(o=>o.id===n);a?.blob&&i.push(this.decodeAudioBuffer(a))}await Promise.all(i)}async decodeAudioBuffer(e){if(this.audioBufferCache.has(e.id))return this.audioBufferCache.get(e.id)||null;if(this.audioDecodePromises.has(e.id))return this.audioDecodePromises.get(e.id)||null;if(!e.blob)return null;const t=this.masterClock.getAudioContext(),s=e.blob.arrayBuffer().then(i=>t.decodeAudioData(i)).then(i=>(this.audioBufferCache.set(e.id,i),this.audioDecodePromises.delete(e.id),i)).catch(()=>(this.audioDecodePromises.delete(e.id),null));return this.audioDecodePromises.set(e.id,s),s}getOrDecodeAudioBuffer(e){const t=this.audioBufferCache.get(e.id);return t||(e.blob&&this.decodeAudioBuffer(e),null)}stopAudioPlayback(){this.useRealtimeAudio&&this.realtimeAudioGraph.stopScheduler()}clearAudioBuffer(){this.stopAudioPlayback(),this.audioBufferCache.clear()}trackFrameRenderTime(e){this.frameRenderTimes.push(e),this.frameRenderTimes.length>60&&this.frameRenderTimes.shift()}calculateFPS(){if(this.frameRenderTimes.length<2)return 0;const e=this.frameRenderTimes.reduce((t,s)=>t+s,0)/this.frameRenderTimes.length;return e>0?1e3/e:0}calculateAudioBufferHealth(){return 1}emitEvent(e){const t=this.eventListeners.get(e.type);if(t)for(const i of t)try{i(e)}catch(n){console.error("Event listener error:",n)}const s=this.eventListeners.get("all");if(s)for(const i of s)try{i(e)}catch(n){console.error("Event listener error:",n)}}}let Vm=null;function nY(){return Vm||(Vm=new rY),Vm}const jb={fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"bottom"},Um={default:jb,classic:{fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"bottom"},modern:{fontFamily:"Helvetica Neue",fontSize:28,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.5)",position:"bottom"},cinematic:{fontFamily:"Georgia",fontSize:26,color:"#f0f0f0",backgroundColor:"transparent",position:"bottom"},bold:{fontFamily:"Impact",fontSize:32,color:"#ffff00",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"bottom"},minimal:{fontFamily:"Roboto",fontSize:22,color:"#ffffff",backgroundColor:"transparent",position:"bottom"},topCenter:{fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"top"},centered:{fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.75)",position:"center"}};function ny(){return`subtitle-${Date.now()}-${Math.random().toString(36).slice(2,11)}`}function vC(r){const e=r.trim().match(/^(\d{1,2}):(\d{2}):(\d{2})[,.](\d{3})$/);if(!e)return null;const t=parseInt(e[1],10),s=parseInt(e[2],10),i=parseInt(e[3],10),n=parseInt(e[4],10);return s>=60||i>=60?null:t*3600+s*60+i+n/1e3}function wC(r){(r<0||!isFinite(r))&&(r=0);const e=Math.round(r*1e3),t=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4),i=Math.floor(e%6e4/1e3),n=e%1e3;return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")},${n.toString().padStart(3,"0")}`}function aY(r){const e=[],t=[],i=r.replace(/\r\n/g,`
`).replace(/\r/g,`
`).split(/\n\n+/).filter(a=>a.trim());let n=1;for(let a=0;a<i.length;a++){const o=i[a].trim(),l=o.split(`
`);if(l.length<2){t.push({line:n,message:"Invalid subtitle block: insufficient lines",segment:a+1}),n+=o.split(`
`).length+1;continue}const d=l[0].trim(),u=parseInt(d,10);if(isNaN(u)){t.push({line:n,message:`Invalid subtitle index: "${d}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}const h=l[1].trim(),p=h.match(/^(.+?)\s*-->\s*(.+?)(?:\s+.*)?$/);if(!p){t.push({line:n+1,message:`Invalid timestamp format: "${h}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}const f=vC(p[1]),m=vC(p[2]);if(f===null){t.push({line:n+1,message:`Invalid start timestamp: "${p[1]}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}if(m===null){t.push({line:n+1,message:`Invalid end timestamp: "${p[2]}"`,segment:a+1}),n+=o.split(`
`).length+1;continue}if(m<=f){t.push({line:n+1,message:"End time must be greater than start time",segment:a+1}),n+=o.split(`
`).length+1;continue}const g=l.slice(2).join(`
`).trim();if(!g){t.push({line:n+2,message:"Empty subtitle text",segment:a+1}),n+=o.split(`
`).length+1;continue}e.push({id:ny(),text:g,startTime:f,endTime:m,style:jb}),n+=o.split(`
`).length+1}return{success:t.length===0,subtitles:e,errors:t}}function oY(r){const e=[...r].sort((s,i)=>s.startTime-i.startTime),t=[];for(let s=0;s<e.length;s++){const i=e[s],n=s+1,a=wC(i.startTime),o=wC(i.endTime);t.push(`${n}
${a} --> ${o}
${i.text}`)}return t.join(`

`)}class cY{importSRT(e,t){const s=aY(t);return{timeline:{...e,subtitles:[...e.subtitles,...s.subtitles]},result:s}}exportSRT(e){return oY(e.subtitles)}addSubtitle(e,t,s,i,n){if(i<=s)return{error:"End time must be greater than start time"};if(s<0)return{error:"Start time cannot be negative"};const a={id:ny(),text:t,startTime:s,endTime:i,style:n||jb};return{timeline:{...e,subtitles:[...e.subtitles,a]},subtitle:a}}updateSubtitle(e,t,s){const i=e.subtitles.findIndex(h=>h.id===t);if(i===-1)return{error:"Subtitle not found"};const n=e.subtitles[i],a=s.startTime??n.startTime,o=s.endTime??n.endTime;if(o<=a)return{error:"End time must be greater than start time"};if(a<0)return{error:"Start time cannot be negative"};const l={...n,text:s.text??n.text,startTime:a,endTime:o},d=[...e.subtitles];return d[i]=l,{timeline:{...e,subtitles:d},subtitle:l}}removeSubtitle(e,t){return e.subtitles.findIndex(n=>n.id===t)===-1?{error:"Subtitle not found"}:{timeline:{...e,subtitles:e.subtitles.filter(n=>n.id!==t)}}}setGlobalStyle(e,t){return{...e,subtitles:e.subtitles.map(s=>({...s,style:t}))}}setSubtitleStyle(e,t,s){const i=e.subtitles.findIndex(a=>a.id===t);if(i===-1)return{error:"Subtitle not found"};const n=[...e.subtitles];return n[i]={...n[i],style:s},{timeline:{...e,subtitles:n}}}getSubtitleAtTime(e,t){return e.subtitles.find(s=>t>=s.startTime&&t<s.endTime)||null}getSubtitlesInRange(e,t,s){return e.subtitles.filter(i=>i.endTime>t&&i.startTime<s)}getSortedSubtitles(e){return[...e.subtitles].sort((t,s)=>t.startTime-s.startTime)}shiftAllSubtitles(e,t){return{...e,subtitles:e.subtitles.map(s=>({...s,startTime:Math.max(0,s.startTime+t),endTime:Math.max(.001,s.endTime+t)}))}}applyStylePreset(e,t){const s=Um[t];return s?{timeline:this.setGlobalStyle(e,s)}:{error:`Unknown style preset: ${t}`}}mergeAdjacentSubtitles(e,t=.1){const s=this.getSortedSubtitles(e);if(s.length<=1)return e;const i=[];let n={...s[0]};for(let a=1;a<s.length;a++){const o=s[a];o.startTime<=n.endTime+t?n={...n,text:n.text+`
`+o.text,endTime:Math.max(n.endTime,o.endTime)}:(i.push(n),n={...o})}return i.push(n),{...e,subtitles:i}}splitSubtitle(e,t,s){const i=e.subtitles.find(l=>l.id===t);if(!i)return{error:"Subtitle not found"};if(s<=i.startTime||s>=i.endTime)return{error:"Split time must be within subtitle duration"};const n={...i,endTime:s},a={...i,id:ny(),startTime:s},o=e.subtitles.filter(l=>l.id!==t);return o.push(n,a),{timeline:{...e,subtitles:o},subtitles:[n,a]}}clearAllSubtitles(e){return{...e,subtitles:[]}}getStylePresets(){return Object.keys(Um)}getStylePreset(e){return Um[e]}}const lY=[{code:"en-US",name:"English (US)"},{code:"en-GB",name:"English (UK)"},{code:"es-ES",name:"Spanish (Spain)"},{code:"es-MX",name:"Spanish (Mexico)"},{code:"fr-FR",name:"French"},{code:"de-DE",name:"German"},{code:"it-IT",name:"Italian"},{code:"pt-BR",name:"Portuguese (Brazil)"},{code:"pt-PT",name:"Portuguese (Portugal)"},{code:"ja-JP",name:"Japanese"},{code:"ko-KR",name:"Korean"},{code:"zh-CN",name:"Chinese (Simplified)"},{code:"zh-TW",name:"Chinese (Traditional)"},{code:"ru-RU",name:"Russian"},{code:"ar-SA",name:"Arabic"},{code:"hi-IN",name:"Hindi"},{code:"nl-NL",name:"Dutch"},{code:"pl-PL",name:"Polish"},{code:"sv-SE",name:"Swedish"},{code:"da-DK",name:"Danish"},{code:"fi-FI",name:"Finnish"},{code:"no-NO",name:"Norwegian"},{code:"tr-TR",name:"Turkish"},{code:"th-TH",name:"Thai"},{code:"vi-VN",name:"Vietnamese"},{code:"id-ID",name:"Indonesian"},{code:"ms-MY",name:"Malay"},{code:"el-GR",name:"Greek"},{code:"cs-CZ",name:"Czech"},{code:"ro-RO",name:"Romanian"},{code:"hu-HU",name:"Hungarian"},{code:"uk-UA",name:"Ukrainian"},{code:"he-IL",name:"Hebrew"}],dY={language:"en-US",continuous:!0,interimResults:!1,maxAlternatives:1},uY={fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.7)",position:"bottom"};class _b{recognition=null;audioContext=null;mediaSource=null;segments=[];isTranscribing=!1;currentOptions=dY;progressCallback=null;segmentCallback=null;startTime=0;segmentStartTime=0;static isSupported(){return typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)}static getSupportedLanguages(){return[...lY]}constructor(){this.initRecognition()}initRecognition(){if(!_b.isSupported())return;const e=window.SpeechRecognition||window.webkitSpeechRecognition;e&&(this.recognition=new e,this.setupRecognitionHandlers())}setupRecognitionHandlers(){this.recognition&&(this.recognition.onresult=e=>{const t=e.results[e.results.length-1];if(!t.isFinal)return;const s=t[0].transcript.trim();if(!s)return;const i=this.getCurrentTime(),n={text:s,startTime:this.segmentStartTime,endTime:i,confidence:t[0].confidence};this.segments.push(n),this.segmentStartTime=i,this.segmentCallback&&this.segmentCallback(n),this.reportProgress("transcribing")},this.recognition.onerror=e=>{e.error==="no-speech"||e.error==="aborted"||console.error("Speech recognition error:",e.error)},this.recognition.onend=()=>{if(this.isTranscribing&&this.recognition)try{this.recognition.start()}catch{this.isTranscribing=!1,this.reportProgress("completed")}})}getCurrentTime(){return(performance.now()-this.startTime)/1e3}reportProgress(e){this.progressCallback&&this.progressCallback({status:e,progress:e==="completed"?100:50,currentTime:this.getCurrentTime(),totalDuration:0,segmentsFound:this.segments.length})}setOptions(e){this.currentOptions={...this.currentOptions,...e},this.applyOptions()}applyOptions(){this.recognition&&(this.recognition.lang=this.currentOptions.language,this.recognition.continuous=this.currentOptions.continuous,this.recognition.interimResults=this.currentOptions.interimResults,this.recognition.maxAlternatives=this.currentOptions.maxAlternatives)}onProgress(e){this.progressCallback=e}onSegment(e){this.segmentCallback=e}async startLiveTranscription(){if(!this.recognition)throw new Error("Speech recognition not supported in this browser");if(!this.isTranscribing){this.segments=[],this.isTranscribing=!0,this.startTime=performance.now(),this.segmentStartTime=0,this.applyOptions(),this.reportProgress("transcribing");try{this.recognition.start()}catch(e){throw this.isTranscribing=!1,e}}}stopTranscription(){if(!this.isTranscribing)return{success:!0,segments:this.segments,language:this.currentOptions.language};if(this.isTranscribing=!1,this.recognition)try{this.recognition.stop()}catch{}return this.reportProgress("completed"),{success:!0,segments:[...this.segments],language:this.currentOptions.language}}async transcribeAudioElement(e,t=0,s){return this.recognition?new Promise(i=>{this.segments=[],this.isTranscribing=!0,this.startTime=performance.now(),this.segmentStartTime=t;const n=()=>{o(),i(this.stopTranscription())},a=()=>{s&&e.currentTime>=t+s&&n()},o=()=>{e.removeEventListener("ended",n),e.removeEventListener("timeupdate",a)};if(e.addEventListener("ended",n),e.addEventListener("timeupdate",a),this.applyOptions(),this.reportProgress("transcribing"),e.currentTime=t,e.play().catch(()=>{o(),i({success:!1,segments:[],error:"Failed to play audio for transcription"})}),!this.recognition){o(),i({success:!1,segments:[],error:"Speech recognition not available"});return}try{this.recognition.start()}catch{o(),i({success:!1,segments:[],error:"Failed to start speech recognition"})}}):{success:!1,segments:[],error:"Speech recognition not supported. Try Chrome or Edge browser."}}segmentsToSubtitles(e,t){const s={...uY,...t};return e.map((i,n)=>({id:`auto-caption-${Date.now()}-${n}`,text:i.text,startTime:i.startTime,endTime:i.endTime,style:s}))}getSegments(){return[...this.segments]}clearSegments(){this.segments=[]}isActive(){return this.isTranscribing}dispose(){this.stopTranscription(),this.mediaSource&&(this.mediaSource.disconnect(),this.mediaSource=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.recognition=null,this.progressCallback=null,this.segmentCallback=null}}const kC={fontFamily:"Arial",fontSize:24,color:"#ffffff",backgroundColor:"rgba(0, 0, 0, 0.7)",position:"bottom"};class hY{config;audioContext=null;constructor(e){this.config={maxSegmentDuration:5,maxWordsPerSegment:10,...e}}async transcribeClip(e,t,s){try{s?.({phase:"extracting",progress:0,message:"Extracting audio from video..."});const i=await this.extractAudioFromClip(e,t);s?.({phase:"uploading",progress:25,message:"Uploading audio for transcription..."});const n=await this.sendToWhisper(i,s);s?.({phase:"processing",progress:90,message:"Processing transcription..."});const a=this.convertToSubtitles(n,e);return s?.({phase:"complete",progress:100,message:`Generated ${a.length} subtitles`}),a}catch(i){throw s?.({phase:"error",progress:0,message:i instanceof Error?i.message:"Transcription failed"}),i}}async extractAudioFromClip(e,t){this.audioContext||(this.audioContext=new AudioContext);let s;if(t.blob)s=await t.blob.arrayBuffer();else if(t.fileHandle)s=await(await t.fileHandle.getFile()).arrayBuffer();else throw new Error("No media source available for audio extraction");const i=await this.audioContext.decodeAudioData(s),n=e.inPoint||0,a=e.outPoint||i.duration,o=Math.min(a-n,e.duration),l=i.sampleRate,d=Math.floor(n*l),h=Math.floor((n+o)*l)-d,p=new OfflineAudioContext(1,h,l),f=p.createBufferSource(),m=p.createBuffer(1,h,l),g=m.getChannelData(0),y=i.getChannelData(0);for(let b=0;b<h;b++)g[b]=y[d+b]||0;f.buffer=m,f.connect(p.destination),f.start(0);const x=await p.startRendering();return this.audioBufferToWav(x)}audioBufferToWav(e){const t=e.numberOfChannels,s=e.sampleRate,i=1,n=16,a=n/8,o=t*a,l=s*o,d=e.length*o,h=44+d,p=new ArrayBuffer(h),f=new DataView(p),m=(x,b)=>{for(let w=0;w<b.length;w++)f.setUint8(x+w,b.charCodeAt(w))};m(0,"RIFF"),f.setUint32(4,h-8,!0),m(8,"WAVE"),m(12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,i,!0),f.setUint16(22,t,!0),f.setUint32(24,s,!0),f.setUint32(28,l,!0),f.setUint16(32,o,!0),f.setUint16(34,n,!0),m(36,"data"),f.setUint32(40,d,!0);const g=e.getChannelData(0);let y=44;for(let x=0;x<e.length;x++){const b=Math.max(-1,Math.min(1,g[x])),w=b<0?b*32768:b*32767;f.setInt16(y,w,!0),y+=2}return new Blob([p],{type:"audio/wav"})}async sendToWhisper(e,t){const s=new FormData;s.append("audio",e,"audio.wav"),t?.({phase:"transcribing",progress:50,message:"Transcribing audio..."});const i=await fetch(this.config.apiEndpoint,{method:"POST",body:s});if(!i.ok){if(i.status===429)throw new Error("Rate limit reached. Please wait a minute before transcribing more audio. This free service is limited to 10 requests per minute.");const n=await i.text();throw new Error(`Transcription failed: ${i.status} - ${n}`)}return i.json()}convertToSubtitles(e,t){return!e.words||e.words.length===0?e.text?[{id:this.generateId(),text:e.text.trim(),startTime:t.startTime,endTime:t.startTime+t.duration,style:kC,words:void 0,animationStyle:"none"}]:[]:this.groupWordsIntoSubtitles(e.words,t.startTime)}groupWordsIntoSubtitles(e,t){const s=[],i=this.config.maxWordsPerSegment||10,n=this.config.maxSegmentDuration||5;let a=[],o=0;for(const l of e){a.length===0&&(o=l.start);const d=a.length>=i,u=l.end-o>n,h=/[.!?]$/.test(l.word);(d||u)&&a.length>0?(s.push(this.createSubtitleFromWords(a,t)),a=[l],o=l.start):(a.push(l),h&&a.length>=3&&(s.push(this.createSubtitleFromWords(a,t)),a=[]))}return a.length>0&&s.push(this.createSubtitleFromWords(a,t)),s}createSubtitleFromWords(e,t){const s=e.map(a=>a.word).join(" ").trim(),i=t+e[0].start,n=t+e[e.length-1].end;return{id:this.generateId(),text:s,startTime:i,endTime:n,style:kC,words:e.map(a=>({text:a.word,startTime:t+a.start,endTime:t+a.end})),animationStyle:"none"}}generateId(){return`sub-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}}let nd=null;function pY(){return nd}function fY(r){return nd&&nd.dispose(),nd=new hY(r),nd}function Eb(r,e,t){return Math.min(Math.max(r,e),t)}function mY(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375}function ll(r){return{segments:[{text:r.text,style:"normal",opacity:1,scale:1,offsetY:0}],visible:!0}}function gY(r,e){if(!r.words||r.words.length===0)return ll(r);const t=r.style?.highlightColor||"#ffff00",s=r.style?.upcomingColor;return{segments:r.words.map(n=>{const a=e>=n.startTime&&e<n.endTime,o=e>=n.endTime,l=e<n.startTime;let d;return a?d=t:l&&s&&(d=s),{text:n.text,style:a?"highlighted":"normal",opacity:1,scale:a?1.15:1,offsetY:a?-2:0,color:d}}),visible:!0}}function yY(r,e){if(!r.words||r.words.length===0)return ll(r);const t=r.words.find(s=>e>=s.startTime&&e<s.endTime);if(!t){const s=r.words[r.words.length-1];return e>=s.endTime?{segments:[{text:s.text,style:"normal",opacity:1,scale:1,offsetY:0}],visible:!0}:{segments:[],visible:!1}}return{segments:[{text:t.text,style:"active",opacity:1,scale:1,offsetY:0}],visible:!0}}function xY(r,e){if(!r.words||r.words.length===0)return ll(r);const t=r.style?.highlightColor||"#ffff00",s=r.style?.upcomingColor||"rgba(255, 255, 255, 0.5)";return{segments:r.words.map(n=>{const a=n.endTime-n.startTime,o=e-n.startTime,l=Eb(o/a,0,1),d=e<n.startTime,u=e>=n.startTime&&e<n.endTime,h=e>=n.endTime;let p="normal",f;return d?(p="normal",f=s):h?(p="highlighted",f=t):u&&(p="active",f=`linear-gradient(90deg, ${t} ${l*100}%, ${s} ${l*100}%)`),{text:n.text,style:p,opacity:1,scale:u?1.05:1,offsetY:0,color:f}}),visible:!0}}function bY(r,e){if(!r.words||r.words.length===0)return ll(r);const t=.3;return{segments:r.words.map(i=>{const n=e-i.startTime;if(!(e>=i.startTime))return{text:i.text,style:"hidden",opacity:0,scale:0,offsetY:20};const o=Eb(n/t,0,1),l=mY(o),d=e>=i.startTime&&e<i.endTime;return{text:i.text,style:d?"active":"normal",opacity:l,scale:.5+l*.5,offsetY:20*(1-l)}}),visible:!0}}function vY(r,e){if(!r.words||r.words.length===0)return ll(r);const t=r.words.filter(i=>e>=i.startTime);return t.length===0?{segments:[],visible:!1}:{segments:t.map((i,n)=>{const a=n===t.length-1,o=e-i.startTime,d=a?Eb(o/.1,0,1):1;return{text:i.text,style:"normal",opacity:d,scale:1,offsetY:0}}),visible:!0}}function wY(r,e){if(e<r.startTime||e>r.endTime)return{segments:[],visible:!1};switch(r.animationStyle||"none"){case"word-highlight":return gY(r,e);case"word-by-word":return yY(r,e);case"karaoke":return xY(r,e);case"bounce":return bY(r,e);case"typewriter":return vY(r,e);case"none":default:return ll(r)}}function CC(r){return{none:"Static","word-highlight":"Word Highlight","word-by-word":"Word by Word",karaoke:"Karaoke",bounce:"Bounce",typewriter:"Typewriter"}[r]}const SC=["none","word-highlight","word-by-word","karaoke","bounce","typewriter"],_a=r=>!r||r==="linear"?t=>t:r==="ease-in"?ni.easeInQuad:r==="ease-out"?ni.easeOutQuad:r==="ease-in-out"?ni.easeInOutQuad:r==="bezier"?ni.easeInOutCubic:ni[r]||(t=>t),Us={opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0},kY=r=>{const{unit:e,progress:t,isIn:s}=r,i=r.animation.stagger||.05,n=e.index*i,a=r.animation.inDuration-(e.totalUnits-1)*i;let o;return s?o=Math.max(0,Math.min(1,(t*r.animation.inDuration-n)/a)):o=1-Math.max(0,Math.min(1,(t*r.animation.outDuration-n)/a)),{...Us,opacity:o>=.5?1:0}},CY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=_a(n.easing||"easeOutQuad"),l=e.index*a,d=s?i.inDuration:i.outDuration,u=Math.max(.1,d-(e.totalUnits-1)*a);let h=Math.max(0,Math.min(1,(t*d-l)/u));s||(h=1-h);const p=o(h),f=n.fadeOpacity?.start??0,m=n.fadeOpacity?.end??1,g=f+(m-f)*p;return{...Us,opacity:g}},ih=r=>e=>{const{unit:t,progress:s,isIn:i,animation:n}=e,a=n.params,o=n.stagger||.03,l=_a(a.easing||"easeOutCubic"),d=a.slideDistance||50,u=t.index*o,h=i?n.inDuration:n.outDuration,p=Math.max(.1,h-(t.totalUnits-1)*o);let f=Math.max(0,Math.min(1,(s*h-u)/p));i||(f=1-f);const m=l(f);let g=0,y=0;const x=d*(1-m);switch(r){case"left":g=-x;break;case"right":g=x;break;case"up":y=-x;break;case"down":y=x;break}return{...Us,opacity:m,offsetX:g,offsetY:y}},SY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=_a(n.easing||"easeOutBack"),l=n.scaleFrom??0,d=n.scaleTo??1,u=e.index*a,h=s?i.inDuration:i.outDuration,p=Math.max(.1,h-(e.totalUnits-1)*a);let f=Math.max(0,Math.min(1,(t*h-u)/p));s||(f=1-f);const m=o(f),g=l+(d-l)*m;return{...Us,opacity:m,scale:{x:g,y:g}}},TY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=_a(n.easing||"easeOutQuad"),l=n.blurAmount??10,d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const f=o(p),m=l*(1-f);return{...Us,opacity:f,blur:m}},AY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.05,o=n.bounceHeight??30,l=e.index*a,d=s?i.inDuration:i.outDuration,u=Math.max(.1,d-(e.totalUnits-1)*a);let h=Math.max(0,Math.min(1,(t*d-l)/u));s||(h=1-h);const p=ni.easeOutBounce(h),f=-o*(1-p);return{...Us,opacity:h>0?1:0,offsetY:f}},jY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=_a(n.easing||"easeOutBack"),l=n.rotateAngle??180,d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const f=o(p),m=l*(1-f);return{...Us,opacity:f,rotation:m,scale:{x:f,y:f}}},_Y=r=>{const{unit:e,progress:t,animation:s}=r,i=s.params,n=i.waveAmplitude??10,a=i.waveFrequency??2,o=e.index/e.totalUnits*Math.PI*2,l=Math.sin(t*Math.PI*2*a+o)*n;return{...Us,offsetY:l}},EY=r=>{const{progress:e,animation:t}=r,s=t.params,i=s.shakeIntensity??5,n=s.shakeSpeed??20,a=Math.sin(e*Math.PI*2*n)*i,o=Math.cos(e*Math.PI*2*n*1.3)*i*.5;return{...Us,offsetX:a,offsetY:o}},MY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.05,o=n.popOvershoot??1.2,l=e.index*a,d=s?i.inDuration:i.outDuration,u=Math.max(.1,d-(e.totalUnits-1)*a);let h=Math.max(0,Math.min(1,(t*d-l)/u));s||(h=1-h);const p=ni.easeOutBack(h),f=h>0?p*(h<.5?o:1):0;return{...Us,opacity:h>0?1:0,scale:{x:Math.max(0,f),y:Math.max(0,f)}}},PY=r=>{const{unit:e,progress:t,animation:s}=r,i=s.params,n=i.glitchIntensity??10,a=i.glitchSpeed??10,o=t*a,l=Math.floor(o)+e.index*.3,d=Math.sin(l*12.9898)*43758.5453,u=d-Math.floor(d),h=u>.7,p=h?(u-.5)*n*2:0,f=h?(u-.5)*5:0;return{...Us,offsetX:p,skewX:f,color:h&&u>.85?`hsl(${u*360}, 100%, 50%)`:void 0}},NY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.03,o=_a(n.easing||"easeOutCubic"),l=n.splitDirection||"horizontal",d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const f=o(p),m=(e.totalUnits-1)/2,x=100*(e.index-m)*(1-f)/m;return{...Us,opacity:f,offsetX:l==="horizontal"?x:0,offsetY:l==="vertical"?x:0}},RY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=i.stagger||.05,o=_a(n.easing||"easeOutBack"),l=n.flipAxis||"y",d=e.index*a,u=s?i.inDuration:i.outDuration,h=Math.max(.1,u-(e.totalUnits-1)*a);let p=Math.max(0,Math.min(1,(t*u-d)/h));s||(p=1-p);const f=o(p),m=90*(1-f),g=Math.cos(m*Math.PI/180);return{...Us,opacity:f>.1?1:0,scale:l==="x"?{x:g,y:1}:{x:1,y:g},rotation:0}},IY=r=>{const{unit:e,progress:t,isIn:s,animation:i}=r,n=i.params,a=n.wordDelay??.2,o=_a(n.easing||"easeOutQuad"),l=e.index*a,d=s?i.inDuration:i.outDuration;let h=Math.max(0,Math.min(1,(t*d-l)/.3));s||(h=1-h);const p=o(h);return{...Us,opacity:p,offsetY:20*(1-p),scale:{x:.8+.2*p,y:.8+.2*p}}},DY=r=>{const{unit:e,progress:t,animation:s}=r,n=s.params.rainbowSpeed??1,a=(e.index/e.totalUnits*360+t*360*n)%360;return{...Us,color:`hsl(${a}, 80%, 60%)`}},FY={none:()=>Us,typewriter:kY,fade:CY,"slide-left":ih("left"),"slide-right":ih("right"),"slide-up":ih("up"),"slide-down":ih("down"),scale:SY,blur:TY,bounce:AY,rotate:jY,wave:_Y,shake:EY,pop:MY,glitch:PY,split:NY,flip:RY,"word-by-word":IY,rainbow:DY};function Gm(r){const e=FY[r.animation.preset];return e?e(r):Us}class BY{measureCtx=null;constructor(){if(typeof OffscreenCanvas<"u"){const e=new OffscreenCanvas(1,1);this.measureCtx=e.getContext("2d")}else if(typeof document<"u"){const e=document.createElement("canvas");this.measureCtx=e.getContext("2d")}}measureText(e,t,s,i,n,a){if(!this.measureCtx)return this.createFallbackLayout(e,s,a);const o=this.measureCtx;o.font=`${i} ${s}px ${t}`;const l=e.split(`
`),d=[],u=[],h=[];let p=0,f=0,m=0;const g=s*a;for(let b=0;b<l.length;b++){const w=l[b],C=[],S=o.measureText(w).width+(w.length-1)*n;let A=0;const T=w.split(/(\s+)/);let j=0;for(const M of T){if(!M)continue;const P=/^\s+$/.test(M),R=[],D=A;for(let B=0;B<M.length;B++){const O=M[B],I=o.measureText(O).width,J={char:O,x:A,y:m,width:I,height:s,lineIndex:b,charIndexInLine:R.length,globalIndex:p};R.push(J),u.push(J),p++,A+=I+n}if(!P&&R.length>0){const B=A-D-n,O={word:M,chars:R,x:D,y:m,width:B,height:s,lineIndex:b,wordIndexInLine:j,globalIndex:f};C.push(O),h.push(O),f++,j++}}const _={text:w,words:C,x:0,y:m,width:S,height:g,lineIndex:b};d.push(_),m+=g}const y=Math.max(...d.map(b=>b.width),0);return{characters:u,words:h,lines:d,totalWidth:y,totalHeight:m}}createFallbackLayout(e,t,s){const i=t*.6,n=e.split(`
`),a=[],o=[],l=[];let d=0,u=0,h=0;const p=t*s;for(let f=0;f<n.length;f++){const m=n[f],g=[];let y=0;const x=m.split(/(\s+)/);for(const w of x){if(!w)continue;const C=/^\s+$/.test(w),k=[],S=y;for(let A=0;A<w.length;A++){const T=w[A],j=i,_={char:T,x:y,y:h,width:j,height:t,lineIndex:f,charIndexInLine:k.length,globalIndex:d};k.push(_),o.push(_),d++,y+=j}if(!C&&k.length>0){const A=y-S,T={word:w,chars:k,x:S,y:h,width:A,height:t,lineIndex:f,wordIndexInLine:g.length,globalIndex:u};g.push(T),l.push(T),u++}}const b={text:m,words:g,x:0,y:h,width:y,height:p,lineIndex:f};a.push(b),h+=p}return{characters:o,words:l,lines:a,totalWidth:Math.max(...a.map(f=>f.width),0),totalHeight:h}}calculateAnimatedLayout(e,t){const s=e.animation;if(!s||s.preset==="none")return this.createStaticLayout(e);const i=this.measureText(e.text,e.style.fontFamily,e.style.fontSize,String(e.style.fontWeight),e.style.letterSpacing,e.style.lineHeight),n=t-e.startTime,a=e.duration,o=n<=s.inDuration,l=n>=a-s.outDuration,d=!o&&!l;let u,h;if(o)u=s.inDuration>0?n/s.inDuration:1,h=!0;else if(l){const m=a-s.outDuration;u=s.outDuration>0?(n-m)/s.outDuration:0,h=!1}else u=1,h=!0;const p=s.unit||"character",f=[];for(const m of i.lines){const g=[];for(const w of m.words){const C=[];for(const T of w.chars){let j,_;p==="character"?(j={text:T.char,index:T.globalIndex,totalUnits:i.characters.length,x:T.x,y:T.y,width:T.width,height:T.height},_=i.characters.length):p==="word"?(j={text:w.word,index:w.globalIndex,totalUnits:i.words.length,x:w.x,y:w.y,width:w.width,height:w.height},_=i.words.length):(j={text:m.text,index:m.lineIndex,totalUnits:i.lines.length,x:m.x,y:m.y,width:m.width,height:m.height},_=i.lines.length);const M={unit:{...j,totalUnits:_},progress:d?1:u,isIn:h,animation:s,totalDuration:a},P=Gm(M);C.push({...T,state:P})}const S={unit:{text:w.word,index:w.globalIndex,totalUnits:i.words.length,x:w.x,y:w.y,width:w.width,height:w.height},progress:d?1:u,isIn:h,animation:s,totalDuration:a},A=p==="word"||p==="line"?Gm(S):{opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0};g.push({...w,state:A,animatedChars:C})}const x={unit:{text:m.text,index:m.lineIndex,totalUnits:i.lines.length,x:m.x,y:m.y,width:m.width,height:m.height},progress:d?1:u,isIn:h,animation:s,totalDuration:a},b=p==="line"?Gm(x):{opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0};f.push({...m,state:b,animatedWords:g})}return{lines:f,totalWidth:i.totalWidth,totalHeight:i.totalHeight}}createStaticLayout(e){const t=this.measureText(e.text,e.style.fontFamily,e.style.fontSize,String(e.style.fontWeight),e.style.letterSpacing,e.style.lineHeight),s={opacity:1,scale:{x:1,y:1},rotation:0,offsetX:0,offsetY:0,blur:0};return{lines:t.lines.map(n=>({...n,state:s,animatedWords:n.words.map(a=>({...a,state:s,animatedChars:a.chars.map(o=>({...o,state:s}))}))})),totalWidth:t.totalWidth,totalHeight:t.totalHeight}}}new BY;const LY={syncMode:"smart",beatSubdivision:1,offsetMs:0,snapToDownbeats:!1};class OY{async analyzeBeats(e,t){t?.({phase:"analyzing",percent:20,message:"Analyzing audio for beats..."});const i=await _M().analyzeFromBlob(e);return t?.({phase:"complete",percent:100,message:`Detected ${i.bpm} BPM with ${i.beats.length} beats`}),i}calculateSyncedTimings(e,t,s,i){if(e.length===0||t.beats.length===0)return[];const n=[...e].sort((h,p)=>h.startTime-p.startTime),a=this.getSubdividedBeats(t,i),o=i.offsetMs/1e3,l=[];if(a.length<2)return[];const d=(a[a.length-1]-a[0])/(a.length-1);let u=0;for(const h of n){if(u>=a.length)break;const p=a[u]+s+o;switch(i.syncMode){case"preserve-duration":{l.push({clipId:h.id,originalStartTime:h.startTime,originalDuration:h.duration,newStartTime:p,newDuration:h.duration}),u++;break}case"one-per-beat":{const f=Math.min(u+1,a.length-1),g=a[f]+s+o-p;l.push({clipId:h.id,originalStartTime:h.startTime,originalDuration:h.duration,newStartTime:p,newDuration:Math.max(.1,g)}),u++;break}case"smart":default:{const f=Math.max(1,Math.round(h.duration/d)),m=Math.min(u+f,a.length-1),y=a[m]+s+o-p;l.push({clipId:h.id,originalStartTime:h.startTime,originalDuration:h.duration,newStartTime:p,newDuration:Math.max(.1,y)}),u=m;break}}}return l}getSubdividedBeats(e,t){const s=t.snapToDownbeats?e.beats.filter((n,a)=>a%4===0):e.beats;if(t.beatSubdivision===1)return s.map(n=>n.time);const i=[];for(let n=0;n<s.length-1;n++){const o=(s[n+1].time-s[n].time)/t.beatSubdivision;for(let l=0;l<t.beatSubdivision;l++)i.push(s[n].time+l*o)}return s.length>0&&i.push(s[s.length-1].time),i}snapClipToNearestBeat(e,t,s,i=.2){const n=e-s;let a=t.beats[0],o=Math.abs(a.time-n);for(const l of t.beats){const d=Math.abs(l.time-n);d<o&&(o=d,a=l)}return o<=i?a.time+s:e}}let Wm=null;function TC(){return Wm||(Wm=new OY),Wm}const $Y=[{id:"smileys",name:"Smileys & Emotion",emojis:[{id:"grinning",emoji:"",name:"Grinning Face",category:"smileys"},{id:"joy",emoji:"",name:"Face with Tears of Joy",category:"smileys"},{id:"heart_eyes",emoji:"",name:"Smiling Face with Heart-Eyes",category:"smileys"},{id:"thinking",emoji:"",name:"Thinking Face",category:"smileys"},{id:"sunglasses",emoji:"",name:"Smiling Face with Sunglasses",category:"smileys"},{id:"wink",emoji:"",name:"Winking Face",category:"smileys"},{id:"thumbsup",emoji:"",name:"Thumbs Up",category:"smileys"},{id:"clap",emoji:"",name:"Clapping Hands",category:"smileys"},{id:"fire",emoji:"",name:"Fire",category:"smileys"},{id:"heart",emoji:"",name:"Red Heart",category:"smileys"},{id:"star",emoji:"",name:"Star",category:"smileys"},{id:"sparkles",emoji:"",name:"Sparkles",category:"smileys"}]},{id:"gestures",name:"Gestures",emojis:[{id:"wave",emoji:"",name:"Waving Hand",category:"gestures"},{id:"ok_hand",emoji:"",name:"OK Hand",category:"gestures"},{id:"point_up",emoji:"",name:"Index Pointing Up",category:"gestures"},{id:"point_right",emoji:"",name:"Backhand Index Pointing Right",category:"gestures"},{id:"raised_hands",emoji:"",name:"Raising Hands",category:"gestures"},{id:"pray",emoji:"",name:"Folded Hands",category:"gestures"},{id:"muscle",emoji:"",name:"Flexed Biceps",category:"gestures"},{id:"v",emoji:"",name:"Victory Hand",category:"gestures"}]},{id:"objects",name:"Objects",emojis:[{id:"camera",emoji:"",name:"Camera",category:"objects"},{id:"video_camera",emoji:"",name:"Video Camera",category:"objects"},{id:"microphone",emoji:"",name:"Microphone",category:"objects"},{id:"headphones",emoji:"",name:"Headphones",category:"objects"},{id:"movie_camera",emoji:"",name:"Movie Camera",category:"objects"},{id:"clapper",emoji:"",name:"Clapper Board",category:"objects"},{id:"trophy",emoji:"",name:"Trophy",category:"objects"},{id:"medal",emoji:"",name:"Sports Medal",category:"objects"},{id:"bell",emoji:"",name:"Bell",category:"objects"},{id:"megaphone",emoji:"",name:"Megaphone",category:"objects"}]},{id:"symbols",name:"Symbols",emojis:[{id:"check",emoji:"",name:"Check Mark",category:"symbols"},{id:"x",emoji:"",name:"Cross Mark",category:"symbols"},{id:"question",emoji:"",name:"Question Mark",category:"symbols"},{id:"exclamation",emoji:"",name:"Exclamation Mark",category:"symbols"},{id:"100",emoji:"",name:"Hundred Points",category:"symbols"},{id:"arrow_right",emoji:"",name:"Right Arrow",category:"symbols"},{id:"arrow_left",emoji:"",name:"Left Arrow",category:"symbols"},{id:"arrow_up",emoji:"",name:"Up Arrow",category:"symbols"},{id:"arrow_down",emoji:"",name:"Down Arrow",category:"symbols"},{id:"new",emoji:"",name:"New",category:"symbols"},{id:"free",emoji:"",name:"Free",category:"symbols"}]},{id:"nature",name:"Nature",emojis:[{id:"sun",emoji:"",name:"Sun",category:"nature"},{id:"moon",emoji:"",name:"Crescent Moon",category:"nature"},{id:"cloud",emoji:"",name:"Cloud",category:"nature"},{id:"rainbow",emoji:"",name:"Rainbow",category:"nature"},{id:"snowflake",emoji:"",name:"Snowflake",category:"nature"},{id:"lightning",emoji:"",name:"Lightning",category:"nature"},{id:"flower",emoji:"",name:"Cherry Blossom",category:"nature"},{id:"tree",emoji:"",name:"Deciduous Tree",category:"nature"}]}];class zY{stickers=new Map;categories=new Map;emojiCategories=$Y;constructor(){this.initializeDefaultCategories()}initializeDefaultCategories(){const e=[{id:"arrows",name:"Arrows",icon:""},{id:"badges",name:"Badges",icon:""},{id:"banners",name:"Banners",icon:""},{id:"callouts",name:"Callouts",icon:""},{id:"social",name:"Social Media",icon:""},{id:"custom",name:"Custom",icon:""}];for(const t of e)this.categories.set(t.id,t)}addSticker(e){this.stickers.set(e.id,e)}removeSticker(e){return this.stickers.delete(e)}getSticker(e){return this.stickers.get(e)}getAllStickers(){return Array.from(this.stickers.values())}getStickersByCategory(e){return Array.from(this.stickers.values()).filter(t=>t.category===e)}searchStickers(e){const t=e.toLowerCase();return Array.from(this.stickers.values()).filter(s=>s.name.toLowerCase().includes(t)||s.tags?.some(i=>i.toLowerCase().includes(t)))}addCategory(e){this.categories.set(e.id,e)}getCategories(){return Array.from(this.categories.values())}getCategory(e){return this.categories.get(e)}getEmojiCategories(){return this.emojiCategories}getEmojisByCategory(e){return this.emojiCategories.find(s=>s.id===e)?.emojis||[]}getAllEmojis(){return this.emojiCategories.flatMap(e=>e.emojis)}searchEmojis(e){const t=e.toLowerCase();return this.getAllEmojis().filter(s=>s.name.toLowerCase().includes(t))}getEmoji(e){return this.getAllEmojis().find(t=>t.id===e)}createStickerClip(e,t,s,i){return{id:`sticker_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,trackId:t,startTime:s,duration:i,type:"sticker",imageUrl:e.imageUrl,category:e.category,name:e.name,transform:{...Ep},keyframes:[]}}createEmojiClip(e,t,s,i){const n=this.emojiToDataUrl(e.emoji);return{id:`emoji_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,trackId:t,startTime:s,duration:i,type:"emoji",imageUrl:n,category:e.category,name:e.name,transform:{...Ep},keyframes:[]}}emojiToDataUrl(e,t=128){if(typeof document>"u")return`data:text/plain;base64,${btoa(e)}`;const s=document.createElement("canvas");s.width=t,s.height=t;const i=s.getContext("2d");return i?(i.font=`${t*.8}px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif`,i.textAlign="center",i.textBaseline="middle",i.fillText(e,t/2,t/2),s.toDataURL("image/png")):`data:text/plain;base64,${btoa(e)}`}async importSticker(e,t,s="custom",i){const n=await this.fileToDataUrl(e),a={id:`custom_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,name:t,category:s,imageUrl:n,tags:i};return this.addSticker(a),a}fileToDataUrl(e){return new Promise((t,s)=>{const i=new FileReader;i.onload=()=>t(i.result),i.onerror=()=>s(new Error("Failed to read file")),i.readAsDataURL(e)})}clearCustomStickers(){for(const[e,t]of this.stickers)t.category==="custom"&&this.stickers.delete(e)}}const bee=new zY,VY=[{id:"none",name:"None",description:"No animation",category:"entrance",defaultDuration:0,defaultEasing:"linear"},{id:"fade",name:"Fade",description:"Smooth fade in/out",category:"entrance",defaultDuration:.5,defaultEasing:"ease-out"},{id:"slide-left",name:"Slide from Right",description:"Slide in from the right side",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"slide-right",name:"Slide from Left",description:"Slide in from the left side",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"slide-up",name:"Slide from Bottom",description:"Slide in from below",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"slide-down",name:"Slide from Top",description:"Slide in from above",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"scale",name:"Scale",description:"Scale from zero to full size",category:"entrance",defaultDuration:.5,defaultEasing:"ease-out"},{id:"rotate",name:"Rotate",description:"Spin and fade in",category:"entrance",defaultDuration:.8,defaultEasing:"ease-out"},{id:"bounce",name:"Bounce",description:"Bouncy elastic effect",category:"entrance",defaultDuration:.8,defaultEasing:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},{id:"pop",name:"Pop",description:"Quick pop with overshoot",category:"entrance",defaultDuration:.5,defaultEasing:"cubic-bezier(0.175, 0.885, 0.32, 1.275)"},{id:"draw",name:"Draw",description:"SVG stroke drawing effect",category:"entrance",defaultDuration:1.2,defaultEasing:"ease-in-out"},{id:"wipe-left",name:"Wipe Left",description:"Reveal from left edge",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"wipe-right",name:"Wipe Right",description:"Reveal from right edge",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"wipe-up",name:"Wipe Up",description:"Reveal from bottom",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"wipe-down",name:"Wipe Down",description:"Reveal from top",category:"entrance",defaultDuration:.7,defaultEasing:"ease-out"},{id:"reveal-center",name:"Reveal Center",description:"Expand from center",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"reveal-edges",name:"Reveal Edges",description:"Collapse to center",category:"entrance",defaultDuration:.6,defaultEasing:"ease-out"},{id:"elastic",name:"Elastic",description:"Elastic bounce effect",category:"entrance",defaultDuration:1,defaultEasing:"cubic-bezier(0.68, -0.55, 0.265, 1.55)"},{id:"flip-horizontal",name:"Flip Horizontal",description:"3D horizontal flip",category:"entrance",defaultDuration:.8,defaultEasing:"ease-out"},{id:"flip-vertical",name:"Flip Vertical",description:"3D vertical flip",category:"entrance",defaultDuration:.8,defaultEasing:"ease-out"}],UY={x:0,y:0,scale:1,rotation:0,anchorX:.5,anchorY:.5},GY="normal",WY=1;class YY{defaultWidth;defaultHeight;canvas=null;ctx=null;constructor(e={}){this.defaultWidth=e.width??1920,this.defaultHeight=e.height??1080}createProject(e=this.defaultWidth,t=this.defaultHeight,s="Untitled"){return{id:bm(),name:s,width:e,height:t,layers:[],selectedLayerIndex:-1,backgroundColor:"#ffffff"}}importPhoto(e,t,s="Background"){const i=this.createLayer({name:s,type:"image",content:t});return{...e,width:t.width,height:t.height,layers:[i],selectedLayerIndex:0}}createLayer(e={}){return{id:bm(),name:e.name??"Layer",type:e.type??"image",content:e.content??null,opacity:e.opacity??WY,blendMode:e.blendMode??GY,visible:!0,locked:!1,mask:null,adjustments:[],transform:{...UY}}}addLayer(e,t={}){const s=this.createLayer(t),i=[...e.layers],n=t.insertAt??e.selectedLayerIndex+1,a=Math.max(0,Math.min(n,i.length));return i.splice(a,0,s),{...e,layers:i,selectedLayerIndex:a}}removeLayer(e,t){const s=e.layers.findIndex(a=>a.id===t);if(s===-1)return e;const i=e.layers.filter(a=>a.id!==t);let n=e.selectedLayerIndex;return n>=i.length?n=Math.max(0,i.length-1):n>s&&n--,{...e,layers:i,selectedLayerIndex:i.length>0?n:-1}}reorderLayers(e,t,s){if(t<0||t>=e.layers.length||s<0||s>=e.layers.length)return{success:!1,layers:e.layers,error:"Invalid layer index"};if(t===s)return{success:!0,layers:e.layers};const i=[...e.layers],[n]=i.splice(t,1);return i.splice(s,0,n),{success:!0,layers:i}}setLayerOpacity(e,t,s){const i=Math.max(0,Math.min(1,s));return{...e,layers:e.layers.map(n=>n.id===t?{...n,opacity:i}:n)}}setLayerVisibility(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,visible:s??!i.visible}:i)}}setLayerBlendMode(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,blendMode:s}:i)}}setLayerTransform(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,transform:{...i.transform,...s}}:i)}}setLayerLocked(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,locked:s}:i)}}renameLayer(e,t,s){return{...e,layers:e.layers.map(i=>i.id===t?{...i,name:s}:i)}}duplicateLayer(e,t){const s=e.layers.find(o=>o.id===t);if(!s)return e;const i=e.layers.findIndex(o=>o.id===t),n={...s,id:bm(),name:`${s.name} Copy`},a=[...e.layers];return a.splice(i+1,0,n),{...e,layers:a,selectedLayerIndex:i+1}}selectLayer(e,t){const s=e.layers.findIndex(i=>i.id===t);return s===-1?e:{...e,selectedLayerIndex:s}}getSelectedLayer(e){return e.selectedLayerIndex<0||e.selectedLayerIndex>=e.layers.length?null:e.layers[e.selectedLayerIndex]}getLayer(e,t){return e.layers.find(s=>s.id===t)??null}async renderComposite(e,t={}){const s=t.width??e.width,i=t.height??e.height,n=t.includeHidden??!1,a=t.backgroundColor??e.backgroundColor;(!this.canvas||this.canvas.width!==s||this.canvas.height!==i)&&(this.canvas=new OffscreenCanvas(s,i),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}));const o=this.ctx;o.fillStyle=a,o.fillRect(0,0,s,i);for(const l of e.layers)!l.visible&&!n||!l.content&&l.type==="image"||(o.globalAlpha=l.opacity,o.globalCompositeOperation=this.getCanvasBlendMode(l.blendMode),l.content&&(o.save(),this.applyLayerTransform(o,l,s,i),o.drawImage(l.content,0,0),o.restore()));return o.globalAlpha=1,o.globalCompositeOperation="source-over",createImageBitmap(this.canvas)}applyLayerTransform(e,t,s,i){const{transform:n,content:a}=t;if(!a)return;const o=a.width,l=a.height,d=o*n.anchorX,u=l*n.anchorY;e.translate(n.x+d,n.y+u),e.rotate(n.rotation*Math.PI/180),e.scale(n.scale,n.scale),e.translate(-d,-u)}getCanvasBlendMode(e){return{normal:"source-over",multiply:"multiply",screen:"screen",overlay:"overlay",softLight:"soft-light",hardLight:"hard-light",colorDodge:"color-dodge",colorBurn:"color-burn",difference:"difference",exclusion:"exclusion",hue:"hue",saturation:"saturation",color:"color",luminosity:"luminosity"}[e]??"source-over"}async flattenLayers(e){if(e.layers.length===0)return e;const t=await this.renderComposite(e),s=this.createLayer({name:"Flattened",type:"image",content:t});return{...e,layers:[s],selectedLayerIndex:0}}async mergeLayerDown(e,t){const s=e.layers.findIndex(u=>u.id===t);if(s<=0)return e;const i=e.layers[s],n=e.layers[s-1],a={...e,layers:[n,i],backgroundColor:"transparent"},o=await this.renderComposite(a),l={...n,content:o,name:n.name},d=[...e.layers];return d.splice(s-1,2,l),{...e,layers:d,selectedLayerIndex:Math.min(e.selectedLayerIndex,d.length-1)}}canModifyLayer(e,t){const s=this.getLayer(e,t);return s!==null&&!s.locked}getVisibleLayers(e){return e.layers.filter(t=>t.visible)}getLayerCount(e){return e.layers.length}dispose(){this.canvas=null,this.ctx=null}}let Ym=null;function qY(){return Ym||(Ym=new YY),Ym}const HY="openreel-templates",_r="templates",XY=1,Jt={position:{x:.5,y:.5},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},qm=[{id:"builtin-youtube-intro",name:"YouTube Intro",description:"10-second animated intro with logo and channel name",category:"youtube",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Background",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-1",type:"text",name:"Channel Name",clips:[{id:"clip-channel-name",mediaId:"text-channel",trackId:"track-text-1",startTime:1,duration:8,inPoint:0,outPoint:8,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.5}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"channel-name"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:10,markers:[]},placeholders:[{id:"channel-name",type:"text",label:"Channel Name",required:!0,defaultValue:"Your Channel"}],tags:["youtube","intro","animated"],version:"1.0.0"},{id:"builtin-tiktok-promo",name:"TikTok Promo",description:"Vertical 15-second promo with call-to-action text",category:"tiktok",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Main Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-1",type:"text",name:"CTA Text",clips:[{id:"clip-cta",mediaId:"text-cta",trackId:"track-text-1",startTime:10,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.85}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"cta-text"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:15,markers:[]},placeholders:[{id:"cta-text",type:"text",label:"Call to Action",required:!0,defaultValue:"Swipe Up!"}],tags:["tiktok","vertical","promo"],version:"1.0.0"},{id:"builtin-lower-third",name:"Lower Third",description:"Professional name & title overlay for interviews",category:"lower-third",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Background Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-name",type:"text",name:"Name",clips:[{id:"clip-name",mediaId:"text-name",trackId:"track-text-name",startTime:.5,duration:4,inPoint:0,outPoint:4,effects:[],audioEffects:[],transform:{...Jt,position:{x:.15,y:.82}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"name"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-title",type:"text",name:"Title",clips:[{id:"clip-title",mediaId:"text-title",trackId:"track-text-title",startTime:.7,duration:3.8,inPoint:0,outPoint:3.8,effects:[],audioEffects:[],transform:{...Jt,position:{x:.15,y:.88}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"title"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:5,markers:[]},placeholders:[{id:"name",type:"text",label:"Name",required:!0,defaultValue:"John Smith"},{id:"title",type:"text",label:"Title/Position",required:!1,defaultValue:"CEO, Company Inc."}],tags:["lower-third","name","title","interview"],version:"1.0.0"},{id:"builtin-slideshow",name:"Photo Slideshow",description:"30-second slideshow with 5 image slots",category:"slideshow",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-images",type:"image",name:"Photos",clips:[{id:"clip-image-1",mediaId:"placeholder-image-1",trackId:"track-images",startTime:0,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Jt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-1"},{id:"clip-image-2",mediaId:"placeholder-image-2",trackId:"track-images",startTime:6,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Jt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-2"},{id:"clip-image-3",mediaId:"placeholder-image-3",trackId:"track-images",startTime:12,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Jt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-3"},{id:"clip-image-4",mediaId:"placeholder-image-4",trackId:"track-images",startTime:18,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Jt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-4"},{id:"clip-image-5",mediaId:"placeholder-image-5",trackId:"track-images",startTime:24,duration:6,inPoint:0,outPoint:6,effects:[],audioEffects:[],transform:Jt,volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"image-5"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-caption",type:"text",name:"Caption",clips:[{id:"clip-caption",mediaId:"text-caption",trackId:"track-text-caption",startTime:2,duration:26,inPoint:0,outPoint:26,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.9}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"caption"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:30,markers:[]},placeholders:[{id:"image-1",type:"media",label:"Photo 1",required:!0},{id:"image-2",type:"media",label:"Photo 2",required:!0},{id:"image-3",type:"media",label:"Photo 3",required:!0},{id:"image-4",type:"media",label:"Photo 4",required:!1},{id:"image-5",type:"media",label:"Photo 5",required:!1},{id:"caption",type:"text",label:"Caption",required:!1,defaultValue:"My Photo Album"}],tags:["slideshow","photos","memories"],version:"1.0.0"},{id:"builtin-instagram-reel",name:"Instagram Reel",description:"30-second vertical reel with animated hook text",category:"instagram",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Main Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-hook",type:"text",name:"Hook Text",clips:[{id:"clip-hook",mediaId:"text-hook",trackId:"track-text-hook",startTime:.5,duration:4,inPoint:0,outPoint:4,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.15}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"hook-text"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-cta",type:"text",name:"CTA",clips:[{id:"clip-cta-reel",mediaId:"text-cta-reel",trackId:"track-text-cta",startTime:25,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.85}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"cta-text"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:30,markers:[]},placeholders:[{id:"hook-text",type:"text",label:"Hook Text",required:!0,defaultValue:"Wait for it..."},{id:"cta-text",type:"text",label:"Call to Action",required:!1,defaultValue:"Follow for more!"}],tags:["instagram","reel","vertical","hook"],version:"1.0.0"},{id:"builtin-youtube-shorts",name:"YouTube Short",description:"60-second vertical short with title and subscribe CTA",category:"youtube",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-video-1",type:"video",name:"Main Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-title",type:"text",name:"Title",clips:[{id:"clip-title-short",mediaId:"text-title-short",trackId:"track-text-title",startTime:0,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.1}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"title"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-subscribe",type:"text",name:"Subscribe CTA",clips:[{id:"clip-subscribe",mediaId:"text-subscribe",trackId:"track-text-subscribe",startTime:50,duration:10,inPoint:0,outPoint:10,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.9}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"subscribe-cta"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:60,markers:[]},placeholders:[{id:"title",type:"text",label:"Video Title",required:!0,defaultValue:"Did You Know?"},{id:"subscribe-cta",type:"text",label:"Subscribe CTA",required:!1,defaultValue:"Subscribe for more!"}],tags:["youtube","shorts","vertical","subscribe"],version:"1.0.0"},{id:"builtin-quote-card",name:"Quote Card",description:"Animated quote card with author attribution",category:"instagram",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1080,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-bg",type:"graphics",name:"Background",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-quote",type:"text",name:"Quote",clips:[{id:"clip-quote",mediaId:"text-quote",trackId:"track-text-quote",startTime:.5,duration:9,inPoint:0,outPoint:9,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.45}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"quote"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-author",type:"text",name:"Author",clips:[{id:"clip-author",mediaId:"text-author",trackId:"track-text-author",startTime:1.5,duration:8,inPoint:0,outPoint:8,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.7}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"author"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:10,markers:[]},placeholders:[{id:"quote",type:"text",label:"Quote",required:!0,defaultValue:"The only way to do great work is to love what you do."},{id:"author",type:"text",label:"Author",required:!0,defaultValue:"- Steve Jobs"}],tags:["instagram","quote","inspiration","square"],version:"1.0.0"},{id:"builtin-product-promo",name:"Product Promo",description:"15-second TikTok-style product showcase",category:"tiktok",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-product",type:"video",name:"Product Video",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-headline",type:"text",name:"Headline",clips:[{id:"clip-headline",mediaId:"text-headline",trackId:"track-text-headline",startTime:0,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.12}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"headline"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-price",type:"text",name:"Price",clips:[{id:"clip-price",mediaId:"text-price",trackId:"track-text-price",startTime:5,duration:10,inPoint:0,outPoint:10,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.75}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"price"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-cta-promo",type:"text",name:"CTA",clips:[{id:"clip-cta-promo",mediaId:"text-cta-promo",trackId:"track-text-cta-promo",startTime:10,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.88}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"cta"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:15,markers:[]},placeholders:[{id:"headline",type:"text",label:"Headline",required:!0,defaultValue:"NEW ARRIVAL"},{id:"price",type:"text",label:"Price",required:!0,defaultValue:"$29.99"},{id:"cta",type:"text",label:"Call to Action",required:!0,defaultValue:"Shop Now - Link in Bio!"}],tags:["tiktok","product","promo","ecommerce"],version:"1.0.0"},{id:"builtin-countdown",name:"Countdown Timer",description:"Event countdown with date and title",category:"instagram",thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:{width:1080,height:1920,frameRate:30,sampleRate:48e3,channels:2},timeline:{tracks:[{id:"track-bg-countdown",type:"graphics",name:"Background",clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-event",type:"text",name:"Event Name",clips:[{id:"clip-event",mediaId:"text-event",trackId:"track-text-event",startTime:0,duration:10,inPoint:0,outPoint:10,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.25}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"event-name"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-date",type:"text",name:"Date",clips:[{id:"clip-date",mediaId:"text-date",trackId:"track-text-date",startTime:1,duration:9,inPoint:0,outPoint:9,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.6}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"event-date"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1},{id:"track-text-swipe",type:"text",name:"Swipe Up",clips:[{id:"clip-swipe",mediaId:"text-swipe",trackId:"track-text-swipe",startTime:5,duration:5,inPoint:0,outPoint:5,effects:[],audioEffects:[],transform:{...Jt,position:{x:.5,y:.9}},volume:1,keyframes:[],isPlaceholder:!0,placeholderId:"swipe-cta"}],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}],subtitles:[],duration:10,markers:[]},placeholders:[{id:"event-name",type:"text",label:"Event Name",required:!0,defaultValue:"LAUNCH DAY"},{id:"event-date",type:"text",label:"Date",required:!0,defaultValue:"January 20th"},{id:"swipe-cta",type:"text",label:"Swipe CTA",required:!1,defaultValue:"Swipe Up for Details"}],tags:["instagram","stories","countdown","event"],version:"1.0.0"}];class KY{db=null;templates=new Map;async initialize(){if(!this.db)return new Promise((e,t)=>{const s=indexedDB.open(HY,XY);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,this.loadBuiltinTemplates(),e()},s.onupgradeneeded=i=>{const n=i.target.result;n.objectStoreNames.contains(_r)||n.createObjectStore(_r,{keyPath:"id"})}})}loadBuiltinTemplates(){for(const e of qm)this.templates.set(e.id,e)}createFromProject(e,t){const s=`template-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,i=this.convertToTemplateTimeline(e.timeline,t.placeholders);return{id:s,name:t.name,description:t.description,category:t.category,thumbnailUrl:null,previewUrl:null,createdAt:Date.now(),modifiedAt:Date.now(),settings:e.settings,timeline:i,placeholders:t.placeholders,tags:t.tags||[],version:"1.0.0"}}convertToTemplateTimeline(e,t){const s=new Set(t.map(a=>a.id)),i=e.tracks.map(a=>({...a,clips:a.clips.map(o=>this.convertToTemplateClip(o,s))})),n=e.subtitles.map(a=>({...a,isPlaceholder:!1}));return{...e,tracks:i,subtitles:n}}convertToTemplateClip(e,t){return{...e,isPlaceholder:t.has(e.mediaId),placeholderId:t.has(e.mediaId)?e.mediaId:void 0}}applyTemplate(e,t){const s=[],i=[],n={...t};for(const u of e.placeholders)!n[u.id]&&u.defaultValue&&(n[u.id]={type:u.type,value:u.defaultValue}),u.required&&!n[u.id]&&s.push(u.label);const a=`project-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,o=this.createMediaFromReplacements(n,e.placeholders),l=e.timeline.tracks.map(u=>{const h=u.clips.map(p=>{const f=this.resolveClipPlaceholder(p,n);if(p.isPlaceholder&&p.placeholderId){const m=e.placeholders.find(g=>g.id===p.placeholderId);if(m?.type==="text"){const g=n[p.placeholderId]?.value||m.defaultValue||"Text";i.push({id:p.id,text:g,placeholderId:p.placeholderId})}}return f});return{...u,clips:h}});return{project:{id:a,name:`${e.name} - Copy`,createdAt:Date.now(),modifiedAt:Date.now(),settings:e.settings,mediaLibrary:{items:o},timeline:{...e.timeline,tracks:l,subtitles:e.timeline.subtitles.map(u=>this.resolveSubtitlePlaceholder(u,n))}},missingPlaceholders:s,textClips:i}}createMediaFromReplacements(e,t){const s=[];for(const i of t){const n=e[i.id];n&&n.type==="media"&&n.mediaBlob&&s.push({id:i.id,name:n.value,type:"image",fileHandle:null,blob:n.mediaBlob,metadata:{duration:0,width:1920,height:1080,frameRate:30,codec:"",sampleRate:0,channels:0,fileSize:n.mediaBlob.size},thumbnailUrl:null,waveformData:null})}return s}resolveClipPlaceholder(e,t){if(!e.isPlaceholder||!e.placeholderId){const{isPlaceholder:l,placeholderId:d,...u}=e;return u}if(!t[e.placeholderId]){const{isPlaceholder:l,placeholderId:d,...u}=e;return u}const{isPlaceholder:i,placeholderId:n,...a}=e,o=e.mediaId.startsWith("text-")||e.mediaId.startsWith("shape-")||e.mediaId.startsWith("svg-");return{...a,mediaId:o?e.mediaId:e.placeholderId}}resolveSubtitlePlaceholder(e,t){if(!e.isPlaceholder||!e.placeholderId){const{isPlaceholder:o,placeholderId:l,...d}=e;return d}const s=t[e.placeholderId];if(!s||s.type!=="text"){const{isPlaceholder:o,placeholderId:l,...d}=e;return d}const{isPlaceholder:i,placeholderId:n,...a}=e;return{...a,text:s.value}}resolvePropertyPath(e,t){const s=t.split(".");let i=e;for(let o=0;o<s.length-1;o++){const l=s[o],d=l.match(/^(\w+)\[(\d+)\]$/);if(d){const[,u,h]=d,p=i[u];if(!Array.isArray(p))return null;const f=parseInt(h,10);if(f<0||f>=p.length)return null;i=p[f]}else{if(i[l]===void 0||i[l]===null||typeof i[l]!="object")return null;i=i[l]}}const n=s[s.length-1],a=n.match(/^(\w+)\[(\d+)\]$/);if(a){const[,o,l]=a,d=i[o];if(!Array.isArray(d))return null;const u=parseInt(l,10);return{parent:i,key:o,value:d[u]}}return{parent:i,key:n,value:i[n]}}setPropertyByPath(e,t,s){const i=this.resolvePropertyPath(e,t);if(!i)return!1;const{parent:n,key:a}=i,l=(t.split(".").pop()||"").match(/^(\w+)\[(\d+)\]$/);if(l){const[,d,u]=l,h=n[d];if(!Array.isArray(h))return!1;const p=parseInt(u,10);h[p]=s}else n[a]=s;return!0}validatePlaceholderValue(e,t){if(e.required&&(t==null||t===""))return{placeholderId:e.id,message:`${e.label} is required`,type:"missing"};if(t==null)return null;const s=e.constraints;switch(e.type){case"text":case"subtitle":if(typeof t!="string")return{placeholderId:e.id,message:`${e.label} must be a string`,type:"invalid"};if(s?.maxLength&&t.length>s.maxLength)return{placeholderId:e.id,message:`${e.label} exceeds maximum length of ${s.maxLength}`,type:"constraint"};if(s?.pattern&&!new RegExp(s.pattern).test(t))return{placeholderId:e.id,message:`${e.label} does not match required pattern`,type:"constraint"};break;case"number":if(typeof t!="number")return{placeholderId:e.id,message:`${e.label} must be a number`,type:"invalid"};if(s?.min!==void 0&&t<s.min)return{placeholderId:e.id,message:`${e.label} must be at least ${s.min}`,type:"constraint"};if(s?.max!==void 0&&t>s.max)return{placeholderId:e.id,message:`${e.label} must be at most ${s.max}`,type:"constraint"};break;case"boolean":if(typeof t!="boolean")return{placeholderId:e.id,message:`${e.label} must be a boolean`,type:"invalid"};break;case"color":if(typeof t!="string"||!/^#[0-9a-fA-F]{6}([0-9a-fA-F]{2})?$/.test(t))return{placeholderId:e.id,message:`${e.label} must be a valid hex color`,type:"invalid"};break}return s?.allowedValues&&!s.allowedValues.includes(String(t))?{placeholderId:e.id,message:`${e.label} must be one of: ${s.allowedValues.join(", ")}`,type:"constraint"}:null}applyScriptableTemplate(e,t){const s=[],i=[],n=[],a={...t};for(const h of e.placeholders){!a[h.id]&&h.defaultValue!==void 0&&(a[h.id]={type:h.type,value:h.defaultValue});const p=this.validatePlaceholderValue(h,a[h.id]?.value);p&&s.push(p)}const o=`project-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,l=JSON.parse(JSON.stringify(e.timeline));for(const h of e.placeholders){const p=a[h.id];if(p){for(const f of h.targets)this.applyPlaceholderToTarget(l,f,p.value,h,i);if(h.type==="text"){let f=!1;for(const m of h.targets)if(m.clipId)for(const g of l.tracks){const y=g.clips.find(x=>x.id===m.clipId);if(y){n.push({id:y.id,text:String(p.value??h.defaultValue??""),placeholderId:h.id,trackId:g.id,startTime:y.startTime,duration:y.duration,transform:y.transform}),f=!0;break}}if(!f)for(const m of l.tracks){for(const g of m.clips){const y=g;if(y.isPlaceholder&&y.placeholderId===h.id){n.push({id:g.id,text:String(p.value??h.defaultValue??""),placeholderId:h.id,trackId:m.id,startTime:g.startTime,duration:g.duration,transform:g.transform}),f=!0;break}}if(f)break}}}}const d=this.createMediaFromScriptableReplacements(a,e.placeholders);return{project:{id:o,name:`${e.name} - Copy`,createdAt:Date.now(),modifiedAt:Date.now(),settings:e.settings,mediaLibrary:{items:d},timeline:l},result:{success:s.length===0,errors:s,warnings:i},textClips:n}}applyPlaceholderToTarget(e,t,s,i,n){if(t.clipId){for(const a of e.tracks){const o=a.clips.find(l=>l.id===t.clipId);if(o){const l=o;this.setPropertyByPath(l,t.property,s)||n.push(`Failed to set ${t.property} on clip ${t.clipId}`);return}}n.push(`Clip ${t.clipId} not found for placeholder ${i.id}`)}else if(t.trackId){const a=e.tracks.find(o=>o.id===t.trackId);if(a){const o=a;this.setPropertyByPath(o,t.property,s)||n.push(`Failed to set ${t.property} on track ${t.trackId}`)}else n.push(`Track ${t.trackId} not found for placeholder ${i.id}`)}else if(t.effectId){for(const a of e.tracks)for(const o of a.clips){const l=o.effects.find(d=>d.id===t.effectId);if(l){const d=l;this.setPropertyByPath(d,t.property,s)||n.push(`Failed to set ${t.property} on effect ${t.effectId}`);return}}n.push(`Effect ${t.effectId} not found for placeholder ${i.id}`)}}createMediaFromScriptableReplacements(e,t){const s=[];for(const i of t){const n=e[i.id];if(n&&n.type==="media"&&n.mediaBlob){const a=n.mediaBlob,o=n.value;s.push({id:i.id,name:typeof o=="string"?o:i.label,type:"image",fileHandle:null,blob:a,metadata:{duration:0,width:1920,height:1080,frameRate:30,codec:"",sampleRate:0,channels:0,fileSize:a.size},thumbnailUrl:null,waveformData:null})}}return s}async saveTemplate(e){return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([_r],"readwrite").objectStore(_r).put(e);a.onerror=()=>s(a.error),a.onsuccess=()=>{this.templates.set(e.id,e),t()}})}async loadTemplate(e){return this.templates.has(e)?this.templates.get(e)||null:(this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([_r],"readonly").objectStore(_r).get(e);a.onerror=()=>s(a.error),a.onsuccess=()=>{const o=a.result;o&&this.templates.set(o.id,o),t(o||null)}}))}async deleteTemplate(e){if(e.startsWith("builtin-"))throw new Error("Cannot delete built-in templates");return this.db||await this.initialize(),new Promise((t,s)=>{const a=this.db.transaction([_r],"readwrite").objectStore(_r).delete(e);a.onerror=()=>s(a.error),a.onsuccess=()=>{this.templates.delete(e),t()}})}async listTemplates(){return this.db||await this.initialize(),new Promise((e,t)=>{const n=this.db.transaction([_r],"readonly").objectStore(_r).getAll();n.onerror=()=>t(n.error),n.onsuccess=()=>{const a=n.result.map(this.toSummary),o=qm.map(this.toSummary);e([...o,...a])}})}getTemplatesByCategory(e){const t=[];for(const s of this.templates.values())s.category===e&&t.push(s);return t}searchTemplates(e){const t=e.toLowerCase(),s=[];for(const i of this.templates.values()){const n=i.name.toLowerCase().includes(t),a=i.description.toLowerCase().includes(t),o=i.tags.some(l=>l.toLowerCase().includes(t));(n||a||o)&&s.push(i)}return s}toSummary(e){return{id:e.id,name:e.name,category:e.category,thumbnailUrl:e.thumbnailUrl,placeholderCount:e.placeholders.length,duration:e.timeline.duration}}getBuiltinTemplates(){return[...qm]}getAllTemplates(){return Array.from(this.templates.values())}}let QY=null;function JY(){return QY}const Ll={"16:9":{name:"Landscape (16:9)",ratio:16/9,width:1920,height:1080},"9:16":{name:"Portrait (9:16)",ratio:9/16,width:1080,height:1920},"1:1":{name:"Square (1:1)",ratio:1,width:1080,height:1080},"4:5":{name:"Portrait (4:5)",ratio:4/5,width:1080,height:1350},"4:3":{name:"Classic (4:3)",ratio:4/3,width:1440,height:1080},"21:9":{name:"Cinematic (21:9)",ratio:21/9,width:2560,height:1080},custom:{name:"Custom",ratio:16/9,width:1920,height:1080}},rh={youtube:{name:"YouTube",ratio:16/9,width:1920,height:1080,platform:"youtube"},tiktok:{name:"TikTok",ratio:9/16,width:1080,height:1920,platform:"tiktok"},"instagram-reels":{name:"Instagram Reels",ratio:9/16,width:1080,height:1920,platform:"instagram-reels"},"instagram-feed":{name:"Instagram Feed",ratio:1,width:1080,height:1080,platform:"instagram-feed"},"instagram-stories":{name:"Instagram Stories",ratio:9/16,width:1080,height:1920,platform:"instagram-stories"},"youtube-shorts":{name:"YouTube Shorts",ratio:9/16,width:1080,height:1920,platform:"youtube-shorts"},facebook:{name:"Facebook",ratio:16/9,width:1920,height:1080,platform:"facebook"},twitter:{name:"Twitter/X",ratio:16/9,width:1920,height:1080,platform:"twitter"},linkedin:{name:"LinkedIn",ratio:16/9,width:1920,height:1080,platform:"linkedin"}},ZY={targetAspectRatio:"9:16",trackingSpeed:.5,padding:.1,smoothing:.8,followSubject:!0,centerBias:.3};function cn(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function EM(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.__proto__=e}/*!
 * GSAP 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var Oi={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Yc={duration:.5,overwrite:!1,delay:0},Mb,$s,zt,ir=1e8,At=1/ir,ay=Math.PI*2,eq=ay/4,tq=0,MM=Math.sqrt,sq=Math.cos,iq=Math.sin,Ps=function(e){return typeof e=="string"},ss=function(e){return typeof e=="function"},kn=function(e){return typeof e=="number"},Pb=function(e){return typeof e>"u"},Yr=function(e){return typeof e=="object"},Si=function(e){return e!==!1},Nb=function(){return typeof window<"u"},nh=function(e){return ss(e)||Ps(e)},PM=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ei=Array.isArray,rq=/random\([^)]+\)/g,nq=/,\s*/g,AC=/(?:-?\.?\d|\.)+/gi,NM=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,yc=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Hm=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,RM=/[+-]=-?[.\d]+/,aq=/[^,'"\[\]\s]+/gi,oq=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,qt,Rr,oy,Rb,zi={},Mp={},IM,DM=function(e){return(Mp=qc(e,zi))&&Mi},Ib=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},tu=function(e,t){return!t&&console.warn(e)},FM=function(e,t){return e&&(zi[e]=t)&&Mp&&(Mp[e]=t)||zi},su=function(){return 0},cq={suppressEvents:!0,isStart:!0,kill:!1},$h={suppressEvents:!0,kill:!1},lq={suppressEvents:!0},Db={},ca=[],cy={},BM,Ri={},Xm={},jC=30,zh=[],Fb="",Bb=function(e){var t=e[0],s,i;if(Yr(t)||ss(t)||(e=[e]),!(s=(t._gsap||{}).harness)){for(i=zh.length;i--&&!zh[i].targetTest(t););s=zh[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new oP(e[i],s)))||e.splice(i,1);return e},yo=function(e){return e._gsap||Bb(rr(e))[0]._gsap},LM=function(e,t,s){return(s=e[t])&&ss(s)?e[t]():Pb(s)&&e.getAttribute&&e.getAttribute(t)||s},Ti=function(e,t){return(e=e.split(",")).forEach(t)||e},os=function(e){return Math.round(e*1e5)/1e5||0},Wt=function(e){return Math.round(e*1e7)/1e7||0},jc=function(e,t){var s=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),s==="+"?e+i:s==="-"?e-i:s==="*"?e*i:e/i},dq=function(e,t){for(var s=t.length,i=0;e.indexOf(t[i])<0&&++i<s;);return i<s},Pp=function(){var e=ca.length,t=ca.slice(0),s,i;for(cy={},ca.length=0,s=0;s<e;s++)i=t[s],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Lb=function(e){return!!(e._initted||e._startAt||e.add)},OM=function(e,t,s,i){ca.length&&!$s&&Pp(),e.render(t,s,!!($s&&t<0&&Lb(e))),ca.length&&!$s&&Pp()},$M=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(aq).length<2?t:Ps(e)?e.trim():e},zM=function(e){return e},Vi=function(e,t){for(var s in t)s in e||(e[s]=t[s]);return e},uq=function(e){return function(t,s){for(var i in s)i in t||i==="duration"&&e||i==="ease"||(t[i]=s[i])}},qc=function(e,t){for(var s in t)e[s]=t[s];return e},_C=function r(e,t){for(var s in t)s!=="__proto__"&&s!=="constructor"&&s!=="prototype"&&(e[s]=Yr(t[s])?r(e[s]||(e[s]={}),t[s]):t[s]);return e},Np=function(e,t){var s={},i;for(i in e)i in t||(s[i]=e[i]);return s},Ad=function(e){var t=e.parent||qt,s=e.keyframes?uq(ei(e.keyframes)):Vi;if(Si(e.inherit))for(;t;)s(e,t.vars.defaults),t=t.parent||t._dp;return e},hq=function(e,t){for(var s=e.length,i=s===t.length;i&&s--&&e[s]===t[s];);return s<0},VM=function(e,t,s,i,n){var a=e[i],o;if(n)for(o=t[n];a&&a[n]>o;)a=a._prev;return a?(t._next=a._next,a._next=t):(t._next=e[s],e[s]=t),t._next?t._next._prev=t:e[i]=t,t._prev=a,t.parent=t._dp=e,t},df=function(e,t,s,i){s===void 0&&(s="_first"),i===void 0&&(i="_last");var n=t._prev,a=t._next;n?n._next=a:e[s]===t&&(e[s]=a),a?a._prev=n:e[i]===t&&(e[i]=n),t._next=t._prev=t.parent=null},xa=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},xo=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var s=e;s;)s._dirty=1,s=s.parent;return e},pq=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},ly=function(e,t,s,i){return e._startAt&&($s?e._startAt.revert($h):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},fq=function r(e){return!e||e._ts&&r(e.parent)},EC=function(e){return e._repeat?Hc(e._tTime,e=e.duration()+e._rDelay)*e:0},Hc=function(e,t){var s=Math.floor(e=Wt(e/t));return e&&s===e?s-1:s},Rp=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},uf=function(e){return e._end=Wt(e._start+(e._tDur/Math.abs(e._ts||e._rts||At)||0))},hf=function(e,t){var s=e._dp;return s&&s.smoothChildTiming&&e._ts&&(e._start=Wt(s._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),uf(e),s._dirty||xo(s,e)),e},UM=function(e,t){var s;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(s=Rp(e.rawTime(),t),(!t._dur||Tu(0,t.totalDuration(),s)-t._tTime>At)&&t.render(s,!0)),xo(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(s=e;s._dp;)s.rawTime()>=0&&s.totalTime(s._tTime),s=s._dp;e._zTime=-At}},Dr=function(e,t,s,i){return t.parent&&xa(t),t._start=Wt((kn(s)?s:s||e!==qt?Ki(e,s,t):e._time)+t._delay),t._end=Wt(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),VM(e,t,"_first","_last",e._sort?"_start":0),dy(t)||(e._recent=t),i||UM(e,t),e._ts<0&&hf(e,e._tTime),e},GM=function(e,t){return(zi.ScrollTrigger||Ib("scrollTrigger",t))&&zi.ScrollTrigger.create(t,e)},WM=function(e,t,s,i,n){if($b(e,t,n),!e._initted)return 1;if(!s&&e._pt&&!$s&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&BM!==Di.frame)return ca.push(e),e._lazy=[n,i],1},mq=function r(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||r(t))},dy=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},gq=function(e,t,s,i){var n=e.ratio,a=t<0||!t&&(!e._start&&mq(e)&&!(!e._initted&&dy(e))||(e._ts<0||e._dp._ts<0)&&!dy(e))?0:1,o=e._rDelay,l=0,d,u,h;if(o&&e._repeat&&(l=Tu(0,e._tDur,t),u=Hc(l,o),e._yoyo&&u&1&&(a=1-a),u!==Hc(e._tTime,o)&&(n=1-a,e.vars.repeatRefresh&&e._initted&&e.invalidate())),a!==n||$s||i||e._zTime===At||!t&&e._zTime){if(!e._initted&&WM(e,t,i,s,l))return;for(h=e._zTime,e._zTime=t||(s?At:0),s||(s=t&&!h),e.ratio=a,e._from&&(a=1-a),e._time=0,e._tTime=l,d=e._pt;d;)d.r(a,d.d),d=d._next;t<0&&ly(e,t,s,!0),e._onUpdate&&!s&&Bi(e,"onUpdate"),l&&e._repeat&&!s&&e.parent&&Bi(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===a&&(a&&xa(e,1),!s&&!$s&&(Bi(e,a?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},yq=function(e,t,s){var i;if(s>t)for(i=e._first;i&&i._start<=s;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=s;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},Xc=function(e,t,s,i){var n=e._repeat,a=Wt(t)||0,o=e._tTime/e._tDur;return o&&!i&&(e._time*=a/e._dur),e._dur=a,e._tDur=n?n<0?1e10:Wt(a*(n+1)+e._rDelay*n):a,o>0&&!i&&hf(e,e._tTime=e._tDur*o),e.parent&&uf(e),s||xo(e.parent,e),e},MC=function(e){return e instanceof ai?xo(e):Xc(e,e._dur)},xq={_start:0,endTime:su,totalDuration:su},Ki=function r(e,t,s){var i=e.labels,n=e._recent||xq,a=e.duration()>=ir?n.endTime(!1):e._dur,o,l,d;return Ps(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),d=t.substr(-1)==="%",o=t.indexOf("="),l==="<"||l===">"?(o>=0&&(t=t.replace(/=/,"")),(l==="<"?n._start:n.endTime(n._repeat>=0))+(parseFloat(t.substr(1))||0)*(d?(o<0?n:s).totalDuration()/100:1)):o<0?(t in i||(i[t]=a),i[t]):(l=parseFloat(t.charAt(o-1)+t.substr(o+1)),d&&s&&(l=l/100*(ei(s)?s[0]:s).totalDuration()),o>1?r(e,t.substr(0,o-1),s)+l:a+l)):t==null?a:+t},jd=function(e,t,s){var i=kn(t[1]),n=(i?2:1)+(e<2?0:1),a=t[n],o,l;if(i&&(a.duration=t[1]),a.parent=s,e){for(o=a,l=s;l&&!("immediateRender"in o);)o=l.vars.defaults||{},l=Si(l.vars.inherit)&&l.parent;a.immediateRender=Si(o.immediateRender),e<2?a.runBackwards=1:a.startAt=t[n-1]}return new gs(t[0],a,t[n+1])},Ea=function(e,t){return e||e===0?t(e):t},Tu=function(e,t,s){return s<e?e:s>t?t:s},Xs=function(e,t){return!Ps(e)||!(t=oq.exec(e))?"":t[1]},bq=function(e,t,s){return Ea(s,function(i){return Tu(e,t,i)})},uy=[].slice,YM=function(e,t){return e&&Yr(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Yr(e[0]))&&!e.nodeType&&e!==Rr},vq=function(e,t,s){return s===void 0&&(s=[]),e.forEach(function(i){var n;return Ps(i)&&!t||YM(i,1)?(n=s).push.apply(n,rr(i)):s.push(i)})||s},rr=function(e,t,s){return zt&&!t&&zt.selector?zt.selector(e):Ps(e)&&!s&&(oy||!Kc())?uy.call((t||Rb).querySelectorAll(e),0):ei(e)?vq(e,s):YM(e)?uy.call(e,0):e?[e]:[]},hy=function(e){return e=rr(e)[0]||tu("Invalid scope")||{},function(t){var s=e.current||e.nativeElement||e;return rr(t,s.querySelectorAll?s:s===e?tu("Invalid scope")||Rb.createElement("div"):e)}},qM=function(e){return e.sort(function(){return .5-Math.random()})},HM=function(e){if(ss(e))return e;var t=Yr(e)?e:{each:e},s=bo(t.ease),i=t.from||0,n=parseFloat(t.base)||0,a={},o=i>0&&i<1,l=isNaN(i)||o,d=t.axis,u=i,h=i;return Ps(i)?u=h={center:.5,edges:.5,end:1}[i]||0:!o&&l&&(u=i[0],h=i[1]),function(p,f,m){var g=(m||t).length,y=a[g],x,b,w,C,k,S,A,T,j;if(!y){if(j=t.grid==="auto"?0:(t.grid||[1,ir])[1],!j){for(A=-ir;A<(A=m[j++].getBoundingClientRect().left)&&j<g;);j<g&&j--}for(y=a[g]=[],x=l?Math.min(j,g)*u-.5:i%j,b=j===ir?0:l?g*h/j-.5:i/j|0,A=0,T=ir,S=0;S<g;S++)w=S%j-x,C=b-(S/j|0),y[S]=k=d?Math.abs(d==="y"?C:w):MM(w*w+C*C),k>A&&(A=k),k<T&&(T=k);i==="random"&&qM(y),y.max=A-T,y.min=T,y.v=g=(parseFloat(t.amount)||parseFloat(t.each)*(j>g?g-1:d?d==="y"?g/j:j:Math.max(j,g/j))||0)*(i==="edges"?-1:1),y.b=g<0?n-g:n,y.u=Xs(t.amount||t.each)||0,s=s&&g<0?rP(s):s}return g=(y[p]-y.min)/y.max||0,Wt(y.b+(s?s(g):g)*y.v)+y.u}},py=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(s){var i=Wt(Math.round(parseFloat(s)/e)*e*t);return(i-i%1)/t+(kn(s)?0:Xs(s))}},XM=function(e,t){var s=ei(e),i,n;return!s&&Yr(e)&&(i=s=e.radius||ir,e.values?(e=rr(e.values),(n=!kn(e[0]))&&(i*=i)):e=py(e.increment)),Ea(t,s?ss(e)?function(a){return n=e(a),Math.abs(n-a)<=i?n:a}:function(a){for(var o=parseFloat(n?a.x:a),l=parseFloat(n?a.y:0),d=ir,u=0,h=e.length,p,f;h--;)n?(p=e[h].x-o,f=e[h].y-l,p=p*p+f*f):p=Math.abs(e[h]-o),p<d&&(d=p,u=h);return u=!i||d<=i?e[u]:a,n||u===a||kn(a)?u:u+Xs(a)}:py(e))},KM=function(e,t,s,i){return Ea(ei(e)?!t:s===!0?!!(s=0):!i,function(){return ei(e)?e[~~(Math.random()*e.length)]:(s=s||1e-5)&&(i=s<1?Math.pow(10,(s+"").length-2):1)&&Math.floor(Math.round((e-s/2+Math.random()*(t-e+s*.99))/s)*s*i)/i})},wq=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return function(i){return t.reduce(function(n,a){return a(n)},i)}},kq=function(e,t){return function(s){return e(parseFloat(s))+(t||Xs(s))}},Cq=function(e,t,s){return JM(e,t,0,1,s)},QM=function(e,t,s){return Ea(s,function(i){return e[~~t(i)]})},Sq=function r(e,t,s){var i=t-e;return ei(e)?QM(e,r(0,e.length),t):Ea(s,function(n){return(i+(n-e)%i)%i+e})},Tq=function r(e,t,s){var i=t-e,n=i*2;return ei(e)?QM(e,r(0,e.length-1),t):Ea(s,function(a){return a=(n+(a-e)%n)%n||0,e+(a>i?n-a:a)})},iu=function(e){return e.replace(rq,function(t){var s=t.indexOf("[")+1,i=t.substring(s||7,s?t.indexOf("]"):t.length-1).split(nq);return KM(s?i:+i[0],s?0:+i[1],+i[2]||1e-5)})},JM=function(e,t,s,i,n){var a=t-e,o=i-s;return Ea(n,function(l){return s+((l-e)/a*o||0)})},Aq=function r(e,t,s,i){var n=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!n){var a=Ps(e),o={},l,d,u,h,p;if(s===!0&&(i=1)&&(s=null),a)e={p:e},t={p:t};else if(ei(e)&&!ei(t)){for(u=[],h=e.length,p=h-2,d=1;d<h;d++)u.push(r(e[d-1],e[d]));h--,n=function(m){m*=h;var g=Math.min(p,~~m);return u[g](m-g)},s=t}else i||(e=qc(ei(e)?[]:{},e));if(!u){for(l in t)Ob.call(o,e,l,"get",t[l]);n=function(m){return Ub(m,o)||(a?e.p:e)}}}return Ea(s,n)},PC=function(e,t,s){var i=e.labels,n=ir,a,o,l;for(a in i)o=i[a]-t,o<0==!!s&&o&&n>(o=Math.abs(o))&&(l=a,n=o);return l},Bi=function(e,t,s){var i=e.vars,n=i[t],a=zt,o=e._ctx,l,d,u;if(n)return l=i[t+"Params"],d=i.callbackScope||e,s&&ca.length&&Pp(),o&&(zt=o),u=l?n.apply(d,l):n.call(d),zt=a,u},ad=function(e){return xa(e),e.scrollTrigger&&e.scrollTrigger.kill(!!$s),e.progress()<1&&Bi(e,"onInterrupt"),e},xc,ZM=[],eP=function(e){if(e)if(e=!e.name&&e.default||e,Nb()||e.headless){var t=e.name,s=ss(e),i=t&&!s&&e.init?function(){this._props=[]}:e,n={init:su,render:Ub,add:Ob,kill:Vq,modifier:zq,rawVars:0},a={targetTest:0,get:0,getSetter:Vb,aliases:{},register:0};if(Kc(),e!==i){if(Ri[t])return;Vi(i,Vi(Np(e,n),a)),qc(i.prototype,qc(n,Np(e,a))),Ri[i.prop=t]=i,e.targetTest&&(zh.push(i),Db[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}FM(t,i),e.register&&e.register(Mi,i,Ai)}else ZM.push(e)},Tt=255,od={aqua:[0,Tt,Tt],lime:[0,Tt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Tt],navy:[0,0,128],white:[Tt,Tt,Tt],olive:[128,128,0],yellow:[Tt,Tt,0],orange:[Tt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Tt,0,0],pink:[Tt,192,203],cyan:[0,Tt,Tt],transparent:[Tt,Tt,Tt,0]},Km=function(e,t,s){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(s-t)*e*6:e<.5?s:e*3<2?t+(s-t)*(2/3-e)*6:t)*Tt+.5|0},tP=function(e,t,s){var i=e?kn(e)?[e>>16,e>>8&Tt,e&Tt]:0:od.black,n,a,o,l,d,u,h,p,f,m;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),od[e])i=od[e];else if(e.charAt(0)==="#"){if(e.length<6&&(n=e.charAt(1),a=e.charAt(2),o=e.charAt(3),e="#"+n+n+a+a+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&Tt,i&Tt,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&Tt,e&Tt]}else if(e.substr(0,3)==="hsl"){if(i=m=e.match(AC),!t)l=+i[0]%360/360,d=+i[1]/100,u=+i[2]/100,a=u<=.5?u*(d+1):u+d-u*d,n=u*2-a,i.length>3&&(i[3]*=1),i[0]=Km(l+1/3,n,a),i[1]=Km(l,n,a),i[2]=Km(l-1/3,n,a);else if(~e.indexOf("="))return i=e.match(NM),s&&i.length<4&&(i[3]=1),i}else i=e.match(AC)||od.transparent;i=i.map(Number)}return t&&!m&&(n=i[0]/Tt,a=i[1]/Tt,o=i[2]/Tt,h=Math.max(n,a,o),p=Math.min(n,a,o),u=(h+p)/2,h===p?l=d=0:(f=h-p,d=u>.5?f/(2-h-p):f/(h+p),l=h===n?(a-o)/f+(a<o?6:0):h===a?(o-n)/f+2:(n-a)/f+4,l*=60),i[0]=~~(l+.5),i[1]=~~(d*100+.5),i[2]=~~(u*100+.5)),s&&i.length<4&&(i[3]=1),i},sP=function(e){var t=[],s=[],i=-1;return e.split(la).forEach(function(n){var a=n.match(yc)||[];t.push.apply(t,a),s.push(i+=a.length+1)}),t.c=s,t},NC=function(e,t,s){var i="",n=(e+i).match(la),a=t?"hsla(":"rgba(",o=0,l,d,u,h;if(!n)return e;if(n=n.map(function(p){return(p=tP(p,t,1))&&a+(t?p[0]+","+p[1]+"%,"+p[2]+"%,"+p[3]:p.join(","))+")"}),s&&(u=sP(e),l=s.c,l.join(i)!==u.c.join(i)))for(d=e.replace(la,"1").split(yc),h=d.length-1;o<h;o++)i+=d[o]+(~l.indexOf(o)?n.shift()||a+"0,0,0,0)":(u.length?u:n.length?n:s).shift());if(!d)for(d=e.split(la),h=d.length-1;o<h;o++)i+=d[o]+n[o];return i+d[h]},la=function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in od)r+="|"+e+"\\b";return new RegExp(r+")","gi")}(),jq=/hsl[a]?\(/,iP=function(e){var t=e.join(" "),s;if(la.lastIndex=0,la.test(t))return s=jq.test(t),e[1]=NC(e[1],s),e[0]=NC(e[0],s,sP(e[1])),!0},ru,Di=function(){var r=Date.now,e=500,t=33,s=r(),i=s,n=1e3/240,a=n,o=[],l,d,u,h,p,f,m=function g(y){var x=r()-i,b=y===!0,w,C,k,S;if((x>e||x<0)&&(s+=x-t),i+=x,k=i-s,w=k-a,(w>0||b)&&(S=++h.frame,p=k-h.time*1e3,h.time=k=k/1e3,a+=w+(w>=n?4:n-w),C=1),b||(l=d(g)),C)for(f=0;f<o.length;f++)o[f](k,p,S,y)};return h={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(y){return p/(1e3/(y||60))},wake:function(){IM&&(!oy&&Nb()&&(Rr=oy=window,Rb=Rr.document||{},zi.gsap=Mi,(Rr.gsapVersions||(Rr.gsapVersions=[])).push(Mi.version),DM(Mp||Rr.GreenSockGlobals||!Rr.gsap&&Rr||{}),ZM.forEach(eP)),u=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&h.sleep(),d=u||function(y){return setTimeout(y,a-h.time*1e3+1|0)},ru=1,m(2))},sleep:function(){(u?cancelAnimationFrame:clearTimeout)(l),ru=0,d=su},lagSmoothing:function(y,x){e=y||1/0,t=Math.min(x||33,e)},fps:function(y){n=1e3/(y||240),a=h.time*1e3+n},add:function(y,x,b){var w=x?function(C,k,S,A){y(C,k,S,A),h.remove(w)}:y;return h.remove(y),o[b?"unshift":"push"](w),Kc(),w},remove:function(y,x){~(x=o.indexOf(y))&&o.splice(x,1)&&f>=x&&f--},_listeners:o},h}(),Kc=function(){return!ru&&Di.wake()},lt={},_q=/^[\d.\-M][\d.\-,\s]/,Eq=/["']/g,Mq=function(e){for(var t={},s=e.substr(1,e.length-3).split(":"),i=s[0],n=1,a=s.length,o,l,d;n<a;n++)l=s[n],o=n!==a-1?l.lastIndexOf(","):l.length,d=l.substr(0,o),t[i]=isNaN(d)?d.replace(Eq,"").trim():+d,i=l.substr(o+1).trim();return t},Pq=function(e){var t=e.indexOf("(")+1,s=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<s?e.indexOf(")",s+1):s)},Nq=function(e){var t=(e+"").split("("),s=lt[t[0]];return s&&t.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[Mq(t[1])]:Pq(e).split(",").map($M)):lt._CE&&_q.test(e)?lt._CE("",e):s},rP=function(e){return function(t){return 1-e(1-t)}},nP=function r(e,t){for(var s=e._first,i;s;)s instanceof ai?r(s,t):s.vars.yoyoEase&&(!s._yoyo||!s._repeat)&&s._yoyo!==t&&(s.timeline?r(s.timeline,t):(i=s._ease,s._ease=s._yEase,s._yEase=i,s._yoyo=t)),s=s._next},bo=function(e,t){return e&&(ss(e)?e:lt[e]||Nq(e))||t},Po=function(e,t,s,i){s===void 0&&(s=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var n={easeIn:t,easeOut:s,easeInOut:i},a;return Ti(e,function(o){lt[o]=zi[o]=n,lt[a=o.toLowerCase()]=s;for(var l in n)lt[a+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=lt[o+"."+l]=n[l]}),n},aP=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},Qm=function r(e,t,s){var i=t>=1?t:1,n=(s||(e?.3:.45))/(t<1?t:1),a=n/ay*(Math.asin(1/i)||0),o=function(u){return u===1?1:i*Math.pow(2,-10*u)*iq((u-a)*n)+1},l=e==="out"?o:e==="in"?function(d){return 1-o(1-d)}:aP(o);return n=ay/n,l.config=function(d,u){return r(e,d,u)},l},Jm=function r(e,t){t===void 0&&(t=1.70158);var s=function(a){return a?--a*a*((t+1)*a+t)+1:0},i=e==="out"?s:e==="in"?function(n){return 1-s(1-n)}:aP(s);return i.config=function(n){return r(e,n)},i};Ti("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,e){var t=e<5?e+1:e;Po(r+",Power"+(t-1),e?function(s){return Math.pow(s,t)}:function(s){return s},function(s){return 1-Math.pow(1-s,t)},function(s){return s<.5?Math.pow(s*2,t)/2:1-Math.pow((1-s)*2,t)/2})});lt.Linear.easeNone=lt.none=lt.Linear.easeIn;Po("Elastic",Qm("in"),Qm("out"),Qm());(function(r,e){var t=1/e,s=2*t,i=2.5*t,n=function(o){return o<t?r*o*o:o<s?r*Math.pow(o-1.5/e,2)+.75:o<i?r*(o-=2.25/e)*o+.9375:r*Math.pow(o-2.625/e,2)+.984375};Po("Bounce",function(a){return 1-n(1-a)},n)})(7.5625,2.75);Po("Expo",function(r){return Math.pow(2,10*(r-1))*r+r*r*r*r*r*r*(1-r)});Po("Circ",function(r){return-(MM(1-r*r)-1)});Po("Sine",function(r){return r===1?1:-sq(r*eq)+1});Po("Back",Jm("in"),Jm("out"),Jm());lt.SteppedEase=lt.steps=zi.SteppedEase={config:function(e,t){e===void 0&&(e=1);var s=1/e,i=e+(t?0:1),n=t?1:0,a=1-At;return function(o){return((i*Tu(0,a,o)|0)+n)*s}}};Yc.ease=lt["quad.out"];Ti("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return Fb+=r+","+r+"Params,"});var oP=function(e,t){this.id=tq++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:LM,this.set=t?t.getSetter:Vb},nu=function(){function r(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Xc(this,+t.duration,1,1),this.data=t.data,zt&&(this._ctx=zt,zt.data.push(this)),ru||Di.wake()}var e=r.prototype;return e.delay=function(s){return s||s===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+s-this._delay),this._delay=s,this):this._delay},e.duration=function(s){return arguments.length?this.totalDuration(this._repeat>0?s+(s+this._rDelay)*this._repeat:s):this.totalDuration()&&this._dur},e.totalDuration=function(s){return arguments.length?(this._dirty=0,Xc(this,this._repeat<0?s:(s-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(s,i){if(Kc(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(hf(this,s),!n._dp||n.parent||UM(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&s<this._tDur||this._ts<0&&s>0||!this._tDur&&!s)&&Dr(this._dp,this,this._start-this._delay)}return(this._tTime!==s||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===At||!this._initted&&this._dur&&s||!s&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=s),OM(this,s,i)),this},e.time=function(s,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),s+EC(this))%(this._dur+this._rDelay)||(s?this._dur:0),i):this._time},e.totalProgress=function(s,i){return arguments.length?this.totalTime(this.totalDuration()*s,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(s,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-s:s)+EC(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(s,i){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(s-1)*n,i):this._repeat?Hc(this._tTime,n)+1:1},e.timeScale=function(s,i){if(!arguments.length)return this._rts===-At?0:this._rts;if(this._rts===s)return this;var n=this.parent&&this._ts?Rp(this.parent._time,this):this._tTime;return this._rts=+s||0,this._ts=this._ps||s===-At?0:this._rts,this.totalTime(Tu(-Math.abs(this._delay),this.totalDuration(),n),i!==!1),uf(this),pq(this)},e.paused=function(s){return arguments.length?(this._ps!==s&&(this._ps=s,s?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Kc(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==At&&(this._tTime-=At)))),this):this._ps},e.startTime=function(s){if(arguments.length){this._start=Wt(s);var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Dr(i,this,this._start-this._delay),this}return this._start},e.endTime=function(s){return this._start+(Si(s)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(s){var i=this.parent||this._dp;return i?s&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Rp(i.rawTime(s),this):this._tTime:this._tTime},e.revert=function(s){s===void 0&&(s=lq);var i=$s;return $s=s,Lb(this)&&(this.timeline&&this.timeline.revert(s),this.totalTime(-.01,s.suppressEvents)),this.data!=="nested"&&s.kill!==!1&&this.kill(),$s=i,this},e.globalTime=function(s){for(var i=this,n=arguments.length?s:i.rawTime();i;)n=i._start+n/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(s):n},e.repeat=function(s){return arguments.length?(this._repeat=s===1/0?-2:s,MC(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(s){if(arguments.length){var i=this._time;return this._rDelay=s,MC(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(s){return arguments.length?(this._yoyo=s,this):this._yoyo},e.seek=function(s,i){return this.totalTime(Ki(this,s),Si(i))},e.restart=function(s,i){return this.play().totalTime(s?-this._delay:0,Si(i)),this._dur||(this._zTime=-At),this},e.play=function(s,i){return s!=null&&this.seek(s,i),this.reversed(!1).paused(!1)},e.reverse=function(s,i){return s!=null&&this.seek(s||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(s,i){return s!=null&&this.seek(s,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(s){return arguments.length?(!!s!==this.reversed()&&this.timeScale(-this._rts||(s?-At:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-At,this},e.isActive=function(){var s=this.parent||this._dp,i=this._start,n;return!!(!s||this._ts&&this._initted&&s.isActive()&&(n=s.rawTime(!0))>=i&&n<this.endTime(!0)-At)},e.eventCallback=function(s,i,n){var a=this.vars;return arguments.length>1?(i?(a[s]=i,n&&(a[s+"Params"]=n),s==="onUpdate"&&(this._onUpdate=i)):delete a[s],this):a[s]},e.then=function(s){var i=this,n=i._prom;return new Promise(function(a){var o=ss(s)?s:zM,l=function(){var u=i.then;i.then=null,n&&n(),ss(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=u),a(o),i.then=u};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?l():i._prom=l})},e.kill=function(){ad(this)},r}();Vi(nu.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-At,_prom:0,_ps:!1,_rts:1});var ai=function(r){EM(e,r);function e(s,i){var n;return s===void 0&&(s={}),n=r.call(this,s)||this,n.labels={},n.smoothChildTiming=!!s.smoothChildTiming,n.autoRemoveChildren=!!s.autoRemoveChildren,n._sort=Si(s.sortChildren),qt&&Dr(s.parent||qt,cn(n),i),s.reversed&&n.reverse(),s.paused&&n.paused(!0),s.scrollTrigger&&GM(cn(n),s.scrollTrigger),n}var t=e.prototype;return t.to=function(i,n,a){return jd(0,arguments,this),this},t.from=function(i,n,a){return jd(1,arguments,this),this},t.fromTo=function(i,n,a,o){return jd(2,arguments,this),this},t.set=function(i,n,a){return n.duration=0,n.parent=this,Ad(n).repeatDelay||(n.repeat=0),n.immediateRender=!!n.immediateRender,new gs(i,n,Ki(this,a),1),this},t.call=function(i,n,a){return Dr(this,gs.delayedCall(0,i,n),a)},t.staggerTo=function(i,n,a,o,l,d,u){return a.duration=n,a.stagger=a.stagger||o,a.onComplete=d,a.onCompleteParams=u,a.parent=this,new gs(i,a,Ki(this,l)),this},t.staggerFrom=function(i,n,a,o,l,d,u){return a.runBackwards=1,Ad(a).immediateRender=Si(a.immediateRender),this.staggerTo(i,n,a,o,l,d,u)},t.staggerFromTo=function(i,n,a,o,l,d,u,h){return o.startAt=a,Ad(o).immediateRender=Si(o.immediateRender),this.staggerTo(i,n,o,l,d,u,h)},t.render=function(i,n,a){var o=this._time,l=this._dirty?this.totalDuration():this._tDur,d=this._dur,u=i<=0?0:Wt(i),h=this._zTime<0!=i<0&&(this._initted||!d),p,f,m,g,y,x,b,w,C,k,S,A;if(this!==qt&&u>l&&i>=0&&(u=l),u!==this._tTime||a||h){if(o!==this._time&&d&&(u+=this._time-o,i+=this._time-o),p=u,C=this._start,w=this._ts,x=!w,h&&(d||(o=this._zTime),(i||!n)&&(this._zTime=i)),this._repeat){if(S=this._yoyo,y=d+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(y*100+i,n,a);if(p=Wt(u%y),u===l?(g=this._repeat,p=d):(k=Wt(u/y),g=~~k,g&&g===k&&(p=d,g--),p>d&&(p=d)),k=Hc(this._tTime,y),!o&&this._tTime&&k!==g&&this._tTime-k*y-this._dur<=0&&(k=g),S&&g&1&&(p=d-p,A=1),g!==k&&!this._lock){var T=S&&k&1,j=T===(S&&g&1);if(g<k&&(T=!T),o=T?0:u%d?d:u,this._lock=1,this.render(o||(A?0:Wt(g*y)),n,!d)._lock=0,this._tTime=u,!n&&this.parent&&Bi(this,"onRepeat"),this.vars.repeatRefresh&&!A&&(this.invalidate()._lock=1,k=g),o&&o!==this._time||x!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(d=this._dur,l=this._tDur,j&&(this._lock=2,o=T?d:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!A&&this.invalidate()),this._lock=0,!this._ts&&!x)return this;nP(this,A)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(b=yq(this,Wt(o),Wt(p)),b&&(u-=p-(p=b._start))),this._tTime=u,this._time=p,this._act=!w,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,o=0),!o&&u&&d&&!n&&!k&&(Bi(this,"onStart"),this._tTime!==u))return this;if(p>=o&&i>=0)for(f=this._first;f;){if(m=f._next,(f._act||p>=f._start)&&f._ts&&b!==f){if(f.parent!==this)return this.render(i,n,a);if(f.render(f._ts>0?(p-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(p-f._start)*f._ts,n,a),p!==this._time||!this._ts&&!x){b=0,m&&(u+=this._zTime=-At);break}}f=m}else{f=this._last;for(var _=i<0?i:p;f;){if(m=f._prev,(f._act||_<=f._end)&&f._ts&&b!==f){if(f.parent!==this)return this.render(i,n,a);if(f.render(f._ts>0?(_-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(_-f._start)*f._ts,n,a||$s&&Lb(f)),p!==this._time||!this._ts&&!x){b=0,m&&(u+=this._zTime=_?-At:At);break}}f=m}}if(b&&!n&&(this.pause(),b.render(p>=o?0:-At)._zTime=p>=o?1:-1,this._ts))return this._start=C,uf(this),this.render(i,n,a);this._onUpdate&&!n&&Bi(this,"onUpdate",!0),(u===l&&this._tTime>=this.totalDuration()||!u&&o)&&(C===this._start||Math.abs(w)!==Math.abs(this._ts))&&(this._lock||((i||!d)&&(u===l&&this._ts>0||!u&&this._ts<0)&&xa(this,1),!n&&!(i<0&&!o)&&(u||o||!l)&&(Bi(this,u===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,n){var a=this;if(kn(n)||(n=Ki(this,n,i)),!(i instanceof nu)){if(ei(i))return i.forEach(function(o){return a.add(o,n)}),this;if(Ps(i))return this.addLabel(i,n);if(ss(i))i=gs.delayedCall(0,i);else return this}return this!==i?Dr(this,i,n):this},t.getChildren=function(i,n,a,o){i===void 0&&(i=!0),n===void 0&&(n=!0),a===void 0&&(a=!0),o===void 0&&(o=-ir);for(var l=[],d=this._first;d;)d._start>=o&&(d instanceof gs?n&&l.push(d):(a&&l.push(d),i&&l.push.apply(l,d.getChildren(!0,n,a)))),d=d._next;return l},t.getById=function(i){for(var n=this.getChildren(1,1,1),a=n.length;a--;)if(n[a].vars.id===i)return n[a]},t.remove=function(i){return Ps(i)?this.removeLabel(i):ss(i)?this.killTweensOf(i):(i.parent===this&&df(this,i),i===this._recent&&(this._recent=this._last),xo(this))},t.totalTime=function(i,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Wt(Di.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),r.prototype.totalTime.call(this,i,n),this._forcing=0,this):this._tTime},t.addLabel=function(i,n){return this.labels[i]=Ki(this,n),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,n,a){var o=gs.delayedCall(0,n||su,a);return o.data="isPause",this._hasPause=1,Dr(this,o,Ki(this,i))},t.removePause=function(i){var n=this._first;for(i=Ki(this,i);n;)n._start===i&&n.data==="isPause"&&xa(n),n=n._next},t.killTweensOf=function(i,n,a){for(var o=this.getTweensOf(i,a),l=o.length;l--;)Zn!==o[l]&&o[l].kill(i,n);return this},t.getTweensOf=function(i,n){for(var a=[],o=rr(i),l=this._first,d=kn(n),u;l;)l instanceof gs?dq(l._targets,o)&&(d?(!Zn||l._initted&&l._ts)&&l.globalTime(0)<=n&&l.globalTime(l.totalDuration())>n:!n||l.isActive())&&a.push(l):(u=l.getTweensOf(o,n)).length&&a.push.apply(a,u),l=l._next;return a},t.tweenTo=function(i,n){n=n||{};var a=this,o=Ki(a,i),l=n,d=l.startAt,u=l.onStart,h=l.onStartParams,p=l.immediateRender,f,m=gs.to(a,Vi({ease:n.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:n.duration||Math.abs((o-(d&&"time"in d?d.time:a._time))/a.timeScale())||At,onStart:function(){if(a.pause(),!f){var y=n.duration||Math.abs((o-(d&&"time"in d?d.time:a._time))/a.timeScale());m._dur!==y&&Xc(m,y,0,1).render(m._time,!0,!0),f=1}u&&u.apply(m,h||[])}},n));return p?m.render(0):m},t.tweenFromTo=function(i,n,a){return this.tweenTo(n,Vi({startAt:{time:Ki(this,i)}},a))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),PC(this,Ki(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),PC(this,Ki(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+At)},t.shiftChildren=function(i,n,a){a===void 0&&(a=0);var o=this._first,l=this.labels,d;for(i=Wt(i);o;)o._start>=a&&(o._start+=i,o._end+=i),o=o._next;if(n)for(d in l)l[d]>=a&&(l[d]+=i);return xo(this)},t.invalidate=function(i){var n=this._first;for(this._lock=0;n;)n.invalidate(i),n=n._next;return r.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var n=this._first,a;n;)a=n._next,this.remove(n),n=a;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),xo(this)},t.totalDuration=function(i){var n=0,a=this,o=a._last,l=ir,d,u,h;if(arguments.length)return a.timeScale((a._repeat<0?a.duration():a.totalDuration())/(a.reversed()?-i:i));if(a._dirty){for(h=a.parent;o;)d=o._prev,o._dirty&&o.totalDuration(),u=o._start,u>l&&a._sort&&o._ts&&!a._lock?(a._lock=1,Dr(a,o,u-o._delay,1)._lock=0):l=u,u<0&&o._ts&&(n-=u,(!h&&!a._dp||h&&h.smoothChildTiming)&&(a._start+=Wt(u/a._ts),a._time-=u,a._tTime-=u),a.shiftChildren(-u,!1,-1/0),l=0),o._end>n&&o._ts&&(n=o._end),o=d;Xc(a,a===qt&&a._time>n?a._time:n,1,1),a._dirty=0}return a._tDur},e.updateRoot=function(i){if(qt._ts&&(OM(qt,Rp(i,qt)),BM=Di.frame),Di.frame>=jC){jC+=Oi.autoSleep||120;var n=qt._first;if((!n||!n._ts)&&Oi.autoSleep&&Di._listeners.length<2){for(;n&&!n._ts;)n=n._next;n||Di.sleep()}}},e}(nu);Vi(ai.prototype,{_lock:0,_hasPause:0,_forcing:0});var Rq=function(e,t,s,i,n,a,o){var l=new Ai(this._pt,e,t,0,1,pP,null,n),d=0,u=0,h,p,f,m,g,y,x,b;for(l.b=s,l.e=i,s+="",i+="",(x=~i.indexOf("random("))&&(i=iu(i)),a&&(b=[s,i],a(b,e,t),s=b[0],i=b[1]),p=s.match(Hm)||[];h=Hm.exec(i);)m=h[0],g=i.substring(d,h.index),f?f=(f+1)%5:g.substr(-5)==="rgba("&&(f=1),m!==p[u++]&&(y=parseFloat(p[u-1])||0,l._pt={_next:l._pt,p:g||u===1?g:",",s:y,c:m.charAt(1)==="="?jc(y,m)-y:parseFloat(m)-y,m:f&&f<4?Math.round:0},d=Hm.lastIndex);return l.c=d<i.length?i.substring(d,i.length):"",l.fp=o,(RM.test(i)||x)&&(l.e=0),this._pt=l,l},Ob=function(e,t,s,i,n,a,o,l,d,u){ss(i)&&(i=i(n||0,e,a));var h=e[t],p=s!=="get"?s:ss(h)?d?e[t.indexOf("set")||!ss(e["get"+t.substr(3)])?t:"get"+t.substr(3)](d):e[t]():h,f=ss(h)?d?Lq:uP:zb,m;if(Ps(i)&&(~i.indexOf("random(")&&(i=iu(i)),i.charAt(1)==="="&&(m=jc(p,i)+(Xs(p)||0),(m||m===0)&&(i=m))),!u||p!==i||fy)return!isNaN(p*i)&&i!==""?(m=new Ai(this._pt,e,t,+p||0,i-(p||0),typeof h=="boolean"?$q:hP,0,f),d&&(m.fp=d),o&&m.modifier(o,this,e),this._pt=m):(!h&&!(t in e)&&Ib(t,i),Rq.call(this,e,t,p,i,f,l||Oi.stringFilter,d))},Iq=function(e,t,s,i,n){if(ss(e)&&(e=_d(e,n,t,s,i)),!Yr(e)||e.style&&e.nodeType||ei(e)||PM(e))return Ps(e)?_d(e,n,t,s,i):e;var a={},o;for(o in e)a[o]=_d(e[o],n,t,s,i);return a},cP=function(e,t,s,i,n,a){var o,l,d,u;if(Ri[e]&&(o=new Ri[e]).init(n,o.rawVars?t[e]:Iq(t[e],i,n,a,s),s,i,a)!==!1&&(s._pt=l=new Ai(s._pt,n,e,0,1,o.render,o,0,o.priority),s!==xc))for(d=s._ptLookup[s._targets.indexOf(n)],u=o._props.length;u--;)d[o._props[u]]=l;return o},Zn,fy,$b=function r(e,t,s){var i=e.vars,n=i.ease,a=i.startAt,o=i.immediateRender,l=i.lazy,d=i.onUpdate,u=i.runBackwards,h=i.yoyoEase,p=i.keyframes,f=i.autoRevert,m=e._dur,g=e._startAt,y=e._targets,x=e.parent,b=x&&x.data==="nested"?x.vars.targets:y,w=e._overwrite==="auto"&&!Mb,C=e.timeline,k,S,A,T,j,_,M,P,R,D,B,O,F;if(C&&(!p||!n)&&(n="none"),e._ease=bo(n,Yc.ease),e._yEase=h?rP(bo(h===!0?n:h,Yc.ease)):0,h&&e._yoyo&&!e._repeat&&(h=e._yEase,e._yEase=e._ease,e._ease=h),e._from=!C&&!!i.runBackwards,!C||p&&!i.stagger){if(P=y[0]?yo(y[0]).harness:0,O=P&&i[P.prop],k=Np(i,Db),g&&(g._zTime<0&&g.progress(1),t<0&&u&&o&&!f?g.render(-1,!0):g.revert(u&&m?$h:cq),g._lazy=0),a){if(xa(e._startAt=gs.set(y,Vi({data:"isStart",overwrite:!1,parent:x,immediateRender:!0,lazy:!g&&Si(l),startAt:null,delay:0,onUpdate:d&&function(){return Bi(e,"onUpdate")},stagger:0},a))),e._startAt._dp=0,e._startAt._sat=e,t<0&&($s||!o&&!f)&&e._startAt.revert($h),o&&m&&t<=0&&s<=0){t&&(e._zTime=t);return}}else if(u&&m&&!g){if(t&&(o=!1),A=Vi({overwrite:!1,data:"isFromStart",lazy:o&&!g&&Si(l),immediateRender:o,stagger:0,parent:x},k),O&&(A[P.prop]=O),xa(e._startAt=gs.set(y,A)),e._startAt._dp=0,e._startAt._sat=e,t<0&&($s?e._startAt.revert($h):e._startAt.render(-1,!0)),e._zTime=t,!o)r(e._startAt,At,At);else if(!t)return}for(e._pt=e._ptCache=0,l=m&&Si(l)||l&&!m,S=0;S<y.length;S++){if(j=y[S],M=j._gsap||Bb(y)[S]._gsap,e._ptLookup[S]=D={},cy[M.id]&&ca.length&&Pp(),B=b===y?S:b.indexOf(j),P&&(R=new P).init(j,O||k,e,B,b)!==!1&&(e._pt=T=new Ai(e._pt,j,R.name,0,1,R.render,R,0,R.priority),R._props.forEach(function(I){D[I]=T}),R.priority&&(_=1)),!P||O)for(A in k)Ri[A]&&(R=cP(A,k,e,B,j,b))?R.priority&&(_=1):D[A]=T=Ob.call(e,j,A,"get",k[A],B,b,0,i.stringFilter);e._op&&e._op[S]&&e.kill(j,e._op[S]),w&&e._pt&&(Zn=e,qt.killTweensOf(j,D,e.globalTime(t)),F=!e.parent,Zn=0),e._pt&&l&&(cy[M.id]=1)}_&&fP(e),e._onInit&&e._onInit(e)}e._onUpdate=d,e._initted=(!e._op||e._pt)&&!F,p&&t<=0&&C.render(ir,!0,!0)},Dq=function(e,t,s,i,n,a,o,l){var d=(e._pt&&e._ptCache||(e._ptCache={}))[t],u,h,p,f;if(!d)for(d=e._ptCache[t]=[],p=e._ptLookup,f=e._targets.length;f--;){if(u=p[f][t],u&&u.d&&u.d._pt)for(u=u.d._pt;u&&u.p!==t&&u.fp!==t;)u=u._next;if(!u)return fy=1,e.vars[t]="+=0",$b(e,o),fy=0,l?tu(t+" not eligible for reset"):1;d.push(u)}for(f=d.length;f--;)h=d[f],u=h._pt||h,u.s=(i||i===0)&&!n?i:u.s+(i||0)+a*u.c,u.c=s-u.s,h.e&&(h.e=os(s)+Xs(h.e)),h.b&&(h.b=u.s+Xs(h.b))},Fq=function(e,t){var s=e[0]?yo(e[0]).harness:0,i=s&&s.aliases,n,a,o,l;if(!i)return t;n=qc({},t);for(a in i)if(a in n)for(l=i[a].split(","),o=l.length;o--;)n[l[o]]=n[a];return n},Bq=function(e,t,s,i){var n=t.ease||i||"power1.inOut",a,o;if(ei(t))o=s[e]||(s[e]=[]),t.forEach(function(l,d){return o.push({t:d/(t.length-1)*100,v:l,e:n})});else for(a in t)o=s[a]||(s[a]=[]),a==="ease"||o.push({t:parseFloat(e),v:t[a],e:n})},_d=function(e,t,s,i,n){return ss(e)?e.call(t,s,i,n):Ps(e)&&~e.indexOf("random(")?iu(e):e},lP=Fb+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",dP={};Ti(lP+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return dP[r]=1});var gs=function(r){EM(e,r);function e(s,i,n,a){var o;typeof i=="number"&&(n.duration=i,i=n,n=null),o=r.call(this,a?i:Ad(i))||this;var l=o.vars,d=l.duration,u=l.delay,h=l.immediateRender,p=l.stagger,f=l.overwrite,m=l.keyframes,g=l.defaults,y=l.scrollTrigger,x=l.yoyoEase,b=i.parent||qt,w=(ei(s)||PM(s)?kn(s[0]):"length"in i)?[s]:rr(s),C,k,S,A,T,j,_,M;if(o._targets=w.length?Bb(w):tu("GSAP target "+s+" not found. https://gsap.com",!Oi.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=f,m||p||nh(d)||nh(u)){if(i=o.vars,C=o.timeline=new ai({data:"nested",defaults:g||{},targets:b&&b.data==="nested"?b.vars.targets:w}),C.kill(),C.parent=C._dp=cn(o),C._start=0,p||nh(d)||nh(u)){if(A=w.length,_=p&&HM(p),Yr(p))for(T in p)~lP.indexOf(T)&&(M||(M={}),M[T]=p[T]);for(k=0;k<A;k++)S=Np(i,dP),S.stagger=0,x&&(S.yoyoEase=x),M&&qc(S,M),j=w[k],S.duration=+_d(d,cn(o),k,j,w),S.delay=(+_d(u,cn(o),k,j,w)||0)-o._delay,!p&&A===1&&S.delay&&(o._delay=u=S.delay,o._start+=u,S.delay=0),C.to(j,S,_?_(k,j,w):0),C._ease=lt.none;C.duration()?d=u=0:o.timeline=0}else if(m){Ad(Vi(C.vars.defaults,{ease:"none"})),C._ease=bo(m.ease||i.ease||"none");var P=0,R,D,B;if(ei(m))m.forEach(function(O){return C.to(w,O,">")}),C.duration();else{S={};for(T in m)T==="ease"||T==="easeEach"||Bq(T,m[T],S,m.easeEach);for(T in S)for(R=S[T].sort(function(O,F){return O.t-F.t}),P=0,k=0;k<R.length;k++)D=R[k],B={ease:D.e,duration:(D.t-(k?R[k-1].t:0))/100*d},B[T]=D.v,C.to(w,B,P),P+=B.duration;C.duration()<d&&C.to({},{duration:d-C.duration()})}}d||o.duration(d=C.duration())}else o.timeline=0;return f===!0&&!Mb&&(Zn=cn(o),qt.killTweensOf(w),Zn=0),Dr(b,cn(o),n),i.reversed&&o.reverse(),i.paused&&o.paused(!0),(h||!d&&!m&&o._start===Wt(b._time)&&Si(h)&&fq(cn(o))&&b.data!=="nested")&&(o._tTime=-At,o.render(Math.max(0,-u)||0)),y&&GM(cn(o),y),o}var t=e.prototype;return t.render=function(i,n,a){var o=this._time,l=this._tDur,d=this._dur,u=i<0,h=i>l-At&&!u?l:i<At?0:i,p,f,m,g,y,x,b,w,C;if(!d)gq(this,i,n,a);else if(h!==this._tTime||!i||a||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==u||this._lazy){if(p=h,w=this.timeline,this._repeat){if(g=d+this._rDelay,this._repeat<-1&&u)return this.totalTime(g*100+i,n,a);if(p=Wt(h%g),h===l?(m=this._repeat,p=d):(y=Wt(h/g),m=~~y,m&&m===y?(p=d,m--):p>d&&(p=d)),x=this._yoyo&&m&1,x&&(C=this._yEase,p=d-p),y=Hc(this._tTime,g),p===o&&!a&&this._initted&&m===y)return this._tTime=h,this;m!==y&&(w&&this._yEase&&nP(w,x),this.vars.repeatRefresh&&!x&&!this._lock&&p!==g&&this._initted&&(this._lock=a=1,this.render(Wt(g*m),!0).invalidate()._lock=0))}if(!this._initted){if(WM(this,u?i:p,a,n,h))return this._tTime=0,this;if(o!==this._time&&!(a&&this.vars.repeatRefresh&&m!==y))return this;if(d!==this._dur)return this.render(i,n,a)}if(this._tTime=h,this._time=p,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=b=(C||this._ease)(p/d),this._from&&(this.ratio=b=1-b),!o&&h&&!n&&!y&&(Bi(this,"onStart"),this._tTime!==h))return this;for(f=this._pt;f;)f.r(b,f.d),f=f._next;w&&w.render(i<0?i:w._dur*w._ease(p/this._dur),n,a)||this._startAt&&(this._zTime=i),this._onUpdate&&!n&&(u&&ly(this,i,n,a),Bi(this,"onUpdate")),this._repeat&&m!==y&&this.vars.onRepeat&&!n&&this.parent&&Bi(this,"onRepeat"),(h===this._tDur||!h)&&this._tTime===h&&(u&&!this._onUpdate&&ly(this,i,!0,!0),(i||!d)&&(h===this._tDur&&this._ts>0||!h&&this._ts<0)&&xa(this,1),!n&&!(u&&!o)&&(h||o||x)&&(Bi(this,h===l?"onComplete":"onReverseComplete",!0),this._prom&&!(h<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),r.prototype.invalidate.call(this,i)},t.resetTo=function(i,n,a,o,l){ru||Di.wake(),this._ts||this.play();var d=Math.min(this._dur,(this._dp._time-this._start)*this._ts),u;return this._initted||$b(this,d),u=this._ease(d/this._dur),Dq(this,i,n,a,o,u,d,l)?this.resetTo(i,n,a,o,1):(hf(this,0),this.parent||VM(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,n){if(n===void 0&&(n="all"),!i&&(!n||n==="all"))return this._lazy=this._pt=0,this.parent?ad(this):this.scrollTrigger&&this.scrollTrigger.kill(!!$s),this;if(this.timeline){var a=this.timeline.totalDuration();return this.timeline.killTweensOf(i,n,Zn&&Zn.vars.overwrite!==!0)._first||ad(this),this.parent&&a!==this.timeline.totalDuration()&&Xc(this,this._dur*this.timeline._tDur/a,0,1),this}var o=this._targets,l=i?rr(i):o,d=this._ptLookup,u=this._pt,h,p,f,m,g,y,x;if((!n||n==="all")&&hq(o,l))return n==="all"&&(this._pt=0),ad(this);for(h=this._op=this._op||[],n!=="all"&&(Ps(n)&&(g={},Ti(n,function(b){return g[b]=1}),n=g),n=Fq(o,n)),x=o.length;x--;)if(~l.indexOf(o[x])){p=d[x],n==="all"?(h[x]=n,m=p,f={}):(f=h[x]=h[x]||{},m=n);for(g in m)y=p&&p[g],y&&((!("kill"in y.d)||y.d.kill(g)===!0)&&df(this,y,"_pt"),delete p[g]),f!=="all"&&(f[g]=1)}return this._initted&&!this._pt&&u&&ad(this),this},e.to=function(i,n){return new e(i,n,arguments[2])},e.from=function(i,n){return jd(1,arguments)},e.delayedCall=function(i,n,a,o){return new e(n,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:n,onReverseComplete:n,onCompleteParams:a,onReverseCompleteParams:a,callbackScope:o})},e.fromTo=function(i,n,a){return jd(2,arguments)},e.set=function(i,n){return n.duration=0,n.repeatDelay||(n.repeat=0),new e(i,n)},e.killTweensOf=function(i,n,a){return qt.killTweensOf(i,n,a)},e}(nu);Vi(gs.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Ti("staggerTo,staggerFrom,staggerFromTo",function(r){gs[r]=function(){var e=new ai,t=uy.call(arguments,0);return t.splice(r==="staggerFromTo"?5:4,0,0),e[r].apply(e,t)}});var zb=function(e,t,s){return e[t]=s},uP=function(e,t,s){return e[t](s)},Lq=function(e,t,s,i){return e[t](i.fp,s)},Oq=function(e,t,s){return e.setAttribute(t,s)},Vb=function(e,t){return ss(e[t])?uP:Pb(e[t])&&e.setAttribute?Oq:zb},hP=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},$q=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},pP=function(e,t){var s=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;s;)i=s.p+(s.m?s.m(s.s+s.c*e):Math.round((s.s+s.c*e)*1e4)/1e4)+i,s=s._next;i+=t.c}t.set(t.t,t.p,i,t)},Ub=function(e,t){for(var s=t._pt;s;)s.r(e,s.d),s=s._next},zq=function(e,t,s,i){for(var n=this._pt,a;n;)a=n._next,n.p===i&&n.modifier(e,t,s),n=a},Vq=function(e){for(var t=this._pt,s,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?df(this,t,"_pt"):t.dep||(s=1),t=i;return!s},Uq=function(e,t,s,i){i.mSet(e,t,i.m.call(i.tween,s,i.mt),i)},fP=function(e){for(var t=e._pt,s,i,n,a;t;){for(s=t._next,i=n;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:a)?t._prev._next=t:n=t,(t._next=i)?i._prev=t:a=t,t=s}e._pt=n},Ai=function(){function r(t,s,i,n,a,o,l,d,u){this.t=s,this.s=n,this.c=a,this.p=i,this.r=o||hP,this.d=l||this,this.set=d||zb,this.pr=u||0,this._next=t,t&&(t._prev=this)}var e=r.prototype;return e.modifier=function(s,i,n){this.mSet=this.mSet||this.set,this.set=Uq,this.m=s,this.mt=n,this.tween=i},r}();Ti(Fb+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return Db[r]=1});zi.TweenMax=zi.TweenLite=gs;zi.TimelineLite=zi.TimelineMax=ai;qt=new ai({sortChildren:!1,defaults:Yc,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Oi.stringFilter=iP;var vo=[],Vh={},Gq=[],RC=0,Wq=0,Zm=function(e){return(Vh[e]||Gq).map(function(t){return t()})},my=function(){var e=Date.now(),t=[];e-RC>2&&(Zm("matchMediaInit"),vo.forEach(function(s){var i=s.queries,n=s.conditions,a,o,l,d;for(o in i)a=Rr.matchMedia(i[o]).matches,a&&(l=1),a!==n[o]&&(n[o]=a,d=1);d&&(s.revert(),l&&t.push(s))}),Zm("matchMediaRevert"),t.forEach(function(s){return s.onMatch(s,function(i){return s.add(null,i)})}),RC=e,Zm("matchMedia"))},mP=function(){function r(t,s){this.selector=s&&hy(s),this.data=[],this._r=[],this.isReverted=!1,this.id=Wq++,t&&this.add(t)}var e=r.prototype;return e.add=function(s,i,n){ss(s)&&(n=i,i=s,s=ss);var a=this,o=function(){var d=zt,u=a.selector,h;return d&&d!==a&&d.data.push(a),n&&(a.selector=hy(n)),zt=a,h=i.apply(a,arguments),ss(h)&&a._r.push(h),zt=d,a.selector=u,a.isReverted=!1,h};return a.last=o,s===ss?o(a,function(l){return a.add(null,l)}):s?a[s]=o:o},e.ignore=function(s){var i=zt;zt=null,s(this),zt=i},e.getTweens=function(){var s=[];return this.data.forEach(function(i){return i instanceof r?s.push.apply(s,i.getTweens()):i instanceof gs&&!(i.parent&&i.parent.data==="nested")&&s.push(i)}),s},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(s,i){var n=this;if(s?function(){for(var o=n.getTweens(),l=n.data.length,d;l--;)d=n.data[l],d.data==="isFlip"&&(d.revert(),d.getChildren(!0,!0,!1).forEach(function(u){return o.splice(o.indexOf(u),1)}));for(o.map(function(u){return{g:u._dur||u._delay||u._sat&&!u._sat.vars.immediateRender?u.globalTime(0):-1/0,t:u}}).sort(function(u,h){return h.g-u.g||-1/0}).forEach(function(u){return u.t.revert(s)}),l=n.data.length;l--;)d=n.data[l],d instanceof ai?d.data!=="nested"&&(d.scrollTrigger&&d.scrollTrigger.revert(),d.kill()):!(d instanceof gs)&&d.revert&&d.revert(s);n._r.forEach(function(u){return u(s,n)}),n.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),i)for(var a=vo.length;a--;)vo[a].id===this.id&&vo.splice(a,1)},e.revert=function(s){this.kill(s||{})},r}(),Yq=function(){function r(t){this.contexts=[],this.scope=t,zt&&zt.data.push(this)}var e=r.prototype;return e.add=function(s,i,n){Yr(s)||(s={matches:s});var a=new mP(0,n||this.scope),o=a.conditions={},l,d,u;zt&&!a.selector&&(a.selector=zt.selector),this.contexts.push(a),i=a.add("onMatch",i),a.queries=s;for(d in s)d==="all"?u=1:(l=Rr.matchMedia(s[d]),l&&(vo.indexOf(a)<0&&vo.push(a),(o[d]=l.matches)&&(u=1),l.addListener?l.addListener(my):l.addEventListener("change",my)));return u&&i(a,function(h){return a.add(null,h)}),this},e.revert=function(s){this.kill(s||{})},e.kill=function(s){this.contexts.forEach(function(i){return i.kill(s,!0)})},r}(),Ip={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];t.forEach(function(i){return eP(i)})},timeline:function(e){return new ai(e)},getTweensOf:function(e,t){return qt.getTweensOf(e,t)},getProperty:function(e,t,s,i){Ps(e)&&(e=rr(e)[0]);var n=yo(e||{}).get,a=s?zM:$M;return s==="native"&&(s=""),e&&(t?a((Ri[t]&&Ri[t].get||n)(e,t,s,i)):function(o,l,d){return a((Ri[o]&&Ri[o].get||n)(e,o,l,d))})},quickSetter:function(e,t,s){if(e=rr(e),e.length>1){var i=e.map(function(u){return Mi.quickSetter(u,t,s)}),n=i.length;return function(u){for(var h=n;h--;)i[h](u)}}e=e[0]||{};var a=Ri[t],o=yo(e),l=o.harness&&(o.harness.aliases||{})[t]||t,d=a?function(u){var h=new a;xc._pt=0,h.init(e,s?u+s:u,xc,0,[e]),h.render(1,h),xc._pt&&Ub(1,xc)}:o.set(e,l);return a?d:function(u){return d(e,l,s?u+s:u,o,1)}},quickTo:function(e,t,s){var i,n=Mi.to(e,Vi((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),s||{})),a=function(l,d,u){return n.resetTo(t,l,d,u)};return a.tween=n,a},isTweening:function(e){return qt.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=bo(e.ease,Yc.ease)),_C(Yc,e||{})},config:function(e){return _C(Oi,e||{})},registerEffect:function(e){var t=e.name,s=e.effect,i=e.plugins,n=e.defaults,a=e.extendTimeline;(i||"").split(",").forEach(function(o){return o&&!Ri[o]&&!zi[o]&&tu(t+" effect requires "+o+" plugin.")}),Xm[t]=function(o,l,d){return s(rr(o),Vi(l||{},n),d)},a&&(ai.prototype[t]=function(o,l,d){return this.add(Xm[t](o,Yr(l)?l:(d=l)&&{},this),d)})},registerEase:function(e,t){lt[e]=bo(t)},parseEase:function(e,t){return arguments.length?bo(e,t):lt},getById:function(e){return qt.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var s=new ai(e),i,n;for(s.smoothChildTiming=Si(e.smoothChildTiming),qt.remove(s),s._dp=0,s._time=s._tTime=qt._time,i=qt._first;i;)n=i._next,(t||!(!i._dur&&i instanceof gs&&i.vars.onComplete===i._targets[0]))&&Dr(s,i,i._start-i._delay),i=n;return Dr(qt,s,0),s},context:function(e,t){return e?new mP(e,t):zt},matchMedia:function(e){return new Yq(e)},matchMediaRefresh:function(){return vo.forEach(function(e){var t=e.conditions,s,i;for(i in t)t[i]&&(t[i]=!1,s=1);s&&e.revert()})||my()},addEventListener:function(e,t){var s=Vh[e]||(Vh[e]=[]);~s.indexOf(t)||s.push(t)},removeEventListener:function(e,t){var s=Vh[e],i=s&&s.indexOf(t);i>=0&&s.splice(i,1)},utils:{wrap:Sq,wrapYoyo:Tq,distribute:HM,random:KM,snap:XM,normalize:Cq,getUnit:Xs,clamp:bq,splitColor:tP,toArray:rr,selector:hy,mapRange:JM,pipe:wq,unitize:kq,interpolate:Aq,shuffle:qM},install:DM,effects:Xm,ticker:Di,updateRoot:ai.updateRoot,plugins:Ri,globalTimeline:qt,core:{PropTween:Ai,globals:FM,Tween:gs,Timeline:ai,Animation:nu,getCache:yo,_removeLinkedListItem:df,reverting:function(){return $s},context:function(e){return e&&zt&&(zt.data.push(e),e._ctx=zt),zt},suppressOverwrites:function(e){return Mb=e}}};Ti("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return Ip[r]=gs[r]});Di.add(ai.updateRoot);xc=Ip.to({},{duration:0});var qq=function(e,t){for(var s=e._pt;s&&s.p!==t&&s.op!==t&&s.fp!==t;)s=s._next;return s},Hq=function(e,t){var s=e._targets,i,n,a;for(i in t)for(n=s.length;n--;)a=e._ptLookup[n][i],a&&(a=a.d)&&(a._pt&&(a=qq(a,i)),a&&a.modifier&&a.modifier(t[i],e,s[n],i))},eg=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,n,a){a._onInit=function(o){var l,d;if(Ps(n)&&(l={},Ti(n,function(u){return l[u]=1}),n=l),t){l={};for(d in n)l[d]=t(n[d]);n=l}Hq(o,n)}}}},Mi=Ip.registerPlugin({name:"attr",init:function(e,t,s,i,n){var a,o,l;this.tween=s;for(a in t)l=e.getAttribute(a)||"",o=this.add(e,"setAttribute",(l||0)+"",t[a],i,n,0,0,a),o.op=a,o.b=l,this._props.push(a)},render:function(e,t){for(var s=t._pt;s;)$s?s.set(s.t,s.p,s.b,s):s.r(e,s.d),s=s._next}},{name:"endArray",headless:1,init:function(e,t){for(var s=t.length;s--;)this.add(e,s,e[s]||0,t[s],0,0,0,0,0,1)}},eg("roundProps",py),eg("modifiers"),eg("snap",XM))||Ip;gs.version=ai.version=Mi.version="3.14.2";IM=1;Nb()&&Kc();lt.Power0;lt.Power1;lt.Power2;lt.Power3;lt.Power4;lt.Linear;lt.Quad;lt.Cubic;lt.Quart;lt.Quint;lt.Strong;lt.Elastic;lt.Back;lt.SteppedEase;lt.Bounce;lt.Sine;lt.Expo;lt.Circ;/*!
 * CSSPlugin 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var IC,ea,_c,Gb,ho,DC,Wb,Xq=function(){return typeof window<"u"},Cn={},eo=180/Math.PI,Ec=Math.PI/180,qo=Math.atan2,FC=1e8,Yb=/([A-Z])/g,Kq=/(left|right|width|margin|padding|x)/i,Qq=/[\s,\(]\S/,Lr={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},gy=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Jq=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Zq=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},eH=function(e,t){return t.set(t.t,t.p,e===1?t.e:e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},tH=function(e,t){var s=t.s+t.c*e;t.set(t.t,t.p,~~(s+(s<0?-.5:.5))+t.u,t)},gP=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},yP=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},sH=function(e,t,s){return e.style[t]=s},iH=function(e,t,s){return e.style.setProperty(t,s)},rH=function(e,t,s){return e._gsap[t]=s},nH=function(e,t,s){return e._gsap.scaleX=e._gsap.scaleY=s},aH=function(e,t,s,i,n){var a=e._gsap;a.scaleX=a.scaleY=s,a.renderTransform(n,a)},oH=function(e,t,s,i,n){var a=e._gsap;a[t]=s,a.renderTransform(n,a)},Qt="transform",ji=Qt+"Origin",cH=function r(e,t){var s=this,i=this.target,n=i.style,a=i._gsap;if(e in Cn&&n){if(this.tfm=this.tfm||{},e!=="transform")e=Lr[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return s.tfm[o]=dn(i,o)}):this.tfm[e]=a.x?a[e]:dn(i,e),e===ji&&(this.tfm.zOrigin=a.zOrigin);else return Lr.transform.split(",").forEach(function(o){return r.call(s,o,t)});if(this.props.indexOf(Qt)>=0)return;a.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(ji,t,"")),e=Qt}(n||t)&&this.props.push(e,t,n[e])},xP=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},lH=function(){var e=this.props,t=this.target,s=t.style,i=t._gsap,n,a;for(n=0;n<e.length;n+=3)e[n+1]?e[n+1]===2?t[e[n]](e[n+2]):t[e[n]]=e[n+2]:e[n+2]?s[e[n]]=e[n+2]:s.removeProperty(e[n].substr(0,2)==="--"?e[n]:e[n].replace(Yb,"-$1").toLowerCase());if(this.tfm){for(a in this.tfm)i[a]=this.tfm[a];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),n=Wb(),(!n||!n.isStart)&&!s[Qt]&&(xP(s),i.zOrigin&&s[ji]&&(s[ji]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},bP=function(e,t){var s={target:e,props:[],revert:lH,save:cH};return e._gsap||Mi.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return s.save(i)}),s},vP,yy=function(e,t){var s=ea.createElementNS?ea.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):ea.createElement(e);return s&&s.style?s:ea.createElement(e)},Li=function r(e,t,s){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(Yb,"-$1").toLowerCase())||i.getPropertyValue(t)||!s&&r(e,Qc(t)||t,1)||""},BC="O,Moz,ms,Ms,Webkit".split(","),Qc=function(e,t,s){var i=t||ho,n=i.style,a=5;if(e in n&&!s)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);a--&&!(BC[a]+e in n););return a<0?null:(a===3?"ms":a>=0?BC[a]:"")+e},xy=function(){Xq()&&window.document&&(IC=window,ea=IC.document,_c=ea.documentElement,ho=yy("div")||{style:{}},yy("div"),Qt=Qc(Qt),ji=Qt+"Origin",ho.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",vP=!!Qc("perspective"),Wb=Mi.core.reverting,Gb=1)},LC=function(e){var t=e.ownerSVGElement,s=yy("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),n;i.style.display="block",s.appendChild(i),_c.appendChild(s);try{n=i.getBBox()}catch{}return s.removeChild(i),_c.removeChild(s),n},OC=function(e,t){for(var s=t.length;s--;)if(e.hasAttribute(t[s]))return e.getAttribute(t[s])},wP=function(e){var t,s;try{t=e.getBBox()}catch{t=LC(e),s=1}return t&&(t.width||t.height)||s||(t=LC(e)),t&&!t.width&&!t.x&&!t.y?{x:+OC(e,["x","cx","x1"])||0,y:+OC(e,["y","cy","y1"])||0,width:0,height:0}:t},kP=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&wP(e))},ba=function(e,t){if(t){var s=e.style,i;t in Cn&&t!==ji&&(t=Qt),s.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),s.removeProperty(i==="--"?t:t.replace(Yb,"-$1").toLowerCase())):s.removeAttribute(t)}},ta=function(e,t,s,i,n,a){var o=new Ai(e._pt,t,s,0,1,a?yP:gP);return e._pt=o,o.b=i,o.e=n,e._props.push(s),o},$C={deg:1,rad:1,turn:1},dH={grid:1,flex:1},va=function r(e,t,s,i){var n=parseFloat(s)||0,a=(s+"").trim().substr((n+"").length)||"px",o=ho.style,l=Kq.test(t),d=e.tagName.toLowerCase()==="svg",u=(d?"client":"offset")+(l?"Width":"Height"),h=100,p=i==="px",f=i==="%",m,g,y,x;if(i===a||!n||$C[i]||$C[a])return n;if(a!=="px"&&!p&&(n=r(e,t,s,"px")),x=e.getCTM&&kP(e),(f||a==="%")&&(Cn[t]||~t.indexOf("adius")))return m=x?e.getBBox()[l?"width":"height"]:e[u],os(f?n/m*h:n/100*m);if(o[l?"width":"height"]=h+(p?a:i),g=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!d?e:e.parentNode,x&&(g=(e.ownerSVGElement||{}).parentNode),(!g||g===ea||!g.appendChild)&&(g=ea.body),y=g._gsap,y&&f&&y.width&&l&&y.time===Di.time&&!y.uncache)return os(n/y.width*h);if(f&&(t==="height"||t==="width")){var b=e.style[t];e.style[t]=h+i,m=e[u],b?e.style[t]=b:ba(e,t)}else(f||a==="%")&&!dH[Li(g,"display")]&&(o.position=Li(e,"position")),g===e&&(o.position="static"),g.appendChild(ho),m=ho[u],g.removeChild(ho),o.position="absolute";return l&&f&&(y=yo(g),y.time=Di.time,y.width=g[u]),os(p?m*n/h:m&&n?h/m*n:0)},dn=function(e,t,s,i){var n;return Gb||xy(),t in Lr&&t!=="transform"&&(t=Lr[t],~t.indexOf(",")&&(t=t.split(",")[0])),Cn[t]&&t!=="transform"?(n=ou(e,i),n=t!=="transformOrigin"?n[t]:n.svg?n.origin:Fp(Li(e,ji))+" "+n.zOrigin+"px"):(n=e.style[t],(!n||n==="auto"||i||~(n+"").indexOf("calc("))&&(n=Dp[t]&&Dp[t](e,t,s)||Li(e,t)||LM(e,t)||(t==="opacity"?1:0))),s&&!~(n+"").trim().indexOf(" ")?va(e,t,n,s)+s:n},uH=function(e,t,s,i){if(!s||s==="none"){var n=Qc(t,e,1),a=n&&Li(e,n,1);a&&a!==s?(t=n,s=a):t==="borderColor"&&(s=Li(e,"borderTopColor"))}var o=new Ai(this._pt,e.style,t,0,1,pP),l=0,d=0,u,h,p,f,m,g,y,x,b,w,C,k;if(o.b=s,o.e=i,s+="",i+="",i.substring(0,6)==="var(--"&&(i=Li(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(g=e.style[t],e.style[t]=i,i=Li(e,t)||i,g?e.style[t]=g:ba(e,t)),u=[s,i],iP(u),s=u[0],i=u[1],p=s.match(yc)||[],k=i.match(yc)||[],k.length){for(;h=yc.exec(i);)y=h[0],b=i.substring(l,h.index),m?m=(m+1)%5:(b.substr(-5)==="rgba("||b.substr(-5)==="hsla(")&&(m=1),y!==(g=p[d++]||"")&&(f=parseFloat(g)||0,C=g.substr((f+"").length),y.charAt(1)==="="&&(y=jc(f,y)+C),x=parseFloat(y),w=y.substr((x+"").length),l=yc.lastIndex-w.length,w||(w=w||Oi.units[t]||C,l===i.length&&(i+=w,o.e+=w)),C!==w&&(f=va(e,t,g,w)||0),o._pt={_next:o._pt,p:b||d===1?b:",",s:f,c:x-f,m:m&&m<4||t==="zIndex"?Math.round:0});o.c=l<i.length?i.substring(l,i.length):""}else o.r=t==="display"&&i==="none"?yP:gP;return RM.test(i)&&(o.e=0),this._pt=o,o},zC={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},hH=function(e){var t=e.split(" "),s=t[0],i=t[1]||"50%";return(s==="top"||s==="bottom"||i==="left"||i==="right")&&(e=s,s=i,i=e),t[0]=zC[s]||s,t[1]=zC[i]||i,t.join(" ")},pH=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var s=t.t,i=s.style,n=t.u,a=s._gsap,o,l,d;if(n==="all"||n===!0)i.cssText="",l=1;else for(n=n.split(","),d=n.length;--d>-1;)o=n[d],Cn[o]&&(l=1,o=o==="transformOrigin"?ji:Qt),ba(s,o);l&&(ba(s,Qt),a&&(a.svg&&s.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",ou(s,1),a.uncache=1,xP(i)))}},Dp={clearProps:function(e,t,s,i,n){if(n.data!=="isFromStart"){var a=e._pt=new Ai(e._pt,t,s,0,0,pH);return a.u=i,a.pr=-10,a.tween=n,e._props.push(s),1}}},au=[1,0,0,1,0,0],CP={},SP=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},VC=function(e){var t=Li(e,Qt);return SP(t)?au:t.substr(7).match(NM).map(os)},qb=function(e,t){var s=e._gsap||yo(e),i=e.style,n=VC(e),a,o,l,d;return s.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,n=[l.a,l.b,l.c,l.d,l.e,l.f],n.join(",")==="1,0,0,1,0,0"?au:n):(n===au&&!e.offsetParent&&e!==_c&&!s.svg&&(l=i.display,i.display="block",a=e.parentNode,(!a||!e.offsetParent&&!e.getBoundingClientRect().width)&&(d=1,o=e.nextElementSibling,_c.appendChild(e)),n=VC(e),l?i.display=l:ba(e,"display"),d&&(o?a.insertBefore(e,o):a?a.appendChild(e):_c.removeChild(e))),t&&n.length>6?[n[0],n[1],n[4],n[5],n[12],n[13]]:n)},by=function(e,t,s,i,n,a){var o=e._gsap,l=n||qb(e,!0),d=o.xOrigin||0,u=o.yOrigin||0,h=o.xOffset||0,p=o.yOffset||0,f=l[0],m=l[1],g=l[2],y=l[3],x=l[4],b=l[5],w=t.split(" "),C=parseFloat(w[0])||0,k=parseFloat(w[1])||0,S,A,T,j;s?l!==au&&(A=f*y-m*g)&&(T=C*(y/A)+k*(-g/A)+(g*b-y*x)/A,j=C*(-m/A)+k*(f/A)-(f*b-m*x)/A,C=T,k=j):(S=wP(e),C=S.x+(~w[0].indexOf("%")?C/100*S.width:C),k=S.y+(~(w[1]||w[0]).indexOf("%")?k/100*S.height:k)),i||i!==!1&&o.smooth?(x=C-d,b=k-u,o.xOffset=h+(x*f+b*g)-x,o.yOffset=p+(x*m+b*y)-b):o.xOffset=o.yOffset=0,o.xOrigin=C,o.yOrigin=k,o.smooth=!!i,o.origin=t,o.originIsAbsolute=!!s,e.style[ji]="0px 0px",a&&(ta(a,o,"xOrigin",d,C),ta(a,o,"yOrigin",u,k),ta(a,o,"xOffset",h,o.xOffset),ta(a,o,"yOffset",p,o.yOffset)),e.setAttribute("data-svg-origin",C+" "+k)},ou=function(e,t){var s=e._gsap||new oP(e);if("x"in s&&!t&&!s.uncache)return s;var i=e.style,n=s.scaleX<0,a="px",o="deg",l=getComputedStyle(e),d=Li(e,ji)||"0",u,h,p,f,m,g,y,x,b,w,C,k,S,A,T,j,_,M,P,R,D,B,O,F,I,J,Z,E,G,V,U,oe;return u=h=p=g=y=x=b=w=C=0,f=m=1,s.svg=!!(e.getCTM&&kP(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(i[Qt]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[Qt]!=="none"?l[Qt]:"")),i.scale=i.rotate=i.translate="none"),A=qb(e,s.svg),s.svg&&(s.uncache?(I=e.getBBox(),d=s.xOrigin-I.x+"px "+(s.yOrigin-I.y)+"px",F=""):F=!t&&e.getAttribute("data-svg-origin"),by(e,F||d,!!F||s.originIsAbsolute,s.smooth!==!1,A)),k=s.xOrigin||0,S=s.yOrigin||0,A!==au&&(M=A[0],P=A[1],R=A[2],D=A[3],u=B=A[4],h=O=A[5],A.length===6?(f=Math.sqrt(M*M+P*P),m=Math.sqrt(D*D+R*R),g=M||P?qo(P,M)*eo:0,b=R||D?qo(R,D)*eo+g:0,b&&(m*=Math.abs(Math.cos(b*Ec))),s.svg&&(u-=k-(k*M+S*R),h-=S-(k*P+S*D))):(oe=A[6],V=A[7],Z=A[8],E=A[9],G=A[10],U=A[11],u=A[12],h=A[13],p=A[14],T=qo(oe,G),y=T*eo,T&&(j=Math.cos(-T),_=Math.sin(-T),F=B*j+Z*_,I=O*j+E*_,J=oe*j+G*_,Z=B*-_+Z*j,E=O*-_+E*j,G=oe*-_+G*j,U=V*-_+U*j,B=F,O=I,oe=J),T=qo(-R,G),x=T*eo,T&&(j=Math.cos(-T),_=Math.sin(-T),F=M*j-Z*_,I=P*j-E*_,J=R*j-G*_,U=D*_+U*j,M=F,P=I,R=J),T=qo(P,M),g=T*eo,T&&(j=Math.cos(T),_=Math.sin(T),F=M*j+P*_,I=B*j+O*_,P=P*j-M*_,O=O*j-B*_,M=F,B=I),y&&Math.abs(y)+Math.abs(g)>359.9&&(y=g=0,x=180-x),f=os(Math.sqrt(M*M+P*P+R*R)),m=os(Math.sqrt(O*O+oe*oe)),T=qo(B,O),b=Math.abs(T)>2e-4?T*eo:0,C=U?1/(U<0?-U:U):0),s.svg&&(F=e.getAttribute("transform"),s.forceCSS=e.setAttribute("transform","")||!SP(Li(e,Qt)),F&&e.setAttribute("transform",F))),Math.abs(b)>90&&Math.abs(b)<270&&(n?(f*=-1,b+=g<=0?180:-180,g+=g<=0?180:-180):(m*=-1,b+=b<=0?180:-180)),t=t||s.uncache,s.x=u-((s.xPercent=u&&(!t&&s.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-u)?-50:0)))?e.offsetWidth*s.xPercent/100:0)+a,s.y=h-((s.yPercent=h&&(!t&&s.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-h)?-50:0)))?e.offsetHeight*s.yPercent/100:0)+a,s.z=p+a,s.scaleX=os(f),s.scaleY=os(m),s.rotation=os(g)+o,s.rotationX=os(y)+o,s.rotationY=os(x)+o,s.skewX=b+o,s.skewY=w+o,s.transformPerspective=C+a,(s.zOrigin=parseFloat(d.split(" ")[2])||!t&&s.zOrigin||0)&&(i[ji]=Fp(d)),s.xOffset=s.yOffset=0,s.force3D=Oi.force3D,s.renderTransform=s.svg?mH:vP?TP:fH,s.uncache=0,s},Fp=function(e){return(e=e.split(" "))[0]+" "+e[1]},tg=function(e,t,s){var i=Xs(t);return os(parseFloat(t)+parseFloat(va(e,"x",s+"px",i)))+i},fH=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,TP(e,t)},Ua="0deg",Ol="0px",Ga=") ",TP=function(e,t){var s=t||this,i=s.xPercent,n=s.yPercent,a=s.x,o=s.y,l=s.z,d=s.rotation,u=s.rotationY,h=s.rotationX,p=s.skewX,f=s.skewY,m=s.scaleX,g=s.scaleY,y=s.transformPerspective,x=s.force3D,b=s.target,w=s.zOrigin,C="",k=x==="auto"&&e&&e!==1||x===!0;if(w&&(h!==Ua||u!==Ua)){var S=parseFloat(u)*Ec,A=Math.sin(S),T=Math.cos(S),j;S=parseFloat(h)*Ec,j=Math.cos(S),a=tg(b,a,A*j*-w),o=tg(b,o,-Math.sin(S)*-w),l=tg(b,l,T*j*-w+w)}y!==Ol&&(C+="perspective("+y+Ga),(i||n)&&(C+="translate("+i+"%, "+n+"%) "),(k||a!==Ol||o!==Ol||l!==Ol)&&(C+=l!==Ol||k?"translate3d("+a+", "+o+", "+l+") ":"translate("+a+", "+o+Ga),d!==Ua&&(C+="rotate("+d+Ga),u!==Ua&&(C+="rotateY("+u+Ga),h!==Ua&&(C+="rotateX("+h+Ga),(p!==Ua||f!==Ua)&&(C+="skew("+p+", "+f+Ga),(m!==1||g!==1)&&(C+="scale("+m+", "+g+Ga),b.style[Qt]=C||"translate(0, 0)"},mH=function(e,t){var s=t||this,i=s.xPercent,n=s.yPercent,a=s.x,o=s.y,l=s.rotation,d=s.skewX,u=s.skewY,h=s.scaleX,p=s.scaleY,f=s.target,m=s.xOrigin,g=s.yOrigin,y=s.xOffset,x=s.yOffset,b=s.forceCSS,w=parseFloat(a),C=parseFloat(o),k,S,A,T,j;l=parseFloat(l),d=parseFloat(d),u=parseFloat(u),u&&(u=parseFloat(u),d+=u,l+=u),l||d?(l*=Ec,d*=Ec,k=Math.cos(l)*h,S=Math.sin(l)*h,A=Math.sin(l-d)*-p,T=Math.cos(l-d)*p,d&&(u*=Ec,j=Math.tan(d-u),j=Math.sqrt(1+j*j),A*=j,T*=j,u&&(j=Math.tan(u),j=Math.sqrt(1+j*j),k*=j,S*=j)),k=os(k),S=os(S),A=os(A),T=os(T)):(k=h,T=p,S=A=0),(w&&!~(a+"").indexOf("px")||C&&!~(o+"").indexOf("px"))&&(w=va(f,"x",a,"px"),C=va(f,"y",o,"px")),(m||g||y||x)&&(w=os(w+m-(m*k+g*A)+y),C=os(C+g-(m*S+g*T)+x)),(i||n)&&(j=f.getBBox(),w=os(w+i/100*j.width),C=os(C+n/100*j.height)),j="matrix("+k+","+S+","+A+","+T+","+w+","+C+")",f.setAttribute("transform",j),b&&(f.style[Qt]=j)},gH=function(e,t,s,i,n){var a=360,o=Ps(n),l=parseFloat(n)*(o&&~n.indexOf("rad")?eo:1),d=l-i,u=i+d+"deg",h,p;return o&&(h=n.split("_")[1],h==="short"&&(d%=a,d!==d%(a/2)&&(d+=d<0?a:-a)),h==="cw"&&d<0?d=(d+a*FC)%a-~~(d/a)*a:h==="ccw"&&d>0&&(d=(d-a*FC)%a-~~(d/a)*a)),e._pt=p=new Ai(e._pt,t,s,i,d,Jq),p.e=u,p.u="deg",e._props.push(s),p},UC=function(e,t){for(var s in t)e[s]=t[s];return e},yH=function(e,t,s){var i=UC({},s._gsap),n="perspective,force3D,transformOrigin,svgOrigin",a=s.style,o,l,d,u,h,p,f,m;i.svg?(d=s.getAttribute("transform"),s.setAttribute("transform",""),a[Qt]=t,o=ou(s,1),ba(s,Qt),s.setAttribute("transform",d)):(d=getComputedStyle(s)[Qt],a[Qt]=t,o=ou(s,1),a[Qt]=d);for(l in Cn)d=i[l],u=o[l],d!==u&&n.indexOf(l)<0&&(f=Xs(d),m=Xs(u),h=f!==m?va(s,l,d,m):parseFloat(d),p=parseFloat(u),e._pt=new Ai(e._pt,o,l,h,p-h,gy),e._pt.u=m||0,e._props.push(l));UC(o,i)};Ti("padding,margin,Width,Radius",function(r,e){var t="Top",s="Right",i="Bottom",n="Left",a=(e<3?[t,s,i,n]:[t+n,t+s,i+s,i+n]).map(function(o){return e<2?r+o:"border"+o+r});Dp[e>1?"border"+r:r]=function(o,l,d,u,h){var p,f;if(arguments.length<4)return p=a.map(function(m){return dn(o,m,d)}),f=p.join(" "),f.split(p[0]).length===5?p[0]:f;p=(u+"").split(" "),f={},a.forEach(function(m,g){return f[m]=p[g]=p[g]||p[(g-1)/2|0]}),o.init(l,f,h)}});var AP={name:"css",register:xy,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,s,i,n){var a=this._props,o=e.style,l=s.vars.startAt,d,u,h,p,f,m,g,y,x,b,w,C,k,S,A,T,j;Gb||xy(),this.styles=this.styles||bP(e),T=this.styles.props,this.tween=s;for(g in t)if(g!=="autoRound"&&(u=t[g],!(Ri[g]&&cP(g,t,s,i,e,n)))){if(f=typeof u,m=Dp[g],f==="function"&&(u=u.call(s,i,e,n),f=typeof u),f==="string"&&~u.indexOf("random(")&&(u=iu(u)),m)m(this,e,g,u,s)&&(A=1);else if(g.substr(0,2)==="--")d=(getComputedStyle(e).getPropertyValue(g)+"").trim(),u+="",la.lastIndex=0,la.test(d)||(y=Xs(d),x=Xs(u),x?y!==x&&(d=va(e,g,d,x)+x):y&&(u+=y)),this.add(o,"setProperty",d,u,i,n,0,0,g),a.push(g),T.push(g,0,o[g]);else if(f!=="undefined"){if(l&&g in l?(d=typeof l[g]=="function"?l[g].call(s,i,e,n):l[g],Ps(d)&&~d.indexOf("random(")&&(d=iu(d)),Xs(d+"")||d==="auto"||(d+=Oi.units[g]||Xs(dn(e,g))||""),(d+"").charAt(1)==="="&&(d=dn(e,g))):d=dn(e,g),p=parseFloat(d),b=f==="string"&&u.charAt(1)==="="&&u.substr(0,2),b&&(u=u.substr(2)),h=parseFloat(u),g in Lr&&(g==="autoAlpha"&&(p===1&&dn(e,"visibility")==="hidden"&&h&&(p=0),T.push("visibility",0,o.visibility),ta(this,o,"visibility",p?"inherit":"hidden",h?"inherit":"hidden",!h)),g!=="scale"&&g!=="transform"&&(g=Lr[g],~g.indexOf(",")&&(g=g.split(",")[0]))),w=g in Cn,w){if(this.styles.save(g),j=u,f==="string"&&u.substring(0,6)==="var(--"){if(u=Li(e,u.substring(4,u.indexOf(")"))),u.substring(0,5)==="calc("){var _=e.style.perspective;e.style.perspective=u,u=Li(e,"perspective"),_?e.style.perspective=_:ba(e,"perspective")}h=parseFloat(u)}if(C||(k=e._gsap,k.renderTransform&&!t.parseTransform||ou(e,t.parseTransform),S=t.smoothOrigin!==!1&&k.smooth,C=this._pt=new Ai(this._pt,o,Qt,0,1,k.renderTransform,k,0,-1),C.dep=1),g==="scale")this._pt=new Ai(this._pt,k,"scaleY",k.scaleY,(b?jc(k.scaleY,b+h):h)-k.scaleY||0,gy),this._pt.u=0,a.push("scaleY",g),g+="X";else if(g==="transformOrigin"){T.push(ji,0,o[ji]),u=hH(u),k.svg?by(e,u,0,S,0,this):(x=parseFloat(u.split(" ")[2])||0,x!==k.zOrigin&&ta(this,k,"zOrigin",k.zOrigin,x),ta(this,o,g,Fp(d),Fp(u)));continue}else if(g==="svgOrigin"){by(e,u,1,S,0,this);continue}else if(g in CP){gH(this,k,g,p,b?jc(p,b+u):u);continue}else if(g==="smoothOrigin"){ta(this,k,"smooth",k.smooth,u);continue}else if(g==="force3D"){k[g]=u;continue}else if(g==="transform"){yH(this,u,e);continue}}else g in o||(g=Qc(g)||g);if(w||(h||h===0)&&(p||p===0)&&!Qq.test(u)&&g in o)y=(d+"").substr((p+"").length),h||(h=0),x=Xs(u)||(g in Oi.units?Oi.units[g]:y),y!==x&&(p=va(e,g,d,x)),this._pt=new Ai(this._pt,w?k:o,g,p,(b?jc(p,b+h):h)-p,!w&&(x==="px"||g==="zIndex")&&t.autoRound!==!1?tH:gy),this._pt.u=x||0,w&&j!==u?(this._pt.b=d,this._pt.e=j,this._pt.r=eH):y!==x&&x!=="%"&&(this._pt.b=d,this._pt.r=Zq);else if(g in o)uH.call(this,e,g,d,b?b+u:u);else if(g in e)this.add(e,g,d||e[g],b?b+u:u,i,n);else if(g!=="parseTransform"){Ib(g,u);continue}w||(g in o?T.push(g,0,o[g]):typeof e[g]=="function"?T.push(g,2,e[g]()):T.push(g,1,d||e[g])),a.push(g)}}A&&fP(this)},render:function(e,t){if(t.tween._time||!Wb())for(var s=t._pt;s;)s.r(e,s.d),s=s._next;else t.styles.revert()},get:dn,aliases:Lr,getSetter:function(e,t,s){var i=Lr[t];return i&&i.indexOf(",")<0&&(t=i),t in Cn&&t!==ji&&(e._gsap.x||dn(e,"x"))?s&&DC===s?t==="scale"?nH:rH:(DC=s||{})&&(t==="scale"?aH:oH):e.style&&!Pb(e.style[t])?sH:~t.indexOf("-")?iH:Vb(e,t)},core:{_removeProperty:ba,_getMatrix:qb}};Mi.utils.checkPrefix=Qc;Mi.core.getStyleSaver=bP;(function(r,e,t,s){var i=Ti(r+","+e+","+t,function(n){Cn[n]=1});Ti(e,function(n){Oi.units[n]="deg",CP[n]=1}),Lr[i[13]]=r+","+e,Ti(s,function(n){var a=n.split(":");Lr[a[1]]=i[a[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Ti("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){Oi.units[r]="px"});Mi.registerPlugin(AP);var Hb=Mi.registerPlugin(AP)||Mi;Hb.core.Tween;/*!
 * paths 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var xH=/[achlmqstvz]|(-?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,bH=/(?:(-)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/ig,vH=/[\+\-]?\d*\.?\d+e[\+\-]?\d+/ig,wH=/(^[#\.][a-z]|[a-y][a-z])/i,kH=Math.PI/180,CH=180/Math.PI,ah=Math.sin,oh=Math.cos,nr=Math.abs,hn=Math.sqrt,SH=Math.atan2,vy=1e8,GC=function(e){return typeof e=="string"},jP=function(e){return typeof e=="number"},TH=function(e){return typeof e>"u"},AH={},jH={},Bp=1e5,_P=function(e){return Math.round((e+vy)%1*Bp)/Bp||(e<0?0:1)},mt=function(e){return Math.round(e*Bp)/Bp||0},WC=function(e){return Math.round(e*1e10)/1e10||0},YC=function(e){return e.closed=Math.abs(e[0]-e[e.length-2])<.001&&Math.abs(e[1]-e[e.length-1])<.001},qC=function(e,t,s,i){var n=e[t],a=i===1?6:wy(n,s,i);if((a||!i)&&a+s+2<n.length)return e.splice(t,0,n.slice(0,s+a+2)),n.splice(0,s+a),1},EP=function(e,t,s){var i=e.length,n=~~(s*i);if(e[n]>t){for(;--n&&e[n]>t;);n<0&&(n=0)}else for(;e[++n]<t&&n<i;);return n<i?n:i-1},_H=function(e,t){var s=e.length;for(e.reverse();s--;)e[s].reversed||PH(e[s])},HC=function(e,t){return t.totalLength=e.totalLength,e.samples?(t.samples=e.samples.slice(0),t.lookup=e.lookup.slice(0),t.minLength=e.minLength,t.resolution=e.resolution):e.totalPoints&&(t.totalPoints=e.totalPoints),t},EH=function(e,t){var s=e.length,i=e[s-1]||[],n=i.length;s&&t[0]===i[n-2]&&t[1]===i[n-1]&&(t=i.concat(t.slice(2)),s--),e[s]=t};function Uh(r){r=GC(r)&&wH.test(r)&&document.querySelector(r)||r;var e=r.getAttribute?r:0,t;return e&&(r=r.getAttribute("d"))?(e._gsPath||(e._gsPath={}),t=e._gsPath[r],t&&!t._dirty?t:e._gsPath[r]=Lp(r)):r?GC(r)?Lp(r):jP(r[0])?[r]:r:console.warn("Expecting a <path> element or an SVG path data string")}function MH(r){for(var e=[],t=0;t<r.length;t++)e[t]=HC(r[t],r[t].slice(0));return HC(r,e)}function PH(r){var e=0,t;for(r.reverse();e<r.length;e+=2)t=r[e],r[e]=r[e+1],r[e+1]=t;r.reversed=!r.reversed}var NH=function(e,t){var s=document.createElementNS("http://www.w3.org/2000/svg","path"),i=[].slice.call(e.attributes),n=i.length,a;for(t=","+t+",";--n>-1;)a=i[n].nodeName.toLowerCase(),t.indexOf(","+a+",")<0&&s.setAttributeNS(null,a,i[n].nodeValue);return s},RH={rect:"rx,ry,x,y,width,height",circle:"r,cx,cy",ellipse:"rx,ry,cx,cy",line:"x1,x2,y1,y2"},IH=function(e,t){for(var s=t?t.split(","):[],i={},n=s.length;--n>-1;)i[s[n]]=+e.getAttribute(s[n])||0;return i};function DH(r,e){var t=r.tagName.toLowerCase(),s=.552284749831,i,n,a,o,l,d,u,h,p,f,m,g,y,x,b,w,C,k,S,A,T,j;return t==="path"||!r.getBBox?r:(d=NH(r,"x,y,width,height,cx,cy,rx,ry,r,x1,x2,y1,y2,points"),j=IH(r,RH[t]),t==="rect"?(o=j.rx,l=j.ry||o,n=j.x,a=j.y,f=j.width-o*2,m=j.height-l*2,o||l?(g=n+o*(1-s),y=n+o,x=y+f,b=x+o*s,w=x+o,C=a+l*(1-s),k=a+l,S=k+m,A=S+l*s,T=S+l,i="M"+w+","+k+" V"+S+" C"+[w,A,b,T,x,T,x-(x-y)/3,T,y+(x-y)/3,T,y,T,g,T,n,A,n,S,n,S-(S-k)/3,n,k+(S-k)/3,n,k,n,C,g,a,y,a,y+(x-y)/3,a,x-(x-y)/3,a,x,a,b,a,w,C,w,k].join(",")+"z"):i="M"+(n+f)+","+a+" v"+m+" h"+-f+" v"+-m+" h"+f+"z"):t==="circle"||t==="ellipse"?(t==="circle"?(o=l=j.r,h=o*s):(o=j.rx,l=j.ry,h=l*s),n=j.cx,a=j.cy,u=o*s,i="M"+(n+o)+","+a+" C"+[n+o,a+h,n+u,a+l,n,a+l,n-u,a+l,n-o,a+h,n-o,a,n-o,a-h,n-u,a-l,n,a-l,n+u,a-l,n+o,a-h,n+o,a].join(",")+"z"):t==="line"?i="M"+j.x1+","+j.y1+" L"+j.x2+","+j.y2:(t==="polyline"||t==="polygon")&&(p=(r.getAttribute("points")+"").match(bH)||[],n=p.shift(),a=p.shift(),i="M"+n+","+a+" L"+p.join(","),t==="polygon"&&(i+=","+n+","+a+"z")),d.setAttribute("d",NP(d._gsRawPath=Lp(i))),e&&r.parentNode&&(r.parentNode.insertBefore(d,r),r.parentNode.removeChild(r)),d)}function MP(r,e,t){var s=r[e],i=r[e+2],n=r[e+4],a;return s+=(i-s)*t,i+=(n-i)*t,s+=(i-s)*t,a=i+(n+(r[e+6]-n)*t-i)*t-s,s=r[e+1],i=r[e+3],n=r[e+5],s+=(i-s)*t,i+=(n-i)*t,s+=(i-s)*t,mt(SH(i+(n+(r[e+7]-n)*t-i)*t-s,a)*CH)}function PP(r,e,t){t=TH(t)?1:WC(t)||0,e=WC(e)||0;var s=Math.max(0,~~(nr(t-e)-1e-8)),i=MH(r);if(e>t&&(e=1-e,t=1-t,_H(i),i.totalLength=0),e<0||t<0){var n=Math.abs(~~Math.min(e,t))+1;e+=n,t+=n}i.totalLength||wo(i);var a=t>1,o=XC(i,e,AH,!0),l=XC(i,t,jH),d=l.segment,u=o.segment,h=l.segIndex,p=o.segIndex,f=l.i,m=o.i,g=p===h,y=f===m&&g,x,b,w,C,k,S,A,T;if(a||s){for(x=h<p||g&&f<m||y&&l.t<o.t,qC(i,p,m,o.t)&&(p++,x||(h++,y?(l.t=(l.t-o.t)/(1-o.t),f=0):g&&(f-=m))),Math.abs(1-(t-e))<1e-5?h=p-1:!l.t&&h?h--:qC(i,h,f,l.t)&&x&&p++,o.t===1&&(p=(p+1)%i.length),k=[],S=i.length,A=1+S*s,T=p,A+=(S-p+h)%S,C=0;C<A;C++)EH(k,i[T++%S]);i=k}else if(w=l.t===1?6:wy(d,f,l.t),e!==t)for(b=wy(u,m,y?o.t/l.t:o.t),g&&(w+=b),d.splice(f+w+2),(b||m)&&u.splice(0,m+b),C=i.length;C--;)(C<p||C>h)&&i.splice(C,1);else d.angle=MP(d,f+w,0),f+=w,o=d[f],l=d[f+1],d.length=d.totalLength=0,d.totalPoints=i.totalPoints=8,d.push(o,l,o,l,o,l,o,l);return i.totalLength=0,i}function FH(r,e,t){e=e||0,r.samples||(r.samples=[],r.lookup=[]);var s=~~r.resolution||12,i=1/s,n=r.length,a=r[e],o=r[e+1],l=e?e/6*s:0,d=r.samples,u=r.lookup,h=(e?r.minLength:vy)||vy,p=d[l+t*s-1],f=e?d[l-1]:0,m,g,y,x,b,w,C,k,S,A,T,j,_,M,P,R,D;for(d.length=u.length=0,g=e+2;g<n;g+=6){if(y=r[g+4]-a,x=r[g+2]-a,b=r[g]-a,k=r[g+5]-o,S=r[g+3]-o,A=r[g+1]-o,w=C=T=j=0,nr(y)<.01&&nr(k)<.01&&nr(b)+nr(A)<.01)r.length>8&&(r.splice(g,6),g-=6,n-=6);else for(m=1;m<=s;m++)M=i*m,_=1-M,w=C-(C=(M*M*y+3*_*(M*x+_*b))*M),T=j-(j=(M*M*k+3*_*(M*S+_*A))*M),R=hn(T*T+w*w),R<h&&(h=R),f+=R,d[l++]=f;a+=y,o+=k}if(p)for(p-=f;l<d.length;l++)d[l]+=p;if(d.length&&h){if(r.totalLength=D=d[d.length-1]||0,r.minLength=h,D/h<9999)for(R=P=0,m=0;m<D;m+=h)u[R++]=d[P]<m?++P:P}else r.totalLength=d[0]=0;return e?f-d[e/2-1]:f}function wo(r,e){var t,s,i;for(i=t=s=0;i<r.length;i++)r[i].resolution=~~e||12,t+=FH(r[i]),s+=r[i].length;return r.totalPoints=s,r.totalLength=t,r}function wy(r,e,t){if(t<=0||t>=1)return 0;var s=r[e],i=r[e+1],n=r[e+2],a=r[e+3],o=r[e+4],l=r[e+5],d=r[e+6],u=r[e+7],h=s+(n-s)*t,p=n+(o-n)*t,f=i+(a-i)*t,m=a+(l-a)*t,g=h+(p-h)*t,y=f+(m-f)*t,x=o+(d-o)*t,b=l+(u-l)*t;return p+=(x-p)*t,m+=(b-m)*t,r.splice(e+2,4,mt(h),mt(f),mt(g),mt(y),mt(g+(p-g)*t),mt(y+(m-y)*t),mt(p),mt(m),mt(x),mt(b)),r.samples&&r.samples.splice(e/6*r.resolution|0,0,0,0,0,0,0,0),6}function XC(r,e,t,s){t=t||{},r.totalLength||wo(r),(e<0||e>1)&&(e=_P(e));var i=0,n=r[0],a,o,l,d,u,h,p;if(!e)p=h=i=0,n=r[0];else if(e===1)p=1,i=r.length-1,n=r[i],h=n.length-8;else{if(r.length>1){for(l=r.totalLength*e,u=h=0;(u+=r[h++].totalLength)<l;)i=h;n=r[i],d=u-n.totalLength,e=(l-d)/(u-d)||0}a=n.samples,o=n.resolution,l=n.totalLength*e,h=n.lookup.length?n.lookup[~~(l/n.minLength)]||0:EP(a,l,e),d=h?a[h-1]:0,u=a[h],u<l&&(d=u,u=a[++h]),p=1/o*((l-d)/(u-d)+h%o),h=~~(h/o)*6,s&&p===1&&(h+6<n.length?(h+=6,p=0):i+1<r.length&&(h=p=0,n=r[++i]))}return t.t=p,t.i=h,t.path=r,t.segment=n,t.segIndex=i,t}function KC(r,e,t,s){var i=r[0],n=s||{},a,o,l,d,u,h,p,f,m;if((e<0||e>1)&&(e=_P(e)),i.lookup||wo(r),r.length>1){for(l=r.totalLength*e,u=h=0;(u+=r[h++].totalLength)<l;)i=r[h];d=u-i.totalLength,e=(l-d)/(u-d)||0}return a=i.samples,o=i.resolution,l=i.totalLength*e,h=i.lookup.length?i.lookup[e<1?~~(l/i.minLength):i.lookup.length-1]||0:EP(a,l,e),d=h?a[h-1]:0,u=a[h],u<l&&(d=u,u=a[++h]),p=1/o*((l-d)/(u-d)+h%o)||0,m=1-p,h=~~(h/o)*6,f=i[h],n.x=mt((p*p*(i[h+6]-f)+3*m*(p*(i[h+4]-f)+m*(i[h+2]-f)))*p+f),n.y=mt((p*p*(i[h+7]-(f=i[h+1]))+3*m*(p*(i[h+5]-f)+m*(i[h+3]-f)))*p+f),t&&(n.angle=i.totalLength?MP(i,h,p>=1?1-1e-9:p||1e-9):i.angle||0),n}function cd(r,e,t,s,i,n,a){for(var o=r.length,l,d,u,h,p;--o>-1;)for(l=r[o],d=l.length,u=0;u<d;u+=2)h=l[u],p=l[u+1],l[u]=h*e+p*s+n,l[u+1]=h*t+p*i+a;return r._dirty=1,r}function BH(r,e,t,s,i,n,a,o,l){if(!(r===o&&e===l)){t=nr(t),s=nr(s);var d=i%360*kH,u=oh(d),h=ah(d),p=Math.PI,f=p*2,m=(r-o)/2,g=(e-l)/2,y=u*m+h*g,x=-h*m+u*g,b=y*y,w=x*x,C=b/(t*t)+w/(s*s);C>1&&(t=hn(C)*t,s=hn(C)*s);var k=t*t,S=s*s,A=(k*S-k*w-S*b)/(k*w+S*b);A<0&&(A=0);var T=(n===a?-1:1)*hn(A),j=T*(t*x/s),_=T*-(s*y/t),M=(r+o)/2,P=(e+l)/2,R=M+(u*j-h*_),D=P+(h*j+u*_),B=(y-j)/t,O=(x-_)/s,F=(-y-j)/t,I=(-x-_)/s,J=B*B+O*O,Z=(O<0?-1:1)*Math.acos(B/hn(J)),E=(B*I-O*F<0?-1:1)*Math.acos((B*F+O*I)/hn(J*(F*F+I*I)));isNaN(E)&&(E=p),!a&&E>0?E-=f:a&&E<0&&(E+=f),Z%=f,E%=f;var G=Math.ceil(nr(E)/(f/4)),V=[],U=E/G,oe=4/3*ah(U/2)/(1+oh(U/2)),re=u*t,ne=h*t,Ee=h*-s,K=u*s,me;for(me=0;me<G;me++)i=Z+me*U,y=oh(i),x=ah(i),B=oh(i+=U),O=ah(i),V.push(y-oe*x,x+oe*y,B+oe*O,O-oe*B,B,O);for(me=0;me<V.length;me+=2)y=V[me],x=V[me+1],V[me]=y*re+x*Ee+R,V[me+1]=y*ne+x*K+D;return V[me-2]=o,V[me-1]=l,V}}function Lp(r){var e=(r+"").replace(vH,function(j){var _=+j;return _<1e-4&&_>-1e-4?0:_}).match(xH)||[],t=[],s=0,i=0,n=2/3,a=e.length,o=0,l="ERROR: malformed path: "+r,d,u,h,p,f,m,g,y,x,b,w,C,k,S,A,T=function(_,M,P,R){b=(P-_)/3,w=(R-M)/3,g.push(_+b,M+w,P-b,R-w,P,R)};if(!r||!isNaN(e[0])||isNaN(e[1]))return console.log(l),t;for(d=0;d<a;d++)if(k=f,isNaN(e[d])?(f=e[d].toUpperCase(),m=f!==e[d]):d--,h=+e[d+1],p=+e[d+2],m&&(h+=s,p+=i),d||(y=h,x=p),f==="M")g&&(g.length<8?t.length-=1:o+=g.length,YC(g)),s=y=h,i=x=p,g=[h,p],t.push(g),d+=2,f="L";else if(f==="C")g||(g=[0,0]),m||(s=i=0),g.push(h,p,s+e[d+3]*1,i+e[d+4]*1,s+=e[d+5]*1,i+=e[d+6]*1),d+=6;else if(f==="S")b=s,w=i,(k==="C"||k==="S")&&(b+=s-g[g.length-4],w+=i-g[g.length-3]),m||(s=i=0),g.push(b,w,h,p,s+=e[d+3]*1,i+=e[d+4]*1),d+=4;else if(f==="Q")b=s+(h-s)*n,w=i+(p-i)*n,m||(s=i=0),s+=e[d+3]*1,i+=e[d+4]*1,g.push(b,w,s+(h-s)*n,i+(p-i)*n,s,i),d+=4;else if(f==="T")b=s-g[g.length-4],w=i-g[g.length-3],g.push(s+b,i+w,h+(s+b*1.5-h)*n,p+(i+w*1.5-p)*n,s=h,i=p),d+=2;else if(f==="H")T(s,i,s=h,i),d+=1;else if(f==="V")T(s,i,s,i=h+(m?i-s:0)),d+=1;else if(f==="L"||f==="Z")f==="Z"&&(h=y,p=x,g.closed=!0),(f==="L"||nr(s-h)>.5||nr(i-p)>.5)&&(T(s,i,h,p),f==="L"&&(d+=2)),s=h,i=p;else if(f==="A"){if(S=e[d+4],A=e[d+5],b=e[d+6],w=e[d+7],u=7,S.length>1&&(S.length<3?(w=b,b=A,u--):(w=A,b=S.substr(2),u-=2),A=S.charAt(1),S=S.charAt(0)),C=BH(s,i,+e[d+1],+e[d+2],+e[d+3],+S,+A,(m?s:0)+b*1,(m?i:0)+w*1),d+=u,C)for(u=0;u<C.length;u++)g.push(C[u]);s=g[g.length-2],i=g[g.length-1]}else console.log(l);return d=g.length,d<6?(t.pop(),d=0):YC(g),t.totalPoints=o+d,t}function LH(r,e){e===void 0&&(e=1);for(var t=r[0],s=0,i=[t,s],n=2;n<r.length;n+=2)i.push(t,s,r[n],s=(r[n]-t)*e/2,t=r[n],-s);return i}function ky(r,e){nr(r[0]-r[2])<1e-4&&nr(r[1]-r[3])<1e-4&&(r=r.slice(2));var t=r.length-2,s=+r[0],i=+r[1],n=+r[2],a=+r[3],o=[s,i,s,i],l=n-s,d=a-i,u=r.nonSmooth||[],h=Math.abs(r[t]-s)<.001&&Math.abs(r[t+1]-i)<.001,p,f,m,g,y,x,b,w,C,k,S,A,T,j,_;if(!t)return[s,i,s,i,s,i,s,i];for(h&&(r.push(n,a),n=s,a=i,s=r[t-2],i=r[t-1],r.unshift(s,i),t+=4,u=[0,0].concat(u)),e=e||e===0?+e:1,m=2;m<t;m+=2)if(p=s,f=i,s=n,i=a,n=+r[m+2],a=+r[m+3],!(s===n&&i===a)){if(g=l,y=d,l=n-s,d=a-i,u[m]){o.push(s-(s-p)/4,i-(i-f)/4,s,i,s+(n-s)/4,i+(a-i)/4);continue}x=hn(g*g+y*y),b=hn(l*l+d*d),w=hn(Math.pow(l/b+g/x,2)+Math.pow(d/b+y/x,2)),C=(x+b)*e*.25/w,k=s-(s-p)*(x?C/x:0),S=s+(n-s)*(b?C/b:0),A=s-(k+((S-k)*(x*3/(x+b)+.5)/4||0)),T=i-(i-f)*(x?C/x:0),j=i+(a-i)*(b?C/b:0),_=i-(T+((j-T)*(x*3/(x+b)+.5)/4||0)),o.push(mt(k+A),mt(T+_),mt(s),mt(i),mt(S+A),mt(j+_))}return s!==n||i!==a||o.length<4?o.push(mt(n),mt(a),mt(n),mt(a)):o.length-=2,o.length===2?o.push(s,i,s,i,s,i):h&&(o.splice(0,6),o.length-=6),o.closed=h,o}function NP(r){jP(r[0])&&(r=[r]);var e="",t=r.length,s,i,n,a;for(i=0;i<t;i++){for(a=r[i],e+="M"+mt(a[0])+","+mt(a[1])+" C",s=a.length,n=2;n<s;n++)e+=mt(a[n++])+","+mt(a[n++])+" "+mt(a[n++])+","+mt(a[n++])+" "+mt(a[n++])+","+mt(a[n])+" ";a.closed&&(e+="z")}return e}/*!
 * matrix 3.14.2
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var fn,ko,Xb,pf,ld,Gh,Op,Ed,vr="transform",Cy=vr+"Origin",RP,IP=function(e){var t=e.ownerDocument||e;for(!(vr in e.style)&&("msTransform"in e.style)&&(vr="msTransform",Cy=vr+"Origin");t.parentNode&&(t=t.parentNode););if(ko=window,Op=new cu,t){fn=t,Xb=t.documentElement,pf=t.body,Ed=fn.createElementNS("http://www.w3.org/2000/svg","g"),Ed.style.transform="none";var s=t.createElement("div"),i=t.createElement("div"),n=t&&(t.body||t.firstElementChild);n&&n.appendChild&&(n.appendChild(s),s.appendChild(i),s.style.position="static",s.style.transform="translate3d(0,0,1px)",RP=i.offsetParent!==s,n.removeChild(s))}return t},OH=function(e){for(var t,s;e&&e!==pf;)s=e._gsap,s&&s.uncache&&s.get(e,"x"),s&&!s.scaleX&&!s.scaleY&&s.renderTransform&&(s.scaleX=s.scaleY=1e-4,s.renderTransform(1,s),t?t.push(s):t=[s]),e=e.parentNode;return t},DP=[],FP=[],$H=function(){return ko.pageYOffset||fn.scrollTop||Xb.scrollTop||pf.scrollTop||0},zH=function(){return ko.pageXOffset||fn.scrollLeft||Xb.scrollLeft||pf.scrollLeft||0},Kb=function(e){return e.ownerSVGElement||((e.tagName+"").toLowerCase()==="svg"?e:null)},VH=function r(e){if(ko.getComputedStyle(e).position==="fixed")return!0;if(e=e.parentNode,e&&e.nodeType===1)return r(e)},sg=function r(e,t){if(e.parentNode&&(fn||IP(e))){var s=Kb(e),i=s?s.getAttribute("xmlns")||"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",n=s?t?"rect":"g":"div",a=t!==2?0:100,o=t===3?100:0,l={position:"absolute",display:"block",pointerEvents:"none",margin:"0",padding:"0"},d=fn.createElementNS?fn.createElementNS(i.replace(/^https/,"http"),n):fn.createElement(n);return t&&(s?(Gh||(Gh=r(e)),d.setAttribute("width",.01),d.setAttribute("height",.01),d.setAttribute("transform","translate("+a+","+o+")"),d.setAttribute("fill","transparent"),Gh.appendChild(d)):(ld||(ld=r(e),Object.assign(ld.style,l)),Object.assign(d.style,l,{width:"0.1px",height:"0.1px",top:o+"px",left:a+"px"}),ld.appendChild(d))),d}throw"Need document and parent."},UH=function(e){for(var t=new cu,s=0;s<e.numberOfItems;s++)t.multiply(e.getItem(s).matrix);return t},GH=function(e){var t=e.getCTM(),s;return t||(s=e.style[vr],e.style[vr]="none",e.appendChild(Ed),t=Ed.getCTM(),e.removeChild(Ed),s?e.style[vr]=s:e.style.removeProperty(vr.replace(/([A-Z])/g,"-$1").toLowerCase())),t||Op.clone()},WH=function(e,t){var s=Kb(e),i=e===s,n=s?DP:FP,a=e.parentNode,o=a&&!s&&a.shadowRoot&&a.shadowRoot.appendChild?a.shadowRoot:a,l,d,u,h,p,f;if(e===ko)return e;if(n.length||n.push(sg(e,1),sg(e,2),sg(e,3)),l=s?Gh:ld,s)i?(u=GH(e),h=-u.e/u.a,p=-u.f/u.d,d=Op):e.getBBox?(u=e.getBBox(),d=e.transform?e.transform.baseVal:{},d=d.numberOfItems?d.numberOfItems>1?UH(d):d.getItem(0).matrix:Op,h=d.a*u.x+d.c*u.y,p=d.b*u.x+d.d*u.y):(d=new cu,h=p=0),t&&e.tagName.toLowerCase()==="g"&&(h=p=0),(i||!e.getBoundingClientRect().width?s:a).appendChild(l),l.setAttribute("transform","matrix("+d.a+","+d.b+","+d.c+","+d.d+","+(d.e+h)+","+(d.f+p)+")");else{if(h=p=0,RP)for(d=e.offsetParent,u=e;u&&(u=u.parentNode)&&u!==d&&u.parentNode;)(ko.getComputedStyle(u)[vr]+"").length>4&&(h=u.offsetLeft,p=u.offsetTop,u=0);if(f=ko.getComputedStyle(e),f.position!=="absolute"&&f.position!=="fixed")for(d=e.offsetParent;a&&a!==d;)h+=a.scrollLeft||0,p+=a.scrollTop||0,a=a.parentNode;u=l.style,u.top=e.offsetTop-p+"px",u.left=e.offsetLeft-h+"px",u[vr]=f[vr],u[Cy]=f[Cy],u.position=f.position==="fixed"?"fixed":"absolute",o.appendChild(l)}return l},ig=function(e,t,s,i,n,a,o){return e.a=t,e.b=s,e.c=i,e.d=n,e.e=a,e.f=o,e},cu=function(){function r(t,s,i,n,a,o){t===void 0&&(t=1),s===void 0&&(s=0),i===void 0&&(i=0),n===void 0&&(n=1),a===void 0&&(a=0),o===void 0&&(o=0),ig(this,t,s,i,n,a,o)}var e=r.prototype;return e.inverse=function(){var s=this.a,i=this.b,n=this.c,a=this.d,o=this.e,l=this.f,d=s*a-i*n||1e-10;return ig(this,a/d,-i/d,-n/d,s/d,(n*l-a*o)/d,-(s*l-i*o)/d)},e.multiply=function(s){var i=this.a,n=this.b,a=this.c,o=this.d,l=this.e,d=this.f,u=s.a,h=s.c,p=s.b,f=s.d,m=s.e,g=s.f;return ig(this,u*i+p*a,u*n+p*o,h*i+f*a,h*n+f*o,l+m*i+g*a,d+m*n+g*o)},e.clone=function(){return new r(this.a,this.b,this.c,this.d,this.e,this.f)},e.equals=function(s){var i=this.a,n=this.b,a=this.c,o=this.d,l=this.e,d=this.f;return i===s.a&&n===s.b&&a===s.c&&o===s.d&&l===s.e&&d===s.f},e.apply=function(s,i){i===void 0&&(i={});var n=s.x,a=s.y,o=this.a,l=this.b,d=this.c,u=this.d,h=this.e,p=this.f;return i.x=n*o+a*d+h||0,i.y=n*l+a*u+p||0,i},r}();function Mc(r,e,t,s){if(!r||!r.parentNode||(fn||IP(r)).documentElement===r)return new cu;var i=OH(r),n=Kb(r),a=n?DP:FP,o=WH(r,t),l=a[0].getBoundingClientRect(),d=a[1].getBoundingClientRect(),u=a[2].getBoundingClientRect(),h=o.parentNode,p=!s&&VH(r),f=new cu((d.left-l.left)/100,(d.top-l.top)/100,(u.left-l.left)/100,(u.top-l.top)/100,l.left+(p?0:zH()),l.top+(p?0:$H()));if(h.removeChild(o),i)for(l=i.length;l--;)d=i[l],d.scaleX=d.scaleY=0,d.renderTransform(1,d);return e?f.inverse():f}/*!
 * MotionPathPlugin 3.14.2
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var YH="x,translateX,left,marginLeft,xPercent".split(","),qH="y,translateY,top,marginTop,yPercent".split(","),HH=Math.PI/180,Ji,BP,sc,Sy,rg,QC,XH=function(){return Ji||typeof window<"u"&&(Ji=window.gsap)&&Ji.registerPlugin&&Ji},$l=function(e,t,s,i){for(var n=t.length,a=i===2?0:i,o=0;o<n;o++)e[a]=parseFloat(t[o][s]),i===2&&(e[a+1]=0),a+=2;return e},bc=function(e,t,s){return parseFloat(e._gsap.get(e,t,s||"px"))||0},LP=function(e){var t=e[0],s=e[1],i;for(i=2;i<e.length;i+=2)t=e[i]+=t,s=e[i+1]+=s},JC=function(e,t,s,i,n,a,o,l,d){if(o.type==="cubic")t=[t];else{o.fromCurrent!==!1&&t.unshift(bc(s,i,l),n?bc(s,n,d):0),o.relative&&LP(t);var u=n?ky:LH;t=[u(t,o.curviness)]}return t=a(OP(t,s,o)),$p(e,s,i,t,"x",l),n&&$p(e,s,n,t,"y",d),wo(t,o.resolution||(o.curviness===0?20:12))},KH=function(e){return e},QH=/[-+\.]*\d+\.?(?:e-|e\+)?\d*/g,ZC=function(e,t,s){var i=Mc(e),n=0,a=0,o;return(e.tagName+"").toLowerCase()==="svg"?(o=e.viewBox.baseVal,o.width||(o={width:+e.getAttribute("width"),height:+e.getAttribute("height")})):o=t&&e.getBBox&&e.getBBox(),t&&t!=="auto"&&(n=t.push?t[0]*(o?o.width:e.offsetWidth||0):t.x,a=t.push?t[1]*(o?o.height:e.offsetHeight||0):t.y),s.apply(n||a?i.apply({x:n,y:a}):{x:i.e,y:i.f})},Ty=function(e,t,s,i){var n=Mc(e.parentNode,!0,!0),a=n.clone().multiply(Mc(t)),o=ZC(e,s,n),l=ZC(t,i,n),d=l.x,u=l.y,h;return a.e=a.f=0,i==="auto"&&t.getTotalLength&&t.tagName.toLowerCase()==="path"&&(h=t.getAttribute("d").match(QH)||[],h=a.apply({x:+h[0],y:+h[1]}),d+=h.x,u+=h.y),h&&(h=a.apply(t.getBBox()),d-=h.x,u-=h.y),a.e=d-o.x,a.f=u-o.y,a},OP=function(e,t,s){var i=s.align,n=s.matrix,a=s.offsetX,o=s.offsetY,l=s.alignOrigin,d=e[0][0],u=e[0][1],h=bc(t,"x"),p=bc(t,"y"),f,m,g;return!e||!e.length?Uh("M0,0L0,0"):(i&&(i==="self"||(f=Sy(i)[0]||t)===t?cd(e,1,0,0,1,h-d,p-u):(l&&l[2]!==!1?Ji.set(t,{transformOrigin:l[0]*100+"% "+l[1]*100+"%"}):l=[bc(t,"xPercent")/-100,bc(t,"yPercent")/-100],m=Ty(t,f,l,"auto"),g=m.apply({x:d,y:u}),cd(e,m.a,m.b,m.c,m.d,h+m.e-(g.x-m.e),p+m.f-(g.y-m.f)))),n?cd(e,n.a,n.b,n.c,n.d,n.e,n.f):(a||o)&&cd(e,1,0,0,1,a||0,o||0),e)},$p=function(e,t,s,i,n,a){var o=t._gsap,l=o.harness,d=l&&l.aliases&&l.aliases[s],u=d&&d.indexOf(",")<0?d:s,h=e._pt=new BP(e._pt,t,u,0,0,KH,0,o.set(t,u,e));h.u=sc(o.get(t,u,a))||0,h.path=i,h.pp=n,e._props.push(u)},JH=function(e,t){return function(s){return e||t!==1?PP(s,e,t):s}},$P={version:"3.14.2",name:"motionPath",register:function(e,t,s){Ji=e,sc=Ji.utils.getUnit,Sy=Ji.utils.toArray,rg=Ji.core.getStyleSaver,QC=Ji.core.reverting||function(){},BP=s},init:function(e,t,s){if(!Ji)return console.warn("Please gsap.registerPlugin(MotionPathPlugin)"),!1;(!(typeof t=="object"&&!t.style)||!t.path)&&(t={path:t});var i=[],n=t,a=n.path,o=n.autoRotate,l=n.unitX,d=n.unitY,u=n.x,h=n.y,p=a[0],f=JH(t.start,"end"in t?t.end:1),m,g;if(this.rawPaths=i,this.target=e,this.tween=s,this.styles=rg&&rg(e,"transform"),(this.rotate=o||o===0)&&(this.rOffset=parseFloat(o)||0,this.radians=!!t.useRadians,this.rProp=t.rotation||"rotation",this.rSet=e._gsap.set(e,this.rProp,this),this.ru=sc(e._gsap.get(e,this.rProp))||0),Array.isArray(a)&&!("closed"in a)&&typeof p!="number"){for(g in p)!u&&~YH.indexOf(g)?u=g:!h&&~qH.indexOf(g)&&(h=g);u&&h?i.push(JC(this,$l($l([],a,u,0),a,h,1),e,u,h,f,t,l||sc(a[0][u]),d||sc(a[0][h]))):u=h=0;for(g in p)g!==u&&g!==h&&i.push(JC(this,$l([],a,g,2),e,g,0,f,t,sc(a[0][g])))}else m=f(OP(Uh(t.path),e,t)),wo(m,t.resolution),i.push(m),$p(this,e,t.x||"x",m,"x",t.unitX||"px"),$p(this,e,t.y||"y",m,"y",t.unitY||"px");s.vars.immediateRender&&this.render(s.progress(),this)},render:function(e,t){var s=t.rawPaths,i=s.length,n=t._pt;if(t.tween._time||!QC()){for(e>1?e=1:e<0&&(e=0);i--;)KC(s[i],e,!i&&t.rotate,s[i]);for(;n;)n.set(n.t,n.p,n.path[n.pp]+n.u,n.d,e),n=n._next;t.rotate&&t.rSet(t.target,t.rProp,s[0].angle*(t.radians?HH:1)+t.rOffset+t.ru,t,e)}else t.styles.revert()},getLength:function(e){return wo(Uh(e)).totalLength},sliceRawPath:PP,getRawPath:Uh,pointsToSegment:ky,stringToRawPath:Lp,rawPathToString:NP,transformRawPath:cd,getGlobalMatrix:Mc,getPositionOnPath:KC,cacheRawPathMeasurements:wo,convertToPath:function(e,t){return Sy(e).map(function(s){return DH(s,t!==!1)})},convertCoordinates:function(e,t,s){var i=Mc(t,!0,!0).multiply(Mc(e));return s?i.apply(s):i},getAlignMatrix:Ty,getRelativePosition:function(e,t,s,i){var n=Ty(e,t,s,i);return{x:n.e,y:n.f}},arrayToRawPath:function(e,t){t=t||{};var s=$l($l([],e,t.x||"x",0),e,t.y||"y",1);return t.relative&&LP(s),[t.type==="cubic"?s:ky(s,t.curviness)]}};XH()&&Ji.registerPlugin($P);Hb.registerPlugin($P);function e2(r,e){if(r.length===0)return null;if(r.length===1)return{x:r[0].x,y:r[0].y};const t=[...r].sort((l,d)=>l.time-d.time);if(e<=t[0].time)return{x:t[0].x,y:t[0].y};if(e>=t[t.length-1].time){const l=t[t.length-1];return{x:l.x,y:l.y}}let s=0;for(let l=0;l<t.length-1;l++)if(e>=t[l].time&&e<=t[l+1].time){s=l;break}const i=t[s],n=t[s+1],a=n.time-i.time,o=a>0?(e-i.time)/a:0;return i.controlPoints&&n.controlPoints?ZH({x:i.x,y:i.y},i.controlPoints.cp2,n.controlPoints.cp1,{x:n.x,y:n.y},o):{x:i.x+(n.x-i.x)*o,y:i.y+(n.y-i.y)*o}}function ZH(r,e,t,s,i){const n=1-i,a=n*n,o=a*n,l=i*i,d=l*i,u=o*r.x+3*a*i*e.x+3*n*l*t.x+d*s.x,h=o*r.y+3*a*i*e.y+3*n*l*t.y+d*s.y,f=Math.min(1,i+.001),m=1-f,g=Math.pow(m,3)*r.x+3*Math.pow(m,2)*f*e.x+3*m*Math.pow(f,2)*t.x+Math.pow(f,3)*s.x,y=Math.pow(m,3)*r.y+3*Math.pow(m,2)*f*e.y+3*m*Math.pow(f,2)*t.y+Math.pow(f,3)*s.y,x=Math.atan2(y-h,g-u)*(180/Math.PI);return{x:u,y:h,rotation:x}}function eX(r,e,t=.5){if(r.length<2)return r[0]||{x:0,y:0};const s=r.length-1,i=Math.min(Math.floor(e*s),s-1),n=e*s%1,a=r[Math.max(0,i-1)],o=r[i],l=r[Math.min(r.length-1,i+1)],d=r[Math.min(r.length-1,i+2)],u=n*n,h=u*n,p=t*(l.x-a.x),f=t*(l.y-a.y),m=t*(d.x-o.x),g=t*(d.y-o.y),y=2*h-3*u+1,x=h-2*u+n,b=-2*h+3*u,w=h-u;return{x:y*o.x+x*p+b*l.x+w*m,y:y*o.y+x*f+b*l.y+w*g}}function zP(r){if(r.length===0)return"";if(r.length===1)return`M ${r[0].x} ${r[0].y}`;const e=[...r].sort((s,i)=>s.time-i.time);let t=`M ${e[0].x} ${e[0].y}`;for(let s=0;s<e.length-1;s++){const i=e[s],n=e[s+1];if(i.controlPoints&&n.controlPoints)t+=` C ${i.controlPoints.cp2.x} ${i.controlPoints.cp2.y}, ${n.controlPoints.cp1.x} ${n.controlPoints.cp1.y}, ${n.x} ${n.y}`;else{const a=i.x+(n.x-i.x)/3,o=i.y+(n.y-i.y)/3,l=i.x+2*(n.x-i.x)/3,d=i.y+2*(n.y-i.y)/3;t+=` C ${a} ${o}, ${l} ${d}, ${n.x} ${n.y}`}}return t}function Ay(r){if(r.length<2)return r;const e=[...r].sort((t,s)=>t.time-s.time);return e.map((t,s)=>{if(t.controlPoints)return t;const i=e[s-1],n=e[s+1];let a=0,o=0;return i&&n?(a=(n.x-i.x)/4,o=(n.y-i.y)/4):n?(a=(n.x-t.x)/3,o=(n.y-t.y)/3):i&&(a=(t.x-i.x)/3,o=(t.y-i.y)/3),{...t,controlPoints:{cp1:{x:t.x-a,y:t.y-o},cp2:{x:t.x+a,y:t.y+o}}}})}class tX{timelines=new Map;motionPaths=new Map;createTimeline(e,t){this.timelines.has(e)&&this.timelines.get(e).kill();const s=Hb.timeline({paused:!0,defaults:{duration:t?.duration||1,ease:t?.ease||"none"}});return this.timelines.set(e,s),s}getTimeline(e){return this.timelines.get(e)}removeTimeline(e){const t=this.timelines.get(e);t&&(t.kill(),this.timelines.delete(e))}setMotionPath(e,t){this.motionPaths.set(e,{...t,clipId:e})}getMotionPath(e){return this.motionPaths.get(e)}removeMotionPath(e){this.motionPaths.delete(e)}updateGSAPMotionPathPoint(e,t,s){const i=this.motionPaths.get(e);!i||t<0||t>=i.points.length||(i.points[t]={...i.points[t],...s},this.motionPaths.set(e,i))}addGSAPMotionPathPoint(e,t){const s=this.motionPaths.get(e);s&&(s.points.push(t),s.points.sort((i,n)=>i.time-n.time),s.points=Ay(s.points),this.motionPaths.set(e,s))}removeGSAPMotionPathPoint(e,t){const s=this.motionPaths.get(e);!s||t<0||t>=s.points.length||s.points.length<=2||(s.points.splice(t,1),s.points=Ay(s.points),this.motionPaths.set(e,s))}samplePositionAtTime(e,t,s){const i=this.motionPaths.get(e);if(!i||!i.enabled||i.points.length===0)return null;const n=s>0?t/s:0,a=Math.max(0,Math.min(1,n));return i.pathType==="catmull-rom"?eX(i.points,a):e2(i.points,a)}getSVGPath(e){const t=this.motionPaths.get(e);return t?zP(t.points):""}sampleFrameTransforms(e,t,s,i){const n=this.motionPaths.get(e);if(!n||!n.enabled)return[];const a=[],o=s-t,l=Math.ceil(o*i);for(let d=0;d<=l;d++){const u=t+d/i,h=o>0?(u-t)/o:0,p=e2(n.points,h);p&&a.push({time:u,...p})}return a}dispose(){for(const e of this.timelines.values())e.kill();this.timelines.clear(),this.motionPaths.clear()}}let ng=null;function sX(){return ng||(ng=new tX),ng}const iX=["#ff6b6b","#ffd93d","#6bcb77","#4d96ff","#ff6b9d","#845ef7"],t2=["#ff4500","#ff6b00","#ffb700","#ffd700"],rX=["#ffffff","#fffacd","#fff8dc","#ffffe0"],s2=["#a0a0a0","#808080","#606060","#404040"],i2=["#9b59b6","#8e44ad","#3498db","#2980b9","#e91e63"],VP=[{id:"dissolve-soft",name:"Soft Dissolve",type:"dissolve",description:"Gentle dissolve effect with fading particles",config:{...Gi,particleCount:200,speed:30,speedVariance:20,gravity:10,colors:s2,size:{min:2,max:6},opacity:{start:.8,end:0},lifetime:{min:1,max:3},emissionRate:100,fadeIn:.1,fadeOut:.5,blendMode:"normal"}},{id:"explode-burst",name:"Explosion Burst",type:"explode",description:"Dramatic explosion with fast-moving particles",config:{...Gi,particleCount:300,speed:400,speedVariance:150,gravity:300,colors:t2,size:{min:3,max:12},opacity:{start:1,end:0},lifetime:{min:.5,max:1.5},emissionRate:500,emissionShape:"circle",emissionRadius:20,fadeOut:.4,blendMode:"add"}},{id:"implode-gather",name:"Implode Gather",type:"implode",description:"Particles gather toward the center",config:{...Gi,particleCount:150,speed:200,speedVariance:50,gravity:0,colors:i2,size:{min:4,max:10},opacity:{start:0,end:1},lifetime:{min:.8,max:1.5},emissionRate:80,emissionShape:"circle",emissionRadius:300,fadeIn:.3,fadeOut:.1,blendMode:"add"}},{id:"confetti-celebration",name:"Celebration Confetti",type:"confetti",description:"Colorful falling confetti for celebrations",config:{...Gi,particleCount:200,speed:150,speedVariance:80,gravity:200,wind:{x:30,y:0,z:0},turbulence:50,colors:iX,size:{min:6,max:14},opacity:{start:1,end:.8},lifetime:{min:2,max:4},emissionRate:60,emissionShape:"rectangle",emissionRadius:400,rotationSpeed:5,fadeOut:.3,blendMode:"normal"}},{id:"dust-ambient",name:"Ambient Dust",type:"dust",description:"Subtle floating dust particles",config:{...Gi,particleCount:80,speed:15,speedVariance:10,gravity:-5,turbulence:20,colors:s2,size:{min:1,max:3},opacity:{start:.4,end:.1},lifetime:{min:3,max:8},emissionRate:10,emissionShape:"rectangle",emissionRadius:500,fadeIn:.3,fadeOut:.5,blendMode:"normal"}},{id:"sparkle-magic",name:"Magic Sparkles",type:"sparkle",description:"Glittering sparkle effect",config:{...Gi,particleCount:100,speed:20,speedVariance:15,gravity:10,colors:rX,size:{min:2,max:6},opacity:{start:1,end:0},lifetime:{min:.3,max:.8},emissionRate:80,emissionShape:"sphere",emissionRadius:100,fadeIn:.1,fadeOut:.5,blendMode:"add"}},{id:"disintegrate-thanos",name:"Disintegration",type:"disintegrate",description:"Object breaks apart and fades away",config:{...Gi,particleCount:400,speed:60,speedVariance:40,gravity:-30,wind:{x:50,y:-20,z:0},turbulence:30,colors:["#a0a0a0","#808080","#606060"],size:{min:2,max:5},opacity:{start:1,end:0},lifetime:{min:1,max:2.5},emissionRate:200,emissionShape:"rectangle",emissionRadius:200,fadeOut:.6,blendMode:"normal"}},{id:"pixelate-retro",name:"Pixel Break",type:"pixelate",description:"Breaks into pixel-like blocks",config:{...Gi,particleCount:150,speed:100,speedVariance:50,gravity:400,colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"],size:{min:8,max:16},opacity:{start:1,end:.5},lifetime:{min:.5,max:1.2},emissionRate:200,emissionShape:"rectangle",emissionRadius:150,rotationSpeed:3,fadeOut:.3,blendMode:"normal"}},{id:"shatter-glass",name:"Glass Shatter",type:"shatter",description:"Glass-breaking effect with sharp fragments",config:{...Gi,particleCount:250,speed:300,speedVariance:150,gravity:500,colors:["#ffffff","#e0e0e0","#c0c0c0","#a0a0a0"],size:{min:3,max:12},opacity:{start:.9,end:.3},lifetime:{min:.4,max:1},emissionRate:400,emissionShape:"circle",emissionRadius:50,rotationSpeed:8,fadeOut:.4,blendMode:"normal"}},{id:"morph-transform",name:"Shape Morph",type:"morph",description:"Transform from one shape to another",config:{...Gi,particleCount:200,speed:50,speedVariance:30,gravity:0,colors:i2,size:{min:4,max:8},opacity:{start:.8,end:.8},lifetime:{min:1,max:2},emissionRate:100,emissionShape:"circle",emissionRadius:150,fadeIn:.2,fadeOut:.2,blendMode:"add"}},{id:"fire-trail",name:"Fire Trail",type:"dust",description:"Fiery trailing particles",config:{...Gi,particleCount:150,speed:80,speedVariance:40,gravity:-100,colors:t2,size:{min:4,max:12},opacity:{start:.9,end:0},lifetime:{min:.3,max:.8},emissionRate:120,emissionShape:"circle",emissionRadius:20,fadeIn:.05,fadeOut:.6,blendMode:"add"}},{id:"snow-fall",name:"Snowfall",type:"dust",description:"Gentle falling snow",config:{...Gi,particleCount:100,speed:30,speedVariance:20,gravity:50,wind:{x:20,y:0,z:0},turbulence:30,colors:["#ffffff","#f0f0f0","#e8e8e8"],size:{min:2,max:6},opacity:{start:.8,end:.3},lifetime:{min:4,max:8},emissionRate:20,emissionShape:"rectangle",emissionRadius:600,rotationSpeed:1,fadeIn:.2,fadeOut:.4,blendMode:"normal"}}];function nX(r){return VP.find(e=>e.id===r)}function aX(r,e,t,s,i){const n=nX(r);return n?{id:e,clipId:t,type:n.type,startTime:s,duration:i,config:{...n.config},enabled:!0}:null}const jy="openreel_device_profile";function oX(r){return r>=8?"high":r>=4?"mid":"low"}function cX(r){return r>=8?"high":r>=4?"mid":"low"}function lX(r){const e=r.toLowerCase(),t=["nvidia rtx","nvidia geforce rtx","radeon rx 6","radeon rx 7","apple m1 pro","apple m1 max","apple m2","apple m3","intel arc"],s=["nvidia gtx 1","nvidia geforce gtx","radeon rx 5","apple m1","intel iris","intel uhd"];return t.some(i=>e.includes(i))?"high":s.some(i=>e.includes(i))?"mid":"low"}function dX(){const r=navigator.userAgent;let e="Unknown";r.includes("Windows")?e="Windows":r.includes("Mac")?e="macOS":r.includes("Linux")?e="Linux":r.includes("Android")?e="Android":r.includes("iPhone")||r.includes("iPad")?e="iOS":r.includes("CrOS")&&(e="ChromeOS");let t="Unknown";r.includes("Chrome")&&!r.includes("Edg")?t="Chrome":r.includes("Firefox")?t="Firefox":r.includes("Safari")&&!r.includes("Chrome")?t="Safari":r.includes("Edg")&&(t="Edge");const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(r);return{os:e,browser:t,isMobile:s}}function uX(){try{const r=document.createElement("canvas"),e=r.getContext("webgl2")||r.getContext("webgl")||r.getContext("experimental-webgl");if(!e)return{vendor:"Unknown",renderer:"Unknown",tier:"low"};const t=e.getExtension("WEBGL_debug_renderer_info");if(t){const s=e.getParameter(t.UNMASKED_VENDOR_WEBGL),i=e.getParameter(t.UNMASKED_RENDERER_WEBGL);return{vendor:s||"Unknown",renderer:i||"Unknown",tier:lX(i||"")}}return{vendor:"Unknown",renderer:"Unknown",tier:"mid"}}catch{return{vendor:"Unknown",renderer:"Unknown",tier:"low"}}}async function ch(r,e,t){if(typeof VideoEncoder>"u")return{hardware:!1,supported:!1};try{const s={codec:r,width:e,height:t,bitrate:5e6,framerate:30},i=await VideoEncoder.isConfigSupported({...s,hardwareAcceleration:"prefer-hardware"}),n=await VideoEncoder.isConfigSupported({...s,hardwareAcceleration:"prefer-software"});return{hardware:i.supported===!0&&i.config?.hardwareAcceleration==="prefer-hardware",supported:i.supported===!0||n.supported===!0,maxResolution:{width:e,height:t}}}catch{return{hardware:!1,supported:!1}}}async function hX(){const r={h264:"avc1.42001E",h265:"hvc1.1.6.L93.B0",vp9:"vp09.00.10.08",av1:"av01.0.04M.08"},[e,t,s,i]=await Promise.all([ch(r.h264,1920,1080),ch(r.h265,1920,1080),ch(r.vp9,1920,1080),ch(r.av1,1920,1080)]);return{h264:e,h265:t,vp9:s,av1:i}}function pX(r,e,t){const s={low:1,mid:2,high:3},i=(s[r.tier]+s[e.tier]+s[t.tier]*1.5)/3.5;return i>=2.5?"high":i>=1.5?"mid":"low"}async function fX(){const r=navigator.hardwareConcurrency||4,e=navigator.deviceMemory||4,t={cores:r,tier:oX(r)},s={gb:e,tier:cX(e)},i=uX(),n=await hX(),a=dX(),o=Object.values(n).some(h=>h.hardware),l={...i,hasHardwareEncoding:o},d=pX(t,s,l),u=mX();return{cpu:t,memory:s,gpu:l,encoding:n,platform:a,overallTier:d,benchmark:u}}function r2(r,e){const t=e.width*e.height>2073600,s=[];if(r.encoding.h264.supported){const i=r.encoding.h264.hardware;s.push({codec:"h264",label:"H.264 (MP4)",recommended:!0,reason:i?"Hardware accelerated":"Fast software encoding",speedRating:i?"fast":"medium",qualityRating:"good"})}if(r.encoding.h265.supported){const i=r.encoding.h265.hardware;s.push({codec:"h265",label:"H.265/HEVC (MP4)",recommended:i&&!t,reason:i?"Hardware accelerated, better compression":"Better compression, slower encoding",speedRating:i?"medium":"slow",qualityRating:"better"})}if(r.encoding.vp9.supported&&s.push({codec:"vp9",label:"VP9 (WebM)",recommended:!1,reason:"Good for web, software encoding only",speedRating:"slow",qualityRating:"better"}),r.encoding.av1.supported){const i=r.encoding.av1.hardware;s.push({codec:"av1",label:"AV1 (MP4/WebM)",recommended:i&&r.overallTier==="high",reason:i?"Best compression, hardware accelerated":"Best compression, very slow encoding",speedRating:i?"medium":"very-slow",qualityRating:"best"})}return s.sort((i,n)=>i.recommended&&!n.recommended?-1:!i.recommended&&n.recommended?1:0)}function mX(){try{const r=localStorage.getItem(jy);if(r){const e=JSON.parse(r),t=7*24*60*60*1e3;if(e.benchmark&&Date.now()-e.benchmark.testedAt<t)return e.benchmark}}catch{}}function gX(r){try{const e=localStorage.getItem(jy),t=e?JSON.parse(e):{};t.benchmark=r,localStorage.setItem(jy,JSON.stringify(t))}catch{}}let lh=null;async function _y(r=!1){return!r&&lh||(lh=await fX()),lh}function yX(r){const e=[];if(r.gpu.renderer!=="Unknown"){const t=r.gpu.renderer.replace(/ANGLE \(|, .*\)/g,"").replace(/Direct3D11 vs_\d+_\d+ ps_\d+_\d+/g,"").trim();e.push(t)}return e.push(`${r.cpu.cores} cores`),e.join("  ")}const xX={h264:{hardware_high:120,hardware_mid:90,hardware_low:60,software_high:45,software_mid:30,software_low:15},h265:{hardware_high:60,hardware_mid:45,hardware_low:30,software_high:15,software_mid:8,software_low:4},vp9:{hardware_high:30,hardware_mid:20,hardware_low:15,software_high:20,software_mid:12,software_low:6},av1:{hardware_high:45,hardware_mid:30,hardware_low:20,software_high:8,software_mid:4,software_low:2}},n2={"1280x720":1.5,"1920x1080":1,"2560x1440":.6,"3840x2160":.25};function bX(r,e){const t=`${r}x${e}`;if(n2[t])return n2[t];const s=r*e;return 1920*1080/s}function a2(r){let e=1;return r.hasEffects&&(e*=.7),r.hasTransitions&&(e*=.85),r.trackCount&&r.trackCount>2&&(e*=Math.max(.5,1-(r.trackCount-2)*.1)),e}function o2(r){if(r<60)return`~${Math.round(r)} seconds`;const e=Math.floor(r/60),t=Math.round(r%60);if(e<60)return t===0?`~${e} minute${e>1?"s":""}`:`~${e}m ${t}s`;const s=Math.floor(e/60),i=e%60;return`~${s}h ${i}m`}function UP(r,e){const t=Math.ceil(e.duration*e.frameRate);if(r.benchmark){const f=r.benchmark.resolution.width*r.benchmark.resolution.height,m=e.width*e.height,g=f/m;let y=1;if(r.benchmark.codec!==e.codec){const w={h264:1,h265:.4,vp9:.5,av1:.2};y=(w[r.benchmark.codec]||1)/(w[e.codec]||1)}const x=r.benchmark.framesPerSecond*g*y*a2(e),b=t/Math.max(1,x);return{seconds:b,formatted:o2(b),confidence:"measured",breakdown:{rendering:b*.4,encoding:b*.55,muxing:b*.05}}}const i=r.encoding[e.codec]?.hardware||!1,n=r.overallTier,o=`${i?"hardware":"software"}_${n}`,l=xX[e.codec]?.[o]||15,d=bX(e.width,e.height),u=a2(e),h=l*d*u,p=t/Math.max(1,h);return{seconds:p,formatted:o2(p),confidence:"estimated",breakdown:{rendering:p*.4,encoding:p*.55,muxing:p*.05}}}async function vX(r){r?.({phase:"preparing",progress:0,framesProcessed:0,totalFrames:60});const i=new OffscreenCanvas(1920,1080),n=i.getContext("2d");if(!n)throw new Error("Failed to create canvas context for benchmark");const a=[];for(let y=0;y<60;y++){n.fillStyle=`hsl(${y*6%360}, 70%, 50%)`,n.fillRect(0,0,1920,1080),n.fillStyle="white",n.font="48px sans-serif",n.fillText(`Frame ${y+1}`,1920/2-80,1080/2);const x=await createImageBitmap(i);a.push(x),r?.({phase:"rendering",progress:(y+1)/60*.3,framesProcessed:y+1,totalFrames:60})}if(typeof VideoEncoder>"u")throw a.forEach(y=>y.close()),new Error("VideoEncoder not supported");let o=0;const l=new VideoEncoder({output:y=>{o++,r?.({phase:"encoding",progress:.3+o/60*.65,framesProcessed:o,totalFrames:60})},error:y=>{console.error("Benchmark encoder error:",y)}}),d={codec:"avc1.42001E",width:1920,height:1080,bitrate:5e6,framerate:30,hardwareAcceleration:"prefer-hardware"};(await VideoEncoder.isConfigSupported(d)).supported||(d.hardwareAcceleration="prefer-software"),l.configure(d);const h=performance.now();for(let y=0;y<a.length;y++){const x=new VideoFrame(a[y],{timestamp:y*33333.333333333336,duration:33333.333333333336});l.encode(x,{keyFrame:y%30===0}),x.close()}await l.flush(),l.close();const m=60/((performance.now()-h)/1e3);a.forEach(y=>y.close()),r?.({phase:"complete",progress:1,framesProcessed:60,totalFrames:60});const g={framesPerSecond:m,codec:"h264",resolution:{width:1920,height:1080},testedAt:Date.now()};return gX(g),g}function wX(r){if(!r.benchmark)return!0;const e=7*24*60*60*1e3;return Date.now()-r.benchmark.testedAt>e}const _s={format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:5e3,bitrateMode:"cbr",quality:80,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:192,channels:2}},ag={format:"mp3",sampleRate:48e3,bitDepth:16,bitrate:320,channels:2},c2={format:"jpg",quality:90,width:1920,height:1080},Ln={"4k-high":{width:3840,height:2160,bitrate:8e4,frameRate:30,quality:95},"4k":{width:3840,height:2160,bitrate:5e4,frameRate:30,quality:90},"4k-60":{width:3840,height:2160,bitrate:65e3,frameRate:60,quality:90},"1080p-high":{width:1920,height:1080,bitrate:25e3,frameRate:30,quality:95},"1080p":{width:1920,height:1080,bitrate:15e3,frameRate:30,quality:85},"720p":{width:1280,height:720,bitrate:8e3,frameRate:30,quality:80}};let Qi=null,og=null;async function kX(){if(typeof WebAssembly>"u")return null;try{const r=new URL("data:application/wasm;base64,AGFzbQEAAAABKwdgBH9/f38AYAF/AX9gA39/fwBgBX9/f39/AGACf38Bf2ADf39/AX9gAAACDQEDZW52BWFib3J0AAADCgkCAAADBAUBAQYFAwEAAQYGAX8BQQALB3AHD2VuY29kZVdhdjE2TW9ubwABEWVuY29kZVdhdjE2U3RlcmVvAAIRZW5jb2RlV2F2MjRTdGVyZW8AAw53cml0ZVdhdkhlYWRlcgAECmFsbG9jYXRlVTgABwthbGxvY2F0ZUYzMgAIBm1lbW9yeQIACAEJDAEICs8LCYEBAgR/AX0gACgCCEECdiEEA0AgAyAESARAIAIgA0EBdGoiBSABKAIEakMAAIC/QwAAgD8gACgCBCADQQJ0aioCACIHIAdDAACAP14bIAdDAACAv10bQwD+/0aU/AAiBjoAACABKAIEIAVBAWpqIAbBQQh1OgAAIANBAWohAwwBCwsL1wECAX0FfyAAKAIIQQJ2IQgDQCAFIAhIBEBDAACAv0MAAIA/IAVBAnQiCSABKAIEaioCACIEIARDAACAP14bIARDAACAv10bQwD+/0aU/AAhByADIAlqIgYgAigCBGpDAACAv0MAAIA/IAkgACgCBGoqAgAiBCAEQwAAgD9eGyAEQwAAgL9dG0MA/v9GlPwAIgk6AAAgAigCBCAGQQFqaiAJwUEIdToAACACKAIEIAZBAmpqIAc6AAAgAigCBCAGQQNqaiAHwUEIdToAACAFQQFqIQUMAQsLC/4BAgF9BX8gACgCCEECdiEIA0AgBiAISARAQwAAgL9DAACAPyAGQQJ0IgkgASgCBGoqAgAiBCAEQwAAgD9eGyAEQwAAgL9dG0P+//9KlPwAIQcgAyAGQQZsaiIFIAIoAgRqQwAAgL9DAACAPyAJIAAoAgRqKgIAIgQgBEMAAIA/XhsgBEMAAIC/XRtD/v//SpT8ACIJOgAAIAIoAgQgBUEBamogCUEIdToAACACKAIEIAVBAmpqIAlBEHU6AAAgAigCBCAFQQNqaiAHOgAAIAIoAgQgBUEEamogB0EIdToAACACKAIEIAVBBWpqIAdBEHU6AAAgBkEBaiEGDAELCwuRBAEDfyABIANBA3VsIgYgAmwhBSAAKAIEQdIAOgAAIAAoAgRByQA6AAEgACgCBEHGADoAAiAAKAIEQcYAOgADIAAoAgQgBCAGbCIEQSRqIgc6AAQgACgCBCAHQQh1OgAFIAAoAgQgB0EQdToABiAAKAIEIAdBGHU6AAcgACgCBEHXADoACCAAKAIEQcEAOgAJIAAoAgRB1gA6AAogACgCBEHFADoACyAAKAIEQeYAOgAMIAAoAgRB7QA6AA0gACgCBEH0ADoADiAAKAIEQSA6AA8gACgCBEEQOgAQIAAoAgRBADoAESAAKAIEQQA6ABIgACgCBEEAOgATIAAoAgRBAToAFCAAKAIEQQA6ABUgACgCBCABOgAWIAAoAgQgAUEIdToAFyAAKAIEIAI6ABggACgCBCACQQh1OgAZIAAoAgQgAkEQdToAGiAAKAIEIAJBGHU6ABsgACgCBCAFOgAcIAAoAgQgBUEIdToAHSAAKAIEIAVBEHU6AB4gACgCBCAFQRh1OgAfIAAoAgQgBjoAICAAKAIEIAZBCHU6ACEgACgCBCADOgAiIAAoAgQgA0EIdToAIyAAKAIEQeQAOgAkIAAoAgRB4QA6ACUgACgCBEH0ADoAJiAAKAIEQeEAOgAnIAAoAgQgBDoAKCAAKAIEIARBCHU6ACkgACgCBCAEQRB1OgAqIAAoAgQgBEEYdToAKwvKAQEGfyAAQez///8DSwRAQZAJQdAJQdYAQR4QAAALIABBEGoiBEH8////A0sEQEGQCUHQCUEhQR0QAAALIwAhAyMAQQRqIgIgBEETakFwcUEEayIEaiIFPwAiBkEQdEEPakFwcSIHSwRAIAYgBSAHa0H//wNqQYCAfHFBEHYiByAGIAdKG0AAQQBIBEAgB0AAQQBIBEAACwsLIAUkACADIAQ2AgAgAkEEayIDQQA2AgQgA0EANgIIIAMgATYCDCADIAA2AhAgAkEQagtsACAARQRAQQxBAxAFIQALIABBADYCACAAQQA2AgQgAEEANgIIIAFB/P///wMgAnZLBEBBoAhB0AhBE0E5EAAACyABIAJ0IgFBARAFIgJBACAB/AsAIAAgAjYCACAAIAI2AgQgACABNgIIIAALDgBBDEEFEAUgAEEAEAYLDgBBDEEEEAUgAEECEAYLBwBB/AkkAAsL2QEIAEGMCAsBLABBmAgLIwIAAAAcAAAASQBuAHYAYQBsAGkAZAAgAGwAZQBuAGcAdABoAEG8CAsBPABByAgLLQIAAAAmAAAAfgBsAGkAYgAvAGEAcgByAGEAeQBiAHUAZgBmAGUAcgAuAHQAcwBB/AgLATwAQYgJCy8CAAAAKAAAAEEAbABsAG8AYwBhAHQAaQBvAG4AIAB0AG8AbwAgAGwAYQByAGcAZQBBvAkLATwAQcgJCyUCAAAAHgAAAH4AbABpAGIALwByAHQALwBzAHQAdQBiAC4AdABz",import.meta.url),e=await fetch(r);if(!e.ok)return null;const t=await e.arrayBuffer(),{instance:s}=await WebAssembly.instantiate(t,{env:{abort:()=>{throw new Error("WASM abort")}}});return s.exports}catch{return null}}async function CX(){return Qi?!0:(og||(og=kX()),Qi=await og,Qi!==null)}function SX(r,e,t){for(let s=0;s<r.length;s++){let i=r[s];i=Math.max(-1,Math.min(1,i));const n=Math.round(i*32767),a=t+s*2;e[a]=n&255,e[a+1]=n>>8&255}}function TX(r,e,t,s){for(let i=0;i<r.length;i++){let n=Math.max(-1,Math.min(1,r[i])),a=Math.max(-1,Math.min(1,e[i]));const o=Math.round(n*32767),l=Math.round(a*32767),d=s+i*4;t[d]=o&255,t[d+1]=o>>8&255,t[d+2]=l&255,t[d+3]=l>>8&255}}function AX(r,e,t,s){for(let n=0;n<r.length;n++){let a=Math.max(-1,Math.min(1,r[n])),o=Math.max(-1,Math.min(1,e[n]));const l=Math.round(a*8388607),d=Math.round(o*8388607),u=s+n*6;t[u]=l&255,t[u+1]=l>>8&255,t[u+2]=l>>16&255,t[u+3]=d&255,t[u+4]=d>>8&255,t[u+5]=d>>16&255}}function jX(r,e,t,s,i){const n=s>>3,a=e*n,o=t*a,l=i*a,d=36+l;r[0]=82,r[1]=73,r[2]=70,r[3]=70,r[4]=d&255,r[5]=d>>8&255,r[6]=d>>16&255,r[7]=d>>24&255,r[8]=87,r[9]=65,r[10]=86,r[11]=69,r[12]=102,r[13]=109,r[14]=116,r[15]=32,r[16]=16,r[17]=0,r[18]=0,r[19]=0,r[20]=1,r[21]=0,r[22]=e&255,r[23]=e>>8&255,r[24]=t&255,r[25]=t>>8&255,r[26]=t>>16&255,r[27]=t>>24&255,r[28]=o&255,r[29]=o>>8&255,r[30]=o>>16&255,r[31]=o>>24&255,r[32]=a&255,r[33]=a>>8&255,r[34]=s&255,r[35]=s>>8&255,r[36]=100,r[37]=97,r[38]=116,r[39]=97,r[40]=l&255,r[41]=l>>8&255,r[42]=l>>16&255,r[43]=l>>24&255}class _X{useWasm;constructor(){this.useWasm=Qi!==null}async ensureWasm(){return this.useWasm?!0:(await CX()&&(this.useWasm=!0),this.useWasm)}encodeWav16Mono(e,t,s){this.useWasm&&Qi?Qi.encodeWav16Mono(e,t,s):SX(e,t,s)}encodeWav16Stereo(e,t,s,i){this.useWasm&&Qi?Qi.encodeWav16Stereo(e,t,s,i):TX(e,t,s,i)}encodeWav24Stereo(e,t,s,i){this.useWasm&&Qi?Qi.encodeWav24Stereo(e,t,s,i):AX(e,t,s,i)}writeWavHeader(e,t,s,i,n){this.useWasm&&Qi?Qi.writeWavHeader(e,t,s,i,n):jX(e,t,s,i,n)}encodeFullWav(e,t,s=16){const i=e.length,n=e[0].length,a=s>>3,o=n*i*a,l=new Uint8Array(44+o);return this.writeWavHeader(l,i,t,s,n),i===1&&s===16?this.encodeWav16Mono(e[0],l,44):i===1&&s===24?this.encodeWav24Mono(e[0],l,44):s===16?this.encodeWav16Stereo(e[0],e[1],l,44):this.encodeWav24Stereo(e[0],e[1],l,44),l}encodeWav24Mono(e,t,s){for(let n=0;n<e.length;n++){let a=Math.max(-1,Math.min(1,e[n]));const o=Math.round(a*8388607),l=s+n*3;t[l]=o&255,t[l+1]=o>>8&255,t[l+2]=o>>16&255}}}let cg=null;function EX(){return cg||(cg=new _X),cg}class MX{mediabunny=null;initialized=!1;videoEngine=null;audioEngine=null;upscalingEngine=null;abortController=null;currentExport=null;exportWorker=null;async initialize(){if(!this.initialized){try{this.mediabunny=await _i(()=>import("./index5.js"),[])}catch(e){console.warn("[ExportEngine] MediaBunny not available:",e),this.mediabunny=null}try{this.videoEngine=kM(),this.audioEngine=Ab(),this.videoEngine.isInitialized()||await this.videoEngine.initialize(),this.audioEngine.isInitialized()||await this.audioEngine.initialize(),this.initialized=!0}catch(e){throw new Error(`ExportEngine initialization failed: ${e instanceof Error?e.message:"Unknown error"}`)}}}async initializeGPUForExport(e,t){(!this.initialized||!this.videoEngine)&&await this.initialize();try{await this.videoEngine.initializeGPUCompositor(e,t);const s=this.videoEngine.getGPUCompositor();if(s){const i=s.getDevice();return i&&(this.upscalingEngine=RW(),await this.upscalingEngine.initialize({device:i})),!0}return!1}catch(s){throw new Error(`ExportEngine initialization failed: ${s instanceof Error?s.message:"Unknown error"}`)}}isMediaBunnyAvailable(){return this.mediabunny!==null}isWebCodecsSupported(){return typeof VideoEncoder<"u"&&typeof AudioEncoder<"u"}isInitialized(){return this.initialized}ensureInitialized(){if(!this.initialized||!this.mediabunny)throw new Error("ExportEngine not initialized. Call initialize() first.")}async findSupportedAudioCodec(e,t,s){const i=e.getSupportedAudioCodecs(),a=[t.bitrate*1e3,192e3,128e3,96e3].filter((l,d,u)=>u.indexOf(l)===d);for(const l of a){const d=await s(i);if(d&&await this.isAudioConfigSupported(d,l,t.channels,t.sampleRate))return{codec:d,bitrate:l}}for(const l of["aac","mp3","opus"])if(i.some(d=>String(d).toLowerCase().includes(l)||l==="aac"&&String(d).toLowerCase().includes("mp4a"))){for(const d of a)if(await this.isAudioConfigSupported(l,d,t.channels,t.sampleRate))return{codec:l,bitrate:d}}return{codec:await s(i)||"aac",bitrate:128e3}}async isAudioConfigSupported(e,t,s,i){if(typeof AudioEncoder>"u")return!0;try{let n;e==="aac"||e.includes("mp4a")?n="mp4a.40.2":e==="opus"?n="opus":e==="mp3"?n="mp3":n=e;const a={codec:n,sampleRate:i,numberOfChannels:s,bitrate:t};return(await AudioEncoder.isConfigSupported(a)).supported===!0}catch{return!1}}async*exportVideo(e,t={}){if(this.ensureInitialized(),!this.mediabunny){const h=this.isWebCodecsSupported()?"MediaBunny library failed to load. Please refresh the page and try again.":"Video export requires WebCodecs API which is not supported in your browser. Please use Chrome, Edge, or another WebCodecs-compatible browser.";return{success:!1,error:this.createError("UNSUPPORTED_CODEC",h,"preparing")}}const s={..._s,...t,audioSettings:{..._s.audioSettings,...t.audioSettings}};s.codec==="prores"&&(console.warn("[ExportEngine] ProRes encoding is not supported in browsers. Switching to H.264 high quality."),s.codec="h264",s.format="mp4",s.bitrate=25e3,s.quality=95);const i=s.width*s.height,n=s.codec==="vp9"||s.codec==="av1"||s.codec==="h265",a=n?1920*1080:3840*2160;if(i>a&&n){console.warn(`[ExportEngine] ${s.codec.toUpperCase()} at ${s.width}x${s.height} may cause browser instability. Reducing to 1080p for stability.`);const h=s.width/s.height;h>1?(s.width=1920,s.height=Math.round(1920/h)):(s.height=1920,s.width=Math.round(1920*h)),s.width=Math.round(s.width/2)*2,s.height=Math.round(s.height/2)*2}this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0},await this.initializeGPUForExport(s.width,s.height),this.videoEngine?.resetExportState();const{timeline:o}=e,l=o.duration&&o.duration>0?o.duration:this.calculateTimelineDuration(o);if(console.log("[Export Video] Timeline duration:",l,"s (manual:",o.duration,"calculated:",this.calculateTimelineDuration(o),")"),l<=0)return{success:!1,error:this.createError("MUXER_ERROR","Timeline is empty. Add clips before exporting.","preparing")};const d=Math.ceil(l*s.frameRate);console.log("[Export Video] Total frames:",d);let u=0;try{yield this.createProgress("preparing",0,d,0,0);const{Output:h,BufferTarget:p,Mp4OutputFormat:f,WebMOutputFormat:m,MovOutputFormat:g,VideoSampleSource:y,AudioSampleSource:x,VideoSample:b,AudioSample:w,getFirstEncodableVideoCodec:C,getFirstEncodableAudioCodec:k,QUALITY_MEDIUM:S}=this.mediabunny;let A;switch(s.format){case"webm":A=new m;break;case"mov":A=new g;break;case"mp4":default:A=new f({fastStart:"in-memory"});break}const T=new p,j=new h({format:A,target:T}),_=await C(A.getSupportedVideoCodecs(),{width:s.width,height:s.height});if(!_)throw this.createError("UNSUPPORTED_CODEC","No supported video codec found","preparing");const M=await this.findSupportedAudioCodec(A,s.audioSettings,k),P=new y({codec:_,bitrate:S,keyFrameInterval:s.keyframeInterval/s.frameRate,hardwareAcceleration:"prefer-hardware"}),R=new x({codec:M.codec,bitrate:M.bitrate});j.addVideoTrack(P),j.addAudioTrack(R),j.setMetadataTags({title:e.name,date:new Date}),await j.start();const B=s.codec==="vp9"||s.codec==="av1"||s.codec==="h265"?5:10,O=30,F=90;for(let E=0;E<d;E++){if(this.abortController.signal.aborted)throw this.createError("CANCELLED","Export cancelled by user","rendering");const G=E/s.frameRate,V=await this.videoEngine.renderFrame(e,G,s.width,s.height),U=this.shouldApplyUpscaling(e,s);let oe=V.image;if(U&&this.upscalingEngine?.isInitialized()){const ne=await this.upscalingEngine.upscaleImageBitmap(oe,s.width,s.height,s.upscaling);oe.close(),oe=ne}const re=new b(oe,{timestamp:G,duration:1/s.frameRate});if(await P.add(re),re.close(),oe.close(),this.currentExport.framesRendered=E+1,(E+1)%B===0&&await new Promise(ne=>setTimeout(ne,0)),(E+1)%O===0&&await new Promise(ne=>setTimeout(ne,50)),(E+1)%F===0){this.videoEngine?.clearVideoElementCache();try{Ac().clearFrameCache()}catch{}await new Promise(ne=>setTimeout(ne,100))}yield this.createProgress("rendering",(E+1)/d,d,E+1,u)}yield this.createProgress("encoding",.95,d,d,u);const I=await this.renderTimelineAudio(e,s);if(I){const E=w.fromAudioBuffer(I,0);for(const G of E)await R.add(G),G.close()}P.close(),R.close(),yield this.createProgress("muxing",.98,d,d,u),await j.finalize();const J=T.buffer;if(!J)throw this.createError("MUXER_ERROR","Output buffer is empty","muxing");const Z=new Blob([J],{type:this.getMimeType(s.format)});return u=Z.size,yield this.createProgress("complete",1,d,d,u),{success:!0,blob:Z,stats:this.calculateStats(d,u)}}catch(h){return h&&typeof h=="object"&&"code"in h?{success:!1,error:h}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",h instanceof Error?h.message:"Unknown error","rendering")}}finally{this.abortController=null,this.currentExport=null,this.videoEngine?.clearVideoElementCache()}}async*exportVideoWithWorker(e,t={},s){this.ensureInitialized();const i={..._s,...t,audioSettings:{..._s.audioSettings,...t.audioSettings}};i.codec==="prores"&&(console.warn("[ExportEngine] ProRes encoding is not supported in browsers. Switching to H.264 high quality."),i.codec="h264",i.format="mp4",i.bitrate=25e3,i.quality=95);const n=i.width*i.height,a=i.codec==="vp9"||i.codec==="av1"||i.codec==="h265",o=a?1920*1080:3840*2160;if(n>o&&a){console.warn(`[ExportEngine] ${i.codec.toUpperCase()} at ${i.width}x${i.height} may cause browser instability. Reducing to 1080p for stability.`);const p=i.width/i.height;p>1?(i.width=1920,i.height=Math.round(1920/p)):(i.height=1920,i.width=Math.round(1920*p)),i.width=Math.round(i.width/2)*2,i.height=Math.round(i.height/2)*2}this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0},await this.initializeGPUForExport(i.width,i.height)||console.warn("[ExportEngine] GPU acceleration not available for export"),this.videoEngine?.resetExportState();const{timeline:d}=e,u=d.duration&&d.duration>0?d.duration:this.calculateTimelineDuration(d);if(console.log("[Export Worker] Timeline duration:",u,"s (manual:",d.duration,"calculated:",this.calculateTimelineDuration(d),")"),u<=0)return{success:!1,error:this.createError("MUXER_ERROR","Timeline is empty. Add clips before exporting.","preparing")};const h=Math.ceil(u*i.frameRate);console.log("[Export Worker] Total frames:",h);try{yield this.createProgress("preparing",0,h,0,0);const p=await this.runWorkerExport(e,i,h,s);for await(const m of p.progressGenerator){if(this.abortController?.signal.aborted)throw this.exportWorker?.postMessage({type:"cancel"}),this.createError("CANCELLED","Export cancelled by user","rendering");yield m}return await p.resultPromise}catch(p){return p&&typeof p=="object"&&"code"in p?{success:!1,error:p}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",p instanceof Error?p.message:"Unknown error","rendering")}}finally{this.terminateWorker(),this.abortController=null,this.currentExport=null,this.videoEngine?.clearVideoElementCache()}}async runWorkerExport(e,t,s,i){let n=null,a=null,o=null;const l=new Promise(y=>{n=y}),d=new Promise((y,x)=>{a=y,o=x});let u=0;const h=i?1:3;let p=null;this.exportWorker=new Worker(new URL("/was/openreel_video/app/assets/export-worker-DYVPyHvu.js",import.meta.url),{type:"module"}),this.exportWorker.onmessage=async y=>{const{type:x,blob:b,error:w,chunk:C}=y.data;if(x==="ready"){n?.();return}if(x==="chunk"&&i&&C){try{await i.write({type:"write",position:C.position,data:C.data})}catch(k){console.error("[ExportEngine] Failed to write chunk:",k)}return}if(x==="frameProcessed"){u=Math.max(0,u-1),p&&(p(),p=null);return}if(x==="complete"){if(i)try{await i.close()}catch(S){console.error("[ExportEngine] Failed to close stream:",S)}const k=this.calculateStats(s,b?.size||0);a?.({success:!0,blob:b,stats:k});return}if(x==="error"){if(i)try{await i.abort()}catch{}o?.(new Error(w||"Worker encoding failed"));return}},this.exportWorker.onerror=y=>{o?.(new Error(y.message||"Worker error"))},this.exportWorker.postMessage({type:"init",settings:t,projectName:e.name,useStreamTarget:!!i}),await l;const f=this;async function m(){u<h||await new Promise(y=>{p=y})}async function*g(){for(let x=0;x<s;x++){if(f.abortController?.signal.aborted)return;await m();const b=x/t.frameRate,w=await f.videoEngine.renderFrame(e,b,t.width,t.height),C=f.shouldApplyUpscaling(e,t);let k=w.image;if(C&&f.upscalingEngine?.isInitialized()){const A=await f.upscalingEngine.upscaleImageBitmap(k,t.width,t.height,t.upscaling);k.close(),k=A}u++,f.exportWorker?.postMessage({type:"addFrame",frame:k,frameIndex:x,timestamp:b,totalFrames:s,settings:t},[k]),f.currentExport.framesRendered=x+1,yield f.createProgress("rendering",(x+1)/s,s,x+1,0);const S=i?10:30;if((x+1)%S===0){f.videoEngine?.clearVideoElementCache();try{Ac().clearFrameCache()}catch{}i&&await new Promise(A=>setTimeout(A,50))}}for(;u>0;)await new Promise(x=>{u===0?x():p=x});yield f.createProgress("encoding",.95,s,s,0);const y=await f.renderTimelineAudioPublic(e);if(y){const x=[];for(let b=0;b<y.numberOfChannels;b++)x.push(y.getChannelData(b).slice());f.exportWorker?.postMessage({type:"addAudio",audioBuffer:{channels:x,sampleRate:y.sampleRate,length:y.length}})}yield f.createProgress("muxing",.98,s,s,0),f.exportWorker?.postMessage({type:"finalize"})}return{progressGenerator:g(),resultPromise:d}}async renderTimelineAudioPublic(e){return this.renderTimelineAudio(e)}isSimpleProject(e){const{timeline:t}=e,s=t.tracks.filter(h=>!h.hidden),i=s.filter(h=>h.type==="video"||h.type==="image"),n=s.filter(h=>h.type==="text"),a=s.filter(h=>h.type==="graphics"),o=s.filter(h=>h.type==="audio");if(n.length>0)return{simple:!1};if(a.length>0)return{simple:!1};if(o.length>0&&o.some(h=>h.clips.length>0))return{simple:!1};let l=0,d,u=!1;for(const h of i)for(const p of h.clips){if(l++,p.effects&&p.effects.length>0&&(u=!0),p.keyframes&&p.keyframes.length>0&&(u=!0),p.transform){const f=p.transform;(f.scale.x!==1||f.scale.y!==1||f.rotation!==0||f.position.x!==0||f.position.y!==0||f.opacity!==1)&&(u=!0)}l===1&&!u&&e.mediaLibrary.items.find(m=>m.id===p.mediaId)?.type==="video"&&(d={mediaId:p.mediaId,startTime:p.inPoint,endTime:p.outPoint,speed:p.speed||1})}return u?{simple:!1}:l===1&&d?{simple:!0,singleClip:d}:{simple:!1}}async*exportVideoWithFFmpeg(e,t={},s){this.initialized||await this.initialize();const i={..._s,...t,audioSettings:{..._s.audioSettings,...t.audioSettings}};i.codec==="prores"&&(i.codec="h264",i.format="mp4",i.bitrate=25e3,i.quality=95),this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0};const{timeline:n}=e,a=n.duration&&n.duration>0?n.duration:this.calculateTimelineDuration(n);if(console.log("[Export FFmpeg] Timeline duration:",a,"s (manual:",n.duration,"calculated:",this.calculateTimelineDuration(n),")"),a<=0)return{success:!1,error:this.createError("MUXER_ERROR","Timeline is empty. Add clips before exporting.","preparing")};const o=Math.ceil(a*i.frameRate);console.log("[Export FFmpeg] Total frames:",o,"= ceil(",a,"*",i.frameRate,")");const l=this.isSimpleProject(e);this.videoEngine?.resetExportState(),yield this.createProgress("preparing",0,o,0,0);const d=Ac();d.isAvailable()||await d.initialize(),d.clearFrameCache(),d.disposeAllExportDecoders(),this.videoEngine?.clearVideoElementCache();try{const u=bM();if(await u.load(),l.simple&&l.singleClip){const w=e.mediaLibrary.items.find(C=>C.id===l.singleClip.mediaId);if(w?.blob){const C=w.metadata.width,k=w.metadata.height,S=e.timeline.tracks.flatMap(O=>O.clips).find(O=>O.mediaId===l.singleClip.mediaId),A=S&&(S.effects&&S.effects.length>0||S.transform&&(S.transform.scale.x!==1||S.transform.scale.y!==1||S.transform.rotation!==0||S.transform.position.x!==0||S.transform.position.y!==0||S.transform.opacity!==1)||S.keyframes&&S.keyframes.length>0),T=e.timeline.tracks.filter(O=>!O.hidden),j=T.length>1,_=T.some(O=>(O.type==="text"||O.type==="graphics")&&O.clips.length>0),M=l.singleClip.speed===1&&C===i.width&&k===i.height&&l.singleClip.startTime===0&&!A&&!j&&!_;let P=null;const R=O=>{P=O},D=u.exportVideoDirectly(w.blob,{startTime:l.singleClip.startTime,endTime:l.singleClip.endTime,width:i.width,height:i.height,frameRate:i.frameRate,format:i.format==="webm"?"webm":"mp4",videoBitrate:`${i.bitrate}k`,audioBitrate:`${i.audioSettings.bitrate}k`,speed:l.singleClip.speed,writableStream:s,useStreamCopy:M},R);for(;;){if(await new Promise(F=>setTimeout(F,100)),P!==null){const F=P;if(yield F,F.phase==="complete")break}if(await Promise.race([D.then(()=>!0),new Promise(F=>setTimeout(()=>F(!1),10))]))break}const B=await D;return{success:!0,blob:B||void 0,stats:this.calculateStats(o,B?.size||0)}}}await this.initializeGPUForExport(i.width,i.height);const h=new Set;for(const w of e.timeline.tracks)for(const C of w.clips)C.mediaId&&h.add(C.mediaId);for(const w of h){const C=e.mediaLibrary.items.find(k=>k.id===w);C?.blob&&C.type==="video"&&await d.createExportDecoder(w,C.blob,i.width)}const p=this;console.log("[Export FFmpeg] Using frame-by-frame rendering. Total frames:",o);async function*f(){for(let w=0;w<o;w++){if(w%24===0&&console.log("[Export FFmpeg] Rendering frame",w,"of",o),p.abortController?.signal.aborted)return;const C=w/i.frameRate,k=await p.videoEngine.renderFrame(e,C,i.width,i.height),S=p.shouldApplyUpscaling(e,i);let A=k.image;if(S&&p.upscalingEngine?.isInitialized()){const T=await p.upscalingEngine.upscaleImageBitmap(A,i.width,i.height,i.upscaling);A.close(),A=T}p.currentExport.framesRendered=w+1,(w+1)%60===0&&(p.videoEngine?.clearVideoElementCache(),d.clearFrameCache()),yield{image:A,frameIndex:w}}}let m=null;const g=w=>{m=w},y=await this.renderTimelineAudio(e,i),x=u.encodeFrameSequence(f(),{width:i.width,height:i.height,frameRate:i.frameRate,totalFrames:o,format:i.format==="webm"?"webm":"mp4",videoBitrate:`${i.bitrate}k`,audioBitrate:`${i.audioSettings.bitrate}k`,audioBuffer:y||void 0,writableStream:s},g);for(;;){if(await new Promise(C=>setTimeout(C,100)),m!==null){const C=m;if(yield C,C.phase==="complete")break}if(await Promise.race([x.then(()=>!0),new Promise(C=>setTimeout(()=>C(!1),10))]))break}const b=await x;return{success:!0,blob:b||void 0,stats:this.calculateStats(o,b?.size||0)}}catch(u){return u&&typeof u=="object"&&"code"in u?{success:!1,error:u}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",u instanceof Error?u.message:"Unknown error","rendering")}}finally{this.abortController=null,this.currentExport=null,this.videoEngine?.clearVideoElementCache(),d.disposeAllExportDecoders(),d.clearFrameCache()}}terminateWorker(){this.exportWorker&&(this.exportWorker.terminate(),this.exportWorker=null)}async*exportAudio(e,t={}){this.ensureInitialized();const s={...ag,...t};if(!this.mediabunny&&s.format!=="wav")return{success:!1,error:this.createError("UNSUPPORTED_CODEC",`Audio export to ${s.format} format requires MediaBunny. WAV format is available as a fallback.`,"preparing")};this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0};const{timeline:i}=e,n=this.calculateTimelineDuration(i);if(n<=0)return{success:!1,error:this.createError("AUDIO_ENCODE_FAILED","Timeline is empty. Add clips before exporting.","preparing")};try{yield this.createProgress("preparing",0,1,0,0);const a=await this.renderTimelineAudio(e,{audioSettings:s});if(!a)throw this.createError("AUDIO_ENCODE_FAILED","No audio to export","rendering");yield this.createProgress("encoding",.5,1,0,0);let o;return s.format==="wav"?o=this.encodeWav(a,s):o=await this.encodeAudioWithMediaBunny(a,s),yield this.createProgress("complete",1,1,1,o.size),{success:!0,blob:o,stats:{duration:Date.now()-this.currentExport.startTime,framesRendered:1,averageSpeed:1,fileSize:o.size,averageBitrate:o.size*8/n}}}catch(a){return a&&typeof a=="object"&&"code"in a?{success:!1,error:a}:{success:!1,error:this.createError("AUDIO_ENCODE_FAILED",a instanceof Error?a.message:"Unknown error","encoding")}}finally{this.abortController=null,this.currentExport=null}}async exportFrame(e,t,s={}){this.ensureInitialized();const i={...c2,width:e.settings.width,height:e.settings.height,...s};try{const n=await this.videoEngine.renderFrame(e,t,i.width,i.height);let a;if(i.width!==n.width||i.height!==n.height){a=new OffscreenCanvas(i.width,i.height);const d=a.getContext("2d");d&&d.drawImage(n.image,0,0,i.width,i.height),n.image.close()}else{a=new OffscreenCanvas(n.width,n.height);const d=a.getContext("2d");d&&d.drawImage(n.image,0,0),n.image.close()}const o=this.getImageMimeType(i.format),l=await a.convertToBlob({type:o,quality:i.quality/100});return{success:!0,blob:l,stats:{duration:0,framesRendered:1,averageSpeed:0,fileSize:l.size,averageBitrate:0}}}catch(n){return{success:!1,error:this.createError("FRAME_ENCODE_FAILED",n instanceof Error?n.message:"Unknown error","rendering")}}}async exportImage(e,t={}){return this.exportFrame(e,0,t)}async*exportImageSequence(e,t={}){this.ensureInitialized();const{timeline:s}=e,i=e.settings.frameRate,n=Math.ceil(s.duration*i),a={...c2,width:e.settings.width,height:e.settings.height,startFrame:0,endFrame:n-1,namingPattern:"frame_{0000}",...t};this.abortController=new AbortController,this.currentExport={startTime:Date.now(),framesRendered:0};const o=a.endFrame-a.startFrame+1,l=[];try{yield this.createProgress("preparing",0,o,0,0);for(let u=0;u<o;u++){if(this.abortController.signal.aborted)throw this.createError("CANCELLED","Export cancelled by user","rendering");const p=(a.startFrame+u)/i,f=await this.exportFrame(e,p,a);f.success&&f.blob&&l.push(f.blob),this.currentExport.framesRendered=u+1,yield this.createProgress("rendering",(u+1)/o,o,u+1,l.reduce((m,g)=>m+g.size,0))}yield this.createProgress("complete",1,o,o,0);const d=l.reduce((u,h)=>u+h.size,0);return{success:!0,blob:l[0],stats:this.calculateStats(o,d)}}catch(d){return d&&typeof d=="object"&&"code"in d?{success:!1,error:d}:{success:!1,error:this.createError("FRAME_ENCODE_FAILED",d instanceof Error?d.message:"Unknown error","rendering")}}finally{this.abortController=null,this.currentExport=null}}cancel(){this.abortController&&this.abortController.abort()}getPresets(){return[{id:"4k-master",name:"4K Master Quality",description:"Maximum quality 4K for professional delivery",category:"broadcast",settings:{..._s,...Ln["4k-high"],codec:"h265",quality:95}},{id:"4k-prores-hq",name:"4K ProRes HQ",description:"Professional 4K ProRes for editing/mastering",category:"broadcast",settings:{..._s,width:3840,height:2160,frameRate:30,format:"mov",codec:"prores",proresProfile:"hq",bitrate:88e4,quality:100}},{id:"4k-prores-4444",name:"4K ProRes 4444",description:"Highest quality ProRes with alpha channel support",category:"broadcast",settings:{..._s,width:3840,height:2160,frameRate:30,format:"mov",codec:"prores",proresProfile:"4444",bitrate:132e4,quality:100}},{id:"youtube-4k",name:"YouTube 4K",description:"4K UHD optimized for YouTube",category:"social",settings:{..._s,...Ln["4k"],codec:"h264"}},{id:"youtube-4k-60",name:"YouTube 4K 60fps",description:"4K 60fps for YouTube gaming/motion",category:"social",settings:{..._s,...Ln["4k-60"],codec:"h264"}},{id:"youtube-1080p-high",name:"YouTube 1080p High",description:"High bitrate 1080p for YouTube",category:"social",settings:{..._s,...Ln["1080p-high"],codec:"h264"}},{id:"youtube-1080p",name:"YouTube 1080p",description:"Standard 1080p for YouTube",category:"social",settings:{..._s,...Ln["1080p"],codec:"h264"}},{id:"tiktok-1080p",name:"TikTok/Reels",description:"Vertical 1080x1920 for TikTok/Reels",category:"social",settings:{..._s,width:1080,height:1920,bitrate:15e3,frameRate:30,codec:"h264"}},{id:"twitter",name:"Twitter/X",description:"Optimized for Twitter",category:"social",settings:{..._s,...Ln["720p"],codec:"h264"}},{id:"web-vp9",name:"Web (VP9)",description:"WebM VP9 for web embedding (720p for stability)",category:"web",settings:{..._s,format:"webm",codec:"vp9",...Ln["720p"]}},{id:"archive-4k",name:"Archive 4K",description:"High quality 4K for archival",category:"archive",settings:{..._s,...Ln["4k-high"],codec:"h265"}},{id:"archive-prores",name:"Archive ProRes",description:"Lossless quality ProRes for archival",category:"archive",settings:{..._s,width:1920,height:1080,format:"mov",codec:"prores",proresProfile:"hq",bitrate:22e4,quality:100}},{id:"audio-mp3",name:"MP3 Audio",description:"MP3 320kbps",category:"custom",settings:ag},{id:"audio-wav",name:"WAV Audio",description:"Uncompressed WAV 24-bit",category:"archive",settings:{...ag,format:"wav",bitDepth:24,sampleRate:48e3}}]}createPreset(e,t){return{id:`custom-${Date.now()}`,name:e,description:"Custom preset",settings:t,category:"custom"}}estimateFileSize(e,t){const s=e.timeline.duration;if("codec"in t){const i=t.bitrate*1e3,n=t.audioSettings.bitrate*1e3;return Math.ceil((i+n)*s/8)}else return t.format==="wav"?Math.ceil(s*t.sampleRate*t.channels*(t.bitDepth/8)):Math.ceil(t.bitrate*1e3*s/8)}estimateExportTime(e,t){const s=e.timeline.duration;if("codec"in t){const n=t.width*t.height/(1920*1080),a=t.codec==="h265"||t.codec==="av1"?2:1;return s*n*a*.5}else return s*.1}async renderTimelineAudio(e,t){const{timeline:s}=e;if(!s.tracks.some(o=>(o.type==="audio"||o.type==="video")&&!o.muted&&o.clips.length>0))return null;const n=s.duration&&s.duration>0?s.duration:this.calculateTimelineDuration(s);return console.log("[Export Audio] Timeline duration:",n,"s (manual:",s.duration,"calculated:",this.calculateTimelineDuration(s),")"),n<=0?null:(await this.audioEngine.renderAudio(e,0,n)).buffer}async encodeAudioWithMediaBunny(e,t){const{Output:s,BufferTarget:i,Mp3OutputFormat:n,AudioSampleSource:a,AudioSample:o,getFirstEncodableAudioCodec:l}=this.mediabunny;let d;switch(t.format){case"mp3":d=new n;break;case"aac":case"flac":case"ogg":default:return this.encodeWav(e,t)}const u=new i,h=new s({format:d,target:u}),p=await l(d.getSupportedAudioCodecs()),f=new a({codec:p||"mp3",bitrate:t.bitrate*1e3});h.addAudioTrack(f),await h.start();const m=o.fromAudioBuffer(e,0);for(const y of m)await f.add(y),y.close();f.close(),await h.finalize();const g=u.buffer;if(!g)throw new Error("Audio encoding failed");return new Blob([g],{type:this.getAudioMimeType(t.format)})}encodeWav(e,t){const s=Math.min(e.numberOfChannels,t.channels),i=t.sampleRate,n=t.bitDepth;if(n===32)return this.encodeWav32Float(e,s,i);const a=EX(),o=[];for(let d=0;d<s;d++)o.push(e.getChannelData(d));const l=a.encodeFullWav(o,i,n);return new Blob([l.buffer],{type:"audio/wav"})}encodeWav32Float(e,t,s){const a=t*4,o=s*a,l=e.length*a,u=44+l,h=new ArrayBuffer(u),p=new DataView(h);this.writeString(p,0,"RIFF"),p.setUint32(4,u-8,!0),this.writeString(p,8,"WAVE"),this.writeString(p,12,"fmt "),p.setUint32(16,16,!0),p.setUint16(20,3,!0),p.setUint16(22,t,!0),p.setUint32(24,s,!0),p.setUint32(28,o,!0),p.setUint16(32,a,!0),p.setUint16(34,32,!0),this.writeString(p,36,"data"),p.setUint32(40,l,!0);let f=44;for(let m=0;m<e.length;m++)for(let g=0;g<t;g++)p.setFloat32(f,e.getChannelData(g)[m],!0),f+=4;return new Blob([h],{type:"audio/wav"})}writeString(e,t,s){for(let i=0;i<s.length;i++)e.setUint8(t+i,s.charCodeAt(i))}getMimeType(e){switch(e){case"webm":return"video/webm";case"mov":return"video/quicktime";case"mp4":default:return"video/mp4"}}getAudioMimeType(e){switch(e){case"mp3":return"audio/mpeg";case"wav":return"audio/wav";case"aac":return"audio/aac";case"flac":return"audio/flac";case"ogg":return"audio/ogg";default:return"audio/mpeg"}}getImageMimeType(e){switch(e){case"png":return"image/png";case"webp":return"image/webp";case"jpg":default:return"image/jpeg"}}createProgress(e,t,s,i,n){const a=this.currentExport?(Date.now()-this.currentExport.startTime)/1e3:0,o=a>0?i/a:0,l=s-i,d=o>0?l/o:0;return{phase:e,progress:t,estimatedTimeRemaining:d,currentFrame:i,totalFrames:s,bytesWritten:n,currentBitrate:a>0?n*8/a:0}}createError(e,t,s){return{code:e,message:t,phase:s,recoverable:e==="CANCELLED"}}calculateStats(e,t){const s=this.currentExport?Date.now()-this.currentExport.startTime:0,i=this.currentExport?.framesRendered||e;return{duration:s,framesRendered:i,averageSpeed:s>0?i/s*1e3:0,fileSize:t,averageBitrate:s>0?t*8e3/s:0}}calculateTimelineDuration(e){let t=0;for(const o of e.tracks)for(const l of o.clips){const d=l.outPoint-l.inPoint,u=l.startTime+d;u>t&&(t=u)}const s=go.getAllTextClips();for(const o of s){const l=o.startTime+o.duration;l>t&&(t=l)}const i=br.getAllShapeClips();for(const o of i){const l=o.startTime+o.duration;l>t&&(t=l)}const n=br.getAllSVGClips();for(const o of n){const l=o.startTime+o.duration;l>t&&(t=l)}const a=br.getAllStickerClips();for(const o of a){const l=o.startTime+o.duration;l>t&&(t=l)}if(e.subtitles)for(const o of e.subtitles)o.endTime>t&&(t=o.endTime);return t}shouldApplyUpscaling(e,t){if(!t.upscaling?.enabled)return!1;const s=e.settings.width,i=e.settings.height,n=t.width,a=t.height;return n>s||a>i}dispose(){this.cancel(),this.terminateWorker(),this.mediabunny=null,this.videoEngine=null,this.audioEngine=null,this.upscalingEngine&&(this.upscalingEngine.clearTexturePool(),this.upscalingEngine=null),this.initialized=!1}}let lg=null;function dd(){return lg||(lg=new MX),lg}function dg(r,e){const t=URL.createObjectURL(r),s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}class GP{videoEffectsEngine=null;colorGradingEngine=null;initialized=!1;clipEffects=new Map;clipColorGrading=new Map;renderer=null;effectsChangeCallbacks=[];pendingReRenders=new Map;async initialize(e=1920,t=1080){if(!this.initialized)try{this.videoEffectsEngine=new Su({width:e,height:t,useGPU:!0,preferWebGPU:Wc()}),await this.videoEffectsEngine.initialize(),this.colorGradingEngine=new hW(e,t),this.colorGradingEngine.initialize(),this.initialized=!0}catch(s){const i=s instanceof Error?s.message:"Unknown initialization error";throw new Error(`EffectsBridge initialization failed: ${i}`)}}isInitialized(){return this.initialized}applyVideoEffect(e,t,s={}){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const i=this.clipEffects.get(e)||[],n={id:dt(),type:t,enabled:!0,params:{...this.getDefaultParams(t),...s},order:i.length};return i.push(n),this.clipEffects.set(e,i),{success:!0,effectId:n.id}}removeVideoEffect(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipEffects.get(e);if(!s)return{success:!1,error:"No effects found for clip"};const i=s.findIndex(n=>n.id===t);return i===-1?{success:!1,error:"Effect not found"}:(s.splice(i,1),s.forEach((n,a)=>{n.order=a}),this.clipEffects.set(e,s),{success:!0})}updateVideoEffect(e,t,s){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const i=this.clipEffects.get(e);if(!i)return{success:!1,error:"No effects found for clip"};const n=i.find(a=>a.id===t);return n?(n.params={...n.params,...s},this.notifyEffectsChanged(e),{success:!0,effectId:t}):{success:!1,error:"Effect not found"}}reorderEffects(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipEffects.get(e);if(!s)return{success:!1,error:"No effects found for clip"};const i=new Map(s.map(a=>[a.id,a]));for(const a of t)if(!i.has(a))return{success:!1,error:`Effect ${a} not found`};const n=[];return t.forEach((a,o)=>{const l=i.get(a);l.order=o,n.push(l)}),this.clipEffects.set(e,n),{success:!0}}getEffects(e){return[...this.clipEffects.get(e)||[]].sort((s,i)=>s.order-i.order)}getEffect(e,t){return this.clipEffects.get(e)?.find(i=>i.id===t)}toggleEffect(e,t,s){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const i=this.clipEffects.get(e);if(!i)return{success:!1,error:"No effects found for clip"};const n=i.find(a=>a.id===t);return n?(n.enabled=s,{success:!0,effectId:t}):{success:!1,error:"Effect not found"}}resetEffect(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipEffects.get(e);if(!s)return{success:!1,error:"No effects found for clip"};const i=s.find(n=>n.id===t);return i?(i.params=this.getDefaultParams(i.type),{success:!0,effectId:t}):{success:!1,error:"Effect not found"}}async processEffects(e,t){if(!this.initialized||!this.videoEffectsEngine)return{image:t,processingTime:0};const s=this.getEffects(e);if(s.length===0)return{image:t,processingTime:0};const i=s.filter(n=>n.enabled);if(i.length===0)return{image:t,processingTime:0};try{const n=i.map(o=>({id:o.id,type:o.type,enabled:o.enabled,params:o.params})),a=await this.videoEffectsEngine.applyEffects(t,n);return!a.image||a.image.width===0||a.image.height===0?(console.warn("[EffectsBridge] Effects processing returned invalid image"),{image:t,processingTime:a.processingTime}):{image:a.image,processingTime:a.processingTime}}catch(n){return console.error("[EffectsBridge] Effects processing failed:",n),{image:t,processingTime:0}}}getDefaultParams(e){switch(e){case"brightness":return{value:0};case"contrast":return{value:1};case"saturation":return{value:1};case"hue":return{rotation:0};case"blur":return{radius:0,type:"gaussian"};case"sharpen":return{amount:0,radius:1,threshold:0};case"vignette":return{amount:0,midpoint:.5,roundness:.5,feather:.3};case"grain":return{amount:0,size:1,roughness:.5,colored:!1};case"temperature":return{value:0};case"tint":return{value:0};case"tonal":return{shadows:0,midtones:0,highlights:0};case"chromaKey":return{keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5};case"shadow":return{offsetX:5,offsetY:5,blur:10,opacity:.8,color:"#000000"};case"glow":return{radius:10,intensity:1,color:"#ffffff"};case"motion-blur":return{angle:0,distance:20};case"radial-blur":return{amount:20,centerX:50,centerY:50};case"chromatic-aberration":return{amount:5,angle:0};default:return{}}}applyColorWheels(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.colorWheels=t,this.clipColorGrading.set(e,s),{success:!0}}applyCurves(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.curves=t,this.clipColorGrading.set(e,s),{success:!0}}applyLUT(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.lut=t,this.clipColorGrading.set(e,s),{success:!0}}applyHSL(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=this.clipColorGrading.get(e)||{};return s.hsl=t,this.clipColorGrading.set(e,s),{success:!0}}getColorGrading(e){return this.clipColorGrading.get(e)||{}}resetColorGrading(e){return this.initialized?(this.clipColorGrading.set(e,{colorWheels:{...sy},curves:{...iy},hsl:{...ry}}),{success:!0}):{success:!1,error:"EffectsBridge not initialized"}}async processColorGrading(e,t){if(!this.initialized||!this.colorGradingEngine)return{image:t,processingTime:0};const s=this.getColorGrading(e);let i=t,n=0;if(s.colorWheels){const a=await this.colorGradingEngine.applyColorWheels(i,s.colorWheels);i=a.image,n+=a.processingTime}if(s.curves){const a=await this.colorGradingEngine.applyCurves(i,s.curves);i=a.image,n+=a.processingTime}if(s.lut){const a=await this.colorGradingEngine.applyLUT(i,s.lut);i=a.image,n+=a.processingTime}if(s.hsl){const a=await this.colorGradingEngine.applyHSL(i,s.hsl);i=a.image,n+=a.processingTime}return{image:i,processingTime:n}}async generateWaveform(e){return!this.initialized||!this.colorGradingEngine?null:this.colorGradingEngine.generateWaveform(e)}async generateVectorscope(e,t=256){return!this.initialized||!this.colorGradingEngine?null:this.colorGradingEngine.generateVectorscope(e,t)}async generateHistogram(e){return!this.initialized||!this.colorGradingEngine?null:this.colorGradingEngine.generateHistogram(e)}serializeEffects(e){const t=this.getEffects(e),s=this.getColorGrading(e),i=t.map(a=>({id:a.id,type:a.type,enabled:a.enabled,params:a.params,order:a.order})),n={};return s.colorWheels&&(n.colorWheels=s.colorWheels),s.curves&&(n.curves=s.curves),s.lut&&(n.lut={data:Array.from(s.lut.data),size:s.lut.size,intensity:s.lut.intensity}),s.hsl&&(n.hsl=s.hsl),{effects:i,colorGrading:n}}deserializeEffects(e,t){if(!this.initialized)return{success:!1,error:"EffectsBridge not initialized"};const s=t.effects.map(n=>({id:n.id,type:n.type,enabled:n.enabled,params:n.params,order:n.order}));this.clipEffects.set(e,s);const i={};return t.colorGrading.colorWheels&&(i.colorWheels=t.colorGrading.colorWheels),t.colorGrading.curves&&(i.curves=t.colorGrading.curves),t.colorGrading.lut&&(i.lut={data:new Uint8Array(t.colorGrading.lut.data),size:t.colorGrading.lut.size,intensity:t.colorGrading.lut.intensity}),t.colorGrading.hsl&&(i.hsl=t.colorGrading.hsl),this.clipColorGrading.set(e,i),{success:!0}}clearEffects(e){this.clipEffects.delete(e),this.clipColorGrading.delete(e)}onEffectsChange(e){this.effectsChangeCallbacks.push(e)}offEffectsChange(e){const t=this.effectsChangeCallbacks.indexOf(e);t!==-1&&this.effectsChangeCallbacks.splice(t,1)}notifyEffectsChanged(e){const t=this.pendingReRenders.get(e);t&&clearTimeout(t);const s=setTimeout(()=>{this.pendingReRenders.delete(e);const n=this.getEffects(e).map(a=>({id:a.id,type:a.type,enabled:a.enabled,params:a.params}));for(const a of this.effectsChangeCallbacks)a(e,n)},16);this.pendingReRenders.set(e,s)}getRendererType(){return this.videoEffectsEngine&&typeof this.videoEffectsEngine.getRendererType=="function"?this.videoEffectsEngine.getRendererType():"none"}isUsingWebGPU(){return this.videoEffectsEngine&&typeof this.videoEffectsEngine.isUsingWebGPU=="function"?this.videoEffectsEngine.isUsingWebGPU():!1}dispose(){for(const e of this.pendingReRenders.values())clearTimeout(e);this.pendingReRenders.clear(),this.effectsChangeCallbacks=[],this.renderer&&(this.renderer.destroy(),this.renderer=null),this.colorGradingEngine&&this.colorGradingEngine.dispose(),this.clipEffects.clear(),this.clipColorGrading.clear(),this.videoEffectsEngine=null,this.colorGradingEngine=null,this.initialized=!1}}let xi=null,dh=null,WP=1920,YP=1080;function mr(){return xi||(xi=new GP),xi.isInitialized()||xi.initialize(WP,YP).catch(r=>{console.error("[EffectsBridge] Background initialization failed:",r)}),xi}async function PX(r=1920,e=1080){return xi?.isInitialized()?xi:dh||(dh=(async()=>(xi||(xi=new GP),await xi.initialize(r,e),WP=r,YP=e,xi))(),dh)}async function NX(r=1920,e=1080){return PX(r,e)}function RX(){xi&&(xi.dispose(),xi=null)}const IX={interval:3e4,maxSlots:3,enabled:!0,debounceTime:2e3},DX="openreel-autosave",FX=1,Wi="autosaves";class BX{config;db=null;intervalId=null;debounceTimeoutId=null;lastSavedHash="";currentSlot=0;listeners=new Map;pendingProject=null;isDirty=!1;constructor(e={}){this.config={...IX,...e}}async initialize(){try{this.db=await this.openDatabase()}catch(e){console.error("[AutoSave] Failed to initialize:",e),this.emit("error",{error:e,message:"Failed to initialize auto-save"})}}openDatabase(){return new Promise((e,t)=>{if(typeof indexedDB>"u"){t(new Error("IndexedDB not supported"));return}const s=indexedDB.open(DX,FX);s.onerror=()=>{t(new Error(`Failed to open auto-save database: ${s.error?.message}`))},s.onsuccess=()=>{e(s.result)},s.onupgradeneeded=i=>{const n=i.target.result;if(!n.objectStoreNames.contains(Wi)){const a=n.createObjectStore(Wi,{keyPath:"id"});a.createIndex("projectId","projectId",{unique:!1}),a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("slot","slot",{unique:!1})}}})}start(e){this.config.enabled&&(this.stop(),this.pendingProject=e(),this.saveIfDirty(),this.intervalId=setInterval(()=>{this.pendingProject=e(),this.saveIfDirty()},this.config.interval))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.debounceTimeoutId&&(clearTimeout(this.debounceTimeoutId),this.debounceTimeoutId=null)}markDirty(){this.isDirty=!0,this.debounceTimeoutId&&clearTimeout(this.debounceTimeoutId),this.debounceTimeoutId=setTimeout(()=>{this.saveIfDirty()},this.config.debounceTime)}async saveIfDirty(){if(!this.pendingProject||!this.isDirty)return;const e=this.pendingProject,t=this.computeHash(e);if(t!==this.lastSavedHash)try{await this.save(e),this.lastSavedHash=t,this.isDirty=!1}catch(s){console.error("[AutoSave] Save failed:",s),this.emit("error",{error:s,message:"Auto-save failed"})}}async save(e){if(!this.db)throw new Error("Auto-save database not initialized");const t={id:`${e.id}-slot-${this.currentSlot}`,projectId:e.id,projectName:e.name,timestamp:Date.now(),slot:this.currentSlot,data:JSON.stringify(e)};await this.saveRecord(t),this.currentSlot=(this.currentSlot+1)%this.config.maxSlots,await this.cleanupOldSaves(e.id),this.emit("saved",{projectId:e.id,timestamp:t.timestamp,slot:t.slot})}saveRecord(e){return new Promise((t,s)=>{if(!this.db){s(new Error("Database not initialized"));return}const a=this.db.transaction(Wi,"readwrite").objectStore(Wi).put(e);a.onsuccess=()=>t(),a.onerror=()=>s(new Error(`Failed to save: ${a.error?.message}`))})}async cleanupOldSaves(e){if(!this.db)return;const s=(await this.getAllSaves()).filter(i=>i.projectId===e);if(s.length>this.config.maxSlots){const i=s.sort((n,a)=>a.timestamp-n.timestamp).slice(this.config.maxSlots);for(const n of i)await this.deleteRecord(n.id)}}deleteRecord(e){return new Promise((t,s)=>{if(!this.db){s(new Error("Database not initialized"));return}const a=this.db.transaction(Wi,"readwrite").objectStore(Wi).delete(e);a.onsuccess=()=>t(),a.onerror=()=>s(new Error(`Failed to delete: ${a.error?.message}`))})}getAllSaves(){return new Promise((e,t)=>{if(!this.db){t(new Error("Database not initialized"));return}const n=this.db.transaction(Wi,"readonly").objectStore(Wi).getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>t(new Error(`Failed to get saves: ${n.error?.message}`))})}async checkForRecovery(e){this.db||await this.initialize();try{const t=await this.getAllSaves();let s=t;e&&(s=t.filter(n=>n.projectId===e));const i=s.sort((n,a)=>a.timestamp-n.timestamp).map(n=>({id:n.id,projectId:n.projectId,projectName:n.projectName,timestamp:n.timestamp,slot:n.slot,isRecovery:!0}));return i.length>0&&this.emit("recoveryAvailable",{saves:i}),i}catch(t){return console.error("[AutoSave] Failed to check for recovery:",t),[]}}async recover(e){this.db||await this.initialize();try{const t=await this.getRecord(e);if(!t)return console.warn(`[AutoSave] No save found with id: ${e}`),null;const s=JSON.parse(t.data);return this.emit("restored",{project:s,timestamp:t.timestamp}),s}catch(t){return console.error("[AutoSave] Recovery failed:",t),this.emit("error",{error:t,message:"Failed to recover project"}),null}}getRecord(e){return new Promise((t,s)=>{if(!this.db){s(new Error("Database not initialized"));return}const a=this.db.transaction(Wi,"readonly").objectStore(Wi).get(e);a.onsuccess=()=>t(a.result||null),a.onerror=()=>s(new Error(`Failed to get record: ${a.error?.message}`))})}async getMostRecentSave(e){const t=await this.checkForRecovery(e);return t.length>0?t[0]:null}async clearProjectSaves(e){if(!this.db)return;const s=(await this.getAllSaves()).filter(i=>i.projectId===e);for(const i of s)await this.deleteRecord(i.id)}async clearAllSaves(){if(this.db)return new Promise((e,t)=>{const n=this.db.transaction(Wi,"readwrite").objectStore(Wi).clear();n.onsuccess=()=>{e()},n.onerror=()=>t(new Error(`Failed to clear: ${n.error?.message}`))})}computeHash(e){const t=JSON.stringify({id:e.id,modifiedAt:e.modifiedAt,trackCount:e.timeline.tracks.length,clipCount:e.timeline.tracks.reduce((i,n)=>i+n.clips.length,0),mediaCount:e.mediaLibrary.items.length});let s=0;for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);s=(s<<5)-s+n,s=s&s}return s.toString(36)}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}emit(e,t){this.listeners.get(e)?.forEach(s=>{try{s(t)}catch(i){console.error("[AutoSave] Event callback error:",i)}})}async forceSave(e){this.pendingProject=e,this.isDirty=!0,await this.saveIfDirty()}destroy(){this.stop(),this.db&&(this.db.close(),this.db=null),this.listeners.clear()}}const er=new BX;async function LX(){await er.initialize()}async function OX(r){return er.checkForRecovery(r)}const Wh=new Map;async function rn(r,e){return Wh.has(r)||Wh.set(r,Promise.resolve(e())),Wh.get(r)}const Ey={WARNING_LINEAR:Math.pow(10,-6/20),CLIPPING_LINEAR:1};function My(r){return{isWarning:r>Ey.WARNING_LINEAR,isClipping:r>=Ey.CLIPPING_LINEAR}}const uh={peaks:new Map,rms:new Map,masterPeak:0,masterRms:0,isClipping:!1,isWarning:!1},l2={currentTime:0,duration:0,state:"stopped",fps:0,droppedFrames:0,audioBufferHealth:1,videoBufferHealth:1,avgFrameRenderTime:0};go.initialize(1920,1080);const fe=wa()(Up((r,e)=>({initialized:!1,initializing:!1,initError:null,videoEngine:null,audioEngine:null,playbackController:null,titleEngine:go,subtitleEngine:null,graphicsEngine:br,photoEngine:null,exportEngine:null,speechToTextEngine:null,templateEngine:null,soundLibraryEngine:null,chromaKeyEngine:null,multiCamEngine:null,maskEngine:null,nestedSequenceEngine:null,adjustmentLayerEngine:null,currentFrame:null,playbackStats:l2,audioLevels:uh,initialize:async()=>{const t=e();if(!(t.initialized||t.initializing)){r({initializing:!0,initError:null});try{const s=kM(),i=Ab(),n=nY(),a=qY(),o=dd();go.initialize(1920,1080),await s.initialize(),await i.initialize(),await n.initialize(s,i),await o.initialize(),r({initialized:!0,initializing:!1,initError:null,videoEngine:s,audioEngine:i,playbackController:n,titleEngine:go,graphicsEngine:br,photoEngine:a,exportEngine:o})}catch(s){const i=s instanceof Error?s.message:"Unknown initialization error";throw r({initialized:!1,initializing:!1,initError:i}),s}}},dispose:()=>{const t=e();t.videoEngine?.dispose(),t.audioEngine?.dispose(),t.playbackController?.dispose(),t.photoEngine?.dispose(),t.exportEngine?.dispose(),t.graphicsEngine?.clearCache(),t.currentFrame&&t.currentFrame.image.close(),Wh.clear(),r({initialized:!1,initializing:!1,initError:null,videoEngine:null,audioEngine:null,playbackController:null,titleEngine:null,subtitleEngine:null,graphicsEngine:null,photoEngine:null,exportEngine:null,speechToTextEngine:null,soundLibraryEngine:null,chromaKeyEngine:null,multiCamEngine:null,maskEngine:null,nestedSequenceEngine:null,adjustmentLayerEngine:null,currentFrame:null,playbackStats:l2,audioLevels:uh})},renderFrame:async t=>{const{videoEngine:s,initialized:i}=e();return null},getAudioLevels:()=>{const{audioLevels:t}=e();return t||uh},updateAudioLevels:t=>{const s=new Map,i=new Map;let n=0,a=0,o=!1,l=!1;for(const[u,h]of t){s.set(u,h.peak),i.set(u,h.rms),n=Math.max(n,h.peak),a=Math.max(a,h.rms);const p=My(h.peak);p.isClipping&&(o=!0),p.isWarning&&(l=!0)}const d=My(n);d.isClipping&&(o=!0),d.isWarning&&(l=!0),r({audioLevels:{peaks:s,rms:i,masterPeak:n,masterRms:a,isClipping:o,isWarning:l}})},resetAudioLevels:()=>{r({audioLevels:uh})},getVideoEngine:()=>e().videoEngine,getAudioEngine:()=>e().audioEngine,getPlaybackController:()=>e().playbackController,getTitleEngine:()=>e().titleEngine,getSubtitleEngine:()=>rn("subtitle",()=>new cY),getGraphicsEngine:()=>e().graphicsEngine,getPhotoEngine:()=>e().photoEngine,getExportEngine:()=>e().exportEngine,getSpeechToTextEngine:()=>rn("speechToText",()=>new _b),getTemplateEngine:()=>rn("template",()=>new KY),getSoundLibraryEngine:()=>rn("soundLibrary",()=>new WW),getChromaKeyEngine:()=>rn("chromaKey",()=>new SM({width:1920,height:1080})),getMultiCamEngine:()=>rn("multiCam",()=>new CW),getMaskEngine:()=>rn("mask",()=>new yW({width:1920,height:1080})),getNestedSequenceEngine:()=>rn("nestedSequence",()=>new e9),getAdjustmentLayerEngine:()=>rn("adjustmentLayer",()=>new TW)}))),$X=Object.freeze(Object.defineProperty({__proto__:null,AUDIO_THRESHOLDS:Ey,detectThresholds:My,useEngineStore:fe},Symbol.toStringTag,{value:"Module"}));class zX{mediaImportService=null;waveformGenerator=null;initialized=!1;async initialize(){if(!this.initialized)try{this.mediaImportService=await p9(),this.waveformGenerator=g9(),this.initialized=!0}catch(e){const t=e instanceof Error?e.message:"Unknown initialization error";throw new Error(`MediaBridge initialization failed: ${t}`)}}isInitialized(){return this.initialized}async importFile(e,t=!0,s=!1){if(!this.initialized||!this.mediaImportService)return{success:!1,error:"MediaBridge not initialized",hasWaveform:!1};const i=this.captureProjectState();try{const n=await this.mediaImportService.importMedia(e,{generateThumbnails:!s,thumbnailCount:10,thumbnailWidth:160,generateWaveform:t&&!s,waveformSamplesPerSecond:100,useFallback:!0,quickMode:s});if(!n.success||!n.media)return{success:!1,error:n.error||"Import failed",warnings:n.warnings,hasWaveform:!1};const a=n.media.metadata;return this.validateMetadata(a)?{success:!0,media:n.media,warnings:n.warnings,hasWaveform:n.media.waveformData!==null}:{success:!1,error:"Failed to extract valid metadata from media file",hasWaveform:!1}}catch(n){return this.restoreProjectState(i),{success:!1,error:n instanceof Error?n.message:"Unknown import error",hasWaveform:!1}}}async generateThumbnailsForMedia(e,t){if(!this.initialized||!this.mediaImportService)return[];try{return(await this.mediaImportService.generateThumbnailsForMedia(e,t,{count:10,width:160})).map(i=>({timestamp:i.timestamp,dataUrl:i.dataUrl||""})).filter(i=>i.dataUrl)}catch{return[]}}async importFiles(e,t){if(!this.initialized||!this.mediaImportService)return e.map(()=>({success:!1,error:"MediaBridge not initialized",hasWaveform:!1}));const s=[];for(let i=0;i<e.length;i++){const n=e[i];t?.(i,e.length,n.name);const a=await this.importFile(n);s.push(a)}return t?.(e.length,e.length,"Complete"),s}async generateWaveform(e,t,s=100){if(!this.initialized||!this.waveformGenerator)return null;try{const i=await this.waveformGenerator.generateWaveform(e,t,{samplesPerSecond:s,enableCaching:!0});return this.validateWaveformData(i)?i:null}catch(i){return console.error("MediaBridge: Waveform generation error:",i),null}}async extractMetadata(e){if(!this.initialized||!this.mediaImportService)return null;try{const t=await this.mediaImportService.importMedia(e,{generateThumbnails:!1,generateWaveform:!1,useFallback:!0});return!t.success||!t.media?null:t.media.metadata}catch(t){return console.error("MediaBridge: Metadata extraction error:",t),null}}validateMetadata(e){const t=!e.hasVideo&&!e.hasAudio&&e.width>0&&e.height>0;return e.duration===null||e.duration===void 0||!t&&e.duration<=0?!1:t?!(e.width===null||e.width===void 0||e.width<=0||e.height===null||e.height===void 0||e.height<=0):!(e.hasVideo&&(e.width===null||e.width===void 0||e.width<=0||e.height===null||e.height===void 0||e.height<=0))}validateWaveformData(e){if(!e.peaks||e.peaks.length===0||e.duration<=0)return!1;const t=Math.ceil(e.duration*e.samplesPerSecond),s=e.peaks.length,i=Math.max(t*.1,10);return!(Math.abs(s-t)>i)}getSupportedFormats(){return this.mediaImportService?this.mediaImportService.getSupportedFormats():{video:[],audio:[],image:[]}}async isFormatSupported(e){return this.mediaImportService?(await this.mediaImportService.validateFormat(e)).supported:!1}captureProjectState(){const t=W.getState().project;return{mediaLibraryIds:t.mediaLibrary.items.map(s=>s.id),timelineClipIds:t.timeline.tracks.flatMap(s=>s.clips.map(i=>i.id))}}restoreProjectState(e){}dispose(){this.mediaImportService=null,this.waveformGenerator=null,this.initialized=!1}}let Pc=null;function Py(){return Pc||(Pc=new zX),Pc}async function Ny(){const r=Py();return await r.initialize(),r}function VX(){Pc&&(Pc.dispose(),Pc=null)}const d2=["Tokyo","Paris","London","Sydney","Berlin","Milan","Seoul","Dubai","Oslo","Vienna","Kyoto","Prague","Lisbon","Boston","Austin","Denver","Portland","Seattle","Montreal","Toronto","Barcelona","Amsterdam","Stockholm","Helsinki","Dublin","Cairo","Mumbai","Bangkok","Singapore","Zurich","Geneva","Florence","Venice","Naples","Athens","Lagos","Nairobi","Marrakech","Cape Town","Havana","Lima","Rio","Santiago","Phoenix","Chicago","Brooklyn","Manhattan","Queens","Osaka","Taipei"],u2=["Morning","Evening","Midnight","Golden","Silver","Crystal","Velvet","Neon","Cosmic","Electric","Vintage","Modern","Classic","Urban","Serene","Bold","Swift","Vivid","Radiant","Mystic"];function UX(){const r=u2[Math.floor(Math.random()*u2.length)],e=d2[Math.floor(Math.random()*d2.length)];return`${r} ${e}`}const GX={width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2};function WX(){return{tracks:[],subtitles:[],duration:0,markers:[]}}function h2(r,e){const t=Date.now(),s=r||UX();return{id:dt(),name:s,createdAt:t,modifiedAt:t,settings:{...GX,...e},mediaLibrary:{items:[]},timeline:WX()}}function p2(r){let e=0;for(const t of r.timeline.tracks)for(const s of t.clips){const i=s.startTime+s.duration;i>e&&(e=i)}return e}const Qb=new fM;async function YX(r,e,t,s){const i={id:e,projectId:r,blob:t,metadata:s};await Qb.saveMedia(i)}async function qX(r){return Qb.getMediaByProject(r)}async function HX(r){await Qb.deleteMedia(r)}async function XX(r,e){return e==="audio"?null:e==="image"?URL.createObjectURL(r):new Promise(t=>{const s=document.createElement("video");s.muted=!0,s.playsInline=!0,s.preload="metadata";const i=()=>{URL.revokeObjectURL(s.src),s.remove()};s.onloadeddata=()=>{s.currentTime=.1},s.onseeked=()=>{try{const n=document.createElement("canvas");n.width=Math.min(s.videoWidth,320),n.height=Math.min(s.videoHeight,320/s.videoWidth*s.videoHeight);const a=n.getContext("2d");a?(a.drawImage(s,0,0,n.width,n.height),n.toBlob(o=>{i(),t(o?URL.createObjectURL(o):null)},"image/jpeg",.7)):(i(),t(null))}catch{i(),t(null)}},s.onerror=()=>{i(),t(null)},setTimeout(()=>{i(),t(null)},5e3),s.src=URL.createObjectURL(r)})}async function KX(r,e){const t=e||r.blob;if(!t)return r;let s=r.thumbnailUrl;return(!s||s.startsWith("blob:"))&&(s=await XX(t,r.type)),{...r,blob:t,thumbnailUrl:s,filmstripThumbnails:void 0}}const QX="openreel-projects",JX=1,hh="projects",Yi="recent",ug=10,zl=[{id:"blank",name:"Blank Project",description:"Start from scratch with no pre-configured tracks",category:"General",settings:{width:1920,height:1080,frameRate:30}},{id:"youtube-landscape",name:"YouTube Landscape",description:"1920x1080 at 30fps - Standard YouTube format",category:"Social Media",settings:{width:1920,height:1080,frameRate:30},tracks:[{type:"video",name:"Main Video"},{type:"audio",name:"Background Music"},{type:"audio",name:"Voiceover"}]},{id:"youtube-short",name:"YouTube Shorts",description:"1080x1920 at 60fps - Vertical short-form content",category:"Social Media",settings:{width:1080,height:1920,frameRate:60},tracks:[{type:"video",name:"Main Video"},{type:"audio",name:"Audio"},{type:"text",name:"Captions"}]},{id:"tiktok",name:"TikTok",description:"1080x1920 at 60fps - Optimized for TikTok",category:"Social Media",settings:{width:1080,height:1920,frameRate:60},tracks:[{type:"video",name:"Main"},{type:"audio",name:"Sound"}]},{id:"instagram-reel",name:"Instagram Reel",description:"1080x1920 at 30fps - Instagram Reels format",category:"Social Media",settings:{width:1080,height:1920,frameRate:30},tracks:[{type:"video",name:"Video"},{type:"audio",name:"Audio"}]},{id:"instagram-post",name:"Instagram Post",description:"1080x1080 at 30fps - Square format for posts",category:"Social Media",settings:{width:1080,height:1080,frameRate:30},tracks:[{type:"video",name:"Video"}]},{id:"cinematic-4k",name:"Cinematic 4K",description:"3840x2160 at 24fps - Film-like quality",category:"Professional",settings:{width:3840,height:2160,frameRate:24},tracks:[{type:"video",name:"A-Roll"},{type:"video",name:"B-Roll"},{type:"audio",name:"Dialogue"},{type:"audio",name:"Music"},{type:"audio",name:"SFX"}]},{id:"podcast",name:"Podcast Video",description:"1920x1080 at 30fps - Audio-focused with waveform visualizer",category:"Audio",settings:{width:1920,height:1080,frameRate:30},tracks:[{type:"video",name:"Background"},{type:"audio",name:"Host"},{type:"audio",name:"Guest"},{type:"graphics",name:"Waveform"}]},{id:"tutorial",name:"Screen Recording",description:"1920x1080 at 60fps - Perfect for tutorials",category:"Educational",settings:{width:1920,height:1080,frameRate:60},tracks:[{type:"video",name:"Screen"},{type:"video",name:"Webcam"},{type:"audio",name:"Narration"},{type:"text",name:"Annotations"}]}];class ZX{db=null;listeners=new Map;currentFileHandle=null;async initialize(){this.db=await this.openDatabase()}openDatabase(){return new Promise((e,t)=>{if(typeof indexedDB>"u"){t(new Error("IndexedDB not supported"));return}const s=indexedDB.open(QX,JX);s.onerror=()=>{t(new Error(`Failed to open database: ${s.error?.message}`))},s.onsuccess=()=>e(s.result),s.onupgradeneeded=i=>{const n=i.target.result;n.objectStoreNames.contains(hh)||n.createObjectStore(hh,{keyPath:"id"}),n.objectStoreNames.contains(Yi)||n.createObjectStore(Yi,{keyPath:"id"}).createIndex("lastOpened","lastOpened",{unique:!1})}})}async createProject(e={}){const t=e.templateId&&zl.find(a=>a.id===e.templateId)||zl[0],s={width:1920,height:1080,frameRate:30,sampleRate:48e3,channels:2,...t.settings,...e.settings},i=t.tracks?.map((a,o)=>({id:`track-${Date.now()}-${o}`,type:a.type,name:a.name,clips:[],transitions:[],locked:!1,hidden:!1,muted:!1,solo:!1}))||[],n={id:dt(),name:e.name||"Untitled Project",createdAt:Date.now(),modifiedAt:Date.now(),settings:s,timeline:{duration:0,tracks:i,markers:[],subtitles:[]},mediaLibrary:{items:[]}};return this.currentFileHandle=null,this.emit("projectOpened",{project:n}),n}async saveProject(e){return this.currentFileHandle?this.saveToFileHandle(e,this.currentFileHandle):this.saveProjectAs(e)}async saveProjectAs(e){if(!("showSaveFilePicker"in window))return this.downloadProject(e);try{const s=await window.showSaveFilePicker({suggestedName:`${e.name}.oreel`,types:[{description:"OpenReel Project",accept:{"application/json":[".oreel",".json"]}}]}),i=await this.saveToFileHandle(e,s);return i&&(this.currentFileHandle=s,await this.addToRecent(e,s)),i}catch(t){return t.name==="AbortError"||console.error("[ProjectManager] Save failed:",t),!1}}async saveToFileHandle(e,t){try{const s=await t.createWritable(),i=JSON.stringify(e,null,2);return await s.write(i),await s.close(),this.emit("projectSaved",{project:e}),!0}catch(s){return console.error("[ProjectManager] Save to file failed:",s),!1}}downloadProject(e){try{const t=JSON.stringify(e,null,2),s=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(s),n=document.createElement("a");return n.href=i,n.download=`${e.name}.oreel`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),this.emit("projectSaved",{project:e}),!0}catch(t){return console.error("[ProjectManager] Download failed:",t),!1}}async openProject(){if("showOpenFilePicker"in window)try{const e=window,[t]=await e.showOpenFilePicker({types:[{description:"OpenReel Project",accept:{"application/json":[".oreel",".json"]}}],multiple:!1}),i=await(await t.getFile()).text(),n=JSON.parse(i);return this.currentFileHandle=t,await this.addToRecent(n,t),this.emit("projectOpened",{project:n}),n}catch(e){return e.name==="AbortError"||console.error("[ProjectManager] Open failed:",e),null}return this.openProjectViaInput()}openProjectViaInput(){return new Promise(e=>{const t=document.createElement("input");t.type="file",t.accept=".oreel,.json",t.onchange=async()=>{const s=t.files?.[0];if(!s){e(null);return}try{const i=await s.text(),n=JSON.parse(i);await this.addToRecent(n),this.emit("projectOpened",{project:n}),e(n)}catch(i){console.error("[ProjectManager] Parse failed:",i),e(null)}},t.click()})}async openRecentProject(e){if(e.fileHandle)try{const t=e.fileHandle;if(await t.queryPermission?.({mode:"read"})!=="granted"&&await t.requestPermission?.({mode:"read"})!=="granted")return null;const n=await(await e.fileHandle.getFile()).text(),a=JSON.parse(n);return this.currentFileHandle=e.fileHandle,await this.updateRecentTimestamp(e.id),this.emit("projectOpened",{project:a}),a}catch(t){return console.error("[ProjectManager] Open recent failed:",t),await this.removeFromRecent(e.id),null}return this.loadProjectFromDb(e.id)}async loadProjectFromDb(e){return this.db?new Promise(t=>{const n=this.db.transaction(hh,"readonly").objectStore(hh).get(e);n.onsuccess=()=>{const a=n.result;a&&this.emit("projectOpened",{project:a}),t(a||null)},n.onerror=()=>t(null)}):null}async getRecentProjects(){return this.db||await this.initialize(),new Promise(e=>{if(!this.db){e([]);return}const n=this.db.transaction(Yi,"readonly").objectStore(Yi).index("lastOpened").getAll();n.onsuccess=()=>{const a=n.result.sort((o,l)=>l.lastOpened-o.lastOpened).slice(0,ug);e(a)},n.onerror=()=>e([])})}async addToRecent(e,t){if(!this.db)return;const s={id:e.id,name:e.name,lastOpened:Date.now(),fileHandle:t,duration:e.timeline.duration,trackCount:e.timeline.tracks.length};return new Promise(i=>{const n=this.db.transaction(Yi,"readwrite");n.objectStore(Yi).put(s),n.oncomplete=()=>{this.emit("recentUpdated"),this.cleanupOldRecent(),i()},n.onerror=()=>i()})}async updateRecentTimestamp(e){if(this.db)return new Promise(t=>{const i=this.db.transaction(Yi,"readwrite").objectStore(Yi),n=i.get(e);n.onsuccess=()=>{const a=n.result;a&&(a.lastOpened=Date.now(),i.put(a)),t()},n.onerror=()=>t()})}async removeFromRecent(e){if(this.db)return new Promise(t=>{const s=this.db.transaction(Yi,"readwrite");s.objectStore(Yi).delete(e),s.oncomplete=()=>{this.emit("recentUpdated"),t()},s.onerror=()=>t()})}async cleanupOldRecent(){const e=await this.getRecentProjects();if(e.length>ug){const t=e.slice(ug);for(const s of t)await this.removeFromRecent(s.id)}}async clearRecentProjects(){if(this.db)return new Promise(e=>{const t=this.db.transaction(Yi,"readwrite");t.objectStore(Yi).clear(),t.oncomplete=()=>{this.emit("recentUpdated"),e()},t.onerror=()=>e()})}getTemplates(){return[...zl]}getTemplatesByCategory(){const e=new Map;for(const t of zl){const s=e.get(t.category)||[];s.push(t),e.set(t.category,s)}return e}getCurrentFileHandle(){return this.currentFileHandle}hasUnsavedChanges(e){const t=e;return!this.currentFileHandle||e.modifiedAt>(t.lastSavedAt??0)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.listeners.get(e)?.delete(t)}emit(e,t){this.listeners.get(e)?.forEach(s=>{try{s(t)}catch(i){console.error("[ProjectManager] Event callback error:",i)}})}}const e7=new ZX,W=wa()(Up((r,e)=>{const t=new rd,s=new Xu(t);return{project:h2(),photoProjects:new Map,actionExecutor:s,actionHistory:t,clipUndoStack:[],clipRedoStack:[],isLoading:!1,error:null,clipboard:[],copiedEffects:[],createNewProject:(i,n)=>{const a=new rd,o=new Xu(a);r({project:h2(i,n),actionHistory:a,actionExecutor:o,clipUndoStack:[],clipRedoStack:[],error:null})},loadProject:i=>{const n=fe.getState().getTitleEngine(),a=fe.getState().getGraphicsEngine();n&&i.textClips&&n.loadTextClips(i.textClips),a&&(i.shapeClips&&a.loadShapeClips(i.shapeClips),i.svgClips&&a.loadSVGClips(i.svgClips),i.stickerClips&&a.loadStickerClips(i.stickerClips));const o=new rd,l=new Xu(o);r({project:i,actionHistory:o,actionExecutor:l,clipUndoStack:[],clipRedoStack:[],error:null})},renameProject:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"project/rename",id:dt(),timestamp:Date.now(),params:{name:i}},l=await a.execute(o,n);return l.success&&r({project:{...n}}),l},updateSettings:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"project/updateSettings",id:dt(),timestamp:Date.now(),params:i},l=await a.execute(o,n);return l.success&&r({project:{...n,settings:{...n.settings}}}),l},importMedia:async i=>{const{project:n}=e();try{const a=Py();a.isInitialized()||await Ny();const o=i.size>50*1024*1024,l=await a.importFile(i,!0,o);if(!l.success||!l.media)return{success:!1,error:{code:"DECODE_ERROR",message:l.error||"Failed to import media"}};const d=l.media;let u=null;const h=[];if(d.thumbnails&&d.thumbnails.length>0){for(const g of d.thumbnails){let y=null;if(g.dataUrl)y=g.dataUrl;else if(g.canvas)try{if(g.canvas instanceof OffscreenCanvas){const x=await g.canvas.convertToBlob({type:"image/jpeg",quality:.7});y=URL.createObjectURL(x)}else g.canvas instanceof HTMLCanvasElement&&(y=g.canvas.toDataURL("image/jpeg",.7))}catch(x){console.warn("Failed to convert thumbnail canvas to URL:",x)}y&&h.push({timestamp:g.timestamp,url:y})}h.length>0&&(u=h[0].url)}let p;i.type.startsWith("image/")?p="image":d.metadata.hasVideo?p="video":d.metadata.hasAudio?p="audio":p="image";const f={id:dt(),name:i.name,type:p,fileHandle:null,blob:i,metadata:{duration:d.metadata.duration||0,width:d.metadata.width||0,height:d.metadata.height||0,frameRate:d.metadata.frameRate||0,codec:d.metadata.codec||"",sampleRate:d.metadata.sampleRate||0,channels:d.metadata.channels||0,fileSize:i.size},thumbnailUrl:u,waveformData:d.waveformData?.peaks||null,filmstripThumbnails:h.length>0?h:void 0},m={...n,mediaLibrary:{...n.mediaLibrary,items:[...n.mediaLibrary.items,f]},modifiedAt:Date.now()};r({project:m});try{await YX(m.id,f.id,i,f.metadata)}catch(g){console.error("[ProjectStore] Failed to persist media blob:",g)}return o&&!u&&setTimeout(async()=>{try{const g=await a.generateThumbnailsForMedia(i,p);if(g.length>0){const y=e().project,x=y.mediaLibrary.items.findIndex(b=>b.id===f.id);if(x!==-1){const b=[...y.mediaLibrary.items];b[x]={...b[x],thumbnailUrl:g[0].dataUrl,filmstripThumbnails:g.map(w=>({timestamp:w.timestamp,url:w.dataUrl}))},r({project:{...y,mediaLibrary:{...y.mediaLibrary,items:b}}})}}}catch{}},100),{success:!0,actionId:f.id}}catch(a){return{success:!1,error:{code:"DECODE_ERROR",message:a instanceof Error?a.message:"Unknown import error"}}}},deleteMedia:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"media/delete",id:dt(),timestamp:Date.now(),params:{mediaId:i}},l=await a.execute(o,n);return l.success&&(r({project:{...n}}),HX(i).catch(d=>console.warn("[ProjectStore] Failed to delete media blob:",d))),l},replaceMediaAsset:async(i,n)=>{const{project:a}=e();try{const o=Py();o.isInitialized()||await Ny();const l=await o.importFile(n,!0);if(!l.success||!l.media)return{success:!1,error:{code:"DECODE_ERROR",message:l.error||"Failed to import media"}};const d=l.media;let u=null;const h=[];if(d.thumbnails&&d.thumbnails.length>0){for(const m of d.thumbnails){let g=null;if(m.dataUrl)g=m.dataUrl;else if(m.canvas)try{if(m.canvas instanceof OffscreenCanvas){const y=await m.canvas.convertToBlob({type:"image/jpeg",quality:.7});g=URL.createObjectURL(y)}else m.canvas instanceof HTMLCanvasElement&&(g=m.canvas.toDataURL("image/jpeg",.7))}catch(y){console.warn("Failed to convert thumbnail canvas to URL:",y)}g&&h.push({timestamp:m.timestamp,url:g})}h.length>0&&(u=h[0].url)}const p={id:i,name:n.name,type:d.metadata.hasVideo?"video":d.metadata.hasAudio?"audio":"image",fileHandle:null,blob:n,metadata:{duration:d.metadata.duration||0,width:d.metadata.width||0,height:d.metadata.height||0,frameRate:d.metadata.frameRate||0,codec:d.metadata.codec||"",sampleRate:d.metadata.sampleRate||0,channels:d.metadata.channels||0,fileSize:n.size},thumbnailUrl:u,waveformData:d.waveformData?.peaks||null,filmstripThumbnails:h.length>0?h:void 0,isPlaceholder:!1},f=a.mediaLibrary.items.map(m=>m.id===i?p:m);return r({project:{...a,mediaLibrary:{items:f},modifiedAt:Date.now()}}),{success:!0,actionId:dt()}}catch(o){return{success:!1,error:{code:"DECODE_ERROR",message:o instanceof Error?o.message:"Unknown import error"}}}},renameMedia:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"media/rename",id:dt(),timestamp:Date.now(),params:{mediaId:i,name:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},getMediaItem:i=>{const{project:n}=e();return n.mediaLibrary.items.find(a=>a.id===i)},addTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l=structuredClone(a),d={type:"track/add",id:dt(),timestamp:Date.now(),params:{trackType:i,position:n}},u=await o.execute(d,l);if(u.success){const h={...l,modifiedAt:Date.now()};r({project:h})}return u},removeTrack:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"track/remove",id:dt(),timestamp:Date.now(),params:{trackId:i}},l=await a.execute(o,n);return l.success&&r({project:{...n,timeline:{...n.timeline},modifiedAt:Date.now()}}),l},reorderTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/reorder",id:dt(),timestamp:Date.now(),params:{trackId:i,newPosition:n}},d=await o.execute(l,a);return d.success&&r({project:{...a,modifiedAt:Date.now()}}),d},lockTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/lock",id:dt(),timestamp:Date.now(),params:{trackId:i,locked:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},hideTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/hide",id:dt(),timestamp:Date.now(),params:{trackId:i,hidden:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},muteTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/mute",id:dt(),timestamp:Date.now(),params:{trackId:i,muted:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},soloTrack:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"track/solo",id:dt(),timestamp:Date.now(),params:{trackId:i,solo:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},getTrack:i=>{const{project:n}=e();return n.timeline.tracks.find(a=>a.id===i)},addClip:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d=structuredClone(o),u={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:i,mediaId:n,startTime:a}},h=await l.execute(u,d);if(h.success){const p={...d,modifiedAt:Date.now()};r({project:p})}return h},addClipToNewTrack:async(i,n)=>{const{project:a,addTrack:o,getMediaItem:l}=e(),d=l(i);if(!d)return{success:!1,error:{code:"MEDIA_NOT_FOUND",message:"Media item not found"}};let u;d.type==="video"?u="video":d.type==="audio"?u="audio":d.type==="image"?u="image":u="video";const h=n!==void 0?n:p2(a),p=await o(u);if(!p.success)return p;const{project:f,actionExecutor:m}=e(),g=f.timeline.tracks.find(w=>w.clips.length===0&&w.type===u);if(!g)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Could not find newly created track"}};const y=structuredClone(f),x={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:g.id,mediaId:i,startTime:h}},b=await m.execute(x,y);if(b.success){const w={...y,modifiedAt:Date.now()};r({project:w})}return b},separateAudio:async i=>{const{project:n,actionExecutor:a,addTrack:o}=e(),l=n.timeline.tracks.flatMap(m=>m.clips).find(m=>m.id===i);if(!l)return{success:!1,error:{code:"CLIP_NOT_FOUND",message:"Clip not found"}};const d=n.mediaLibrary.items.find(m=>m.id===l.mediaId);if(!d||d.type!=="video"||!d.metadata?.channels||d.metadata.channels===0)return{success:!1,error:{code:"MEDIA_NOT_FOUND",message:"Media has no audio to separate"}};let u=n.timeline.tracks.find(m=>m.type==="audio");if(!u){if(!(await o("audio")).success)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Failed to create audio track"}};const{project:g}=e();u=g.timeline.tracks.find(y=>y.type==="audio")}if(!u)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Could not find or create audio track"}};const h=structuredClone(e().project),p={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:u.id,mediaId:l.mediaId,startTime:l.startTime}},f=await a.execute(p,h);if(f.success){const m={...h,modifiedAt:Date.now()};r({project:m})}return f},removeClip:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"clip/remove",id:dt(),timestamp:Date.now(),params:{clipId:i}},l=await a.execute(o,n);return l.success&&r({project:{...n}}),l},moveClip:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/move",id:dt(),timestamp:Date.now(),params:{clipId:i,startTime:n,trackId:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},trimClip:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/trim",id:dt(),timestamp:Date.now(),params:{clipId:i,inPoint:n,outPoint:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},splitClip:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"clip/split",id:dt(),timestamp:Date.now(),params:{clipId:i,time:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},rippleDeleteClip:async i=>{const{project:n,actionExecutor:a}=e(),o={type:"clip/rippleDelete",id:dt(),timestamp:Date.now(),params:{clipId:i}},l=await a.execute(o,n);return l.success&&r({project:{...n}}),l},slipClip:async(i,n)=>{const{project:a,actionExecutor:o}=e(),l={type:"clip/slip",id:dt(),timestamp:Date.now(),params:{clipId:i,delta:n}},d=await o.execute(l,a);return d.success&&r({project:{...a}}),d},slideClip:async(i,n)=>{const{project:a,actionExecutor:o,getClip:l}=e();if(!l(i))return{success:!1,error:{code:"INVALID_PARAMS",message:"Clip not found"}};const u=a.timeline.tracks.find(x=>x.clips.some(b=>b.id===i));if(!u)return{success:!1,error:{code:"INVALID_PARAMS",message:"Track not found"}};const h=[...u.clips].sort((x,b)=>x.startTime-b.startTime),p=h.findIndex(x=>x.id===i),f=p>0?h[p-1]:void 0,m=p<h.length-1?h[p+1]:void 0,g={type:"clip/slide",id:dt(),timestamp:Date.now(),params:{clipId:i,delta:n,prevClipId:f?.id,nextClipId:m?.id}},y=await o.execute(g,a);return y.success&&r({project:{...a}}),y},rollEdit:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/roll",id:dt(),timestamp:Date.now(),params:{leftClipId:i,rightClipId:n,delta:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},trimToPlayhead:async(i,n,a)=>{const{project:o,actionExecutor:l}=e(),d={type:"clip/trimToPlayhead",id:dt(),timestamp:Date.now(),params:{clipId:i,playheadTime:n,trimStart:a}},u=await l.execute(d,o);return u.success&&r({project:{...o}}),u},getClip:i=>{const{project:n}=e();for(const a of n.timeline.tracks){const o=a.clips.find(l=>l.id===i);if(o)return o}},copyClips:i=>{const{getClip:n}=e(),o=i.map(n).filter(l=>l!==void 0).map(l=>({...JSON.parse(JSON.stringify(l))}));r({clipboard:o})},pasteClips:async(i,n)=>{const{clipboard:a,project:o,actionExecutor:l}=e(),d=[];if(a.length===0)return[{success:!1,error:{code:"INVALID_PARAMS",message:"Clipboard is empty"}}];const u=Math.min(...a.map(h=>h.startTime));for(const h of a){const p=h.startTime-u,f=n+p,m={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:i,mediaId:h.mediaId,startTime:f,duration:h.duration,inPoint:h.inPoint,outPoint:h.outPoint,volume:h.volume,effects:h.effects}},g=await l.execute(m,o);d.push(g)}return r({project:{...o}}),d},duplicateClip:async i=>{const{getClip:n,project:a,addTrack:o}=e(),l=n(i);if(!l)return{success:!1,error:{code:"INVALID_PARAMS",message:"Clip not found"}};const d=a.timeline.tracks.find(x=>x.clips.some(b=>b.id===i));if(!d)return{success:!1,error:{code:"INVALID_PARAMS",message:"Track not found"}};const u=await o(d.type);if(!u.success)return u;const{project:h,actionExecutor:p}=e(),f=h.timeline.tracks.find(x=>x.clips.length===0&&x.type===d.type);if(!f)return{success:!1,error:{code:"TRACK_NOT_FOUND",message:"Could not find newly created track"}};const m=structuredClone(h),g={type:"clip/add",id:dt(),timestamp:Date.now(),params:{trackId:f.id,mediaId:l.mediaId,startTime:l.startTime,duration:l.duration,inPoint:l.inPoint,outPoint:l.outPoint,volume:l.volume,effects:structuredClone(l.effects),keyframes:l.keyframes?structuredClone(l.keyframes):void 0,transform:l.transform?structuredClone(l.transform):void 0}},y=await p.execute(g,m);if(y.success){const x={...m,modifiedAt:Date.now()};r({project:x})}return y},copyEffects:i=>{const{getClip:n}=e(),a=n(i);if(a){const o=JSON.parse(JSON.stringify(a.effects));r({copiedEffects:o})}},pasteEffects:async i=>{const{copiedEffects:n,project:a,actionExecutor:o}=e();if(n.length===0)return{success:!1,error:{code:"INVALID_PARAMS",message:"No effects in clipboard"}};const l=[];for(const d of n){const u={type:"effect/add",id:dt(),timestamp:Date.now(),params:{clipId:i,effectType:d.type,params:d.params}},h=await o.execute(u,a);l.push(h)}return r({project:{...a}}),l[0]||{success:!1,error:{code:"UNKNOWN",message:"No results"}}},updateClipTransform:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(y=>y.id===i);if(p===-1)return h;o=!0;const f=h.clips[p],m={...f.transform,...n,position:{...f.transform.position,...n.position||{}},scale:{...f.transform.scale,...n.scale||{}},anchor:{...f.transform.anchor,...n.anchor||{}}},g=[...h.clips];return g[p]={...f,transform:m},{...h,clips:g}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=fe.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h){const p={...h.transform,...n,position:{...h.transform.position,...n.position||{}},scale:{...h.transform.scale,...n.scale||{}},anchor:{...h.transform.anchor,...n.anchor||{}}};return d.updateTextClip(i,{transform:p}),r({project:{...a,modifiedAt:Date.now()}}),!0}}const u=fe.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h){const f={...h.transform,...n,position:{...h.transform.position,...n.position||{}},scale:{...h.transform.scale,...n.scale||{}},anchor:{...h.transform.anchor,...n.anchor||{}}};return u.updateShapeClip(i,{transform:f}),r({project:{...a,modifiedAt:Date.now()}}),!0}const p=u.getSVGClip(i);if(p){const f={...p.transform,...n,position:{...p.transform.position,...n.position||{}},scale:{...p.transform.scale,...n.scale||{}},anchor:{...p.transform.anchor,...n.anchor||{}}};return u.updateSVGClip(i,{transform:f}),r({project:{...a,modifiedAt:Date.now()}}),!0}}return!1},updateClipBlendMode:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const f=h.clips[p],m=[...h.clips];return m[p]={...f,blendMode:n},{...h,clips:m}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=fe.getState().getTitleEngine();if(d&&d.getTextClip(i))return d.updateTextClip(i,{blendMode:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;const u=fe.getState().getGraphicsEngine();if(u){if(u.getShapeClip(i))return u.updateShapeClip(i,{blendMode:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getSVGClip(i))return u.updateSVGClip(i,{blendMode:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipBlendOpacity:(i,n)=>{const{project:a}=e();if(n<0||n>100)return console.error("Blend opacity must be between 0 and 100"),!1;let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const f=h.clips[p],m=[...h.clips];return m[p]={...f,blendOpacity:n},{...h,clips:m}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=fe.getState().getTitleEngine();if(d&&d.getTextClip(i))return d.updateTextClip(i,{blendOpacity:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;const u=fe.getState().getGraphicsEngine();if(u){if(u.getShapeClip(i))return u.updateShapeClip(i,{blendOpacity:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getSVGClip(i))return u.updateSVGClip(i,{blendOpacity:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipEmphasisAnimation:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const f=h.clips[p],m=[...h.clips];return m[p]={...f,emphasisAnimation:n},{...h,clips:m}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=fe.getState().getTitleEngine();if(d&&d.getTextClip(i))return d.updateTextClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;const u=fe.getState().getGraphicsEngine();if(u){if(u.getShapeClip(i))return u.updateShapeClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getSVGClip(i))return u.updateSVGClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(u.getStickerClip(i))return u.updateStickerClip(i,{emphasisAnimation:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipRotate3D:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const f=h.clips[p],m=[...h.clips];return m[p]={...f,transform:{...f.transform,rotate3d:n}},{...h,clips:m}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=fe.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h)return d.updateTextClip(i,{transform:{...h.transform,rotate3d:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}const u=fe.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h)return u.updateShapeClip(i,{transform:{...h.transform,rotate3d:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0;const p=u.getSVGClip(i);if(p)return u.updateSVGClip(i,{transform:{...p.transform,rotate3d:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipPerspective:(i,n)=>{const{project:a}=e();if(n<0)return console.error("Perspective must be non-negative"),!1;let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const f=h.clips[p],m=[...h.clips];return m[p]={...f,transform:{...f.transform,perspective:n}},{...h,clips:m}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=fe.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h)return d.updateTextClip(i,{transform:{...h.transform,perspective:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}const u=fe.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h)return u.updateShapeClip(i,{transform:{...h.transform,perspective:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0;const p=u.getSVGClip(i);if(p)return u.updateSVGClip(i,{transform:{...p.transform,perspective:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},updateClipTransformStyle:(i,n)=>{const{project:a}=e();let o=!1;const l=a.timeline.tracks.map(h=>{const p=h.clips.findIndex(g=>g.id===i);if(p===-1)return h;o=!0;const f=h.clips[p],m=[...h.clips];return m[p]={...f,transform:{...f.transform,transformStyle:n}},{...h,clips:m}});if(o)return r({project:{...a,timeline:{...a.timeline,tracks:l},modifiedAt:Date.now()}}),!0;const d=fe.getState().getTitleEngine();if(d){const h=d.getTextClip(i);if(h)return d.updateTextClip(i,{transform:{...h.transform,transformStyle:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}const u=fe.getState().getGraphicsEngine();if(u){const h=u.getShapeClip(i);if(h)return u.updateShapeClip(i,{transform:{...h.transform,transformStyle:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0;const p=u.getSVGClip(i);if(p)return u.updateSVGClip(i,{transform:{...p.transform,transformStyle:n}}),r({project:{...a,modifiedAt:Date.now()}}),!0}return!1},undo:async()=>{const{project:i,actionExecutor:n,clipUndoStack:a,clipRedoStack:o}=e();if(a.length>0){const d=a[a.length-1];let u=!1;if(d.type==="shape"){const h=fe.getState().getGraphicsEngine();h&&(u=h.deleteShapeClip(d.clipId))}else if(d.type==="text"){const h=fe.getState().getTitleEngine();h&&(u=h.deleteTextClip(d.clipId))}else if(d.type==="svg"){const h=fe.getState().getGraphicsEngine();h&&(u=h.deleteSVGClip(d.clipId))}else if(d.type==="sticker"){const h=fe.getState().getGraphicsEngine();h&&(u=h.deleteStickerClip(d.clipId))}if(u){r({project:{...i,modifiedAt:Date.now()},clipUndoStack:a.slice(0,-1),clipRedoStack:[...o,{...d,hadEmptyTrackUndo:!1}]});const h=d.trackId,f=e().project.timeline.tracks.find(m=>m.id===h);if(f){let m=!1;if(f.type==="text")m=(fe.getState().getTitleEngine()?.getAllTextClips()||[]).some(x=>x.trackId===h);else if(f.type==="graphics"){const g=fe.getState().getGraphicsEngine(),y=g?.getAllShapeClips()||[],x=g?.getAllSVGClips()||[],b=g?.getAllStickerClips()||[];m=[...y,...x,...b].some(w=>w.trackId===h)}else(f.type==="video"||f.type==="audio"||f.type==="image")&&(m=f.clips.length>0);if(!m){const{actionHistory:g}=e(),x=g.peekUndo()?.action,w={text:"text",shape:"graphics",svg:"graphics",sticker:"graphics"}[d.type]||f.type,C=x?.params?.trackType;if(x&&x.type==="track/add"&&C===w&&(await n.undo(e().project)).success){const S=e().clipRedoStack;if(S.length>0){const A=S[S.length-1];r({project:{...e().project},clipRedoStack:[...S.slice(0,-1),{...A,hadEmptyTrackUndo:!0,trackType:w}]})}}}}return{success:!0}}}const l=await n.undo(i);return l.success&&r({project:{...i}}),l},redo:async()=>{const{project:i,actionExecutor:n,clipUndoStack:a,clipRedoStack:o}=e();if(o.length>0){const d=o[o.length-1];let u=!1,h;if(d.hadEmptyTrackUndo&&d.trackType){const f=await n.redo(e().project);if(!f.success)return f;const m=e().project,g=m.timeline.tracks.filter(y=>y.type===d.trackType);g.length>0&&(h=g[g.length-1].id),r({project:{...m}})}const p=h||d.trackId;if(d.type==="shape"){const f=fe.getState().getGraphicsEngine();if(f){const m=d.clipData;f.createShape({shapeType:m.shapeType,width:200,height:200,style:m.style},p,m.startTime,m.duration),u=!0}}else if(d.type==="text"){const f=fe.getState().getTitleEngine();if(f){const m=d.clipData;f.createTextClip({trackId:p,startTime:m.startTime,text:m.text,duration:m.duration,style:m.style}),u=!0}}else if(d.type==="svg"){const f=fe.getState().getGraphicsEngine();if(f){const m=d.clipData;f.importSVG(m.svgContent,p,m.startTime,m.duration),u=!0}}else if(d.type==="sticker"){const f=fe.getState().getGraphicsEngine();if(f){const m=d.clipData;f.addStickerClip({...m,trackId:p}),u=!0}}if(u){const f=h?{...d,trackId:h,clipData:{...d.clipData,trackId:h}}:d;return r({project:{...e().project,modifiedAt:Date.now()},clipUndoStack:[...a,f],clipRedoStack:o.slice(0,-1)}),{success:!0}}}const l=await n.redo(i);return l.success&&r({project:{...i}}),l},canUndo:()=>{const{actionHistory:i,clipUndoStack:n}=e();return n.length>0||i.canUndo()},canRedo:()=>{const{actionHistory:i,clipRedoStack:n}=e();return n.length>0||i.canRedo()},executeAction:async i=>{const{project:n,actionExecutor:a}=e(),o=await a.execute(i,n);return o.success&&r({project:{...n}}),o},getTimelineDuration:()=>{const{project:i}=e(),n=i.timeline?.duration||0;return n>0?n:p2(i)},setTimelineDuration:i=>{const{project:n}=e(),a=Math.max(0,i);r({project:{...n,timeline:{...n.timeline,duration:a},modifiedAt:Date.now()}})},initializeAutoSave:async()=>{await LX(),er.start(()=>{const{project:i}=e(),n=fe.getState().getTitleEngine(),a=fe.getState().getGraphicsEngine();return{...i,textClips:n?.getAllTextClips()||[],shapeClips:a?.getAllShapeClips()||[],svgClips:a?.getAllSVGClips()||[],stickerClips:a?.getAllStickerClips()||[]}}),W.subscribe(i=>i.project,()=>{er.markDirty()})},checkForRecovery:async()=>{const{project:i}=e();return er.checkForRecovery(i.id)},recoverFromAutoSave:async i=>{const n=await er.recover(i);if(n){const a=await qX(n.id),o=new Map(a.map(m=>[m.id,m.blob])),l=await Promise.all(n.mediaLibrary.items.map(m=>KX(m,o.get(m.id)))),d={...n,mediaLibrary:{...n.mediaLibrary,items:l}},u=fe.getState().getTitleEngine(),h=fe.getState().getGraphicsEngine();u&&n.textClips&&u.loadTextClips(n.textClips),h&&(n.shapeClips&&h.loadShapeClips(n.shapeClips),n.svgClips&&h.loadSVGClips(n.svgClips),n.stickerClips&&h.loadStickerClips(n.stickerClips));const p=new rd,f=new Xu(p);return r({project:d,actionHistory:p,actionExecutor:f,clipUndoStack:[],clipRedoStack:[],error:null}),await e7.addToRecent(d),!0}return!1},forceSave:async()=>{const{project:i}=e(),n=fe.getState().getTitleEngine(),a=fe.getState().getGraphicsEngine(),o={...i,textClips:n?.getAllTextClips()||[],shapeClips:a?.getAllShapeClips()||[],svgClips:a?.getAllSVGClips()||[],stickerClips:a?.getAllStickerClips()||[]};await er.forceSave(o)},getFullProject:()=>{const{project:i}=e(),n=fe.getState().getTitleEngine(),a=fe.getState().getGraphicsEngine();return{...i,textClips:n?.getAllTextClips()||[],shapeClips:a?.getAllShapeClips()||[],svgClips:a?.getAllSVGClips()||[],stickerClips:a?.getAllStickerClips()||[]}},createTextClip:(i,n,a,o=5,l)=>{const d=fe.getState().titleEngine;if(!d)return console.error("TitleEngine not available yet"),null;const{project:u}=e();if(!u.timeline.tracks.find(g=>g.id===i))return console.error(`Track ${i} not found`),null;const p=d.createTextClip({trackId:i,startTime:n,text:a,duration:o,style:l}),{clipUndoStack:f}=e(),m={type:"text",clipId:p.id,trackId:i,clipData:{...p}};return r({project:{...u,modifiedAt:Date.now()},clipUndoStack:[...f,m],clipRedoStack:[]}),p},updateTextContent:(i,n)=>{const a=fe.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateText(i,n);return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},updateTextStyle:(i,n)=>{const a=fe.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateStyle(i,n);return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},updateTextAnimation:(i,n)=>{const a=fe.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateTextClip(i,{animation:n});return o&&r({project:{...e().project}}),o||null},updateTextTransform:(i,n)=>{const a=fe.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateTextClip(i,{transform:n});return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},getTextClip:i=>{const n=fe.getState().getTitleEngine();if(n)return n.getTextClip(i)},getAllTextClips:()=>{const i=fe.getState().getTitleEngine();return i?i.getAllTextClips():[]},updateTextClipKeyframes:(i,n)=>{const a=fe.getState().getTitleEngine();if(!a)return console.error("TitleEngine not initialized"),null;const o=a.updateTextClip(i,{keyframes:n});return o&&r({project:{...e().project,modifiedAt:Date.now()}}),o||null},applyTextAnimationPreset:(i,n,a=.5,o=.5,l)=>{const d=fe.getState().getTitleEngine();if(!d)return null;const u=_p.createAnimationPreset(n,a,o,l),h=d.updateTextClip(i,{animation:u});if(h){const{project:p}=e();r({project:{...p,modifiedAt:Date.now()}})}return h||null},getAvailableAnimationPresets:()=>_p.getAvailablePresets(),addSubtitle:async i=>{const{project:n,addTrack:a,createTextClip:o}=e();let l=n.timeline.tracks.find(h=>h.type==="text"&&h.name==="Captions");if(!l){if(!(await a("text"))?.success)return;l=e().project.timeline.tracks.filter(m=>m.type==="text"&&!n.timeline.tracks.some(g=>g.id===m.id))[0],l&&(r(m=>({project:{...m.project,timeline:{...m.project.timeline,tracks:m.project.timeline.tracks.map(g=>g.id===l.id?{...g,name:"Captions"}:g)}}})),l={...l,name:"Captions"})}if(!l)return;const d=i.endTime-i.startTime,u=i.style;o(l.id,i.startTime,i.text,d,u?{fontFamily:u.fontFamily,fontSize:u.fontSize,color:u.color,backgroundColor:u.backgroundColor||void 0}:void 0)},removeSubtitle:i=>{r(n=>({project:{...n.project,timeline:{...n.project.timeline,subtitles:n.project.timeline.subtitles.filter(a=>a.id!==i)}}}))},updateSubtitle:(i,n)=>{r(a=>({project:{...a.project,timeline:{...a.project.timeline,subtitles:a.project.timeline.subtitles.map(o=>o.id===i?{...o,...n}:o)}}}))},getSubtitle:i=>e().project.timeline.subtitles.find(n=>n.id===i),importSRT:async i=>{const n=await fe.getState().getSubtitleEngine(),{project:a}=e(),{timeline:o,result:l}=n.importSRT(a.timeline,i);return l.success?(r({project:{...a,timeline:o,modifiedAt:Date.now()}}),{success:!0,errors:[]}):{success:!1,errors:l.errors.map(u=>`Line ${u.line}: ${u.message}`)}},exportSRT:async()=>{const i=await fe.getState().getSubtitleEngine(),{project:n}=e();return i.exportSRT(n.timeline)},applySubtitleStylePreset:async i=>{const n=await fe.getState().getSubtitleEngine(),{project:a}=e(),o=n.applyStylePreset(a.timeline,i);return"error"in o?(console.error(o.error),!1):(r({project:{...a,timeline:o.timeline,modifiedAt:Date.now()}}),!0)},getSubtitleStylePresets:async()=>(await fe.getState().getSubtitleEngine()).getStylePresets(),addMarker:(i,n="Marker",a="#3b82f6")=>{const o={id:`marker-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,time:i,label:n,color:a};r(l=>({project:{...l.project,timeline:{...l.project.timeline,markers:[...l.project.timeline.markers,o]}}}))},removeMarker:i=>{r(n=>({project:{...n.project,timeline:{...n.project.timeline,markers:n.project.timeline.markers.filter(a=>a.id!==i)}}}))},updateMarker:(i,n)=>{r(a=>({project:{...a.project,timeline:{...a.project.timeline,markers:a.project.timeline.markers.map(o=>o.id===i?{...o,...n}:o)}}}))},getMarker:i=>e().project.timeline.markers.find(a=>a.id===i),getMarkers:()=>e().project.timeline.markers,createShapeClip:(i,n,a,o=5,l)=>{const d=fe.getState().getGraphicsEngine();if(!d)return console.error("GraphicsEngine not initialized"),null;const{project:u}=e();if(!u.timeline.tracks.find(g=>g.id===i))return console.error(`Track ${i} not found`),null;const p=d.createShape({shapeType:a,width:200,height:200,style:l},i,n,o),{clipUndoStack:f}=e(),m={type:"shape",clipId:p.id,trackId:i,clipData:{...p}};return r({project:{...u,modifiedAt:Date.now()},clipUndoStack:[...f,m],clipRedoStack:[]}),p},updateShapeStyle:(i,n)=>{const a=fe.getState().getGraphicsEngine();if(!a)return console.error("GraphicsEngine not initialized"),null;const o=a.getShapeClip(i);if(!o)return console.error(`Shape clip ${i} not found`),null;const l=a.updateShapeStyle(o,n),{project:d}=e();return r({project:{...d,modifiedAt:Date.now()}}),l},updateShapeTransform:(i,n)=>{const a=fe.getState().getGraphicsEngine();if(!a)return console.error("GraphicsEngine not initialized"),null;if(a.getShapeClip(i)){const d=a.updateShapeClip(i,{transform:n}),{project:u}=e();return r({project:{...u,modifiedAt:Date.now()}}),d||null}if(a.getSVGClip(i)){const d=a.updateSVGClip(i,{transform:n}),{project:u}=e();return r({project:{...u,modifiedAt:Date.now()}}),d||null}return console.error(`Graphic clip ${i} not found`),null},importSVG:(i,n,a,o=5)=>{const l=fe.getState().getGraphicsEngine();if(!l)return console.error("GraphicsEngine not initialized"),null;const{project:d}=e();if(!d.timeline.tracks.find(h=>h.id===n))return console.error(`Track ${n} not found`),null;try{const h=l.importSVG(i,n,a,o),{clipUndoStack:p}=e(),f={type:"svg",clipId:h.id,trackId:n,clipData:{...h}};return r({project:{...d,modifiedAt:Date.now()},clipUndoStack:[...p,f],clipRedoStack:[]}),h}catch(h){return console.error("Failed to import SVG:",h),null}},getShapeClip:i=>{const n=fe.getState().getGraphicsEngine();if(n)return n.getShapeClip(i)},getSVGClip:i=>{const n=fe.getState().getGraphicsEngine();if(n)return n.getSVGClip(i)},getSVGClipById:i=>e().getSVGClip(i),updateSVGClip:(i,n)=>{const a=fe.getState().getGraphicsEngine();if(!a)return console.error("[ProjectStore] GraphicsEngine not initialized"),null;const o=a.updateSVGClip(i,n);if(o){const{project:l}=e();r({project:{...l,modifiedAt:Date.now()}})}else console.error(`[ProjectStore] Failed to update SVG clip ${i}`);return o||null},createStickerClip:i=>{const n=fe.getState().getGraphicsEngine();if(!n)return console.error("GraphicsEngine not initialized"),null;const{project:a}=e();return a.timeline.tracks.find(l=>l.id===i.trackId)?(n.addStickerClip(i),r({project:{...a,modifiedAt:Date.now()}}),i):(console.error(`Track ${i.trackId} not found`),null)},getStickerClip:i=>{const n=fe.getState().getGraphicsEngine();if(n)return n.getStickerClip(i)},deleteShapeClip:i=>{const n=fe.getState().getGraphicsEngine();if(!n)return!1;const a=n.deleteShapeClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},deleteSVGClip:i=>{const n=fe.getState().getGraphicsEngine();if(!n)return!1;const a=n.deleteSVGClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},deleteStickerClip:i=>{const n=fe.getState().getGraphicsEngine();if(!n)return!1;const a=n.deleteStickerClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},deleteTextClip:i=>{const n=fe.getState().getTitleEngine();if(!n)return!1;const a=n.deleteTextClip(i);if(a){const{project:o}=e();r({project:{...o,modifiedAt:Date.now()}})}return a},createPhotoProject:(i,n,a)=>{const o=fe.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const l=o.createProject(i,n,a),{photoProjects:d}=e();return d.set(l.id,l),r({photoProjects:new Map(d)}),l},importPhotoForEditing:(i,n)=>{const a=fe.getState().getPhotoEngine();if(!a)return console.error("PhotoEngine not initialized"),null;const o=a.createProject(i.width,i.height,n||"Photo Edit"),l=a.importPhoto(o,i,n),{photoProjects:d}=e();return d.set(l.id,l),r({photoProjects:new Map(d)}),l},addPhotoLayer:(i,n)=>{const a=fe.getState().getPhotoEngine();if(!a)return console.error("PhotoEngine not initialized"),null;const{photoProjects:o}=e(),l=o.get(i);if(!l)return console.error(`Photo project ${i} not found`),null;const d=a.addLayer(l,n);return o.set(i,d),r({photoProjects:new Map(o)}),d},removePhotoLayer:(i,n)=>{const a=fe.getState().getPhotoEngine();if(!a)return console.error("PhotoEngine not initialized"),null;const{photoProjects:o}=e(),l=o.get(i);if(!l)return console.error(`Photo project ${i} not found`),null;const d=a.removeLayer(l,n);return o.set(i,d),r({photoProjects:new Map(o)}),d},reorderPhotoLayers:(i,n,a)=>{const o=fe.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.reorderLayers(d,n,a);if(!u.success)return console.error(`Failed to reorder layers: ${u.error}`),null;const h={...d,layers:u.layers};return l.set(i,h),r({photoProjects:new Map(l)}),h},setPhotoLayerVisibility:(i,n,a)=>{const o=fe.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.setLayerVisibility(d,n,a);return l.set(i,u),r({photoProjects:new Map(l)}),u},setPhotoLayerOpacity:(i,n,a)=>{const o=fe.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.setLayerOpacity(d,n,a);return l.set(i,u),r({photoProjects:new Map(l)}),u},setPhotoLayerBlendMode:(i,n,a)=>{const o=fe.getState().getPhotoEngine();if(!o)return console.error("PhotoEngine not initialized"),null;const{photoProjects:l}=e(),d=l.get(i);if(!d)return console.error(`Photo project ${i} not found`),null;const u=o.setLayerBlendMode(d,n,a);return l.set(i,u),r({photoProjects:new Map(l)}),u},getPhotoProject:i=>{const{photoProjects:n}=e();return n.get(i)||null},addVideoEffect:(i,n,a)=>{const o=mr();if(!o.isInitialized())return console.error("EffectsBridge not initialized"),null;const l=o.applyVideoEffect(i,n,a);if(!l.success||!l.effectId)return console.error("Failed to add video effect:",l.error),null;const d=o.getEffect(i,l.effectId);if(d){const{project:u}=e(),h=o.getEffects(i),p=u.timeline.tracks.map(f=>({...f,clips:f.clips.map(m=>m.id===i?{...m,effects:h.length>0?[...h]:[...m.effects,d]}:m)}));r({project:{...u,timeline:{...u.timeline,tracks:p},modifiedAt:Date.now()}})}return d||null},updateVideoEffect:(i,n,a)=>{const o=mr();if(!o.isInitialized())return console.error("EffectsBridge not initialized"),null;const l=o.updateVideoEffect(i,n,a);if(!l.success)return console.error("Failed to update video effect:",l.error),null;const d=o.getEffect(i,n);if(d){const{project:u}=e(),h=u.timeline.tracks.map(p=>({...p,clips:p.clips.map(f=>{if(f.id===i){const m=f.effects.map(g=>g.id===n?{...g,params:{...g.params,...a}}:g);return{...f,effects:m}}return f})}));r({project:{...u,timeline:{...u.timeline,tracks:h},modifiedAt:Date.now()}})}return d||null},removeVideoEffect:(i,n)=>{const a=mr();if(!a.isInitialized())return console.error("EffectsBridge not initialized"),!1;const o=a.removeVideoEffect(i,n);if(!o.success)return console.error("Failed to remove video effect:",o.error),!1;const{project:l}=e(),d=a.getEffects(i),u=l.timeline.tracks.map(h=>({...h,clips:h.clips.map(p=>p.id===i?{...p,effects:[...d]}:p)}));return r({project:{...l,timeline:{...l.timeline,tracks:u},modifiedAt:Date.now()}}),!0},reorderVideoEffects:(i,n)=>{const a=mr();if(!a.isInitialized())return console.error("EffectsBridge not initialized"),!1;const o=a.reorderEffects(i,n);if(!o.success)return console.error("Failed to reorder video effects:",o.error),!1;const{project:l}=e(),d=a.getEffects(i),u=l.timeline.tracks.map(h=>({...h,clips:h.clips.map(p=>p.id===i?{...p,effects:[...d]}:p)}));return r({project:{...l,timeline:{...l.timeline,tracks:u},modifiedAt:Date.now()}}),!0},toggleVideoEffect:(i,n,a)=>{const o=mr();if(!o.isInitialized())return console.error("EffectsBridge not initialized"),null;const l=o.toggleEffect(i,n,a);if(!l.success)return console.error("Failed to toggle video effect:",l.error),null;const d=o.getEffect(i,n);if(d){const{project:u}=e(),h=u.timeline.tracks.map(p=>({...p,clips:p.clips.map(f=>f.id===i?{...f,effects:f.effects.map(m=>m.id===n?{...m,enabled:a}:m)}:f)}));r({project:{...u,timeline:{...u.timeline,tracks:h},modifiedAt:Date.now()}})}return d||null},getVideoEffects:i=>{const n=mr();return n.isInitialized()?n.getEffects(i):[]},getVideoEffect:(i,n)=>{const a=mr();if(a.isInitialized())return a.getEffect(i,n)},updateColorGrading:(i,n)=>{const a=mr();if(!a.isInitialized())return console.error("EffectsBridge not initialized"),!1;if(n.colorWheels){const o=a.applyColorWheels(i,n.colorWheels);if(!o.success)return console.error("Failed to apply color wheels:",o.error),!1}if(n.curves){const o=a.applyCurves(i,n.curves);if(!o.success)return console.error("Failed to apply curves:",o.error),!1}if(n.lut){const o=a.applyLUT(i,n.lut);if(!o.success)return console.error("Failed to apply LUT:",o.error),!1}if(n.hsl){const o=a.applyHSL(i,n.hsl);if(!o.success)return console.error("Failed to apply HSL:",o.error),!1}return r({project:{...e().project,modifiedAt:Date.now()}}),!0},getColorGrading:i=>{const n=mr();return n.isInitialized()?n.getColorGrading(i):{}},resetColorGrading:i=>{const n=mr();if(!n.isInitialized())return console.error("EffectsBridge not initialized"),!1;const a=n.resetColorGrading(i);return a.success?(r({project:{...e().project,modifiedAt:Date.now()}}),!0):(console.error("Failed to reset color grading:",a.error),!1)},addAudioEffect:(i,n)=>{const{project:a}=e();for(const o of a.timeline.tracks){const l=o.clips.findIndex(d=>d.id===i);if(l!==-1){const d=o.clips[l],h=[...d.audioEffects||[],n],p={...d,audioEffects:h},f=[...o.clips];f[l]=p;const m={...o,clips:f},g=a.timeline.tracks.map(x=>x.id===o.id?m:x),y={...a,timeline:{...a.timeline,tracks:g},modifiedAt:Date.now()};return r({project:y}),!0}}return!1},updateAudioEffect:(i,n,a)=>{const{project:o}=e();for(const l of o.timeline.tracks){const d=l.clips.findIndex(u=>u.id===i);if(d!==-1){const u=l.clips[d],h=u.audioEffects||[],p=h.findIndex(f=>f.id===n);if(p!==-1){const f=h[p],m={...f,params:{...f.params,...a}},g=[...h];g[p]=m;const y={...u,audioEffects:g},x=[...l.clips];x[d]=y;const b={...l,clips:x},w=o.timeline.tracks.map(k=>k.id===l.id?b:k),C={...o,timeline:{...o.timeline,tracks:w},modifiedAt:Date.now()};return r({project:C}),!0}}}return!1},removeAudioEffect:(i,n)=>{const{project:a}=e();for(const o of a.timeline.tracks){const l=o.clips.findIndex(d=>d.id===i);if(l!==-1){const d=o.clips[l],h=(d.audioEffects||[]).filter(x=>x.id!==n),p={...d,audioEffects:h},f=[...o.clips];f[l]=p;const m={...o,clips:f},g=a.timeline.tracks.map(x=>x.id===o.id?m:x),y={...a,timeline:{...a.timeline,tracks:g},modifiedAt:Date.now()};return r({project:y}),!0}}return!1},toggleAudioEffect:(i,n,a)=>{const{project:o}=e();for(const l of o.timeline.tracks){const d=l.clips.findIndex(u=>u.id===i);if(d!==-1){const u=l.clips[d],h=u.audioEffects||[],p=h.findIndex(f=>f.id===n);if(p!==-1){const m={...h[p],enabled:a},g=[...h];g[p]=m;const y={...u,audioEffects:g},x=[...l.clips];x[d]=y;const b={...l,clips:x},w=o.timeline.tracks.map(k=>k.id===l.id?b:k),C={...o,timeline:{...o.timeline,tracks:w},modifiedAt:Date.now()};return r({project:C}),!0}}}return!1},getAudioEffects:i=>{const{project:n}=e();for(const a of n.timeline.tracks){const o=a.clips.find(l=>l.id===i);if(o)return o.audioEffects||[]}return[]},updateClipKeyframes:(i,n)=>{const{project:a}=e(),o=fe.getState().getGraphicsEngine();if(o){if(o.getShapeClip(i))return o.updateShapeClip(i,{keyframes:n}),r({project:{...a,modifiedAt:Date.now()}}),!0;if(o.getSVGClip(i))return o.updateSVGClip(i,{keyframes:n}),r({project:{...a,modifiedAt:Date.now()}}),!0}for(const l of a.timeline.tracks){const d=l.clips.findIndex(u=>u.id===i);if(d!==-1){const h={...l.clips[d],keyframes:n},p=[...l.clips];p[d]=h;const f={...l,clips:p},m=a.timeline.tracks.map(y=>y.id===l.id?f:y),g={...a,timeline:{...a.timeline,tracks:m},modifiedAt:Date.now()};return r({project:g}),!0}}return!1}}}));aS.registerLanguage("json",NN);const t7=({isOpen:r,onClose:e})=>{const{project:t}=W(),[s,i]=v.useState(""),[n,a]=v.useState(null),[o,l]=v.useState(!1),[d,u]=v.useState(!1),h=v.useMemo(()=>QG(),[]),p=v.useMemo(()=>ZG(h),[h]),f=v.useMemo(()=>t?p.exportToJsonWithMetadata(t,`Exported from ${t.name}`):"",[t,p]),m=v.useCallback(async()=>{try{await navigator.clipboard.writeText(f),u(!0),setTimeout(()=>u(!1),2e3)}catch(b){console.error("Failed to copy:",b)}},[f]),g=v.useCallback(()=>{const b=new Blob([f],{type:"application/json"}),w=URL.createObjectURL(b),C=document.createElement("a");C.href=w,C.download=`${t?.name||"project"}-script.json`,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(w)},[f,t?.name]),y=v.useCallback(()=>{l(!0);try{const b=p.validateProjectJson(s);a(b)}catch(b){a({valid:!1,errors:[`Validation error: ${b instanceof Error?b.message:"Unknown error"}`],warnings:[]})}finally{l(!1)}},[s,p]),x=v.useCallback(()=>{if(n?.valid)try{const{project:b}=p.importFromJsonWithValidation(s);b&&(W.getState().loadProject(b),e())}catch(b){a({valid:!1,errors:[`Import error: ${b instanceof Error?b.message:"Unknown error"}`],warnings:[]})}},[s,n,p,e]);return r?c.jsx(Ta,{open:!0,onOpenChange:b=>!b&&e(),children:c.jsxs(Sn,{className:"max-w-6xl max-h-[90vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsx(Aa,{className:"p-4 border-b border-border space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(zc,{size:20,className:"text-primary"}),c.jsxs("div",{children:[c.jsx(ja,{className:"text-lg font-semibold text-text-primary",children:"Script View"}),c.jsx(ku,{className:"text-xs text-text-muted",children:"View and import project JSON"})]})]})}),c.jsxs(Sb,{defaultValue:"view",className:"flex-1 flex flex-col overflow-hidden",children:[c.jsxs(Tb,{className:"flex gap-1 p-2 border-b border-border bg-transparent rounded-none justify-start",children:[c.jsx(Jd,{value:"view",className:"px-4 py-2 rounded-lg text-sm font-medium data-[state=active]:bg-background-tertiary data-[state=active]:text-text-primary text-text-secondary hover:text-text-primary hover:bg-background-elevated",children:"View & Export"}),c.jsx(Jd,{value:"import",className:"px-4 py-2 rounded-lg text-sm font-medium data-[state=active]:bg-background-tertiary data-[state=active]:text-text-primary text-text-secondary hover:text-text-primary hover:bg-background-elevated",children:"Import"})]}),c.jsxs(Zd,{value:"view",className:"flex-1 flex flex-col overflow-hidden mt-0",children:[c.jsxs("div",{className:"flex gap-2 p-3 border-b border-border",children:[c.jsx(Et,{variant:"outline",size:"sm",onClick:m,children:d?c.jsxs(c.Fragment,{children:[c.jsx(C0,{size:16,className:"text-primary"}),"Copied!"]}):c.jsxs(c.Fragment,{children:[c.jsx(Ao,{size:16}),"Copy"]})}),c.jsxs(Et,{variant:"outline",size:"sm",onClick:g,children:[c.jsx(Lx,{size:16}),"Download"]}),c.jsx("div",{className:"flex-1"}),c.jsxs("a",{href:"/llm.txt",download:"openreel-llm-documentation.txt",className:"flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg text-sm transition-colors",children:[c.jsx(zc,{size:16}),"Download LLM.txt"]})]}),c.jsx("div",{className:"flex-1 overflow-auto custom-scrollbar p-4",children:c.jsx("div",{className:"rounded-lg overflow-hidden border border-border",children:c.jsx(aS,{language:"json",style:RN,showLineNumbers:!0,customStyle:{margin:0,padding:"1rem",background:"#1e1e1e",fontSize:"12px"},children:f})})})]}),c.jsxs(Zd,{value:"import",className:"flex-1 flex flex-col gap-4 p-4 overflow-auto mt-0",children:[c.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[c.jsx("label",{className:"text-sm font-medium text-text-secondary",children:"Paste JSON"}),c.jsx("textarea",{value:s,onChange:b=>i(b.target.value),placeholder:"Paste project JSON here...",className:"flex-1 p-3 bg-background-tertiary border border-border rounded-lg text-text-primary font-mono text-xs resize-none focus:outline-none focus:border-primary"})]}),c.jsx(Et,{variant:"outline",onClick:y,disabled:!s||o,children:o?"Validating...":"Validate"}),n&&c.jsxs("div",{className:"space-y-2",children:[n.valid&&c.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 border border-primary/30 rounded-lg",children:[c.jsx(C0,{size:16,className:"text-primary"}),c.jsx("span",{className:"text-sm text-primary",children:"Valid JSON - Ready to import"})]}),n.errors.length>0&&c.jsxs("div",{className:"p-3 bg-error/10 border border-error/30 rounded-lg space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2 text-error font-medium text-sm",children:[c.jsx(To,{size:16}),"Errors"]}),c.jsx("ul",{className:"list-disc list-inside text-xs text-error/80 space-y-0.5",children:n.errors.map((b,w)=>c.jsx("li",{children:b},w))})]}),n.warnings.length>0&&c.jsxs("div",{className:"p-3 bg-warning/10 border border-warning/30 rounded-lg space-y-1",children:[c.jsxs("div",{className:"flex items-center gap-2 text-warning font-medium text-sm",children:[c.jsx(_o,{size:16}),"Warnings"]}),c.jsx("ul",{className:"list-disc list-inside text-xs text-warning/80 space-y-0.5",children:n.warnings.map((b,w)=>c.jsx("li",{children:b},w))})]}),n.missingAssets&&n.missingAssets.length>0&&c.jsxs("div",{className:"p-3 bg-background-tertiary border border-border rounded-lg space-y-1",children:[c.jsxs("div",{className:"text-sm font-medium text-text-secondary",children:["Missing Assets (",n.missingAssets.length,")"]}),c.jsx("p",{className:"text-xs text-text-muted",children:"These assets will be imported as placeholders and can be replaced later."})]})]}),c.jsxs(Et,{onClick:x,disabled:!n?.valid,children:[c.jsx(ef,{size:16}),"Import Project"]})]})]})]})}):null},f2={playPause:"Space",undo:"Meta+z",redo:"Meta+Shift+z",delete:"Backspace",split:"s",copy:"Meta+c",paste:"Meta+v",cut:"Meta+x",selectAll:"Meta+a",zoomIn:"=",zoomOut:"-",zoomFit:"Shift+z"},s7={enabled:!0,snapToGrid:!0,snapToClips:!0,snapToPlayhead:!0,snapToMarkers:!0,gridSize:1,snapThreshold:10},i7={mediaLibrary:{visible:!0,width:300},inspector:{visible:!0,width:300},effects:{visible:!1,width:300},audioMixer:{visible:!1,width:300},colorGrading:{visible:!1,width:400},subtitles:{visible:!1,width:300}},Ft=wa()(Up(oS((r,e)=>({selectedItems:[],lastSelectedItem:null,snapSettings:s7,panels:i7,shortcuts:f2,theme:"dark",showWaveforms:!0,showThumbnails:!0,showKeyframes:!0,autoScroll:!0,activeModal:null,modalData:null,contextMenu:null,isDragging:!1,dragType:null,dragData:null,cropMode:!1,cropClipId:null,motionPathMode:!1,motionPathClipId:null,keyframeEditorOpen:!1,showWelcomeScreen:!0,skipWelcomeScreen:!1,exportState:{isExporting:!1,progress:0,phase:""},setExportState:t=>r({exportState:t}),select:(t,s=!1)=>{const{selectedItems:i}=e();s?i.some(a=>a.id===t.id)||r({selectedItems:[...i,t],lastSelectedItem:t}):r({selectedItems:[t],lastSelectedItem:t})},selectMultiple:t=>{r({selectedItems:t,lastSelectedItem:t.length>0?t[t.length-1]:null})},deselect:t=>{const{selectedItems:s,lastSelectedItem:i}=e(),n=s.filter(a=>a.id!==t);r({selectedItems:n,lastSelectedItem:i?.id===t?n.length>0?n[n.length-1]:null:i})},clearSelection:()=>{r({selectedItems:[],lastSelectedItem:null})},isSelected:t=>{const{selectedItems:s}=e();return s.some(i=>i.id===t)},getSelectedClipIds:()=>{const{selectedItems:t}=e();return t.filter(s=>s.type==="clip"||s.type==="text-clip"||s.type==="shape-clip").map(s=>s.id)},getSelectedTrackIds:()=>{const{selectedItems:t}=e();return t.filter(s=>s.type==="track").map(s=>s.id)},setSnapEnabled:t=>{r(s=>({snapSettings:{...s.snapSettings,enabled:t}}))},setSnapToGrid:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToGrid:t}}))},setSnapToClips:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToClips:t}}))},setSnapToPlayhead:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToPlayhead:t}}))},setSnapToMarkers:t=>{r(s=>({snapSettings:{...s.snapSettings,snapToMarkers:t}}))},setGridSize:t=>{r(s=>({snapSettings:{...s.snapSettings,gridSize:Math.max(.01,t)}}))},setSnapThreshold:t=>{r(s=>({snapSettings:{...s.snapSettings,snapThreshold:Math.max(1,t)}}))},toggleSnap:()=>{r(t=>({snapSettings:{...t.snapSettings,enabled:!t.snapSettings.enabled}}))},togglePanel:t=>{r(s=>({panels:{...s.panels,[t]:{...s.panels[t],visible:!s.panels[t].visible}}}))},setPanelVisible:(t,s)=>{r(i=>({panels:{...i.panels,[t]:{...i.panels[t],visible:s}}}))},setPanelWidth:(t,s)=>{r(i=>({panels:{...i.panels,[t]:{...i.panels[t],width:Math.max(200,Math.min(800,s))}}}))},setPanelCollapsed:(t,s)=>{r(i=>({panels:{...i.panels,[t]:{...i.panels[t],collapsed:s}}}))},setShortcut:(t,s)=>{r(i=>({shortcuts:{...i.shortcuts,[t]:s}}))},resetShortcuts:()=>{r({shortcuts:f2})},setTheme:t=>{r({theme:t})},setShowWaveforms:t=>{r({showWaveforms:t})},setShowThumbnails:t=>{r({showThumbnails:t})},setShowKeyframes:t=>{r({showKeyframes:t})},setAutoScroll:t=>{r({autoScroll:t})},openModal:(t,s)=>{r({activeModal:t,modalData:s||null})},closeModal:()=>{r({activeModal:null,modalData:null})},showContextMenu:(t,s,i)=>{r({contextMenu:{visible:!0,x:t,y:s,items:i}})},hideContextMenu:()=>{r({contextMenu:null})},startDrag:(t,s)=>{r({isDragging:!0,dragType:t,dragData:s})},endDrag:()=>{r({isDragging:!1,dragType:null,dragData:null})},setCropMode:(t,s)=>{r({cropMode:t,cropClipId:t&&s||null})},setMotionPathMode:(t,s)=>{r({motionPathMode:t,motionPathClipId:t&&s||null})},setKeyframeEditorOpen:t=>{r({keyframeEditorOpen:t})},toggleKeyframeEditor:()=>{r(t=>({keyframeEditorOpen:!t.keyframeEditorOpen}))},setShowWelcomeScreen:t=>{r({showWelcomeScreen:t})},setSkipWelcomeScreen:t=>{r({skipWelcomeScreen:t,showWelcomeScreen:t?!1:e().showWelcomeScreen})}}),{name:"openreel-ui-preferences",partialize:r=>({snapSettings:r.snapSettings,panels:r.panels,shortcuts:r.shortcuts,theme:r.theme,showWaveforms:r.showWaveforms,showThumbnails:r.showThumbnails,showKeyframes:r.showKeyframes,autoScroll:r.autoScroll,skipWelcomeScreen:r.skipWelcomeScreen})}))),r7=[{id:"transform",name:"Transform",category:"Position & Size",keywords:["position","scale","rotate","move","resize","transform"],icon:aa,description:"Position, scale, and rotate the clip",sectionId:"transform",clipTypes:["video","image","text","shape"]},{id:"crop",name:"Crop",category:"Position & Size",keywords:["crop","cut","trim","frame","aspect"],icon:OL,description:"Crop and frame the clip",sectionId:"crop",clipTypes:["video","image"]},{id:"speed",name:"Speed Control",category:"Time",keywords:["speed","slow","fast","time","duration","playback"],icon:ui,description:"Control playback speed and time remapping",sectionId:"speed",clipTypes:["video","audio"]},{id:"video-effects",name:"Video Effects",category:"Video",keywords:["brightness","contrast","saturation","blur","sharpen","vignette","effects"],icon:Nh,description:"Brightness, contrast, saturation, blur, sharpen",sectionId:"video-effects",clipTypes:["video","image"]},{id:"color-grading",name:"Color Grading",category:"Video",keywords:["color","grade","wheels","curves","lut","hsl","exposure","temperature"],icon:Vd,description:"Color wheels, curves, LUTs, and HSL adjustments",sectionId:"color-grading",clipTypes:["video","image"]},{id:"green-screen",name:"Green Screen",category:"Video",keywords:["green","screen","chroma","key","background","remove"],icon:Ur,description:"Chroma key for green/blue screen removal",sectionId:"green-screen",clipTypes:["video","image"]},{id:"background-removal",name:"Background Removal",category:"Video",keywords:["background","remove","ai","mask","cutout","person"],icon:N$,description:"AI-powered background removal",sectionId:"background-removal",clipTypes:["video","image"]},{id:"masking",name:"Masking",category:"Video",keywords:["mask","shape","feather","reveal","hide","vignette"],icon:zs,description:"Shape masks to reveal or hide areas",sectionId:"masking",clipTypes:["video","image"]},{id:"motion-tracking",name:"Motion Tracking",category:"Video",keywords:["motion","track","follow","pin","stabilize"],icon:aa,description:"Track motion and attach elements",sectionId:"motion-tracking",clipTypes:["video"]},{id:"pip",name:"Picture-in-Picture",category:"Video",keywords:["pip","picture","overlay","corner","position"],icon:is,description:"Position clips as picture-in-picture overlays",sectionId:"pip",clipTypes:["video","image"]},{id:"blending",name:"Blend Mode",category:"Video",keywords:["blend","mode","multiply","screen","overlay","opacity"],icon:zs,description:"Blend modes and opacity controls",sectionId:"blending",clipTypes:["video","image"]},{id:"transform-3d",name:"3D Transform",category:"Video",keywords:["3d","perspective","rotate","flip","tilt"],icon:aa,description:"3D rotation and perspective effects",sectionId:"transform-3d",clipTypes:["video","image"]},{id:"keyframes",name:"Keyframes",category:"Animation",keywords:["keyframe","animate","animation","ease","interpolate"],icon:ci,description:"Animate properties over time",sectionId:"keyframes",clipTypes:["video","image","text","shape"]},{id:"transitions",name:"Transitions",category:"Animation",keywords:["transition","fade","dissolve","wipe","slide"],icon:ci,description:"Clip-to-clip transitions",sectionId:"transitions",clipTypes:["video","image"]},{id:"motion-presets",name:"Motion Presets",category:"Animation",keywords:["motion","preset","zoom","pan","shake","bounce"],icon:ci,description:"Pre-built motion animations",sectionId:"motion-presets",clipTypes:["video","image"]},{id:"audio-effects",name:"Audio Effects",category:"Audio",keywords:["audio","eq","equalizer","compressor","reverb","delay","sound"],icon:A0,description:"EQ, compressor, reverb, and more",sectionId:"audio-effects",clipTypes:["audio","video"]},{id:"audio-ducking",name:"Audio Ducking",category:"Audio",keywords:["duck","ducking","voice","music","fade","auto"],icon:A0,description:"Auto-duck music under voice",sectionId:"audio-ducking",clipTypes:["audio","video"]},{id:"text-properties",name:"Text Properties",category:"Text",keywords:["text","font","size","color","style","typography"],icon:Os,description:"Font, size, color, and text styling",sectionId:"text-properties",clipTypes:["text"]},{id:"text-animation",name:"Text Animation",category:"Text",keywords:["text","animate","typewriter","fade","slide","bounce"],icon:Os,description:"Animate text with presets",sectionId:"text-animation",clipTypes:["text"]},{id:"shape-properties",name:"Shape Properties",category:"Shapes",keywords:["shape","fill","stroke","corner","radius","shadow"],icon:is,description:"Shape fill, stroke, and effects",sectionId:"shape-properties",clipTypes:["shape"]}],n7=[{id:"all",name:"All"},{id:"video",name:"Video",icon:Uc},{id:"audio",name:"Audio",icon:A0},{id:"text",name:"Text",icon:Os},{id:"animation",name:"Animation",icon:ci}],a7=({isOpen:r,onClose:e})=>{const[t,s]=v.useState(""),[i,n]=v.useState("all"),[a,o]=v.useState(0),l=v.useRef(null),d=v.useRef(null),{selectedItems:u,setPanelVisible:h}=Ft(),p=v.useMemo(()=>{const g=u.find(y=>y.type==="clip"||y.type==="text-clip"||y.type==="shape-clip");return g?g.type==="text-clip"?"text":g.type==="shape-clip"?"shape":"video":null},[u]),f=v.useMemo(()=>{let g=r7;if(p&&(g=g.filter(y=>y.clipTypes.includes(p))),i!=="all"&&(g=g.filter(y=>y.category.toLowerCase().includes(i.toLowerCase()))),t.trim()){const y=t.toLowerCase().split(" ");g=g.filter(x=>{const b=[x.name,x.description,...x.keywords,x.category].join(" ").toLowerCase();return y.every(w=>b.includes(w))})}return g},[t,i,p]),m=v.useCallback(g=>{h("inspector",!0),setTimeout(()=>{const y=document.querySelector(`[data-section-id="${g.sectionId}"]`);if(y){y.scrollIntoView({behavior:"smooth",block:"start"});const x=y.querySelector("button");x&&x.click(),y.classList.add("ring-2","ring-primary","ring-offset-2"),setTimeout(()=>{y.classList.remove("ring-2","ring-primary","ring-offset-2")},2e3)}},100),e()},[e,h]);return v.useEffect(()=>{r&&l.current&&l.current.focus()},[r]),v.useEffect(()=>{o(0)},[t,i]),v.useEffect(()=>{if(!r)return;const g=y=>{y.key==="Escape"?e():y.key==="ArrowDown"?(y.preventDefault(),o(x=>Math.min(x+1,f.length-1))):y.key==="ArrowUp"?(y.preventDefault(),o(x=>Math.max(x-1,0))):y.key==="Enter"&&f[a]&&(y.preventDefault(),m(f[a]))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[r,e,f,a,m]),v.useEffect(()=>{if(d.current&&f[a]){const g=d.current.children[a];g&&g.scrollIntoView({behavior:"smooth",block:"nearest"})}},[a,f]),r?c.jsx(Ta,{open:!0,onOpenChange:g=>!g&&e(),children:c.jsxs(Sn,{className:"max-w-2xl p-0 gap-0 top-[15vh] translate-y-0 bg-background-secondary border-border rounded-2xl overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-border",children:[c.jsx(jo,{size:18,className:"text-text-muted"}),c.jsx(Ms,{ref:l,type:"text",value:t,onChange:g=>s(g.target.value),placeholder:p?`Search effects for ${p} clip...`:"Search all effects and tools...",className:"flex-1 bg-transparent border-0 text-text-primary focus-visible:ring-0"}),t&&c.jsx("button",{onClick:()=>s(""),className:"p-1 rounded hover:bg-background-tertiary text-text-muted hover:text-text-primary transition-colors",children:c.jsx(Zs,{size:14})}),c.jsx("div",{className:"flex items-center gap-1 px-2 py-1 rounded bg-background-tertiary border border-border",children:c.jsx("span",{className:"text-[10px] text-text-muted",children:"ESC"})})]}),c.jsx("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border bg-background-tertiary/50",children:n7.map(g=>c.jsx("button",{onClick:()=>n(g.id),className:`px-3 py-1.5 rounded-lg text-[11px] font-medium transition-all ${i===g.id?"bg-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:g.name},g.id))}),c.jsx("div",{ref:d,className:"max-h-[50vh] overflow-y-auto",children:f.length===0?c.jsxs("div",{className:"py-12 text-center",children:[c.jsx(jo,{size:32,className:"mx-auto mb-3 text-text-muted opacity-50"}),c.jsx("p",{className:"text-sm text-text-muted",children:"No effects found"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Try a different search term or category"})]}):c.jsx("div",{className:"py-2",children:f.map((g,y)=>{const x=g.icon;return c.jsxs("button",{onClick:()=>m(g),className:`w-full flex items-center gap-4 px-4 py-3 text-left transition-all ${y===a?"bg-primary/10 border-l-2 border-primary":"hover:bg-background-tertiary border-l-2 border-transparent"}`,children:[c.jsx("div",{className:`p-2 rounded-lg ${y===a?"bg-primary text-white":"bg-background-tertiary text-text-secondary"}`,children:c.jsx(x,{size:16})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:`text-sm font-medium ${y===a?"text-primary":"text-text-primary"}`,children:g.name}),c.jsx("span",{className:"text-[10px] text-text-muted px-1.5 py-0.5 rounded bg-background-tertiary",children:g.category})]}),c.jsx("p",{className:"text-xs text-text-muted mt-0.5 truncate",children:g.description})]}),c.jsx("div",{className:"text-[10px] text-text-muted",children:" to select"})]},g.id)})})}),c.jsxs("div",{className:"px-4 py-2 border-t border-border bg-background-tertiary/50 flex items-center justify-between",children:[c.jsxs("div",{className:"text-[10px] text-text-muted",children:[f.length," effect",f.length!==1?"s":""," available"]}),c.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-muted",children:[c.jsx("span",{children:" Navigate"}),c.jsx("span",{children:" Select"}),c.jsx("span",{children:"ESC Close"})]})]})]})}):null};function o7(){const[r,e]=v.useState(!1);return v.useEffect(()=>{const t=()=>{const s=navigator.userAgent.toLowerCase(),n=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i.test(s),a=window.innerWidth<768;e(n||a)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),r?c.jsx("div",{className:"fixed inset-0 z-[9999] bg-background flex items-center justify-center p-6",children:c.jsxs("div",{className:"max-w-md text-center space-y-8",children:[c.jsx("div",{className:"flex justify-center",children:c.jsx("div",{className:"bg-background-secondary border-2 border-primary/30 rounded-2xl p-8 shadow-glow-lg",children:c.jsx(ki,{className:"w-20 h-20 text-primary",strokeWidth:1.5})})}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("h1",{className:"text-5xl font-bold text-text-primary tracking-tight",children:"OpenReel"}),c.jsxs("div",{className:"flex items-center justify-center gap-2",children:[c.jsx("div",{className:"h-px w-8 bg-primary/50"}),c.jsx("p",{className:"text-lg text-text-secondary font-medium",children:"Desktop Only"}),c.jsx("div",{className:"h-px w-8 bg-primary/50"})]})]}),c.jsxs("div",{className:"space-y-4 bg-background-secondary/50 backdrop-blur-sm rounded-xl p-6 border border-border",children:[c.jsx("p",{className:"text-base text-text-primary leading-relaxed",children:"OpenReel is a professional video editor that requires a desktop or laptop computer."}),c.jsx("p",{className:"text-sm text-text-muted",children:"Please visit this page on your desktop or laptop to start creating amazing videos."})]}),c.jsx("div",{className:"pt-2",children:c.jsx("a",{href:"https://openreel.video",className:"inline-flex items-center gap-2 px-8 py-3 bg-primary hover:bg-primary-hover active:bg-primary-active text-white font-medium rounded-lg transition-all duration-200 shadow-glow hover:shadow-glow-lg transform hover:scale-[1.02] active:scale-[0.98]",children:"Learn More"})})]})}):null}const c7="https://openreel-cloud.niiyeboah1996.workers.dev";class l7{apiUrl;constructor(e=c7){this.apiUrl=e}async listTemplates(){try{const e=await fetch(`${this.apiUrl}/templates`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).templates||[]}catch(e){return console.error("Failed to list templates from cloud:",e),[]}}async getTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates/${e}`);if(!t.ok){if(t.status===404)return null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Failed to get template ${e} from cloud:`,t),null}}async uploadTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await t.json();return t.ok?{success:!0}:{success:!1,error:s.error||"Upload failed"}}catch(t){return console.error("Failed to upload template to cloud:",t),{success:!1,error:t instanceof Error?t.message:"Upload failed"}}}async deleteTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates/${e}`,{method:"DELETE"}),s=await t.json();return t.ok?{success:!0}:{success:!1,error:s.error||"Delete failed"}}catch(t){return console.error(`Failed to delete template ${e} from cloud:`,t),{success:!1,error:t instanceof Error?t.message:"Delete failed"}}}async checkHealth(){try{return(await fetch(`${this.apiUrl}/health`)).ok}catch{return!1}}async listScriptableTemplates(){try{const e=await fetch(`${this.apiUrl}/templates/scriptable`);return e.ok?(await e.json()).templates||[]:[]}catch(e){return console.error("Failed to list scriptable templates from cloud:",e),[]}}async getScriptableTemplate(e){try{const t=await fetch(`${this.apiUrl}/templates/scriptable/${e}`);if(!t.ok){if(t.status===404)return null;throw new Error(`HTTP error! status: ${t.status}`)}return await t.json()}catch(t){return console.error(`Failed to get scriptable template ${e} from cloud:`,t),null}}}const d7=new l7,m2={tiktok:bi,"instagram-reels":bi,"instagram-stories":bi,"instagram-post":is,"youtube-shorts":bi,"youtube-video":ki,facebook:j$,twitter:VB,linkedin:XB,pinterest:k0,intro:ti,outro:ti,promo:fa,"lower-third":Os,slideshow:zs,custom:Vc,all:$x},u7=["TikTok","Instagram","YouTube","General"],ph={TikTok:["tiktok"],Instagram:["instagram-reels","instagram-stories","instagram-post"],YouTube:["youtube-shorts","youtube-video"],General:["intro","outro","promo","lower-third","slideshow","custom"]},h7=({selectedCategory:r,onSelectCategory:e,categoryStats:t})=>{const[s,i]=Ye.useState(null),n=a=>{if(s===a)i(null);else{i(a);const o=ph[a];o&&o.length===1&&e(o[0])}};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:[c.jsxs("button",{onClick:()=>{e("all"),i(null)},className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-all duration-200 ${r==="all"?"bg-primary text-black":"bg-background-tertiary text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:[c.jsx($x,{size:14}),"All",c.jsx("span",{className:`text-xs ${r==="all"?"text-black/60":"text-text-muted"}`,children:t.all||0})]}),u7.map(a=>{const o=ph[a],l=s===a,d=o.includes(r),u=m2[o[0]]||is,h=o.reduce((p,f)=>p+(t[f]||0),0);return c.jsxs("button",{onClick:()=>n(a),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-all duration-200 ${d||l?"bg-primary text-black":"bg-background-tertiary text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:[c.jsx(u,{size:14}),a,h>0&&c.jsx("span",{className:`text-xs ${d||l?"text-black/60":"text-text-muted"}`,children:h})]},a)})]}),s&&ph[s].length>1&&c.jsx("div",{className:"flex items-center gap-2 pl-2 overflow-x-auto pb-1",children:ph[s].map(a=>{const o=pM.find(u=>u.id===a),l=t[a]||0,d=m2[a]||is;return c.jsxs("button",{onClick:()=>e(a),className:`flex items-center gap-2 px-3 py-1.5 rounded-md text-xs font-medium whitespace-nowrap transition-all duration-200 ${r===a?"bg-primary/20 text-primary border border-primary/30":"bg-background text-text-muted hover:text-text-secondary hover:bg-background-tertiary"}`,children:[c.jsx(d,{size:12}),o?.name||a,l>0&&c.jsx("span",{className:`text-[10px] ${r===a?"text-primary/70":"text-text-muted"}`,children:l})]},a)})})]})},p7={tiktok:bi,"instagram-reels":bi,"instagram-stories":bi,"instagram-post":is,"youtube-shorts":bi,"youtube-video":ki,facebook:is,twitter:ki,linkedin:ki,pinterest:bi,intro:ti,outro:ti,promo:fa,"lower-third":ki,slideshow:zs,custom:is},f7={tiktok:"from-pink-500 to-cyan-500","instagram-reels":"from-purple-500 to-pink-500","instagram-stories":"from-amber-500 to-pink-500","instagram-post":"from-purple-500 to-pink-500","youtube-shorts":"from-red-500 to-orange-500","youtube-video":"from-red-600 to-red-400",facebook:"from-blue-600 to-blue-400",twitter:"from-sky-500 to-blue-500",linkedin:"from-blue-700 to-blue-500",pinterest:"from-red-500 to-rose-400",intro:"from-emerald-500 to-green-500",outro:"from-green-500 to-emerald-500",promo:"from-amber-500 to-orange-500","lower-third":"from-emerald-500 to-teal-500",slideshow:"from-teal-500 to-cyan-500",custom:"from-zinc-500 to-zinc-400"},m7=({template:r,onClick:e})=>{const[t,s]=v.useState(!1),i=r.socialCategory||"custom",n=Ap[i],a=n&&n.height>n.width,o=p7[i]||is,l=f7[i]||"from-primary to-emerald-500",d=u=>{if(u<60)return`${u}s`;const h=Math.floor(u/60),p=u%60;return p>0?`${h}m ${p}s`:`${h}m`};return c.jsxs("button",{onClick:e,onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),className:"group relative flex flex-col rounded-xl bg-background-tertiary border border-border overflow-hidden transition-all duration-200 hover:bg-background-elevated hover:border-border-hover hover:shadow-lg hover:-translate-y-0.5",children:[c.jsxs("div",{className:`relative flex items-center justify-center overflow-hidden ${a?"aspect-[9/16] max-h-48":"aspect-video"}`,children:[r.thumbnailUrl?c.jsx("img",{src:r.thumbnailUrl,alt:r.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}):c.jsx("div",{className:`w-full h-full bg-gradient-to-br ${l} opacity-40 flex items-center justify-center`,children:c.jsx(o,{size:32,className:"text-text-primary opacity-60 group-hover:opacity-80 transition-all duration-200"})}),c.jsx("div",{className:`absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent transition-opacity duration-200 ${t?"opacity-100":"opacity-0"}`}),r.previewVideoUrl&&t&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:c.jsx("div",{className:"w-11 h-11 rounded-full bg-background/80 backdrop-blur-sm flex items-center justify-center border border-border",children:c.jsx(ti,{size:18,className:"text-text-primary ml-0.5",fill:"currentColor"})})}),r.featured&&c.jsxs("div",{className:"absolute top-2 left-2 px-2 py-0.5 bg-amber-500 text-black text-[10px] font-semibold rounded-full flex items-center gap-1",children:[c.jsx(fa,{size:10,fill:"currentColor"}),"Featured"]}),r.premium&&c.jsxs("div",{className:"absolute top-2 right-2 px-2 py-0.5 bg-primary text-black text-[10px] font-semibold rounded-full flex items-center gap-1",children:[c.jsx(CL,{size:10}),"Pro"]})]}),c.jsxs("div",{className:"p-3 text-left",children:[c.jsx("h3",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:r.name}),c.jsxs("div",{className:"flex items-center gap-3 mt-1.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] text-text-muted",children:[c.jsx(ui,{size:11}),c.jsx("span",{children:d(r.timeline.duration)})]}),c.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] text-text-muted",children:[c.jsx(zs,{size:11}),c.jsxs("span",{children:[r.placeholders.length," editable"]})]})]}),r.tags.length>0&&c.jsxs("div",{className:"flex items-center gap-1.5 mt-2 overflow-hidden",children:[r.tags.slice(0,2).map(u=>c.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-background rounded text-text-muted",children:u},u)),r.tags.length>2&&c.jsxs("span",{className:"text-[10px] text-text-muted",children:["+",r.tags.length-2]})]})]})]})};function ff(){const r=$D(),e=v.useCallback((s,i)=>{r&&r.capture(s,i)},[r]),t=v.useCallback((s,i)=>{r&&r.identify(s,i)},[r]);return{track:e,identify:t,isEnabled:!!r}}const Nc={PROJECT_CREATED:"project_created",PROJECT_OPENED:"project_opened",PROJECT_EXPORTED:"project_exported",CLIP_ADDED:"clip_added",TEXT_ADDED:"text_added",EFFECT_APPLIED:"effect_applied",PARTICLE_EFFECT_ADDED:"particle_effect_added",TEMPLATE_USED:"template_used"},g7={text:Os,media:Eo,subtitle:Os,shape:zs,effect:Nh,transform:Nh,keyframe:Nh,color:Vd,number:XL,boolean:y$,audio:Gr,style:Vd,font:Os,animation:ti},y7=({template:r,onClose:e,onApply:t})=>{const s=fe(w=>w.getTemplateEngine),i=fe(w=>w.getTitleEngine),n=W(w=>w.loadProject),{track:a}=ff(),[o,l]=v.useState({}),[d,u]=v.useState(!1),[h,p]=v.useState(null),[f,m]=v.useState(!1),g=v.useMemo(()=>{const w={main:[],advanced:[]};for(const C of r.placeholders)C.uiHints?.advanced?w.advanced.push(C):w.main.push(C);return w},[r.placeholders]),y=v.useCallback((w,C,k)=>{l(S=>({...S,[w]:{type:k,value:C}}))},[]),x=v.useCallback(async()=>{u(!0),p(null);try{const w=await s(),C=i(),k={...o};for(const j of r.placeholders)!k[j.id]&&j.defaultValue!==void 0&&(k[j.id]={type:j.type,value:j.defaultValue});const{project:S,result:A,textClips:T}=w.applyScriptableTemplate(r,k);if(!A.success&&A.errors.length>0){p(A.errors.map(j=>j.message).join(", ")),u(!1);return}if(C&&T.length>0)for(const j of T){const _=r.placeholders.find(P=>P.id===j.placeholderId),M=_?.label?.toLowerCase().includes("title")||_?.label?.toLowerCase().includes("headline");C.createTextClip({id:j.id,trackId:j.trackId,text:j.text,startTime:j.startTime,duration:j.duration,style:{fontFamily:"Inter",fontSize:M?48:32,fontWeight:600,fontStyle:"normal",color:"#ffffff",textAlign:"center",verticalAlign:"middle",letterSpacing:0,lineHeight:1.2},transform:j.transform,animation:{preset:"fade",params:{easing:"ease-out"},inDuration:.5,outDuration:.3}})}n({...S,modifiedAt:Date.now()}),a(Nc.TEMPLATE_USED,{templateId:r.id,templateName:r.name,category:r.category,placeholderCount:r.placeholders.length}),t()}catch(w){p(w instanceof Error?w.message:"Failed to apply template")}finally{u(!1)}},[s,i,n,r,o,t,a]),b=w=>{if(w<60)return`${w}s`;const C=Math.floor(w/60),k=w%60;return k>0?`${C}m ${k}s`:`${C}m`};return c.jsx(Ta,{open:!0,onOpenChange:w=>!w&&e(),children:c.jsxs(Sn,{className:"max-w-3xl max-h-[90vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsxs(Aa,{className:"p-5 border-b border-border space-y-0 shrink-0",children:[c.jsx(ja,{className:"text-lg font-semibold text-text-primary",children:r.name}),c.jsx(ku,{asChild:!0,children:c.jsxs("div",{className:"flex items-center gap-4 mt-1.5",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-muted",children:[c.jsx(ui,{size:12}),c.jsx("span",{children:b(r.timeline.duration)})]}),c.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-text-muted",children:[c.jsx(zs,{size:12}),c.jsxs("span",{children:[r.placeholders.length," editable fields"]})]})]})})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:c.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("div",{className:"aspect-video bg-background rounded-xl overflow-hidden mb-4 border border-border",children:r.thumbnailUrl?c.jsx("img",{src:r.thumbnailUrl,alt:r.name,className:"w-full h-full object-cover"}):c.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 to-emerald-500/20 flex items-center justify-center",children:c.jsx(ti,{size:40,className:"text-text-muted"})})}),r.description&&c.jsx("p",{className:"text-sm text-text-secondary mb-4",children:r.description}),r.scenes&&r.scenes.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("h3",{className:"text-xs font-medium text-text-muted uppercase tracking-wide",children:"Scenes"}),c.jsx("div",{className:"flex flex-wrap gap-2",children:r.scenes.map(w=>c.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-background-tertiary rounded-lg text-xs border border-border",children:[c.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:w.color||"#22c55e"}}),c.jsx("span",{className:"text-text-secondary",children:w.label}),c.jsxs("span",{className:"text-text-muted",children:["(",b(w.endTime-w.startTime),")"]})]},w.id))})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("h3",{className:"text-sm font-medium text-text-primary",children:"Customize Template"}),g.main.length>0&&c.jsx("div",{className:"space-y-4",children:g.main.map(w=>c.jsx(g2,{placeholder:w,value:o[w.id]?.value,onChange:C=>y(w.id,C,w.type)},w.id))}),g.advanced.length>0&&c.jsxs(Xd,{open:f,onOpenChange:m,children:[c.jsxs(Cp,{className:"text-xs text-text-muted cursor-pointer hover:text-text-secondary transition-colors flex items-center gap-1",children:[c.jsx(Js,{size:12,className:`transition-transform ${f?"rotate-90":""}`}),"Advanced Options (",g.advanced.length,")"]}),c.jsx(Kd,{className:"mt-4 space-y-4 pl-4 border-l border-border",children:g.advanced.map(w=>c.jsx(g2,{placeholder:w,value:o[w.id]?.value,onChange:C=>y(w.id,C,w.type)},w.id))})]}),h&&c.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:c.jsx("p",{className:"text-sm text-red-400",children:h})})]})]})}),c.jsxs("div",{className:"p-5 border-t border-border flex items-center justify-end gap-3 shrink-0",children:[c.jsx(Et,{variant:"ghost",onClick:e,children:"Cancel"}),c.jsx(Et,{onClick:x,disabled:d,className:"shadow-glow",children:d?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-4 h-4 border-2 border-black/30 border-t-black rounded-full animate-spin"}),"Applying..."]}):c.jsxs(c.Fragment,{children:["Use Template",c.jsx(Js,{size:16})]})})]})]})})},g2=({placeholder:r,value:e,onChange:t})=>{const s=g7[r.type]||Os,i=e??r.defaultValue??"",n=()=>{switch(r.type){case"text":case"subtitle":{const a=r.constraints?.maxLength;return c.jsxs("div",{className:"space-y-1",children:[c.jsx("textarea",{value:String(i),onChange:o=>t(o.target.value),maxLength:a,rows:2,placeholder:String(r.defaultValue||""),className:"w-full px-3 py-2.5 text-sm bg-background-tertiary border border-border rounded-lg focus:border-primary focus:outline-none text-text-primary placeholder:text-text-muted resize-none transition-colors"}),a&&c.jsxs("p",{className:"text-[10px] text-text-muted text-right",children:[String(i).length,"/",a]})]})}case"number":{const a=r.constraints?.min??0,o=r.constraints?.max??100,l=r.constraints?.step||1;return r.uiHints?.inputType==="slider"?c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(st,{value:[Number(i)||0],onValueChange:u=>t(u[0]),min:a,max:o,step:l,className:"flex-1"}),c.jsx("span",{className:"text-xs text-text-muted w-12 text-right font-mono",children:Number(i).toFixed(l<1?1:0)})]}):c.jsx(Ms,{type:"number",value:Number(i)||0,onChange:u=>t(Number(u.target.value)),min:a,max:o,step:l,className:"bg-background-tertiary border-border text-text-primary"})}case"boolean":return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(ya,{checked:!!i,onCheckedChange:a=>t(a)}),c.jsx(ts,{className:"text-sm text-text-secondary cursor-pointer",children:r.description||"Enabled"})]});case"color":return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("input",{type:"color",value:String(i)||"#000000",onChange:a=>t(a.target.value),className:"w-10 h-10 rounded-lg cursor-pointer border border-border"}),c.jsx(Ms,{type:"text",value:String(i)||"#000000",onChange:a=>t(a.target.value),placeholder:"#000000",className:"flex-1 bg-background-tertiary border-border text-text-primary font-mono"})]});default:return c.jsx(Ms,{type:"text",value:String(i),onChange:a=>t(a.target.value),placeholder:String(r.defaultValue||""),className:"bg-background-tertiary border-border text-text-primary"})}};return c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"flex items-center gap-2",children:[c.jsx(s,{size:14,className:"text-text-muted"}),c.jsx("span",{className:"text-sm font-medium text-text-primary",children:r.label}),r.required&&c.jsx("span",{className:"text-red-400 text-xs",children:"*"})]}),r.description&&r.type!=="boolean"&&c.jsx("p",{className:"text-xs text-text-muted",children:r.description}),n()]})},x7=({onTemplateApplied:r})=>{const e=fe(w=>w.getTemplateEngine),[t,s]=v.useState([]),[i,n]=v.useState(!0),[a,o]=v.useState(""),[l,d]=v.useState("all"),[u,h]=v.useState(null),[p,f]=v.useState(!1);v.useEffect(()=>{(async()=>{n(!0);try{const C=await e();await C.initialize();const k=C.getBuiltinTemplates(),S=await d7.listScriptableTemplates(),A=[...k.map(j=>{const _=new Map;for(const M of j.timeline.tracks)for(const P of M.clips){const R=P;R.isPlaceholder&&R.placeholderId&&_.set(R.placeholderId,{clipId:P.id,trackId:M.id})}return{...j,placeholders:j.placeholders.map(M=>{const P=_.get(M.id);return{...M,targets:P?[{clipId:P.clipId,trackId:P.trackId,property:"content"}]:[],defaultValue:M.defaultValue}}),socialCategory:b7(j.category)}}),...S],T=Array.from(new Map(A.map(j=>[j.id,j])).values());s(T)}catch(C){console.error("Failed to load templates:",C)}finally{n(!1)}})()},[e]);const m=v.useMemo(()=>{let w=t;if(l!=="all"&&(w=w.filter(C=>C.socialCategory===l||C.category===l)),a.trim()){const C=a.toLowerCase();w=w.filter(k=>k.name.toLowerCase().includes(C)||k.description.toLowerCase().includes(C)||k.tags.some(S=>S.toLowerCase().includes(C)))}return w},[t,l,a]),g=v.useCallback(w=>{h(w),f(!0)},[]),y=v.useCallback(()=>{f(!1),h(null)},[]),x=v.useCallback(()=>{y(),r?.()},[y,r]),b=v.useMemo(()=>{const w={all:t.length};for(const C of pM)w[C.id]=t.filter(k=>k.socialCategory===C.id||k.category===C.id).length;return w},[t]);return i?c.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute inset-0 bg-primary/20 rounded-full blur-xl"}),c.jsx(Ci,{className:"relative w-10 h-10 text-primary animate-spin"})]}),c.jsx("p",{className:"text-sm text-text-muted mt-6",children:"Loading templates..."})]}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex items-center gap-4",children:c.jsxs("div",{className:"relative flex-1 max-w-md",children:[c.jsx(jo,{size:18,className:"absolute left-4 top-1/2 -translate-y-1/2 text-text-muted z-10"}),c.jsx(Ms,{type:"text",value:a,onChange:w=>o(w.target.value),placeholder:"Search templates...",className:"pl-11 bg-background-tertiary border-border rounded-xl text-text-primary"})]})}),c.jsx(h7,{selectedCategory:l,onSelectCategory:d,categoryStats:b}),m.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-background-tertiary flex items-center justify-center mb-4",children:c.jsx(zs,{size:24,className:"text-text-muted"})}),c.jsx("p",{className:"text-base font-medium text-text-primary mb-1",children:"No templates found"}),c.jsx("p",{className:"text-sm text-text-muted",children:"Try adjusting your search or filter"})]}):c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:m.map(w=>c.jsx(m7,{template:w,onClick:()=>g(w)},w.id))}),p&&u&&c.jsx(y7,{template:u,onClose:y,onApply:x})]})};function b7(r){return{"social-media":"tiktok",youtube:"youtube-video",tiktok:"tiktok",instagram:"instagram-reels",business:"promo",personal:"custom",slideshow:"slideshow","intro-outro":"intro","lower-third":"lower-third",custom:"custom"}[r]||"custom"}const v7=({onProjectSelected:r})=>{const[e,t]=v.useState([]),[s,i]=v.useState(!0),[n,a]=v.useState(null),o=W(p=>p.recoverFromAutoSave),{track:l}=ff();v.useEffect(()=>{async function p(){try{const f=await OX(),m=new Map;for(const y of f)m.has(y.projectId)||m.set(y.projectId,y);const g=Array.from(m.values()).sort((y,x)=>x.timestamp-y.timestamp).slice(0,10).map(y=>({id:y.projectId,saveId:y.id,name:y.projectName,lastModified:y.timestamp}));t(g)}catch(f){console.error("Failed to load recent projects:",f)}finally{i(!1)}}p()},[]);const d=v.useCallback(async p=>{a(p.id);try{await o(p.saveId)&&(l(Nc.PROJECT_OPENED,{source:"recent_projects"}),r?.())}catch(f){console.error("Failed to load project:",f)}finally{a(null)}},[o,r,l]),u=v.useCallback((p,f)=>{f.stopPropagation(),t(m=>m.filter(g=>g.id!==p))},[]),h=p=>{const f=new Date(p),g=Math.floor((new Date().getTime()-f.getTime())/(1e3*60*60*24));return g===0?"Today":g===1?"Yesterday":g<7?`${g} days ago`:g<30?`${Math.floor(g/7)} weeks ago`:f.toLocaleDateString()};return s?c.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-primary/30 border-t-primary rounded-full animate-spin mb-4"}),c.jsx("p",{className:"text-sm text-text-secondary",children:"Loading recent projects..."})]}):e.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-background-tertiary flex items-center justify-center mb-4",children:c.jsx(ui,{size:24,className:"text-text-muted"})}),c.jsx("h3",{className:"text-base font-medium text-text-primary mb-2",children:"No Recent Projects"}),c.jsx("p",{className:"text-sm text-text-muted text-center max-w-md",children:"Your recently opened projects will appear here. Start a new project or use a template to get started."})]}):c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("h3",{className:"text-sm font-medium text-text-primary",children:["Recent Projects (",e.length,")"]})}),c.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:e.map(p=>{const f=n===p.id;return c.jsxs("div",{className:"group relative flex flex-col bg-background-tertiary rounded-xl border border-border hover:border-primary/40 hover:bg-background-elevated transition-all overflow-hidden",children:[c.jsxs("button",{onClick:()=>d(p),disabled:f,className:"flex flex-col flex-1 text-left disabled:opacity-70",children:[c.jsx("div",{className:"aspect-video w-full bg-background flex items-center justify-center border-b border-border",children:f?c.jsx("div",{className:"w-8 h-8 border-2 border-primary/30 border-t-primary rounded-full animate-spin"}):c.jsx(pa,{size:32,className:"text-text-muted/50 group-hover:text-primary/50 transition-colors"})}),c.jsxs("div",{className:"p-3 flex-1",children:[c.jsx("h4",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:p.name}),c.jsxs("div",{className:"flex items-center gap-1.5 mt-1.5 text-xs text-text-muted",children:[c.jsx(ui,{size:11}),c.jsx("span",{children:h(p.lastModified)})]})]})]}),c.jsx("button",{onClick:m=>u(p.id,m),className:"absolute top-2 right-2 p-1.5 text-text-muted hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all rounded-lg bg-background/80 hover:bg-red-500/10 backdrop-blur-sm",title:"Remove from recent",children:c.jsx(Ss,{size:14})})]},p.id)})}),c.jsx("p",{className:"text-xs text-text-muted text-center",children:"Recent projects are stored locally in your browser"})]})};function y2(r){const e=r.replace(/^#\/?/,""),[t,s]=e.split("?"),i={};s&&new URLSearchParams(s).forEach((d,u)=>{i[u]=d});const n=t.split("/");let a=n[0]||"welcome";const o=["welcome","editor","new","templates","recent","share"];return a==="share"&&n[1]&&(i.shareId=n[1]),{route:o.includes(a)?a:"welcome",params:i}}function hg(r,e){let t=`#/${r}`;if(e&&Object.keys(e).length>0){const s=new URLSearchParams;Object.entries(e).forEach(([n,a])=>{a!=null&&s.set(n,String(a))});const i=s.toString();i&&(t+=`?${i}`)}return t}function Jb(){const[r,e]=v.useState(()=>typeof window<"u"?y2(window.location.hash):{route:"welcome",params:{}});v.useEffect(()=>{const o=()=>{e(y2(window.location.hash))};return window.addEventListener("hashchange",o),()=>window.removeEventListener("hashchange",o)},[]);const t=v.useCallback((o,l)=>{const d=hg(o,l);window.location.hash=d},[]),s=v.useCallback(o=>{const l=hg(r.route,{...r.params,...o});window.location.hash=l},[r.route,r.params]),i=v.useCallback(()=>{const o=hg(r.route);window.location.hash=o},[r.route]),n=v.useMemo(()=>{const{dimensions:o,width:l,height:d}=r.params;if(o){const u=o.match(/^(\d+)x(\d+)$/i);if(u)return{width:parseInt(u[1],10),height:parseInt(u[2],10)}}return l&&d?{width:parseInt(l,10),height:parseInt(d,10)}:null},[r.params]),a=v.useMemo(()=>{const{fps:o}=r.params;if(o){const l=parseInt(o,10);if(!isNaN(l)&&l>0&&l<=120)return l}return 30},[r.params]);return{route:r.route,params:r.params,navigate:t,updateParams:s,clearParams:i,parsedDimensions:n,fps:a}}let x2=!1;function w7(r){const e=v.useRef(!1);v.useEffect(()=>{if(e.current||x2)return;x2=!0,e.current=!0;const t=()=>{_i(()=>Promise.resolve().then(()=>MZ),void 0)};"requestIdleCallback"in window?window.requestIdleCallback(t,{timeout:2e3}):setTimeout(t,100)},[r])}const k7=[{id:"vertical",preset:"tiktok",label:"Vertical",description:"TikTok, Reels, Shorts",dimensions:"1080  1920",icon:bi,gradient:"from-violet-500/20 to-fuchsia-500/20"},{id:"horizontal",preset:"youtube-video",label:"Horizontal",description:"YouTube, Vimeo, Web",dimensions:"1920  1080",icon:ki,gradient:"from-blue-500/20 to-cyan-500/20"},{id:"square",preset:"instagram-post",label:"Square",description:"Instagram, Facebook",dimensions:"1080  1080",icon:is,gradient:"from-orange-500/20 to-rose-500/20"}],C7=({className:r=""})=>c.jsxs("svg",{viewBox:"0 0 490 490",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:r,children:[c.jsx("path",{d:"M245 24.5C123.223 24.5 24.5 123.223 24.5 245s98.723 220.5 220.5 220.5 220.5-98.723 220.5-220.5S366.777 24.5 245 24.5Z",stroke:"currentColor",strokeWidth:"30.625"}),c.jsxs("g",{children:[c.jsx("path",{d:"M245 98v73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M392 245h-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M245 392v-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M98 245h73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 141.059-51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 348.941-51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 348.941 51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 141.059 51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"})]}),c.jsx("path",{d:"M294 245a49 49 0 0 1-49 49 49 49 0 0 1-49-49 49 49 0 0 1 98 0",fill:"currentColor"})]}),S7=({initialTab:r})=>{const e=Ft(f=>f.setSkipWelcomeScreen),t=Ft(f=>f.skipWelcomeScreen),s=W(f=>f.createNewProject),{navigate:i}=Jb(),{track:n}=ff(),[a,o]=v.useState(r??"home"),[l,d]=v.useState(null);w7(!0);const u=v.useCallback(f=>{const m=Ap[f.preset];s(`New ${f.label} Video`,{width:m.width,height:m.height,frameRate:m.frameRate}),n(Nc.PROJECT_CREATED,{preset:f.preset,width:m.width,height:m.height,frameRate:m.frameRate??30,source:"quick_start"}),i("editor")},[s,i,n]),h=v.useCallback(()=>{i("editor")},[i]),p=v.useCallback(()=>{i("editor")},[i]);return v.useEffect(()=>{t&&i("editor")},[t,i]),v.useEffect(()=>{const f=m=>{m.key==="Escape"&&(a!=="home"?o("home"):i("editor"))};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[i,a]),a==="templates"?c.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col",children:[c.jsxs("header",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[c.jsxs(Et,{variant:"ghost",size:"sm",onClick:()=>o("home"),children:[c.jsx(na,{className:"rotate-180",size:16}),"Back"]}),c.jsx("h2",{className:"text-sm font-medium text-text-primary",children:"Templates"}),c.jsx("div",{className:"w-16"})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c.jsx(x7,{onTemplateApplied:h})})]}):a==="recent"?c.jsxs("div",{className:"fixed inset-0 z-50 bg-background flex flex-col",children:[c.jsxs("header",{className:"flex items-center justify-between px-6 py-4 border-b border-border",children:[c.jsxs(Et,{variant:"ghost",size:"sm",onClick:()=>o("home"),children:[c.jsx(na,{className:"rotate-180",size:16}),"Back"]}),c.jsx("h2",{className:"text-sm font-medium text-text-primary",children:"Recent Projects"}),c.jsx("div",{className:"w-16"})]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:c.jsx(v7,{onProjectSelected:p})})]}):c.jsxs("div",{className:"fixed inset-0 z-50 bg-background overflow-hidden",children:[c.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(34,197,94,0.05),transparent_60%)]"}),c.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_right,rgba(34,197,94,0.03),transparent_50%)]"}),c.jsxs("div",{className:"relative h-full flex flex-col items-center justify-center px-6",children:[c.jsxs("div",{className:"w-full max-w-3xl",children:[c.jsxs("div",{className:"flex flex-col items-center text-center mb-12",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[c.jsx("div",{className:"w-12 h-12 text-primary",children:c.jsx(C7,{className:"w-full h-full"})}),c.jsx("span",{className:"text-xl font-semibold text-text-primary tracking-tight",children:"Open Reel Video"})]}),c.jsx("h1",{className:"text-4xl sm:text-5xl font-bold text-text-primary tracking-tight mb-3",children:"From idea to export."}),c.jsx("p",{className:"text-xl text-text-secondary mb-8",children:"In your browser."}),c.jsx("p",{className:"text-base text-text-muted max-w-md",children:"Pick a format and start creating. You can change this anytime."})]}),c.jsx("div",{className:"grid grid-cols-3 gap-4 mb-10",children:k7.map(f=>{const m=f.icon,g=l===f.id;return c.jsxs("button",{onClick:()=>u(f),onMouseEnter:()=>d(f.id),onMouseLeave:()=>d(null),className:`
                    group relative flex flex-col items-center p-6 rounded-2xl
                    bg-background-secondary border border-border
                    hover:border-primary/40 hover:bg-background-tertiary
                    transition-all duration-200
                    ${g?"scale-[1.02] shadow-lg shadow-primary/5":""}
                  `,children:[c.jsx("div",{className:`
                    absolute inset-0 rounded-2xl bg-gradient-to-br ${f.gradient}
                    opacity-0 group-hover:opacity-100 transition-opacity duration-300
                  `}),c.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[c.jsx("div",{className:`
                      w-16 h-16 mb-4 rounded-xl flex items-center justify-center
                      bg-background-tertiary group-hover:bg-primary/10
                      transition-colors duration-200
                    `,children:c.jsx(m,{size:28,className:"text-text-muted group-hover:text-primary transition-colors"})}),c.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-1",children:f.label}),c.jsx("p",{className:"text-sm text-text-muted mb-3",children:f.description}),c.jsx("span",{className:"text-xs font-mono text-text-muted/70 bg-background-tertiary px-2 py-1 rounded",children:f.dimensions})]}),c.jsxs("div",{className:`
                    absolute bottom-4 left-1/2 -translate-x-1/2
                    flex items-center gap-1 text-sm font-medium text-primary
                    opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0
                    transition-all duration-200
                  `,children:["Start creating",c.jsx(na,{size:14})]})]},f.id)})}),c.jsxs("div",{className:"flex items-center justify-center gap-3",children:[c.jsxs(Et,{variant:"outline",onClick:()=>o("templates"),className:"rounded-xl",children:[c.jsx(zs,{size:16}),"Browse templates"]}),c.jsxs(Et,{variant:"outline",onClick:()=>o("recent"),className:"rounded-xl",children:[c.jsx(ui,{size:16}),"Recent projects"]}),c.jsxs(Et,{variant:"outline",onClick:()=>i("editor"),className:"rounded-xl",children:[c.jsx(Ox,{size:16}),"Open editor"]})]})]}),c.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ya,{id:"skip-welcome",checked:t,onCheckedChange:e}),c.jsx(ts,{htmlFor:"skip-welcome",className:"text-xs text-text-muted cursor-pointer",children:"Skip on startup"})]}),c.jsx("span",{className:"text-text-muted/30",children:""}),c.jsxs("p",{className:"text-xs text-text-muted/60",children:["Press"," ",c.jsx("kbd",{className:"px-1.5 py-0.5 bg-background-tertiary border border-border rounded text-text-muted font-mono text-[10px]",children:"Esc"})," ","to skip"]})]})]})]})};function b2(r){const e=Math.floor((Date.now()-r)/1e3);if(e<60)return"just now";if(e<3600){const s=Math.floor(e/60);return`${s} ${s===1?"minute":"minutes"} ago`}if(e<86400){const s=Math.floor(e/3600);return`${s} ${s===1?"hour":"hours"} ago`}const t=Math.floor(e/86400);return`${t} ${t===1?"day":"days"} ago`}function v2(r){return new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}const T7=({saves:r,onRecover:e,onDismiss:t,onClearAll:s})=>{const[i,n]=v.useState(!1),[a,o]=v.useState(null),[l,d]=v.useState(!1),u=r[0],h=r.slice(1),p=async()=>{s&&(d(!0),await s(),d(!1),t())},f=m=>{o(m),e(m)};return c.jsx(Ta,{open:!0,onOpenChange:m=>!m&&t(),children:c.jsxs(Sn,{className:"max-w-md p-0 gap-0 bg-background-secondary border-border overflow-hidden",children:[c.jsx(Aa,{className:"p-5 border-b border-border space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"p-2.5 bg-primary/10 rounded-xl shrink-0",children:c.jsx($i,{className:"w-5 h-5 text-primary"})}),c.jsxs("div",{children:[c.jsx(ja,{className:"text-base font-semibold text-text-primary",children:"Recover Your Work"}),c.jsx(ku,{className:"text-sm text-text-secondary mt-0.5",children:"We found an unsaved project"})]})]})}),c.jsxs("div",{className:"p-5",children:[c.jsxs("button",{onClick:()=>f(u.id),disabled:a===u.id,className:"w-full bg-background-tertiary rounded-xl border border-border p-4 mb-4 text-left hover:border-primary/50 hover:bg-background-elevated transition-all group disabled:opacity-70",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[c.jsx(no,{className:"w-5 h-5 text-text-muted group-hover:text-primary transition-colors"}),c.jsx("span",{className:"font-medium text-text-primary truncate",children:u.projectName})]}),c.jsxs("div",{className:"flex items-center gap-2 text-sm text-text-muted",children:[c.jsx(ui,{className:"w-4 h-4 shrink-0"}),c.jsxs("span",{children:["Last saved ",b2(u.timestamp)]}),c.jsx("span",{className:"text-text-muted/50",children:""}),c.jsx("span",{className:"text-text-muted/70 truncate",children:v2(u.timestamp)})]})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx(Et,{variant:"outline",onClick:t,className:"flex-1",children:"Start Fresh"}),c.jsx(Et,{onClick:()=>f(u.id),disabled:a===u.id,className:"flex-1",children:a===u.id?"Recovering...":"Recover Project"})]}),h.length>0&&c.jsxs(Xd,{open:i,onOpenChange:n,className:"mt-4 pt-4 border-t border-border",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs(Cp,{className:"flex items-center gap-2 text-sm text-text-muted hover:text-text-secondary transition-colors",children:[c.jsx(ls,{className:`w-4 h-4 transition-transform duration-200 ${i?"rotate-180":""}`}),c.jsxs("span",{children:[h.length," older ",h.length===1?"save":"saves"," available"]})]}),s&&c.jsx("button",{onClick:p,disabled:l,className:"p-1.5 rounded-lg text-text-muted hover:text-red-400 hover:bg-red-500/10 transition-colors disabled:opacity-50",title:"Clear all saved projects",children:c.jsx(Ss,{className:"w-4 h-4"})})]}),c.jsx(Kd,{className:"mt-3 space-y-2 max-h-48 overflow-y-auto pr-1 scrollbar-thin",children:h.map(m=>c.jsx("button",{onClick:()=>f(m.id),disabled:a===m.id,className:"w-full text-left p-3 rounded-lg bg-background-tertiary border border-border hover:border-border-hover hover:bg-background-elevated transition-all group disabled:opacity-70",children:c.jsxs("div",{className:"flex items-center justify-between gap-2",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:m.projectName}),c.jsx("div",{className:"text-xs text-text-muted mt-1",children:v2(m.timestamp)})]}),c.jsx("div",{className:"text-xs text-text-muted/70 shrink-0",children:b2(m.timestamp)})]})},m.id))})]})]})]})})},qP="https://openreel-cloud.niiyeboah1996.workers.dev";async function A7(r){try{const e=await fetch(`${qP}/shares/${r}`);if(e.status===404)return null;if(e.status===410)throw new Error("This share link has expired");if(!e.ok)throw new Error(`Failed to get share info: ${e.status}`);return await e.json()}catch(e){throw e instanceof Error?e:new Error("Failed to get share info")}}function j7(r){return`${qP}/shares/${r}/download`}function _7(r){const e=Date.now(),t=r-e;if(t<=0)return"Expired";const s=Math.floor(t/(1e3*60*60)),i=Math.floor(t%(1e3*60*60)/(1e3*60));return s>0?`${s}h ${i}m remaining`:`${i}m remaining`}function E7(r){return Date.now()>r}const M7=({shareId:r})=>{const[e,t]=v.useState("loading"),[s,i]=v.useState(null),[n,a]=v.useState(null);v.useEffect(()=>{(async()=>{try{const u=await A7(r);if(!u){t("not-found");return}if(E7(u.expiresAt)){t("expired");return}i(u),t("ready")}catch(u){u instanceof Error&&u.message.includes("expired")?t("expired"):(a(u instanceof Error?u.message:"Failed to load share"),t("error"))}})()},[r]);const o=j7(r),l=()=>{window.location.hash="#/editor"};return e==="loading"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-4",children:[c.jsx(Ci,{size:48,className:"text-primary animate-spin mx-auto"}),c.jsx("p",{className:"text-text-muted",children:"Loading video..."})]})}):e==="not-found"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-6 max-w-md px-6",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-text-muted/10 rounded-full flex items-center justify-center",children:c.jsx(To,{size:40,className:"text-text-muted"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Video Not Found"}),c.jsx("p",{className:"text-text-muted mt-2",children:"This video doesn't exist or the link is invalid."})]}),c.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:[c.jsx(S0,{size:18}),"Create Your Own Video"]})]})}):e==="expired"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-6 max-w-md px-6",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-warning/10 rounded-full flex items-center justify-center",children:c.jsx(ui,{size:40,className:"text-warning"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Link Expired"}),c.jsx("p",{className:"text-text-muted mt-2",children:"This share link has expired. Share links are only valid for 24 hours."})]}),c.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:[c.jsx(S0,{size:18}),"Create Your Own Video"]})]})}):e==="error"?c.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center space-y-6 max-w-md px-6",children:[c.jsx("div",{className:"w-20 h-20 mx-auto bg-error/10 rounded-full flex items-center justify-center",children:c.jsx(To,{size:40,className:"text-error"})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:"Error"}),c.jsx("p",{className:"text-text-muted mt-2",children:n||"Something went wrong"})]}),c.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:"Try Again"})]})}):c.jsx("div",{className:"min-h-screen bg-background",children:c.jsxs("div",{className:"max-w-4xl mx-auto px-6 py-12 space-y-8",children:[c.jsxs("div",{className:"text-center space-y-2",children:[c.jsx("h1",{className:"text-2xl font-bold text-text-primary",children:s?.filename||"Shared Video"}),s&&c.jsxs("div",{className:"flex items-center justify-center gap-4 text-sm text-text-muted",children:[c.jsxs("span",{children:[(s.size/(1024*1024)).toFixed(1)," MB"]}),c.jsx("span",{children:""}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(ui,{size:14}),c.jsx("span",{children:_7(s.expiresAt)})]})]})]}),c.jsx("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden shadow-2xl",children:c.jsx("video",{src:o,controls:!0,className:"w-full h-full",poster:"",children:"Your browser does not support the video tag."})}),c.jsxs("div",{className:"flex items-center justify-center gap-4",children:[c.jsxs("a",{href:o,download:s?.filename,className:"inline-flex items-center gap-2 px-6 py-3 bg-primary hover:bg-primary-hover text-white font-bold rounded-lg transition-colors",children:[c.jsx(Lx,{size:18}),"Download"]}),c.jsxs("button",{onClick:l,className:"inline-flex items-center gap-2 px-6 py-3 bg-background-secondary hover:bg-background-tertiary border border-border text-text-primary font-medium rounded-lg transition-colors",children:[c.jsx(ti,{size:18}),"Create Your Own"]})]}),c.jsx("div",{className:"text-center",children:c.jsxs("p",{className:"text-xs text-text-muted",children:["Made with"," ",c.jsx("a",{href:"#/editor",className:"text-primary hover:underline",children:"Open Reel Video"})]})})]})})};function P7(r={}){const{enabled:e=!0}=r,[t,s]=v.useState({isChecking:!e,availableSaves:[],showDialog:!1}),i=W(l=>l.recoverFromAutoSave);v.useEffect(()=>{if(!e)return;(async()=>{try{await er.initialize();const d=await er.checkForRecovery();d.length>0?s({isChecking:!1,availableSaves:d,showDialog:!0}):s({isChecking:!1,availableSaves:[],showDialog:!1})}catch(d){console.warn("[Recovery] Failed to check for saves:",d),s({isChecking:!1,availableSaves:[],showDialog:!1})}})()},[]);const n=v.useCallback(async l=>{const d=await i(l);return d&&s(u=>({...u,showDialog:!1})),d},[i]),a=v.useCallback(()=>{s(l=>({...l,showDialog:!1}))},[]),o=v.useCallback(async()=>{await er.clearAllSaves(),s(l=>({...l,availableSaves:[],showDialog:!1}))},[]);return{isChecking:t.isChecking,availableSaves:t.availableSaves,showDialog:t.showDialog,recover:n,dismiss:a,clearAll:o}}const N7=()=>typeof window>"u"||window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",w2=r=>r==="auto"?N7()==="dark":r==="dark",lu=wa()(oS((r,e)=>({mode:"dark",isDark:!0,setMode:t=>{const s=w2(t);r({mode:t,isDark:s}),s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},toggleTheme:()=>{const t=e().mode,s=t==="light"?"dark":t==="dark"?"auto":"light";e().setMode(s)}}),{name:"openreel-theme",onRehydrateStorage:()=>r=>{if(r){const e=w2(r.mode);r.isDark=e,e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}}}));typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(lu.getState().mode==="auto"){const s=e.matches;lu.setState({isDark:s}),s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}});function R7({enabled:r}){const{createNewProject:e,importMedia:t}=W(),{setMode:s}=lu(),{navigate:i}=Jb(),n=v.useRef(!1),a=v.useRef(null);v.useEffect(()=>{if(!r||n.current)return;n.current=!0;const o=new URLSearchParams(window.location.search),l=parseInt(o.get("fps")||"24",10);k2(o,s),e("ComfyUI Video",{width:1920,height:1080,frameRate:l}),i("editor"),window.parent!==window&&window.parent.postMessage({type:"openreel-ready"},"*")},[r,e,i,t,s]),v.useEffect(()=>{if(!r)return;const o=l=>{if(!(!l.data||!l.data.type)){if(l.data.type==="comfyui-import-video"){const d=l.data.url||l.data.audioUrl;d&&d!==a.current&&(a.current=d,l.data.url?D7(l.data.url,t):l.data.audioUrl&&F7(l.data.audioUrl,t))}if(l.data.type==="comfyui-theme-update"&&l.data.theme){const d=new URLSearchParams;for(const[u,h]of Object.entries(l.data.theme))d.set(u,h);k2(d,s)}}};return window.addEventListener("message",o),()=>window.removeEventListener("message",o)},[r,t,s])}function Er(r){if(!r)return null;const e=r.trim(),t=e.match(/^#([0-9a-f]{3,8})$/i);if(t){let i=t[1];if(i.length===3&&(i=i[0]+i[0]+i[1]+i[1]+i[2]+i[2]),i.length>=6)return[parseInt(i.slice(0,2),16),parseInt(i.slice(2,4),16),parseInt(i.slice(4,6),16)]}const s=e.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);return s?[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]:null}function fi(r){return`${r[0]} ${r[1]} ${r[2]}`}function On(r){const e=r[0]/255,t=r[1]/255,s=r[2]/255,i=Math.max(e,t,s),n=Math.min(e,t,s),a=(i+n)/2;if(i===n)return`0 0% ${Math.round(a*100)}%`;const o=i-n,l=a>.5?o/(2-i-n):o/(i+n);let d=0;return i===e?d=((t-s)/o+(t<s?6:0))/6:i===t?d=((s-e)/o+2)/6:d=((e-t)/o+4)/6,`${Math.round(d*360)} ${Math.round(l*100)}% ${Math.round(a*100)}%`}function I7(r){return(.299*r[0]+.587*r[1]+.114*r[2])/255}function $n(r,e){return e>0?[Math.min(255,Math.round(r[0]+(255-r[0])*e)),Math.min(255,Math.round(r[1]+(255-r[1])*e)),Math.min(255,Math.round(r[2]+(255-r[2])*e))]:[Math.max(0,Math.round(r[0]*(1+e))),Math.max(0,Math.round(r[1]*(1+e))),Math.max(0,Math.round(r[2]*(1+e)))]}function k2(r,e){const t=r.get("theme_bg");if(!t)return;const s=Er(t);if(!s)return;const i=I7(s)<.5;e(i?"dark":"light");const n=Er(r.get("theme_bg_secondary")||"")||$n(s,i?.06:-.03),a=Er(r.get("theme_bg_tertiary")||"")||$n(s,i?.12:-.06),o=$n(s,i?.22:-.12),l=Er(r.get("theme_fg")||"")||(i?[224,224,224]:[24,24,27]),d=Er(r.get("theme_fg_muted")||"")||$n(l,i?-.35:.35),u=$n(l,i?-.2:.2),h=Er(r.get("theme_border")||"")||$n(s,i?.15:-.1),p=$n(h,i?.12:-.08),f=$n(h,i?.25:-.18),m=Er(r.get("theme_accent")||"")||[74,158,255],g=Er(r.get("theme_input_bg")||"")||a,y=Er(r.get("theme_scrollbar_thumb")||"")||p,x=Er(r.get("theme_scrollbar_track")||"")||s,b=On(m),w=On(s),C=On(l),S=On(n),T=On(a),j=On(h),_=On(g),M=`
    :root, .dark {
      /* OpenReel custom color overrides (RGB triplets) */
      --color-background: ${fi(s)};
      --color-background-secondary: ${fi(n)};
      --color-background-tertiary: ${fi(a)};
      --color-background-elevated: ${fi(o)};
      --color-text-primary: ${fi(l)};
      --color-text-secondary: ${fi(u)};
      --color-text-muted: ${fi(d)};
      --color-border: ${fi(h)};
      --color-border-hover: ${fi(p)};
      --color-border-active: ${fi(f)};

      /* shadcn/ui CSS variable overrides (HSL) */
      --background: ${w};
      --foreground: ${C};
      --card: ${S};
      --card-foreground: ${C};
      --popover: ${S};
      --popover-foreground: ${C};
      --primary: ${b};
      --primary-foreground: 0 0% 100%;
      --secondary: ${T};
      --secondary-foreground: ${C};
      --muted: ${T};
      --muted-foreground: ${On(d)};
      --accent: ${T};
      --accent-foreground: ${C};
      --border: ${j};
      --input: ${_};
      --ring: ${b};

      color-scheme: ${i?"dark":"light"};
      color: rgb(${fi(l)});
      background-color: rgb(${fi(s)});
    }

    /* Scrollbar overrides */
    ::-webkit-scrollbar-thumb {
      background: rgb(${fi(y)}) !important;
    }
    ::-webkit-scrollbar-track {
      background: rgb(${fi(x)}) !important;
    }
  `;let P=document.getElementById("comfyui-theme-override");P||(P=document.createElement("style"),P.id="comfyui-theme-override",document.head.appendChild(P)),P.textContent=M,console.log("[ComfyUI Embedding] Applied theme:",i?"dark":"light")}async function D7(r,e){try{console.log("[ComfyUI Embedding] Fetching video from:",r);const t=await fetch(r);if(!t.ok){console.error("[ComfyUI Embedding] Failed to fetch video:",t.status);return}const s=await t.blob(),i=new File([s],"comfyui_video.mp4",{type:"video/mp4"});console.log("[ComfyUI Embedding] Importing video, size:",s.size);const n=await e(i);n.success?console.log("[ComfyUI Embedding] Video imported successfully"):console.error("[ComfyUI Embedding] Video import failed:",n.error?.message)}catch(t){console.error("[ComfyUI Embedding] Error importing video:",t)}}async function F7(r,e){try{console.log("[ComfyUI Embedding] Fetching audio from:",r);const t=await fetch(r);if(!t.ok){console.error("[ComfyUI Embedding] Failed to fetch audio:",t.status);return}const s=await t.blob(),i=new File([s],"comfyui_audio.wav",{type:"audio/wav"});console.log("[ComfyUI Embedding] Importing audio, size:",s.size);const n=await e(i);n.success?console.log("[ComfyUI Embedding] Audio imported successfully"):console.error("[ComfyUI Embedding] Audio import failed:",n.error?.message)}catch(t){console.error("[ComfyUI Embedding] Error importing audio:",t)}}const B7=[{id:"youtube-4k",name:"YouTube 4K",description:"Best quality for YouTube 4K - 50Mbps",platform:"YouTube",category:"social",aspectRatio:"16:9",recommended:!0,settings:{format:"mp4",codec:"h264",width:3840,height:2160,frameRate:30,bitrate:5e4,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:384,channels:2}}},{id:"youtube-4k-60",name:"YouTube 4K 60fps",description:"4K 60fps for gaming/motion - 65Mbps",platform:"YouTube",category:"social",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:3840,height:2160,frameRate:60,bitrate:65e3,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:384,channels:2}}},{id:"youtube-1080p",name:"YouTube 1080p HD",description:"Standard HD quality for YouTube",platform:"YouTube",category:"social",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2}}},{id:"youtube-shorts",name:"YouTube Shorts",description:"Vertical format for YouTube Shorts (60s max)",platform:"YouTube",category:"social",aspectRatio:"9:16",maxDuration:60,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:60,bitrate:12e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2}}},{id:"tiktok",name:"TikTok",description:"Optimized for TikTok (3min max)",platform:"TikTok",category:"social",aspectRatio:"9:16",maxDuration:180,maxFileSize:287*1024*1024,recommended:!0,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:60,bitrate:1e4,bitrateMode:"vbr",quality:85,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"instagram-reels",name:"Instagram Reels",description:"Vertical format for Reels (90s max)",platform:"Instagram",category:"social",aspectRatio:"9:16",maxDuration:90,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"instagram-feed",name:"Instagram Feed Video",description:"Square format for feed posts (60s max)",platform:"Instagram",category:"social",aspectRatio:"1:1",maxDuration:60,settings:{format:"mp4",codec:"h264",width:1080,height:1080,frameRate:30,bitrate:6e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"instagram-story",name:"Instagram Story",description:"Vertical format for Stories (15s per clip)",platform:"Instagram",category:"social",aspectRatio:"9:16",maxDuration:15,settings:{format:"mp4",codec:"h264",width:1080,height:1920,frameRate:30,bitrate:6e3,bitrateMode:"vbr",quality:80,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:128,channels:2}}},{id:"twitter",name:"Twitter/X",description:"Optimized for Twitter (2min 20s max)",platform:"Twitter",category:"social",aspectRatio:"16:9",maxDuration:140,maxFileSize:512*1024*1024,settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:192,channels:2}}},{id:"facebook-feed",name:"Facebook Feed",description:"Standard format for Facebook feed",platform:"Facebook",category:"social",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:192,channels:2}}},{id:"linkedin",name:"LinkedIn",description:"Professional format for LinkedIn (10min max)",platform:"LinkedIn",category:"social",aspectRatio:"16:9",maxDuration:600,maxFileSize:5*1024*1024*1024,settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:8e3,bitrateMode:"vbr",quality:85,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:192,channels:2}}}],L7=[{id:"broadcast-4k-master",name:"4K Master Quality",description:"Maximum quality 4K - 80Mbps H.265",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",recommended:!0,settings:{format:"mov",codec:"h265",width:3840,height:2160,frameRate:30,bitrate:8e4,bitrateMode:"vbr",quality:95,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-4k-prores-hq",name:"4K ProRes HQ",description:"Professional ProRes for editing/mastering",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"hq",width:3840,height:2160,frameRate:30,bitrate:88e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"broadcast-4k-prores-4444",name:"4K ProRes 4444",description:"Highest quality ProRes with alpha support",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"4444",width:3840,height:2160,frameRate:30,bitrate:132e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"broadcast-4k-60",name:"4K 60fps High Motion",description:"4K at 60fps for sports/gaming - 65Mbps",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h265",width:3840,height:2160,frameRate:60,bitrate:65e3,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-4k",name:"Broadcast 4K UHD",description:"4K broadcast quality - 50Mbps",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h264",width:3840,height:2160,frameRate:30,bitrate:5e4,bitrateMode:"cbr",quality:90,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-1080p-high",name:"1080p High Quality",description:"High bitrate 1080p - 20Mbps",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:2e4,bitrateMode:"vbr",quality:95,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}},{id:"broadcast-1080p-prores",name:"1080p ProRes HQ",description:"ProRes HQ for 1080p editing",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"hq",width:1920,height:1080,frameRate:30,bitrate:22e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"broadcast-hd",name:"Broadcast HD 1080p",description:"Standard broadcast quality",platform:"Broadcast",category:"broadcast",aspectRatio:"16:9",settings:{format:"mov",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:12e3,bitrateMode:"cbr",quality:85,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:24,bitrate:320,channels:2}}}],O7=[{id:"web-hd",name:"Web HD",description:"Balanced quality for web embedding",platform:"Web",category:"web",aspectRatio:"16:9",recommended:!0,settings:{format:"mp4",codec:"h264",width:1920,height:1080,frameRate:30,bitrate:5e3,bitrateMode:"vbr",quality:80,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:128,channels:2}}},{id:"web-small",name:"Web Optimized",description:"Smaller file size for faster loading",platform:"Web",category:"web",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1280,height:720,frameRate:30,bitrate:2500,bitrateMode:"vbr",quality:75,keyframeInterval:90,audioSettings:{format:"aac",sampleRate:44100,bitDepth:16,bitrate:96,channels:2}}},{id:"webm-vp9",name:"WebM VP9",description:"Modern web format with VP9 codec (720p recommended)",platform:"Web",category:"web",aspectRatio:"16:9",settings:{format:"webm",codec:"vp9",width:1280,height:720,frameRate:30,bitrate:3e3,bitrateMode:"vbr",quality:80,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:128,channels:2}}}],$7=[{id:"archive-4k-prores",name:"Archive 4K ProRes",description:"Lossless 4K ProRes for long-term archival",platform:"Archive",category:"archive",aspectRatio:"16:9",recommended:!0,settings:{format:"mov",codec:"prores",proresProfile:"hq",width:3840,height:2160,frameRate:30,bitrate:88e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:96e3,bitDepth:24,bitrate:0,channels:2}}},{id:"archive-master",name:"Archive Master H.265",description:"High quality 4K H.265 - 80Mbps",platform:"Archive",category:"archive",aspectRatio:"16:9",settings:{format:"mov",codec:"h265",width:3840,height:2160,frameRate:30,bitrate:8e4,bitrateMode:"vbr",quality:95,keyframeInterval:30,audioSettings:{format:"wav",sampleRate:96e3,bitDepth:24,bitrate:0,channels:2}}},{id:"archive-1080p-prores",name:"Archive 1080p ProRes",description:"ProRes HQ for 1080p archival",platform:"Archive",category:"archive",aspectRatio:"16:9",settings:{format:"mov",codec:"prores",proresProfile:"hq",width:1920,height:1080,frameRate:30,bitrate:22e4,bitrateMode:"cbr",quality:100,keyframeInterval:1,audioSettings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}}},{id:"archive-proxy",name:"Archive Proxy",description:"Lower quality proxy for editing",platform:"Archive",category:"archive",aspectRatio:"16:9",settings:{format:"mp4",codec:"h264",width:1280,height:720,frameRate:30,bitrate:3e3,bitrateMode:"vbr",quality:70,keyframeInterval:30,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:128,channels:2}}}],z7=[{id:"audio-mp3-320",name:"MP3 High Quality",description:"320kbps MP3 for music",platform:"Audio",category:"custom",settings:{format:"mp3",sampleRate:48e3,bitDepth:16,bitrate:320,channels:2}},{id:"audio-wav",name:"WAV Lossless",description:"Uncompressed WAV audio",platform:"Audio",category:"archive",settings:{format:"wav",sampleRate:48e3,bitDepth:24,bitrate:0,channels:2}},{id:"audio-aac",name:"AAC High Quality",description:"256kbps AAC for compatibility",platform:"Audio",category:"custom",settings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2}}],V7=[...B7,...L7,...O7,...$7,...z7],C2="openreel-custom-export-presets";class U7{customPresets=[];listeners=new Set;constructor(){this.loadCustomPresets()}loadCustomPresets(){try{const e=localStorage.getItem(C2);e&&(this.customPresets=JSON.parse(e))}catch(e){console.error("[ExportPresets] Failed to load custom presets:",e)}}saveCustomPresets(){try{localStorage.setItem(C2,JSON.stringify(this.customPresets))}catch(e){console.error("[ExportPresets] Failed to save custom presets:",e)}}getAllPresets(){return[...V7,...this.customPresets]}getPresetsByCategory(e){return this.getAllPresets().filter(t=>t.category===e)}getPresetsByPlatform(e){return this.getAllPresets().filter(t=>t.platform===e)}getPreset(e){return this.getAllPresets().find(t=>t.id===e)}getRecommendedPresets(){return this.getAllPresets().filter(e=>e.recommended)}getPlatforms(){const e=new Set(this.getAllPresets().map(t=>t.platform));return Array.from(e)}addCustomPreset(e){const t={...e,id:`custom-${Date.now()}`,category:"custom"};return this.customPresets.push(t),this.saveCustomPresets(),this.notify(),t}updateCustomPreset(e,t){const s=this.customPresets.findIndex(i=>i.id===e);return s===-1?!1:(this.customPresets[s]={...this.customPresets[s],...t},this.saveCustomPresets(),this.notify(),!0)}deleteCustomPreset(e){const t=this.customPresets.findIndex(s=>s.id===e);return t===-1?!1:(this.customPresets.splice(t,1),this.saveCustomPresets(),this.notify(),!0)}getCustomPresets(){return[...this.customPresets]}isCustomPreset(e){return e.startsWith("custom-")}duplicatePreset(e,t){const s=this.getPreset(e);return s?this.addCustomPreset({...s,name:t,platform:"Custom"}):null}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notify(){this.listeners.forEach(e=>e())}}const fh=new U7;function G7(r,e){const t=r/e;return t<.9?"vertical":t>1.1?"horizontal":"square"}function W7(r,e){const t={"9:16":"vertical","1:1":"square","16:9":"horizontal","4:5":"vertical"};return r.filter(s=>s.aspectRatio?t[s.aspectRatio]===e:!1)}function Y7(r){switch(r){case"vertical":return"Vertical (TikTok, Reels, Shorts)";case"square":return"Square (Instagram Feed)";case"horizontal":return"Horizontal (YouTube, Twitter)"}}const S2={YouTube:c.jsx(Uc,{size:16}),Instagram:c.jsx(Vu,{size:16}),Twitter:c.jsx(Vu,{size:16}),TikTok:c.jsx(Gr,{size:16}),Facebook:c.jsx(Vu,{size:16}),LinkedIn:c.jsx(Vu,{size:16}),Broadcast:c.jsx(ki,{size:16}),Web:c.jsx(qj,{size:16}),Archive:c.jsx(IB,{size:16}),Audio:c.jsx(Gr,{size:16}),Custom:c.jsx(Vc,{size:16})},q7=({isOpen:r,onClose:e,onExport:t,duration:s=0,projectWidth:i=1920,projectHeight:n=1080})=>{const[a,o]=v.useState("presets"),[l,d]=v.useState("recommended"),[u,h]=v.useState(null),[p,f]=v.useState([]),[m,g]=v.useState([]),y=G7(i,n),[x,b]=v.useState({format:"mp4",codec:"h264",width:i,height:n,frameRate:30,bitrate:15e3,bitrateMode:"vbr",quality:90,keyframeInterval:60,audioSettings:{format:"aac",sampleRate:48e3,bitDepth:16,bitrate:256,channels:2},upscaling:{enabled:!1,quality:"balanced",sharpening:.3}}),[w,C]=v.useState(null),[k,S]=v.useState(null),[A,T]=v.useState([]),[j,_]=v.useState(!1),[M,P]=v.useState(null),[R,D]=v.useState(!1);v.useEffect(()=>{r&&(f(fh.getAllPresets()),g(fh.getPlatforms()),d("recommended"),h(null),_y().then(E=>{C(E),T(r2(E,{width:i,height:n}))}))},[r,i,n]),v.useEffect(()=>{if(!w||s<=0){S(null);return}const E=a==="presets"&&u?u.settings:x,G=UP(w,{width:E.width,height:E.height,frameRate:E.frameRate,duration:s,codec:E.codec});S(G)},[w,s,a,u,x]);const B=v.useCallback(async()=>{if(!j){_(!0),P(null);try{await vX(G=>{P(G)});const E=await _y(!0);C(E),T(r2(E,{width:i,height:n}))}catch(E){console.error("Benchmark failed:",E)}finally{_(!1),P(null)}}},[j,i,n]),O=W7(p,y),F=l==="recommended"?O.length>0?O:fh.getRecommendedPresets():l?p.filter(E=>E.platform===l):fh.getRecommendedPresets(),I=v.useCallback(()=>{const E=a==="presets"&&u?u.settings:x;t(E),e()},[a,u,x,t,e]),J=(E,G)=>{const V=E*1e3*G/8;return V<1024*1024?`${(V/1024).toFixed(1)} KB`:V<1024*1024*1024?`${(V/(1024*1024)).toFixed(1)} MB`:`${(V/(1024*1024*1024)).toFixed(2)} GB`},Z=E=>{const G=Math.floor(E/60),V=Math.floor(E%60);return`${G}:${V.toString().padStart(2,"0")}`};return r?c.jsx(Ta,{open:!0,onOpenChange:E=>!E&&e(),children:c.jsxs(Sn,{className:"max-w-4xl max-h-[85vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsx(Aa,{className:"p-4 border-b border-border bg-background-tertiary space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Lx,{size:20,className:"text-primary"}),c.jsx(ja,{className:"text-lg font-bold text-text-primary",children:"Export Video"})]})}),c.jsxs(Sb,{value:a,onValueChange:E=>o(E),className:"flex-1 flex flex-col overflow-hidden",children:[c.jsxs(Tb,{className:"flex border-b border-border bg-transparent rounded-none",children:[c.jsxs(Jd,{value:"presets",className:"flex-1 flex items-center justify-center gap-2 p-3 text-sm font-medium rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:text-primary text-text-secondary hover:text-text-primary",children:[c.jsx(fa,{size:16}),"Presets"]}),c.jsxs(Jd,{value:"custom",className:"flex-1 flex items-center justify-center gap-2 p-3 text-sm font-medium rounded-none border-b-2 border-transparent data-[state=active]:border-primary data-[state=active]:text-primary text-text-secondary hover:text-text-primary",children:[c.jsx(Vc,{size:16}),"Custom"]})]}),c.jsxs(Zd,{value:"presets",className:"flex-1 overflow-hidden flex mt-0",children:[c.jsxs("div",{className:"w-48 border-r border-border overflow-y-auto",children:[c.jsxs("button",{onClick:()=>d("recommended"),className:`w-full flex flex-col items-start p-3 text-sm transition-colors ${l==="recommended"?"bg-primary/10 text-primary border-r-2 border-primary":"text-text-secondary hover:bg-background-tertiary"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ci,{size:14}),c.jsx("span",{className:"font-medium",children:"For Your Video"})]}),c.jsx("span",{className:"text-[10px] text-text-muted mt-0.5 ml-5",children:Y7(y)})]}),c.jsx("div",{className:"h-px bg-border my-1"}),m.map(E=>c.jsxs("button",{onClick:()=>d(E),className:`w-full flex items-center gap-2 p-3 text-sm transition-colors ${l===E?"bg-primary/10 text-primary border-r-2 border-primary":"text-text-secondary hover:bg-background-tertiary"}`,children:[S2[E]||c.jsx(qj,{size:14}),E]},E))]}),c.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c.jsx("div",{className:"grid grid-cols-2 gap-3",children:F.map(E=>c.jsxs("button",{onClick:()=>h(E),className:`p-4 rounded-lg border text-left transition-colors ${u?.id===E.id?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[S2[E.platform],c.jsx("span",{className:"font-medium text-text-primary",children:E.name})]}),E.recommended&&c.jsx(fa,{size:12,className:"text-yellow-500 fill-yellow-500"})]}),c.jsx("p",{className:"text-[10px] text-text-muted mb-2",children:E.description}),"width"in E.settings&&c.jsxs("div",{className:"flex items-center gap-3 text-[10px] text-text-secondary",children:[c.jsxs("span",{children:[E.settings.width,"x",E.settings.height]}),c.jsxs("span",{children:[E.settings.frameRate,"fps"]}),c.jsx("span",{children:E.aspectRatio})]}),E.maxDuration&&c.jsxs("div",{className:"flex items-center gap-1 mt-1 text-[10px] text-yellow-500",children:[c.jsx(ui,{size:10}),"Max ",E.maxDuration,"s"]})]},E.id))})})]}),c.jsx(Zd,{value:"custom",className:"flex-1 overflow-y-auto p-4 mt-0",children:c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Format"}),c.jsxs(jt,{value:x.format,onValueChange:E=>b({...x,format:E}),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"mp4",children:"MP4"}),c.jsx(Ve,{value:"webm",children:"WebM"}),c.jsx(Ve,{value:"mov",children:"MOV"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Codec"}),c.jsxs(jt,{value:x.codec,onValueChange:E=>b({...x,codec:E}),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"h264",children:"H.264"}),c.jsx(Ve,{value:"h265",children:"H.265 (HEVC)"}),c.jsx(Ve,{value:"prores",children:"ProRes"}),c.jsx(Ve,{value:"vp9",children:"VP9"}),c.jsx(Ve,{value:"av1",children:"AV1"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Resolution"}),c.jsxs(jt,{value:`${x.width}x${x.height}`,onValueChange:E=>{const[G,V]=E.split("x").map(Number);b({...x,width:G,height:V})},children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"3840x2160",children:"4K (3840x2160)"}),c.jsx(Ve,{value:"2560x1440",children:"2K (2560x1440)"}),c.jsx(Ve,{value:"1920x1080",children:"1080p (1920x1080)"}),c.jsx(Ve,{value:"1280x720",children:"720p (1280x720)"}),c.jsx(Ve,{value:"854x480",children:"480p (854x480)"}),c.jsx(Ve,{value:"1080x1920",children:"Vertical 1080p"}),c.jsx(Ve,{value:"1080x1080",children:"Square 1080"})]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Frame Rate"}),c.jsxs(jt,{value:String(x.frameRate),onValueChange:E=>b({...x,frameRate:Number(E)}),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"24",children:"24 fps"}),c.jsx(Ve,{value:"25",children:"25 fps"}),c.jsx(Ve,{value:"30",children:"30 fps"}),c.jsx(Ve,{value:"50",children:"50 fps"}),c.jsx(Ve,{value:"60",children:"60 fps"})]})]})]}),c.jsxs("div",{children:[c.jsx(ts,{className:"block text-xs font-medium text-text-secondary mb-2",children:"Bitrate (kbps)"}),c.jsx(Ms,{type:"number",value:x.bitrate,onChange:E=>b({...x,bitrate:Number(E.target.value)}),className:"bg-background-tertiary border-border text-text-primary",min:1e3,max:15e4,step:1e3})]}),c.jsxs("div",{children:[c.jsx(ts,{className:"block text-xs font-medium text-text-secondary mb-2",children:"Quality"}),c.jsx(st,{value:[x.quality],onValueChange:E=>b({...x,quality:E[0]}),min:50,max:100,step:1,className:"w-full"}),c.jsxs("div",{className:"flex justify-between text-[10px] text-text-muted mt-1",children:[c.jsx("span",{children:"Smaller"}),c.jsxs("span",{children:[x.quality,"%"]}),c.jsx("span",{children:"Better"})]})]}),c.jsxs("div",{className:"col-span-2",children:[c.jsx("label",{className:"block text-xs font-medium text-text-secondary mb-2",children:"Audio Settings"}),c.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[c.jsxs(jt,{value:x.audioSettings.format,onValueChange:E=>b({...x,audioSettings:{...x.audioSettings,format:E}}),children:[c.jsx(vt,{className:"bg-background-tertiary border-border text-text-primary text-xs",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"aac",children:"AAC"}),c.jsx(Ve,{value:"mp3",children:"MP3"}),c.jsx(Ve,{value:"wav",children:"WAV"})]})]}),c.jsxs(jt,{value:String(x.audioSettings.sampleRate),onValueChange:E=>b({...x,audioSettings:{...x.audioSettings,sampleRate:Number(E)}}),children:[c.jsx(vt,{className:"bg-background-tertiary border-border text-text-primary text-xs",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"44100",children:"44.1 kHz"}),c.jsx(Ve,{value:"48000",children:"48 kHz"}),c.jsx(Ve,{value:"96000",children:"96 kHz"})]})]}),c.jsxs(jt,{value:String(x.audioSettings.bitrate),onValueChange:E=>b({...x,audioSettings:{...x.audioSettings,bitrate:Number(E)}}),children:[c.jsx(vt,{className:"bg-background-tertiary border-border text-text-primary text-xs",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"128",children:"128 kbps"}),c.jsx(Ve,{value:"192",children:"192 kbps"}),c.jsx(Ve,{value:"256",children:"256 kbps"}),c.jsx(Ve,{value:"320",children:"320 kbps"})]})]})]})]}),c.jsxs("div",{className:"col-span-2 border-t border-border pt-4 mt-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(ci,{size:14,className:"text-primary"}),c.jsx(ts,{htmlFor:"upscaling-switch",className:"text-xs font-medium text-text-secondary",children:"Enhance Quality (Upscaling)"})]}),c.jsx(ya,{id:"upscaling-switch",checked:x.upscaling?.enabled??!1,onCheckedChange:E=>b({...x,upscaling:{...x.upscaling,enabled:E}})})]}),x.upscaling?.enabled&&c.jsxs("div",{className:"space-y-3 pl-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-[10px] text-text-muted mb-1.5",children:"Quality Mode"}),c.jsx("div",{className:"flex gap-2",children:["fast","balanced","quality"].map(E=>c.jsx("button",{type:"button",onClick:()=>b({...x,upscaling:{...x.upscaling,quality:E}}),className:`flex-1 px-2 py-1.5 text-[10px] rounded border transition-colors ${x.upscaling?.quality===E?"border-primary bg-primary/10 text-primary":"border-border text-text-secondary hover:border-primary/50"}`,children:E.charAt(0).toUpperCase()+E.slice(1)},E))})]}),c.jsxs("div",{children:[c.jsx(ts,{className:"block text-[10px] text-text-muted mb-1.5",children:"Sharpening"}),c.jsx(st,{value:[Math.round((x.upscaling?.sharpening??.3)*100)],onValueChange:E=>b({...x,upscaling:{...x.upscaling,sharpening:E[0]/100}}),min:0,max:100,step:1,className:"w-full"}),c.jsxs("div",{className:"flex justify-between text-[10px] text-text-muted mt-1",children:[c.jsx("span",{children:"None"}),c.jsxs("span",{children:[Math.round((x.upscaling?.sharpening??.3)*100),"%"]}),c.jsx("span",{children:"Max"})]})]}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Enhance quality when exporting to higher resolutions than source. Uses edge-directed interpolation for sharper details."})]})]})]})})]}),w&&c.jsxs("div",{className:"px-4 py-3 border-t border-border bg-background-tertiary/50",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("button",{onClick:()=>D(!R),className:"flex items-center gap-2 text-xs text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(yL,{size:12}),c.jsx("span",{children:yX(w)}),c.jsx(Xj,{size:10,className:"text-text-muted"})]}),k&&c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[k.confidence==="measured"?c.jsx(Bx,{size:12,className:"text-green-500"}):c.jsx(VL,{size:12,className:"text-yellow-500"}),c.jsx("span",{className:"text-text-secondary",children:"Est. time:"}),c.jsx("span",{className:"font-medium text-text-primary",children:k.formatted})]}),wX(w)&&!j&&c.jsxs("button",{onClick:B,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-primary bg-primary/10 rounded hover:bg-primary/20 transition-colors",children:[c.jsx(ci,{size:10}),"Get accurate estimate"]}),j&&M&&c.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-text-muted",children:[c.jsx("div",{className:"w-16 h-1 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${M.progress*100}%`}})}),c.jsx("span",{children:"Testing..."})]})]})]}),R&&c.jsxs("div",{className:"mt-3 pt-3 border-t border-border/50 grid grid-cols-3 gap-4 text-[10px]",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-text-muted",children:"CPU"}),c.jsxs("p",{className:"text-text-primary font-medium",children:[w.cpu.cores," cores"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-text-muted",children:"GPU"}),c.jsx("p",{className:"text-text-primary font-medium truncate",title:w.gpu.renderer,children:w.gpu.renderer!=="Unknown"?w.gpu.renderer.replace(/ANGLE \(|, .*\)/g,"").replace(/Direct3D11.*$/g,"").trim():"Unknown"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:w.gpu.hasHardwareEncoding?"HW Encode":"Software only"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-text-muted",children:"Codecs"}),c.jsx("div",{className:"flex gap-1 flex-wrap",children:A.slice(0,3).map(E=>c.jsx("span",{className:`px-1 py-0.5 rounded text-[9px] ${E.speedRating==="fast"?"bg-green-500/20 text-green-400":E.speedRating==="medium"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:E.codec.toUpperCase()},E.codec))})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border bg-background-tertiary",children:[c.jsx("div",{className:"flex items-center gap-4 text-xs text-text-muted",children:s>0&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(ui,{size:12}),Z(s)]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx(qL,{size:12}),"~",J(a==="presets"&&u?u.settings.bitrate||8e3:x.bitrate,s)]}),k&&w?.encoding[x.codec]?.hardware&&c.jsxs("div",{className:"flex items-center gap-1 text-green-500",children:[c.jsx(ci,{size:12}),"Hardware accelerated"]})]})}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Et,{variant:"ghost",onClick:e,children:"Cancel"}),c.jsxs(Et,{onClick:I,disabled:a==="presets"&&!u,children:[c.jsx(ti,{size:16}),"Start Export"]})]})]})]})}):null},T2={"480p":{width:854,height:480},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080},"1440p":{width:2560,height:1440},"4k":{width:3840,height:2160}},A2={"480p":25e5,"720p":5e6,"1080p":12e6,"1440p":2e7,"4k":4e7};class Ry{screenRecorder=null;webcamRecorder=null;screenChunks=[];webcamChunks=[];screenStream=null;webcamStream=null;micStream=null;startTime=0;pausedDuration=0;pauseStartTime=0;durationInterval=null;eventHandlers=new Map;isStopping=!1;lastResult=null;on(e,t){return this.eventHandlers.has(e)||this.eventHandlers.set(e,new Set),this.eventHandlers.get(e).add(t),()=>this.eventHandlers.get(e)?.delete(t)}emit(e,t){this.eventHandlers.get(e)?.forEach(s=>s(t))}async requestPermissions(e){const t=T2[e.video.resolution],s={video:{width:{ideal:t.width},height:{ideal:t.height},frameRate:{ideal:e.video.frameRate}},audio:e.audio.systemAudio};if(this.screenStream=await navigator.mediaDevices.getDisplayMedia(s),e.audio.microphone)try{this.micStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}})}catch{console.warn("Microphone access denied, continuing without microphone")}if(e.webcam.enabled){const i=T2[e.webcam.resolution];try{this.webcamStream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:i.width},height:{ideal:i.height},facingMode:"user"},audio:!1})}catch{console.warn("Webcam access denied, continuing without webcam")}}return{screenStream:this.screenStream,webcamStream:this.webcamStream||void 0}}async startRecording(e){if(!this.screenStream)throw new Error("Screen stream not initialized. Call requestPermissions first.");this.screenChunks=[],this.webcamChunks=[],this.isStopping=!1,this.lastResult=null;const t=new MediaStream;this.screenStream.getVideoTracks().forEach(n=>t.addTrack(n)),this.screenStream.getAudioTracks().length>0&&this.screenStream.getAudioTracks().forEach(n=>t.addTrack(n)),this.micStream&&this.micStream.getAudioTracks().forEach(n=>t.addTrack(n));const s=this.getBestMimeType(),i=A2[e.video.resolution];if(this.screenRecorder=new MediaRecorder(t,{mimeType:s,videoBitsPerSecond:i}),this.screenRecorder.ondataavailable=n=>{n.data.size>0&&this.screenChunks.push(n.data)},this.screenRecorder.onerror=n=>{this.emit("error",n)},this.screenStream.getVideoTracks()[0].onended=()=>{this.stopRecording()},this.webcamStream&&e.webcam.enabled){const n=this.getBestMimeType(),a=A2[e.webcam.resolution];this.webcamRecorder=new MediaRecorder(this.webcamStream,{mimeType:n,videoBitsPerSecond:a}),this.webcamRecorder.ondataavailable=o=>{o.data.size>0&&this.webcamChunks.push(o.data)},this.webcamRecorder.start(1e3)}this.screenRecorder.start(1e3),this.startTime=Date.now(),this.pausedDuration=0,this.durationInterval=window.setInterval(()=>{const n=Date.now()-this.startTime-this.pausedDuration;this.emit("duration",n)},100),this.emit("start")}pauseRecording(){this.screenRecorder?.state==="recording"&&(this.screenRecorder.pause(),this.pauseStartTime=Date.now()),this.webcamRecorder?.state==="recording"&&this.webcamRecorder.pause(),this.emit("pause")}resumeRecording(){this.screenRecorder?.state==="paused"&&(this.screenRecorder.resume(),this.pausedDuration+=Date.now()-this.pauseStartTime),this.webcamRecorder?.state==="paused"&&this.webcamRecorder.resume(),this.emit("resume")}async stopRecording(){if(this.lastResult)return this.lastResult;if(this.isStopping)return await new Promise(s=>{const i=setInterval(()=>{this.lastResult&&(clearInterval(i),s())},50);setTimeout(()=>{clearInterval(i),s()},5e3)}),this.lastResult||{screenBlob:new Blob};this.isStopping=!0,this.durationInterval&&(clearInterval(this.durationInterval),this.durationInterval=null);const e={screenBlob:new Blob},t=[];return this.screenRecorder&&this.screenRecorder.state!=="inactive"?t.push(this.stopRecorder(this.screenRecorder,this.screenChunks).then(s=>{e.screenBlob=s})):this.screenChunks.length>0&&(e.screenBlob=new Blob(this.screenChunks,{type:"video/webm"})),this.webcamRecorder&&this.webcamRecorder.state!=="inactive"?t.push(this.stopRecorder(this.webcamRecorder,this.webcamChunks).then(s=>{e.webcamBlob=s})):this.webcamChunks.length>0&&(e.webcamBlob=new Blob(this.webcamChunks,{type:"video/webm"})),await Promise.all(t),this.lastResult=e,this.cleanup(),this.emit("stop",e),e}cancelRecording(){this.durationInterval&&(clearInterval(this.durationInterval),this.durationInterval=null),this.screenRecorder&&this.screenRecorder.state!=="inactive"&&this.screenRecorder.stop(),this.webcamRecorder&&this.webcamRecorder.state!=="inactive"&&this.webcamRecorder.stop(),this.cleanup()}getRecordingState(){return this.screenRecorder?.state||"inactive"}isRecording(){return this.screenRecorder?.state==="recording"}isPaused(){return this.screenRecorder?.state==="paused"}stopRecorder(e,t){return new Promise(s=>{e.onstop=()=>{const i=e.mimeType||"video/webm";s(new Blob(t,{type:i}))},e.stop()})}getBestMimeType(){const e=["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=h264,opus","video/webm","video/mp4"];for(const t of e)if(MediaRecorder.isTypeSupported(t))return t;return"video/webm"}cleanup(){this.screenStream?.getTracks().forEach(e=>e.stop()),this.webcamStream?.getTracks().forEach(e=>e.stop()),this.micStream?.getTracks().forEach(e=>e.stop()),this.screenStream=null,this.webcamStream=null,this.micStream=null,this.screenRecorder=null,this.webcamRecorder=null,this.screenChunks=[],this.webcamChunks=[]}static isSupported(){const e=typeof navigator.mediaDevices?.getDisplayMedia=="function",s=typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported("video/webm");return e&&s}static getSupportedFeatures(){const e=/Chrome|Chromium|Edge/.test(navigator.userAgent),t=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);return{screenCapture:!!navigator.mediaDevices?.getDisplayMedia,systemAudio:e,webcam:!!navigator.mediaDevices?.getUserMedia,vp9:MediaRecorder.isTypeSupported("video/webm;codecs=vp9"),h264:MediaRecorder.isTypeSupported("video/webm;codecs=h264")||t}}}const Mr=new Ry;function j2(r){const e=Math.floor(r/1e3),t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;return t>0?`${t}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${s}:${i.toString().padStart(2,"0")}`}const H7={video:{resolution:"1080p",frameRate:30},audio:{systemAudio:!0,microphone:!1},webcam:{enabled:!1,resolution:"720p"}},HP=wa((r,e)=>(Mr.on("duration",t=>{r({duration:t})}),Mr.on("stop",()=>{r({status:"processing"})}),Mr.on("error",t=>{const s=t instanceof Error?t.message:"Recording error occurred";r({status:"error",error:s})}),{status:"idle",duration:0,error:null,options:H7,screenStream:null,webcamStream:null,result:null,isModalOpen:!1,isControlsMinimized:!1,setOptions:t=>{r(s=>({options:{...s.options,...t,video:{...s.options.video,...t.video},audio:{...s.options.audio,...t.audio},webcam:{...s.options.webcam,...t.webcam}}}))},setVideoOption:(t,s)=>{r(i=>({options:{...i.options,video:{...i.options.video,[t]:s}}}))},setAudioOption:(t,s)=>{r(i=>({options:{...i.options,audio:{...i.options.audio,[t]:s}}}))},setWebcamOption:(t,s)=>{r(i=>({options:{...i.options,webcam:{...i.options.webcam,[t]:s}}}))},requestPermissions:async()=>{const{options:t}=e();r({status:"requesting",error:null});try{const s=await Mr.requestPermissions(t);return r({screenStream:s.screenStream,webcamStream:s.webcamStream||null,status:"idle"}),!0}catch(s){const i=s instanceof Error?s.message:"Permission denied";return r({status:"error",error:i}),!1}},startRecording:async()=>{const{options:t,screenStream:s}=e();if(!s){r({status:"error",error:"No screen stream available"});return}r({status:"countdown"}),await new Promise(i=>setTimeout(i,3e3));try{await Mr.startRecording(t),r({status:"recording",duration:0})}catch(i){const n=i instanceof Error?i.message:"Failed to start recording";r({status:"error",error:n})}},pauseRecording:()=>{Mr.pauseRecording(),r({status:"paused"})},resumeRecording:()=>{Mr.resumeRecording(),r({status:"recording"})},stopRecording:async()=>{r({status:"processing"});try{const t=await Mr.stopRecording();return r({result:t,status:"idle"}),t}catch(t){const s=t instanceof Error?t.message:"Failed to stop recording";return r({status:"error",error:s}),null}},cancelRecording:()=>{Mr.cancelRecording(),r({status:"idle",duration:0,screenStream:null,webcamStream:null,result:null})},reset:()=>{Mr.cancelRecording(),r({status:"idle",duration:0,error:null,screenStream:null,webcamStream:null,result:null,isModalOpen:!1,isControlsMinimized:!1})},openModal:()=>{r({isModalOpen:!0})},closeModal:()=>{const{status:t}=e();(t==="idle"||t==="error")&&r({isModalOpen:!1,error:null})},minimizeControls:()=>{r({isControlsMinimized:!0})},expandControls:()=>{r({isControlsMinimized:!1})}})),X7=()=>{const[r,e]=v.useState(3);return v.useEffect(()=>{if(r>0){const t=setTimeout(()=>e(r-1),1e3);return()=>clearTimeout(t)}},[r]),c.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-md",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"text-[180px] font-bold text-white animate-countdown",style:{textShadow:"0 0 60px rgba(239, 68, 68, 0.8), 0 0 100px rgba(239, 68, 68, 0.4)"},children:r>0?r:""},r),r===0&&c.jsx("div",{className:"flex flex-col items-center gap-4 animate-fade-in",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-4 h-4 bg-error rounded-full animate-pulse"}),c.jsx("span",{className:"text-2xl font-bold text-white",children:"Recording..."})]})})]}),c.jsx("style",{children:`
 @keyframes countdown {
 0% {
 transform: scale(0.5);
 opacity: 0;
 }
 20% {
 transform: scale(1.2);
 opacity: 1;
 }
 40% {
 transform: scale(1);
 }
 100% {
 transform: scale(0.8);
 opacity: 0;
 }
 }

 @keyframes fade-in {
 from {
 opacity: 0;
 transform: translateY(20px);
 }
 to {
 opacity: 1;
 transform: translateY(0);
 }
 }

 .animate-countdown {
 animation: countdown 1s ease-out forwards;
 }

 .animate-fade-in {
 animation: fade-in 0.5s ease-out forwards;
 }
 `})]})},K7=({onStop:r,onPause:e,onResume:t,onCancel:s})=>{const{status:i,duration:n,isControlsMinimized:a,minimizeControls:o,expandControls:l}=HP(),d=i==="paused";return a?c.jsxs("button",{onClick:l,className:"fixed bottom-6 right-6 z-[200] flex items-center gap-2 px-4 py-2 bg-red-600 rounded-full shadow-2xl hover:bg-red-700 transition-all group",children:[c.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"}),c.jsx("span",{className:"text-sm font-bold text-white",children:j2(n)})]}):c.jsx("div",{className:"fixed bottom-6 left-1/2 -translate-x-1/2 z-[200]",children:c.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 bg-background-secondary/95 backdrop-blur-xl border border-border rounded-2xl shadow-2xl",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:`w-3 h-3 rounded-full ${d?"bg-warning":"bg-error animate-pulse"}`}),c.jsx("span",{className:"text-lg font-mono font-bold text-text-primary min-w-[80px]",children:j2(n)})]}),c.jsx("div",{className:"w-px h-8 bg-border"}),c.jsxs("div",{className:"flex items-center gap-2",children:[d?c.jsx("button",{onClick:t,className:"p-3 bg-primary hover:bg-primary-hover rounded-xl transition-colors",title:"Resume recording",children:c.jsx(ti,{size:20,className:"text-white"})}):c.jsx("button",{onClick:e,className:"p-3 bg-warning/20 hover:bg-warning/30 rounded-xl transition-colors",title:"Pause recording",children:c.jsx(Qj,{size:20,className:"text-warning"})}),c.jsx("button",{onClick:r,className:"p-3 bg-red-600 hover:bg-red-700 rounded-xl transition-colors",title:"Stop recording",children:c.jsx(is,{size:20,className:"text-white fill-white"})}),c.jsx("button",{onClick:s,className:"p-3 bg-background-tertiary hover:bg-background-elevated rounded-xl transition-colors",title:"Cancel recording",children:c.jsx(Zs,{size:20,className:"text-text-muted"})})]}),c.jsx("div",{className:"w-px h-8 bg-border"}),c.jsx("button",{onClick:o,className:"p-2 text-text-muted hover:text-text-primary rounded-lg hover:bg-background-tertiary transition-colors",title:"Minimize controls",children:c.jsx(Kj,{size:16})})]})})},_2=[{value:"720p",label:"720p HD",desc:"1280720 - Smaller files"},{value:"1080p",label:"1080p Full HD",desc:"19201080 - Recommended"},{value:"1440p",label:"1440p QHD",desc:"25601440 - High quality"},{value:"4k",label:"4K Ultra HD",desc:"38402160 - Maximum quality"}],Q7=[{value:30,label:"30 fps"},{value:60,label:"60 fps"}],J7=[{value:"480p",label:"480p"},{value:"720p",label:"720p"},{value:"1080p",label:"1080p"}],Z7=({isOpen:r,onClose:e,onRecordingComplete:t})=>{const{status:s,options:i,webcamStream:n,error:a,setVideoOption:o,setAudioOption:l,setWebcamOption:d,requestPermissions:u,startRecording:h,stopRecording:p,cancelRecording:f,pauseRecording:m,resumeRecording:g,reset:y}=HP(),x=v.useRef(null),b=Ry.isSupported(),w=Ry.getSupportedFeatures();v.useEffect(()=>{x.current&&n&&(x.current.srcObject=n)},[n]),v.useEffect(()=>{r||(s==="idle"||s==="error")&&y()},[r,s,y]);const C=async()=>{await u()&&await h()},k=async()=>{const A=await p();A&&(t(A.screenBlob,A.webcamBlob),e())},S=()=>{f(),e()};return r?s==="countdown"?c.jsx(X7,{}):s==="recording"||s==="paused"?c.jsx(K7,{onStop:k,onPause:m,onResume:g,onCancel:S}):c.jsx(Ta,{open:!0,onOpenChange:A=>!A&&S(),children:c.jsxs(Sn,{className:"max-w-2xl p-0 gap-0 bg-background-secondary border-border overflow-hidden",children:[c.jsx(Aa,{className:"p-4 border-b border-border bg-background-tertiary space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Vr,{size:20,className:"text-error fill-error animate-pulse"}),c.jsx(ja,{className:"text-lg font-bold text-text-primary",children:"Screen Recording"})]})}),c.jsxs("div",{className:"p-6 space-y-6",children:[!b&&c.jsxs("div",{className:"flex items-start gap-3 p-4 bg-error/10 border border-error/30 rounded-lg",children:[c.jsx(To,{size:20,className:"text-error flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-error",children:"Screen recording not supported"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Your browser doesn't support screen recording. Please use Chrome, Edge, or Firefox."})]})]}),a&&c.jsxs("div",{className:"flex items-start gap-3 p-4 bg-error/10 border border-error/30 rounded-lg",children:[c.jsx(To,{size:20,className:"text-error flex-shrink-0 mt-0.5"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-medium text-error",children:"Recording Error"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:a})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:[c.jsx(ki,{size:16}),c.jsx("span",{children:"Video Settings"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-text-muted mb-2",children:"Resolution"}),c.jsxs(jt,{value:i.video.resolution,onValueChange:A=>o("resolution",A),disabled:!b,children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:_2.map(A=>c.jsx(Ve,{value:A.value,children:A.label},A.value))})]}),c.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:_2.find(A=>A.value===i.video.resolution)?.desc})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-text-muted mb-2",children:"Frame Rate"}),c.jsxs(jt,{value:String(i.video.frameRate),onValueChange:A=>o("frameRate",parseInt(A)),disabled:!b,children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:Q7.map(A=>c.jsx(Ve,{value:String(A.value),children:A.label},A.value))})]})]})]})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:[c.jsx(Vc,{size:16}),c.jsx("span",{children:"Audio Settings"})]}),c.jsxs("div",{className:"flex gap-4",children:[c.jsxs("button",{onClick:()=>l("systemAudio",!i.audio.systemAudio),disabled:!b||!w.systemAudio,className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border transition-all ${i.audio.systemAudio?"bg-primary/10 border-primary text-primary":"bg-background-tertiary border-border text-text-secondary hover:border-text-muted"} ${(!b||!w.systemAudio)&&"opacity-50 cursor-not-allowed"}`,children:[i.audio.systemAudio?c.jsx(vn,{size:18}):c.jsx(fp,{size:18}),c.jsx("span",{className:"text-sm",children:"System Audio"})]}),c.jsxs("button",{onClick:()=>l("microphone",!i.audio.microphone),disabled:!b,className:`flex-1 flex items-center justify-center gap-2 p-3 rounded-lg border transition-all ${i.audio.microphone?"bg-primary/10 border-primary text-primary":"bg-background-tertiary border-border text-text-secondary hover:border-text-muted"} ${!b&&"opacity-50 cursor-not-allowed"}`,children:[i.audio.microphone?c.jsx(T0,{size:18}):c.jsx(pO,{size:18}),c.jsx("span",{className:"text-sm",children:"Microphone"})]})]}),!w.systemAudio&&c.jsx("p",{className:"text-[10px] text-text-muted",children:"System audio capture is only available in Chrome and Edge browsers."})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-text-primary",children:[c.jsx(QB,{size:16}),c.jsx("span",{children:"Webcam Recording"})]}),c.jsx("button",{onClick:()=>d("enabled",!i.webcam.enabled),disabled:!b||!w.webcam,className:`relative w-12 h-6 rounded-full transition-colors ${i.webcam.enabled?"bg-primary":"bg-background-tertiary"} ${(!b||!w.webcam)&&"opacity-50 cursor-not-allowed"}`,children:c.jsx("div",{className:`absolute top-1 w-4 h-4 bg-white rounded-full transition-transform ${i.webcam.enabled?"translate-x-7":"translate-x-1"}`})})]}),i.webcam.enabled&&c.jsxs("div",{className:"flex gap-4",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"block text-xs text-text-muted mb-2",children:"Webcam Resolution"}),c.jsxs(jt,{value:i.webcam.resolution,onValueChange:A=>d("resolution",A),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:J7.map(A=>c.jsx(Ve,{value:A.value,children:A.label},A.value))})]})]}),n&&c.jsx("div",{className:"w-32 h-24 bg-background-tertiary rounded-lg overflow-hidden border border-border",children:c.jsx("video",{ref:x,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"})})]}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Webcam will be recorded as a separate file, giving you full control in the editor."})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-border bg-background-tertiary",children:[c.jsx("p",{className:"text-xs text-text-muted",children:"Recording will start after a 3-second countdown"}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx("button",{onClick:S,className:"px-4 py-2 text-sm text-text-secondary hover:text-text-primary transition-colors",children:"Cancel"}),c.jsx("button",{onClick:C,disabled:!b||s==="requesting",className:"flex items-center gap-2 px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:s==="requesting"?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),c.jsx("span",{children:"Requesting Access..."})]}):c.jsxs(c.Fragment,{children:[c.jsx(Vr,{size:14,className:"fill-current"}),c.jsx("span",{children:"Start Recording"})]})})]})]})]})}):null},eK=()=>{const{actionHistory:r,undo:e,redo:t,canUndo:s,canRedo:i,clipUndoStack:n,clipRedoStack:a}=W(),[o,l]=v.useState([]),[d,u]=v.useState([]),[h,p]=v.useState(!1),[f,m]=v.useState(""),[g,y]=v.useState(!1),x=_=>{switch(_){case"text":return"Create text clip";case"shape":return"Create shape";case"svg":return"Import SVG";case"sticker":return"Add sticker";default:return"Create clip"}};v.useEffect(()=>{const _=()=>{const P=r.getDisplayHistory();u(r.getSnapshots());const R=P.map((D,B)=>({id:`action-${D.entry.action.id}-${B}`,description:D.entry.description,timestamp:D.entry.timestamp,isCurrent:D.isCurrent,isClipEntry:!1,groupId:D.entry.groupId}));n.forEach((D,B)=>{R.push({id:`clip-${D.clipId}-${B}`,description:x(D.type),timestamp:Date.now()-(n.length-B)*1e3,isCurrent:B===n.length-1&&a.length===0,isClipEntry:!0,clipType:D.type})}),R.sort((D,B)=>D.timestamp-B.timestamp),l(R)};_();const M=r.subscribe(_);return()=>M()},[r,n,a]);const b=v.useCallback(async()=>{s()&&await e()},[e,s]),w=v.useCallback(async()=>{i()&&await t()},[t,i]),C=v.useCallback(()=>{f.trim()&&(r.createSnapshot(f.trim()),m(""),y(!1))},[r,f]),k=v.useCallback(_=>{r.deleteSnapshot(_)},[r]),S=_=>new Date(_).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),A=r.getUndoStackSize()+n.length,T=r.getRedoStackSize()+a.length,j=_=>{switch(_){case"text":return Os;case"shape":return yu;case"svg":return zc;case"sticker":return t_;default:return Ph}};return c.jsxs("div",{className:"flex flex-col h-full",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ph,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-sm font-medium text-text-primary",children:"History"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:b,disabled:!s(),className:"p-1.5 rounded hover:bg-background-tertiary disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:`Undo (${A})`,children:c.jsx(i_,{size:14})}),c.jsx("button",{onClick:w,disabled:!i(),className:"p-1.5 rounded hover:bg-background-tertiary disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:`Redo (${T})`,children:c.jsx(Zj,{size:14})})]})]}),c.jsxs("div",{className:"border-b border-border",children:[c.jsxs("button",{onClick:()=>p(!h),className:"w-full flex items-center gap-2 p-2 hover:bg-background-tertiary transition-colors",children:[h?c.jsx(ls,{size:12}):c.jsx(Js,{size:12}),c.jsx(k0,{size:12,className:"text-yellow-500"}),c.jsxs("span",{className:"text-xs text-text-secondary",children:["Snapshots (",d.length,")"]})]}),h&&c.jsxs("div",{className:"px-2 pb-2",children:[d.length===0&&!g&&c.jsx("p",{className:"text-[10px] text-text-muted py-2 text-center",children:"No snapshots saved"}),d.map(_=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded hover:bg-background-tertiary group",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(k0,{size:10,className:"text-yellow-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-xs text-text-primary",children:_.name}),c.jsx("p",{className:"text-[10px] text-text-muted",children:S(_.timestamp)})]})]}),c.jsx("button",{onClick:()=>k(_.id),className:"p-1 rounded hover:bg-red-500/20 text-text-muted hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all",children:c.jsx(Ss,{size:10})})]},_.id)),g?c.jsxs("div",{className:"flex items-center gap-2 p-2",children:[c.jsx(Ms,{type:"text",value:f,onChange:_=>m(_.target.value),onKeyDown:_=>{_.key==="Enter"&&C(),_.key==="Escape"&&y(!1)},placeholder:"Snapshot name...",className:"flex-1 h-7 text-xs bg-background-tertiary border-border text-text-primary",autoFocus:!0}),c.jsx("button",{onClick:C,className:"px-2 py-1 bg-primary text-white rounded text-xs hover:bg-primary/80 transition-colors",children:"Save"})]}):c.jsxs("button",{onClick:()=>y(!0),className:"w-full flex items-center justify-center gap-1 p-2 rounded border border-dashed border-border hover:border-primary hover:text-primary transition-colors",children:[c.jsx(YB,{size:12}),c.jsx("span",{className:"text-[10px]",children:"Create Snapshot"})]})]})]}),c.jsx(oa,{className:"flex-1",children:o.length===0?c.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-text-muted",children:[c.jsx(Ph,{size:24,className:"mb-2 opacity-30"}),c.jsx("p",{className:"text-xs",children:"No actions yet"})]}):c.jsx("div",{className:"p-2 space-y-0.5",children:o.map(_=>{const M=_.isClipEntry?j(_.clipType):null;return c.jsxs("div",{className:`flex items-center gap-2 p-2 rounded transition-colors ${_.isCurrent?"bg-primary/20 border border-primary/30":"hover:bg-background-tertiary"}`,children:[_.isClipEntry&&M?c.jsx(M,{size:12,className:_.isCurrent?"text-primary":"text-text-muted"}):c.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${_.isCurrent?"bg-primary":"bg-text-muted"}`}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:`text-xs truncate ${_.isCurrent?"text-text-primary":"text-text-secondary"}`,children:_.description}),c.jsx("p",{className:"text-[10px] text-text-muted",children:S(_.timestamp)})]}),_.groupId&&c.jsx("span",{className:"px-1 py-0.5 bg-background-tertiary rounded text-[8px] text-text-muted",children:"grouped"}),_.isClipEntry&&c.jsx("span",{className:"px-1 py-0.5 bg-amber-500/20 rounded text-[8px] text-amber-400",children:"clip"})]},_.id)})})}),c.jsx("div",{className:"p-2 border-t border-border bg-background-tertiary",children:c.jsxs("div",{className:"flex items-center justify-between text-[10px] text-text-muted",children:[c.jsxs("span",{children:[A," actions"]}),c.jsxs("span",{children:[T," redoable"]})]})})]})};function tK(r){const e=Math.floor((Date.now()-r)/1e3);return e<60?"just now":e<3600?`${Math.floor(e/60)}m ago`:e<86400?`${Math.floor(e/3600)}h ago`:`${Math.floor(e/86400)}d ago`}const sK=()=>{const{project:r,createNewProject:e,recoverFromAutoSave:t,renameProject:s}=W(),[i,n]=v.useState(!1),[a,o]=v.useState([]),[l,d]=v.useState(!1),[u,h]=v.useState(r.name),[p,f]=v.useState(!1),m=v.useRef(null),g=v.useRef(null);v.useEffect(()=>{i&&(async()=>{try{await er.initialize();const A=(await er.checkForRecovery()).reduce((T,j)=>{const _=T.find(M=>M.projectId===j.projectId);return!_||j.timestamp>_.timestamp?[...T.filter(M=>M.projectId!==j.projectId),j]:T},[]);o(A.sort((T,j)=>j.timestamp-T.timestamp))}catch(S){console.warn("[ProjectSwitcher] Failed to load saved projects:",S)}})()},[i]),v.useEffect(()=>{const k=S=>{m.current&&!m.current.contains(S.target)&&(n(!1),d(!1))};return document.addEventListener("mousedown",k),()=>document.removeEventListener("mousedown",k)},[]),v.useEffect(()=>{l&&g.current&&(g.current.focus(),g.current.select())},[l]),v.useEffect(()=>{h(r.name)},[r.name]);const y=v.useCallback(async()=>{const k=u.trim();k&&k!==r.name&&await s(k),d(!1)},[u,r.name,s]),x=v.useCallback(k=>{k.key==="Enter"?y():k.key==="Escape"&&(h(r.name),d(!1))},[y,r.name]),b=v.useCallback(()=>{e(),n(!1)},[e]),w=v.useCallback(async k=>{f(!0);try{await t(k),n(!1)}catch(S){console.error("[ProjectSwitcher] Failed to switch project:",S)}finally{f(!1)}},[t]),C=a.filter(k=>k.projectId!==r.id);return c.jsxs("div",{className:"relative",ref:m,children:[c.jsxs("button",{onClick:()=>n(!i),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-background-secondary transition-colors group max-w-[200px]",children:[c.jsx(no,{className:"w-4 h-4 text-primary shrink-0"}),c.jsx("span",{className:"text-sm font-medium text-text-primary truncate",children:r.name}),c.jsx(ls,{className:`w-3.5 h-3.5 text-text-muted transition-transform duration-200 shrink-0 ${i?"rotate-180":""}`})]}),i&&c.jsxs("div",{className:"absolute top-full left-0 mt-2 w-72 bg-background border border-border rounded-xl shadow-2xl overflow-hidden z-50 animate-in fade-in slide-in-from-top-2 duration-150",children:[c.jsxs("div",{className:"p-3 border-b border-border",children:[c.jsx("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wider mb-2",children:"Current Project"}),l?c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ms,{ref:g,type:"text",value:u,onChange:k=>h(k.target.value),onBlur:y,onKeyDown:x,className:"flex-1 bg-background-secondary border-primary text-text-primary"}),c.jsx("button",{onClick:y,className:"p-2 bg-primary text-white rounded-lg hover:bg-primary-hover transition-colors",children:c.jsx(Ei,{className:"w-4 h-4"})})]}):c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-secondary rounded-lg group",children:[c.jsx(no,{className:"w-4 h-4 text-primary shrink-0"}),c.jsx("span",{className:"flex-1 text-sm font-medium text-text-primary truncate",children:r.name}),c.jsx("button",{onClick:()=>d(!0),className:"p-1.5 rounded-md text-text-muted hover:text-text-primary hover:bg-background-tertiary transition-colors opacity-0 group-hover:opacity-100",title:"Rename project",children:c.jsx(_O,{className:"w-3.5 h-3.5"})})]})]}),c.jsx("div",{className:"p-2",children:c.jsxs("button",{onClick:b,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-background-secondary transition-colors text-left group",children:[c.jsx("div",{className:"p-1.5 bg-primary/10 rounded-md text-primary group-hover:bg-primary/20 transition-colors",children:c.jsx(wr,{className:"w-4 h-4"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-sm font-medium text-text-primary",children:"New Project"}),c.jsx("div",{className:"text-xs text-text-muted",children:"Start fresh with a new canvas"})]})]})}),C.length>0&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"px-3 py-2 border-t border-border",children:c.jsxs("div",{className:"text-xs font-medium text-text-muted uppercase tracking-wider flex items-center gap-2",children:[c.jsx(ui,{className:"w-3 h-3"}),"Recent Projects"]})}),c.jsx("div",{className:"max-h-64 overflow-y-auto px-2 pb-2",children:C.map(k=>c.jsxs("button",{onClick:()=>w(k.id),disabled:p,className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-background-secondary transition-colors text-left group disabled:opacity-50",children:[c.jsx("div",{className:"p-1.5 bg-background-tertiary rounded-md text-text-muted group-hover:text-text-secondary transition-colors",children:c.jsx(Ox,{className:"w-4 h-4"})}),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("div",{className:"text-sm font-medium text-text-primary truncate group-hover:text-primary transition-colors",children:k.projectName}),c.jsx("div",{className:"text-xs text-text-muted",children:tK(k.timestamp)})]})]},k.id))})]})]})]})},Ho=320,Wa=16,Ws=8,iK=({step:r,targetRect:e,currentStep:t,totalSteps:s,isFirstStep:i,isLastStep:n,onNext:a,onPrev:o,onSkip:l,onGoToStep:d})=>{const{position:u,arrowPosition:h}=v.useMemo(()=>{if(!e||r.position==="center")return{position:{x:0,y:0},arrowPosition:null};const f={width:window.innerWidth,height:window.innerHeight};let m=0,g=0,y=null;const x=12,b={left:e.left-x,top:e.top-x,right:e.right+x,bottom:e.bottom+x,width:e.width+x*2,height:e.height+x*2};switch(r.position){case"right":m=b.right+Wa,g=b.top+b.height/2-100,y="left";break;case"left":m=b.left-Ho-Wa,g=b.top+b.height/2-100,y="right";break;case"top":m=b.left+b.width/2-Ho/2,g=b.top-200-Wa,y="bottom";break;case"bottom":m=b.left+b.width/2-Ho/2,g=b.bottom+Wa,y="top";break}return m=Math.max(Wa,Math.min(m,f.width-Ho-Wa)),g=Math.max(Wa,Math.min(g,f.height-250)),{position:{x:m,y:g},arrowPosition:y}},[e,r.position]),p=r.position==="center"||!e;return c.jsx(Ht.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{type:"spring",stiffness:500,damping:30},className:`fixed z-[102] ${p?"inset-0 flex items-center justify-center pointer-events-none":""}`,style:p?void 0:{left:u.x,top:u.y,width:Ho},children:c.jsxs("div",{className:"relative bg-background-secondary border border-border rounded-xl shadow-2xl pointer-events-auto",style:{width:p?Ho:"100%"},children:[h&&!p&&c.jsx("div",{className:"absolute w-0 h-0",style:{...h==="left"&&{left:-Ws,top:"50%",transform:"translateY(-50%)",borderTop:`${Ws}px solid transparent`,borderBottom:`${Ws}px solid transparent`,borderRight:`${Ws}px solid var(--border)`},...h==="right"&&{right:-Ws,top:"50%",transform:"translateY(-50%)",borderTop:`${Ws}px solid transparent`,borderBottom:`${Ws}px solid transparent`,borderLeft:`${Ws}px solid var(--border)`},...h==="top"&&{top:-Ws,left:"50%",transform:"translateX(-50%)",borderLeft:`${Ws}px solid transparent`,borderRight:`${Ws}px solid transparent`,borderBottom:`${Ws}px solid var(--border)`},...h==="bottom"&&{bottom:-Ws,left:"50%",transform:"translateX(-50%)",borderLeft:`${Ws}px solid transparent`,borderRight:`${Ws}px solid transparent`,borderTop:`${Ws}px solid var(--border)`}}}),c.jsx("button",{onClick:l,className:"absolute top-3 right-3 p-1 rounded hover:bg-background-tertiary text-text-muted hover:text-text-primary transition-colors",children:c.jsx(Zs,{size:14})}),c.jsxs("div",{className:"p-6",children:[c.jsx(Ht.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-lg font-bold text-text-primary mb-2",children:r.title},`title-${t}`),c.jsx(Ht.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"text-sm text-text-secondary mb-4",children:r.description},`desc-${t}`),r.tips&&r.tips.length>0&&c.jsx(Ht.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-background-tertiary rounded-lg p-3 mb-4",children:c.jsx("ul",{className:"space-y-1.5",children:r.tips.map((f,m)=>c.jsxs("li",{className:"flex items-start gap-2 text-xs text-text-secondary",children:[c.jsx("span",{className:"text-primary mt-0.5",children:""}),f]},m))})},`tips-${t}`),c.jsx("div",{className:"flex items-center justify-center gap-1.5 mb-4",children:Array.from({length:s}).map((f,m)=>c.jsx("button",{onClick:()=>d(m),className:`w-2 h-2 rounded-full transition-all ${m===t?"bg-primary scale-110":"bg-border hover:bg-text-muted"}`},m))})]}),c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t border-border bg-background-tertiary rounded-b-xl",children:[c.jsxs("button",{onClick:o,disabled:i,className:"flex items-center gap-1 px-3 py-1.5 text-xs text-text-secondary hover:text-text-primary disabled:opacity-30 disabled:cursor-not-allowed transition-colors",children:[c.jsx(Gj,{size:14}),"Back"]}),c.jsx("button",{onClick:l,className:"px-3 py-1.5 text-xs text-text-muted hover:text-text-secondary transition-colors",children:"Skip Tour"}),c.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-4 py-1.5 bg-primary text-white rounded-lg text-xs font-medium hover:bg-primary/80 transition-colors",children:[n?"Get Started":"Next",!n&&c.jsx(Js,{size:14})]})]})]})})},mh=[{id:"welcome",target:null,title:"Welcome to OpenReel",description:"Let's take a quick tour of the editor",position:"center"},{id:"assets",target:"[data-tour='assets']",title:"Assets Panel",description:"Your creative toolkit. Import media, generate AI content, add shapes, stickers, and custom SVGs.",tips:["Drag & drop videos, audio, images","AI Gen tab: generate images & backgrounds with AI","Shapes & custom SVG imports","Stickers, backgrounds & overlays"],position:"right"},{id:"timeline",target:"[data-tour='timeline']",title:"Timeline",description:"Arrange and edit your clips. Drag to move, drag edges to trim.",tips:["Press S to split clips","Space to play/pause","Scroll to zoom"],position:"top"},{id:"preview",target:"[data-tour='preview']",title:"Preview",description:"Watch your video in real-time as you edit.",tips:["Arrow keys for frame navigation","Click to scrub","Fullscreen available"],position:"left"},{id:"inspector",target:"[data-tour='inspector']",title:"Inspector",description:"Select a clip to see its properties. Add effects, adjust colors, animate.",tips:["Transform, effects, color grading","Keyframe any property","AI-powered tools"],position:"left"},{id:"complete",target:null,title:"You're Ready!",description:"Start creating! Press ? anytime for keyboard shortcuts.",position:"center"}],Yh="openreel-onboarding-complete";let Iy={isActive:!1,currentStep:0};const Dy=new Set;function rK(){Dy.forEach(r=>r())}function nK(r){return Dy.add(r),()=>Dy.delete(r)}function E2(){return Iy}function to(r){Iy={...Iy,...r},rK()}function aK(){to({isActive:!0,currentStep:0})}function oK(){const r=v.useSyncExternalStore(nK,E2,E2),[e,t]=v.useState(null),s=mh[r.currentStep],i=r.currentStep===0,n=r.currentStep===mh.length-1,a=v.useCallback(()=>{if(!s?.target){t(null);return}const p=document.querySelector(s.target);t(p?p.getBoundingClientRect():null)},[s?.target]);v.useEffect(()=>{if(!r.isActive)return;a();const p=()=>a();window.addEventListener("resize",p);const f=setInterval(a,100);return()=>{window.removeEventListener("resize",p),clearInterval(f)}},[r.isActive,r.currentStep,a]);const o=v.useCallback(()=>{to({currentStep:0,isActive:!0})},[]),l=v.useCallback(()=>{n?(localStorage.setItem(Yh,"true"),to({isActive:!1})):to({currentStep:r.currentStep+1})},[n,r.currentStep]),d=v.useCallback(()=>{i||to({currentStep:r.currentStep-1})},[i,r.currentStep]),u=v.useCallback(()=>{localStorage.setItem(Yh,"true"),to({isActive:!1})},[]),h=v.useCallback(p=>{p>=0&&p<mh.length&&to({currentStep:p})},[]);return v.useEffect(()=>{if(!localStorage.getItem(Yh)){const f=setTimeout(()=>{o()},500);return()=>clearTimeout(f)}},[o]),v.useEffect(()=>{if(!r.isActive)return;const p=f=>{f.key==="Escape"?u():f.key==="ArrowRight"||f.key==="Enter"?l():f.key==="ArrowLeft"&&d()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[r.isActive,l,d,u]),{isActive:r.isActive,currentStep:r.currentStep,step:s,targetRect:e,isFirstStep:i,isLastStep:n,totalSteps:mh.length,start:o,next:l,prev:d,skip:u,goToStep:h}}const cK=()=>{const{isActive:r,currentStep:e,step:t,targetRect:s,isFirstStep:i,isLastStep:n,totalSteps:a,next:o,prev:l,skip:d,goToStep:u}=oK();if(!r||!t)return null;const h=12,p=!!s,f=p?{left:s.left-h,top:s.top-h,width:s.width+h*2,height:s.height+h*2}:null;return c.jsx(Ax,{mode:"wait",children:c.jsxs("div",{className:"fixed inset-0 z-[100] pointer-events-none",children:[p&&f?c.jsxs(c.Fragment,{children:[c.jsx(Ht.div,{className:"fixed left-0 right-0 top-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:f.top},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`top-${e}`),c.jsx(Ht.div,{className:"fixed left-0 right-0 bottom-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:window.innerHeight-f.top-f.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`bottom-${e}`),c.jsx(Ht.div,{className:"fixed left-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:f.top,width:f.left,height:f.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`left-${e}`),c.jsx(Ht.div,{className:"fixed right-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:f.top,width:window.innerWidth-f.left-f.width,height:f.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`right-${e}`),c.jsx(Ht.div,{className:"fixed pointer-events-none border-2 border-primary rounded-lg",initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1,left:f.left,top:f.top,width:f.width,height:f.height},transition:{type:"spring",stiffness:300,damping:30},style:{boxShadow:"0 0 0 4px rgba(34, 197, 94, 0.2), 0 0 20px rgba(34, 197, 94, 0.3)"}},`ring-${e}`)]}):c.jsx(Ht.div,{className:"fixed inset-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:d},"full-overlay"),c.jsx(iK,{step:t,targetRect:s,currentStep:e,totalSteps:a,isFirstStep:i,isLastStep:n,onNext:o,onPrev:l,onSkip:d,onGoToStep:u})]},"tour-overlay")})},gh=[{id:"intro",target:null,title:"Motion Graphics & Animation",description:"Learn how to create professional animations with keyframes, motion paths, and particle effects.",position:"center"},{id:"keyframes-inspector",target:"[data-tour='inspector']",title:"Keyframe Animation",description:"Select any clip and expand the Keyframes section in the Inspector. Add keyframes to animate position, scale, rotation, and opacity over time.",tips:["Click the diamond icon to add a keyframe at current time","Each property can have its own animation curve","Choose from 30+ easing presets for smooth motion"],position:"left"},{id:"keyframes-timeline",target:"[data-tour='timeline']",title:"Timeline Keyframe View",description:"Click the expand arrow on any track header to reveal keyframe sub-tracks. Drag keyframe diamonds to adjust timing visually.",tips:["Diamond markers show keyframe positions","Drag horizontally to change timing","Click the curve between keyframes to edit easing"],position:"top"},{id:"keyframe-editor",target:"[data-tour='toolbar']",title:"Graph Editor",description:"Open the Keyframe Editor panel from the toolbar for precise control. Edit value curves, copy/paste keyframes, and fine-tune animations.",tips:["Drag keyframe points to adjust time and value","Select multiple keyframes with Shift+click","Apply easing presets to selected keyframes"],position:"bottom"},{id:"motion-path",target:"[data-tour='preview']",title:"Motion Paths",description:"Create smooth movement along custom paths. Enable Motion Path mode to draw bezier curves directly on the preview canvas.",tips:["Click on the canvas to add path points","Drag control handles to curve the path","Elements follow the path as they animate","Great for flying logos and dynamic text"],position:"left"},{id:"particle-effects",target:"[data-tour='inspector']",title:"Particle Effects",description:"Add cinematic particle effects like confetti, sparkles, dust, and explosions. Find them in the Inspector's Particle Effects section.",tips:["Choose from preset effects or customize","Adjust particle count, speed, and colors","Set timing for when effects appear","Combine with keyframes for dramatic reveals"],position:"left"},{id:"emphasis-animations",target:"[data-tour='inspector']",title:"Emphasis Animations",description:"Make elements pop with attention-grabbing animations. Pulse, bounce, shake, wiggle, and more - perfect for highlighting important content.",tips:["24 built-in emphasis presets","Set duration and loop count","Combine with entrance/exit animations"],position:"left"},{id:"text-animations",target:"[data-tour='inspector']",title:"Text Animation Presets",description:"Animate text with professional presets. Characters can fade in, slide, bounce, or appear with typewriter effects.",tips:["19 text animation styles available","Per-character or per-word animation","Customize timing and easing"],position:"left"},{id:"complete",target:null,title:"Start Animating!",description:"You're ready to create professional motion graphics. Select a clip and start experimenting with keyframes and effects.",tips:["Press K to add a keyframe at playhead","Use ? to see all keyboard shortcuts","Combine effects for unique animations"],position:"center"}],Fy="openreel-mograph-tour-complete";let By={isActive:!1,currentStep:0};const Ly=new Set;function lK(){Ly.forEach(r=>r())}function dK(r){return Ly.add(r),()=>Ly.delete(r)}function M2(){return By}function so(r){By={...By,...r},lK()}function uK(){so({isActive:!0,currentStep:0})}function hK(){const r=v.useSyncExternalStore(dK,M2,M2),[e,t]=v.useState(null),s=gh[r.currentStep],i=r.currentStep===0,n=r.currentStep===gh.length-1,a=v.useCallback(()=>{if(!s?.target){t(null);return}const p=document.querySelector(s.target);t(p?p.getBoundingClientRect():null)},[s?.target]);v.useEffect(()=>{if(!r.isActive)return;a();const p=()=>a();window.addEventListener("resize",p);const f=setInterval(a,100);return()=>{window.removeEventListener("resize",p),clearInterval(f)}},[r.isActive,r.currentStep,a]);const o=v.useCallback(()=>{so({currentStep:0,isActive:!0})},[]),l=v.useCallback(()=>{n?(localStorage.setItem(Fy,"true"),so({isActive:!1})):so({currentStep:r.currentStep+1})},[n,r.currentStep]),d=v.useCallback(()=>{i||so({currentStep:r.currentStep-1})},[i,r.currentStep]),u=v.useCallback(()=>{localStorage.setItem(Fy,"true"),so({isActive:!1})},[]),h=v.useCallback(p=>{p>=0&&p<gh.length&&so({currentStep:p})},[]);return v.useEffect(()=>{if(!r.isActive)return;const p=f=>{f.key==="Escape"?u():f.key==="ArrowRight"||f.key==="Enter"?l():f.key==="ArrowLeft"&&d()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[r.isActive,l,d,u]),{isActive:r.isActive,currentStep:r.currentStep,step:s,targetRect:e,isFirstStep:i,isLastStep:n,totalSteps:gh.length,start:o,next:l,prev:d,skip:u,goToStep:h}}const pK=()=>{const{isActive:r,currentStep:e,step:t,targetRect:s,isFirstStep:i,isLastStep:n,totalSteps:a,next:o,prev:l,skip:d,goToStep:u}=hK();if(!r||!t)return null;const h=12,p=!!s,f=p?{left:s.left-h,top:s.top-h,width:s.width+h*2,height:s.height+h*2}:null,g=(()=>{if(!p||!f)return{left:"50%",top:"50%",transform:"translate(-50%, -50%)"};const y=380,x=16;switch(t.position){case"right":return{left:f.left+f.width+x,top:f.top+f.height/2,transform:"translateY(-50%)",maxWidth:window.innerWidth-f.left-f.width-x-20};case"left":return{left:f.left-x,top:f.top+f.height/2,transform:"translate(-100%, -50%)",maxWidth:f.left-x-20};case"top":return{left:f.left+f.width/2,top:f.top-x,transform:"translate(-50%, -100%)",maxWidth:y};case"bottom":return{left:f.left+f.width/2,top:f.top+f.height+x,transform:"translateX(-50%)",maxWidth:y};default:return{left:"50%",top:"50%",transform:"translate(-50%, -50%)",maxWidth:y}}})();return c.jsx(Ax,{mode:"wait",children:c.jsxs("div",{className:"fixed inset-0 z-[100] pointer-events-none",children:[p&&f?c.jsxs(c.Fragment,{children:[c.jsx(Ht.div,{className:"fixed left-0 right-0 top-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:f.top},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`top-${e}`),c.jsx(Ht.div,{className:"fixed left-0 right-0 bottom-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,height:window.innerHeight-f.top-f.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`bottom-${e}`),c.jsx(Ht.div,{className:"fixed left-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:f.top,width:f.left,height:f.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`left-${e}`),c.jsx(Ht.div,{className:"fixed right-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1,top:f.top,width:window.innerWidth-f.left-f.width,height:f.height},transition:{type:"spring",stiffness:300,damping:30},onClick:d},`right-${e}`),c.jsx(Ht.div,{className:"fixed pointer-events-none border-2 border-purple-500 rounded-lg",initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1,left:f.left,top:f.top,width:f.width,height:f.height},transition:{type:"spring",stiffness:300,damping:30},style:{boxShadow:"0 0 0 4px rgba(168, 85, 247, 0.2), 0 0 20px rgba(168, 85, 247, 0.3)"}},`ring-${e}`)]}):c.jsx(Ht.div,{className:"fixed inset-0 bg-black/80 pointer-events-auto",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:d},"full-overlay"),c.jsxs(Ht.div,{className:"fixed pointer-events-auto bg-background-secondary border border-purple-500/30 rounded-xl shadow-2xl overflow-hidden",initial:{opacity:0,scale:.9,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10},transition:{type:"spring",stiffness:400,damping:30},style:{...g,width:380},children:[c.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 px-4 py-3 flex items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 rounded-full bg-white/20 flex items-center justify-center",children:c.jsx(Zp,{size:16,className:"text-white"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-white font-semibold text-sm",children:t.title}),c.jsxs("p",{className:"text-white/60 text-[10px]",children:["Motion Graphics Tour  Step ",e+1," of ",a]})]}),c.jsx("button",{onClick:d,className:"p-1 rounded hover:bg-white/10 text-white/60 hover:text-white transition-colors",children:c.jsx(Zs,{size:16})})]}),c.jsxs("div",{className:"p-4",children:[c.jsx("p",{className:"text-text-secondary text-sm leading-relaxed mb-4",children:t.description}),t.tips&&t.tips.length>0&&c.jsxs("div",{className:"bg-purple-500/10 rounded-lg p-3 mb-4",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(oO,{size:14,className:"text-purple-400"}),c.jsx("span",{className:"text-purple-400 text-xs font-medium",children:"Pro Tips"})]}),c.jsx("ul",{className:"space-y-1.5",children:t.tips.map((y,x)=>c.jsxs("li",{className:"text-text-muted text-xs flex items-start gap-2",children:[c.jsx("span",{className:"text-purple-400 mt-0.5",children:""}),c.jsx("span",{children:y})]},x))})]}),c.jsx("div",{className:"flex items-center gap-2 mb-4",children:Array.from({length:a}).map((y,x)=>c.jsx("button",{onClick:()=>u(x),className:`h-1.5 rounded-full transition-all ${x===e?"w-6 bg-purple-500":"w-1.5 bg-border hover:bg-purple-500/50"}`},x))}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("button",{onClick:l,disabled:i,className:"flex items-center gap-1 px-3 py-2 text-xs rounded-lg bg-background-tertiary text-text-secondary hover:text-text-primary disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[c.jsx(Gj,{size:14}),"Back"]}),c.jsx("div",{className:"flex-1"}),c.jsx("button",{onClick:d,className:"px-3 py-2 text-xs text-text-muted hover:text-text-secondary transition-colors",children:"Skip Tour"}),c.jsxs("button",{onClick:o,className:"flex items-center gap-1 px-4 py-2 text-xs rounded-lg bg-gradient-to-r from-purple-600 to-pink-600 text-white font-medium hover:from-purple-500 hover:to-pink-500 transition-all",children:[n?"Get Started":"Next",!n&&c.jsx(Js,{size:14})]})]})]})]},`popover-${e}`)]},"mograph-tour-overlay")})},fK=()=>{const{project:r}=W(),{openModal:e,selectedItems:t,setExportState:s,keyframeEditorOpen:i,toggleKeyframeEditor:n}=Ft(),{mode:a,toggleTheme:o}=lu(),[l,d]=v.useState(!1),[u,h]=v.useState(!1),[p,f]=v.useState(!1),[m,g]=v.useState(!1),{importMedia:y}=W(),{track:x}=ff(),b=v.useCallback(()=>{localStorage.removeItem(Yh),aK()},[]),w=v.useCallback(()=>{localStorage.removeItem(Fy),uK()},[]),C=t.some(re=>re.type==="clip"||re.type==="text-clip"||re.type==="shape-clip"),[k,S]=v.useState({isExporting:!1,progress:0,phase:"",error:null,complete:!1}),[A,T]=v.useState(null),[j,_]=v.useState(new Map);v.useEffect(()=>{s({isExporting:k.isExporting,progress:k.progress,phase:k.phase})},[k.isExporting,k.progress,k.phase,s]),v.useEffect(()=>{l&&!A&&_y().then(T)},[l,A]),v.useEffect(()=>{if(!A||!r.timeline?.duration)return;const re=r.timeline.duration,ne=new Map,Ee=[{key:"mp4",width:r.settings.width,height:r.settings.height,frameRate:30,codec:"h264"},{key:"4k",width:3840,height:2160,frameRate:30,codec:"h264"},{key:"4k-60-master",width:3840,height:2160,frameRate:60,codec:"h264"},{key:"4k-master",width:3840,height:2160,frameRate:30,codec:"h264"},{key:"1080p-high",width:1920,height:1080,frameRate:30,codec:"h264"},{key:"1080p-60",width:1920,height:1080,frameRate:60,codec:"h264"},{key:"prores",width:r.settings.width,height:r.settings.height,frameRate:30,codec:"h264"}];for(const K of Ee){const me=UP(A,{width:K.width,height:K.height,frameRate:K.frameRate,duration:re,codec:K.codec});ne.set(K.key,me)}_(ne)},[A,r.timeline?.duration,r.settings.width,r.settings.height]);const M=v.useCallback(()=>{e("search")},[e]),P=v.useCallback(async re=>{d(!1),S({isExporting:!0,progress:0,phase:"Initializing...",error:null,complete:!1});try{const ne=dd();if(await ne.initialize(),re==="wav"){const Ee={format:"wav",sampleRate:48e3,channels:2,bitDepth:24},K=ne.exportAudio(r,Ee);let me;for(;;){const{value:$,done:Q}=await K.next();if(Q){me=$;break}S(le=>({...le,progress:$.progress*100,phase:$.phase==="complete"?"Complete!":`${$.phase}...`}))}if(me?.success&&me.blob)dg(me.blob,`${r.name||"export"}.wav`),S($=>({...$,complete:!0,phase:"Downloaded!"})),x(Nc.PROJECT_EXPORTED,{format:"wav",duration:r.timeline?.duration??0});else throw new Error(me?.error?.message||"Export failed")}else{const K=(()=>{const ae={width:r.settings.width,height:r.settings.height,frameRate:r.settings.frameRate};switch(re){case"project":return{...ae,format:"mov",codec:"prores",bitrate:22e4,quality:100};case"4k-60-master":return{...ae,width:3840,height:2160,frameRate:60,format:"mov",codec:"h265",bitrate:1e5,quality:95};case"4k-master":return{...ae,width:3840,height:2160,frameRate:30,format:"mov",codec:"h265",bitrate:8e4,quality:95};case"4k-prores":return{...ae,width:3840,height:2160,frameRate:30,format:"mov",codec:"prores",bitrate:88e4,quality:100};case"4k":return{...ae,width:3840,height:2160,frameRate:30,format:"mp4",codec:"h264",bitrate:5e4,quality:90};case"1080p-60":return{...ae,width:1920,height:1080,frameRate:60,format:"mp4",codec:"h264",bitrate:25e3,quality:95};case"1080p-high":return{...ae,width:1920,height:1080,frameRate:30,format:"mp4",codec:"h264",bitrate:2e4,quality:95};case"prores":return{...ae,format:"mov",codec:"prores",bitrate:22e4,quality:100};case"gif":return{...ae,format:"webm",codec:"vp9",bitrate:8e3};case"mp4":default:return{...ae,format:"mp4",codec:"h264",bitrate:12e3,quality:85}}})(),me=()=>{switch(re){case"4k-60-master":case"4k-master":case"4k-prores":case"prores":case"project":return"mov";case"gif":return"webm";default:return"mp4"}},$=()=>{switch(me()){case"mov":return"video/quicktime";case"webm":return"video/webm";default:return"video/mp4"}};let Q,le=!1;if("showSaveFilePicker"in window&&typeof window.showSaveFilePicker=="function")try{const ae=window.showSaveFilePicker;Q=await(await ae({suggestedName:`${r.name||"export"}.${me()}`,types:[{description:"Video file",accept:{[$()]:[`.${me()}`]}}]})).createWritable(),le=!0}catch(ae){if(ae.name==="AbortError"){S({isExporting:!1,progress:0,phase:"",error:null,complete:!1});return}le=!1}const ke=ne.exportVideoWithFFmpeg(r,K,Q);let de;for(;;){const{value:ae,done:Pe}=await ke.next();if(Pe){de=ae;break}S(z=>({...z,progress:ae.progress*100,phase:ae.phase==="complete"?"Complete!":`${ae.phase}...`}))}if(de?.success)if(x(Nc.PROJECT_EXPORTED,{format:K.format??"mp4",codec:K.codec??"h264",width:K.width??r.settings.width,height:K.height??r.settings.height,frameRate:K.frameRate??r.settings.frameRate,duration:r.timeline?.duration??0,exportType:re}),le)S(ae=>({...ae,complete:!0,phase:"Saved!"}));else if(de.blob)dg(de.blob,`${r.name||"export"}.${me()}`),S(ae=>({...ae,complete:!0,phase:"Downloaded!"}));else throw new Error("Export completed but no output generated");else throw new Error(de?.error?.message||"Export failed")}setTimeout(()=>{S({isExporting:!1,progress:0,phase:"",error:null,complete:!1})},2e3)}catch(ne){S(Ee=>({...Ee,isExporting:!1,error:ne instanceof Error?ne.message:"Export failed"}))}},[r,x]),R=v.useCallback(()=>{dd().cancel(),S({isExporting:!1,progress:0,phase:"",error:null,complete:!1})},[]),D=v.useCallback(async re=>{h(!1),S({isExporting:!0,progress:0,phase:"Initializing...",error:null,complete:!1});try{const ne=dd();await ne.initialize();const Ee=re.width>r.settings.width||re.height>r.settings.height,K={...re,upscaling:re.upscaling?.enabled&&Ee?re.upscaling:void 0},me=re.format==="mov"?"mov":re.format==="webm"?"webm":"mp4",$=()=>{switch(me){case"mov":return"video/quicktime";case"webm":return"video/webm";default:return"video/mp4"}};let Q,le=!1;if("showSaveFilePicker"in window&&typeof window.showSaveFilePicker=="function")try{const ae=window.showSaveFilePicker;Q=await(await ae({suggestedName:`${r.name||"export"}.${me}`,types:[{description:"Video file",accept:{[$()]:[`.${me}`]}}]})).createWritable(),le=!0}catch(ae){if(ae.name==="AbortError"){S({isExporting:!1,progress:0,phase:"",error:null,complete:!1});return}le=!1}const ke=ne.exportVideoWithFFmpeg(r,K,Q);let de;for(;;){const{value:ae,done:Pe}=await ke.next();if(Pe){de=ae;break}S(z=>({...z,progress:ae.progress*100,phase:ae.phase==="complete"?"Complete!":`${ae.phase}...`}))}if(de?.success)if(x(Nc.PROJECT_EXPORTED,{format:re.format,codec:re.codec,width:re.width,height:re.height,frameRate:re.frameRate,duration:r.timeline?.duration??0,exportType:"custom",upscaling:re.upscaling?.enabled??!1}),le)S(ae=>({...ae,complete:!0,phase:"Saved!"}));else if(de.blob)dg(de.blob,`${r.name||"export"}.${me}`),S(ae=>({...ae,complete:!0,phase:"Downloaded!"}));else throw new Error("Export completed but no output generated");else throw new Error(de?.error?.message||"Export failed");setTimeout(()=>{S({isExporting:!1,progress:0,phase:"",error:null,complete:!1})},2e3)}catch(ne){S(Ee=>({...Ee,isExporting:!1,error:ne instanceof Error?ne.message:"Export failed"}))}},[r,x]),B=v.useCallback(async(re,ne)=>{if(!re||re.size===0){Hs.error("Recording failed","No video data was captured. Please try again.");return}const Ee=new Date().toISOString().slice(0,19).replace(/[:-]/g,"");let K=0;const me=[],$=new File([re],`Screen_${Ee}.webm`,{type:re.type||"video/webm"}),Q=await y($);if(Q.success?K++:me.push(Q.error?.message||"Failed to import screen recording"),ne&&ne.size>0){const le=new File([ne],`Webcam_${Ee}.webm`,{type:ne.type||"video/webm"}),ke=await y(le);ke.success?K++:me.push(ke.error?.message||"Failed to import webcam recording")}K>0?Hs.success(`${K} recording${K>1?"s":""} imported!`,ne&&ne.size>0?"Screen and webcam added to assets. Use the timeline to composite them.":"Screen recording added to assets."):me.length>0&&Hs.error("Import failed",me.join(". "))},[y]),O=typeof window<"u"&&new URLSearchParams(window.location.search).get("embedded")==="true",[F,I]=v.useState(!1),J=v.useCallback(async()=>{console.log("[OpenReel] Send to Output clicked, project tracks:",r.timeline?.tracks?.length,"clips:",r.timeline?.tracks?.flatMap(re=>re.clips).length),I(!0),S({isExporting:!0,progress:0,phase:"Preparing export...",error:null,complete:!1});try{const re=dd();console.log("[OpenReel] Initializing export engine..."),await re.initialize(),console.log("[OpenReel] Export engine initialized");const ne={width:r.settings.width,height:r.settings.height,frameRate:r.settings.frameRate,format:"mp4",codec:"h264",bitrate:12e3,quality:85},Ee=r.timeline?.duration,K=r.timeline?.tracks?Math.max(...r.timeline.tracks.flatMap(le=>le.clips.map(ke=>ke.startTime+(ke.outPoint-ke.inPoint)))):0,me=Ee&&Ee>0?Ee:K;console.log("[OpenReel] Starting FFmpeg export with settings:",ne),console.log("[OpenReel] Export duration - Manual:",Ee,"Calculated:",K,"Using:",me),alert(`Export starting:
Manual duration: ${Ee}s
Calculated duration: ${K.toFixed(2)}s
Will export: ${me}s`);const $=re.exportVideoWithFFmpeg(r,ne);let Q;for(;;){const{value:le,done:ke}=await $.next();if(ke){Q=le;break}S(de=>({...de,progress:le.progress*100,phase:le.phase==="complete"?"Complete!":`${le.phase}...`}))}if(console.log("[OpenReel] Export result:",{success:Q?.success,blobSize:Q?.blob?.size,error:Q?.error}),Q?.success&&Q.blob){S(Pe=>({...Pe,phase:"Uploading to ComfyUI..."}));const le=new FormData,de=`openreel_export_${Date.now()}.mp4`;le.append("image",new File([Q.blob],de,{type:"video/mp4"})),le.append("type","input"),le.append("overwrite","true"),console.log("[OpenReel] Uploading",de,"size:",Q.blob.size);const ae=await fetch("/upload/image",{method:"POST",body:le});if(ae.ok){const z=(await ae.json()).name||de;console.log("[OpenReel] Upload success:",z),window.parent!==window&&(window.parent.postMessage({type:"openreel-video-output",filename:z},"*"),console.log("[OpenReel] postMessage sent to parent:",z)),Hs.success("Sent to Output",`Video saved as ${z}`)}else throw new Error("Upload failed: "+ae.statusText)}else throw new Error(Q?.error?.message||"Export failed")}catch(re){console.error("[OpenReel] Send to Output error:",re);const ne=re instanceof Error?re.message:"Send to output failed";Hs.error("Send to Output Failed",ne)}finally{I(!1),S({isExporting:!1,progress:0,phase:"",error:null,complete:!1})}},[r]),Z=`${r.settings.width}${r.settings.height}`,E=r.settings.width/r.settings.height,G=E<.9,V=E>=.9&&E<=1.1,oe=[{label:G?"TikTok / Reels / Shorts":V?"Instagram Feed":"YouTube / Social",icon:ci,desc:`${Z} H.264 - Best for your video`,type:"mp4",recommended:!0},{label:"Project Resolution",icon:pa,desc:`${Z} H.264 - High quality`,type:"project"},{label:"",icon:pa,desc:"",type:"mp4",separator:!0},...G?[]:[{label:"4K Standard",icon:no,desc:"38402160 - YouTube 4K",type:"4k"}],{label:"1080p High Quality",icon:no,desc:"19201080 30fps - High bitrate",type:"1080p-high"},{label:"1080p 60fps",icon:no,desc:"19201080 - Smooth playback",type:"1080p-60"},{label:"MP4 Standard",icon:no,desc:`${Z} - Web & social`,type:"mp4"},{label:"Audio Only (WAV)",icon:Gr,desc:"Uncompressed audio",type:"wav"}];return c.jsxs("div",{className:"h-16 border-b border-border flex items-center px-6 justify-between bg-background shrink-0 z-30 relative",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-8 h-8 group",children:c.jsxs("svg",{viewBox:"0 0 490 490",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full text-primary group-hover:scale-110 transition-transform duration-300",children:[c.jsx("path",{d:"M245 24.5C123.223 24.5 24.5 123.223 24.5 245s98.723 220.5 220.5 220.5 220.5-98.723 220.5-220.5S366.777 24.5 245 24.5Z",stroke:"currentColor",strokeWidth:"30.625",className:"opacity-100"}),c.jsxs("g",{className:"origin-center group-hover:rotate-90 transition-transform duration-500 ease-out",children:[c.jsx("path",{d:"M245 98v73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M392 245h-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M245 392v-73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"M98 245h73.5",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 141.059-51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m348.941 348.941-51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 348.941 51.965-51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"}),c.jsx("path",{d:"m141.059 141.059 51.965 51.965",stroke:"currentColor",strokeWidth:"24.5",strokeLinecap:"round"})]}),c.jsx("path",{d:"M294 245a49 49 0 0 1-49 49 49 49 0 0 1-49-49 49 49 0 0 1 98 0",fill:"currentColor",className:"group-hover:fill-white transition-colors duration-300"})]})}),c.jsxs("div",{className:"hidden lg:flex flex-col leading-tight",children:[c.jsx("span",{className:"text-lg font-medium text-text-primary tracking-wide",children:"Open Reel"}),c.jsxs("span",{className:"absolute top-[40px] left-[98px] text-[9px] font-medium text-text-secondary tracking-widest opacity-60",children:["for ",c.jsx("span",{className:"font-bold",style:{color:"#e4f541"},children:"ComfyUI"})]})]})]}),c.jsx("div",{className:"h-6 w-px bg-border hidden md:block"}),c.jsx(sK,{})]}),c.jsxs("div",{className:"flex-1 max-w-2xl mx-12 relative group",children:[c.jsx("div",{className:`absolute inset-0 bg-primary/20 rounded-xl blur-md transition-opacity duration-300 ${C?"opacity-100 animate-pulse":"opacity-0 group-hover:opacity-100"}`}),c.jsxs("button",{onClick:M,className:`relative w-full bg-background-secondary border rounded-xl h-10 flex items-center px-4 gap-3 transition-all text-left shadow-inner ${C?"border-primary/50 ring-1 ring-primary/30":"border-border group-hover:border-primary/50"}`,children:[c.jsx(jo,{size:16,className:`transition-colors ${C?"text-primary":"text-text-muted group-hover:text-primary"}`}),c.jsx("span",{className:`flex-1 text-sm transition-colors ${C?"text-text-secondary":"text-text-muted group-hover:text-text-secondary"}`,children:C?"Search effects for selected clip...":"Search tools, effects, or ask AI..."}),c.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded border border-border bg-background-tertiary",children:[c.jsx(Pw,{size:10,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:"K"})]})]})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs(Sp,{children:[c.jsx(Tp,{asChild:!0,children:c.jsx("button",{className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:c.jsx(cL,{size:16})})}),c.jsxs(Qd,{align:"end",className:"w-56",children:[c.jsxs(Zi,{onClick:b,className:"gap-2",children:[c.jsx(ti,{size:14}),c.jsx("span",{children:"Editor Tour"})]}),c.jsxs(Zi,{onClick:w,className:"gap-2",children:[c.jsx(Zp,{size:14,className:"text-purple-400"}),c.jsx("span",{children:"Animation & Effects Tour"})]}),c.jsx(Sd,{}),c.jsxs(Zi,{className:"gap-2 text-text-muted",children:[c.jsx(Pw,{size:14}),c.jsx("span",{children:"Press ? for shortcuts"})]})]})]}),!O&&c.jsxs($a,{children:[c.jsx(za,{asChild:!0,children:c.jsx("button",{onClick:o,className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:a==="light"?c.jsx(c$,{size:16}):a==="dark"?c.jsx(xO,{size:16}):c.jsx(a$,{size:16})})}),c.jsx(Hn,{children:c.jsxs("p",{children:["Theme: ",a]})})]}),O&&c.jsxs($a,{children:[c.jsx(za,{asChild:!0,children:c.jsx("button",{onClick:()=>{const re=new URL(window.location.href);re.search="",window.open(re.toString(),"_blank")},className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:c.jsx(S0,{size:16})})}),c.jsx(Hn,{children:c.jsx("p",{children:"Launch in new tab"})})]}),c.jsxs($a,{children:[c.jsx(za,{asChild:!0,children:c.jsx("button",{onClick:()=>Ft.getState().openModal("scriptView"),className:"p-2 rounded-lg hover:bg-background-elevated text-text-secondary hover:text-text-primary transition-colors",children:c.jsx(zc,{size:16})})}),c.jsx(Hn,{children:c.jsx("p",{children:"Script View - View/Import JSON"})})]}),c.jsxs($a,{children:[c.jsx(za,{asChild:!0,children:c.jsx("button",{onClick:n,className:`p-2 rounded-lg transition-colors ${i?"bg-primary/20 text-primary":"hover:bg-background-elevated text-text-secondary hover:text-text-primary"}`,children:c.jsx(Jp,{size:16})})}),c.jsx(Hn,{children:c.jsx("p",{children:"Keyframe Editor"})})]}),c.jsxs($a,{children:[c.jsx(za,{asChild:!0,children:c.jsx("button",{onClick:()=>g(!m),className:`p-2 rounded-lg transition-colors ${m?"bg-primary/20 text-primary":"hover:bg-background-elevated text-text-secondary hover:text-text-primary"}`,children:c.jsx(Ph,{size:16})})}),c.jsx(Hn,{children:c.jsx("p",{children:"History - Undo/Redo"})})]}),c.jsxs($a,{children:[c.jsx(za,{asChild:!0,children:c.jsxs("button",{onClick:()=>f(!0),className:"flex items-center gap-2 px-3 py-2 bg-error/10 hover:bg-error/20 text-error rounded-lg transition-colors",children:[c.jsx(Vr,{size:14,className:"fill-current"}),c.jsx("span",{className:"text-sm font-medium",children:"Record"})]})}),c.jsx(Hn,{children:c.jsx("p",{children:"Screen Recording"})})]}),O&&c.jsxs($a,{children:[c.jsx(za,{asChild:!0,children:c.jsxs("button",{onClick:J,disabled:F||k.isExporting,className:"h-10 px-4 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold rounded-lg flex items-center gap-2 transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)] hover:shadow-[0_0_30px_rgba(59,130,246,0.5)] transform hover:-translate-y-0.5",children:[c.jsx(ef,{size:14}),c.jsx("span",{className:"text-sm tracking-wider",children:F?"SENDING...":"SEND TO OUTPUT"})]})}),c.jsx(Hn,{children:c.jsx("p",{children:"Export and send video to ComfyUI"})})]}),c.jsx("div",{className:"relative",children:k.isExporting?c.jsxs("div",{className:"h-10 px-4 bg-background-secondary border border-border rounded-lg flex items-center gap-3 min-w-[200px]",children:[c.jsx(Ci,{size:14,className:"text-primary animate-spin"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-[10px] text-text-secondary",children:k.phase}),c.jsx("div",{className:"h-1 bg-background-tertiary rounded-full mt-1 overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-200",style:{width:`${k.progress}%`}})})]}),c.jsx("button",{onClick:R,className:"p-1 hover:bg-background-tertiary rounded text-text-muted hover:text-error transition-colors",children:c.jsx(Zs,{size:12})})]}):k.error?c.jsxs("div",{className:"h-10 px-4 bg-error/10 border border-error/30 rounded-lg flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-error",children:k.error}),c.jsx("button",{onClick:()=>S(re=>({...re,error:null})),className:"p-1 hover:bg-error/20 rounded text-error transition-colors",children:c.jsx(Zs,{size:12})})]}):k.complete?c.jsxs("div",{className:"h-10 px-4 bg-primary/10 border border-primary/30 rounded-lg flex items-center gap-2",children:[c.jsx(Ei,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-xs text-primary",children:"Downloaded!"})]}):c.jsxs(Sp,{open:l,onOpenChange:d,children:[c.jsx(Tp,{asChild:!0,children:c.jsxs("button",{className:`h-10 px-4 bg-primary hover:bg-primary-hover active:bg-primary-active text-white font-bold rounded-lg flex items-center gap-2 transition-all shadow-[0_0_20px_rgba(34,197,94,0.3)] hover:shadow-[0_0_30px_rgba(34,197,94,0.5)] transform hover:-translate-y-0.5 ${l?"translate-y-0 shadow-none":""}`,children:[c.jsx("span",{className:"text-sm tracking-wider",children:"EXPORT"}),c.jsx(ls,{size:14,className:`transition-transform duration-200 ${l?"rotate-180":""}`})]})}),c.jsxs(Qd,{align:"end",className:"w-72 p-0 rounded-xl bg-background-secondary border-border",children:[c.jsxs("div",{className:"p-3 space-y-1 max-h-[400px] overflow-y-auto",children:[oe.map((re,ne)=>re.separator?c.jsx(Sd,{},`sep-${ne}`):c.jsxs(Zi,{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer ${re.recommended?"bg-primary/10 hover:bg-primary/20 border border-primary/30":""}`,onClick:()=>P(re.type),children:[c.jsx("div",{className:`p-2 rounded-lg transition-colors ${re.recommended?"bg-primary/20 text-primary":"bg-background-tertiary group-hover:bg-background-elevated text-text-secondary group-hover:text-primary"}`,children:c.jsx(re.icon,{size:18})}),c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:`text-sm font-medium transition-colors ${re.recommended?"text-primary":"text-text-primary"}`,children:[re.label,re.recommended&&c.jsx("span",{className:"ml-2 text-[10px] bg-primary/20 text-primary px-1.5 py-0.5 rounded",children:"Best Match"})]}),c.jsx("div",{className:"text-xs text-text-muted mt-0.5",children:re.desc}),j.get(re.type)&&c.jsxs("div",{className:"text-[10px] text-text-secondary mt-1",children:["Est. ",j.get(re.type)?.formatted]})]})]},re.type+ne)),c.jsx(Sd,{}),c.jsxs(Zi,{className:"flex items-center gap-3 p-3 rounded-lg cursor-pointer",onClick:()=>h(!0),children:[c.jsx("div",{className:"p-2 bg-primary/10 rounded-lg text-primary transition-colors",children:c.jsx(Vc,{size:18})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-sm font-medium text-primary transition-colors",children:"Custom Export..."}),c.jsx("div",{className:"text-xs text-text-muted mt-0.5",children:"Full settings with AI upscaling"})]}),c.jsx(Vc,{size:14,className:"text-text-muted"})]})]}),c.jsxs("div",{className:"bg-background-tertiary px-3 py-2.5 text-xs text-center text-text-muted border-t border-border",children:[r.settings.width,"",r.settings.height," "," ",r.settings.frameRate,"fps"]})]})]})})]}),c.jsx(q7,{isOpen:u,onClose:()=>h(!1),onExport:D,duration:r.timeline?.duration??0,projectWidth:r.settings?.width??1920,projectHeight:r.settings?.height??1080}),c.jsx(Z7,{isOpen:p,onClose:()=>f(!1),onRecordingComplete:B}),m&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 bg-black/20 z-40",onClick:()=>g(!1)}),c.jsxs("div",{className:"fixed top-16 right-0 bottom-0 w-80 bg-background-secondary border-l border-border z-50 shadow-2xl animate-in slide-in-from-right duration-200",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-border",children:[c.jsx("span",{className:"text-sm font-medium text-text-primary",children:"Action History"}),c.jsx("button",{onClick:()=>g(!1),className:"p-1.5 rounded hover:bg-background-tertiary text-text-muted hover:text-text-primary transition-colors",children:c.jsx(Zs,{size:14})})]}),c.jsx("div",{className:"h-[calc(100%-49px)]",children:c.jsx(eK,{})})]})]})]})},Tn=(r,e)=>{const t=document.createElement("canvas");return t.width=r,t.height=e,t},zn=r=>(e,t)=>{const s=Tn(e,t),i=s.getContext("2d");return i.fillStyle=r,i.fillRect(0,0,e,t),s},Vn=(r,e=180)=>(t,s)=>{const i=Tn(t,s),n=i.getContext("2d"),a=(e-90)*(Math.PI/180),o=t/2-Math.cos(a)*t,l=s/2-Math.sin(a)*s,d=t/2+Math.cos(a)*t,u=s/2+Math.sin(a)*s,h=n.createLinearGradient(o,l,d,u);return r.forEach((p,f)=>h.addColorStop(f/(r.length-1),p)),n.fillStyle=h,n.fillRect(0,0,t,s),i},P2=r=>(e,t)=>{const s=Tn(e,t),i=s.getContext("2d"),n=i.createRadialGradient(e/2,t/2,0,e/2,t/2,Math.max(e,t)/2);return r.forEach((a,o)=>n.addColorStop(o/(r.length-1),a)),i.fillStyle=n,i.fillRect(0,0,e,t),s},yh=r=>(e,t)=>{const s=Tn(e,t),i=s.getContext("2d");i.fillStyle=r[0],i.fillRect(0,0,e,t);const n=[{x:.2,y:.3,r:.6,color:r[1]||r[0]},{x:.8,y:.2,r:.5,color:r[2]||r[1]||r[0]},{x:.5,y:.8,r:.55,color:r[3]||r[2]||r[0]},{x:.1,y:.9,r:.4,color:r[4]||r[1]||r[0]}];for(const a of n){const o=i.createRadialGradient(a.x*e,a.y*t,0,a.x*e,a.y*t,a.r*Math.max(e,t));o.addColorStop(0,a.color),o.addColorStop(1,"transparent"),i.fillStyle=o,i.fillRect(0,0,e,t)}return s},mK=(r,e=.1)=>(t,s)=>{const i=Tn(t,s),n=i.getContext("2d");n.fillStyle=r,n.fillRect(0,0,t,s);const a=n.getImageData(0,0,t,s),o=a.data;for(let l=0;l<o.length;l+=4){const d=(Math.random()-.5)*255*e;o[l]=Math.min(255,Math.max(0,o[l]+d)),o[l+1]=Math.min(255,Math.max(0,o[l+1]+d)),o[l+2]=Math.min(255,Math.max(0,o[l+2]+d))}return n.putImageData(a,0,0),i},N2=(r,e,t=40)=>(s,i)=>{const n=Tn(s,i),a=n.getContext("2d");a.fillStyle=r,a.fillRect(0,0,s,i),a.strokeStyle=e,a.lineWidth=1;for(let o=0;o<=s;o+=t)a.beginPath(),a.moveTo(o,0),a.lineTo(o,i),a.stroke();for(let o=0;o<=i;o+=t)a.beginPath(),a.moveTo(0,o),a.lineTo(s,o),a.stroke();return n},R2=(r,e,t=30,s=3)=>(i,n)=>{const a=Tn(i,n),o=a.getContext("2d");o.fillStyle=r,o.fillRect(0,0,i,n),o.fillStyle=e;for(let l=t/2;l<i;l+=t)for(let d=t/2;d<n;d+=t)o.beginPath(),o.arc(l,d,s,0,Math.PI*2),o.fill();return a},I2=r=>(e,t)=>{const s=Tn(e,t),i=s.getContext("2d"),n=i.createLinearGradient(0,0,0,t);r.forEach((o,l)=>n.addColorStop(l/(r.length-1),o)),i.fillStyle=n,i.fillRect(0,0,e,t),i.globalAlpha=.3;const a=["rgba(255,255,255,0.1)","rgba(255,255,255,0.15)","rgba(255,255,255,0.08)"];for(let o=0;o<3;o++){i.fillStyle=a[o],i.beginPath(),i.moveTo(0,t);const l=30+o*20,d=.005-o*.001,u=o*100;for(let h=0;h<=e;h+=5){const p=t*(.5+o*.15)+Math.sin(h*d+u)*l;i.lineTo(h,p)}i.lineTo(e,t),i.closePath(),i.fill()}return i.globalAlpha=1,s},gK=r=>(e,t)=>{const s=Tn(e,t),i=s.getContext("2d"),n=i.createLinearGradient(0,0,0,t);n.addColorStop(0,"#0f0c29"),n.addColorStop(.5,"#302b63"),n.addColorStop(1,"#24243e"),i.fillStyle=n,i.fillRect(0,0,e,t);for(let a=0;a<r.length;a++){i.globalAlpha=.4;const o=i.createRadialGradient(e*(.2+a*.3),t*.3,0,e*(.2+a*.3),t*.3,t*.8);o.addColorStop(0,r[a]),o.addColorStop(1,"transparent"),i.fillStyle=o,i.fillRect(0,0,e,t)}return i.globalAlpha=1,s},yK=[{id:"solid-black",name:"Black",category:"solid",generate:zn("#000000"),thumbnail:"linear-gradient(#000000, #000000)"},{id:"solid-white",name:"White",category:"solid",generate:zn("#ffffff"),thumbnail:"linear-gradient(#ffffff, #ffffff)"},{id:"solid-slate",name:"Slate",category:"solid",generate:zn("#1e293b"),thumbnail:"linear-gradient(#1e293b, #1e293b)"},{id:"solid-zinc",name:"Zinc",category:"solid",generate:zn("#27272a"),thumbnail:"linear-gradient(#27272a, #27272a)"},{id:"solid-red",name:"Red",category:"solid",generate:zn("#dc2626"),thumbnail:"linear-gradient(#dc2626, #dc2626)"},{id:"solid-blue",name:"Blue",category:"solid",generate:zn("#2563eb"),thumbnail:"linear-gradient(#2563eb, #2563eb)"},{id:"solid-green",name:"Green",category:"solid",generate:zn("#16a34a"),thumbnail:"linear-gradient(#16a34a, #16a34a)"},{id:"solid-purple",name:"Purple",category:"solid",generate:zn("#9333ea"),thumbnail:"linear-gradient(#9333ea, #9333ea)"},{id:"gradient-sunset",name:"Sunset",category:"gradient",generate:Vn(["#f97316","#ec4899","#8b5cf6"],135),thumbnail:"linear-gradient(135deg, #f97316, #ec4899, #8b5cf6)"},{id:"gradient-ocean",name:"Ocean",category:"gradient",generate:Vn(["#0ea5e9","#06b6d4","#14b8a6"],180),thumbnail:"linear-gradient(180deg, #0ea5e9, #06b6d4, #14b8a6)"},{id:"gradient-forest",name:"Forest",category:"gradient",generate:Vn(["#166534","#15803d","#22c55e"],180),thumbnail:"linear-gradient(180deg, #166534, #15803d, #22c55e)"},{id:"gradient-lavender",name:"Lavender",category:"gradient",generate:Vn(["#c084fc","#a78bfa","#818cf8"],135),thumbnail:"linear-gradient(135deg, #c084fc, #a78bfa, #818cf8)"},{id:"gradient-midnight",name:"Midnight",category:"gradient",generate:Vn(["#0f172a","#1e3a5f","#1e40af"],180),thumbnail:"linear-gradient(180deg, #0f172a, #1e3a5f, #1e40af)"},{id:"gradient-rose",name:"Rose",category:"gradient",generate:Vn(["#fda4af","#fb7185","#e11d48"],180),thumbnail:"linear-gradient(180deg, #fda4af, #fb7185, #e11d48)"},{id:"gradient-gold",name:"Gold",category:"gradient",generate:Vn(["#fbbf24","#f59e0b","#d97706"],135),thumbnail:"linear-gradient(135deg, #fbbf24, #f59e0b, #d97706)"},{id:"gradient-noir",name:"Noir",category:"gradient",generate:Vn(["#18181b","#27272a","#3f3f46"],180),thumbnail:"linear-gradient(180deg, #18181b, #27272a, #3f3f46)"},{id:"radial-spotlight",name:"Spotlight",category:"gradient",generate:P2(["#374151","#111827"]),thumbnail:"radial-gradient(circle, #374151, #111827)"},{id:"radial-glow",name:"Glow",category:"gradient",generate:P2(["#7c3aed","#4c1d95","#1e1b4b"]),thumbnail:"radial-gradient(circle, #7c3aed, #4c1d95, #1e1b4b)"},{id:"mesh-aurora",name:"Aurora",category:"mesh",generate:yh(["#0f172a","#06b6d4","#8b5cf6","#ec4899","#f97316"]),thumbnail:"linear-gradient(135deg, #06b6d4, #8b5cf6, #ec4899)"},{id:"mesh-nebula",name:"Nebula",category:"mesh",generate:yh(["#0c0a1d","#7c3aed","#db2777","#f97316","#06b6d4"]),thumbnail:"linear-gradient(135deg, #7c3aed, #db2777, #f97316)"},{id:"mesh-candy",name:"Candy",category:"mesh",generate:yh(["#fdf2f8","#f472b6","#a78bfa","#38bdf8","#34d399"]),thumbnail:"linear-gradient(135deg, #f472b6, #a78bfa, #38bdf8)"},{id:"mesh-sunset-beach",name:"Beach",category:"mesh",generate:yh(["#1e3a5f","#f97316","#fbbf24","#ec4899","#06b6d4"]),thumbnail:"linear-gradient(135deg, #f97316, #ec4899, #06b6d4)"},{id:"pattern-grid-dark",name:"Grid Dark",category:"pattern",generate:N2("#0f0f11","rgba(255,255,255,0.1)"),thumbnail:"linear-gradient(#0f0f11, #0f0f11)"},{id:"pattern-grid-light",name:"Grid Light",category:"pattern",generate:N2("#f8fafc","rgba(0,0,0,0.08)"),thumbnail:"linear-gradient(#f8fafc, #f8fafc)"},{id:"pattern-dots-dark",name:"Dots Dark",category:"pattern",generate:R2("#18181b","rgba(255,255,255,0.15)"),thumbnail:"linear-gradient(#18181b, #18181b)"},{id:"pattern-dots-light",name:"Dots Light",category:"pattern",generate:R2("#ffffff","rgba(0,0,0,0.1)"),thumbnail:"linear-gradient(#ffffff, #ffffff)"},{id:"pattern-noise-dark",name:"Film Grain",category:"pattern",generate:mK("#1a1a1a",.15),thumbnail:"linear-gradient(#1a1a1a, #1a1a1a)"},{id:"waves-ocean",name:"Ocean Waves",category:"mesh",generate:I2(["#0c4a6e","#0284c7","#38bdf8"]),thumbnail:"linear-gradient(180deg, #0c4a6e, #0284c7, #38bdf8)"},{id:"waves-sunset",name:"Sunset Waves",category:"mesh",generate:I2(["#7c2d12","#ea580c","#fbbf24"]),thumbnail:"linear-gradient(180deg, #7c2d12, #ea580c, #fbbf24)"},{id:"aurora-borealis",name:"Borealis",category:"mesh",generate:gK(["#22d3ee","#a78bfa","#34d399"]),thumbnail:"linear-gradient(180deg, #0f0c29, #302b63, #24243e)"}];async function xK(r,e=1920,t=1080){const s=r.generate(e,t);return new Promise((i,n)=>{s.toBlob(a=>{a?i(a):n(new Error("Failed to generate background blob"))},"image/png",1)})}const bK=({isOpen:r,videoWidth:e,videoHeight:t,currentWidth:s,currentHeight:i,onConfirm:n,onCancel:a})=>{const o=(e/t).toFixed(2),l=(s/i).toFixed(2);return c.jsx(Ta,{open:r,onOpenChange:d=>!d&&a(),children:c.jsxs(Sn,{className:"max-w-md",children:[c.jsx(Aa,{children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:c.jsx(Ca,{size:20,className:"text-primary"})}),c.jsxs("div",{children:[c.jsx(ja,{children:"Match Video Dimensions?"}),c.jsx(ku,{className:"mt-1",children:"The video you're adding has different dimensions than your current project settings."})]})]})}),c.jsxs("div",{className:"space-y-4 py-4",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background-tertiary",children:c.jsxs("div",{children:[c.jsx("div",{className:"text-xs text-text-tertiary mb-1",children:"Video Dimensions"}),c.jsxs("div",{className:"text-sm font-medium text-text-primary",children:[e,"  ",t]}),c.jsxs("div",{className:"text-xs text-text-tertiary mt-0.5",children:["Aspect Ratio: ",o]})]})}),c.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background-tertiary/50 border border-border/50",children:c.jsxs("div",{children:[c.jsx("div",{className:"text-xs text-text-tertiary mb-1",children:"Current Project"}),c.jsxs("div",{className:"text-sm font-medium text-text-primary",children:[s,"  ",i]}),c.jsxs("div",{className:"text-xs text-text-tertiary mt-0.5",children:["Aspect Ratio: ",l]})]})})]}),c.jsx("p",{className:"text-xs text-text-tertiary",children:"Updating the project dimensions will provide the best editing experience and prevent cropping during export."})]}),c.jsxs("div",{className:"flex gap-3",children:[c.jsx(Et,{variant:"outline",className:"flex-1",onClick:a,children:"Keep Current"}),c.jsx(Et,{className:"flex-1",onClick:n,children:"Match Video"})]})]})})},vK=r=>{const e=Math.floor(r/60),t=Math.floor(r%60);return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`},wK=({item:r,isSelected:e,onSelect:t,onDelete:s,onReplace:i,onDragStart:n,onAddToTimeline:a})=>{const[o,l]=v.useState(!1),u=(()=>{switch(r.type){case"video":return pa;case"audio":return Gr;case"image":return Eo;default:return pa}})(),h=()=>r.metadata?.width&&r.metadata?.height?`${r.metadata.width}${r.metadata.height}`:null,p=f=>f?f<1024?`${f} B`:f<1024*1024?`${(f/1024).toFixed(1)} KB`:`${(f/(1024*1024)).toFixed(1)} MB`:null;return c.jsxs("div",{className:"flex flex-col",children:[c.jsxs("div",{draggable:!0,onDragStart:n,onClick:t,onDoubleClick:f=>{f.stopPropagation(),a()},onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),className:`aspect-video bg-background-tertiary rounded-lg border-2 relative group cursor-pointer transition-all overflow-hidden shadow-sm ${r.isPlaceholder?"border-yellow-500 ring-1 ring-yellow-500/50 shadow-[0_0_10px_rgba(234,179,8,0.3)]":e?"border-primary ring-1 ring-primary/50 shadow-[0_0_10px_rgba(34,197,94,0.2)]":"border-border hover:border-text-secondary"}`,children:[r.thumbnailUrl?c.jsx("img",{src:r.thumbnailUrl,alt:r.name,className:"w-full h-full object-cover"}):c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background-tertiary",children:c.jsx(u,{size:24,className:`${r.type==="audio"||r.type==="image"?"text-primary/50":"text-status-info/50"}`})}),r.type==="audio"&&c.jsx("div",{className:"absolute top-1/2 left-0 right-0 h-4 flex items-center gap-px px-2 -translate-y-1/2",children:[...Array(10)].map((f,m)=>c.jsx("div",{className:"flex-1 bg-primary/30 rounded-full",style:{height:`${Math.random()*100}%`}},m))}),r.isPlaceholder&&c.jsxs("div",{className:"absolute top-1 left-1 px-1.5 py-0.5 bg-yellow-500 rounded text-[8px] text-black font-bold flex items-center gap-1",children:[c.jsx(_o,{size:10}),"Missing"]}),r.metadata?.duration&&c.jsx("div",{className:"absolute bottom-1 right-1 px-1.5 py-0.5 bg-black/70 rounded text-[9px] text-white font-mono",children:vK(r.metadata.duration)}),r.isPlaceholder&&!o&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-yellow-500/10",children:c.jsx(_o,{size:32,className:"text-yellow-500/50"})}),o&&c.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[1px] flex items-center justify-center gap-2 animate-in fade-in duration-200",children:r.isPlaceholder?c.jsx("button",{onClick:f=>{f.stopPropagation(),i()},title:"Replace asset",className:"p-2 bg-yellow-500/20 rounded-full hover:bg-yellow-500/40 backdrop-blur-sm transition-colors",children:c.jsx(il,{size:14,className:"text-yellow-500"})}):c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:f=>{f.stopPropagation(),a()},title:"Add to timeline",className:"p-2 bg-primary/20 rounded-full hover:bg-primary/40 backdrop-blur-sm transition-colors",children:c.jsx(wr,{size:14,className:"text-primary"})}),c.jsx("button",{onClick:f=>{f.stopPropagation(),s()},title:"Delete",className:"p-2 bg-red-500/20 rounded-full hover:bg-red-500/40 backdrop-blur-sm transition-colors",children:c.jsx(Ss,{size:14,className:"text-red-400"})})]})}),e&&c.jsx("div",{className:"absolute top-1 right-1 w-2 h-2 bg-primary rounded-full shadow-[0_0_8px_#22c55e]"})]}),c.jsxs("div",{className:"mt-1.5 px-0.5",children:[c.jsx("div",{className:`text-[10px] truncate font-medium ${e?"text-primary":"text-text-primary"}`,title:r.name,children:r.name}),c.jsxs("div",{className:"flex items-center gap-1.5 text-[9px] text-text-muted mt-0.5",children:[h()&&c.jsx("span",{children:h()}),h()&&p(r.metadata?.fileSize)&&c.jsx("span",{children:""}),p(r.metadata?.fileSize)&&c.jsx("span",{children:p(r.metadata?.fileSize)})]})]})]})},kK=({onImport:r})=>c.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center",children:[c.jsx("div",{className:"w-16 h-16 rounded-2xl bg-background-tertiary border border-border flex items-center justify-center mb-4 shadow-inner",children:c.jsx(ef,{size:24,className:"text-text-muted"})}),c.jsx("p",{className:"text-sm text-text-secondary mb-2 font-medium",children:"No media imported"}),c.jsx("p",{className:"text-xs text-text-muted mb-6",children:"Drag files here or click to import"}),c.jsx("button",{onClick:r,className:"px-4 py-2 bg-background-elevated hover:bg-background-tertiary border border-border text-text-primary text-xs font-medium rounded-lg transition-all hover:border-primary/50",children:"Import Media"})]}),CK=({message:r})=>c.jsxs("div",{className:"absolute inset-0 bg-background-secondary/90 backdrop-blur-sm flex flex-col items-center justify-center z-50",children:[c.jsx("div",{className:"w-10 h-10 border-2 border-primary border-t-transparent rounded-full animate-spin mb-3"}),c.jsx("p",{className:"text-sm text-text-secondary",children:r})]}),SK=()=>{const r=v.useRef(null),[e,t]=v.useState(""),[s,i]=v.useState("media"),[n,a]=v.useState(!1),[o,l]=v.useState(!1),[d,u]=v.useState(""),[h,p]=v.useState(!1),[f,m]=v.useState(!1),[g,y]=v.useState(null),[x,b]=v.useState(null),[w,C]=v.useState("all"),{project:k,importMedia:S,deleteMedia:A,replaceMediaAsset:T,updateSettings:j}=W(),_=k.mediaLibrary.items,{select:M,isSelected:P,startDrag:R}=Ft(),D=_.filter($=>$.isPlaceholder).length,B=_.filter($=>{const Q=$.name.toLowerCase().includes(e.toLowerCase()),le=h?$.isPlaceholder:!0;return Q&&le}),O=v.useCallback(async $=>{if(!$||$.length===0)return;l(!0);const Q=Array.from($);try{for(let le=0;le<Q.length;le++){const ke=Q[le];u(`Importing ${ke.name} (${le+1}/${Q.length})...`),(await S(ke)).success&&ke.type.startsWith("video/")&&u(`Extracting audio from ${ke.name}...`)}}catch(le){console.error("Import failed:",le)}finally{l(!1),u("")}},[S]),F=v.useCallback($=>{$.preventDefault(),a(!1),O($.dataTransfer.files)},[O]),I=v.useCallback($=>{$.preventDefault(),a(!0)},[]),J=v.useCallback(()=>{a(!1)},[]),Z=v.useCallback($=>{M({type:"clip",id:$})},[M]),E=v.useCallback(async $=>{await A($)},[A]),G=v.useCallback(async $=>{const Q=document.createElement("input");Q.type="file",Q.accept="video/*,audio/*,image/*",Q.onchange=async le=>{const ke=le.target.files?.[0];if(ke){l(!0),u("Replacing asset...");try{await T($,ke)}catch(de){console.error("Asset replacement failed:",de)}finally{l(!1),u("")}}},Q.click()},[T]),V=v.useCallback(($,Q)=>{$.dataTransfer.setData("application/json",JSON.stringify({mediaId:Q.id})),$.dataTransfer.effectAllowed="copy",R("media",{mediaId:Q.id,mediaType:Q.type})},[R]),U=v.useCallback(async $=>{const{addClipToNewTrack:Q}=W.getState();await Q($.id)},[]),oe=v.useCallback(async()=>{if(!g)return;await j({width:g.videoWidth,height:g.videoHeight});const $=g.itemToAdd;m(!1),y(null),await U($)},[g,j,U]),re=v.useCallback(async()=>{if(!g)return;const $=g.itemToAdd;m(!1),y(null),await U($)},[g,U]),ne=v.useCallback(async $=>{const{project:Q}=W.getState();if(!Q.timeline.tracks.some(de=>de.clips.length>0)&&$.type==="video"&&$.metadata?.width&&$.metadata?.height){const de=$.metadata.width,ae=$.metadata.height,Pe=Q.settings.width,z=Q.settings.height;if(de!==Pe||ae!==z){y({videoWidth:de,videoHeight:ae,itemToAdd:$}),m(!0);return}}await U($)},[U]),Ee=v.useCallback(()=>{r.current?.click()},[]),K=v.useCallback(async $=>{console.log("[AssetsPanel] Starting background import:",$.name),b($.id);try{const{width:Q,height:le}=k.settings;console.log("[AssetsPanel] Generating blob:",Q,"x",le);const ke=await xK($,Q,le);console.log("[AssetsPanel] Blob generated:",ke.size,"bytes");const de=new File([ke],`${$.name}_${Q}x${le}.png`,{type:"image/png"});console.log("[AssetsPanel] Calling importMedia...");const ae=await S(de);console.log("[AssetsPanel] Import result:",ae)}catch(Q){console.error("[AssetsPanel] Failed to generate background:",Q)}finally{console.log("[AssetsPanel] Clearing loading state"),b(null)}},[S,k.settings]),me=yK.filter($=>w==="all"||$.category===w);return c.jsxs("div",{"data-tour":"assets",className:"w-80 bg-background-secondary border-r border-border flex flex-col h-full relative",children:[o&&c.jsx(CK,{message:d||"Importing media..."}),c.jsxs("div",{className:"px-5 py-4 flex items-center justify-between",children:[c.jsx("span",{className:"font-bold text-lg text-text-primary tracking-tight",children:"Assets"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx(Br,{icon:wr,onClick:Ee,title:"Import media"}),c.jsx(Br,{icon:Ca,title:"Maximize panel"}),c.jsx(Br,{icon:Zs,title:"Close panel"})]})]}),c.jsxs("div",{className:"flex px-5 gap-6 border-b border-border text-xs font-medium text-text-muted mb-5",children:[c.jsxs("button",{onClick:()=>i("media"),className:`pb-3 transition-all relative ${s==="media"?"text-text-primary":"hover:text-text-secondary"}`,children:["Media",s==="media"&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full shadow-[0_-2px_8px_rgba(34,197,94,0.5)]"})]}),c.jsxs("button",{onClick:()=>i("text"),className:`pb-3 transition-all relative ${s==="text"?"text-text-primary":"hover:text-text-secondary"}`,children:["Text",s==="text"&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full shadow-[0_-2px_8px_rgba(34,197,94,0.5)]"})]}),c.jsxs("button",{onClick:()=>i("graphics"),className:`pb-3 transition-all relative ${s==="graphics"?"text-text-primary":"hover:text-text-secondary"}`,children:["Graphics",s==="graphics"&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-primary rounded-t-full shadow-[0_-2px_8px_rgba(34,197,94,0.5)]"})]})]}),s==="media"&&c.jsx("div",{className:"px-5 mb-3",children:c.jsxs("div",{className:"relative",children:[c.jsx(jo,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted z-10"}),c.jsx(Ms,{type:"text",value:e,onChange:$=>t($.target.value),placeholder:"Search media",className:"pl-9 text-xs bg-background-tertiary border-border text-text-primary h-9"})]})}),s==="media"&&D>0&&c.jsx("div",{className:"px-5 mb-5 space-y-2",children:c.jsxs("button",{onClick:()=>p(!h),className:`w-full px-3 py-2 rounded-lg border text-xs font-medium transition-all flex items-center justify-between ${h?"bg-yellow-500/10 border-yellow-500 text-yellow-500":"bg-background-tertiary border-border text-text-secondary hover:border-yellow-500/50"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(_o,{size:14}),c.jsx("span",{children:"Show Only Missing Assets"})]}),c.jsx("div",{className:"px-2 py-0.5 rounded-full bg-yellow-500 text-black text-[10px] font-bold",children:D})]})}),c.jsx("input",{ref:r,type:"file",multiple:!0,accept:"video/*,audio/*,image/*",onChange:$=>O($.target.files),className:"hidden"}),s==="media"&&c.jsx(oa,{className:`flex-1 ${n?"bg-primary/5":""}`,onDrop:F,onDragOver:I,onDragLeave:J,children:c.jsxs("div",{className:"px-5 pb-5",children:[B.length===0?c.jsx(kK,{onImport:Ee}):c.jsx("div",{className:"grid grid-cols-2 gap-3",children:B.map($=>c.jsx(wK,{item:$,isSelected:P($.id),onSelect:()=>Z($.id),onDelete:()=>E($.id),onReplace:()=>G($.id),onDragStart:Q=>V(Q,$),onAddToTimeline:()=>ne($)},$.id))}),n&&c.jsx("div",{className:"absolute inset-4 border-2 border-dashed border-primary rounded-xl flex items-center justify-center bg-primary/5 pointer-events-none z-50 backdrop-blur-sm",children:c.jsx("div",{className:"text-primary text-sm font-bold bg-background-secondary px-4 py-2 rounded-full shadow-lg",children:"Drop files to import"})})]})}),s==="graphics"&&c.jsx(oa,{className:"flex-1",children:c.jsxs("div",{className:"px-5 pb-5",children:[c.jsxs("div",{className:"mb-6",children:[c.jsx("div",{className:"flex items-center justify-between mb-3",children:c.jsxs("h4",{className:"text-xs font-medium text-text-secondary flex items-center gap-1.5",children:[c.jsx(Vd,{size:12}),"Backgrounds"]})}),c.jsx("div",{className:"flex gap-1.5 mb-3 flex-wrap",children:["all","solid","gradient","mesh","pattern"].map($=>c.jsx("button",{onClick:()=>C($),className:`px-2.5 py-1 text-[10px] rounded-md transition-all ${w===$?"bg-primary text-white":"bg-background-tertiary text-text-muted hover:text-text-secondary"}`,children:$.charAt(0).toUpperCase()+$.slice(1)},$))}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:me.map($=>c.jsxs("button",{onClick:()=>K($),disabled:x!==null,className:"aspect-square rounded-lg border border-border hover:border-primary/50 transition-all overflow-hidden relative group disabled:opacity-50",title:$.name,style:{background:$.thumbnail},children:[x===$.id&&c.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:c.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})}),c.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100",children:c.jsx(wr,{size:16,className:"text-white"})}),c.jsx("span",{className:"absolute bottom-0 left-0 right-0 text-[8px] text-white bg-black/60 py-0.5 px-1 truncate opacity-0 group-hover:opacity-100 transition-opacity",children:$.name})]},$.id))})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-3",children:"Shapes"}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{type:"rectangle",icon:is,label:"Rectangle"},{type:"circle",icon:Vr,label:"Circle"},{type:"triangle",icon:s_,label:"Triangle"},{type:"star",icon:fa,label:"Star"},{type:"arrow",icon:na,label:"Arrow"},{type:"polygon",icon:Hj,label:"Polygon"}].map($=>c.jsxs("button",{onClick:async()=>{const Q=W.getState(),{createShapeClip:le,addTrack:ke}=Q,de=Q.project.timeline.tracks;await ke("graphics",0);const Pe=W.getState().project.timeline.tracks.find(z=>z.type==="graphics"&&!de.some(Ue=>Ue.id===z.id));Pe&&le(Pe.id,0,$.type)},className:"aspect-square bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all flex flex-col items-center justify-center gap-1 group",title:$.label,children:[c.jsx($.icon,{size:20,className:"text-text-secondary group-hover:text-primary transition-colors"}),c.jsx("span",{className:"text-[9px] text-text-muted group-hover:text-text-secondary",children:$.label})]},$.type))})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-3",children:"SVG Import"}),c.jsxs("button",{onClick:()=>{const $=document.createElement("input");$.type="file",$.accept=".svg",$.onchange=async Q=>{const le=Q.target.files?.[0];if(le){const ke=await le.text(),de=W.getState(),{importSVG:ae,addTrack:Pe}=de,z=de.project.timeline.tracks;await Pe("graphics",0);const Je=W.getState().project.timeline.tracks.find(ge=>ge.type==="graphics"&&!z.some(Ce=>Ce.id===ge.id));Je&&ae(ke,Je.id,0)}},$.click()},className:"w-full py-3 bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center gap-2 group",children:[c.jsx(zc,{size:16,className:"text-text-secondary group-hover:text-primary transition-colors"}),c.jsx("span",{className:"text-xs text-text-secondary group-hover:text-text-primary",children:"Import SVG File"})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-xs font-medium text-text-secondary mb-3",children:"Stickers & Emojis"}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:["","","","","","","",""].map(($,Q)=>c.jsx("button",{onClick:async()=>{const le=W.getState(),{createStickerClip:ke,addTrack:de}=le,{stickerLibrary:ae}=await _i(async()=>{const{stickerLibrary:Je}=await import("./index2.js");return{stickerLibrary:Je}},__vite__mapDeps([0,1,2,3,4,5,6])),Pe=le.project.timeline.tracks;await de("graphics",0);const Ue=W.getState().project.timeline.tracks.find(Je=>Je.type==="graphics"&&!Pe.some(ge=>ge.id===Je.id));if(Ue){const Je={id:`emoji-${Q}`,emoji:$,name:$,category:"emojis"},ge=ae.createEmojiClip(Je,Ue.id,0,5);ke(ge)}},className:"aspect-square bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all flex items-center justify-center text-xl cursor-pointer",children:$},Q))})]})]})}),s==="text"&&c.jsx(oa,{className:"flex-1",children:c.jsxs("div",{className:"px-5 pb-5 space-y-3",children:[c.jsxs("button",{onClick:async()=>{const $=W.getState(),{createTextClip:Q,addTrack:le}=$,ke=$.project.timeline.tracks;await le("text",0);const ae=W.getState().project.timeline.tracks.find(Pe=>Pe.type==="text"&&!ke.some(z=>z.id===Pe.id));ae&&Q(ae.id,0,"New Title")},className:"w-full py-4 bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all text-center",children:[c.jsx("span",{className:"text-lg font-bold text-text-primary",children:"Add Title"}),c.jsx("p",{className:"text-xs text-text-muted mt-1",children:"Click to add text to timeline"})]}),c.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{name:"Heading",text:"Heading",style:{fontSize:72,fontWeight:700,textAlign:"center",verticalAlign:"middle"}},{name:"Subtitle",text:"Subtitle text",style:{fontSize:36,fontWeight:400,textAlign:"center",verticalAlign:"middle"}},{name:"Lower Third",text:"Name Here",style:{fontSize:32,fontWeight:600,textAlign:"left",verticalAlign:"bottom",backgroundColor:"rgba(0, 0, 0, 0.7)"}},{name:"Caption",text:"Caption text here",style:{fontSize:24,fontWeight:400,textAlign:"center",verticalAlign:"bottom",shadowColor:"rgba(0, 0, 0, 0.8)",shadowBlur:4,shadowOffsetX:1,shadowOffsetY:1}}].map($=>c.jsx("button",{onClick:async()=>{const Q=W.getState(),{createTextClip:le,addTrack:ke}=Q,de=Q.project.timeline.tracks;await ke("text",0);const Pe=W.getState().project.timeline.tracks.find(z=>z.type==="text"&&!de.some(Ue=>Ue.id===z.id));Pe&&le(Pe.id,0,$.text,5,$.style)},className:"py-3 bg-background-tertiary rounded-lg border border-border hover:border-primary/50 hover:bg-primary/5 transition-all text-xs text-text-secondary hover:text-text-primary",children:$.name},$.name))})]})}),g&&c.jsx(bK,{isOpen:f,videoWidth:g.videoWidth,videoHeight:g.videoHeight,currentWidth:k.settings.width,currentHeight:k.settings.height,onConfirm:oe,onCancel:re})]})},Un={MIN:10,DEFAULT:50,MAX:500},$t=wa()(Up((r,e)=>({playheadPosition:0,playbackState:"stopped",playbackRate:1,pixelsPerSecond:Un.DEFAULT,scrollX:0,scrollY:0,viewportWidth:800,viewportHeight:400,trackHeight:80,trackHeights:{},loopEnabled:!1,loopStart:0,loopEnd:0,isScrubbing:!1,scrubPosition:null,expandedTracks:new Set,expandedClipKeyframes:new Set,keyframeEditMode:!1,play:()=>{r({playbackState:"playing"})},pause:()=>{r({playbackState:"paused"})},stop:()=>{r({playbackState:"stopped",playheadPosition:0})},togglePlayback:()=>{const{playbackState:t}=e();r(t==="playing"?{playbackState:"paused"}:{playbackState:"playing"})},setPlaybackRate:t=>{r({playbackRate:Math.max(.1,Math.min(4,t))})},setPlayheadPosition:t=>{r({playheadPosition:Math.max(0,t)})},seekTo:t=>{const s=Math.max(0,t);r({playheadPosition:s})},seekRelative:t=>{const{playheadPosition:s}=e(),i=Math.max(0,s+t);r({playheadPosition:i})},seekToStart:()=>{r({playheadPosition:0})},seekToEnd:t=>{r({playheadPosition:t})},startScrubbing:t=>{r({isScrubbing:!0,scrubPosition:t,playheadPosition:t})},updateScrubPosition:t=>{const{isScrubbing:s}=e();if(s){const i=Math.max(0,t);r({scrubPosition:i,playheadPosition:i})}},endScrubbing:()=>{const{scrubPosition:t}=e();r({isScrubbing:!1,scrubPosition:null,playheadPosition:t??e().playheadPosition})},zoomIn:()=>{const{pixelsPerSecond:t}=e(),s=Math.min(t*1.5,Un.MAX);r({pixelsPerSecond:s})},zoomOut:()=>{const{pixelsPerSecond:t}=e(),s=Math.max(t/1.5,Un.MIN);r({pixelsPerSecond:s})},setZoom:t=>{const s=Math.max(Un.MIN,Math.min(Un.MAX,t));r({pixelsPerSecond:s})},zoomToFit:t=>{const{viewportWidth:s}=e();if(t>0){const i=Math.max(Un.MIN,Math.min(Un.MAX,(s-100)/t));r({pixelsPerSecond:i,scrollX:0})}},resetZoom:()=>{r({pixelsPerSecond:Un.DEFAULT,scrollX:0})},setScrollX:t=>{r({scrollX:Math.max(0,t)})},setScrollY:t=>{r({scrollY:Math.max(0,t)})},scrollToPlayhead:()=>{const{playheadPosition:t,pixelsPerSecond:s,viewportWidth:i,scrollX:n}=e(),a=t*s;if(a<n||a>n+i){const o=Math.max(0,a-i/2);r({scrollX:o})}},setViewportDimensions:(t,s)=>{r({viewportWidth:t,viewportHeight:s})},setTrackHeight:t=>{r({trackHeight:Math.max(40,Math.min(200,t))})},setTrackHeightById:(t,s)=>{const i=Math.max(40,Math.min(200,s));r(n=>({trackHeights:{...n.trackHeights,[t]:i}}))},getTrackHeight:t=>{const{trackHeights:s,trackHeight:i}=e();return s[t]??i},setLoopEnabled:t=>{r({loopEnabled:t})},setLoopRange:(t,s)=>{t<s&&r({loopStart:Math.max(0,t),loopEnd:s})},timeToPixels:t=>{const{pixelsPerSecond:s}=e();return t*s},pixelsToTime:t=>{const{pixelsPerSecond:s}=e();return t/s},getVisibleTimeRange:()=>{const{scrollX:t,viewportWidth:s,pixelsPerSecond:i}=e();return{start:t/i,end:(t+s)/i}},isTimeVisible:t=>{const{start:s,end:i}=e().getVisibleTimeRange();return t>=s&&t<=i},toggleTrackExpanded:t=>{r(s=>{const i=new Set(s.expandedTracks);return i.has(t)?i.delete(t):i.add(t),{expandedTracks:i}})},setTrackExpanded:(t,s)=>{r(i=>{const n=new Set(i.expandedTracks);return s?n.add(t):n.delete(t),{expandedTracks:n}})},isTrackExpanded:t=>e().expandedTracks.has(t),toggleClipKeyframesExpanded:t=>{r(s=>{const i=new Set(s.expandedClipKeyframes);return i.has(t)?i.delete(t):i.add(t),{expandedClipKeyframes:i}})},setClipKeyframesExpanded:(t,s)=>{r(i=>{const n=new Set(i.expandedClipKeyframes);return s?n.add(t):n.delete(t),{expandedClipKeyframes:n}})},isClipKeyframesExpanded:t=>e().expandedClipKeyframes.has(t),setKeyframeEditMode:t=>{r({keyframeEditMode:t})}}))),TK={maxFrames:100,maxSizeBytes:500*1024*1024,preloadAhead:30,preloadBehind:10};class vc{videoEngine=null;videoEffectsEngine=null;transitionEngine=null;canvas=null;ctx=null;initialized=!1;renderStats={lastRenderTime:0,avgRenderTime:0,framesRendered:0,renderErrors:0};renderTimes=[];maxRenderTimeSamples=60;pendingRender=null;lastRenderedTime=-1;DEBOUNCE_THRESHOLD=.001;frameCache=new Map;cacheConfig;cacheStats={hits:0,misses:0};totalCacheSizeBytes=0;isPreloading=!1;preloadAbortController=null;constructor(e={}){this.cacheConfig={...TK,...e}}async initialize(){if(this.initialized)return;const e=fe.getState();if(!e.initialized)throw new Error("EngineStore must be initialized before RenderBridge");if(this.videoEngine=e.videoEngine,!this.videoEngine)throw new Error("VideoEngine not available in EngineStore");const t=W.getState().project,{width:s,height:i}=t.settings;this.videoEffectsEngine=z9(s,i),this.transitionEngine=CM(s,i),this.initialized=!0}setCanvas(e){this.canvas=e,e?this.ctx=e.getContext("2d"):this.ctx=null}getCanvas(){return this.canvas}async renderFrame(e){if(!this.initialized||!this.videoEngine)return null;const t=performance.now();try{const s=W.getState().project,i=await this.videoEngine.renderFrame(s,e);this.canvas&&this.ctx&&i&&this.drawFrameToCanvas(i);const n=performance.now()-t;return this.updateRenderStats(n),fe.setState({currentFrame:i}),this.lastRenderedTime=e,i}catch(s){return this.renderStats.renderErrors++,console.error("RenderBridge: Frame render error:",s),null}}renderFrameDebounced(e){this.pendingRender!==null&&cancelAnimationFrame(this.pendingRender),!(Math.abs(e-this.lastRenderedTime)<this.DEBOUNCE_THRESHOLD)&&(this.pendingRender=requestAnimationFrame(()=>{this.pendingRender=null,this.renderFrame(e).catch(t=>{console.error("[RenderBridge] Frame render failed:",t)})}))}async renderCurrentFrame(){const e=$t.getState().playheadPosition;return this.renderFrame(e)}async applyEffects(e,t){if(!this.videoEffectsEngine)return e;const s=this.filterEnabledEffects(t);return s.length===0?e:(await this.videoEffectsEngine.applyEffects(e,s)).image}filterEnabledEffects(e){return e.filter(t=>t.enabled)}getEffectApplicationOrder(e){return this.filterEnabledEffects(e).map(t=>t.id)}async applyClipEffects(e,t){const s=W.getState().project;for(const i of s.timeline.tracks){const n=i.clips.find(a=>a.id===t);if(n&&n.effects&&n.effects.length>0)return this.applyEffects(e,n.effects)}return e}hasEffectsEngine(){return this.videoEffectsEngine!==null}getVideoEffectsEngine(){return this.videoEffectsEngine}findTransitionAtTime(e,t){if(!this.transitionEngine)return null;for(const s of e.transitions){const i=e.clips.find(a=>a.id===s.clipAId),n=e.clips.find(a=>a.id===s.clipBId);if(!(!i||!n)&&this.transitionEngine.isTimeInTransition(s,i,t)){const a=this.transitionEngine.calculateTransitionProgress(s,i,t);return{transition:s,clipA:i,clipB:n,progress:a}}}return null}async renderTransition(e,t,s,i){if(!this.transitionEngine)return null;try{return(await this.transitionEngine.renderTransition(e,t,s,i)).frame}catch(n){return console.error("RenderBridge: Transition render error:",n),null}}isTimeInTransition(e,t){return this.findTransitionAtTime(e,t)!==null}getTransitionEngine(){return this.transitionEngine}hasTransitionEngine(){return this.transitionEngine!==null}getClipLocalTime(e,t){const s=t-e.startTime;return e.inPoint+s}drawFrameToCanvas(e){if(!this.canvas||!this.ctx)return;const{width:t,height:s}=this.canvas;this.ctx.clearRect(0,0,t,s);const i=e.width/e.height,n=t/s;let a,o,l,d;i>n?(a=t,o=t/i,l=0,d=(s-o)/2):(o=s,a=s*i,l=(t-a)/2,d=0),this.ctx.drawImage(e.image,l,d,a,o)}updateRenderStats(e){this.renderStats.lastRenderTime=e,this.renderStats.framesRendered++,this.renderTimes.push(e),this.renderTimes.length>this.maxRenderTimeSamples&&this.renderTimes.shift();const t=this.renderTimes.reduce((s,i)=>s+i,0);this.renderStats.avgRenderTime=t/this.renderTimes.length}getRenderStats(){return{...this.renderStats}}clearCanvas(){this.canvas&&this.ctx&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}resizeCanvas(){if(!this.canvas)return;const e=W.getState().project,{width:t,height:s}=e.settings;(this.canvas.width!==t||this.canvas.height!==s)&&(this.canvas.width=t,this.canvas.height=s)}isInitialized(){return this.initialized}static getCacheKey(e,t=30){return`frame:${(Math.round(e*t)/t).toFixed(4)}`}getCachedFrame(e){const t=this.frameCache.get(e);return t?(t.lastAccessed=Date.now(),this.cacheStats.hits++,t.frame):(this.cacheStats.misses++,null)}hasFrame(e){return this.frameCache.has(e)}cacheFrame(e,t){const s=t.width*t.height*4;if(this.evictIfNeeded(s),s>this.cacheConfig.maxSizeBytes){console.warn("RenderBridge: Frame too large to cache:",s,"bytes");return}if(this.frameCache.has(e)){const i=this.frameCache.get(e);this.totalCacheSizeBytes-=i.sizeBytes}this.frameCache.set(e,{frame:t,key:e,sizeBytes:s,lastAccessed:Date.now()}),this.totalCacheSizeBytes+=s}removeFrame(e){const t=this.frameCache.get(e);return t?(t.frame.image&&typeof t.frame.image.close=="function"&&t.frame.image.close(),this.totalCacheSizeBytes-=t.sizeBytes,this.frameCache.delete(e)):!1}evictIfNeeded(e){for(;this.frameCache.size>=this.cacheConfig.maxFrames;)this.evictOldest();for(;this.totalCacheSizeBytes+e>this.cacheConfig.maxSizeBytes&&this.frameCache.size>0;)this.evictOldest()}evictOldest(){let e="",t=1/0;for(const[s,i]of this.frameCache.entries())i.lastAccessed<t&&(t=i.lastAccessed,e=s);e&&this.removeFrame(e)}async preloadFrames(e,t,s=30){if(!this.initialized||!this.videoEngine)return;this.preloadAbortController&&this.preloadAbortController.abort(),this.preloadAbortController=new AbortController;const i=this.preloadAbortController.signal;this.isPreloading=!0;try{const n=1/s,a=Math.max(0,e-this.cacheConfig.preloadBehind*n),o=Math.min(t,e+this.cacheConfig.preloadAhead*n),l=W.getState().project,d=[];for(let u=e;u<=o;u+=n){const h=vc.getCacheKey(u,s);this.frameCache.has(h)||d.push(u)}for(let u=e-n;u>=a;u-=n){const h=vc.getCacheKey(u,s);this.frameCache.has(h)||d.push(u)}for(const u of d){if(i.aborted)break;try{const h=await this.videoEngine.renderFrame(l,u);if(h&&!i.aborted){const p=vc.getCacheKey(u,s);this.cacheFrame(p,h)}}catch(h){console.warn("RenderBridge: Preload frame error:",h)}}}finally{this.isPreloading=!1}}getPreloadRange(e,t,s=30){const i=1/s,n=Math.max(0,e-this.cacheConfig.preloadBehind*i),a=Math.min(t,e+this.cacheConfig.preloadAhead*i),o=[];for(let l=n;l<=a;l+=i){const d=vc.getCacheKey(l,s);this.frameCache.has(d)||o.push(l)}return{startTime:n,endTime:a,missingFrames:o}}cancelPreload(){this.preloadAbortController&&(this.preloadAbortController.abort(),this.preloadAbortController=null),this.isPreloading=!1}isPreloadingFrames(){return this.isPreloading}clearCache(){for(const e of this.frameCache.values())e.frame.image&&typeof e.frame.image.close=="function"&&e.frame.image.close();this.frameCache.clear(),this.totalCacheSizeBytes=0,this.cacheStats={hits:0,misses:0}}getCacheStats(){const e=this.cacheStats.hits+this.cacheStats.misses;return{entries:this.frameCache.size,sizeBytes:this.totalCacheSizeBytes,hitRate:e>0?this.cacheStats.hits/e:0,maxSizeBytes:this.cacheConfig.maxSizeBytes,hits:this.cacheStats.hits,misses:this.cacheStats.misses}}getCacheConfig(){return{...this.cacheConfig}}updateCacheConfig(e){this.cacheConfig={...this.cacheConfig,...e},this.evictIfNeeded(0)}async applyColorAdjustments(e,t){if(!this.videoEffectsEngine)return e;const s=[];return t.brightness!==void 0&&t.brightness!==0&&s.push({id:"color-brightness",type:"brightness",params:{value:t.brightness},enabled:!0}),t.contrast!==void 0&&t.contrast!==1&&s.push({id:"color-contrast",type:"contrast",params:{value:t.contrast},enabled:!0}),t.saturation!==void 0&&t.saturation!==1&&s.push({id:"color-saturation",type:"saturation",params:{value:t.saturation},enabled:!0}),t.temperature!==void 0&&t.temperature!==0&&s.push({id:"color-temperature",type:"temperature",params:{value:t.temperature},enabled:!0}),t.tint!==void 0&&t.tint!==0&&s.push({id:"color-tint",type:"tint",params:{value:t.tint},enabled:!0}),(t.shadows!==void 0&&t.shadows!==0||t.midtones!==void 0&&t.midtones!==0||t.highlights!==void 0&&t.highlights!==0)&&s.push({id:"color-tonal",type:"tonal",params:{shadows:t.shadows??0,midtones:t.midtones??0,highlights:t.highlights??0},enabled:!0}),s.length===0?e:(await this.videoEffectsEngine.applyEffects(e,s)).image}hasColorAdjustments(e){return e.brightness!==void 0&&e.brightness!==0||e.contrast!==void 0&&e.contrast!==1||e.saturation!==void 0&&e.saturation!==1||e.temperature!==void 0&&e.temperature!==0||e.tint!==void 0&&e.tint!==0||e.shadows!==void 0&&e.shadows!==0||e.midtones!==void 0&&e.midtones!==0||e.highlights!==void 0&&e.highlights!==0}getDefaultColorAdjustments(){return{brightness:0,contrast:1,saturation:1,temperature:0,tint:0,shadows:0,midtones:0,highlights:0}}dispose(){this.pendingRender!==null&&(cancelAnimationFrame(this.pendingRender),this.pendingRender=null),this.cancelPreload(),this.clearCache(),this.clearCanvas(),this.transitionEngine&&(this.transitionEngine.dispose(),this.transitionEngine=null),this.canvas=null,this.ctx=null,this.videoEngine=null,this.videoEffectsEngine=null,this.initialized=!1,this.lastRenderedTime=-1,this.renderTimes=[],this.renderStats={lastRenderTime:0,avgRenderTime:0,framesRendered:0,renderErrors:0}}}let Rc=null;function Oy(){return Rc||(Rc=new vc),Rc}async function AK(){const r=Oy();return await r.initialize(),r}function jK(){Rc&&(Rc.dispose(),Rc=null)}const Ii={position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,anchor:{x:.5,y:.5},borderRadius:0},pg=r=>{const e=Math.floor(r/60),t=Math.floor(r%60),s=Math.floor(r%1*100);return`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`};class _K{transitionEngine=null;initialized=!1;trackTransitions=new Map;initialize(e=1920,t=1080){if(!this.initialized)try{this.transitionEngine=CM(e,t),this.initialized=!0}catch(s){const i=s instanceof Error?s.message:"Unknown initialization error";throw new Error(`TransitionBridge initialization failed: ${i}`)}}isInitialized(){return this.initialized}getEngine(){return this.transitionEngine}createTransition(e,t,s,i,n){if(!this.initialized||!this.transitionEngine)return{success:!1,error:"TransitionBridge not initialized"};const a=this.transitionEngine.validateTransition(e,t,i);if(!a.valid&&!a.warning)return{success:!1,error:a.error};const o=this.transitionEngine.createTransition(e,t,s,i,n);if(!o)return{success:!1,error:"Failed to create transition"};const l=e.trackId,u=(this.trackTransitions.get(l)||[]).filter(h=>!(h.clipAId===e.id&&h.clipBId===t.id));return u.push(o),this.trackTransitions.set(l,u),{success:!0,transitionId:o.id,warning:a.warning,maxDuration:a.maxDuration}}updateTransition(e,t){if(!this.initialized||!this.transitionEngine)return{success:!1,error:"TransitionBridge not initialized"};let s=null,i=null;for(const[l,d]of this.trackTransitions.entries()){const u=d.find(h=>h.id===e);if(u){s=u,i=l;break}}if(!s||!i)return{success:!1,error:"Transition not found"};const n={...s,type:t.type??s.type,duration:t.duration??s.duration,params:t.params?{...s.params,...t.params}:s.params},a=this.trackTransitions.get(i)||[],o=a.findIndex(l=>l.id===e);return o!==-1&&(a[o]=n,this.trackTransitions.set(i,a)),{success:!0,transitionId:e}}removeTransition(e){if(!this.initialized)return{success:!1,error:"TransitionBridge not initialized"};for(const[t,s]of this.trackTransitions.entries()){const i=s.findIndex(n=>n.id===e);if(i!==-1)return s.splice(i,1),this.trackTransitions.set(t,s),{success:!0,transitionId:e}}return{success:!1,error:"Transition not found"}}getTransition(e){for(const t of this.trackTransitions.values()){const s=t.find(i=>i.id===e);if(s)return s}}getTransitionsForTrack(e){return this.trackTransitions.get(e)||[]}getTransitionBetweenClips(e,t){for(const s of this.trackTransitions.values()){const i=s.find(n=>n.clipAId===e&&n.clipBId===t);if(i)return i}}validateTransition(e,t,s){return!this.initialized||!this.transitionEngine?{valid:!1,error:"TransitionBridge not initialized"}:this.transitionEngine.validateTransition(e,t,s)}areClipsAdjacent(e,t){return!this.initialized||!this.transitionEngine?!1:this.transitionEngine.areClipsAdjacent(e,t)}findAdjacentClipPairs(e){return!this.initialized||!this.transitionEngine?[]:this.transitionEngine.findAdjacentClipPairs(e)}getAvailableTransitionTypes(){return[{type:"crossfade",name:"Crossfade",description:"Smooth blend between clips",hasDirection:!1,hasCustomParams:!1},{type:"dipToBlack",name:"Dip to Black",description:"Fade through black",hasDirection:!1,hasCustomParams:!0},{type:"dipToWhite",name:"Dip to White",description:"Fade through white",hasDirection:!1,hasCustomParams:!0},{type:"wipe",name:"Wipe",description:"Wipe from one clip to another",hasDirection:!0,hasCustomParams:!0},{type:"slide",name:"Slide",description:"Slide incoming clip over outgoing",hasDirection:!0,hasCustomParams:!0},{type:"zoom",name:"Zoom",description:"Zoom transition between clips",hasDirection:!1,hasCustomParams:!0},{type:"push",name:"Push",description:"Push outgoing clip with incoming",hasDirection:!0,hasCustomParams:!1}]}getDefaultParams(e){return!this.initialized||!this.transitionEngine?{}:this.transitionEngine.getDefaultParams(e)}calculateProgress(e,t,s){return!this.initialized||!this.transitionEngine?0:this.transitionEngine.calculateTransitionProgress(e,t,s)}isTimeInTransition(e,t,s){return!this.initialized||!this.transitionEngine?!1:this.transitionEngine.isTimeInTransition(e,t,s)}async renderTransition(e,t,s,i){if(!this.initialized||!this.transitionEngine)return null;try{const n=await this.transitionEngine.renderTransition(e,t,s,i);return{frame:n.frame,processingTime:n.processingTime}}catch(n){return console.error("[TransitionBridge] Render error:",n),null}}clearTransitionsForTrack(e){this.trackTransitions.delete(e)}clearAllTransitions(){this.trackTransitions.clear()}resize(e,t){this.transitionEngine&&this.transitionEngine.resize(e,t)}dispose(){this.transitionEngine&&this.transitionEngine.dispose(),this.trackTransitions.clear(),this.transitionEngine=null,this.initialized=!1}}let Ic=null;function Zb(){return Ic||(Ic=new _K),Ic}function EK(r=1920,e=1080){const t=Zb();return t.initialize(r,e),t}function MK(){Ic&&(Ic.dispose(),Ic=null)}const PK={normal:gr,multiply:_g,screen:wc,overlay:gr,darken:gr,lighten:wc,"color-dodge":wc,"color-burn":_g,"hard-light":gr,"soft-light":gr,difference:mv,exclusion:mv,hue:gr,saturation:gr,color:gr,luminosity:gr};class ev{scene;camera;renderer;_canvas;constructor(e,t){this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this.renderer=new JS({canvas:this._canvas,alpha:!0,antialias:!0,preserveDrawingBuffer:!0}),this.renderer.setSize(e,t),this.renderer.setClearColor(0,0),this.scene=new ZS;const s=e/t,i=t;this.camera=new eT(-i*s/2,i*s/2,i/2,-i/2,.1,2e3),this.camera.position.z=1e3}resize(e,t){this._canvas.width=e,this._canvas.height=t,this.renderer.setSize(e,t);const s=e/t,i=t;this.camera.left=-i*s/2,this.camera.right=i*s/2,this.camera.top=i/2,this.camera.bottom=-i/2,this.camera.updateProjectionMatrix()}createTextTexture(e,t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const n=i.getContext("2d");n.clearRect(0,0,t,s);const a=e.style,o=typeof a.fontWeight=="number"?a.fontWeight:a.fontWeight==="bold"?700:400;n.font=`${a.fontStyle} ${o} ${a.fontSize}px "${a.fontFamily}"`,n.fillStyle=a.color,n.textAlign=a.textAlign,n.textBaseline="middle",a.shadowColor&&a.shadowBlur&&(n.shadowColor=a.shadowColor,n.shadowBlur=a.shadowBlur,n.shadowOffsetX=a.shadowOffsetX||0,n.shadowOffsetY=a.shadowOffsetY||0),a.strokeColor&&a.strokeWidth&&(n.strokeStyle=a.strokeColor,n.lineWidth=a.strokeWidth);const l=e.text.split(`
`),d=a.fontSize*a.lineHeight;l.forEach((h,p)=>{const f=s/2+(p-(l.length-1)/2)*d;a.strokeColor&&a.strokeWidth&&n.strokeText(h,t/2,f),n.fillText(h,t/2,f)});const u=new Pu(i);return u.needsUpdate=!0,u}applyTransform(e,t,s,i){const n=(t.position.x-.5)*s,a=-(t.position.y-.5)*i;e.position.set(n,a,0),e.scale.set(t.scale.x,t.scale.y,1),e.rotation.z=t.rotation*Math.PI/180,t.rotate3d&&(e.rotation.x=t.rotate3d.x*Math.PI/180,e.rotation.y=t.rotate3d.y*Math.PI/180,e.rotation.z+=t.rotate3d.z*Math.PI/180),t.perspective&&(this.camera.position.z=t.perspective,this.camera.updateProjectionMatrix())}applyBlendMode(e,t,s){e.blending=PK[t]||gr,e.opacity=(s??100)/100,e.transparent=!0}renderTextClip(e,t,s){const i=this.createTextTexture(e,t,s),n=new vl({map:i,transparent:!0,opacity:e.transform.opacity,side:wl});this.applyBlendMode(n,e.blendMode||"normal",e.blendOpacity??100);const a=new kl(t,s),o=new Vo(a,n);return this.applyTransform(o,e.transform,t,s),o}createCanvasTexture(e,t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const n=i.getContext("2d");e(n);const a=new Pu(i);return a.needsUpdate=!0,a}renderShapeClip(e,t,s){const{shapeType:i,style:n,transform:a}=e,o=this.createCanvasTexture(h=>{const p=a.position.x*t,f=a.position.y*s;h.translate(p,f),h.scale(a.scale.x,a.scale.y),n.shadow?.blur&&n.shadow.blur>0&&(h.shadowColor=n.shadow.color||"#000000",h.shadowBlur=n.shadow.blur,h.shadowOffsetX=n.shadow.offsetX||0,h.shadowOffsetY=n.shadow.offsetY||0);const m=Math.min(t,s),g=m*.15,y=g/2,x=m/1080;switch(h.fillStyle=n.fill?.color||"#3b82f6",h.strokeStyle=n.stroke?.color||"#1d4ed8",h.lineWidth=(n.stroke?.width||2)*x,n.stroke?.dashArray&&n.stroke.dashArray.length>0&&h.setLineDash(n.stroke.dashArray),h.beginPath(),i){case"rectangle":{const b=n.cornerRadius||0;b>0?h.roundRect(-y,-y,g,g,Math.min(b,y)):h.rect(-y,-y,g,g);break}case"circle":case"ellipse":{h.ellipse(0,0,y,y,0,0,Math.PI*2);break}case"triangle":{h.moveTo(0,-y),h.lineTo(y,y),h.lineTo(-y,y),h.closePath();break}case"star":{const b=y,w=y*.4,C=5;for(let k=0;k<C*2;k++){const S=k%2===0?b:w,A=k*Math.PI/C-Math.PI/2,T=Math.cos(A)*S,j=Math.sin(A)*S;k===0?h.moveTo(T,j):h.lineTo(T,j)}h.closePath();break}case"polygon":{for(let w=0;w<6;w++){const C=w*2*Math.PI/6-Math.PI/2,k=Math.cos(C)*y,S=Math.sin(C)*y;w===0?h.moveTo(k,S):h.lineTo(k,S)}h.closePath();break}case"line":{h.moveTo(-y,0),h.lineTo(y,0);break}}n.fill?.color&&i!=="line"&&h.fill(),n.stroke?.width&&n.stroke.width>0&&h.stroke()},t,s),l=new vl({map:o,transparent:!0,opacity:a.opacity,side:wl});this.applyBlendMode(l,e.blendMode||"normal",e.blendOpacity??100);const d=new kl(t,s),u=new Vo(d,l);return this.applyTransform(u,a,t,s),u}renderSVGClip(e,t,s){const{svgContent:i,transform:n,viewBox:a}=e,o=this.createCanvasTexture(h=>{const p=new Image,f=new Blob([i],{type:"image/svg+xml"});if(p.src=URL.createObjectURL(f),p.complete&&p.naturalWidth>0){const m=n.position.x*t,g=n.position.y*s;h.translate(m,g),h.scale(n.scale.x,n.scale.y);const y=a?.width||200,x=a?.height||200;h.drawImage(p,-y/2,-x/2,y,x)}URL.revokeObjectURL(p.src)},t,s),l=new vl({map:o,transparent:!0,opacity:n.opacity,side:wl});this.applyBlendMode(l,e.blendMode||"normal",e.blendOpacity??100);const d=new kl(t,s),u=new Vo(d,l);return this.applyTransform(u,n,t,s),u}renderStickerClip(e,t,s){const{imageUrl:i,transform:n}=e,a=this.createCanvasTexture(u=>{const h=new Image;if(h.src=i,h.complete&&h.naturalWidth>0){const p=n.position.x*t,f=n.position.y*s;u.translate(p,f),u.scale(n.scale.x,n.scale.y),u.drawImage(h,-h.naturalWidth/2,-h.naturalHeight/2,h.naturalWidth,h.naturalHeight)}},t,s),o=new vl({map:a,transparent:!0,opacity:n.opacity,side:wl});this.applyBlendMode(o,e.blendMode||"normal",e.blendOpacity??100);const l=new kl(t,s),d=new Vo(l,o);return this.applyTransform(d,n,t,s),d}renderImageFrame(e,t,s,i,n,a){let o;if(e instanceof HTMLVideoElement)o=new bR(e);else if(e instanceof ImageBitmap){const h=document.createElement("canvas");h.width=e.width,h.height=e.height,h.getContext("2d").drawImage(e,0,0),o=new Pu(h)}else o=new Pu(e);o.needsUpdate=!0;const l=new vl({map:o,transparent:!0,opacity:t.opacity??1,side:wl});n&&this.applyBlendMode(l,n,a??100);const d=new kl(s,i),u=new Vo(d,l);return this.applyTransform(u,t,s,i),u}render(){return this.renderer.render(this.scene,this.camera),this._canvas}clear(){for(;this.scene.children.length>0;){const e=this.scene.children[0];this.scene.remove(e),e instanceof Vo&&(e.geometry.dispose(),e.material instanceof vR&&e.material.dispose())}this.renderer.clear()}dispose(){this.clear(),this.renderer.dispose()}getScene(){return this.scene}get canvas(){return this._canvas}}let D2=0,bt=null;const Xo=new Cu,F2={opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0},Md=(r,e)=>{const{type:t,speed:s,intensity:i,loop:n,startTime:a,animationDuration:o}=r,l=a??0;if(e<l)return F2;if(o!==void 0&&o>0){const p=l+o;if(e>p)return F2}const d=e-l,u=n?d*s%1:Math.min(d*s,1),h=u*Math.PI*2;switch(t){case"pulse":return{opacity:1,scale:1+Math.sin(h)*.1*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"shake":{const p=Math.sin(h*5)*.02*i,f=Math.cos(h*5)*.02*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:p,offsetY:f,rotation:0}}case"bounce":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.abs(Math.sin(h))*-.05*i,rotation:0};case"float":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:Math.sin(h)*.03*i,rotation:0};case"spin":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:u*360*i};case"flash":return{opacity:.5+Math.abs(Math.sin(h))*.5,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"heartbeat":{const p=u*4;let f=1;return p<1?f=1+.15*i*Math.sin(p*Math.PI):p<2&&(f=1+.1*i*Math.sin((p-1)*Math.PI)),{opacity:1,scale:f,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"swing":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(h)*15*i};case"wobble":{const p=Math.sin(h*3)*5*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:Math.sin(h)*.02*i,offsetY:0,rotation:p}}case"jello":{const p=1+Math.sin(h*2)*.1*i,f=1-Math.sin(h*2)*.1*i;return{opacity:1,scale:1,scaleX:p,scaleY:f,offsetX:0,offsetY:0,rotation:0}}case"rubber-band":{const p=1+Math.sin(h)*.2*i,f=1-Math.sin(h)*.1*i;return{opacity:1,scale:1,scaleX:p,scaleY:f,offsetX:0,offsetY:0,rotation:0}}case"tada":{const p=Math.sin(h*4)*10*i;return{opacity:1,scale:1+Math.sin(h*2)*.1*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:p}}case"vibrate":{const p=(Math.random()-.5)*.02*i,f=(Math.random()-.5)*.02*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:p,offsetY:f,rotation:0}}case"flicker":return{opacity:Math.random()>.1?1:.3,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"glow":{const p=1+Math.sin(h)*.05*i;return{opacity:.8+Math.sin(h)*.2,scale:p,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}case"breathe":return{opacity:1,scale:1+Math.sin(h*.5)*.08*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"wave":{const p=Math.sin(h+e*2)*.03*i,f=Math.sin(h)*5*i;return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:p,rotation:f}}case"tilt":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:Math.sin(h*.5)*10*i};case"zoom-pulse":return{opacity:1,scale:1+Math.sin(h)*.15*i,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0};case"focus-zoom":{const p=r.focusPoint||{x:.5,y:.5},f=r.zoomScale||1.5,m=r.holdDuration||.3,g=.3,y=1-m-g;let x=1,b=0,w=0;if(u<g){const C=u/g,k=1-Math.pow(1-C,3);x=1+(f-1)*k*i,b=(.5-p.x)*(x-1),w=(.5-p.y)*(x-1)}else if(u<g+m)x=f*i,b=(.5-p.x)*(x-1),w=(.5-p.y)*(x-1);else{const C=(u-g-m)/y,k=Math.pow(C,3);x=f-(f-1)*k*i,b=(.5-p.x)*(x-1),w=(.5-p.y)*(x-1)}return{opacity:1,scale:x,scaleX:1,scaleY:1,offsetX:b,offsetY:w,rotation:0}}case"pan-left":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:-u*.2*i,offsetY:0,rotation:0};case"pan-right":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:u*.2*i,offsetY:0,rotation:0};case"pan-up":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:-u*.2*i,rotation:0};case"pan-down":return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:u*.2*i,rotation:0};case"ken-burns":{const p=1+u*.3*i,f=u*.1*i,m=u*.05*i;return{opacity:1,scale:p,scaleX:1,scaleY:1,offsetX:f,offsetY:m,rotation:0}}case"none":default:return{opacity:1,scale:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,rotation:0}}},Xn=(r,e,t)=>{if(!e||e.length===0)return r;const s={...r},i=e.filter(u=>u.property==="position.x"),n=e.filter(u=>u.property==="position.y"),a=e.filter(u=>u.property==="scale.x"),o=e.filter(u=>u.property==="scale.y"),l=e.filter(u=>u.property==="rotation"),d=e.filter(u=>u.property==="opacity");if(i.length>0){const{value:u}=Xo.getValueAtTime(i,t);typeof u=="number"&&(s.position={...s.position,x:u})}if(n.length>0){const{value:u}=Xo.getValueAtTime(n,t);typeof u=="number"&&(s.position={...s.position,y:u})}if(a.length>0){const{value:u}=Xo.getValueAtTime(a,t);typeof u=="number"&&(s.scale={...s.scale,x:u})}if(o.length>0){const{value:u}=Xo.getValueAtTime(o,t);typeof u=="number"&&(s.scale={...s.scale,y:u})}if(l.length>0){const{value:u}=Xo.getValueAtTime(l,t);typeof u=="number"&&(s.rotation=u)}if(d.length>0){const{value:u}=Xo.getValueAtTime(d,t);typeof u=="number"&&(s.opacity=u)}return s},xh=new Map,NK=async(r,e)=>{const t=`${e}px "${r}"`;if(!xh.has(t)){const s=document.fonts.load(t).then(()=>{});xh.set(t,s),setTimeout(()=>xh.delete(t),3e4)}try{await Promise.race([xh.get(t),new Promise(s=>setTimeout(s,100))])}catch{}},Vl=(r,e,t,s,i)=>{const n=i-e.startTime,a=_p.getAnimatedState(e,n);let{opacity:o,transform:l,style:d,visibleText:u,characterStates:h}=a;if(o<=0||u.length===0)return;if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"){const k=Md(e.emphasisAnimation,n);o=o*k.opacity,l={...l,scale:{x:l.scale.x*k.scale*k.scaleX,y:l.scale.y*k.scale*k.scaleY},position:{x:l.position.x+k.offsetX,y:l.position.y+k.offsetY},rotation:l.rotation+k.rotation}}const p=l.rotate3d&&(l.rotate3d.x!==0||l.rotate3d.y!==0),f=e.blendMode&&e.blendMode!=="normal";if(p||f){bt||(bt=new ev(t,s)),(bt.canvas.width!==t||bt.canvas.height!==s)&&bt.resize(t,s),bt.clear();const k={...e,text:u,style:d,transform:{...l,opacity:o}},S=bt.renderTextClip(k,t,s);if(S){bt.getScene().add(S);const A=bt.render();r.drawImage(A,0,0)}return}NK(d.fontFamily,d.fontSize),r.save();const m=l.position.x*t,g=l.position.y*s;r.translate(m,g),r.rotate(l.rotation*Math.PI/180),r.scale(l.scale.x,l.scale.y),r.globalAlpha=o;const y=typeof d.fontWeight=="number"?d.fontWeight:d.fontWeight==="bold"?700:400;r.font=`${d.fontStyle} ${y} ${d.fontSize}px "${d.fontFamily}"`,r.textAlign=d.textAlign,r.textBaseline="middle",d.shadowColor&&d.shadowBlur&&(r.shadowColor=d.shadowColor,r.shadowBlur=d.shadowBlur,r.shadowOffsetX=d.shadowOffsetX||0,r.shadowOffsetY=d.shadowOffsetY||0);const x=u.split(`
`),b=d.fontSize*d.lineHeight,w=x.length*b;let C=-w/2+b/2;if(d.verticalAlign==="top"?C=0:d.verticalAlign==="bottom"&&(C=-w),h&&h.length>0){let k=0;for(let S=0;S<x.length;S++){const A=x[S],T=C+S*b;let j=0;const _=r.measureText(A).width,M=d.textAlign==="center"?-_/2:d.textAlign==="right"?-_:0;for(const P of A){if(k<h.length){const R=h[k],D=r.measureText(P).width;r.save(),r.globalAlpha=o*R.opacity,r.translate(M+j+R.offsetX+D/2,T+R.offsetY),r.rotate(R.rotation*Math.PI/180),r.scale(R.scale,R.scale),d.strokeColor&&d.strokeWidth&&(r.strokeStyle=d.strokeColor,r.lineWidth=d.strokeWidth,r.strokeText(P,0,0)),r.fillStyle=d.color,r.fillText(P,0,0),r.restore(),j+=D}k++}k++}}else for(let k=0;k<x.length;k++){const S=x[k],A=C+k*b;if(d.backgroundColor){const j=r.measureText(S).width+20,_=b;r.fillStyle=d.backgroundColor,r.fillRect(-j/2,A-_/2,j,_)}d.strokeColor&&d.strokeWidth&&(r.strokeStyle=d.strokeColor,r.lineWidth=d.strokeWidth,r.strokeText(S,0,A)),r.fillStyle=d.color,r.fillText(S,0,A)}r.restore()},Ya=(r,e)=>r.filter(t=>{const s=t.startTime+t.duration;return e>=t.startTime&&e<s}),qa=(r,e)=>r.filter(t=>{const s=t.startTime+t.duration;return e>=t.startTime&&e<s}),Ko=new Map,B2=new Map,RK=(r,e,t,s,i)=>{const{imageUrl:n,transform:a,keyframes:o}=e,l=i-e.startTime,d=o&&o.length>0?Xn(a,o,l):a;r.save();const u=d.position.x*t,h=d.position.y*s;r.translate(u,h),r.rotate(d.rotation*Math.PI/180),r.globalAlpha=d.opacity;let p=B2.get(n);if(p||(p=new Image,p.src=n,B2.set(n,p)),p.complete&&p.naturalHeight!==0){const f=p.naturalWidth,m=p.naturalHeight,g=d.scale.x,y=d.scale.y,x=d.anchor?.x??.5,b=d.anchor?.y??.5;if(d.crop){const w=d.crop.x*f,C=d.crop.y*m,k=d.crop.width*f,S=d.crop.height*m;r.drawImage(p,w,C,k,S,-k*g*x,-S*y*b,k*g,S*y)}else r.drawImage(p,-f*g*x,-m*y*b,f*g,m*y)}r.restore()},IK=(r,e,t,s,i)=>{const{svgContent:n,viewBox:a,colorStyle:o,entryAnimation:l,exitAnimation:d}=e,u=i-e.startTime;let h=e.transform;e.keyframes&&e.keyframes.length>0&&(h=Xn(e.transform,e.keyframes,u)),r.save();const p=h.position.x*t,f=h.position.y*s;r.translate(p,f),r.rotate(h.rotation*Math.PI/180);let m={x:h.scale.x,y:h.scale.y},g=h.opacity,y=0,x=0;const b=e.duration;let w=null,C=0;if(l&&u<l.duration){const T=u/l.duration;switch(l.type){case"fade":g*=T;break;case"scale":const j=T;m={x:m.x*j,y:m.y*j};break;case"slide-left":y=-(1-T)*t;break;case"slide-right":y=(1-T)*t;break;case"slide-up":x=-(1-T)*s;break;case"slide-down":x=(1-T)*s;break;case"rotate":r.rotate((1-T)*Math.PI*2),g*=T;break;case"bounce":const _=T<.5?2*T*T:1-Math.pow(-2*T+2,2)/2;m={x:m.x*_,y:m.y*_},g*=T;break;case"pop":const M=T<.5?T*2.2:1+(1-T)*.2;m={x:m.x*M,y:m.y*M};break;case"draw":C=T,g*=Math.min(1,T*2);break;case"wipe-left":w={x:0,y:0,width:(a?.width||200)*T,height:a?.height||200};break;case"wipe-right":w={x:(a?.width||200)*(1-T),y:0,width:(a?.width||200)*T,height:a?.height||200};break;case"wipe-up":w={x:0,y:(a?.height||200)*(1-T),width:a?.width||200,height:(a?.height||200)*T};break;case"wipe-down":w={x:0,y:0,width:a?.width||200,height:(a?.height||200)*T};break;case"reveal-center":const P=T;m={x:m.x*P,y:m.y*P},w={x:(a?.width||200)*(1-T)*.5,y:(a?.height||200)*(1-T)*.5,width:(a?.width||200)*T,height:(a?.height||200)*T};break;case"reveal-edges":w={x:(a?.width||200)*T*.5,y:(a?.height||200)*T*.5,width:(a?.width||200)*(1-T),height:(a?.height||200)*(1-T)};break;case"elastic":const R=T<.5?4*T*T*T:1-Math.pow(-2*T+2,3)/2,D=(R>1,R);m={x:m.x*D,y:m.y*D};break;case"flip-horizontal":m={x:m.x*Math.cos(T*Math.PI),y:m.y},g*=Math.abs(Math.cos(T*Math.PI/2));break;case"flip-vertical":m={x:m.x,y:m.y*Math.cos(T*Math.PI)},g*=Math.abs(Math.cos(T*Math.PI/2));break}}if(d&&u>b-d.duration){const A=b-d.duration,j=(u-A)/d.duration;switch(d.type){case"fade":g*=1-j;break;case"scale":const _=1-j;m={x:m.x*_,y:m.y*_};break;case"slide-left":y=-j*t;break;case"slide-right":y=j*t;break;case"slide-up":x=-j*s;break;case"slide-down":x=j*s;break;case"rotate":r.rotate(j*Math.PI*2),g*=1-j;break;case"bounce":const M=1-(j<.5?2*j*j:1-Math.pow(-2*j+2,2)/2);m={x:m.x*M,y:m.y*M},g*=1-j;break;case"pop":const P=j<.5?1-j*.2:1-j*2.2;m={x:m.x*Math.max(0,P),y:m.y*Math.max(0,P)};break;case"draw":C=1-j,g*=Math.max(0,1-j*2);break;case"wipe-left":w={x:(a?.width||200)*j,y:0,width:(a?.width||200)*(1-j),height:a?.height||200};break;case"wipe-right":w={x:0,y:0,width:(a?.width||200)*(1-j),height:a?.height||200};break;case"wipe-up":w={x:0,y:0,width:a?.width||200,height:(a?.height||200)*(1-j)};break;case"wipe-down":w={x:0,y:(a?.height||200)*j,width:a?.width||200,height:(a?.height||200)*(1-j)};break;case"reveal-center":w={x:(a?.width||200)*j*.5,y:(a?.height||200)*j*.5,width:(a?.width||200)*(1-j),height:(a?.height||200)*(1-j)};break;case"reveal-edges":w={x:(a?.width||200)*(1-j)*.5,y:(a?.height||200)*(1-j)*.5,width:(a?.width||200)*j,height:(a?.height||200)*j};break;case"elastic":const R=1-(j<.5?4*j*j*j:1-Math.pow(-2*j+2,3)/2);m={x:m.x*Math.max(0,R),y:m.y*Math.max(0,R)};break;case"flip-horizontal":m={x:m.x*Math.cos((1-j)*Math.PI+Math.PI),y:m.y},g*=Math.abs(Math.cos((1-j)*Math.PI/2));break;case"flip-vertical":m={x:m.x,y:m.y*Math.cos((1-j)*Math.PI+Math.PI)},g*=Math.abs(Math.cos((1-j)*Math.PI/2));break}}r.translate(y,x),r.scale(m.x,m.y),r.globalAlpha=g;const k=e.id;let S=Ko.get(k);if(!S){S=new Image;const A=new Blob([n],{type:"image/svg+xml"});if(S.src=URL.createObjectURL(A),Ko.set(k,S),Ko.size>50){const T=Ko.keys().next().value;if(T){const j=Ko.get(T);j?.src?.startsWith("blob:")&&URL.revokeObjectURL(j.src),Ko.delete(T)}}}if(S.complete&&S.naturalWidth>0){const A=a?.width||200,T=a?.height||200,j=document.createElement("canvas");j.width=A,j.height=T;const _=j.getContext("2d");if(_){if(_.drawImage(S,0,0,A,T),o&&o.colorMode&&o.colorMode!=="none"&&(o.colorMode==="tint"||o.colorMode==="replace")&&(_.globalCompositeOperation="source-in",_.fillStyle=o.tintColor||"#ffffff",_.globalAlpha=o.tintOpacity??1,_.fillRect(0,0,A,T)),w&&(r.save(),r.beginPath(),r.rect(-A/2+w.x,-T/2+w.y,w.width,w.height),r.clip()),C>0&&C<1){const M=Math.max(A,T)*4,P=M*(1-C);_.globalCompositeOperation="destination-in",_.strokeStyle="#000",_.lineWidth=Math.max(A,T),_.setLineDash([M]),_.lineDashOffset=P,_.strokeRect(0,0,A,T),_.setLineDash([])}r.drawImage(j,-A/2,-T/2,A,T),w&&r.restore()}}r.restore()},DK=(r,e,t,s)=>{const{shapeType:i,style:n,transform:a}=e;r.save();const o=a.position.x*t,l=a.position.y*s;r.translate(o,l),r.rotate(a.rotation*Math.PI/180),r.scale(a.scale.x,a.scale.y),r.globalAlpha=a.opacity,n.shadow?.blur&&n.shadow.blur>0&&(r.shadowColor=n.shadow.color||"#000000",r.shadowBlur=n.shadow.blur,r.shadowOffsetX=n.shadow.offsetX||0,r.shadowOffsetY=n.shadow.offsetY||0);const d=Math.min(t,s),u=d*.15,h=u/2,p=d/1080;switch(r.fillStyle=n.fill?.color||"#3b82f6",r.strokeStyle=n.stroke?.color||"#1d4ed8",r.lineWidth=(n.stroke?.width||2)*p,n.stroke?.dashArray&&n.stroke.dashArray.length>0&&r.setLineDash(n.stroke.dashArray),r.beginPath(),i){case"rectangle":{const f=n.cornerRadius||0;f>0?r.roundRect(-h,-h,u,u,Math.min(f,h)):r.rect(-h,-h,u,u);break}case"circle":case"ellipse":{r.ellipse(0,0,h,h,0,0,Math.PI*2);break}case"triangle":{r.moveTo(0,-h),r.lineTo(h,h),r.lineTo(-h,h),r.closePath();break}case"star":{const f=n.points||5,m=(n.innerRadius||.5)*h;for(let g=0;g<f*2;g++){const y=g%2===0?h:m,x=g*Math.PI/f-Math.PI/2,b=Math.cos(x)*y,w=Math.sin(x)*y;g===0?r.moveTo(b,w):r.lineTo(b,w)}r.closePath();break}case"arrow":{r.moveTo(-h,0),r.lineTo(h*.3,0),r.lineTo(h*.3,-h*.4),r.lineTo(h,0),r.lineTo(h*.3,h*.4),r.lineTo(h*.3,0),r.closePath();break}case"line":{r.moveTo(-h,0),r.lineTo(h,0);break}default:r.rect(-h,-h,u,u)}r.globalAlpha=a.opacity*(n.fill?.opacity??1),r.fill(),n.stroke?.width&&n.stroke.width>0&&(r.globalAlpha=a.opacity*(n.stroke?.opacity??1),r.stroke()),r.restore()},Ul=(r,e,t,s,i)=>{const n=i-e.startTime;let a=e.transform;e.keyframes&&e.keyframes.length>0&&(a=Xn(e.transform,e.keyframes,n));let o={...e,transform:a};if(e.emphasisAnimation&&e.emphasisAnimation.type!=="none"){const u=Md(e.emphasisAnimation,n);o={...o,transform:{...a,opacity:a.opacity*u.opacity,scale:{x:a.scale.x*u.scale*u.scaleX,y:a.scale.y*u.scale*u.scaleY},position:{x:a.position.x+u.offsetX,y:a.position.y+u.offsetY},rotation:a.rotation+u.rotation}}}const l=o.transform.rotate3d&&(o.transform.rotate3d.x!==0||o.transform.rotate3d.y!==0),d=o.blendMode&&o.blendMode!=="normal";if(l||d){bt||(bt=new ev(t,s)),(bt.canvas.width!==t||bt.canvas.height!==s)&&bt.resize(t,s),bt.clear();let u=null;if(o.type==="svg"?u=bt.renderSVGClip(o,t,s):o.type==="sticker"||o.type==="emoji"?u=bt.renderStickerClip(o,t,s):u=bt.renderShapeClip(o,t,s),u){bt.getScene().add(u);const h=bt.render();r.drawImage(h,0,0)}return}o.type==="svg"?IK(r,o,t,s,i):o.type==="sticker"||o.type==="emoji"?RK(r,o,t,s,i):DK(r,o,t,s)},Qo=(r,e)=>r.filter(t=>e>=t.startTime&&e<t.endTime),Jo=(r,e,t,s,i)=>{const{text:n,animationStyle:a,words:o}=e;if(!n||n.trim().length===0)return;const l=a&&a!=="none"&&o&&o.length>0,d=i??e.startTime;l?BK(r,e,t,s,d):FK(r,e,t,s)},FK=(r,e,t,s)=>{const{text:i,style:n}=e;r.save();const a=n?.fontSize||24,o=n?.fontFamily||"Inter",l=n?.color||"#ffffff",d=n?.backgroundColor||"rgba(0, 0, 0, 0.7)",u=n?.position||"bottom";r.font=`bold ${a}px "${o}"`,r.textAlign="center",r.textBaseline="middle";const h=i.split(`
`),p=a*1.3,f=h.length*p;let m;u==="top"?m=a*2:u==="center"?m=s/2-f/2:m=s-a*2-f;for(let g=0;g<h.length;g++){const y=h[g].trim();if(y.length===0)continue;const x=m+g*p+p/2,w=r.measureText(y).width+20,C=p;r.fillStyle=d,r.fillRect(t/2-w/2,x-C/2,w,C),r.fillStyle=l,r.fillText(y,t/2,x)}r.restore()},BK=(r,e,t,s,i)=>{const n=wY(e,i);if(!n.visible||n.segments.length===0)return;r.save();const a=e.style,o=a?.fontSize||24,l=a?.fontFamily||"Inter",d=a?.color||"#ffffff",u=a?.backgroundColor||"rgba(0, 0, 0, 0.7)",h=a?.position||"bottom";r.font=`bold ${o}px "${l}"`,r.textBaseline="middle";const p=o*1.3;let f;h==="top"?f=o*2+p/2:h==="center"?f=s/2:f=s-o*2-p/2;const m=n.segments.map(w=>w.text).join(" "),g=r.measureText(m).width,y=g+30,x=p+10;r.fillStyle=u,r.fillRect(t/2-y/2,f-x/2,y,x);let b=t/2-g/2;for(const w of n.segments){const C=r.measureText(w.text+" ").width;r.save(),r.globalAlpha=w.opacity;const k=b+r.measureText(w.text).width/2,S=f+w.offsetY;r.translate(k,S),r.scale(w.scale,w.scale),r.translate(-k,-S);const A=LK(w,d,a?.highlightColor);r.fillStyle=A,r.textAlign="left",r.fillText(w.text,b,f+w.offsetY),r.restore(),b+=C}r.restore()},LK=(r,e,t)=>{if(r.color)return r.color.startsWith("linear-gradient")?t||"#ffff00":r.color==="transparent"?"rgba(0,0,0,0)":r.color;switch(r.style){case"highlighted":case"active":return t||"#ffff00";case"hidden":return"rgba(0,0,0,0)";default:return e}},Pr=(r,e,t,s,i,n)=>{const a={...Ii,...t,position:{x:t?.position?.x??Ii.position.x,y:t?.position?.y??Ii.position.y},scale:{x:t?.scale?.x??Ii.scale.x,y:t?.scale?.y??Ii.scale.y},anchor:{x:t?.anchor?.x??Ii.anchor.x,y:t?.anchor?.y??Ii.anchor.y}},o=a.rotate3d,l=o&&(o.x!==0||o.y!==0||o.z!==0),d=a.perspective;if(l||d&&d!==1e3){bt||(bt=new ev(s,i)),(bt.canvas.width!==s||bt.canvas.height!==i)&&bt.resize(s,i),bt.clear();const M=bt.renderImageFrame(e,a,s,i,n,100);if(M){bt.getScene().add(M);const P=bt.render();r.drawImage(P,0,0)}return}const h=n&&n!=="normal",p=(a.opacity??1)<1,f=h&&p;let m=r,g=null;f&&(typeof OffscreenCanvas<"u"?g=new OffscreenCanvas(s,i):(g=document.createElement("canvas"),g.width=s,g.height=i),m=g.getContext("2d"),m||(m=r,g=null)),m.save(),m.globalAlpha=f?1:a.opacity??1,h&&!f&&(m.globalCompositeOperation=n);const y=s/2,x=i/2;m.translate(y+a.position.x,x+a.position.y),m.rotate(a.rotation*Math.PI/180),m.scale(a.scale.x,a.scale.y);let b,w;e instanceof HTMLVideoElement?(b=e.videoWidth||s,w=e.videoHeight||i):(b="width"in e?e.width:s,w="height"in e?e.height:i);const C=b/w,k=s/i;let S,A;C>k?(S=s,A=s/C):(A=i,S=i*C);const T=-S*a.anchor.x,j=-A*a.anchor.y,_=a.borderRadius||0;if(_>0){m.beginPath();const M=Math.min(_,S/2,A/2);m.roundRect(T,j,S,A,M),m.clip()}if(a.crop){const M=a.crop.x*b,P=a.crop.y*w,R=a.crop.width*b,D=a.crop.height*w,B=R/D;let O,F;B>k?(O=s,F=s/B):(F=i,O=i*B);const I=-O*a.anchor.x,J=-F*a.anchor.y;m.drawImage(e,M,P,R,D,I,J,O,F)}else m.drawImage(e,T,j,S,A);m.restore(),g&&h&&(r.save(),r.globalAlpha=a.opacity??1,r.globalCompositeOperation=n,r.drawImage(g,0,0),r.restore())},Ha=async(r,e)=>{try{let t=e;try{const{useEngineStore:u}=await _i(async()=>{const{useEngineStore:f}=await Promise.resolve().then(()=>$X);return{useEngineStore:f}},void 0),h=await u.getState().getChromaKeyEngine(),p=h?h.isEnabled(r):!1;if(h&&p){const f=await h.applyChromaKey(t,r);f&&f.image&&f.image.width>0&&f.image.height>0?t=f.image:console.warn("[ChromaKey] Chroma key returned invalid result")}}catch(u){console.error("[ChromaKey] Chroma key processing failed:",u)}const s=JY();s&&s.isInitialized();const i=mr();if(!i.isInitialized())return t;const a=i.getEffects(r),o=i.getColorGrading(r),l=Date.now();if(l-D2>5e3&&(D2=l),a.filter(u=>u.enabled).length>0)try{const u=await i.processEffects(r,t);u.image&&u.image.width>0&&u.image.height>0&&(t=u.image)}catch{}if(Object.keys(o).length>0)try{const u=await i.processColorGrading(r,t);u.image&&u.image.width>0&&u.image.height>0&&(t=u.image)}catch{}return t}catch{return e}},OK=(r,e)=>{try{const t=Zb();if(!t.isInitialized())return null;const s=e.filter(i=>i.type==="video"||i.type==="image");for(const i of s){const n=t.getTransitionsForTrack(i.id);for(const a of n){const o=i.clips.find(d=>d.id===a.clipAId),l=i.clips.find(d=>d.id===a.clipBId);if(!(!o||!l)&&t.isTimeInTransition(a,o,r)){const d=t.calculateProgress(a,o,r);return{clipA:{id:o.id,startTime:o.startTime,duration:o.duration,mediaId:o.mediaId,inPoint:o.inPoint},clipB:{id:l.id,startTime:l.startTime,duration:l.duration,mediaId:l.mediaId,inPoint:l.inPoint},transitionId:a.id,progress:d}}}}return null}catch{return null}},$K=async(r,e,t)=>{try{const s=Zb();if(!s.isInitialized())return r.progress<.5?e:t;const i=s.getTransition(r.transitionId);if(!i)return r.progress<.5?e:t;const n=await s.renderTransition(e,t,i,r.progress);return n&&n.frame&&n.frame.width>0&&n.frame.height>0?n.frame:r.progress<.5?e:t}catch{return r.progress<.5?e:t}},zK=[{label:"Free",value:null},{label:"9:16",value:9/16},{label:"16:9",value:16/9},{label:"1:1",value:1},{label:"4:3",value:4/3},{label:"3:4",value:3/4}],VK=({clip:r,videoSrc:e,mediaType:t,currentTime:s,canvasWidth:i,canvasHeight:n,onCropChange:a,onComplete:o,onCancel:l})=>{const d=v.useRef(null),u=v.useRef(null),h=v.useRef(null),p=r.transform.crop||{x:0,y:0,width:1,height:1},[f,m]=v.useState(p),[g,y]=v.useState(!1),[x,b]=v.useState(null),[w,C]=v.useState({x:0,y:0}),[k,S]=v.useState(p),[A,T]=v.useState(null),[j,_]=v.useState({width:0,height:0}),[M,P]=v.useState(!0);v.useEffect(()=>{if(P(!0),t==="image"){const E=h.current;if(!E)return;const G=()=>{E.naturalWidth>0&&E.naturalHeight>0&&(_({width:E.naturalWidth,height:E.naturalHeight}),P(!1))},V=()=>{console.error("[CropModeView] Image load error"),P(!1)};return E.addEventListener("load",G),E.addEventListener("error",V),E.src=e,()=>{E.removeEventListener("load",G),E.removeEventListener("error",V)}}else{const E=u.current;if(!E)return;const G=()=>{E.videoWidth>0&&E.videoHeight>0&&(_({width:E.videoWidth,height:E.videoHeight}),P(!1))},V=()=>{console.error("[CropModeView] Video load error"),P(!1)};return E.addEventListener("loadedmetadata",G),E.addEventListener("error",V),E.src=e,E.currentTime=s,()=>{E.removeEventListener("loadedmetadata",G),E.removeEventListener("error",V)}}},[e,s,t]);const R=(E,G)=>{E.preventDefault(),E.stopPropagation(),y(!0),b(G),C({x:E.clientX,y:E.clientY}),S(f)},D=E=>{if(!g||!x||!d.current)return;const G=(E.clientX-w.x)/(j.width*O),V=(E.clientY-w.y)/(j.height*O);let U={...k};if(x==="center")U.x=Math.max(0,Math.min(1-k.width,k.x+G)),U.y=Math.max(0,Math.min(1-k.height,k.y+V));else if(x==="nw"){const oe=-k.x,re=k.width-.05,ne=-k.y,Ee=k.height-.05,K=Math.max(oe,Math.min(G,re)),me=Math.max(ne,Math.min(V,Ee));if(A){const $=(K+me)/2;U.x=k.x+$,U.y=k.y+$,U.width=k.width-$,U.height=k.height-$}else U.x=k.x+K,U.y=k.y+me,U.width=k.width-K,U.height=k.height-me}else if(x==="ne"){const oe=-k.y,re=k.height-.05,ne=Math.max(oe,Math.min(V,re));if(A){const Ee=(-G+ne)/2;U.y=k.y+Ee,U.width=k.width-Ee,U.height=k.height-Ee}else U.y=k.y+ne,U.width=Math.min(1-k.x,k.width+G),U.height=k.height-ne}else if(x==="sw"){const oe=-k.x,re=k.width-.05,ne=Math.max(oe,Math.min(G,re));if(A){const Ee=(ne-V)/2;U.x=k.x+Ee,U.width=k.width-Ee,U.height=k.height-Ee}else U.x=k.x+ne,U.width=k.width-ne,U.height=Math.min(1-k.y,k.height+V)}else if(x==="se")if(A){const oe=(G+V)/2;U.width=Math.min(1-k.x,Math.max(.1,k.width+oe)),U.height=Math.min(1-k.y,Math.max(.1,k.height+oe))}else U.width=Math.min(1-k.x,Math.max(.1,k.width+G)),U.height=Math.min(1-k.y,Math.max(.1,k.height+V));else if(x==="n"){const oe=-k.y,re=k.height-.05,ne=Math.max(oe,Math.min(V,re));U.y=k.y+ne,U.height=k.height-ne}else if(x==="s")U.height=Math.min(1-k.y,Math.max(.1,k.height+V));else if(x==="w"){const oe=-k.x,re=k.width-.05,ne=Math.max(oe,Math.min(G,re));U.x=k.x+ne,U.width=k.width-ne}else x==="e"&&(U.width=Math.min(1-k.x,Math.max(.1,k.width+G)));U.width=Math.max(.05,Math.min(1,U.width)),U.height=Math.max(.05,Math.min(1,U.height)),U.x=Math.max(0,Math.min(1-U.width,U.x)),U.y=Math.max(0,Math.min(1-U.height,U.y)),m(U)},B=j.width>0&&i>0&&n>0?(()=>{const E=j.width/j.height,G=i/n;let V,U;return E>G?(V=i,U=i/E):(U=n,V=n*E),{width:V,height:U}})():{width:i,height:n},O=j.width>0?B.width/j.width:1,F=j.width>0?{x:f.x*j.width*O,y:f.y*j.height*O,width:f.width*j.width*O,height:f.height*j.height*O}:{x:0,y:0,width:0,height:0},I=()=>{g&&x&&a(f),y(!1),b(null)};v.useEffect(()=>{if(g)return window.addEventListener("mousemove",D),window.addEventListener("mouseup",I),()=>{window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",I)}},[g,x,w,k,A,j,O]);const J=E=>{if(T(E),E){const G=f.width/f.height;let V;if(G>E){const U=f.height*E;V={...f,x:f.x+(f.width-U)/2,width:U}}else{const U=f.width/E;V={...f,y:f.y+(f.height-U)/2,height:U}}m(V),a(V)}},Z=()=>{const E={x:0,y:0,width:1,height:1};m(E),T(null),a(E)};return c.jsxs("div",{className:"absolute inset-0 z-10 bg-background-secondary flex flex-col",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 bg-background border-b border-border",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-xs font-medium text-text-primary",children:"Crop Video"}),c.jsx("div",{className:"flex items-center gap-1",children:zK.map(E=>c.jsx("button",{onClick:()=>J(E.value),disabled:M,className:`px-2.5 py-1 text-xs rounded transition-colors ${A===E.value?"bg-primary text-white font-medium":"bg-background-tertiary text-text-secondary hover:bg-background-secondary"}`,children:E.label},E.label))}),c.jsx("button",{onClick:Z,disabled:M,className:"p-1 text-text-muted hover:bg-background-secondary rounded transition-colors",title:"Reset crop",children:c.jsx(Ca,{size:14})})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("button",{onClick:l,className:"px-3 py-1.5 text-xs bg-background-tertiary hover:bg-background-secondary text-text-primary rounded transition-colors flex items-center gap-1.5",children:[c.jsx(Zs,{size:14}),"Cancel"]}),c.jsxs("button",{onClick:()=>{a(f),o()},disabled:M,className:"px-3 py-1.5 text-xs bg-primary hover:bg-primary/90 text-black font-medium rounded transition-colors flex items-center gap-1.5",children:[c.jsx(Ei,{size:14}),"Apply"]})]})]}),c.jsxs("div",{className:"flex-1 flex items-center justify-center p-4 overflow-hidden relative",children:[M&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background-secondary",children:c.jsx("div",{className:"text-text-muted text-sm",children:"Loading video..."})}),c.jsxs("div",{ref:d,className:"relative",style:{width:B.width,height:B.height,opacity:M?0:1},children:[t==="image"?c.jsx("img",{ref:h,className:"w-full h-full",style:{objectFit:"contain"},alt:"Crop preview"}):c.jsx("video",{ref:u,className:"w-full h-full",style:{objectFit:"contain"},muted:!0,playsInline:!0,preload:"metadata"}),!M&&j.width>0&&c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"absolute inset-0 pointer-events-none",width:B.width,height:B.height,children:[c.jsx("defs",{children:c.jsxs("mask",{id:"crop-mask",children:[c.jsx("rect",{x:"0",y:"0",width:B.width,height:B.height,fill:"white"}),c.jsx("rect",{x:F.x,y:F.y,width:F.width,height:F.height,fill:"black"})]})}),c.jsx("rect",{x:"0",y:"0",width:B.width,height:B.height,fill:"black",opacity:"0.6",mask:"url(#crop-mask)"})]}),c.jsxs("div",{className:"absolute border-2 border-white pointer-events-auto cursor-move",style:{left:F.x,top:F.y,width:F.width,height:F.height},onMouseDown:E=>R(E,"center"),children:[c.jsxs("svg",{className:"absolute inset-0 pointer-events-none",width:"100%",height:"100%",children:[c.jsx("line",{x1:"33.33%",y1:"0",x2:"33.33%",y2:"100%",stroke:"white",strokeWidth:"1",opacity:"0.5"}),c.jsx("line",{x1:"66.66%",y1:"0",x2:"66.66%",y2:"100%",stroke:"white",strokeWidth:"1",opacity:"0.5"}),c.jsx("line",{x1:"0",y1:"33.33%",x2:"100%",y2:"33.33%",stroke:"white",strokeWidth:"1",opacity:"0.5"}),c.jsx("line",{x1:"0",y1:"66.66%",x2:"100%",y2:"66.66%",stroke:"white",strokeWidth:"1",opacity:"0.5"})]}),["nw","ne","sw","se"].map(E=>c.jsx("div",{className:"absolute w-4 h-4 bg-white border-2 border-gray-800 rounded-sm cursor-nwse-resize pointer-events-auto hover:bg-primary transition-colors",style:{top:E.includes("n")?-8:void 0,bottom:E.includes("s")?-8:void 0,left:E.includes("w")?-8:void 0,right:E.includes("e")?-8:void 0},onMouseDown:G=>R(G,E)},E)),c.jsx("div",{className:"absolute w-16 h-4 bg-white border-2 border-gray-800 rounded-sm cursor-ns-resize pointer-events-auto hover:bg-primary transition-colors -top-2 left-1/2 -translate-x-1/2",onMouseDown:E=>R(E,"n")}),c.jsx("div",{className:"absolute w-16 h-4 bg-white border-2 border-gray-800 rounded-sm cursor-ns-resize pointer-events-auto hover:bg-primary transition-colors -bottom-2 left-1/2 -translate-x-1/2",onMouseDown:E=>R(E,"s")}),c.jsx("div",{className:"absolute w-4 h-16 bg-white border-2 border-gray-800 rounded-sm cursor-ew-resize pointer-events-auto hover:bg-primary transition-colors -left-2 top-1/2 -translate-y-1/2",onMouseDown:E=>R(E,"w")}),c.jsx("div",{className:"absolute w-4 h-16 bg-white border-2 border-gray-800 rounded-sm cursor-ew-resize pointer-events-auto hover:bg-primary transition-colors -right-2 top-1/2 -translate-y-1/2",onMouseDown:E=>R(E,"e")})]})]})]})]})]})},UK=({points:r,canvasWidth:e,canvasHeight:t,selectedPoint:s,hoveredPoint:i,disabled:n,onPointSelect:a,onPointHover:o,onPointMove:l,onPointRemove:d,onControlPointMove:u})=>{const[h,p]=v.useState(null),f=v.useRef(null),m=v.useCallback((b,w,C,k,S)=>{n||(b.preventDefault(),b.stopPropagation(),p({type:w,pointIndex:C,startX:b.clientX,startY:b.clientY,initialX:k,initialY:S}),w==="point"&&a(C))},[n,a]),g=v.useCallback(b=>{if(!h)return;const w=b.clientX-h.startX,C=b.clientY-h.startY,k=h.initialX+w,S=h.initialY+C;h.type==="point"?l(h.pointIndex,k,S):u(h.pointIndex,h.type,k,S)},[h,l,u]),y=v.useCallback(()=>{p(null)},[]);v.useEffect(()=>{if(h)return window.addEventListener("mousemove",g),window.addEventListener("mouseup",y),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",y)}},[h,g,y]);const x=v.useCallback((b,w)=>{b.preventDefault(),r.length>2&&d(w)},[r.length,d]);return c.jsx("g",{ref:f,children:r.map((b,w)=>{const C=s===w,k=i===w,S=C&&b.controlPoints;return c.jsxs("g",{children:[S&&b.controlPoints&&c.jsxs(c.Fragment,{children:[c.jsx("line",{x1:b.controlPoints.cp1.x,y1:b.controlPoints.cp1.y,x2:b.screenX,y2:b.screenY,stroke:"#a855f7",strokeWidth:"1",opacity:"0.6"}),c.jsx("line",{x1:b.screenX,y1:b.screenY,x2:b.controlPoints.cp2.x,y2:b.controlPoints.cp2.y,stroke:"#a855f7",strokeWidth:"1",opacity:"0.6"}),c.jsx("circle",{cx:b.controlPoints.cp1.x,cy:b.controlPoints.cp1.y,r:"5",fill:"#a855f7",stroke:"white",strokeWidth:"1",className:"cursor-move pointer-events-auto",onMouseDown:A=>m(A,"cp1",w,b.controlPoints.cp1.x,b.controlPoints.cp1.y)}),c.jsx("circle",{cx:b.controlPoints.cp2.x,cy:b.controlPoints.cp2.y,r:"5",fill:"#a855f7",stroke:"white",strokeWidth:"1",className:"cursor-move pointer-events-auto",onMouseDown:A=>m(A,"cp2",w,b.controlPoints.cp2.x,b.controlPoints.cp2.y)})]}),c.jsxs("g",{transform:`translate(${b.screenX}, ${b.screenY}) rotate(45)`,className:"pointer-events-auto cursor-move",onMouseDown:A=>m(A,"point",w,b.screenX,b.screenY),onMouseEnter:()=>o(w),onMouseLeave:()=>o(null),onContextMenu:A=>x(A,w),children:[c.jsx("rect",{x:"-7",y:"-7",width:"14",height:"14",fill:C?"#22d3ee":k?"#67e8f9":"white",stroke:C?"white":"#22d3ee",strokeWidth:"2",rx:"2"}),w===0&&c.jsx("text",{transform:"rotate(-45)",x:"0",y:"4",textAnchor:"middle",fill:C?"white":"#22d3ee",fontSize:"8",fontWeight:"bold",className:"pointer-events-none select-none",children:"S"}),w===r.length-1&&w!==0&&c.jsx("text",{transform:"rotate(-45)",x:"0",y:"4",textAnchor:"middle",fill:C?"white":"#22d3ee",fontSize:"8",fontWeight:"bold",className:"pointer-events-none select-none",children:"E"})]})]},`point-${w}`)})})},GK=({config:r,canvasWidth:e,canvasHeight:t,currentTime:s,clipDuration:i,onPointMove:n,onPointAdd:a,onPointRemove:o,onControlPointMove:l,disabled:d=!1})=>{const[u,h]=v.useState(null),[p,f]=v.useState(null),m=v.useMemo(()=>r.points.map(w=>({...w,screenX:e/2+w.x,screenY:t/2+w.y,controlPoints:w.controlPoints?{cp1:{x:e/2+w.controlPoints.cp1.x,y:t/2+w.controlPoints.cp1.y},cp2:{x:e/2+w.controlPoints.cp2.x,y:t/2+w.controlPoints.cp2.y}}:void 0})),[r.points,e,t]),g=v.useMemo(()=>{if(m.length<2)return"";const w=m.map(C=>({x:C.screenX,y:C.screenY,time:C.time,controlPoints:C.controlPoints}));return zP(w)},[m]),y=v.useMemo(()=>{if(r.points.length===0||i<=0)return null;const w=s/i,C=[...m].sort((k,S)=>k.time-S.time);if(w<=C[0].time)return{x:C[0].screenX,y:C[0].screenY};if(w>=C[C.length-1].time){const k=C[C.length-1];return{x:k.screenX,y:k.screenY}}for(let k=0;k<C.length-1;k++)if(w>=C[k].time&&w<=C[k+1].time){const S=C[k],A=C[k+1],T=A.time-S.time,j=T>0?(w-S.time)/T:0;return S.controlPoints&&A.controlPoints?WK({x:S.screenX,y:S.screenY},S.controlPoints.cp2,A.controlPoints.cp1,{x:A.screenX,y:A.screenY},j):{x:S.screenX+(A.screenX-S.screenX)*j,y:S.screenY+(A.screenY-S.screenY)*j}}return null},[m,s,i,r.points.length]),x=v.useCallback(w=>{if(d)return;const C=w.currentTarget.closest("svg");if(!C)return;const k=C.getBoundingClientRect(),S=w.clientX-k.left,A=w.clientY-k.top,T=S-e/2,j=A-t/2;let _=.5;if(m.length>=2){let M=1/0,P=.5;for(let R=0;R<m.length-1;R++){const D=m[R],B=m[R+1],O=B.screenX-D.screenX,F=B.screenY-D.screenY,I=Math.sqrt(O*O+F*F);if(I===0)continue;const J=Math.max(0,Math.min(1,((S-D.screenX)*O+(A-D.screenY)*F)/(I*I))),Z=D.screenX+J*O,E=D.screenY+J*F,G=Math.sqrt((S-Z)**2+(A-E)**2);G<M&&(M=G,P=D.time+J*(B.time-D.time))}_=P}a({x:T,y:j,time:_})},[e,t,m,a,d]),b=v.useCallback(w=>{h(C=>C===w?null:w)},[]);return!r.enabled||!r.showPath?null:c.jsxs("svg",{className:"absolute inset-0 pointer-events-none",width:e,height:t,style:{overflow:"visible"},children:[c.jsx("defs",{children:c.jsx("marker",{id:"motion-path-arrow",markerWidth:"6",markerHeight:"6",refX:"3",refY:"3",orient:"auto",markerUnits:"strokeWidth",children:c.jsx("path",{d:"M0,0 L6,3 L0,6 Z",fill:"#22d3ee"})})}),g&&c.jsxs(c.Fragment,{children:[c.jsx("path",{d:g,fill:"none",stroke:"#22d3ee",strokeWidth:"2",strokeDasharray:"6 3",opacity:"0.8",className:"pointer-events-auto cursor-crosshair",onClick:x}),c.jsx("path",{d:g,fill:"none",stroke:"transparent",strokeWidth:"16",className:"pointer-events-auto cursor-crosshair",onClick:x})]}),c.jsx(UK,{points:m,canvasWidth:e,canvasHeight:t,selectedPoint:u,hoveredPoint:p,disabled:d,onPointSelect:b,onPointHover:f,onPointMove:(w,C,k)=>{const S=C-e/2,A=k-t/2;n(w,S,A)},onPointRemove:o,onControlPointMove:(w,C,k,S)=>{const A=k-e/2,T=S-t/2;l(w,C,A,T)}}),y&&c.jsxs("g",{transform:`translate(${y.x}, ${y.y})`,children:[c.jsx("circle",{r:"8",fill:"#22d3ee",opacity:"0.3"}),c.jsx("circle",{r:"5",fill:"#22d3ee"}),c.jsx("circle",{r:"3",fill:"white"})]}),m.map((w,C)=>c.jsxs("text",{x:w.screenX+12,y:w.screenY-12,fill:"white",fontSize:"10",fontFamily:"system-ui",className:"pointer-events-none select-none",children:[(w.time*100).toFixed(0),"%"]},`label-${C}`))]})};function WK(r,e,t,s,i){const n=1-i,a=n*n,o=a*n,l=i*i,d=l*i;return{x:o*r.x+3*a*i*e.x+3*n*l*t.x+d*s.x,y:o*r.y+3*a*i*e.y+3*n*l*t.y+d*s.y}}const YK=({effects:r,width:e,height:t,currentTime:s,isPlaying:i})=>{const n=v.useRef(null),a=v.useRef(null),o=v.useRef(null),l=v.useRef(null),d=v.useRef(null),u=v.useRef(null),h=v.useRef(null),p=v.useRef(null),f=v.useRef(s),m=v.useRef(performance.now()),g=v.useRef(0),y=v.useRef(0),x=v.useRef(i),[b,w]=Ye.useState(!1),C=v.useMemo(()=>eu(),[]),k=v.useCallback(_=>{switch(_){case"add":return wc;case"multiply":return _g;case"screen":return wc;case"normal":default:return gr}},[]);v.useEffect(()=>{f.current=s},[s]),v.useEffect(()=>{C.setCanvasSize(e,t)},[C,e,t]);const S=v.useRef(new Set);v.useEffect(()=>{const _=new Set(r.map(P=>P.id)),M=S.current;for(const P of r)C.getEffect(P.id)?M.has(P.id)||C.updateEffect(P.id,P.config):C.addEffect(P);for(const P of M)_.has(P)||C.removeEffect(P);S.current=_},[r,C]),v.useEffect(()=>{if(!n.current||e<=0||t<=0)return;const _=new ZS;o.current=_;const M=new eT(0,e,t,0,.1,1e3);M.position.z=100,l.current=M;const P=new JS({alpha:!0,antialias:!0,premultipliedAlpha:!1});P.setSize(e,t,!1),P.setPixelRatio(Math.min(window.devicePixelRatio,2)),P.setClearColor(0,0),P.domElement.style.width="100%",P.domElement.style.height="100%",P.domElement.style.objectFit="contain",P.domElement.style.position="absolute",P.domElement.style.top="0",P.domElement.style.left="0",n.current.appendChild(P.domElement),a.current=P;const R=new wR,D=new Float32Array(1e4*3),B=new Float32Array(1e4*3),O=new Float32Array(1e4),F=new Float32Array(1e4);R.setAttribute("position",new Nu(D,3)),R.setAttribute("color",new Nu(B,3)),R.setAttribute("size",new Nu(O,1)),R.setAttribute("alpha",new Nu(F,1)),d.current=R;const I=new kR({size:12,vertexColors:!0,transparent:!0,opacity:1,blending:wc,depthWrite:!1,sizeAttenuation:!1});u.current=I;const J=new CR(R,I);return h.current=J,_.add(J),w(!0),()=>{w(!1),R.dispose(),I.dispose(),P.dispose(),n.current&&P.domElement&&n.current.removeChild(P.domElement)}},[e,t]),v.useEffect(()=>{if(!u.current||r.length===0)return;const _=r.find(M=>M.enabled);if(_){const M=k(_.config.blendMode);u.current.blending!==M&&(u.current.blending=M,u.current.needsUpdate=!0)}},[r,k]);const A=v.useCallback(_=>{const M=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(_);if(M)return{r:parseInt(M[1],16)/255,g:parseInt(M[2],16)/255,b:parseInt(M[3],16)/255};const P=/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/i.exec(_);return P?{r:parseInt(P[1],10)/255,g:parseInt(P[2],10)/255,b:parseInt(P[3],10)/255}:{r:1,g:1,b:1}},[]),T=v.useCallback(_=>{if(!d.current)return;const M=d.current.attributes.position.array,P=d.current.attributes.color.array,R=d.current.attributes.size.array,D=Math.min(_.length,1e4);for(let B=0;B<D;B++){const O=_[B],F=B*3;M[F]=O.position.x,M[F+1]=t-O.position.y,M[F+2]=O.position.z;const I=A(O.color);P[F]=I.r*O.opacity,P[F+1]=I.g*O.opacity,P[F+2]=I.b*O.opacity,R[B]=O.size}for(let B=D;B<1e4;B++){const O=B*3;M[O]=0,M[O+1]=0,M[O+2]=-1e3,R[B]=0}d.current.attributes.position.needsUpdate=!0,d.current.attributes.color.needsUpdate=!0,d.current.attributes.size.needsUpdate=!0,d.current.setDrawRange(0,D)},[A,t]),j=v.useCallback(()=>{!a.current||!o.current||!l.current||a.current.render(o.current,l.current)},[]);return v.useEffect(()=>{x.current=i},[i]),v.useEffect(()=>{if(b)if(i){g.current=performance.now(),y.current=f.current,m.current=performance.now();const _=()=>{if(!x.current)return;const M=performance.now(),P=M-m.current;m.current=M;const R=P/1e3,D=(M-g.current)/1e3,B=y.current+D;C.update(B,R);const O=C.getParticles();T(O),j(),p.current=requestAnimationFrame(_)};return p.current=requestAnimationFrame(_),()=>{p.current&&(cancelAnimationFrame(p.current),p.current=null)}}else{C.update(s,1/30);const _=C.getParticles();T(_),j()}},[i,b,s,C,T,j,r]),v.useEffect(()=>{l.current&&(l.current.left=0,l.current.right=e,l.current.top=t,l.current.bottom=0,l.current.updateProjectionMatrix()),a.current&&a.current.setSize(e,t,!1)},[e,t]),c.jsx("div",{ref:n,className:"absolute inset-0 pointer-events-none w-full h-full",style:{zIndex:50}})};let qK=0;const HK=wa((r,e)=>({tasks:new Map,isProcessing:!1,currentTaskId:null,addTask:(t,s)=>{const i=`task-${++qK}-${Date.now()}`,n={id:i,clipId:t,type:s,progress:0,status:"queued",message:"Waiting to start..."};return r(a=>{const o=new Map(a.tasks);return o.set(i,n),{tasks:o,isProcessing:!0,currentTaskId:a.currentTaskId||i}}),i},updateTaskProgress:(t,s,i)=>{r(n=>{const a=n.tasks.get(t);if(!a)return n;const o=new Map(n.tasks);return o.set(t,{...a,progress:Math.min(100,Math.max(0,s)),status:"processing",message:i||a.message,startedAt:a.startedAt||Date.now()}),{tasks:o}})},completeTask:t=>{r(s=>{const i=s.tasks.get(t);if(!i)return s;const n=new Map(s.tasks);n.set(t,{...i,progress:100,status:"completed",message:"Complete",completedAt:Date.now()});const a=Array.from(n.values()).some(l=>l.status==="queued"||l.status==="processing"),o=a&&Array.from(n.values()).find(l=>l.status==="queued")?.id||null;return{tasks:n,isProcessing:a,currentTaskId:o}})},failTask:(t,s)=>{r(i=>{const n=i.tasks.get(t);if(!n)return i;const a=new Map(i.tasks);a.set(t,{...n,status:"failed",message:"Failed",error:s,completedAt:Date.now()});const o=Array.from(a.values()).some(l=>l.status==="queued"||l.status==="processing");return{tasks:a,isProcessing:o,currentTaskId:o&&Array.from(a.values()).find(l=>l.status==="queued")?.id||null}})},removeTask:t=>{r(s=>{const i=new Map(s.tasks);i.delete(t);const n=Array.from(i.values()).some(a=>a.status==="queued"||a.status==="processing");return{tasks:i,isProcessing:n,currentTaskId:n?s.currentTaskId:null}})},getTasksForClip:t=>Array.from(e().tasks.values()).filter(s=>s.clipId===t),hasActiveProcessing:()=>Array.from(e().tasks.values()).some(t=>t.status==="queued"||t.status==="processing"),getOverallProgress:()=>{const t=Array.from(e().tasks.values()),s=t.filter(a=>a.status!=="completed"&&a.status!=="failed");if(s.length===0)return{total:0,completed:0,progress:100};const n=s.reduce((a,o)=>a+o.progress,0)/s.length;return{total:s.length,completed:t.filter(a=>a.status==="completed").length,progress:Math.round(n)}},clearCompleted:()=>{r(t=>{const s=new Map(t.tasks);for(const[i,n]of s)(n.status==="completed"||n.status==="failed")&&s.delete(i);return{tasks:s}})}})),XK={"background-removal":"Background Removal","auto-reframe":"Auto Reframe","color-grading":"Color Grading",effects:"Video Effects"},KK=({task:r})=>{const e=()=>{switch(r.status){case"queued":return c.jsx(ui,{size:14,className:"text-text-muted"});case"processing":return c.jsx(Ci,{size:14,className:"text-blue-400 animate-spin"});case"completed":return c.jsx(Bx,{size:14,className:"text-green-400"});case"failed":return c.jsx(Yj,{size:14,className:"text-red-400"})}},t=()=>{switch(r.status){case"queued":return"text-text-muted";case"processing":return"text-blue-400";case"completed":return"text-green-400";case"failed":return"text-red-400"}};return c.jsxs("div",{className:"flex items-center gap-3 p-2 bg-black/20 rounded",children:[e(),c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-xs font-medium text-text-primary truncate",children:XK[r.type]}),c.jsx("span",{className:`text-[10px] ${t()}`,children:r.status==="processing"?`${r.progress}%`:r.status})]}),r.status==="processing"&&c.jsxs("div",{className:"mt-1",children:[c.jsx(Cb,{value:r.progress,className:"h-1 bg-black/30"}),c.jsx("p",{className:"text-[9px] text-text-muted mt-0.5 truncate",children:r.message})]}),r.status==="failed"&&r.error&&c.jsx("p",{className:"text-[9px] text-red-400 mt-0.5 truncate",children:r.error})]})]})},QK=()=>{const{tasks:r,isProcessing:e,getOverallProgress:t}=HK(),i=Array.from(r.values()).filter(a=>a.status==="queued"||a.status==="processing");if(!e||i.length===0)return null;const{progress:n}=t();return c.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-background-secondary/95 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-border",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center",children:c.jsx(Ci,{size:20,className:"text-blue-400 animate-spin"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Processing Effects"}),c.jsxs("p",{className:"text-xs text-text-muted",children:[i.length," task",i.length!==1?"s":""," in progress"]})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Overall Progress"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[n,"%"]})]}),c.jsx(Cb,{value:n,className:"h-2 bg-black/30"})]}),c.jsx(oa,{className:"max-h-48",children:c.jsx("div",{className:"space-y-2",children:i.map(a=>c.jsx(KK,{task:a},a.id))})}),c.jsx("p",{className:"text-[10px] text-text-muted text-center mt-4",children:"Please wait while effects are being applied..."})]})})},JK=(r,e)=>{const t=r*e;return t>=3840*2160?6:t>=2560*1440?5:t>=1920*1080?4:3},ZK=async(r,e,t,s)=>{try{if(!r.getDevice()||e.length===0)return null;r.beginFrame();const n=[];for(let o=0;o<e.length;o++){const l=e[o],d=r.createTextureFromImage(l.bitmap);n.push(d);const u={position:l.transform.position,scale:l.transform.scale,rotation:l.transform.rotation,anchor:l.transform.anchor,opacity:l.transform.opacity,borderRadius:l.transform.borderRadius};r.renderLayer({texture:d,transform:u,effects:[],opacity:l.transform.opacity,borderRadius:l.transform.borderRadius||0})}const a=await r.endFrame();for(const o of n)r.releaseTexture(o);return a}catch(i){return console.error("[renderAllLayersWithGPU] Error:",i),null}},eQ=()=>{const r=v.useRef(null),e=v.useRef(null),t=v.useRef(null),s=v.useRef(null),i=v.useRef(!1),n=v.useRef(null),a=v.useRef(null),o=v.useRef(null),l=v.useRef(null),d=v.useRef(null),u=v.useRef(null),h=v.useRef(!1),p=v.useRef(null),f=v.useRef(null),m=v.useRef(null),g=v.useRef(new Map),y=v.useRef(null),x=v.useRef(!1),[b,w]=v.useState(!1),[C,k]=v.useState(!1),[S,A]=v.useState({width:0,height:0}),[T,j]=v.useState("none"),[_,M]=v.useState(!1),[P,R]=v.useState(!1),D=lu(N=>N.isDark),[B,O]=v.useState("none"),[F,I]=v.useState(null),[J,Z]=v.useState(!0),E=v.useRef(null),G=v.useRef(null),V=v.useRef(null),U=v.useRef(!1),oe=v.useRef(0),re=32,ne=v.useRef(0),Ee=16,[K,me]=v.useState(null),[$,Q]=v.useState(null),le=v.useRef(null),ke=v.useRef(new Map),de=v.useRef(new Map);v.useEffect(()=>{const N=r.current;if(!N)return;const L=new ResizeObserver(ie=>{for(const H of ie){const{width:se,height:we}=H.contentRect;A({width:se,height:we}),se>0&&we>0&&(a.current=new OffscreenCanvas(se,we),o.current=a.current.getContext("2d"))}});return L.observe(N),()=>L.disconnect()},[]);const ae=W(N=>N.project),Pe=W(N=>N.getMediaItem),z=fe(N=>N.getTitleEngine),Ue=v.useMemo(()=>z()?.getAllTextClips()||[],[z,ae.modifiedAt]),Je=fe(N=>N.getGraphicsEngine),ge=v.useMemo(()=>{const N=Je(),L=N?.getAllShapeClips()||[],ie=N?.getAllSVGClips()||[],H=N?.getAllStickerClips()||[];return[...L,...ie,...H]},[Je,ae.modifiedAt]),Ce=v.useMemo(()=>ae.timeline.subtitles||[],[ae.timeline.subtitles]),He=W(N=>N.updateClipTransform),Ze=W(N=>N.updateTextTransform),Mt=W(N=>N.updateShapeTransform),ut=ae.timeline.tracks,Ne=ae.settings,It=v.useRef(ut);v.useEffect(()=>{It.current=ut},[ut]);const dr=v.useRef(Ue);v.useEffect(()=>{dr.current=Ue},[Ue]);const si=v.useRef(ge);v.useEffect(()=>{si.current=ge},[ge]);const An=v.useRef(Ce);v.useEffect(()=>{An.current=Ce},[Ce]);const No=v.useRef(!1),Cr=Ft(N=>N.selectedItems),qr=Ft(N=>N.cropMode),ur=Ft(N=>N.cropClipId),Ma=Ft(N=>N.setCropMode),Ro=Ft(N=>N.exportState),Io=Ft(N=>N.motionPathMode),dl=Ft(N=>N.motionPathClipId),{playheadPosition:Ut,playbackState:mf,playbackRate:ul,isScrubbing:Au,pause:Pi,togglePlayback:hl,seekTo:X,seekRelative:be,setPlayheadPosition:De}=$t();v.useEffect(()=>{No.current=Au},[Au]);const Te=mf==="playing",ot=Ye.useMemo(()=>{if(!Io||!dl)return null;for(const N of ae.timeline.tracks){const L=N.clips.find(ie=>ie.id===dl);if(L)return L}return null},[Io,dl,ae.timeline.tracks]),[nt,yt]=Ye.useState(null);Ye.useEffect(()=>{yt(ot?{clipId:ot.id,enabled:!0,pathType:"bezier",points:[],showPath:!0,autoOrient:!1,alignOrigin:[.5,.5]}:null)},[ot]);const Ns=Ye.useCallback((N,L,ie)=>{yt(H=>{if(!H)return H;const se=[...H.points];return se[N]={...se[N],x:L,y:ie},{...H,points:se}})},[]),kt=Ye.useCallback(N=>{yt(L=>{if(!L)return L;const ie=[...L.points,N].sort((H,se)=>H.time-se.time);return{...L,points:ie}})},[]),Sr=Ye.useCallback(N=>{yt(L=>{if(!L)return L;const ie=L.points.filter((H,se)=>se!==N);return{...L,points:ie}})},[]),Pa=Ye.useCallback((N,L,ie,H)=>{yt(se=>{if(!se)return se;const we=[...se.points],Ie=we[N];return Ie.controlPoints||(Ie.controlPoints={cp1:{x:0,y:0},cp2:{x:0,y:0}}),Ie.controlPoints[L]={x:ie,y:H},{...se,points:we}})},[]),jn=Ye.useMemo(()=>eu(),[]),[tv,Do]=Ye.useState(()=>jn.getChangeVersion());Ye.useEffect(()=>jn.onEffectsChange(()=>{Do(jn.getChangeVersion())}),[jn]);const ju=Ye.useMemo(()=>jn.getAllEffects(),[jn,tv]),Gs=Ye.useMemo(()=>{const N=ae.timeline.tracks;let L=0;for(const H of N)for(const se of H.clips){const we=se.startTime+se.duration;we>L&&(L=we)}for(const H of Ue){const se=H.startTime+H.duration;se>L&&(L=se)}for(const H of ge){const se=H.startTime+H.duration;se>L&&(L=se)}const ie=ae.timeline.duration;return ie>0?Math.min(L,ie):L},[ae.timeline.tracks,Ue,ge,ae.timeline.duration]);v.useEffect(()=>{if(i.current)return;const N=Oy();r.current&&N.setCanvas(r.current),i.current=!0,k(!0)},[]),v.useEffect(()=>()=>{for(const N of de.current.values())N.input[Symbol.dispose]?.();de.current.clear();for(const N of ke.current.values())N.video.src="",URL.revokeObjectURL(N.url);ke.current.clear(),l.current&&(l.current.pause(),l.current.src="",l.current=null),d.current&&(URL.revokeObjectURL(d.current),d.current=null),u.current=null},[]),Ye.useLayoutEffect(()=>{const N=r.current;N&&(N.width!==Ne.width||N.height!==Ne.height)&&(N.width=Ne.width,N.height=Ne.height)},[Ne.width,Ne.height]),v.useEffect(()=>{C&&r.current&&Oy().setCanvas(r.current)},[C]),v.useEffect(()=>x.current||!r.current?void 0:((async()=>{try{const L=r.current;if(!L)return;const H=await Jn.getInstance().createRenderer({canvas:L,width:Ne.width,height:Ne.height,preferredRenderer:Wc()?"webgpu":"canvas2d"});y.current=H,x.current=!0,j(H.type),H.onDeviceLost(()=>{console.warn("[Preview] GPU device lost, attempting recovery..."),H.recreateDevice().then(se=>{se||(console.error("[Preview] Failed to recover GPU device"),j("canvas2d"))})})}catch(L){console.warn("[Preview] Failed to initialize GPU renderer:",L),j("canvas2d")}})(),()=>{y.current&&(y.current.destroy(),y.current=null,x.current=!1)}),[]),v.useEffect(()=>{if(y.current&&r.current){const N=r.current;(N.width!==Ne.width||N.height!==Ne.height)&&y.current.resize(Ne.width,Ne.height)}},[Ne.width,Ne.height]);const gf=v.useRef(ul),Fo=v.useRef(Ut),Tr=v.useRef(new Map),pl=v.useRef(new Map);v.useEffect(()=>{gf.current=ul},[ul]),v.useEffect(()=>{Te||(Fo.current=Ut)},[Te,Ut]);const Na=v.useCallback(()=>{const N=Tr.current;for(const[,L]of N)L.input[Symbol.dispose]?.();Tr.current=new Map;for(const[,L]of pl.current)L.close();pl.current=new Map},[]),Bo=v.useCallback(()=>{if(p.current){try{p.current.stop()}catch{}p.current.disconnect(),p.current=null}m.current&&(m.current.stopScheduler(),m.current.stopAllClips())},[]);v.useEffect(()=>{f.current&&(f.current.gain.value=b?0:1),m.current&&m.current.setMasterVolume(b?0:1)},[b]);const Hr=v.useCallback((N,L,ie,H,se,we,Ie,pe="all")=>{const he=L.map((Y,ce)=>({track:Y,originalIndex:ce})).filter(({track:Y})=>(Y.type==="video"||Y.type==="image")&&!Y.hidden).map(({originalIndex:Y})=>Y),ye=he.length>0?Math.min(...he):1/0,Ge=he.length>0?Math.max(...he):-1,je=L.map((Y,ce)=>({track:Y,originalIndex:ce})).filter(({track:Y})=>(Y.type==="text"||Y.type==="graphics")&&!Y.hidden).filter(({originalIndex:Y})=>pe==="below-video"?Y>Ge:pe==="above-video"?Y<ye:!0);je.sort((Y,ce)=>ce.originalIndex-Y.originalIndex);for(const{track:Y}of je)if(Y.type==="graphics"){const ce=ie.filter(ve=>ve.trackId===Y.id);for(const ve of ce)Ul(N,ve,we,Ie,se)}else if(Y.type==="text"){const ce=H.filter(ve=>ve.trackId===Y.id);for(const ve of ce)Vl(N,ve,we,Ie,se)}},[]),aN=v.useCallback(async N=>{const L=It.current,ie=L.filter(he=>he.type==="audio"&&!he.hidden),H=L.filter(he=>(he.type==="video"||he.type==="image")&&!he.hidden);m.current||(m.current=sh());const se=m.current;se.setMasterVolume(b?0:1);const we=W.getState(),Ie=gc(),pe=[];for(const he of ie)if(se.createTrack({trackId:he.id,volume:1,pan:0,muted:he.muted||!1,solo:he.solo||!1,effects:[]}),!he.muted)for(const ye of he.clips){const Ge=ye.startTime+ye.duration;if(N>=ye.startTime&&N<Ge){const ue=Pe(ye.mediaId);if(!ue?.blob)continue;let je=g.current.get(ye.mediaId);if(!je)try{const Oe=se.getAudioContext(),ze=await ue.blob.arrayBuffer();je=await Oe.decodeAudioData(ze),g.current.set(ye.mediaId,je)}catch(Oe){console.warn(`[Preview] Failed to decode audio for clip ${ye.id}:`,Oe);continue}let ce=we.getClip(ye.id)?.audioEffects||[];if(ce.length===0)for(const Oe of H){for(const ze of Oe.clips)if(ze.mediaId===ye.mediaId&&Math.abs(ze.startTime-ye.startTime)<.01){const et=we.getClip(ze.id)?.audioEffects||[];if(et.length>0){ce=et;break}}if(ce.length>0)break}const ve=ce.filter(Oe=>Oe.enabled);se.updateTrackEffects(he.id,ve);const xe=N-ye.startTime,te=Ie.isReverse(ye.id);let Me=(ye.inPoint||0)+xe;te&&(Me=je.duration-Me,Me=Math.max(0,Me)),pe.push({clipId:ye.id,trackId:he.id,audioBuffer:je,startTime:ye.startTime,endTime:Ge,mediaOffset:Me,volume:ye.volume??1,pan:0,effects:ve,speed:ye.speed??1})}}pe.length>0&&(await se.resume(),se.scheduleClips(pe))},[Pe,b]),_u=v.useCallback(async()=>{const N=It.current,L=N.filter(Ie=>Ie.type==="audio"&&!Ie.hidden),ie=N.filter(Ie=>(Ie.type==="video"||Ie.type==="image")&&!Ie.hidden);m.current||(m.current=sh());const se=m.current.getAudioContext(),we=[...L,...ie];for(const Ie of we)for(const pe of Ie.clips){if(g.current.has(pe.mediaId))continue;const he=Pe(pe.mediaId);if(he?.blob)try{const ye=await he.blob.arrayBuffer(),Ge=await se.decodeAudioData(ye);g.current.set(pe.mediaId,Ge)}catch{}}},[Pe]),sv=v.useCallback(N=>{const ie=It.current.filter(we=>(we.type==="audio"||we.type==="video")&&!we.hidden&&!we.muted),H=[],se=W.getState();for(const we of ie)for(const Ie of we.clips){const pe=Ie.startTime+Ie.duration;if(pe<=N||Ie.startTime>N+1)continue;const he=g.current.get(Ie.mediaId);if(!he)continue;const Ge=(se.getClip(Ie.id)?.audioEffects||[]).filter(ue=>ue.enabled);H.push({clipId:Ie.id,trackId:we.id,audioBuffer:he,startTime:Ie.startTime,endTime:pe,mediaOffset:Ie.inPoint||0,volume:Ie.volume??1,pan:0,effects:Ge,speed:Ie.speed??1})}return H},[]),Eu=v.useCallback(async(N,L,ie,H)=>{const se=Pe(N.mediaId);if(!se?.blob)return null;if(se.type==="image")try{return await createImageBitmap(se.blob)}catch{return null}try{const we=L-N.startTime,pe=gc().getSourceTimeAtPlaybackTime(N.id,we);let he=(N.inPoint||0)+pe;const ye=N.mediaId;let Ge=ke.current.get(ye);if(!Ge){const Qe=URL.createObjectURL(se.blob),et=document.createElement("video");if(et.src=Qe,et.muted=!0,et.playsInline=!0,et.preload="auto",et.crossOrigin="anonymous",await new Promise((Dt,ft)=>{const qe=setTimeout(()=>ft(new Error("Video load timeout")),1e4);et.onloadedmetadata=()=>{clearTimeout(qe),Dt()},et.onerror=()=>{clearTimeout(qe),ft(new Error("Video load failed"))}}),Ge={video:et,url:Qe,lastUsed:Date.now()},ke.current.set(ye,Ge),ke.current.size>8){let Dt="",ft=1/0;for(const[qe,Ts]of ke.current.entries())Ts.lastUsed<ft&&(ft=Ts.lastUsed,Dt=qe);if(Dt){const qe=ke.current.get(Dt);qe&&(qe.video.src="",URL.revokeObjectURL(qe.url),ke.current.delete(Dt))}}}Ge.lastUsed=Date.now();const{video:ue}=Ge;if(ue.duration>0&&he>=ue.duration){const Qe=ue.duration-(N.inPoint||0);Qe>0?he=(N.inPoint||0)+(he-(N.inPoint||0))%Qe:he=N.inPoint||0}const je=Math.max(0,Math.min(he,ue.duration-.001));Math.abs(ue.currentTime-je)>.01&&(ue.currentTime=je,await new Promise(Qe=>{const et=()=>{ue.removeEventListener("seeked",et),Qe()};ue.addEventListener("seeked",et),setTimeout(Qe,500)}));const Y=document.createElement("canvas");Y.width=ie,Y.height=H;const ce=Y.getContext("2d");if(!ce)return null;const ve=ue.videoWidth/ue.videoHeight,xe=ie/H;let te=ie,Me=H,Oe=0,ze=0;return ve>xe?(Me=ie/ve,ze=(H-Me)/2):(te=H*ve,Oe=(ie-te)/2),ce.fillStyle="#000000",ce.fillRect(0,0,ie,H),ce.drawImage(ue,Oe,ze,te,Me),await createImageBitmap(Y)}catch{const we=ke.current.get(N.mediaId);return we&&(we.video.src="",URL.revokeObjectURL(we.url),ke.current.delete(N.mediaId)),null}},[Pe]),Lo=v.useCallback(async N=>{const L=r.current;if(!L)return!1;(L.width===0||L.height===0)&&(L.width=Ne.width,L.height=Ne.height);const ie=L.getContext("2d");if(!ie)return!1;(!a.current||a.current.width!==L.width||a.current.height!==L.height)&&(a.current=new OffscreenCanvas(L.width,L.height),o.current=a.current.getContext("2d"));const H=o.current;if(!H)return!1;const se=ut.filter(ue=>(ue.type==="video"||ue.type==="image")&&!ue.hidden);let we=!1,Ie=!0;const pe=qa(ge,N),he=Ya(Ue,N),ye=OK(N,ut);if(ye)try{const ue=await Eu(ye.clipA,N,L.width,L.height),je=await Eu(ye.clipB,N,L.width,L.height);if(ue&&je){const Y=await Ha(ye.clipA.id,ue),ce=await Ha(ye.clipB.id,je),ve=Y.width>0&&Y.height>0?Y:ue,xe=ce.width>0&&ce.height>0?ce:je,te=await $K(ye,ve,xe);te&&te.width>0&&te.height>0&&(Ie&&(H.fillStyle="#000000",H.fillRect(0,0,L.width,L.height),Ie=!1),Hr(H,ut,pe,he,N,L.width,L.height,"below-video"),H.drawImage(te,0,0),Hr(H,ut,pe,he,N,L.width,L.height,"above-video"),we=!0)}else if(ue){const Y=await Ha(ye.clipA.id,ue),ce=Y.width>0&&Y.height>0?Y:ue;Ie&&(H.fillStyle="#000000",H.fillRect(0,0,L.width,L.height),Ie=!1),Hr(H,ut,pe,he,N,L.width,L.height,"below-video"),H.drawImage(ce,0,0),Hr(H,ut,pe,he,N,L.width,L.height,"above-video"),we=!0}else if(je){const Y=await Ha(ye.clipB.id,je),ce=Y.width>0&&Y.height>0?Y:je;Ie&&(H.fillStyle="#000000",H.fillRect(0,0,L.width,L.height),Ie=!1),Hr(H,ut,pe,he,N,L.width,L.height,"below-video"),H.drawImage(ce,0,0),Hr(H,ut,pe,he,N,L.width,L.height,"above-video"),we=!0}}catch(ue){console.warn("[Preview] Transition render failed:",ue)}if(!we){const ue=se.some(Y=>Y.clips.some(ce=>N>=ce.startTime&&N<ce.startTime+ce.duration));Ie&&(ue||pe.length>0||he.length>0)&&(H.fillStyle=ue?"#000000":D?"#0f0f11":"#ffffff",H.fillRect(0,0,L.width,L.height),Ie=!1);const je=ut.map((Y,ce)=>({track:Y,originalIndex:ce})).filter(({track:Y})=>(Y.type==="video"||Y.type==="image"||Y.type==="text"||Y.type==="graphics")&&!Y.hidden).sort((Y,ce)=>ce.originalIndex-Y.originalIndex);for(const{track:Y}of je)if(Y.type==="video"||Y.type==="image")for(const ce of Y.clips){const ve=ce.startTime,xe=ce.startTime+ce.duration;if(N>=ve&&N<xe){const te=await Eu(ce,N,L.width,L.height);if(te){const Me=N-ce.startTime;let Oe=Xn(ce.transform,ce.keyframes,Me);if(ce.emphasisAnimation&&ce.emphasisAnimation.type!=="none"){const ze=Md(ce.emphasisAnimation,Me);Oe={...Oe,opacity:Oe.opacity*ze.opacity,scale:{x:Oe.scale.x*ze.scale*ze.scaleX,y:Oe.scale.y*ze.scale*ze.scaleY},position:{x:Oe.position.x+ze.offsetX*L.width,y:Oe.position.y+ze.offsetY*L.height},rotation:Oe.rotation+ze.rotation}}try{const ze=await Ha(ce.id,te);ze.width>0&&ze.height>0?(Pr(H,ze,Oe,L.width,L.height,ce.blendMode),we=!0):(Pr(H,te,Oe,L.width,L.height,ce.blendMode),we=!0)}catch{Pr(H,te,Oe,L.width,L.height,ce.blendMode),we=!0}}}}else if(Y.type==="graphics"){const ce=pe.filter(ve=>ve.trackId===Y.id);for(const ve of ce)Ul(H,ve,L.width,L.height,N),we=!0}else if(Y.type==="text"){const ce=he.filter(ve=>ve.trackId===Y.id);for(const ve of ce)Vl(H,ve,L.width,L.height,N),we=!0}}const Ge=Qo(Ce,N);if(Ge.length>0&&H)for(const ue of Ge)Jo(H,ue,L.width,L.height,N);return we&&a.current&&(ie.clearRect(0,0,L.width,L.height),ie.drawImage(a.current,0,0)),we},[ut,Pe,Eu,Ne.width,Ne.height,Ue,ge,Ce,Hr,D]),iv=v.useCallback(N=>{const L=r.current;if(!L)return;(L.width===0||L.height===0)&&(L.width=Ne.width,L.height=Ne.height);const ie=L.getContext("2d");if(!ie)return;const H=D?"#0f0f11":"#ffffff",se=D?"#52525b":"#a1a1aa",we=D?"#ffffff":"#18181b",Ie=D?"#a1a1aa":"#71717a",pe=qa(ge,N),he=Ya(Ue,N),Ge=ut.filter(xe=>(xe.type==="video"||xe.type==="image")&&!xe.hidden).some(xe=>xe.clips.some(te=>N>=te.startTime&&N<te.startTime+te.duration));ie.fillStyle=Ge?D?"#18181b":"#f4f4f5":H,ie.fillRect(0,0,L.width,L.height);let ue=!1;const je=ut.map((xe,te)=>({track:xe,originalIndex:te})).filter(({track:xe})=>(xe.type==="video"||xe.type==="image"||xe.type==="text"||xe.type==="graphics")&&!xe.hidden).sort((xe,te)=>te.originalIndex-xe.originalIndex);for(const{track:xe}of je)if(xe.type==="video"||xe.type==="image")for(const te of xe.clips){const Me=te.startTime,Oe=te.startTime+te.duration;if(N>=Me&&N<Oe){const ze=Pe(te.mediaId);ze?(ue=!0,ie.fillStyle=we,ie.font="bold 24px Inter, sans-serif",ie.textAlign="center",ie.fillText(ze.name,L.width/2,L.height/2),ie.font="16px Inter, sans-serif",ie.fillStyle=Ie,ie.fillText(`${pg(N)} / ${pg(te.duration)}`,L.width/2,L.height/2+30)):te.isPlaceholder&&(ue=!0,ie.fillStyle=Ie,ie.font="bold 20px Inter, sans-serif",ie.textAlign="center",ie.fillText("Drop media here",L.width/2,L.height/2),ie.font="14px Inter, sans-serif",ie.fillStyle=se,ie.fillText("Replace this placeholder with your content",L.width/2,L.height/2+28))}}else if(xe.type==="graphics"){const te=pe.filter(Me=>Me.trackId===xe.id);for(const Me of te)Ul(ie,Me,L.width,L.height,N),ue=!0}else if(xe.type==="text"){const te=he.filter(Me=>Me.trackId===xe.id);for(const Me of te)Vl(ie,Me,L.width,L.height,N),ue=!0}const Y=Qo(Ce,N);for(const xe of Y)Jo(ie,xe,L.width,L.height,N);const ve=ut.filter(xe=>xe.type==="audio"&&!xe.hidden).some(xe=>xe.clips.some(te=>N>=te.startTime&&N<te.startTime+te.duration));!ue&&he.length===0&&pe.length===0&&!ve&&(ie.fillStyle=se,ie.font="24px Inter, sans-serif",ie.textAlign="center",ie.fillText("Import media to get started",L.width/2,L.height/2))},[ut,Pe,Ne.width,Ne.height,Ue,ge,Ce,D]),rv=v.useCallback(N=>{const L=ut,ie=L.filter(pe=>pe.type==="video"&&!pe.hidden),H=[],se=gc();for(const pe of ie)for(const he of pe.clips)if(he.startTime+he.duration>N){const ye=Pe(he.mediaId);if(ye?.blob&&ye.type==="video"){const Ge=se.getClipSpeed(he.id),ue=se.isReverse(he.id);if(Ge!==1||ue)return{canUse:!1,clips:[]};H.push({clip:he,mediaItem:ye})}}if(H.length===0)return{canUse:!1,clips:[]};H.sort((pe,he)=>pe.clip.startTime-he.clip.startTime);const we=L.filter(pe=>pe.type==="image"&&!pe.hidden),Ie=[];return we.forEach(pe=>{const he=L.indexOf(pe);for(const ye of pe.clips)Ie.push({clip:ye,trackIndex:he})}),{canUse:!0,clips:H,imageClips:Ie}},[ut,Pe,Ue,ge]),nv=v.useCallback(async(N,L,ie,H)=>{const se=r.current;if(!se||N.length===0)return H(),()=>{};const we=se.getContext("2d");if(!we)return H(),()=>{};h.current=!0;const Ie=new Map;for(const{clip:te}of L){const Me=Pe(te.mediaId);if(Me?.type==="image"&&Me.blob)try{const Oe=await createImageBitmap(Me.blob);Ie.set(te.id,Oe)}catch(Oe){console.warn(`Failed to cache image bitmap for ${te.id}:`,Oe)}}await _u();const pe=new Map,he=[];for(const{clip:te,mediaItem:Me}of N)if(!pe.has(te.mediaId)&&Me.blob){const Oe=URL.createObjectURL(Me.blob),ze=document.createElement("video");ze.src=Oe,ze.muted=!0,ze.playsInline=!0,ze.preload="auto",pe.set(te.mediaId,{video:ze,url:Oe}),he.push(new Promise((Qe,et)=>{ze.onloadedmetadata=()=>Qe(),ze.onerror=()=>et(new Error(`Video load failed for ${te.mediaId}`)),setTimeout(()=>Qe(),5e3)}))}await Promise.all(he);const ye=Oh();ye.setDuration(Gs),ye.seek(ie),m.current||(m.current=sh());const Ge=m.current;Ge.setMasterVolume(b?0:1);const ue=ut.filter(te=>(te.type==="audio"||te.type==="video")&&!te.hidden);for(const te of ue)Ge.createTrack({trackId:te.id,volume:1,pan:0,muted:te.muted||!1,solo:te.solo||!1,effects:[]});await Ge.resume(),Ge.seekTo(ie),Ge.startScheduler(()=>{const te=ut.filter(Oe=>(Oe.type==="audio"||Oe.type==="video")&&!Oe.hidden),Me=[];for(const Oe of te)for(const ze of Oe.clips){const Qe=Pe(ze.mediaId);if(!(Qe?.type==="audio"||Qe?.type==="video"&&Qe?.metadata?.channels&&Qe.metadata.channels>0))continue;const Dt=g.current.get(ze.mediaId);Dt&&Me.push({clipId:ze.id,trackId:Oe.id,audioBuffer:Dt,startTime:ze.startTime,endTime:ze.startTime+ze.duration,mediaOffset:ze.inPoint||0,volume:1,pan:0,effects:[],speed:ze.speed??1})}return Me}),await ye.play();let je=!0,Y=null;const ce=te=>{const Me=[];for(const{clip:Oe,mediaItem:ze}of N)if(te>=Oe.startTime&&te<Oe.startTime+Oe.duration){const Qe=(()=>{for(let et=0;et<It.current.length;et++)if(It.current[et].clips.some(ft=>ft.id===Oe.id))return et;return-1})();Me.push({clip:Oe,mediaItem:ze,trackIndex:Qe})}return Me.sort((Oe,ze)=>ze.trackIndex-Oe.trackIndex)},ve=async()=>{if(!je||!h.current)return;const te=ye.currentTime;if(te>=Gs){xe(),De(0),Fo.current=0,H();return}if(!ye.isPlaying){xe(),No.current||H();return}const Me=ce(te);if(Me.length===0){we.fillStyle="#000000",we.fillRect(0,0,se.width,se.height);const qe=[...L].sort((Lt,Xe)=>Xe.trackIndex-Lt.trackIndex);for(const{clip:Lt}of qe)if(te>=Lt.startTime&&te<Lt.startTime+Lt.duration){const Xe=Ie.get(Lt.id);if(Xe){const Ct=(()=>{for(const Ra of It.current){const $o=Ra.clips.find(lv=>lv.id===Lt.id);if($o)return $o}return Lt})(),ds=te-Lt.startTime,ns=Xn(Ct.transform||Ii,Ct.keyframes,ds);Pr(we,Xe,ns,se.width,se.height,Ct.blendMode)}}const Ts=qa(si.current,te),hi=Ya(dr.current,te);(Ts.length>0||hi.length>0)&&Hr(we,It.current,Ts,hi,te,se.width,se.height,"all");const xs=Qo(Ce,te);for(const Lt of xs)Jo(we,Lt,se.width,se.height,te);const As=performance.now();As-ne.current>=Ee&&(ne.current=As,De(te)),Y=requestAnimationFrame(()=>{ve()});return}we.fillStyle="#000000",we.fillRect(0,0,se.width,se.height);const Oe=[];for(const{clip:qe,trackIndex:Ts}of Me){const hi=pe.get(qe.mediaId);if(!hi)continue;const{video:xs}=hi;xs.paused&&xs.play().catch(()=>{});const As=te-qe.startTime;let Lt=(qe.inPoint||0)+As;if(xs.duration>0&&Lt>=xs.duration){const ns=xs.duration-(qe.inPoint||0);ns>0?Lt=(qe.inPoint||0)+As%ns:Lt=qe.inPoint||0}Math.abs(xs.currentTime-Lt)>.1&&(xs.currentTime=Lt);const Ct=(()=>{for(const ns of It.current){const Ra=ns.clips.find($o=>$o.id===qe.id);if(Ra)return Ra}return qe})();let ds=Xn(Ct.transform||Ii,Ct.keyframes,As);if(Ct.emphasisAnimation&&Ct.emphasisAnimation.type!=="none"){const ns=Md(Ct.emphasisAnimation,As);ds={...ds,opacity:ds.opacity*ns.opacity,scale:{x:ds.scale.x*ns.scale*ns.scaleX,y:ds.scale.y*ns.scale*ns.scaleY},position:{x:ds.position.x+ns.offsetX*se.width,y:ds.position.y+ns.offsetY*se.height},rotation:ds.rotation+ns.rotation}}Oe.push({type:"video",trackIndex:Ts,render:async()=>{try{const ns=await createImageBitmap(xs),Ra=await Ha(qe.id,ns);Pr(we,Ra,ds,se.width,se.height,Ct.blendMode)}catch{Pr(we,xs,ds,se.width,se.height,Ct.blendMode)}}})}for(const{clip:qe,trackIndex:Ts}of L)if(te>=qe.startTime&&te<qe.startTime+qe.duration){const hi=Ie.get(qe.id);hi&&Oe.push({type:"image",trackIndex:Ts,render:()=>{const xs=(()=>{for(const Xe of It.current){const Ct=Xe.clips.find(ds=>ds.id===qe.id);if(Ct)return Ct}return qe})(),As=te-qe.startTime,Lt=Xn(xs.transform||Ii,xs.keyframes,As);Pr(we,hi,Lt,se.width,se.height,xs.blendMode)}})}Oe.sort((qe,Ts)=>Ts.trackIndex-qe.trackIndex);for(const qe of Oe)await qe.render();const ze=si.current,Qe=qa(ze,te),et=Ya(dr.current,te);(Qe.length>0||et.length>0)&&Hr(we,It.current,Qe,et,te,se.width,se.height,"all");const Dt=Qo(Ce,te);for(const qe of Dt)Jo(we,qe,se.width,se.height,te);const ft=performance.now();ft-ne.current>=Ee&&(ne.current=ft,De(te)),Y=requestAnimationFrame(()=>{ve()})},xe=()=>{je=!1,h.current=!1,Y&&cancelAnimationFrame(Y);for(const[,{video:te,url:Me}]of pe)te.pause(),te.src="",URL.revokeObjectURL(Me);pe.clear();for(const[,te]of Ie)te.close();Ie.clear(),l.current=null,u.current=null,ye.stop(),Ge.stopScheduler()};return Y=requestAnimationFrame(()=>{ve()}),xe},[Gs,Ce,Pe,b,_u,De,ut]);v.useEffect(()=>{const N=r.current;if(!N)return;if((N.width===0||N.height===0)&&(N.width=Ne.width,N.height=Ne.height),!Te){s.current&&(cancelAnimationFrame(s.current),s.current=null),Na(),Bo();return}if(Gs<=0){Pi();return}let L=!0,ie=null;const H=Fo.current,se=Y=>{const ce=It.current,ve=[];return ce.forEach((xe,te)=>{if((xe.type==="video"||xe.type==="image")&&!xe.hidden)for(const Me of xe.clips)Y>=Me.startTime&&Y<Me.startTime+Me.duration&&ve.push({clip:Me,track:xe,trackIndex:te})}),ve.sort((xe,te)=>xe.trackIndex-te.trackIndex)},we=async(Y,ce)=>{const ve=Pe(Y.mediaId);if(!ve?.blob||ve.type==="image")return null;try{const xe=await _i(()=>import("./index5.js"),[]),{Input:te,ALL_FORMATS:Me,BlobSource:Oe,CanvasSink:ze}=xe,Qe=new te({source:new Oe(ve.blob),formats:Me}),et=await Qe.getPrimaryVideoTrack();if(!et||!await et.canDecode())return Qe[Symbol.dispose]?.(),null;const ft=Ne.width||1920,qe=Ne.height||1080,Ts=new ze(et,{width:ft,height:qe,fit:"contain",poolSize:JK(ft,qe)});return{input:Qe,sink:Ts,mediaId:Y.mediaId,clipId:Y.id,trackIndex:ce}}catch(xe){return console.error(`[Preview] Failed to init resources for clip ${Y.id}:`,xe),null}},Ie=async()=>{const ce=It.current.filter(ve=>ve.type==="image"&&!ve.hidden);for(const ve of ce)for(const xe of ve.clips){if(pl.current.has(xe.id))continue;const te=Pe(xe.mediaId);if(te?.type==="image"&&te.blob)try{const Me=await createImageBitmap(te.blob);pl.current.set(xe.id,Me)}catch(Me){console.warn(`[Preview] Failed to pre-cache image clip ${xe.id}:`,Me)}}},pe=async()=>{const Y=se(H),ce=Ya(dr.current,H),ve=qa(si.current,H),te=It.current.filter(Xe=>Xe.type==="audio"&&!Xe.hidden).some(Xe=>Xe.clips.some(Ct=>H>=Ct.startTime&&H<Ct.startTime+Ct.duration));if(!(Y.length>0||ce.length>0||ve.length>0||te)&&Gs<=0){Pi();return}await Ie();for(const{clip:Xe,trackIndex:Ct}of Y)if(!Tr.current.has(Xe.id)){const ds=await we(Xe,Ct);ds&&Tr.current.set(Xe.id,ds)}const ze=ce.length>0||ve.length>0;if(Tr.current.size===0&&!ze&&!te&&Gs<=0){Pi();return}await _u(),m.current||(m.current=sh());const Qe=m.current;Qe.setMasterVolume(b?0:1);const et=It.current.filter(Xe=>(Xe.type==="audio"||Xe.type==="video")&&!Xe.hidden);for(const Xe of et)Qe.createTrack({trackId:Xe.id,volume:1,pan:0,muted:Xe.muted||!1,solo:Xe.solo||!1,effects:[]});await Qe.resume();const Dt=N.getContext("2d");if(!Dt){console.error("[Preview] Failed to get 2D context"),Pi();return}(!a.current||a.current.width!==N.width||a.current.height!==N.height)&&(a.current=new OffscreenCanvas(N.width,N.height),o.current=a.current.getContext("2d"));const ft=o.current;if(!ft){console.error("[Preview] Failed to get offscreen 2D context"),Pi();return}const qe=Oh();qe.setDuration(Gs),qe.seek(H),Qe.seekTo(H),Qe.startScheduler(sv),await qe.play();const Ts=1e3/30;let hi=performance.now(),xs=0,As=!1;const Lt=async()=>{if(!L){Na(),qe.pause();return}if(As)return;As=!0;const Xe=qe.currentTime;try{if(Xe>=Gs){As=!1,Na(),Bo(),qe.stop(),De(0),Fo.current=0,Pi();return}if(!qe.isPlaying){As=!1,Na(),Bo(),No.current||Pi();return}const Ct=se(Xe),ds=Ya(dr.current,Xe),ns=qa(si.current,Xe),$o=It.current.filter(it=>it.type==="audio"&&!it.hidden).some(it=>it.clips.some(js=>Xe>=js.startTime&&Xe<js.startTime+js.duration));if(!(Ct.length>0||ds.length>0||ns.length>0||$o)){const it=he(Xe),js=ye(Xe),hr=Ge(Xe),Rs=ue(Xe),us=[it,js,hr,Rs].filter(zo=>zo!==null&&zo<Gs),yl=us.length>0?Math.min(...us):null;if(yl!==null){qe.seek(yl),Qe.seekTo(yl),As=!1,s.current=requestAnimationFrame(Lt);return}else{As=!1,Na(),Bo(),No.current||(qe.stop(),De(0),Fo.current=0,Pi());return}}for(const{clip:it,trackIndex:js}of Ct)if(!Tr.current.has(it.id)){const hr=await we(it,js);hr&&Tr.current.set(it.id,hr)}const jN=new Set(Ct.map(it=>it.clip.id));for(const[it,js]of Tr.current)jN.has(it)||(js.input[Symbol.dispose]?.(),Tr.current.delete(it));const _N=[...Ct].sort((it,js)=>js.trackIndex-it.trackIndex),dv=[],uv=[];for(const{clip:it,track:js}of _N){if(!L)continue;const hr=Xe-it.startTime;let Rs=Xn(it.transform||Ii,it.keyframes,hr);if(it.emphasisAnimation&&it.emphasisAnimation.type!=="none"){const us=Md(it.emphasisAnimation,hr);Rs={...Rs,opacity:Rs.opacity*us.opacity,scale:{x:Rs.scale.x*us.scale*us.scaleX,y:Rs.scale.y*us.scale*us.scaleY},position:{x:Rs.position.x+us.offsetX*N.width,y:Rs.position.y+us.offsetY*N.height},rotation:Rs.rotation+us.rotation}}if(js.type==="image"){const us=pl.current.get(it.id);us&&dv.push({clip:it,transform:Rs,frame:us});continue}uv.push((async()=>{const us=Tr.current.get(it.id);if(!us)return null;const zo=gc().getSourceTimeAtPlaybackTime(it.id,hr),pt=(it.inPoint||0)+zo;try{const hs=await us.sink.getCanvas(pt);if(!L)return null;if(hs?.canvas){let Ot=hs.canvas;try{const bs=await createImageBitmap(hs.canvas);Ot=await Ha(it.id,bs)}catch{}return{clip:it,transform:Rs,frame:Ot}}}catch(hs){if((hs instanceof Error?hs.message:String(hs)).includes("disposed")||!L)return null;console.warn(`[Preview] Failed to get frame for clip ${it.id}:`,hs)}return null})())}const EN=(await Promise.all(uv)).filter(it=>it!==null),Mu=[...dv,...EN];if(Mu.length>0||ds.length>0||ns.length>0){ft.fillStyle="#000000",ft.fillRect(0,0,N.width,N.height);const it=qa(si.current,Xe),js=Ya(dr.current,Xe),hr=It.current,Rs=new Map;hr.forEach((pt,hs)=>{if((pt.type==="video"||pt.type==="image")&&!pt.hidden)for(const Ot of pt.clips)Rs.set(Ot.id,hs)});const us=hr.map((pt,hs)=>({track:pt,originalIndex:hs})).filter(({track:pt})=>(pt.type==="video"||pt.type==="image"||pt.type==="text"||pt.type==="graphics")&&!pt.hidden).sort((pt,hs)=>hs.originalIndex-pt.originalIndex);if(y.current&&y.current.type==="webgpu"){const pt=[],hs=[];for(const{track:Ot,originalIndex:bs}of us)if(Ot.type==="video"){const Zr=Mu.filter(ii=>Rs.get(ii.clip.id)===bs);for(const{transform:ii,frame:jr}of Zr)jr instanceof ImageBitmap&&pt.push({bitmap:jr,transform:ii})}else if(Ot.type==="image"){const Zr=Mu.filter(ii=>Rs.get(ii.clip.id)===bs);for(const{transform:ii,frame:jr}of Zr)Pr(ft,jr,ii,N.width,N.height)}else if(Ot.type==="graphics"){const Zr=it.filter(ii=>ii.trackId===Ot.id);for(const ii of Zr){const jr=new OffscreenCanvas(N.width,N.height),xl=jr.getContext("2d");if(xl){Ul(xl,ii,N.width,N.height,Xe);const bl=await createImageBitmap(jr);hs.push(bl),pt.push({bitmap:bl,transform:{...Ii,opacity:1,scale:{x:1,y:1},position:{x:0,y:0},anchor:{x:0,y:0}}})}}}else if(Ot.type==="text"){const Zr=js.filter(ii=>ii.trackId===Ot.id);for(const ii of Zr){const jr=new OffscreenCanvas(N.width,N.height),xl=jr.getContext("2d");if(xl){Vl(xl,ii,N.width,N.height,Xe);const bl=await createImageBitmap(jr);hs.push(bl),pt.push({bitmap:bl,transform:{...Ii,opacity:1,scale:{x:1,y:1},position:{x:0,y:0},anchor:{x:0,y:0}}})}}}if(pt.length>0){const Ot=await ZK(y.current,pt,N.width,N.height);if(Ot)ft.drawImage(Ot,0,0),Ot.close();else for(const bs of pt)Pr(ft,bs.bitmap,bs.transform,N.width,N.height)}for(const Ot of hs)Ot.close()}else for(const{track:pt,originalIndex:hs}of us)if(pt.type==="video"||pt.type==="image"){const Ot=Mu.filter(bs=>Rs.get(bs.clip.id)===hs);for(const{transform:bs,frame:Zr}of Ot)Pr(ft,Zr,bs,N.width,N.height)}else if(pt.type==="graphics"){const Ot=it.filter(bs=>bs.trackId===pt.id);for(const bs of Ot)Ul(ft,bs,N.width,N.height,Xe)}else if(pt.type==="text"){const Ot=js.filter(bs=>bs.trackId===pt.id);for(const bs of Ot)Vl(ft,bs,N.width,N.height,Xe)}const zo=Qo(An.current,Xe);for(const pt of zo)Jo(ft,pt,N.width,N.height,Xe);Dt.drawImage(a.current,0,0);try{n.current?.close(),n.current=await createImageBitmap(a.current)}catch{}}else if(n.current){ft.drawImage(n.current,0,0,N.width,N.height);const it=Qo(An.current,Xe);for(const js of it)Jo(ft,js,N.width,N.height,Xe);Dt.drawImage(a.current,0,0)}xs++,qe.reportVideoTime(Xe);const hv=performance.now();hv-ne.current>=Ee&&(ne.current=hv,De(Xe));const pv=performance.now(),MN=pv-hi,PN=Ts/gf.current,fv=Math.max(0,PN-MN);hi=pv,As=!1,L&&(fv>0?setTimeout(()=>{L&&(s.current=requestAnimationFrame(Lt))},fv):s.current=requestAnimationFrame(Lt))}catch(Ct){As=!1,console.error("[Preview] Multi-track frame error:",Ct),Na(),Pi()}};s.current=requestAnimationFrame(Lt)},he=Y=>{const ve=It.current.filter(te=>(te.type==="video"||te.type==="image")&&!te.hidden);let xe=null;for(const te of ve)for(const Me of te.clips)Me.startTime>Y&&(xe===null||Me.startTime<xe)&&(xe=Me.startTime);return xe},ye=Y=>{const ce=dr.current;let ve=null;for(const xe of ce)xe.startTime>Y&&(ve===null||xe.startTime<ve)&&(ve=xe.startTime);return ve},Ge=Y=>{const ce=si.current;let ve=null;for(const xe of ce)xe.startTime>Y&&(ve===null||xe.startTime<ve)&&(ve=xe.startTime);return ve},ue=Y=>{const ve=It.current.filter(te=>te.type==="audio"&&!te.hidden);let xe=null;for(const te of ve)for(const Me of te.clips)Me.startTime>Y&&(xe===null||Me.startTime<xe)&&(xe=Me.startTime);return xe};return(async()=>{const Y=rv(H);if(Y.canUse&&Y.clips.length>0)try{return ie=await nv(Y.clips,Y.imageClips||[],H,()=>Pi()),ie}catch(ce){console.warn("[Preview] Native video playback failed, falling back to MediaBunny:",ce)}await pe()})().catch(Y=>{console.error("[Preview] startPlayback error:",Y)}),()=>{L=!1,h.current=!1;const Y=Oh();(Y.isPlaying||Y.isPaused)&&(Fo.current=Y.currentTime),ie&&(ie(),ie=null),s.current&&(cancelAnimationFrame(s.current),s.current=null),l.current&&(l.current.pause(),l.current.src="",l.current=null),d.current&&(URL.revokeObjectURL(d.current),d.current=null),Y.pause(),Bo()}},[Te,rv,nv,Gs,De,Pi,Pe,Na,Bo,aN,_u,sv,b,Ne.width,Ne.height]);const av=v.useRef(ae.modifiedAt);v.useEffect(()=>{if(Te)return;if(U.current){av.current=ae.modifiedAt;return}if(av.current=ae.modifiedAt,!r.current)return;(async()=>{await Lo(Ut)||iv(Ut)})()},[Ut,Te,Lo,iv,ae.modifiedAt,D]);const yf=v.useMemo(()=>Cr.find(L=>L.type==="clip")?.id||null,[Cr]),Xr=v.useMemo(()=>{if(!yf)return null;for(const N of ut){const L=N.clips.find(ie=>ie.id===yf);if(L)return L}return null},[yf,ut]),_n=v.useMemo(()=>{const N=ut.filter(L=>(L.type==="video"||L.type==="image")&&!L.hidden);for(const L of N)for(const ie of L.clips){const H=ie.startTime,se=ie.startTime+ie.duration;if(Ut>=H&&Ut<se)return ie}return null},[ut,Ut]),xf=v.useMemo(()=>Cr.find(L=>L.type==="text-clip")?.id||null,[Cr]),fl=v.useMemo(()=>xf&&Ue.find(N=>N.id===xf)||null,[xf,Ue]),Ar=fl,Kr=v.useMemo(()=>{const N=Xr||_n;if(!N||!r.current||!t.current)return null;const L=r.current,H=t.current.getBoundingClientRect(),se=L.getBoundingClientRect(),we=N.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,anchor:{x:.5,y:.5}},Ie=K?{...we,position:K.position,scale:K.scale}:we,pe=Ne.width,he=Ne.height,ye=pe/he,Ge=se.width/se.height;let ue,je,Y=0,ce=0;Ge>ye?(je=se.height,ue=je*ye,Y=(se.width-ue)/2):(ue=se.width,je=ue/ye,ce=(se.height-je)/2);const ve=ue/pe,xe=pe*Ie.scale.x*ve,te=he*Ie.scale.y*ve,Me=Ie.position.x*ve,Oe=Ie.position.y*ve,ze=se.left-H.left+Y,Qe=se.top-H.top+ce,et=ze+ue/2+Me,Dt=Qe+je/2+Oe;return{x:et-xe/2,y:Dt-te/2,width:xe,height:te,centerX:et,centerY:Dt,displayScale:ve}},[Xr,_n,Ne.width,Ne.height,S,K]),Qr=v.useMemo(()=>{if(!fl||!r.current||!t.current)return null;const N=r.current,ie=t.current.getBoundingClientRect(),H=N.getBoundingClientRect(),{transform:se,style:we,text:Ie}=fl,pe=Ne.width,he=Ne.height,ye=pe/he,Ge=H.width/H.height;let ue,je,Y=0,ce=0;Ge>ye?(je=H.height,ue=je*ye,Y=(H.width-ue)/2):(ue=H.width,je=ue/ye,ce=(H.height-je)/2);const ve=ue/pe,xe=Ie.split(`
`),te=we.fontSize*we.lineHeight,Me=xe.length*te,ze=we.fontSize*Math.max(...xe.map(xs=>xs.length))*.6*se.scale.x*ve,Qe=Me*se.scale.y*ve,et=se.position.x*pe*ve,Dt=se.position.y*he*ve,ft=H.left-ie.left+Y,qe=H.top-ie.top+ce,Ts=ft+et,hi=qe+Dt;return{x:Ts-ze/2,y:hi-Qe/2,width:ze,height:Qe,centerX:Ts,centerY:hi,displayScale:ve,isTextClip:!0}},[fl,Ne.width,Ne.height,S]),bf=v.useMemo(()=>Cr.find(L=>L.type==="shape-clip")?.id||null,[Cr]),ml=v.useMemo(()=>bf&&ge.find(N=>N.id===bf)||null,[bf,ge]),Jr=ml,En=v.useMemo(()=>{if(!ml||!r.current||!t.current)return null;const N=r.current,ie=t.current.getBoundingClientRect(),H=N.getBoundingClientRect(),{transform:se}=ml,we=200,Ie=Ne.width,pe=Ne.height,he=Ie/pe,ye=H.width/H.height;let Ge,ue,je=0,Y=0;ye>he?(ue=H.height,Ge=ue*he,je=(H.width-Ge)/2):(Ge=H.width,ue=Ge/he,Y=(H.height-ue)/2);const ce=Ge/Ie,ve=we*se.scale.x*ce,xe=we*se.scale.y*ce,te=se.position.x*Ie*ce,Me=se.position.y*pe*ce,Oe=H.left-ie.left+je,ze=H.top-ie.top+Y,Qe=Oe+te,et=ze+Me;return{x:Qe-ve/2,y:et-xe/2,width:ve,height:xe,centerX:Qe,centerY:et,displayScale:ce,isShapeClip:!0}},[ml,Ne.width,Ne.height,S]),vf=v.useMemo(()=>Cr.find(L=>L.type==="subtitle")?.id||null,[Cr]),Mn=v.useMemo(()=>vf&&Ce.find(N=>N.id===vf)||null,[vf,Ce]),Oo=v.useMemo(()=>{if(!Mn||!r.current||!t.current||Ut<Mn.startTime||Ut>=Mn.endTime)return null;const N=r.current,ie=t.current.getBoundingClientRect(),H=N.getBoundingClientRect(),se=Mn.style?.fontSize||24,we=Mn.style?.position||"bottom",Ie=Mn.text.split(`
`),pe=se*1.3,he=Ie.length*pe,ye=Ne.width,Ge=Ne.height,ue=ye/Ge,je=H.width/H.height;let Y,ce,ve=0,xe=0;je>ue?(ce=H.height,Y=ce*ue,ve=(H.width-Y)/2):(Y=H.width,ce=Y/ue,xe=(H.height-ce)/2);const te=Y/ye;let Me;we==="top"?Me=se*2:we==="center"?Me=Ge/2-he/2:Me=Ge-se*2-he;const Oe=ye*.8*te,ze=he*te,Qe=H.left-ie.left+ve,et=H.top-ie.top+xe,Dt=Qe+Y/2,ft=et+Me*te;return{x:Dt-Oe/2,y:ft,width:Oe,height:ze,centerX:Dt,centerY:ft+ze/2,displayScale:te}},[Mn,Ne.width,Ne.height,S,Ut]),Pn=v.useCallback((N,L)=>{N.stopPropagation(),N.preventDefault();const ie=Xr||_n;if(!ie)return;const H=ie.transform||{position:{x:0,y:0},scale:{x:1,y:1}};U.current=!0,O("resize"),I(L),E.current={x:N.clientX,y:N.clientY,transform:{x:H.position.x,y:H.position.y,scaleX:H.scale.x,scaleY:H.scale.y}}},[Xr,_n]),oN=v.useCallback(N=>{N.stopPropagation(),N.preventDefault();const L=Xr||_n;if(!L)return;const ie=L.transform||{position:{x:0,y:0},scale:{x:1,y:1}};U.current=!0,O("move"),E.current={x:N.clientX,y:N.clientY,transform:{x:ie.position.x,y:ie.position.y,scaleX:ie.scale.x,scaleY:ie.scale.y}}},[Xr,_n]),cN=v.useCallback(N=>{if(N.stopPropagation(),N.preventDefault(),!Ar)return;const{transform:L}=Ar;U.current=!0,O("move"),Q("text-clip"),le.current=Ar.id,E.current={x:N.clientX,y:N.clientY,transform:{x:L.position.x,y:L.position.y,scaleX:L.scale.x,scaleY:L.scale.y}}},[Ar]),Nn=v.useCallback((N,L)=>{if(N.stopPropagation(),N.preventDefault(),!Ar)return;const{transform:ie}=Ar;U.current=!0,O("resize"),I(L),Q("text-clip"),le.current=Ar.id,E.current={x:N.clientX,y:N.clientY,transform:{x:ie.position.x,y:ie.position.y,scaleX:ie.scale.x,scaleY:ie.scale.y}}},[Ar]),lN=v.useCallback(N=>{if(N.stopPropagation(),N.preventDefault(),!Jr)return;const{transform:L}=Jr;U.current=!0,O("move"),Q("shape-clip"),le.current=Jr.id,E.current={x:N.clientX,y:N.clientY,transform:{x:L.position.x,y:L.position.y,scaleX:L.scale.x,scaleY:L.scale.y}}},[Jr]),Rn=v.useCallback((N,L)=>{if(N.stopPropagation(),N.preventDefault(),!Jr)return;const{transform:ie}=Jr;U.current=!0,O("resize"),I(L),Q("shape-clip"),le.current=Jr.id,E.current={x:N.clientX,y:N.clientY,transform:{x:ie.position.x,y:ie.position.y,scaleX:ie.scale.x,scaleY:ie.scale.y}}},[Jr]),dN=v.useCallback(N=>{if(B==="none"||!E.current)return;if($==="text-clip"&&Qr&&Ar){const pe=N.clientX-E.current.x,he=N.clientY-E.current.y,{displayScale:ye}=Qr;let Ge={};if(B==="move"){const ue=E.current.transform.x+pe/ye/Ne.width,je=E.current.transform.y+he/ye/Ne.height;Ge={position:{x:ue,y:je}}}else if(B==="resize"&&F){const ue=E.current.transform;let je=ue.scaleX,Y=ue.scaleY;const ce=pe/ye/100,ve=he/ye/100;switch(F){case"e":case"se":case"ne":je=Math.max(.1,ue.scaleX+ce),J&&(Y=je);break;case"w":case"sw":case"nw":je=Math.max(.1,ue.scaleX-ce),J&&(Y=je);break;case"s":Y=Math.max(.1,ue.scaleY+ve),J&&(je=Y);break;case"n":Y=Math.max(.1,ue.scaleY-ve),J&&(je=Y);break}Ge={position:{x:ue.x,y:ue.y},scale:{x:je,y:Y}}}V.current||(V.current=requestAnimationFrame(()=>{const ue=performance.now();ue-oe.current>=re&&le.current&&(oe.current=ue,Ze(le.current,Ge)),V.current=null}));return}if($==="shape-clip"&&En&&Jr){const pe=N.clientX-E.current.x,he=N.clientY-E.current.y,{displayScale:ye}=En;let Ge={};if(B==="move"){const ue=E.current.transform.x+pe/ye/Ne.width,je=E.current.transform.y+he/ye/Ne.height;Ge={position:{x:ue,y:je}}}else if(B==="resize"&&F){const ue=E.current.transform;let je=ue.scaleX,Y=ue.scaleY;const ce=pe/ye/100,ve=he/ye/100;switch(F){case"e":case"se":case"ne":je=Math.max(.1,ue.scaleX+ce),J&&(Y=je);break;case"w":case"sw":case"nw":je=Math.max(.1,ue.scaleX-ce),J&&(Y=je);break;case"s":Y=Math.max(.1,ue.scaleY+ve),J&&(je=Y);break;case"n":Y=Math.max(.1,ue.scaleY-ve),J&&(je=Y);break}Ge={position:{x:ue.x,y:ue.y},scale:{x:je,y:Y}}}V.current||(V.current=requestAnimationFrame(()=>{const ue=performance.now();ue-oe.current>=re&&le.current&&(oe.current=ue,Mt(le.current,Ge)),V.current=null}));return}if(!Kr)return;const L=Xr||_n;if(!L)return;const ie=N.clientX-E.current.x,H=N.clientY-E.current.y,{displayScale:se}=Kr;let we={};if(B==="move"){const pe=E.current.transform.x+ie/se,he=E.current.transform.y+H/se;we={position:{x:pe,y:he}}}else if(B==="resize"&&F){const pe=E.current.transform;let he=pe.scaleX,ye=pe.scaleY,Ge=pe.x,ue=pe.y;const je=ie/se/(Ne.width/2),Y=H/se/(Ne.height/2);switch(F){case"e":he=Math.max(.1,pe.scaleX+je),J&&(ye=he);break;case"w":he=Math.max(.1,pe.scaleX-je),J&&(ye=he),Ge=pe.x+ie/se/2;break;case"s":ye=Math.max(.1,pe.scaleY+Y),J&&(he=ye);break;case"n":ye=Math.max(.1,pe.scaleY-Y),J&&(he=ye),ue=pe.y+H/se/2;break;case"se":if(J){const ce=(je+Y)/2;he=Math.max(.1,pe.scaleX+ce),ye=he}else he=Math.max(.1,pe.scaleX+je),ye=Math.max(.1,pe.scaleY+Y);break;case"sw":if(J){const ce=(-je+Y)/2;he=Math.max(.1,pe.scaleX+ce),ye=he}else he=Math.max(.1,pe.scaleX-je),ye=Math.max(.1,pe.scaleY+Y);Ge=pe.x+ie/se/2;break;case"ne":if(J){const ce=(je-Y)/2;he=Math.max(.1,pe.scaleX+ce),ye=he}else he=Math.max(.1,pe.scaleX+je),ye=Math.max(.1,pe.scaleY-Y);ue=pe.y+H/se/2;break;case"nw":if(J){const ce=(-je-Y)/2;he=Math.max(.1,pe.scaleX+ce),ye=he}else he=Math.max(.1,pe.scaleX-je),ye=Math.max(.1,pe.scaleY-Y);Ge=pe.x+ie/se/2,ue=pe.y+H/se/2;break}we={position:{x:Ge,y:ue},scale:{x:he,y:ye}}}G.current={clipId:L.id,transform:we};const Ie=L.transform||{position:{x:0,y:0},scale:{x:1,y:1}};me({position:we.position||Ie.position,scale:we.scale||Ie.scale}),V.current||(V.current=requestAnimationFrame(()=>{const pe=performance.now();G.current&&pe-oe.current>=re&&(oe.current=pe,He(G.current.clipId,G.current.transform)),V.current=null}))},[B,F,Kr,Xr,_n,He,Ne.width,Ne.height,J,$,Qr,Ar,Ze]),uN=v.useCallback(()=>{G.current&&(He(G.current.clipId,G.current.transform),G.current=null),Q(null),le.current=null,V.current&&(cancelAnimationFrame(V.current),V.current=null);const N=U.current;U.current=!1,O("none"),I(null),E.current=null,me(null),N&&Lo(Ut)},[He,Lo,Ut]),hN=v.useCallback(N=>{ur&&He(ur,{crop:N})},[ur,He]),pN=v.useCallback(()=>{Ma(!1)},[Ma]),fN=v.useCallback(()=>{Ma(!1)},[Ma]);v.useEffect(()=>{if(B!=="none"){const N=()=>{G.current&&(He(G.current.clipId,G.current.transform),G.current=null),V.current&&(cancelAnimationFrame(V.current),V.current=null);const L=U.current;U.current=!1,O("none"),I(null),E.current=null,me(null),L&&Lo(Ut)};return window.addEventListener("mouseup",N),()=>window.removeEventListener("mouseup",N)}},[B,Lo,Ut,He]);const mN=v.useCallback(N=>{const L=N.currentTarget.getBoundingClientRect(),ie=N.clientX-L.left,se=Math.max(0,Math.min(1,ie/L.width))*(Gs||10);X(se)},[Gs,X]),gN=v.useCallback(()=>{be(-5)},[be]),yN=v.useCallback(()=>{be(5)},[be]),xN=v.useCallback(()=>{const N=e.current;N&&(document.fullscreenElement?document.exitFullscreen().then(()=>{R(!1)}).catch(L=>{console.error("Error exiting fullscreen:",L)}):N.requestFullscreen().then(()=>{R(!0)}).catch(L=>{console.error("Error entering fullscreen:",L)}))},[]),bN=v.useCallback(()=>{M(N=>!N)},[]);v.useEffect(()=>{const N=()=>{R(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",N),()=>document.removeEventListener("fullscreenchange",N)},[]);const vN=Gs>0?Ut/Gs*100:0,wN=!Te&&Xr&&Kr,kN=!Te&&fl&&Qr,CN=!Te&&ml&&En,SN=!Te&&Mn&&Oo,gl=v.useMemo(()=>{if(!qr||!ur)return null;for(const N of ut){const L=N.clips.find(ie=>ie.id===ur);if(L)return L}return null},[qr,ur,ut]),ov=v.useMemo(()=>{if(!qr||!ur||!gl)return null;const N=Pe(gl.mediaId);if(!N)return null;let L=null;return N.blob?L=URL.createObjectURL(N.blob):N.originalUrl&&(L=N.originalUrl),L?{src:L,type:N.type}:null},[qr,ur,gl,Pe]),cv=ov?.src??null,TN=ov?.type??"video",AN=qr&&ur&&gl&&cv;return c.jsxs("div",{ref:e,"data-tour":"preview",className:"flex-1 bg-background flex flex-col relative group overflow-hidden",children:[AN&&c.jsx(VK,{clip:gl,videoSrc:cv,mediaType:TN,currentTime:Ut,canvasWidth:S.width,canvasHeight:S.height,onCropChange:hN,onComplete:pN,onCancel:fN}),c.jsx("div",{className:`flex-1 relative flex items-center justify-center bg-background-secondary/30 transition-all duration-300 ${_||P?"p-0":"p-4"}`,onMouseMove:B!=="none"?dN:void 0,onMouseUp:uN,children:c.jsxs("div",{ref:t,className:`relative bg-black overflow-hidden transition-all duration-300 ${_||P?"rounded-none ring-0 shadow-none":"shadow-2xl rounded-xl ring-1 ring-border shadow-[0_0_50px_rgba(0,0,0,0.5)]"}`,style:_||P?{width:"100%",height:"100%",maxWidth:"none"}:{height:"450px",width:`calc(450px * ${Ne.width} / ${Ne.height})`,maxWidth:"800px"},children:[c.jsx("canvas",{ref:r,width:Ne.width,height:Ne.height,className:"w-full h-full object-contain bg-black",style:{cursor:"default"}}),c.jsx(QK,{}),c.jsxs("div",{className:"absolute top-2 left-2 bg-black/70 backdrop-blur-sm px-2 py-1 rounded text-[10px] font-mono text-white/90 pointer-events-none z-10 border border-white/10",children:[Ne.width,"",Ne.height,c.jsxs("span",{className:"text-white/60 ml-1.5",children:["(",(Ne.width/Ne.height).toFixed(2),")"]})]}),Io&&nt&&ot&&c.jsx("div",{className:"absolute inset-0 pointer-events-auto z-30",children:c.jsx(GK,{config:nt,canvasWidth:Ne.width,canvasHeight:Ne.height,currentTime:Ut-ot.startTime,clipDuration:ot.duration,onPointMove:Ns,onPointAdd:kt,onPointRemove:Sr,onControlPointMove:Pa,disabled:Te})}),ju.length>0&&c.jsx("div",{className:"absolute inset-0 pointer-events-none z-20",children:c.jsx(YK,{effects:ju,width:Ne.width,height:Ne.height,currentTime:Ut,isPlaying:Te})}),Ro.isExporting&&c.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50",children:c.jsxs("div",{className:"bg-background-secondary/95 rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl border border-border",children:[c.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[c.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center",children:c.jsx(Ci,{size:20,className:"text-primary animate-spin"})}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Exporting Video"}),c.jsx("p",{className:"text-xs text-text-muted",children:Ro.phase||"Preparing..."})]})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Export Progress"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(Ro.progress),"%"]})]}),c.jsx("div",{className:"h-2 bg-black/30 rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-gradient-to-r from-primary to-primary-hover transition-all duration-300",style:{width:`${Ro.progress}%`}})})]}),c.jsx("p",{className:"text-[10px] text-text-muted text-center",children:"Please wait while your video is being exported..."})]})}),!qr&&wN&&Kr&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:Kr.x,top:Kr.y,width:Kr.width,height:Kr.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-primary pointer-events-none"}),c.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-primary/80 rounded-full flex items-center justify-center cursor-move pointer-events-auto hover:bg-primary transition-colors",onMouseDown:oN,title:"Drag to move",children:c.jsx(aa,{size:14,className:"text-white"})}),c.jsx("button",{className:`absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 text-[10px] rounded pointer-events-auto transition-colors ${J?"bg-primary text-white":"bg-background-tertiary text-text-secondary border border-border hover:bg-background-elevated"}`,onClick:()=>Z(!J),title:J?"Unlock aspect ratio":"Lock aspect ratio",children:J?" Locked":" Free"}),c.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-nw-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"nw")}),c.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-ne-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"ne")}),c.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-sw-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"sw")}),c.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-primary rounded-sm cursor-se-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"se")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-6 h-4 bg-white border-2 border-primary rounded-sm cursor-n-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"n")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-6 h-4 bg-white border-2 border-primary rounded-sm cursor-s-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"s")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-6 bg-white border-2 border-primary rounded-sm cursor-w-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"w")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-6 bg-white border-2 border-primary rounded-sm cursor-e-resize pointer-events-auto hover:bg-primary hover:border-white transition-colors",onMouseDown:N=>Pn(N,"e")})]}),kN&&Qr&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:Qr.x,top:Qr.y,width:Qr.width,height:Qr.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-cyan-500 pointer-events-none"}),c.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-cyan-500/80 rounded-full flex items-center justify-center cursor-move pointer-events-auto hover:bg-cyan-500 transition-colors",onMouseDown:cN,title:"Drag to move text",children:c.jsx(aa,{size:14,className:"text-white"})}),c.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-nw-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"nw")}),c.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-ne-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"ne")}),c.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-sw-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"sw")}),c.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-se-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"se")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-6 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-n-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"n")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-6 h-4 bg-white border-2 border-cyan-500 rounded-sm cursor-s-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"s")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-6 bg-white border-2 border-cyan-500 rounded-sm cursor-w-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"w")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-6 bg-white border-2 border-cyan-500 rounded-sm cursor-e-resize pointer-events-auto hover:bg-cyan-500 hover:border-white transition-colors",onMouseDown:N=>Nn(N,"e")})]}),CN&&En&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:En.x,top:En.y,width:En.width,height:En.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-green-500 pointer-events-none"}),c.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-green-500/80 rounded-full flex items-center justify-center cursor-move pointer-events-auto hover:bg-green-500 transition-colors",onMouseDown:lN,title:"Drag to move shape",children:c.jsx(aa,{size:14,className:"text-white"})}),c.jsx("div",{className:"absolute -left-2 -top-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-nw-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"nw")}),c.jsx("div",{className:"absolute -right-2 -top-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-ne-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"ne")}),c.jsx("div",{className:"absolute -left-2 -bottom-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-sw-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"sw")}),c.jsx("div",{className:"absolute -right-2 -bottom-2 w-4 h-4 bg-white border-2 border-green-500 rounded-sm cursor-se-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"se")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-2 w-6 h-4 bg-white border-2 border-green-500 rounded-sm cursor-n-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"n")}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2 w-6 h-4 bg-white border-2 border-green-500 rounded-sm cursor-s-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"s")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-2 w-4 h-6 bg-white border-2 border-green-500 rounded-sm cursor-w-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"w")}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-2 w-4 h-6 bg-white border-2 border-green-500 rounded-sm cursor-e-resize pointer-events-auto hover:bg-green-500 hover:border-white transition-colors",onMouseDown:N=>Rn(N,"e")})]}),SN&&Oo&&c.jsxs("div",{className:"absolute pointer-events-none",style:{left:Oo.x,top:Oo.y,width:Oo.width,height:Oo.height},children:[c.jsx("div",{className:"absolute inset-0 border-2 border-yellow-500 rounded-lg pointer-events-none animate-pulse"}),c.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 px-2 py-0.5 bg-yellow-500 rounded text-[10px] font-medium text-black whitespace-nowrap",children:"Subtitle Selected - Edit in Inspector"})]})]})}),c.jsxs("div",{className:`border-t border-border transition-all duration-300 ${_||P?"absolute bottom-0 left-0 right-0 z-50 bg-background-secondary backdrop-blur-sm":"z-20 bg-background-secondary"}`,children:[c.jsx("div",{className:"h-1.5 bg-background-tertiary cursor-pointer group hover:h-2.5 transition-all relative",onClick:mN,children:c.jsx("div",{className:"h-full bg-primary relative pointer-events-none shadow-[0_0_10px_rgba(34,197,94,0.5)]",style:{width:`${vN}%`},children:c.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-3 h-3 bg-white rounded-full shadow-md opacity-0 group-hover:opacity-100 transition-opacity transform scale-0 group-hover:scale-100 duration-100 border border-black/20"})})}),c.jsxs("div",{className:"h-12 px-6 flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"font-mono text-text-primary tabular-nums text-sm w-24 tracking-wider",children:pg(Ut)}),T!=="none"&&c.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${T==="webgpu"?"bg-green-500/20 text-green-400":"bg-gray-500/20 text-gray-400"}`,title:`Rendering with ${T.toUpperCase()}`,children:T.toUpperCase()})]}),c.jsxs("div",{className:"flex items-center gap-6",children:[c.jsx(Br,{icon:KO,onClick:gN,title:"Skip back 5s"}),c.jsx("button",{onClick:()=>{hl()},className:"w-10 h-10 rounded-full bg-primary hover:bg-primary-hover active:bg-primary-active flex items-center justify-center text-white transition-all shadow-[0_0_15px_rgba(34,197,94,0.4)] hover:shadow-[0_0_25px_rgba(34,197,94,0.6)] transform hover:scale-105",children:Te?c.jsx(Qj,{size:18,fill:"currentColor"}):c.jsx(ti,{size:18,fill:"currentColor",className:"ml-0.5"})}),c.jsx(Br,{icon:JO,onClick:yN,title:"Skip forward 5s"})]}),c.jsxs("div",{className:"flex gap-2 items-center",children:[c.jsx("button",{onClick:()=>w(!b),className:`p-2 rounded-lg hover:bg-background-elevated transition-colors ${b?"text-red-500":"text-text-secondary hover:text-text-primary"}`,children:b?c.jsx(fp,{size:16}):c.jsx(vn,{size:16})}),c.jsx("div",{className:"w-px h-4 bg-border mx-2"}),c.jsx("button",{onClick:xN,title:P?"Exit Full Screen":"Full Screen",className:`p-2 rounded-lg transition-colors ${P?"text-primary bg-primary/20":"text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:c.jsx(ki,{size:16})}),c.jsx("button",{onClick:bN,title:_?"Restore Size":"Maximize Preview",className:`p-2 rounded-lg transition-colors ${_?"text-primary bg-primary/20":"text-text-secondary hover:text-text-primary hover:bg-background-elevated"}`,children:_?c.jsx(Kj,{size:16}):c.jsx(Ca,{size:16})})]})]})]})]})},Pt=ht,tQ=({effect:r,onUpdate:e,onToggle:t,onRemove:s})=>{const[i,n]=Ye.useState(!0),a={brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",hue:"Hue",blur:"Blur",sharpen:"Sharpen",vignette:"Vignette",grain:"Grain",temperature:"Temperature",tint:"Tint",tonal:"Tonal",chromaKey:"Chroma Key",shadow:"Drop Shadow",glow:"Glow","motion-blur":"Motion Blur","radial-blur":"Radial Blur","chromatic-aberration":"Chromatic Aberration"},o=()=>{switch(r.type){case"brightness":return c.jsx(Pt,{label:"Value",value:r.params.value||0,onChange:l=>e(r.id,{value:l}),min:-100,max:100});case"contrast":return c.jsx(Pt,{label:"Value",value:(r.params.value||1)*100,onChange:l=>e(r.id,{value:l/100}),min:0,max:200,unit:"%"});case"saturation":return c.jsx(Pt,{label:"Value",value:(r.params.value||1)*100,onChange:l=>e(r.id,{value:l/100}),min:0,max:200,unit:"%"});case"blur":return c.jsx(Pt,{label:"Radius",value:r.params.radius||0,onChange:l=>e(r.id,{radius:l}),min:0,max:100,unit:"px"});case"sharpen":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Amount",value:r.params.amount||0,onChange:l=>e(r.id,{amount:l}),min:0,max:200,unit:"%"}),c.jsx(Pt,{label:"Radius",value:r.params.radius||1,onChange:l=>e(r.id,{radius:l}),min:.1,max:10,step:.1})]});case"vignette":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Amount",value:r.params.amount||0,onChange:l=>e(r.id,{amount:l}),min:0,max:100}),c.jsx(Pt,{label:"Midpoint",value:(r.params.midpoint||.5)*100,onChange:l=>e(r.id,{midpoint:l/100}),min:0,max:100,unit:"%"}),c.jsx(Pt,{label:"Feather",value:(r.params.feather||.3)*100,onChange:l=>e(r.id,{feather:l/100}),min:0,max:100,unit:"%"})]});case"grain":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Amount",value:r.params.amount||0,onChange:l=>e(r.id,{amount:l}),min:0,max:100}),c.jsx(Pt,{label:"Size",value:r.params.size||1,onChange:l=>e(r.id,{size:l}),min:.5,max:5,step:.1})]});case"temperature":return c.jsx(Pt,{label:"Value",value:r.params.value||0,onChange:l=>e(r.id,{value:l}),min:-100,max:100});case"tint":return c.jsx(Pt,{label:"Value",value:r.params.value||0,onChange:l=>e(r.id,{value:l}),min:-100,max:100});case"shadow":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Offset X",value:r.params.offsetX||5,onChange:l=>e(r.id,{offsetX:l}),min:-100,max:100,unit:"px"}),c.jsx(Pt,{label:"Offset Y",value:r.params.offsetY||5,onChange:l=>e(r.id,{offsetY:l}),min:-100,max:100,unit:"px"}),c.jsx(Pt,{label:"Blur",value:r.params.blur||10,onChange:l=>e(r.id,{blur:l}),min:0,max:100,unit:"px"}),c.jsx(Pt,{label:"Opacity",value:(r.params.opacity||.8)*100,onChange:l=>e(r.id,{opacity:l/100}),min:0,max:100,unit:"%"})]});case"glow":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Radius",value:r.params.radius||10,onChange:l=>e(r.id,{radius:l}),min:0,max:100,unit:"px"}),c.jsx(Pt,{label:"Intensity",value:(r.params.intensity||1)*100,onChange:l=>e(r.id,{intensity:l/100}),min:0,max:300,unit:"%"})]});case"motion-blur":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Angle",value:r.params.angle||0,onChange:l=>e(r.id,{angle:l}),min:0,max:360,unit:""}),c.jsx(Pt,{label:"Distance",value:r.params.distance||20,onChange:l=>e(r.id,{distance:l}),min:0,max:100,unit:"px"})]});case"radial-blur":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Amount",value:r.params.amount||20,onChange:l=>e(r.id,{amount:l}),min:0,max:100}),c.jsx(Pt,{label:"Center X",value:r.params.centerX||50,onChange:l=>e(r.id,{centerX:l}),min:0,max:100,unit:"%"}),c.jsx(Pt,{label:"Center Y",value:r.params.centerY||50,onChange:l=>e(r.id,{centerY:l}),min:0,max:100,unit:"%"})]});case"chromatic-aberration":return c.jsxs(c.Fragment,{children:[c.jsx(Pt,{label:"Amount",value:r.params.amount||5,onChange:l=>e(r.id,{amount:l}),min:0,max:50,step:.5,unit:"px"}),c.jsx(Pt,{label:"Angle",value:r.params.angle||0,onChange:l=>e(r.id,{angle:l}),min:0,max:360,unit:""})]});default:return null}};return c.jsxs("div",{className:`border rounded-lg ${r.enabled?"border-border":"border-border/50 opacity-60"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-t-lg",children:[c.jsx(WL,{size:12,className:"text-text-muted cursor-grab"}),c.jsxs("button",{onClick:()=>n(!i),className:"flex-1 flex items-center gap-1 text-left",children:[c.jsx(ls,{size:12,className:`transition-transform ${i?"":"-rotate-90"} text-text-muted`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:a[r.type]||r.type})]}),c.jsx("button",{onClick:()=>t(r.id,!r.enabled),className:"p-1 hover:bg-background-secondary rounded transition-colors",title:r.enabled?"Disable effect":"Enable effect",children:r.enabled?c.jsx(Ur,{size:12,className:"text-text-secondary"}):c.jsx(ha,{size:12,className:"text-text-muted"})}),c.jsx("button",{onClick:()=>s(r.id),className:"p-1 hover:bg-red-500/20 rounded transition-colors text-text-muted hover:text-red-400",title:"Remove effect",children:c.jsx($i,{size:12})})]}),i&&c.jsx("div",{className:"p-3 space-y-3",children:o()})]})},XP=[{type:"brightness",label:"Brightness",category:"Basic"},{type:"contrast",label:"Contrast",category:"Basic"},{type:"saturation",label:"Saturation",category:"Basic"},{type:"temperature",label:"Temperature",category:"Color"},{type:"tint",label:"Tint",category:"Color"},{type:"blur",label:"Blur",category:"Blur"},{type:"motion-blur",label:"Motion Blur",category:"Blur"},{type:"radial-blur",label:"Radial Blur",category:"Blur"},{type:"sharpen",label:"Sharpen",category:"Creative"},{type:"vignette",label:"Vignette",category:"Creative"},{type:"grain",label:"Film Grain",category:"Creative"},{type:"shadow",label:"Drop Shadow",category:"Stylize"},{type:"glow",label:"Glow",category:"Stylize"},{type:"chromatic-aberration",label:"Chromatic Aberration",category:"Stylize"}],sQ=[...new Set(XP.map(r=>r.category))],iQ=({onSelect:r})=>c.jsxs(Sp,{children:[c.jsx(Tp,{asChild:!0,children:c.jsx("button",{className:"w-full py-2 bg-primary/10 border border-primary/30 rounded-lg text-[10px] text-primary hover:bg-primary/20 transition-colors",children:"+ Add Effect"})}),c.jsx(Qd,{align:"start",className:"w-48 max-h-64 overflow-y-auto",children:sQ.map(e=>c.jsxs(Ye.Fragment,{children:[c.jsx(rM,{className:"text-[9px] uppercase tracking-wider text-text-muted",children:e}),XP.filter(t=>t.category===e).map(t=>c.jsx(Zi,{onClick:()=>r(t.type),className:"text-[10px]",children:t.label},t.type))]},e))})]}),rQ=({clipId:r})=>{const{getVideoEffects:e,addVideoEffect:t,updateVideoEffect:s,removeVideoEffect:i,toggleVideoEffect:n}=W(),a=W(p=>p.project.modifiedAt),o=v.useMemo(()=>e(r),[r,e,a]),l=v.useCallback(p=>{t(r,p)},[r,t]),d=v.useCallback((p,f)=>{s(r,p,f)},[r,s]),u=v.useCallback((p,f)=>{n(r,p,f)},[r,n]),h=v.useCallback(p=>{i(r,p)},[r,i]);return c.jsxs("div",{className:"space-y-3",children:[o.length===0?c.jsx("p",{className:"text-[10px] text-text-muted text-center py-2",children:"No effects applied"}):c.jsx("div",{className:"space-y-2",children:o.map(p=>c.jsx(tQ,{effect:p,onUpdate:d,onToggle:u,onRemove:h},p.id))}),c.jsx(iQ,{onSelect:l})]})},nQ=({color:r,onClick:e})=>c.jsx("button",{onClick:e,className:"w-8 h-8 rounded-lg border-2 border-border hover:border-primary transition-colors",style:{backgroundColor:`rgb(${Math.round(r.r*255)}, ${Math.round(r.g*255)}, ${Math.round(r.b*255)})`},title:"Click to pick color from video"}),fg=({label:r,value:e,onChange:t,min:s=0,max:i=1,step:n=.01})=>{const a=(e-s)/(i-s)*100;return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[Math.round(e*100),"%"]})]}),c.jsxs("div",{className:"relative h-1.5",children:[c.jsx("input",{type:"range",min:s,max:i,step:n,value:e,onChange:o=>t(parseFloat(o.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),c.jsx("div",{className:"absolute inset-0 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${a}%`}})}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none",style:{left:`calc(${a}% - 5px)`}})]})]})},aQ=({color:r,label:e,isActive:t,onClick:s})=>c.jsxs("button",{onClick:s,className:`flex items-center gap-1.5 px-2 py-1 rounded text-[9px] transition-colors ${t?"bg-primary text-white":"bg-background-tertiary text-text-muted hover:text-text-primary"}`,children:[c.jsx("div",{className:"w-3 h-3 rounded-sm border border-border",style:{backgroundColor:`rgb(${Math.round(r.r*255)}, ${Math.round(r.g*255)}, ${Math.round(r.b*255)})`}}),e]}),oQ=[{color:{r:0,g:1,b:0},label:"Green"},{color:{r:0,g:0,b:1},label:"Blue"},{color:{r:1,g:1,b:1},label:"White"},{color:{r:0,g:0,b:0},label:"Black"},{color:{r:1,g:0,b:1},label:"Magenta"},{color:{r:0,g:1,b:1},label:"Cyan"}],cQ=({clipId:r})=>{const e=W(y=>y.project),t=fe(y=>y.getChromaKeyEngine),[s,i]=v.useState(!1),[n,a]=v.useState(null);v.useEffect(()=>{let y=!1;return(async()=>{const b=await t();if(!y){a(b);const w=e.timeline.tracks.flatMap(C=>C.clips).find(C=>C.id===r);if(w){const C=w.effects.find(k=>k.type==="chromaKey");C&&C.params&&b.setSettings(r,C.params)}}})(),()=>{y=!0}},[t,r,e]);const o=v.useMemo(()=>n?n.getSettings(r)||{enabled:!1,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5}:{enabled:!1,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5},[n,r,e.modifiedAt]),l=v.useCallback(()=>{if(!n)return;const y=n.getSettings(r);y&&W.setState(x=>{const b=x.project.timeline.tracks.map(w=>({...w,clips:w.clips.map(C=>{if(C.id!==r)return C;const k=C.effects.filter(S=>S.type!=="chromaKey");return{...C,effects:[...k,{id:`chromakey-${r}`,type:"chromaKey",enabled:y.enabled,params:y}]}})}));return{project:{...x.project,timeline:{...x.project.timeline,tracks:b},modifiedAt:Date.now()}}})},[n,r]),d=v.useCallback(()=>{n&&(o.enabled?n.disableChromaKey(r):n.enableChromaKey(r),l())},[n,r,o.enabled,l]),u=v.useCallback(y=>{n&&(n.setKeyColor(r,y),l())},[n,r,l]),h=v.useCallback(y=>{n&&(n.setTolerance(r,y),l())},[n,r,l]),p=v.useCallback(y=>{n&&(n.setEdgeSoftness(r,y),l())},[n,r,l]),f=v.useCallback(y=>{n&&(n.setSpillSuppression(r,y),l())},[n,r,l]),m=v.useCallback(()=>{n&&(n.setSettings(r,{enabled:!0,keyColor:{r:0,g:1,b:0},tolerance:.3,edgeSoftness:.1,spillSuppression:.5}),l())},[n,r,l]),g=y=>Math.abs(o.keyColor.r-y.r)<.1&&Math.abs(o.keyColor.g-y.g)<.1&&Math.abs(o.keyColor.b-y.b)<.1;return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r from-green-500/20 to-emerald-500/20 rounded-lg border border-green-500/30",children:[c.jsx(Uc,{size:16,className:"text-green-400"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Green Screen"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Remove background color from video"})]}),c.jsx("button",{onClick:d,className:`p-1.5 rounded transition-colors ${o.enabled?"bg-green-500/30 text-green-400":"bg-background-tertiary text-text-muted hover:text-text-primary"}`,title:o.enabled?"Disable chroma key":"Enable chroma key",children:o.enabled?c.jsx(Ur,{size:14}):c.jsx(ha,{size:14})})]}),o.enabled&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:"Key Color"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>i(!s),className:`p-1.5 rounded transition-colors ${s?"bg-primary text-white":"bg-background-tertiary text-text-muted hover:text-text-primary"}`,title:"Pick color from video",children:c.jsx(IO,{size:12})}),c.jsx(nQ,{color:o.keyColor})]})]}),s&&c.jsx("div",{className:"p-2 bg-primary/10 border border-primary/30 rounded-lg",children:c.jsx("p",{className:"text-[9px] text-primary text-center",children:"Click on the video preview to pick a color"})}),c.jsx("div",{className:"flex flex-wrap gap-1",children:oQ.map(y=>c.jsx(aQ,{color:y.color,label:y.label,isActive:g(y.color),onClick:()=>u(y.color)},y.label))})]}),c.jsxs("div",{className:"space-y-3 pt-2 border-t border-border",children:[c.jsx(fg,{label:"Tolerance",value:o.tolerance,onChange:h}),c.jsx(fg,{label:"Edge Softness",value:o.edgeSoftness,onChange:p}),c.jsx(fg,{label:"Spill Suppression",value:o.spillSuppression,onChange:f})]}),c.jsx("div",{className:"flex items-center gap-2 pt-2 border-t border-border",children:c.jsxs("button",{onClick:m,className:"flex-1 flex items-center justify-center gap-1.5 py-2 text-[10px] text-text-secondary hover:text-text-primary bg-background-tertiary rounded-lg transition-colors",children:[c.jsx(il,{size:12}),"Reset to Defaults"]})}),c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(zs,{size:12,className:"text-text-muted"}),c.jsx("p",{className:"text-[9px] text-text-muted flex-1",children:"Place video clips below this one to use as background"})]})]}),!o.enabled&&c.jsxs("div",{className:"text-center py-4",children:[c.jsx(Uc,{size:24,className:"mx-auto mb-2 text-text-muted opacity-50"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Enable to remove background color"}),c.jsx("button",{onClick:d,className:"mt-2 px-4 py-1.5 text-[10px] bg-green-500/20 text-green-400 hover:bg-green-500/30 rounded-lg transition-colors",children:"Enable Green Screen"})]})]})},lQ=[{id:"rectangle",name:"Rectangle",icon:is},{id:"ellipse",name:"Ellipse",icon:Vr},{id:"polygon",name:"Polygon",icon:MO}],dQ=({mask:r,isSelected:e,isExpanded:t,onSelect:s,onToggleExpand:i,onDelete:n,onDuplicate:a,onUpdateFeathering:o,onUpdateExpansion:l,onUpdateOpacity:d,onToggleInvert:u})=>{const p=r.type==="shape"?is:Jj;return c.jsxs("div",{className:`border rounded-lg overflow-hidden transition-colors ${e?"border-primary bg-primary/10":"border-border"}`,children:[c.jsxs("button",{onClick:s,className:"w-full flex items-center gap-2 p-2 hover:bg-background-tertiary transition-colors",children:[c.jsx("button",{onClick:f=>{f.stopPropagation(),i()},className:"p-0.5",children:t?c.jsx(ls,{size:12,className:"text-text-muted"}):c.jsx(Js,{size:12,className:"text-text-muted"})}),c.jsx(p,{size:12,className:"text-primary"}),c.jsx("span",{className:"flex-1 text-left text-[10px] font-medium text-text-primary",children:r.type==="shape"?"Shape Mask":"Drawn Mask"}),c.jsx("button",{onClick:f=>{f.stopPropagation(),u()},className:`p-1 rounded transition-colors ${r.inverted?"bg-amber-500/20 text-amber-400":"text-text-muted hover:text-text-primary"}`,title:r.inverted?"Mask Inverted":"Mask Normal",children:r.inverted?c.jsx(ha,{size:10}):c.jsx(Ur,{size:10})}),c.jsx("button",{onClick:f=>{f.stopPropagation(),a()},className:"p-1 text-text-muted hover:text-text-primary transition-colors",title:"Duplicate Mask",children:c.jsx(Ao,{size:10})}),c.jsx("button",{onClick:f=>{f.stopPropagation(),n()},className:"p-1 text-text-muted hover:text-red-400 transition-colors",title:"Delete Mask",children:c.jsx(Ss,{size:10})})]}),t&&c.jsxs("div",{className:"p-2 space-y-3 border-t border-border bg-background-tertiary/50",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Feathering"}),c.jsxs("span",{className:"text-[9px] text-text-secondary",children:[r.feathering,"px"]})]}),c.jsx(st,{min:0,max:100,step:1,value:[r.feathering],onValueChange:f=>o(f[0])})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Expansion"}),c.jsxs("span",{className:"text-[9px] text-text-secondary",children:[r.expansion,"px"]})]}),c.jsx(st,{min:-100,max:100,step:1,value:[r.expansion],onValueChange:f=>l(f[0])})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Opacity"}),c.jsxs("span",{className:"text-[9px] text-text-secondary",children:[Math.round(r.opacity*100),"%"]})]}),c.jsx(st,{min:0,max:100,step:1,value:[r.opacity*100],onValueChange:f=>d(f[0]/100)})]}),c.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-border",children:[c.jsxs("button",{onClick:u,className:`flex-1 flex items-center justify-center gap-1 py-1.5 text-[9px] rounded transition-colors ${r.inverted?"bg-amber-500/20 text-amber-400":"bg-background-secondary text-text-secondary hover:text-text-primary"}`,children:[r.inverted?c.jsx(ha,{size:10}):c.jsx(Ur,{size:10}),r.inverted?"Inverted":"Invert"]}),c.jsx("span",{className:"text-[8px] text-text-muted",children:r.keyframes.length>0?`${r.keyframes.length} keyframes`:"No keyframes"})]})]})]})},uQ=({clipId:r})=>{const e=fe(k=>k.getMaskEngine),[t,s]=v.useState(null),[i,n]=v.useState(new Set),[a,o]=v.useState(0),[l,d]=v.useState(null);v.useEffect(()=>{let k=!1;return(async()=>{const A=await e();k||d(A)})(),()=>{k=!0}},[e]);const u=v.useMemo(()=>l?l.getMasksForClip(r):[],[l,r,a]),h=v.useCallback(()=>{o(k=>k+1),W.setState(k=>({project:{...k.project,modifiedAt:Date.now()}}))},[]),p=v.useCallback(k=>{if(!l)return;const S={rectangle:{type:"rectangle",x:.25,y:.25,width:.5,height:.5},ellipse:{type:"ellipse",cx:.5,cy:.5,rx:.25,ry:.25},polygon:{type:"polygon",points:[{x:.5,y:.2},{x:.8,y:.5},{x:.5,y:.8},{x:.2,y:.5}]}},A=l.createShapeMask(r,S[k]);s(A.id),n(T=>new Set([...T,A.id])),h()},[l,r,h]),f=v.useCallback(k=>{l&&(l.deleteMask(k),t===k&&s(null),n(S=>{const A=new Set(S);return A.delete(k),A}),h())},[l,t,h]),m=v.useCallback(k=>{if(!l)return;const S=l.createDrawnMask(r,{...k.path});l.setFeathering(S.id,k.feathering),l.setExpansion(S.id,k.expansion),l.setInverted(S.id,k.inverted),s(S.id),h()},[l,r,h]),g=v.useCallback((k,S)=>{l&&(l.setFeathering(k,S),h())},[l,h]),y=v.useCallback((k,S)=>{l&&(l.setExpansion(k,S),h())},[l,h]),x=v.useCallback((k,S)=>{if(!l)return;const A=l.getMask(k);A&&(l.updateMaskPath(k,A.path),h())},[l,h]),b=v.useCallback(k=>{if(!l)return;const S=l.getMask(k);S&&(l.setInverted(k,!S.inverted),h())},[l,h]),w=k=>{n(S=>{const A=new Set(S);return A.has(k)?A.delete(k):A.add(k),A})},C=v.useCallback(()=>{if(l){for(const k of u)l.deleteMask(k.id);s(null),n(new Set),h()}},[l,u,h]);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(is,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Masking"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Control visible regions of clip"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Add Mask Shape"})}),c.jsxs("div",{className:"grid grid-cols-4 gap-1",children:[lQ.map(k=>{const S=k.icon;return c.jsxs("button",{onClick:()=>p(k.id),className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-background-tertiary hover:bg-primary/20 border border-transparent hover:border-primary/30 transition-colors",title:k.name,children:[c.jsx(S,{size:14,className:"text-text-secondary"}),c.jsx("span",{className:"text-[8px] text-text-muted",children:k.name})]},k.id)}),c.jsxs("button",{onClick:()=>{},className:"flex flex-col items-center gap-1 p-2 rounded-lg bg-background-tertiary hover:bg-primary/20 border border-transparent hover:border-primary/30 transition-colors",title:"Draw Freehand",children:[c.jsx(Jj,{size:14,className:"text-text-secondary"}),c.jsx("span",{className:"text-[8px] text-text-muted",children:"Freehand"})]})]})]}),u.length>0?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("span",{className:"text-[10px] font-medium text-text-secondary",children:["Masks (",u.length,")"]}),c.jsxs("button",{onClick:C,className:"flex items-center gap-1 px-2 py-1 text-[9px] text-red-400 hover:bg-red-400/10 rounded transition-colors",children:[c.jsx(il,{size:10}),"Clear All"]})]}),c.jsx("div",{className:"space-y-2",children:u.map(k=>c.jsx(dQ,{mask:k,isSelected:t===k.id,isExpanded:i.has(k.id),onSelect:()=>s(k.id),onToggleExpand:()=>w(k.id),onDelete:()=>f(k.id),onDuplicate:()=>m(k),onUpdateFeathering:S=>g(k.id,S),onUpdateExpansion:S=>y(k.id,S),onUpdateOpacity:S=>x(k.id,S),onToggleInvert:()=>b(k.id)},k.id))})]}):c.jsxs("div",{className:"text-center py-4",children:[c.jsx(is,{size:24,className:"mx-auto mb-2 text-text-muted opacity-50"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No masks on this clip"}),c.jsx("p",{className:"text-[9px] text-text-muted mt-1",children:"Click a shape above to add a mask"})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Masks control which parts of the clip are visible"})})]})},bh=[{id:"top-left",name:"Top Left",icon:"corner",transform:{position:{x:-.35,y:-.35},scale:{x:.3,y:.3}}},{id:"top-right",name:"Top Right",icon:"corner",transform:{position:{x:.35,y:-.35},scale:{x:.3,y:.3}}},{id:"bottom-left",name:"Bottom Left",icon:"corner",transform:{position:{x:-.35,y:.35},scale:{x:.3,y:.3}}},{id:"bottom-right",name:"Bottom Right",icon:"corner",transform:{position:{x:.35,y:.35},scale:{x:.3,y:.3}}},{id:"split-left",name:"Split Left",icon:"split",transform:{position:{x:-.25,y:0},scale:{x:.5,y:1}}},{id:"split-right",name:"Split Right",icon:"split",transform:{position:{x:.25,y:0},scale:{x:.5,y:1}}},{id:"split-top",name:"Split Top",icon:"split",transform:{position:{x:0,y:-.25},scale:{x:1,y:.5}}},{id:"split-bottom",name:"Split Bottom",icon:"split",transform:{position:{x:0,y:.25},scale:{x:1,y:.5}}},{id:"center-small",name:"Center Small",icon:"center",transform:{position:{x:0,y:0},scale:{x:.5,y:.5}}},{id:"center-medium",name:"Center Medium",icon:"center",transform:{position:{x:0,y:0},scale:{x:.7,y:.7}}},{id:"fullscreen",name:"Full Screen",icon:"center",transform:{position:{x:0,y:0},scale:{x:1,y:1}}}],hQ=({type:r,className:e=""})=>{switch(r){case"corner":return c.jsx(is,{size:14,className:e});case"split":return c.jsx($x,{size:14,className:e});case"center":return c.jsx(Ca,{size:14,className:e});default:return c.jsx(aa,{size:14,className:e})}},Xa=({label:r,value:e,onChange:t,min:s=-1,max:i=1,step:n=.01,unit:a=""})=>{const o=(e-s)/(i-s)*100;return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[e.toFixed(2),a]})]}),c.jsxs("div",{className:"relative h-1.5",children:[c.jsx("input",{type:"range",min:s,max:i,step:n,value:e,onChange:l=>t(parseFloat(l.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),c.jsx("div",{className:"absolute inset-0 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary rounded-full transition-all",style:{width:`${o}%`}})}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none",style:{left:`calc(${o}% - 5px)`}})]})]})},mg=({preset:r,isActive:e,onClick:t})=>c.jsxs("button",{onClick:t,className:`flex flex-col items-center gap-1 p-2 rounded-lg border transition-colors ${e?"bg-primary/20 border-primary text-primary":"bg-background-tertiary border-border text-text-muted hover:text-text-primary hover:border-primary/50"}`,title:r.name,children:[c.jsx(hQ,{type:r.icon}),c.jsx("span",{className:"text-[8px] truncate max-w-full",children:r.name})]}),pQ=({clipId:r})=>{const e=W(x=>x.project),t=W(x=>x.updateClipTransform),[s,i]=v.useState(!1),n=v.useMemo(()=>{for(const x of e.timeline.tracks){const b=x.clips.find(w=>w.id===r);if(b)return b}return null},[e,r]),a=v.useMemo(()=>n?n.transform:{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},[n]),o=v.useMemo(()=>{for(const x of bh){const b=x.transform;if(b.position&&b.scale&&Math.abs(a.position.x-b.position.x)<.05&&Math.abs(a.position.y-b.position.y)<.05&&Math.abs(a.scale.x-b.scale.x)<.05&&Math.abs(a.scale.y-b.scale.y)<.05)return x.id}return null},[a]),l=v.useCallback(x=>{if(!n)return;const b={...a,position:x.transform.position||a.position,scale:x.transform.scale||a.scale};t(r,b)},[n,r,a,t]),d=v.useCallback((x,b)=>{if(!n)return;const w={...a,position:{...a.position,[x]:b}};t(r,w)},[n,r,a,t]),u=v.useCallback((x,b)=>{if(!n)return;const w=x==="both"?{x:b,y:b}:{...a.scale,[x]:b},C={...a,scale:w};t(r,C)},[n,r,a,t]),h=v.useCallback(x=>{if(!n)return;const b={...a,borderRadius:x};t(r,b)},[n,r,a,t]),p=v.useCallback(x=>{if(!n)return;const b={...a,opacity:x};t(r,b)},[n,r,a,t]),f=v.useCallback(()=>{if(!n)return;t(r,{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1,borderRadius:0})},[n,r,t]),m=bh.filter(x=>x.icon==="corner"),g=bh.filter(x=>x.icon==="split"),y=bh.filter(x=>x.icon==="center");return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(NO,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Picture-in-Picture"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Position and scale video overlay"})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Corner Positions"}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:m.map(x=>c.jsx(mg,{preset:x,isActive:o===x.id,onClick:()=>l(x)},x.id))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Split Screen"}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:g.map(x=>c.jsx(mg,{preset:x,isActive:o===x.id,onClick:()=>l(x)},x.id))})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Center & Full"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:y.map(x=>c.jsx(mg,{preset:x,isActive:o===x.id,onClick:()=>l(x)},x.id))})]}),c.jsxs("button",{onClick:()=>i(!s),className:"w-full py-1.5 text-[10px] text-text-secondary hover:text-text-primary bg-background-tertiary rounded-lg transition-colors",children:[s?"Hide":"Show"," Advanced Controls"]}),s&&c.jsxs("div",{className:"space-y-3 pt-2 border-t border-border",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Position"}),c.jsx(Xa,{label:"X Position",value:a.position.x,onChange:x=>d("x",x),min:-1,max:1}),c.jsx(Xa,{label:"Y Position",value:a.position.y,onChange:x=>d("y",x),min:-1,max:1})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Scale"}),c.jsx(Xa,{label:"Uniform Scale",value:a.scale.x,onChange:x=>u("both",x),min:.1,max:2}),c.jsx(Xa,{label:"X Scale",value:a.scale.x,onChange:x=>u("x",x),min:.1,max:2}),c.jsx(Xa,{label:"Y Scale",value:a.scale.y,onChange:x=>u("y",x),min:.1,max:2})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Appearance"}),c.jsx(Xa,{label:"Border Radius",value:a.borderRadius||0,onChange:h,min:0,max:50,unit:"px"}),c.jsx(Xa,{label:"Opacity",value:a.opacity,onChange:p,min:0,max:1})]})]}),c.jsxs("button",{onClick:f,className:"w-full flex items-center justify-center gap-1.5 py-2 text-[10px] text-text-secondary hover:text-text-primary bg-background-tertiary rounded-lg transition-colors",children:[c.jsx($i,{size:12}),"Reset to Default"]}),c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Drag clip in preview to fine-tune position"})]})},ud=[{type:"lowshelf",frequency:60,gain:0,q:.707},{type:"peaking",frequency:250,gain:0,q:1.4},{type:"peaking",frequency:1e3,gain:0,q:1.4},{type:"peaking",frequency:4e3,gain:0,q:1.4},{type:"highshelf",frequency:16e3,gain:0,q:.707}];function KP(r){return{type:["lowshelf","highshelf","peaking","lowpass","highpass","notch"].includes(r.type)?r.type:"peaking",frequency:Math.max(20,Math.min(2e4,r.frequency??1e3)),gain:Math.max(-24,Math.min(24,r.gain??0)),q:Math.max(.1,Math.min(18,r.q??1))}}function QP(r){return{threshold:Math.max(-60,Math.min(0,r.threshold??-20)),ratio:Math.max(1,Math.min(20,r.ratio??4)),attack:Math.max(.001,Math.min(1,r.attack??.01)),release:Math.max(.01,Math.min(3,r.release??.1)),knee:Math.max(0,Math.min(40,r.knee??6))}}function JP(r){return{roomSize:Math.max(0,Math.min(1,r.roomSize??.5)),damping:Math.max(0,Math.min(1,r.damping??.5)),wetLevel:Math.max(0,Math.min(1,r.wetLevel??.3)),dryLevel:Math.max(0,Math.min(1,r.dryLevel??1)),preDelay:Math.max(0,Math.min(100,r.preDelay??0))}}function ZP(r){return{time:Math.max(0,Math.min(2,r.time??.25)),feedback:Math.max(0,Math.min(.95,r.feedback??.3)),wetLevel:Math.max(0,Math.min(1,r.wetLevel??.25))}}function eN(r){return{threshold:Math.max(-80,Math.min(0,r.threshold??-40)),reduction:Math.max(0,Math.min(1,r.reduction??.5)),attack:Math.max(0,Math.min(100,r.attack??10)),release:Math.max(0,Math.min(500,r.release??100))}}function fQ(r){const e=r.map(KP);return{id:`eq-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"eq",params:{bands:e},enabled:!0}}function mQ(r){const e=QP(r);return{id:`compressor-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"compressor",params:e,enabled:!0}}function gQ(r){const e=JP(r);return{id:`reverb-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"reverb",params:e,enabled:!0}}function yQ(r){const e=ZP(r);return{id:`delay-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"delay",params:e,enabled:!0}}function xQ(r){const e=eN(r);return{id:`noiseReduction-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,type:"noiseReduction",params:e,enabled:!0}}class bQ{audioEffectsEngine=null;noiseProfiles=new Map;initialized=!1;async initialize(){this.initialized||(this.audioEffectsEngine=LW(),this.audioEffectsEngine.isInitialized()||await this.audioEffectsEngine.initialize(),this.initialized=!0)}isInitialized(){return this.initialized}getAudioEffectsEngine(){return this.audioEffectsEngine}applyEQ(e,t){try{const s=fQ(t);return W.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply EQ"}}}updateEQ(e,t,s){try{const i=s.map(KP);return W.getState().updateAudioEffect(e,t,{bands:i}),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update EQ"}}}applyCompressor(e,t){try{const s=mQ(t);return W.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply compressor"}}}updateCompressor(e,t,s){try{const i=QP(s);return W.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update compressor"}}}applyReverb(e,t){try{const s=gQ(t);return W.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply reverb"}}}updateReverb(e,t,s){try{const i=JP(s);return W.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update reverb"}}}applyDelay(e,t){try{const s=yQ(t);return W.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply delay"}}}updateDelay(e,t,s){try{const i=ZP(s);return W.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update delay"}}}applyNoiseReduction(e,t){try{const s=xQ(t);return W.getState().addAudioEffect(e,s),{success:!0,effectId:s.id}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to apply noise reduction"}}}updateNoiseReduction(e,t,s){try{const i=eN(s);return W.getState().updateAudioEffect(e,t,i),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to update noise reduction"}}}async learnNoiseProfile(e,t){if(!this.audioEffectsEngine)throw new Error("AudioBridgeEffects not initialized");const s=t??`noise-profile-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,i=await this.audioEffectsEngine.learnNoiseProfile(e,s),n={id:s,frequencyBins:i.frequencyBins,magnitudes:i.magnitudes,sampleRate:i.sampleRate,createdAt:Date.now()};return this.noiseProfiles.set(s,n),n}getNoiseProfile(e){return this.noiseProfiles.get(e)}getAllNoiseProfiles(){return Array.from(this.noiseProfiles.values())}removeNoiseProfile(e){return this.noiseProfiles.delete(e)}removeEffect(e,t){try{return W.getState().removeAudioEffect(e,t),{success:!0,effectId:t}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Failed to remove effect"}}}toggleEffect(e,t,s){try{return W.getState().toggleAudioEffect(e,t,s),{success:!0,effectId:t}}catch(i){return{success:!1,error:i instanceof Error?i.message:"Failed to toggle effect"}}}async processAudio(e,t){if(!this.audioEffectsEngine)throw new Error("AudioBridgeEffects not initialized");return(await this.audioEffectsEngine.applyEffectChain(e,t)).buffer}dispose(){this.noiseProfiles.clear(),this.audioEffectsEngine=null,this.initialized=!1}}let gg=null;function Nr(){return gg||(gg=new bQ),gg}async function tN(){const r=Nr();return await r.initialize(),r}const vQ=({clip:r})=>{const e=W(o=>o.updateClipTransform),t=Ft(o=>o.setCropMode),s=r.transform.crop||{x:0,y:0,width:1,height:1},i=s.x!==0||s.y!==0||s.width!==1||s.height!==1,n=()=>{e(r.id,{crop:void 0})},a=()=>{t(!0,r.id)};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("button",{onClick:a,className:"w-full py-2.5 bg-primary hover:bg-primary/90 text-white rounded-lg text-xs font-medium transition-colors flex items-center justify-center gap-2",children:[c.jsx(bL,{size:14}),i?"Adjust Crop":"Crop Video"]}),i&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"text-[9px] text-text-muted space-y-0.5 p-2 bg-background-tertiary rounded border border-border",children:[c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Crop Region:"}),c.jsxs("span",{children:[Math.round(s.width*100),"%  ",Math.round(s.height*100),"%"]})]}),c.jsxs("div",{className:"flex justify-between",children:[c.jsx("span",{children:"Position:"}),c.jsxs("span",{children:["(",Math.round(s.x*100),"%, ",Math.round(s.y*100),"%)"]})]})]}),c.jsxs("button",{onClick:n,className:"w-full py-2 text-xs text-text-secondary hover:text-text-primary bg-background-tertiary hover:bg-background-elevated border border-border rounded-lg transition-colors flex items-center justify-center gap-2",children:[c.jsx($i,{size:12}),"Reset Crop"]})]})]})},wQ=[{label:"0.25",value:.25},{label:"0.5",value:.5},{label:"0.75",value:.75},{label:"1",value:1},{label:"1.25",value:1.25},{label:"1.5",value:1.5},{label:"2",value:2},{label:"3",value:3},{label:"5",value:5}],kQ=({clip:r})=>{const e=gc(),{project:t}=W(),[s,i]=v.useState(e.getClipSpeed(r.id)||1),[n,a]=v.useState(()=>e.getClipSpeedData(r.id)?.reverse||!1),[o,l]=v.useState(s.toString()),[d,u]=v.useState(!0);v.useEffect(()=>{l(s.toString())},[s]);const h=()=>!!t.timeline.tracks.find(b=>b.type==="audio"&&b.clips.some(w=>w.mediaId===r.mediaId)),p=x=>{const w=(r.outPoint-r.inPoint)/x,C=t.timeline.tracks.map(k=>{const S=k.clips.findIndex(j=>j.id===r.id);if(S===-1){if(d&&k.type==="audio"){const j=k.clips.findIndex(_=>_.mediaId===r.mediaId);if(j!==-1){const _=k.clips[j],M={..._,duration:w,speed:x},P=[...k.clips];return P[j]=M,e.setClipSpeed(_.id,x,_.duration),{...k,clips:P}}}return k}const A={...k.clips[S],duration:w,speed:x},T=[...k.clips];return T[S]=A,{...k,clips:T}});W.setState({project:{...t,timeline:{...t.timeline,tracks:C},modifiedAt:Date.now()}})},f=x=>{const b=t.timeline.tracks.map(w=>{const C=w.clips.findIndex(A=>A.id===r.id);if(C===-1){if(d&&w.type==="audio"){const A=w.clips.findIndex(T=>T.mediaId===r.mediaId);if(A!==-1){const T=w.clips[A],j={...T,reversed:x},_=[...w.clips];return _[A]=j,e.setReverse(T.id,x,T.duration),{...w,clips:_}}}return w}const k={...w.clips[C],reversed:x},S=[...w.clips];return S[C]=k,{...w,clips:S}});W.setState({project:{...t,timeline:{...t.timeline,tracks:b},modifiedAt:Date.now()}})},m=x=>{e.setClipSpeed(r.id,x,r.duration),p(x),i(x)},g=()=>{const x=parseFloat(o);!isNaN(x)&&x>=.1&&x<=100&&(e.setClipSpeed(r.id,x,r.duration),p(x),i(x))},y=()=>{const x=!n;e.setReverse(r.id,x,r.duration),f(x),a(x)};return c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"grid grid-cols-3 gap-2",children:wQ.map(x=>c.jsx("button",{onClick:()=>m(x.value),className:`px-3 py-2 text-xs font-medium rounded-lg transition-all ${s===x.value?"bg-primary text-white shadow-lg shadow-primary/20":"bg-background-tertiary hover:bg-background-elevated text-text-secondary hover:text-text-primary border border-border"}`,children:x.label},x.value))}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(ts,{className:"text-xs text-text-tertiary",children:"Custom Speed"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx(Ms,{type:"number",min:.1,max:100,step:.1,value:o,onChange:x=>l(x.target.value),onBlur:g,onKeyDown:x=>{x.key==="Enter"&&g()},className:"flex-1 bg-background-tertiary border-border text-text-primary",placeholder:"1.0"}),c.jsx("span",{className:"flex items-center text-xs text-text-tertiary",children:""})]}),c.jsx("p",{className:"text-xs text-text-tertiary",children:"Range: 0.1 (slowest) to 100 (fastest)"})]}),h()&&c.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-background-tertiary border border-border",children:[c.jsx(ts,{htmlFor:"affect-audio",className:"text-xs text-text-secondary",children:"Apply speed to audio"}),c.jsx(ya,{id:"affect-audio",checked:d,onCheckedChange:u})]}),c.jsxs("button",{onClick:y,className:`w-full px-3 py-2.5 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${n?"bg-primary text-white shadow-lg shadow-primary/20":"bg-background-tertiary hover:bg-background-elevated text-text-secondary hover:text-text-primary border border-border"}`,children:[c.jsx($i,{size:14}),n?"Reversed":"Reverse Clip"]}),(s!==1||n)&&c.jsxs("div",{className:"p-3 rounded-lg bg-background-tertiary border border-border",children:[c.jsx("div",{className:"text-xs text-text-tertiary mb-1",children:"Current Settings"}),c.jsxs("div",{className:"text-sm text-text-primary",children:["Speed: ",s," ",n&&" Reversed"]})]})]})},yg=({label:r,value:e,onChange:t,min:s,max:i,defaultValue:n,step:a=.01})=>{const o=(e-s)/(i-s)*100,l=v.useCallback(()=>{t(n)},[t,n]);return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary cursor-pointer hover:text-accent",onDoubleClick:l,title:"Double-click to reset",children:e.toFixed(2)})]}),c.jsxs("div",{className:"h-1.5 bg-background-tertiary rounded-full relative overflow-hidden",children:[c.jsx("input",{type:"range",min:s,max:i,step:a,value:e,onChange:d=>t(parseFloat(d.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),c.jsx("div",{className:"absolute top-0 left-0 h-full bg-text-secondary rounded-full transition-all",style:{width:`${o}%`}}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none transition-all",style:{left:`calc(${o}% - 5px)`}})]})]})},xg=({label:r,color:e,onChange:t,onReset:s})=>{const i=v.useRef(null),n=v.useRef(!1),a=v.useMemo(()=>{const d=e.r,u=-e.b,h=Math.sqrt(d*d+u*u),p=Math.atan2(u,d);return{x:Math.cos(p)*h*28,y:Math.sin(p)*h*28,saturation:Math.min(h,1)}},[e.r,e.b]),o=v.useCallback(d=>{const u=i.current;if(!u)return;n.current=!0;const h=u.getBoundingClientRect(),p=h.width/2,f=h.height/2,m=(x,b)=>{const w=(x-h.left-p)/p,C=(b-h.top-f)/f,k=Math.sqrt(w*w+C*C),S=Math.min(k,1),A=k>0?w/k*S:0,T=k>0?C/k*S:0,j=A,_=-T,M=-(j+_)/2;t({r:j,g:M,b:_})};m(d.clientX,d.clientY);const g=x=>{n.current&&m(x.clientX,x.clientY)},y=()=>{n.current=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",y)};document.addEventListener("mousemove",g),document.addEventListener("mouseup",y)},[t]),l=v.useCallback(()=>{s()},[s]);return c.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[c.jsx("span",{className:"text-[9px] text-text-muted uppercase tracking-wider font-medium",children:r}),c.jsxs("div",{ref:i,className:"w-16 h-16 rounded-full relative cursor-crosshair shadow-inner",style:{background:`conic-gradient(
 from 90deg,
 hsl(0, 70%, 50%),
 hsl(60, 70%, 50%),
 hsl(120, 70%, 50%),
 hsl(180, 70%, 50%),
 hsl(240, 70%, 50%),
 hsl(300, 70%, 50%),
 hsl(360, 70%, 50%)
 )`},onMouseDown:o,onDoubleClick:l,title:"Drag to adjust color. Double-click to reset.",children:[c.jsx("div",{className:"absolute inset-0 rounded-full",style:{background:"radial-gradient(circle, rgba(128,128,128,1) 0%, rgba(128,128,128,0) 70%)"}}),c.jsx("div",{className:"absolute w-3 h-3 border-2 border-white rounded-full shadow-md pointer-events-none z-10",style:{left:`calc(50% + ${a.x}px - 6px)`,top:`calc(50% + ${a.y}px - 6px)`,backgroundColor:a.saturation>.1?`rgb(${128+e.r*127}, ${128+e.g*127}, ${128+e.b*127})`:"white"}})]})]})},CQ=({values:r,onChange:e,onReset:t})=>{const s=v.useCallback(p=>{e({...r,shadows:p})},[r,e]),i=v.useCallback(p=>{e({...r,midtones:p})},[r,e]),n=v.useCallback(p=>{e({...r,highlights:p})},[r,e]),a=v.useCallback(p=>{e({...r,shadowsLift:p})},[r,e]),o=v.useCallback(p=>{e({...r,midtonesGamma:p})},[r,e]),l=v.useCallback(p=>{e({...r,highlightsGain:p})},[r,e]),d=v.useCallback(()=>{e({...r,shadows:{r:0,g:0,b:0}})},[r,e]),u=v.useCallback(()=>{e({...r,midtones:{r:0,g:0,b:0}})},[r,e]),h=v.useCallback(()=>{e({...r,highlights:{r:0,g:0,b:0}})},[r,e]);return c.jsxs("div",{className:"space-y-4",children:[t&&c.jsx("div",{className:"flex justify-end",children:c.jsxs("button",{onClick:t,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx($i,{size:10}),"Reset"]})}),c.jsxs("div",{className:"flex justify-around items-start",children:[c.jsx(xg,{label:"Shadows",color:r.shadows,onChange:s,onReset:d}),c.jsx(xg,{label:"Midtones",color:r.midtones,onChange:i,onReset:u}),c.jsx(xg,{label:"Highlights",color:r.highlights,onChange:n,onReset:h})]}),c.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[c.jsx(yg,{label:"Lift (Shadows)",value:r.shadowsLift,onChange:a,min:-1,max:1,defaultValue:0}),c.jsx(yg,{label:"Gamma (Midtones)",value:r.midtonesGamma,onChange:o,min:.1,max:4,defaultValue:1}),c.jsx(yg,{label:"Gain (Highlights)",value:r.highlightsGain,onChange:l,min:0,max:4,defaultValue:1})]})]})},L2={rgb:[{x:0,y:0},{x:1,y:1}],red:[{x:0,y:0},{x:1,y:1}],green:[{x:0,y:0},{x:1,y:1}],blue:[{x:0,y:0},{x:1,y:1}]},$y={rgb:"#ffffff",red:"#ef4444",green:"#22c55e",blue:"#3b82f6"},vh=({channel:r,label:e,isActive:t,onClick:s})=>c.jsx("button",{onClick:s,className:`px-3 py-1 text-[10px] font-medium rounded transition-colors ${t?"bg-background-tertiary text-text-primary":"text-text-muted hover:text-text-secondary"}`,style:{borderBottom:t?`2px solid ${$y[r]}`:"none"},children:e});function SQ(r,e){if(r.length<2)return e;const t=[...r].sort((p,f)=>p.x-f.x);let s=0;for(let p=0;p<t.length-1;p++)if(e>=t[p].x&&e<=t[p+1].x){s=p;break}const i=s>0?t[s-1]:t[s],n=t[s],a=t[Math.min(s+1,t.length-1)],o=t[Math.min(s+2,t.length-1)],l=a.x!==n.x?(e-n.x)/(a.x-n.x):0,d=l*l,u=d*l,h=.5*(2*n.y+(-i.y+a.y)*l+(2*i.y-5*n.y+4*a.y-o.y)*d+(-i.y+3*n.y-3*a.y+o.y)*u);return Math.max(0,Math.min(1,h))}function TQ(r,e,t){if(r.length<2)return"";const s=[...r].sort((a,o)=>a.x-o.x),i=[],n=100;for(let a=0;a<=n;a++){const o=a/n,l=SQ(s,o),d=o*e,u=t-l*t;i.push(a===0?`M ${d} ${u}`:`L ${d} ${u}`)}return i.join(" ")}const AQ=({values:r,onChange:e,onReset:t})=>{const[s,i]=v.useState("rgb"),[n,a]=v.useState(null),[o,l]=v.useState(!1),d=v.useRef(null),u=200,h=200,p=8,f=v.useMemo(()=>r[s]||L2[s],[r,s]),m=v.useCallback(k=>{if(!d.current||n===null)return;const S=d.current.getBoundingClientRect(),A=Math.max(0,Math.min(1,(k.clientX-S.left-p)/(u-2*p))),T=Math.max(0,Math.min(1,1-(k.clientY-S.top-p)/(h-2*p))),j=[...f];if(n===0)j[n]={x:0,y:T};else if(n===f.length-1)j[n]={x:1,y:T};else{const _=j[n-1]?.x||0,M=j[n+1]?.x||1,P=Math.max(_+.01,Math.min(M-.01,A));j[n]={x:P,y:T}}e({...r,[s]:j})},[n,f,s,r,e]),g=v.useCallback(k=>S=>{S.preventDefault(),S.stopPropagation(),a(k),l(!0)},[]);v.useEffect(()=>{const k=()=>{l(!1),a(null)},S=A=>{o&&m(A)};return o&&(document.addEventListener("mousemove",S),document.addEventListener("mouseup",k)),()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",k)}},[o,m]);const y=v.useCallback(k=>{if(!d.current||o)return;const S=d.current.getBoundingClientRect(),A=(k.clientX-S.left-p)/(u-2*p),T=1-(k.clientY-S.top-p)/(h-2*p);if(A<.01||A>.99||T<0||T>1)return;const j=[...f,{x:A,y:T}].sort((_,M)=>_.x-M.x);e({...r,[s]:j})},[f,s,r,e,o]),x=v.useCallback(k=>S=>{if(S.preventDefault(),S.stopPropagation(),k===0||k===f.length-1)return;const A=f.filter((T,j)=>j!==k);e({...r,[s]:A})},[f,s,r,e]),b=v.useCallback(()=>{e({...r,[s]:[...L2[s]]})},[s,r,e]),w=v.useMemo(()=>TQ(f,u-2*p,h-2*p),[f]),C=`M ${p} ${h-p} L ${u-p} ${p}`;return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex gap-1 justify-center",children:[c.jsx(vh,{channel:"rgb",label:"RGB",isActive:s==="rgb",onClick:()=>i("rgb")}),c.jsx(vh,{channel:"red",label:"R",isActive:s==="red",onClick:()=>i("red")}),c.jsx(vh,{channel:"green",label:"G",isActive:s==="green",onClick:()=>i("green")}),c.jsx(vh,{channel:"blue",label:"B",isActive:s==="blue",onClick:()=>i("blue")})]}),c.jsx("div",{className:"relative bg-background-tertiary rounded-lg overflow-hidden",children:c.jsxs("svg",{ref:d,width:u,height:h,className:"cursor-crosshair",onClick:y,children:[c.jsx("defs",{children:c.jsx("pattern",{id:"grid",width:u/4,height:h/4,patternUnits:"userSpaceOnUse",children:c.jsx("path",{d:`M ${u/4} 0 L 0 0 0 ${h/4}`,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeWidth:"0.5"})})}),c.jsx("rect",{width:u,height:h,fill:"url(#grid)"}),c.jsx("path",{d:C,fill:"none",stroke:"rgba(255,255,255,0.2)",strokeWidth:"1",strokeDasharray:"4,4"}),c.jsxs("g",{transform:`translate(${p}, ${p})`,children:[c.jsx("path",{d:w,fill:"none",stroke:$y[s],strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),f.map((k,S)=>{const A=k.x*(u-2*p),T=(1-k.y)*(h-2*p),j=n===S,_=S===0||S===f.length-1;return c.jsxs("g",{children:[c.jsx("circle",{cx:A,cy:T,r:12,fill:"transparent",className:"cursor-pointer",onMouseDown:g(S),onDoubleClick:x(S)}),c.jsx("circle",{cx:A,cy:T,r:j?6:4,fill:_?"#666":$y[s],stroke:"white",strokeWidth:j?2:1,className:"pointer-events-none"})]},S)})]})]})}),c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"Click to add point  Double-click to remove"}),c.jsxs("button",{onClick:b,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx($i,{size:10}),"Reset"]})]}),c.jsxs("div",{className:"text-[9px] text-text-muted text-center",children:[f.length," points"]})]})},jQ=({value:r,onChange:e})=>{const t=Math.round(r*100);return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Intensity"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t,"%"]})]}),c.jsx(st,{min:0,max:100,step:1,value:[t],onValueChange:s=>e(s[0]/100)})]})};function _Q(r){const e=r.split(`
`).map(n=>n.trim());let t=0;const s=[];for(const n of e){if(n.startsWith("#")||n==="")continue;if(n.startsWith("LUT_3D_SIZE")){const o=n.split(/\s+/);if(t=parseInt(o[1],10),isNaN(t)||t<2||t>256)throw new Error(`Invalid LUT size: ${o[1]}`);continue}if(n.startsWith("TITLE")||n.startsWith("DOMAIN_"))continue;const a=n.split(/\s+/).map(parseFloat);a.length===3&&a.every(o=>!isNaN(o))&&s.push(Math.round(Math.max(0,Math.min(1,a[0]))*255),Math.round(Math.max(0,Math.min(1,a[1]))*255),Math.round(Math.max(0,Math.min(1,a[2]))*255))}if(t===0)throw new Error("LUT size not specified in file");const i=t*t*t*3;if(s.length!==i)throw new Error(`Invalid LUT data: expected ${i} values, got ${s.length}`);return{data:new Uint8Array(s),size:t,intensity:1}}function EQ(r){const e=r.split(`
`).map(i=>i.trim()),t=[];let s=0;for(const i of e){if(i===""||i.startsWith("#"))continue;if(s===0){const a=i.split(/\s+/).map(parseFloat);if(a.length>=1&&!isNaN(a[0])){s=Math.round(Math.cbrt(a.length/3))||17,a.length===3&&(s=17,t.push(Math.round(a[0]/4095*255),Math.round(a[1]/4095*255),Math.round(a[2]/4095*255)));continue}}const n=i.split(/\s+/).map(parseFloat);if(n.length===3&&n.every(a=>!isNaN(a))){const a=Math.max(...n),o=a>255?4095:a>1?255:1;t.push(Math.round(n[0]/o*255),Math.round(n[1]/o*255),Math.round(n[2]/o*255))}}if(s===0||s*s*s*3!==t.length){const i=Math.round(Math.cbrt(t.length/3));if(i*i*i*3===t.length)s=i;else throw new Error("Could not determine LUT size from data")}if(t.length===0)throw new Error("No valid LUT data found in file");return{data:new Uint8Array(t),size:s,intensity:1}}const MQ=({lutData:r,onChange:e,onError:t})=>{const s=v.useRef(null),[i,n]=v.useState(null),[a,o]=v.useState(null),[l,d]=v.useState(!1),u=v.useCallback(async m=>{const g=m.target.files?.[0];if(g){d(!0),n(null);try{const y=await g.text(),x=g.name.toLowerCase().split(".").pop();let b;if(x==="cube")b=_Q(y);else if(x==="3dl")b=EQ(y);else throw new Error("Unsupported file format. Please use .cube or .3dl files.");o(g.name),e(b)}catch(y){const x=y instanceof Error?y.message:"Failed to parse LUT file";n(x),t?.(x)}finally{d(!1),s.current&&(s.current.value="")}}},[e,t]),h=v.useCallback(m=>{r&&e({...r,intensity:m})},[r,e]),p=v.useCallback(()=>{e(null),o(null),n(null)},[e]),f=v.useCallback(()=>{s.current?.click()},[]);return c.jsxs("div",{className:"space-y-3",children:[c.jsx("input",{ref:s,type:"file",accept:".cube,.3dl",onChange:u,className:"hidden"}),r?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsx("p",{className:"text-[10px] text-text-primary truncate",children:a||"LUT Loaded"}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[r.size,"x",r.size,"x",r.size," LUT"]})]}),c.jsx("button",{onClick:p,className:"p-1 text-text-muted hover:text-text-primary transition-colors",title:"Remove LUT",children:c.jsx(Zs,{size:14})})]}),c.jsx(jQ,{value:r.intensity,onChange:h}),c.jsx("button",{onClick:f,disabled:l,className:"w-full py-1.5 text-[10px] text-text-muted hover:text-text-secondary transition-colors",children:"Load Different LUT"})]}):c.jsx("button",{onClick:f,disabled:l,className:"w-full py-2 bg-background-tertiary border border-border rounded-lg text-[10px] text-text-secondary hover:text-text-primary hover:border-text-secondary transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:l?c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"w-3 h-3 border border-text-muted border-t-transparent rounded-full animate-spin"}),"Loading..."]}):c.jsxs(c.Fragment,{children:[c.jsx(ef,{size:12}),"Load LUT (.cube, .3dl)"]})}),i&&c.jsxs("div",{className:"flex items-start gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:[c.jsx(To,{size:14,className:"text-red-500 flex-shrink-0 mt-0.5"}),c.jsx("p",{className:"text-[10px] text-red-400",children:i})]})]})},bg=[{key:"reds",label:"R",fullLabel:"Reds",color:"#ef4444",index:0},{key:"oranges",label:"O",fullLabel:"Oranges",color:"#f97316",index:1},{key:"yellows",label:"Y",fullLabel:"Yellows",color:"#eab308",index:2},{key:"greens",label:"G",fullLabel:"Greens",color:"#22c55e",index:3},{key:"cyans",label:"C",fullLabel:"Cyans",color:"#06b6d4",index:4},{key:"blues",label:"B",fullLabel:"Blues",color:"#3b82f6",index:5},{key:"purples",label:"P",fullLabel:"Purples",color:"#a855f7",index:6},{key:"magentas",label:"M",fullLabel:"Magentas",color:"#ec4899",index:7}],PQ=({color:r,isActive:e,onClick:t})=>c.jsx("button",{onClick:t,className:`flex-1 py-1.5 text-[9px] font-medium rounded transition-all ${e?"bg-background-tertiary text-text-primary shadow-sm":"text-text-muted hover:text-text-secondary"}`,style:{borderBottom:e?`2px solid ${r.color}`:"2px solid transparent"},title:r.fullLabel,children:r.label}),vg=({label:r,value:e,onChange:t,min:s,max:i,unit:n="",color:a})=>{const o=i-s,l=(e-s)/o*100,d=(0-s)/o*100,u=s<0;return c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[e>0?"+":"",Math.round(e),n]})]}),c.jsxs("div",{className:"h-1.5 bg-background-tertiary rounded-full relative overflow-hidden",children:[c.jsx("input",{type:"range",min:s,max:i,step:1,value:e,onChange:h=>t(parseFloat(h.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"}),u?c.jsx("div",{className:"absolute top-0 h-full rounded-full transition-all",style:{backgroundColor:a||"rgb(var(--text-secondary))",left:e>=0?`${d}%`:`${l}%`,width:`${Math.abs(l-d)}%`}}):c.jsx("div",{className:"absolute top-0 left-0 h-full rounded-full transition-all",style:{backgroundColor:a||"rgb(var(--text-secondary))",width:`${l}%`}}),u&&c.jsx("div",{className:"absolute top-0 w-0.5 h-full bg-text-muted/50",style:{left:`${d}%`}}),c.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 w-2.5 h-2.5 bg-white rounded-full shadow-sm pointer-events-none transition-all",style:{left:`calc(${l}% - 5px)`}})]})]})},NQ=({values:r,onChange:e,onReset:t})=>{const[s,i]=v.useState(0),n=bg[s],a=r.hue[s]||0,o=(r.saturation[s]||0)*100,l=(r.luminance[s]||0)*100,d=v.useCallback(m=>{const g=[...r.hue];g[s]=m,e({...r,hue:g})},[r,s,e]),u=v.useCallback(m=>{const g=[...r.saturation];g[s]=m/100,e({...r,saturation:g})},[r,s,e]),h=v.useCallback(m=>{const g=[...r.luminance];g[s]=m/100,e({...r,luminance:g})},[r,s,e]),p=v.useCallback(()=>{const m=[...r.hue],g=[...r.saturation],y=[...r.luminance];m[s]=0,g[s]=0,y[s]=0,e({hue:m,saturation:g,luminance:y})},[r,s,e]),f=v.useMemo(()=>a!==0||o!==0||l!==0,[a,o,l]);return c.jsxs("div",{className:"space-y-3",children:[t&&c.jsx("div",{className:"flex justify-end",children:c.jsxs("button",{onClick:t,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx($i,{size:10}),"Reset All"]})}),c.jsx("div",{className:"flex gap-0.5",children:bg.map(m=>c.jsx(PQ,{color:m,isActive:s===m.index,onClick:()=>i(m.index)},m.key))}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:n.color}}),c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:n.fullLabel})]}),f&&c.jsx("button",{onClick:p,className:"text-[9px] text-text-muted hover:text-text-secondary transition-colors",children:"Reset"})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsx(vg,{label:"Hue",value:a,onChange:d,min:-180,max:180,unit:"",color:n.color}),c.jsx(vg,{label:"Saturation",value:o,onChange:u,min:-100,max:100,unit:"%",color:n.color}),c.jsx(vg,{label:"Luminance",value:l,onChange:h,min:-100,max:100,unit:"%",color:n.color})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("div",{className:"flex gap-1",children:bg.map(m=>{const g=r.hue[m.index]!==0||r.saturation[m.index]!==0||r.luminance[m.index]!==0;return c.jsx("div",{className:`flex-1 h-1 rounded-full transition-all ${g?"opacity-100":"opacity-20"}`,style:{backgroundColor:m.color},title:`${m.fullLabel}${g?" (adjusted)":""}`},m.key)})})})]})},wh=({title:r,defaultOpen:e=!1,children:t})=>{const[s,i]=Ye.useState(e);return c.jsxs("div",{className:"border border-border rounded-lg overflow-hidden",children:[c.jsxs("button",{onClick:()=>i(!s),className:"flex items-center gap-2 w-full p-2 bg-background-tertiary hover:bg-background-tertiary/80 transition-colors",children:[c.jsx(ls,{size:12,className:`transition-transform ${s?"":"-rotate-90"} text-text-muted`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:r})]}),s&&c.jsx("div",{className:"p-3 space-y-3",children:t})]})},RQ=({clipId:r})=>{const{getColorGrading:e,updateColorGrading:t,resetColorGrading:s}=W(),i=W(x=>x.project.modifiedAt),n=v.useMemo(()=>e(r),[r,e,i]),a=v.useMemo(()=>n.colorWheels||{...sy},[n.colorWheels]),o=v.useMemo(()=>n.hsl||{...ry},[n.hsl]),l=v.useMemo(()=>n.curves||{...iy},[n.curves]),d=v.useCallback(x=>{t(r,{colorWheels:x})},[r,t]),u=v.useCallback(()=>{t(r,{colorWheels:{...sy}})},[r,t]),h=v.useCallback(x=>{t(r,{curves:x})},[r,t]),p=v.useCallback(()=>{t(r,{curves:{...iy}})},[r,t]),f=v.useCallback(x=>{t(r,{lut:x||void 0})},[r,t]),m=v.useCallback(x=>{t(r,{hsl:x})},[r,t]),g=v.useCallback(()=>{t(r,{hsl:{...ry}})},[r,t]),y=v.useCallback(()=>{s(r)},[r,s]);return c.jsxs("div",{className:"space-y-3",children:[c.jsx("div",{className:"flex justify-end",children:c.jsxs("button",{onClick:y,className:"flex items-center gap-1 px-2 py-1 text-[10px] text-text-muted hover:text-text-primary transition-colors",children:[c.jsx($i,{size:10}),"Reset All"]})}),c.jsx(wh,{title:"Color Wheels",defaultOpen:!0,children:c.jsx(CQ,{values:a,onChange:d,onReset:u})}),c.jsx(wh,{title:"Curves",children:c.jsx(AQ,{values:l,onChange:h,onReset:p})}),c.jsx(wh,{title:"LUT",children:c.jsx(MQ,{lutData:n.lut,onChange:f})}),c.jsx(wh,{title:"HSL",children:c.jsx(NQ,{values:o,onChange:m,onReset:g})})]})},kh=({label:r,value:e,onChange:t})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:e,onChange:s=>t(s.target.value),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:e})]})]}),Ka=({label:r,value:e,onChange:t,min:s=0,max:i=1e3,step:n=1,unit:a=""})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"number",value:e,onChange:o=>t(parseFloat(o.target.value)||0),min:s,max:i,step:n,className:"w-16 px-2 py-1 text-[10px] font-mono text-text-primary bg-background-tertiary border border-border rounded text-right outline-none focus:border-primary"}),a&&c.jsx("span",{className:"text-[10px] text-text-muted",children:a})]})]}),IQ=({options:r,value:e,onChange:t})=>c.jsx("div",{className:"flex gap-1",children:r.map(s=>c.jsx("button",{onClick:()=>t(s.value),className:`p-1.5 rounded transition-colors ${e===s.value?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,title:s.label,children:s.icon},s.value))}),DQ={Popular:["Inter","Poppins","Montserrat","Roboto","Open Sans","Lato","Outfit","DM Sans"],"Display & Headlines":["Bebas Neue","Anton","Oswald","Teko","Staatliches","Alfa Slab One","Archivo Black","Black Ops One","Titan One","Righteous","Concert One","Fredoka One","Bungee"],"Elegant & Serif":["Playfair Display","Cinzel","Lora","Merriweather","DM Serif Display","Abril Fatface","Roboto Slab","Zilla Slab"],"Modern & Clean":["Lexend","Quicksand","Nunito","Rubik","Work Sans","Raleway","Ubuntu","Space Grotesk","Comfortaa"],"Handwritten & Script":["Pacifico","Lobster","Dancing Script","Great Vibes","Caveat","Sacramento","Satisfy","Yellowtail","Rock Salt","Permanent Marker"],"Fun & Creative":["Bangers","Creepster","Press Start 2P"],Monospace:["Roboto Mono","Space Mono"],System:["Arial","Helvetica","Times New Roman","Georgia","Verdana"]},FQ=({value:r,onChange:e})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Font"}),c.jsxs(jt,{value:r,onValueChange:e,children:[c.jsx(vt,{className:"max-w-[140px] bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border max-h-80",children:Object.entries(DQ).map(([t,s])=>c.jsxs(id,{children:[c.jsx(mc,{className:"text-text-muted text-[10px] font-medium",children:t}),s.map(i=>c.jsx(Ve,{value:i,style:{fontFamily:i},children:i},i))]},t))})]})]}),BQ=({clipId:r})=>{const{getTextClip:e,updateTextContent:t,updateTextStyle:s,updateTextTransform:i,project:n}=W(),a=v.useMemo(()=>e(r),[r,e,n.modifiedAt]),o={fontFamily:"Inter",fontSize:48,fontWeight:"normal",fontStyle:"normal",color:"#ffffff",backgroundColor:"transparent",textAlign:"center",verticalAlign:"middle",lineHeight:1.2,letterSpacing:0,textDecoration:"none",strokeColor:"#000000",strokeWidth:0,shadowColor:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0},l=a?.style||o,d=a?.text||"",u=v.useCallback(g=>{t(r,g)},[r,t]),h=v.useCallback(async g=>{if(g.fontFamily)try{const y=l.fontSize||48;await document.fonts.load(`${y}px "${g.fontFamily}"`)}catch{}s(r,g)},[r,s,l.fontSize]),p=v.useCallback(()=>{const g=a?.transform?.position?.y??.5;i(r,{position:{x:.5,y:g}})},[r,a,i]),f=v.useCallback(()=>{const g=a?.transform?.position?.x??.5;i(r,{position:{x:g,y:.5}})},[r,a,i]),m=v.useCallback(()=>{i(r,{position:{x:.5,y:.5}})},[r,i]);return a?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Text Content"}),c.jsx("textarea",{value:d,onChange:g=>u(g.target.value),placeholder:"Enter text...",className:"w-full h-20 px-3 py-2 text-sm text-text-primary bg-background-tertiary border border-border rounded-lg resize-none outline-none focus:border-primary",style:{fontFamily:l.fontFamily}})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx(FQ,{value:l.fontFamily,onChange:g=>h({fontFamily:g})}),c.jsx(Ka,{label:"Size",value:l.fontSize,onChange:g=>h({fontSize:g}),min:8,max:500,unit:"px"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Style"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:()=>h({fontWeight:l.fontWeight==="bold"?"normal":"bold"}),className:`p-1.5 rounded transition-colors ${l.fontWeight==="bold"?"bg-primary text-white":"bg-background-secondary border border-border text-text-secondary hover:text-text-primary"}`,title:"Bold",children:c.jsx(GB,{size:12})}),c.jsx("button",{onClick:()=>h({fontStyle:l.fontStyle==="italic"?"normal":"italic"}),className:`p-1.5 rounded transition-colors ${l.fontStyle==="italic"?"bg-primary text-white":"bg-background-secondary border border-border text-text-secondary hover:text-text-primary"}`,title:"Italic",children:c.jsx(tO,{size:12})}),c.jsx("button",{onClick:()=>h({textDecoration:l.textDecoration==="underline"?"none":"underline"}),className:`p-1.5 rounded transition-colors ${l.textDecoration==="underline"?"bg-primary text-white":"bg-background-secondary border border-border text-text-secondary hover:text-text-primary"}`,title:"Underline",children:c.jsx(C$,{size:12})})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Text Align"}),c.jsx(IQ,{options:[{value:"left",icon:c.jsx(m$,{size:12}),label:"Left"},{value:"center",icon:c.jsx(u$,{size:12}),label:"Center"},{value:"right",icon:c.jsx(p$,{size:12}),label:"Right"}],value:l.textAlign,onChange:g=>h({textAlign:g})})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Position on Canvas"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-muted",children:"Align to Canvas"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:p,className:"p-1.5 rounded bg-background-secondary border border-border text-text-secondary hover:text-text-primary transition-colors",title:"Center Horizontally",children:c.jsx(MB,{size:12})}),c.jsx("button",{onClick:f,className:"p-1.5 rounded bg-background-secondary border border-border text-text-secondary hover:text-text-primary transition-colors",title:"Center Vertically",children:c.jsx(NB,{size:12})}),c.jsx("button",{onClick:m,className:"p-1.5 rounded bg-primary text-white transition-colors",title:"Center Both",children:c.jsx(wL,{size:12})})]})]})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx(kh,{label:"Text Color",value:l.color,onChange:g=>h({color:g})}),c.jsx(kh,{label:"Background",value:l.backgroundColor||"transparent",onChange:g=>h({backgroundColor:g})})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Stroke"}),c.jsx(kh,{label:"Color",value:l.strokeColor||"#000000",onChange:g=>h({strokeColor:g})}),c.jsx(Ka,{label:"Width",value:l.strokeWidth||0,onChange:g=>h({strokeWidth:g}),min:0,max:20,unit:"px"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Shadow"}),c.jsx(kh,{label:"Color",value:l.shadowColor||"#000000",onChange:g=>h({shadowColor:g})}),c.jsx(Ka,{label:"Offset X",value:l.shadowOffsetX||0,onChange:g=>h({shadowOffsetX:g}),min:-50,max:50,unit:"px"}),c.jsx(Ka,{label:"Offset Y",value:l.shadowOffsetY||0,onChange:g=>h({shadowOffsetY:g}),min:-50,max:50,unit:"px"}),c.jsx(Ka,{label:"Blur",value:l.shadowBlur||0,onChange:g=>h({shadowBlur:g}),min:0,max:50,unit:"px"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx(Ka,{label:"Line Height",value:l.lineHeight||1.2,onChange:g=>h({lineHeight:g}),min:.5,max:3,step:.1}),c.jsx(Ka,{label:"Letter Spacing",value:l.letterSpacing||0,onChange:g=>h({letterSpacing:g}),min:-10,max:50,unit:"px"})]})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(Os,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No text clip selected"})]})},O2=[{value:"none",label:"None",description:"No animation"},{value:"typewriter",label:"Typewriter",description:"Characters appear one by one"},{value:"fade",label:"Fade",description:"Fade in and out"},{value:"slide-left",label:"Slide Left",description:"Slide in from the right"},{value:"slide-right",label:"Slide Right",description:"Slide in from the left"},{value:"slide-up",label:"Slide Up",description:"Slide in from below"},{value:"slide-down",label:"Slide Down",description:"Slide in from above"},{value:"scale",label:"Scale",description:"Scale up from small"},{value:"bounce",label:"Bounce",description:"Bouncy entrance"},{value:"rotate",label:"Rotate",description:"Rotate into view"},{value:"wave",label:"Wave",description:"Characters wave up and down"},{value:"shake",label:"Shake",description:"Vibrating text effect"},{value:"pop",label:"Pop",description:"Poppy entrance with overshoot"},{value:"glitch",label:"Glitch",description:"Digital glitch effect"},{value:"split",label:"Split",description:"Text splits from center"},{value:"flip",label:"Flip",description:"3D flip animation"},{value:"word-by-word",label:"Word by Word",description:"Words appear sequentially"},{value:"rainbow",label:"Rainbow",description:"Color cycles through spectrum"}],Vs=ht,LQ=({value:r,onChange:e})=>c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Animation Preset"}),c.jsxs(jt,{value:r,onValueChange:t=>e(t),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border max-h-60",children:O2.map(t=>c.jsx(Ve,{value:t.value,children:t.label},t.value))})]}),c.jsx("p",{className:"text-[9px] text-text-muted",children:O2.find(t=>t.value===r)?.description})]}),OQ=({value:r,onChange:e})=>{const t=[{value:"linear",label:"Linear"},{value:"ease-in",label:"Ease In"},{value:"ease-out",label:"Ease Out"},{value:"ease-in-out",label:"Ease In Out"}];return c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Easing"}),c.jsxs(jt,{value:r,onValueChange:e,children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:t.map(s=>c.jsx(Ve,{value:s.value,children:s.label},s.value))})]})]})},$Q=({clipId:r})=>{const e=W(p=>p.getTextClip),t=W(p=>p.applyTextAnimationPreset);W(p=>p.project);const s=e(r),i=s?.animation?.preset||"none",n=s?.animation?.inDuration??.5,a=s?.animation?.outDuration??.5,o=s?.animation?.params?.easing??"ease-out",l=v.useCallback(p=>{t(r,p,n,a)},[r,t,n,a]),d=v.useCallback(p=>{t(r,i,p,a)},[r,t,i,a]),u=v.useCallback(p=>{t(r,i,n,p)},[r,t,i,n]),h=v.useCallback(p=>{t(r,i,n,a,{easing:p})},[r,t,i,n,a]);return s?c.jsxs("div",{className:"space-y-4",children:[c.jsx(LQ,{value:i,onChange:l}),i!=="none"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-3 p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(ui,{size:12,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Timing"})]}),c.jsx(Vs,{label:"In Duration",value:n,onChange:d,min:0,max:5,step:.1,unit:"s"}),c.jsx(Vs,{label:"Out Duration",value:a,onChange:u,min:0,max:5,step:.1,unit:"s"})]}),c.jsx("div",{className:"p-3 bg-background-tertiary rounded-lg",children:c.jsx(OQ,{value:o,onChange:h})}),c.jsxs("div",{className:"p-3 bg-background-secondary rounded-lg border border-border",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx(ti,{size:12,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Preview"})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:["Animation will play during preview and export. Total animation time: ",(n+a).toFixed(1),"s"]})]})]}),i==="fade"&&c.jsx(zQ,{clipId:r,animation:s.animation}),(i==="slide-left"||i==="slide-right"||i==="slide-up"||i==="slide-down")&&c.jsx(VQ,{clipId:r,animation:s.animation}),i==="scale"&&c.jsx(UQ,{clipId:r,animation:s.animation}),i==="bounce"&&c.jsx(GQ,{clipId:r,animation:s.animation}),i==="rotate"&&c.jsx(WQ,{clipId:r,animation:s.animation}),i==="wave"&&c.jsx(YQ,{clipId:r,animation:s.animation}),i==="shake"&&c.jsx(qQ,{clipId:r,animation:s.animation}),i==="pop"&&c.jsx(HQ,{clipId:r,animation:s.animation}),i==="glitch"&&c.jsx(XQ,{clipId:r,animation:s.animation})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(Os,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No text clip selected"})]})},zQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.fadeOpacity?.start??0,a=e?.params?.fadeOpacity?.end??1,o=(l,d)=>{i?.animation&&t(r,"fade",i.animation.inDuration,i.animation.outDuration,{fadeOpacity:{start:l,end:d}})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Fade Settings"}),c.jsx(Vs,{label:"Start Opacity",value:n,onChange:l=>o(l,a),min:0,max:1,step:.1,unit:""}),c.jsx(Vs,{label:"End Opacity",value:a,onChange:l=>o(n,l),min:0,max:1,step:.1,unit:""})]})},VQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.slideDistance??.2,a=o=>{i?.animation&&t(r,i.animation.preset,i.animation.inDuration,i.animation.outDuration,{slideDistance:o})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Slide Settings"}),c.jsx(Vs,{label:"Distance",value:n,onChange:a,min:.05,max:1,step:.05,unit:""})]})},UQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.scaleFrom??0,a=e?.params?.scaleTo??1,o=(l,d)=>{i?.animation&&t(r,"scale",i.animation.inDuration,i.animation.outDuration,{scaleFrom:l,scaleTo:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Scale Settings"}),c.jsx(Vs,{label:"Scale From",value:n,onChange:l=>o(l,a),min:0,max:2,step:.1,unit:"x"}),c.jsx(Vs,{label:"Scale To",value:a,onChange:l=>o(n,l),min:0,max:2,step:.1,unit:"x"})]})},GQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.bounceHeight??.1,a=e?.params?.bounceCount??3,o=(l,d)=>{i?.animation&&t(r,"bounce",i.animation.inDuration,i.animation.outDuration,{bounceHeight:l,bounceCount:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Bounce Settings"}),c.jsx(Vs,{label:"Height",value:n,onChange:l=>o(l,a),min:.01,max:.5,step:.01,unit:""}),c.jsx(Vs,{label:"Bounces",value:a,onChange:l=>o(n,Math.round(l)),min:1,max:10,step:1,unit:""})]})},WQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.rotateAngle??360,a=o=>{i?.animation&&t(r,"rotate",i.animation.inDuration,i.animation.outDuration,{rotateAngle:o})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Rotate Settings"}),c.jsx(Vs,{label:"Angle",value:n,onChange:a,min:-720,max:720,step:15,unit:""})]})},YQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.waveAmplitude??.02,a=e?.params?.waveFrequency??2,o=(l,d)=>{i?.animation&&t(r,"wave",i.animation.inDuration,i.animation.outDuration,{waveAmplitude:l,waveFrequency:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Wave Settings"}),c.jsx(Vs,{label:"Amplitude",value:n,onChange:l=>o(l,a),min:.005,max:.1,step:.005,unit:""}),c.jsx(Vs,{label:"Frequency",value:a,onChange:l=>o(n,l),min:.5,max:5,step:.5,unit:""})]})},qQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.shakeIntensity??.01,a=e?.params?.shakeSpeed??20,o=(l,d)=>{i?.animation&&t(r,"shake",i.animation.inDuration,i.animation.outDuration,{shakeIntensity:l,shakeSpeed:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Shake Settings"}),c.jsx(Vs,{label:"Intensity",value:n,onChange:l=>o(l,a),min:.001,max:.05,step:.001,unit:""}),c.jsx(Vs,{label:"Speed",value:a,onChange:l=>o(n,l),min:5,max:50,step:5,unit:""})]})},HQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.popOvershoot??1.2,a=o=>{i?.animation&&t(r,"pop",i.animation.inDuration,i.animation.outDuration,{popOvershoot:o})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Pop Settings"}),c.jsx(Vs,{label:"Overshoot",value:n,onChange:a,min:1,max:2,step:.05,unit:"x"})]})},XQ=({clipId:r,animation:e})=>{const{applyTextAnimationPreset:t,getTextClip:s}=W(),i=s(r),n=e?.params?.glitchIntensity??.02,a=e?.params?.glitchSpeed??10,o=(l,d)=>{i?.animation&&t(r,"glitch",i.animation.inDuration,i.animation.outDuration,{glitchIntensity:l,glitchSpeed:d})};return c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Glitch Settings"}),c.jsx(Vs,{label:"Intensity",value:n,onChange:l=>o(l,a),min:.005,max:.1,step:.005,unit:""}),c.jsx(Vs,{label:"Speed",value:a,onChange:l=>o(n,l),min:1,max:30,step:1,unit:""})]})},$2={isProcessing:!1,progress:null,beatAnalysis:null,selectedAudioClipId:null,selectedTrackIds:[],clipsToSync:[],previewTimings:[],config:LY,error:null};let KQ=class{state={...$2};listeners=new Set;audioContext=null;subscribe(e){return this.listeners.add(e),e(this.state),()=>this.listeners.delete(e)}setState(e){this.state={...this.state,...e},this.listeners.forEach(t=>t(this.state))}getState(){return this.state}setSelectedAudioClip(e){this.setState({selectedAudioClipId:e,beatAnalysis:null,previewTimings:[],error:null})}setSelectedTracks(e){this.setState({selectedTrackIds:e}),this.updateClipsToSync(),this.updatePreview()}toggleTrackSelection(e){const{selectedTrackIds:t}=this.state,s=t.includes(e)?t.filter(i=>i!==e):[...t,e];this.setSelectedTracks(s)}updateConfig(e){this.setState({config:{...this.state.config,...e}}),this.updatePreview()}updateClipsToSync(){const{selectedTrackIds:e}=this.state,t=W.getState(),{project:s}=t,i=[];for(const n of s.timeline.tracks)if(e.includes(n.id))for(const a of n.clips)i.push({id:a.id,startTime:a.startTime,duration:a.duration,trackId:n.id});this.setState({clipsToSync:i})}updatePreview(){const{beatAnalysis:e,clipsToSync:t,config:s,selectedAudioClipId:i}=this.state;if(!e||t.length===0){this.setState({previewTimings:[]});return}const n=W.getState(),o=(i?n.getClip(i):null)?.startTime??0,d=TC().calculateSyncedTimings(t,e,o,s);this.setState({previewTimings:d})}async analyzeBeats(){const{selectedAudioClipId:e}=this.state;if(!e){this.setState({error:"No audio clip selected"});return}const t=W.getState(),s=t.getClip(e);if(!s){this.setState({error:"Clip not found"});return}const i=t.getMediaItem(s.mediaId);if(!i?.blob){this.setState({error:"Media blob not found"});return}this.setState({isProcessing:!0,error:null});try{const n=await this.extractAudioFromBlob(i.blob,s.inPoint??0,s.outPoint??s.duration),o=await TC().analyzeBeats(n,l=>this.setState({progress:l}));this.setState({beatAnalysis:o,isProcessing:!1,progress:null}),this.updatePreview()}catch(n){this.setState({isProcessing:!1,error:n instanceof Error?n.message:"Beat analysis failed",progress:null})}}async applySync(){const{previewTimings:e}=this.state;if(e.length===0)return this.setState({error:"No clips to sync"}),!1;const t=W.getState();this.setState({isProcessing:!0,error:null});try{for(const s of e){await t.moveClip(s.clipId,s.newStartTime);const i=t.getClip(s.clipId);if(i&&this.state.config.syncMode!=="preserve-duration"){const n=(i.inPoint??0)+s.newDuration;await t.trimClip(s.clipId,i.inPoint,n)}}return this.setState({isProcessing:!1,progress:{phase:"complete",percent:100,message:`Synced ${e.length} clips to beats`}}),!0}catch(s){return this.setState({isProcessing:!1,error:s instanceof Error?s.message:"Failed to apply sync"}),!1}}getAvailableTracks(){const e=W.getState(),{project:t}=e,{selectedAudioClipId:s}=this.state,n=(s?e.getClip(s):null)?t.timeline.tracks.find(a=>a.clips.some(o=>o.id===s))?.id:null;return t.timeline.tracks.filter(a=>a.id!==n&&a.clips.length>0).map(a=>({id:a.id,name:a.name,type:a.type,clipCount:a.clips.length}))}async extractAudioFromBlob(e,t,s){this.audioContext||(this.audioContext=new AudioContext);const i=await e.arrayBuffer(),n=await this.audioContext.decodeAudioData(i),a=Math.min(s-t,n.duration-t),o=n.sampleRate,l=Math.floor(t*o),d=Math.floor(a*o),u=new OfflineAudioContext(1,d,o),h=u.createBuffer(1,d,o),p=h.getChannelData(0),f=n.getChannelData(0);for(let y=0;y<d;y++)p[y]=f[l+y]||0;const m=u.createBufferSource();m.buffer=h,m.connect(u.destination),m.start(0);const g=await u.startRendering();return this.audioBufferToWav(g)}audioBufferToWav(e){const t=e.numberOfChannels,s=e.sampleRate,i=1,n=16,a=n/8,o=t*a,l=s*o,d=e.length*o,h=44+d,p=new ArrayBuffer(h),f=new DataView(p),m=(x,b)=>{for(let w=0;w<b.length;w++)f.setUint8(x+w,b.charCodeAt(w))};m(0,"RIFF"),f.setUint32(4,h-8,!0),m(8,"WAVE"),m(12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,i,!0),f.setUint16(22,t,!0),f.setUint32(24,s,!0),f.setUint32(28,l,!0),f.setUint16(32,o,!0),f.setUint16(34,n,!0),m(36,"data"),f.setUint32(40,d,!0);const g=e.getChannelData(0);let y=44;for(let x=0;x<e.length;x++){const b=Math.max(-1,Math.min(1,g[x])),w=b<0?b*32768:b*32767;f.setInt16(y,w,!0),y+=2}return new Blob([p],{type:"audio/wav"})}reset(){this.setState({...$2})}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.listeners.clear()}},wg=null;function QQ(){return wg||(wg=new KQ),wg}const JQ={video:c.jsx(Uc,{size:12}),image:c.jsx(Eo,{size:12}),text:c.jsx(Os,{size:12}),graphics:c.jsx(Os,{size:12})},ZQ=({clipId:r})=>{const[e,t]=v.useState(null),[s,i]=v.useState(!1),n=v.useMemo(()=>QQ(),[]);v.useEffect(()=>{const w=n.subscribe(t);return n.setSelectedAudioClip(r),w},[n,r]);const a=v.useMemo(()=>n.getAvailableTracks(),[n,e?.beatAnalysis]),o=v.useCallback(()=>{n.analyzeBeats()},[n]),l=v.useCallback(w=>{n.toggleTrackSelection(w)},[n]),d=v.useCallback(async()=>{await n.applySync()},[n]),u=v.useCallback(w=>{n.updateConfig(w)},[n]);if(!e)return c.jsx("div",{className:"p-4 flex items-center justify-center",children:c.jsx(Ci,{size:20,className:"animate-spin text-primary"})});const{isProcessing:h,progress:p,beatAnalysis:f,selectedTrackIds:m,clipsToSync:g,previewTimings:y,config:x,error:b}=e;return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center gap-2 text-text-secondary",children:[c.jsx(Gr,{size:14}),c.jsx("span",{className:"text-[10px]",children:"Sync clips to the beat of this audio"})]}),b&&c.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-500/10 border border-red-500/30 rounded-lg",children:[c.jsx(To,{size:14,className:"text-red-400 shrink-0"}),c.jsx("span",{className:"text-[10px] text-red-400",children:b})]}),f?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between p-3 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] text-text-secondary block",children:"BPM Detected"}),c.jsx("span",{className:"text-lg font-bold text-primary",children:f.bpm})]}),c.jsxs("div",{className:"text-right",children:[c.jsx("span",{className:"text-[10px] text-text-secondary block",children:"Beats"}),c.jsx("span",{className:"text-sm font-medium text-text-primary",children:f.beats.length})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary block",children:"Select tracks to sync to beats:"}),a.length===0?c.jsx("p",{className:"text-[10px] text-text-muted p-3 bg-background-tertiary rounded-lg",children:"No other tracks with clips found. Add clips to other tracks first."}):c.jsx("div",{className:"space-y-1",children:a.map(w=>c.jsxs("button",{onClick:()=>l(w.id),className:`w-full flex items-center justify-between p-2 rounded-lg text-left transition-colors ${m.includes(w.id)?"bg-primary/20 border border-primary/50":"bg-background-tertiary border border-transparent hover:border-border"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[JQ[w.type]||c.jsx(Uc,{size:12}),c.jsx("span",{className:"text-[11px] text-text-primary",children:w.name})]}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[w.clipCount," ",w.clipCount===1?"clip":"clips"]})]},w.id))})]}),g.length>0&&c.jsx("div",{className:"p-2 bg-background-tertiary rounded-lg",children:c.jsxs("span",{className:"text-[9px] text-text-muted",children:[g.length," clips will be synced to ",f.beats.length," beats"]})}),c.jsxs("div",{className:"border-t border-border pt-3",children:[c.jsxs("button",{onClick:()=>i(!s),className:"flex items-center gap-2 text-[10px] text-text-secondary hover:text-text-primary mb-3",children:[c.jsx(e_,{size:12}),"Sync Settings"]}),s&&c.jsxs("div",{className:"space-y-3 p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] text-text-secondary block mb-2",children:"Sync Mode"}),c.jsx("div",{className:"space-y-1",children:[{value:"smart",label:"Smart",desc:"Adjust duration to fit nearest beat count"},{value:"one-per-beat",label:"One per Beat",desc:"Each clip gets exactly one beat"},{value:"preserve-duration",label:"Preserve Duration",desc:"Keep original duration, snap start to beat"}].map(w=>c.jsxs("button",{onClick:()=>u({syncMode:w.value}),className:`w-full text-left p-2 rounded transition-colors ${x.syncMode===w.value?"bg-primary/20 border border-primary/50":"bg-background-secondary border border-transparent hover:border-border"}`,children:[c.jsx("span",{className:"text-[10px] text-text-primary block",children:w.label}),c.jsx("span",{className:"text-[9px] text-text-muted",children:w.desc})]},w.value))})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Beat Subdivision"}),c.jsx("div",{className:"flex gap-1",children:[1,2,4].map(w=>c.jsxs("button",{onClick:()=>u({beatSubdivision:w}),className:`px-2 py-1 text-[9px] rounded transition-colors ${x.beatSubdivision===w?"bg-primary text-black":"bg-background-secondary text-text-secondary hover:text-text-primary"}`,children:["1/",w]},w))})]}),c.jsx(ht,{label:"Offset",value:x.offsetMs,onChange:w=>u({offsetMs:w}),min:-500,max:500,step:10,unit:"ms"}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Downbeats Only"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:()=>u({snapToDownbeats:!1}),className:`px-2 py-1 text-[9px] rounded transition-colors ${x.snapToDownbeats?"bg-background-secondary text-text-secondary":"bg-primary text-black"}`,children:"All Beats"}),c.jsx("button",{onClick:()=>u({snapToDownbeats:!0}),className:`px-2 py-1 text-[9px] rounded transition-colors ${x.snapToDownbeats?"bg-primary text-black":"bg-background-secondary text-text-secondary"}`,children:"Downbeats"})]})]})]})]}),y.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"Preview:"}),c.jsxs("div",{className:"max-h-24 overflow-y-auto bg-background-tertiary rounded-lg p-2 space-y-1",children:[y.slice(0,5).map((w,C)=>c.jsxs("div",{className:"flex items-center justify-between text-[9px]",children:[c.jsxs("span",{className:"text-text-muted",children:["Clip ",C+1]}),c.jsxs("span",{className:"text-text-primary",children:[w.originalStartTime.toFixed(2),"s  ",w.newStartTime.toFixed(2),"s"]})]},w.clipId)),y.length>5&&c.jsxs("span",{className:"text-[9px] text-text-muted",children:["...and ",y.length-5," more"]})]})]}),p?.phase==="complete"&&c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 rounded-lg border border-green-500/30",children:[c.jsx(Ei,{size:14,className:"text-green-400"}),c.jsx("span",{className:"text-[10px] text-green-400",children:p.message})]}),c.jsx(Et,{onClick:d,disabled:h||y.length===0,className:"w-full bg-primary hover:bg-primary/80 text-black disabled:opacity-50",children:h?c.jsxs(c.Fragment,{children:[c.jsx(Ci,{size:14,className:"mr-2 animate-spin"}),"Syncing..."]}):`Sync ${y.length} Clips to Beats`}),c.jsx(Et,{onClick:o,variant:"outline",className:"w-full",children:"Re-analyze Beats"})]}):c.jsx("div",{className:"space-y-3",children:h&&p?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ci,{size:12,className:"animate-spin text-primary"}),c.jsx("span",{className:"text-[10px] text-text-primary",children:p.message})]}),c.jsx("div",{className:"h-1.5 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${p.percent}%`}})})]}):c.jsxs(Et,{onClick:o,className:"w-full bg-primary/20 hover:bg-primary/30 text-primary border border-primary/30",children:[c.jsx(Gr,{size:14,className:"mr-2"}),"Detect Beats"]})})]})},kg=({label:r,value:e,onChange:t})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:e,onChange:s=>t(s.target.value),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:e})]})]}),Cg=({label:r,value:e,onChange:t,min:s=0,max:i=1e3,step:n=1,unit:a=""})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("input",{type:"number",value:e,onChange:o=>t(parseFloat(o.target.value)||0),min:s,max:i,step:n,className:"w-16 px-2 py-1 text-[10px] font-mono text-text-primary bg-background-tertiary border border-border rounded text-right outline-none focus:border-primary"}),a&&c.jsx("span",{className:"text-[10px] text-text-muted",children:a})]})]}),eJ=({value:r,onChange:e})=>{const t=[{value:void 0,label:"Solid",preview:""},{value:[5,5],label:"Dashed",preview:"- - -"},{value:[2,2],label:"Dotted",preview:"  "}];return c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Style"}),c.jsx("div",{className:"flex gap-1",children:t.map((s,i)=>c.jsx("button",{onClick:()=>e(s.value),className:`px-2 py-1 text-[9px] rounded transition-colors ${s.value===void 0&&r===void 0||s.value&&r&&s.value[0]===r[0]?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,title:s.label,children:s.preview},i))})]})},tJ=({shapeType:r})=>{const e={rectangle:c.jsx(is,{size:16}),circle:c.jsx(Vr,{size:16}),ellipse:c.jsx(Vr,{size:16}),triangle:c.jsx(s_,{size:16}),star:c.jsx(fa,{size:16}),polygon:c.jsx(Hj,{size:16}),arrow:c.jsx(na,{size:16})};return c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx("div",{className:"p-1.5 bg-background-secondary rounded",children:e[r]||c.jsx(is,{size:16})}),c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary capitalize",children:r}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Shape clip"})]})]})},sJ=({clipId:r})=>{const{getShapeClip:e,updateShapeStyle:t,project:s}=W(),i=v.useMemo(()=>e(r),[r,e,s.modifiedAt]),o={fill:{type:"solid",color:"#3b82f6",opacity:1},stroke:{color:"#1d4ed8",width:2,opacity:1}},l=i?.style||o,d=i?.shapeType||"rectangle",u=v.useCallback(h=>{t(r,h)},[r,t]);return i?c.jsxs("div",{className:"space-y-4",children:[c.jsx(tJ,{shapeType:d}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Fill"}),c.jsx(kg,{label:"Color",value:l.fill?.color||"#3b82f6",onChange:h=>u({fill:{...l.fill,color:h,type:"solid",opacity:l.fill?.opacity||1}})}),c.jsx(ht,{label:"Opacity",value:(l.fill?.opacity||1)*100,onChange:h=>u({fill:{...l.fill,opacity:h/100,type:l.fill?.type||"solid"}}),min:0,max:100,unit:"%"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Stroke"}),c.jsx(kg,{label:"Color",value:l.stroke?.color||"#1d4ed8",onChange:h=>u({stroke:{...l.stroke,color:h,width:l.stroke?.width||2,opacity:l.stroke?.opacity||1}})}),c.jsx(Cg,{label:"Width",value:l.stroke?.width||0,onChange:h=>u({stroke:{...l.stroke,width:h,color:l.stroke?.color||"#1d4ed8",opacity:l.stroke?.opacity||1}}),min:0,max:50,unit:"px"}),c.jsx(eJ,{value:l.stroke?.dashArray,onChange:h=>u({stroke:{...l.stroke,dashArray:h,color:l.stroke?.color||"#1d4ed8",width:l.stroke?.width||2,opacity:l.stroke?.opacity||1}})})]}),d==="rectangle"&&c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Corners"}),c.jsx(ht,{label:"Radius",value:l.cornerRadius||0,onChange:h=>u({cornerRadius:h}),min:0,max:100,unit:"px"})]}),c.jsxs("div",{className:"space-y-2 p-3 bg-background-tertiary rounded-lg",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Shadow"}),c.jsx(kg,{label:"Color",value:l.shadow?.color||"#000000",onChange:h=>u({shadow:{color:h,offsetX:l.shadow?.offsetX||0,offsetY:l.shadow?.offsetY||0,blur:l.shadow?.blur||0}})}),c.jsx(Cg,{label:"Offset X",value:l.shadow?.offsetX||0,onChange:h=>u({shadow:{offsetX:h,color:l.shadow?.color||"#000000",offsetY:l.shadow?.offsetY||0,blur:l.shadow?.blur||0}}),min:-50,max:50,unit:"px"}),c.jsx(Cg,{label:"Offset Y",value:l.shadow?.offsetY||0,onChange:h=>u({shadow:{offsetY:h,color:l.shadow?.color||"#000000",offsetX:l.shadow?.offsetX||0,blur:l.shadow?.blur||0}}),min:-50,max:50,unit:"px"}),c.jsx(ht,{label:"Blur",value:l.shadow?.blur||0,onChange:h=>u({shadow:{blur:h,color:l.shadow?.color||"#000000",offsetX:l.shadow?.offsetX||0,offsetY:l.shadow?.offsetY||0}}),min:0,max:50,unit:"px"})]})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(is,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"No shape clip selected"})]})},iJ=({label:r,value:e,onChange:t})=>c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:r}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:e,onChange:s=>t(s.target.value),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:e})]})]}),z2=VY.map(r=>({value:r.id,label:r.name,description:r.description})),rJ=({clipId:r})=>{const{getSVGClipById:e,updateSVGClip:t,project:s}=W(),i=v.useMemo(()=>e(r),[r,e,s.modifiedAt]),n=i?.colorStyle||{colorMode:"none",tintColor:"#ffffff",tintOpacity:1},a=i?.entryAnimation,o=i?.exitAnimation,l=v.useCallback(g=>{if(!i){console.warn(`[SVGSection] No SVG clip found for ${r}`);return}const y={...n,colorMode:g};t(r,{colorStyle:y})},[r,i,n,t]),d=v.useCallback(g=>{i&&t(r,{colorStyle:{...n,tintColor:g}})},[r,i,n,t]),u=v.useCallback(g=>{i&&t(r,{colorStyle:{...n,tintOpacity:g}})},[r,i,n,t]),h=v.useCallback(g=>{if(!i){console.warn(`[SVGSection] No SVG clip found for ${r}`);return}const y={type:g,duration:a?.duration||.5,easing:a?.easing||"ease-out"};t(r,{entryAnimation:y})},[r,i,a,t]),p=v.useCallback(g=>{if(!i)return;const y={type:g,duration:o?.duration||.5,easing:o?.easing||"ease-out"};t(r,{exitAnimation:y})},[r,i,o,t]),f=v.useCallback(g=>{!i||!a||t(r,{entryAnimation:{...a,duration:g}})},[r,i,a,t]),m=v.useCallback(g=>{!i||!o||t(r,{exitAnimation:{...o,duration:g}})},[r,i,o,t]);return i?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Mode"}),c.jsx("div",{className:"flex gap-1",children:["none","tint","replace"].map(g=>c.jsx("button",{onClick:()=>l(g),className:`px-2 py-1 text-[9px] rounded capitalize transition-colors ${n.colorMode===g?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:g},g))})]}),n.colorMode!=="none"&&c.jsxs(c.Fragment,{children:[c.jsx(iJ,{label:"Color",value:n.tintColor||"#ffffff",onChange:d}),c.jsx(ht,{label:"Opacity",value:n.tintOpacity||1,onChange:u,min:0,max:1,step:.1})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Entry Animation"}),c.jsxs(jt,{value:a?.type||"none",onValueChange:g=>h(g),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:z2.map(g=>c.jsx(Ve,{value:g.value,children:g.label},g.value))})]}),a&&a.type!=="none"&&c.jsx(ht,{label:"Duration",value:a.duration,onChange:f,min:.1,max:3,step:.1})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Exit Animation"}),c.jsxs(jt,{value:o?.type||"none",onValueChange:g=>p(g),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:z2.map(g=>c.jsx(Ve,{value:g.value,children:g.label},g.value))})]}),o&&o.type!=="none"&&c.jsx(ht,{label:"Duration",value:o.duration,onChange:m,min:.1,max:3,step:.1})]})]}):c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No SVG clip selected"})};class nJ{playbackController=null;unsubscribeTimelineStore=null;unsubscribePlaybackEvents=null;initialized=!1;isUpdatingProject=!1;async initialize(){if(this.initialized)return;const e=fe.getState();if(!e.initialized)throw new Error("EngineStore must be initialized before PlaybackBridge");if(this.playbackController=e.playbackController,!this.playbackController)throw new Error("PlaybackController not available in EngineStore");const t=W.getState();this.playbackController.setProject(t.project),this.setupPlaybackEventSubscriptions(),this.setupProjectSubscription(),this.initialized=!0}setupPlaybackEventSubscriptions(){if(!this.playbackController)return;const e=t=>{const s=$t.getState();switch(t.type){case"timeupdate":this.playbackController?.getIsScrubbing()||s.setPlayheadPosition(t.time);break;case"statechange":this.syncPlaybackState(t.state);break;case"ended":s.pause();break;case"framerendered":t.frame&&fe.setState({currentFrame:t.frame});break}};this.playbackController.addEventListener("timeupdate",e),this.playbackController.addEventListener("statechange",e),this.playbackController.addEventListener("ended",e),this.playbackController.addEventListener("framerendered",e),this.unsubscribePlaybackEvents=()=>{this.playbackController?.removeEventListener("timeupdate",e),this.playbackController?.removeEventListener("statechange",e),this.playbackController?.removeEventListener("ended",e),this.playbackController?.removeEventListener("framerendered",e)}}setupProjectSubscription(){this.unsubscribeTimelineStore=W.subscribe(e=>e.project,e=>{if(this.playbackController){const t=$t.getState(),s=t.playheadPosition,i=t.playbackState==="playing";this.isUpdatingProject=!0,this.playbackController.setProject(e),this.isUpdatingProject=!1,this.playbackController.scrubTo(s),i&&this.playbackController.play()}})}syncPlaybackState(e){if(this.isUpdatingProject||this.playbackController?.getIsScrubbing())return;const t=$t.getState(),s=t.playbackState,i=e==="seeking"?"paused":e;if(s!==i)switch(i){case"playing":t.play();break;case"paused":t.pause();break;case"stopped":t.stop();break}}isReady(){return this.initialized&&this.playbackController!==null}async play(){this.playbackController&&await this.playbackController.play(),$t.getState().play()}pause(){this.playbackController&&this.playbackController.pause(),$t.getState().pause()}stop(){this.playbackController&&this.playbackController.stop(),$t.getState().stop()}async togglePlayback(){this.playbackController?await this.playbackController.togglePlayback():$t.getState().togglePlayback()}async seek(e){this.playbackController&&await this.playbackController.seek(e),$t.getState().seekTo(e)}startScrubbing(){this.playbackController&&this.playbackController.startScrubbing(),$t.getState().startScrubbing($t.getState().playheadPosition)}async scrubTo(e){this.playbackController&&await this.playbackController.scrubTo(e),$t.getState().updateScrubPosition(e)}endScrubbing(){this.playbackController&&this.playbackController.endScrubbing(),$t.getState().endScrubbing()}setPlaybackRate(e){this.playbackController&&this.playbackController.setPlaybackRate(e),$t.getState().setPlaybackRate(e)}isTrackAudible(e,t){return!(e.muted||t&&!e.solo)}getTrackAudibility(e){const t=e.some(s=>s.solo);return e.map(s=>({trackId:s.id,isAudible:this.isTrackAudible(s,t),isMuted:s.muted,isSolo:s.solo}))}getAudibleTrackIds(){const t=W.getState().project.timeline.tracks,s=this.getTrackAudibility(t),i=new Set;for(const n of s)n.isAudible&&i.add(n.trackId);return i}hasSoloTracks(){return W.getState().project.timeline.tracks.some(s=>s.solo)}getState(){return $t.getState().playbackState}getCurrentTime(){return this.playbackController?this.playbackController.getCurrentTime():$t.getState().playheadPosition}isPlaying(){return this.playbackController?.isPlaying()??!1}isScrubbing(){return this.playbackController?.getIsScrubbing()??!1}getStats(){return this.playbackController?.getStats()??null}dispose(){this.unsubscribePlaybackEvents&&(this.unsubscribePlaybackEvents(),this.unsubscribePlaybackEvents=null),this.unsubscribeTimelineStore&&(this.unsubscribeTimelineStore(),this.unsubscribeTimelineStore=null),this.playbackController=null,this.initialized=!1}}let Dc=null;function hd(){return Dc||(Dc=new nJ),Dc}async function aJ(){const r=hd();return await r.initialize(),r}function oJ(){Dc&&(Dc.dispose(),Dc=null)}class cJ{engine=kW();currentState={isTracking:!1,progress:0,currentJob:null,trackingData:null,lostFrames:[],error:null};listeners=new Set;clipTrackingMap=new Map;unsubscribeProgress=null;unsubscribeLost=null;constructor(){this.unsubscribeProgress=this.engine.onTrackingProgress(this.handleProgress),this.unsubscribeLost=this.engine.onTrackingLost(this.handleTrackingLost)}handleProgress=e=>{this.updateState({progress:e})};handleTrackingLost=e=>{const t=[...this.currentState.lostFrames,e];this.updateState({lostFrames:t})};updateState(e){this.currentState={...this.currentState,...e},this.notifyListeners()}notifyListeners(){for(const e of this.listeners)e(this.currentState)}subscribe(e){return this.listeners.add(e),e(this.currentState),()=>this.listeners.delete(e)}getState(){return this.currentState}async startTracking(e,t,s={}){this.updateState({isTracking:!0,progress:0,lostFrames:[],error:null,trackingData:null});try{const i=await this.engine.startTracking(e,t,s);this.updateState({currentJob:i});const n=setInterval(()=>{const a=this.engine.getTrackingJob(i.id);if(!a){clearInterval(n);return}if(this.updateState({currentJob:a,progress:a.progress}),a.status==="completed"||a.status==="failed"||a.status==="cancelled")if(clearInterval(n),a.status==="completed"){const o=this.engine.getTrackingDataForClip(e),l=o.length>0?o[o.length-1]:null;l&&this.clipTrackingMap.set(e,l.trackId),this.updateState({isTracking:!1,trackingData:l,currentJob:a})}else a.status==="failed"?this.updateState({isTracking:!1,error:a.error||"Tracking failed",currentJob:a}):this.updateState({isTracking:!1,currentJob:a})},100);return i}catch(i){const n=i instanceof Error?i.message:"Unknown error";throw this.updateState({isTracking:!1,error:n}),i}}cancelTracking(e){this.engine.cancelTracking(e),this.updateState({isTracking:!1,progress:0})}applyTrackingToElement(e,t,s={x:0,y:0}){this.engine.applyTrackingToElement(e,t,s)}applyTrackingToClip(e,t={x:0,y:0}){const s=this.clipTrackingMap.get(e);if(!s)return console.warn(`No tracking data found for clip ${e}`),!1;try{return this.applyTrackingToElement(s,e,t),!0}catch{return!1}}setTrackingOffset(e,t){this.engine.setTrackingOffset(e,t)}getTrackingOffset(e){return this.engine.getTrackingOffset(e)}setApplyScale(e,t){this.engine.setApplyScale(e,t)}setApplyRotation(e,t){this.engine.setApplyRotation(e,t)}getElementPositionAtTime(e,t){return this.engine.getElementPositionAtTime(e,t)}correctTrackingPoint(e,t,s){this.engine.correctTrackingPoint(e,t,s)}getTrackingDataForClip(e){return this.engine.getTrackingDataForClip(e)}getTrackingData(e,t){return this.engine.getTrackingData(e,t)}removeAttachment(e){this.engine.removeTrackingFromElement(e)}hasTrackingData(e){return this.clipTrackingMap.has(e)}getClipTrackId(e){return this.clipTrackingMap.get(e)||null}reset(){this.updateState({isTracking:!1,progress:0,currentJob:null,trackingData:null,lostFrames:[],error:null})}dispose(){this.unsubscribeProgress&&this.unsubscribeProgress(),this.unsubscribeLost&&this.unsubscribeLost(),this.listeners.clear()}}let Sg=null;function lJ(){return Sg||(Sg=new cJ),Sg}const dJ={snapToBeats:!0,snapThreshold:.1,autoZoomOnBeats:!1,zoomIntensity:1.1,autoCutOnBeats:!1,beatsPerCut:4};class uJ{engine;state={isAnalyzing:!1,progress:0,error:null,beatMarkers:[],beatAnalysis:null};options={...dJ};listeners=new Set;constructor(){this.engine=_M()}getState(){return{...this.state}}getOptions(){return{...this.options}}setOptions(e){this.options={...this.options,...e}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}notifyListeners(){const e=this.getState();this.listeners.forEach(t=>t(e))}updateState(e){this.state={...this.state,...e},this.notifyListeners()}async analyzeAudioFromBlob(e,t){this.updateState({isAnalyzing:!0,progress:0,error:null});try{this.updateState({progress:10});const s=await this.engine.analyzeFromBlob(e);this.updateState({progress:80});const i=this.convertToBeatMarkers(s.beats,s.downbeats),n={bpm:s.bpm,confidence:s.confidence,sourceClipId:t,analyzedAt:Date.now()};return this.updateState({isAnalyzing:!1,progress:100,beatMarkers:i,beatAnalysis:n}),s}catch(s){const i=s instanceof Error?s.message:"Beat analysis failed";throw this.updateState({isAnalyzing:!1,progress:0,error:i}),s}}async analyzeAudioFromUrl(e,t){this.updateState({isAnalyzing:!0,progress:0,error:null});try{this.updateState({progress:10});const s=await this.engine.analyzeFromUrl(e);this.updateState({progress:80});const i=this.convertToBeatMarkers(s.beats,s.downbeats),n={bpm:s.bpm,confidence:s.confidence,sourceClipId:t,analyzedAt:Date.now()};return this.updateState({isAnalyzing:!1,progress:100,beatMarkers:i,beatAnalysis:n}),s}catch(s){const i=s instanceof Error?s.message:"Beat analysis failed";throw this.updateState({isAnalyzing:!1,progress:0,error:i}),s}}async analyzeAudioBuffer(e,t){this.updateState({isAnalyzing:!0,progress:0,error:null});try{this.updateState({progress:10});const s=await this.engine.analyzeAudioBuffer(e);this.updateState({progress:80});const i=this.convertToBeatMarkers(s.beats,s.downbeats),n={bpm:s.bpm,confidence:s.confidence,sourceClipId:t,analyzedAt:Date.now()};return this.updateState({isAnalyzing:!1,progress:100,beatMarkers:i,beatAnalysis:n}),s}catch(s){const i=s instanceof Error?s.message:"Beat analysis failed";throw this.updateState({isAnalyzing:!1,progress:0,error:i}),s}}convertToBeatMarkers(e,t){const s=new Set(t);return e.map(i=>({time:i.time,strength:i.strength,index:i.index,isDownbeat:s.has(i.time)||i.index%4===0}))}generateManualBeatMarkers(e,t,s=0){const n=this.engine.generateBeatMarkersAtInterval(e,t,s).map(o=>({time:o.time,strength:o.strength,index:o.index,isDownbeat:o.index%4===0})),a={bpm:e,confidence:1,analyzedAt:Date.now()};return this.updateState({beatMarkers:n,beatAnalysis:a}),n}snapTimeToNearestBeat(e){if(!this.options.snapToBeats||this.state.beatMarkers.length===0)return e;const t=this.state.beatMarkers.map(s=>({time:s.time,strength:s.strength,index:s.index}));return this.engine.snapTimeToNearestBeat(e,t,this.options.snapThreshold)}getBeatsInRange(e,t){return this.state.beatMarkers.filter(s=>s.time>=e&&s.time<=t)}getNearestBeat(e){if(this.state.beatMarkers.length===0)return null;let t=this.state.beatMarkers[0],s=Math.abs(t.time-e);for(const i of this.state.beatMarkers){const n=Math.abs(i.time-e);n<s&&(s=n,t=i)}return t}getNextBeat(e){for(const t of this.state.beatMarkers)if(t.time>e)return t;return null}getPreviousBeat(e){let t=null;for(const s of this.state.beatMarkers){if(s.time>=e)break;t=s}return t}generateCutPointsForClips(e,t=4){const s=[],i=this.state.beatMarkers.filter(n=>n.isDownbeat);for(let n=t;n<i.length;n+=t)s.push(i[n].time);return s}clearBeatMarkers(){this.updateState({beatMarkers:[],beatAnalysis:null,error:null})}setBeatMarkers(e,t){this.updateState({beatMarkers:e,beatAnalysis:t})}}let Tg=null;function zp(){return Tg||(Tg=new uJ),Tg}const hJ={threshold:-40,minSilenceDuration:.5,paddingBefore:.1,paddingAfter:.1};class pJ{audioContext=null;getAudioContext(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext}async analyzeClip(e,t,s){const i=W.getState(),n=i.getClip(e);if(!n)throw new Error("Clip not found");const a=i.getMediaItem(n.mediaId);if(!a?.blob)throw new Error("Media blob not found");s?.(10,"Loading audio...");const o=this.getAudioContext(),l=await a.blob.arrayBuffer(),d=await o.decodeAudioData(l);s?.(30,"Detecting silence...");const h=Ab().detectSilence(d,t.threshold);s?.(60,"Processing results...");const p=n.inPoint??0,m=(n.outPoint??d.duration)-p,g=h.map(x=>{const b=x.start-p,w=x.end-p,C=Math.max(0,b+t.paddingBefore),k=Math.min(m,w-t.paddingAfter);return{start:C,end:k,duration:k-C}}).filter(x=>x.duration>=t.minSilenceDuration&&x.start>=0&&x.end<=m&&x.start<x.end);s?.(90,"Finalizing...");const y=g.reduce((x,b)=>x+b.duration,0);return s?.(100,"Complete"),{silentRegions:g,totalSilenceDuration:y,clipDuration:m}}async cutSilence(e,t,s){if(t.length===0)return{success:!0};const i=W.getState(),n=i.getClip(e);if(!n)return{success:!1,error:"Clip not found"};const a=n.startTime,o=[...t].sort((d,u)=>u.start-d.start);s?.(0,"Preparing cuts...");const l=i.actionHistory;l.beginGroup("Cut silence");try{for(let d=0;d<o.length;d++){const u=o[d],h=Math.round((d+1)/o.length*100);s?.(h,`Cutting section ${d+1}/${o.length}`);const p=a+u.start,f=a+u.end,m=this.findClipContainingTime(p);if(!m)continue;const g=f-m.startTime;if(g<m.duration&&!(await i.splitClip(m.id,g)).success)continue;const y=this.findClipContainingTime(p);if(!y)continue;const x=p-y.startTime;if(x>0&&!(await i.splitClip(y.id,x)).success)continue;const b=this.findClipInTimeRange(p,f);b&&await i.rippleDeleteClip(b.id)}return s?.(100,"Complete"),{success:!0}}catch(d){return{success:!1,error:d instanceof Error?d.message:"Unknown error occurred"}}finally{l.endGroup()}}findClipContainingTime(e){const t=W.getState(),{project:s}=t;for(const i of s.timeline.tracks)for(const n of i.clips){const a=n.startTime+n.duration;if(e>=n.startTime&&e<a)return n}return null}findClipInTimeRange(e,t){const s=W.getState(),{project:i}=s;for(const n of i.timeline.tracks)for(const a of n.clips){const o=a.startTime+a.duration/2;if(o>=e&&o<t)return a}return null}dispose(){this.audioContext&&(this.audioContext.close(),this.audioContext=null)}}let Ag=null;function V2(){return Ag||(Ag=new pJ),Ag}const Ch=({title:r,enabled:e=!0,onToggle:t,defaultOpen:s=!1,children:i})=>{const[n,a]=v.useState(s);return c.jsxs("div",{className:`border rounded-lg overflow-hidden ${e?"border-border":"border-border/50 opacity-60"}`,children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary",children:[c.jsxs("button",{onClick:()=>a(!n),className:"flex-1 flex items-center gap-1",children:[c.jsx(ls,{size:12,className:`transition-transform ${n?"":"-rotate-90"} text-text-muted`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:r})]}),t&&c.jsx("button",{onClick:()=>t(!e),className:`w-8 h-4 rounded-full transition-colors ${e?"bg-primary":"bg-background-tertiary border border-border"}`,children:c.jsx("div",{className:`w-3 h-3 rounded-full bg-white shadow-sm transition-transform ${e?"translate-x-4":"translate-x-0.5"}`})})]}),n&&c.jsx("div",{className:"p-3 space-y-3",children:i})]})},fJ=({frequency:r,gain:e,onChange:t})=>{const s=(e+12)/24*100;return c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsxs("div",{className:"h-16 w-4 bg-background-tertiary rounded-full relative overflow-hidden",children:[c.jsx("input",{type:"range",min:-12,max:12,value:e,onChange:i=>t(parseFloat(i.target.value)),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",style:{writingMode:"vertical-lr",direction:"rtl"}}),c.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-primary/50 rounded-full transition-all",style:{height:`${s}%`}}),c.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-3 h-3 bg-white rounded-full shadow-sm pointer-events-none transition-all",style:{bottom:`calc(${s}% - 6px)`}})]}),c.jsx("span",{className:"text-[8px] text-text-muted",children:r}),c.jsxs("span",{className:"text-[8px] font-mono text-text-secondary",children:[e>0?"+":"",e]})]})},mJ=({clipId:r})=>{const e=W(E=>E.toggleAudioEffect),t=W(E=>E.getAudioEffects),[s,i]=v.useState(!1),[n,a]=v.useState(null),[o,l]=v.useState([{frequency:"60Hz",gain:0},{frequency:"250Hz",gain:0},{frequency:"1kHz",gain:0},{frequency:"4kHz",gain:0},{frequency:"16kHz",gain:0}]),[d,u]=v.useState(!1),[h,p]=v.useState(null),[f,m]=v.useState({threshold:-20,ratio:4,attack:.01,release:.1}),[g,y]=v.useState(!1),[x,b]=v.useState(null),[w,C]=v.useState({roomSize:.5,damping:.5,wetLevel:.3}),[k,S]=v.useState(!1),[A,T]=v.useState(null),[j,_]=v.useState({time:.25,feedback:.3,wetLevel:.25});v.useEffect(()=>{(async()=>{try{await tN()}catch(V){console.error("Failed to initialize AudioBridgeEffects:",V)}})();const G=t(r);for(const V of G)if(V.type==="eq"){i(V.enabled),a(V.id);const U=V.params;U.bands&&l(U.bands.map(oe=>({frequency:M(oe.frequency),gain:oe.gain})))}else if(V.type==="compressor"){u(V.enabled),p(V.id);const U=V.params;m(oe=>({...oe,...U}))}else if(V.type==="reverb"){y(V.enabled),b(V.id);const U=V.params;C(oe=>({...oe,...U}))}else if(V.type==="delay"){S(V.enabled),T(V.id);const U=V.params;_(oe=>({...oe,...U}))}},[r,t]);const M=E=>E>=1e3?`${E/1e3}kHz`:`${E}Hz`,P=E=>E.includes("kHz")?parseFloat(E)*1e3:parseFloat(E),R=v.useCallback(E=>{const G=Nr();if(E&&!n){const V=o.map((oe,re)=>({type:ud[re].type,frequency:P(oe.frequency),gain:oe.gain,q:ud[re].q})),U=G.applyEQ(r,V);U.success&&U.effectId&&a(U.effectId)}else n&&e(r,n,E);i(E)},[r,n,o,e]),D=v.useCallback((E,G)=>{const V=Nr();l(U=>{const oe=U.map((re,ne)=>ne===E?{...re,gain:G}:re);if(n&&s){const re=oe.map((ne,Ee)=>({type:ud[Ee].type,frequency:P(ne.frequency),gain:ne.gain,q:ud[Ee].q}));V.updateEQ(r,n,re)}return oe})},[r,n,s]),B=v.useCallback(E=>{const G=Nr();if(E&&!h){const V=G.applyCompressor(r,f);V.success&&V.effectId&&p(V.effectId)}else h&&e(r,h,E);u(E)},[r,h,f,e]),O=v.useCallback((E,G)=>{const V=Nr();m(U=>{const oe={...U,[E]:G};return h&&d&&V.updateCompressor(r,h,oe),oe})},[r,h,d]),F=v.useCallback(E=>{const G=Nr();if(E&&!x){const V=G.applyReverb(r,w);V.success&&V.effectId&&b(V.effectId)}else x&&e(r,x,E);y(E)},[r,x,w,e]),I=v.useCallback((E,G)=>{const V=Nr();C(U=>{const oe={...U,[E]:G};return x&&g&&V.updateReverb(r,x,oe),oe})},[r,x,g]),J=v.useCallback(E=>{const G=Nr();if(E&&!A){const V=G.applyDelay(r,j);V.success&&V.effectId&&T(V.effectId)}else A&&e(r,A,E);S(E)},[r,A,j,e]),Z=v.useCallback((E,G)=>{const V=Nr();_(U=>{const oe={...U,[E]:G};return A&&k&&V.updateDelay(r,A,oe),oe})},[r,A,k]);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(vn,{size:14,className:"text-text-secondary"}),c.jsxs("span",{className:"text-[10px] text-text-secondary",children:["Audio clip: ",r.substring(0,8),"..."]})]}),c.jsx(Ch,{title:"Equalizer",enabled:s,onToggle:R,defaultOpen:!0,children:c.jsx("div",{className:"flex justify-around py-2",children:o.map((E,G)=>c.jsx(fJ,{frequency:E.frequency,gain:E.gain,onChange:V=>D(G,V)},E.frequency))})}),c.jsx(Ch,{title:"Compressor",enabled:d,onToggle:B,children:c.jsxs("div",{className:"space-y-2",children:[c.jsx(ht,{label:"Threshold",value:f.threshold,onChange:E=>O("threshold",E),min:-60,max:0,unit:"dB"}),c.jsx(ht,{label:"Ratio",value:f.ratio,onChange:E=>O("ratio",E),min:1,max:20,step:.5,unit:":1"}),c.jsx(ht,{label:"Attack",value:f.attack*1e3,onChange:E=>O("attack",E/1e3),min:1,max:100,step:1,unit:"ms"}),c.jsx(ht,{label:"Release",value:f.release*1e3,onChange:E=>O("release",E/1e3),min:10,max:1e3,unit:"ms"})]})}),c.jsx(Ch,{title:"Reverb",enabled:g,onToggle:F,children:c.jsxs("div",{className:"space-y-2",children:[c.jsx(ht,{label:"Room Size",value:w.roomSize*100,onChange:E=>I("roomSize",E/100),min:0,max:100,unit:"%"}),c.jsx(ht,{label:"Damping",value:w.damping*100,onChange:E=>I("damping",E/100),min:0,max:100,unit:"%"}),c.jsx(ht,{label:"Wet/Dry",value:w.wetLevel*100,onChange:E=>I("wetLevel",E/100),min:0,max:100,unit:"%"})]})}),c.jsx(Ch,{title:"Delay",enabled:k,onToggle:J,children:c.jsxs("div",{className:"space-y-2",children:[c.jsx(ht,{label:"Time",value:j.time*1e3,onChange:E=>Z("time",E/1e3),min:1,max:2e3,unit:"ms"}),c.jsx(ht,{label:"Feedback",value:j.feedback*100,onChange:E=>Z("feedback",E/100),min:0,max:95,unit:"%"}),c.jsx(ht,{label:"Wet Level",value:j.wetLevel*100,onChange:E=>Z("wetLevel",E/100),min:0,max:100,unit:"%"})]})})]})},U2={enabled:!1,sourceTrackId:null,threshold:-30,reduction:.7,attack:.1,release:.3,holdTime:.2},G2=[{id:"subtle",name:"Subtle",settings:{threshold:-35,reduction:.4,attack:.15,release:.5}},{id:"moderate",name:"Moderate",settings:{threshold:-30,reduction:.6,attack:.1,release:.3}},{id:"aggressive",name:"Aggressive",settings:{threshold:-25,reduction:.8,attack:.05,release:.2}},{id:"podcast",name:"Podcast",settings:{threshold:-28,reduction:.75,attack:.08,release:.4,holdTime:.3}}],gJ=({clipId:r})=>{const e=W(g=>g.project),[t,s]=v.useState(U2),[i,n]=v.useState(!1),[a,o]=v.useState(!1),l=v.useMemo(()=>e.timeline.tracks.filter(g=>g.type==="audio"),[e.timeline.tracks]),d=v.useMemo(()=>{for(const g of e.timeline.tracks)for(const y of g.clips)if(y.id===r)return g;return null},[e.timeline.tracks,r]),u=v.useMemo(()=>l.filter(g=>g.id!==d?.id),[l,d]),h=v.useCallback((g,y)=>{s(x=>({...x,[g]:y})),a&&o(!1)},[a]),p=v.useCallback(g=>{const y=G2.find(x=>x.id===g);y&&s(x=>({...x,...y.settings}))},[]),f=v.useCallback(()=>{t.sourceTrackId&&(o(!0),W.setState(g=>({project:{...g.project,modifiedAt:Date.now()}})))},[t]),m=v.useCallback(()=>{s(U2),o(!1),W.setState(g=>({project:{...g.project,modifiedAt:Date.now()}}))},[]);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(fp,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Audio Ducking"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Auto-lower music when speech plays"})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${t.enabled?"bg-green-400":"bg-gray-500"}`}),c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:t.enabled?"Ducking Enabled":"Ducking Disabled"})]}),c.jsx("button",{onClick:()=>h("enabled",!t.enabled),className:`relative w-10 h-5 rounded-full transition-colors ${t.enabled?"bg-primary":"bg-background-secondary"}`,children:c.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${t.enabled?"translate-x-5":"translate-x-0.5"}`})})]}),t.enabled&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-[10px] font-medium text-text-secondary flex items-center gap-2",children:[c.jsx(T0,{size:12}),"Trigger Source (Voice Track)"]}),u.length>0?c.jsx("div",{className:"space-y-1",children:u.map(g=>c.jsxs("button",{onClick:()=>h("sourceTrackId",g.id),className:`w-full flex items-center gap-2 p-2 rounded-lg text-left transition-colors ${t.sourceTrackId===g.id?"bg-primary/20 border border-primary":"bg-background-tertiary border border-transparent hover:border-border"}`,children:[c.jsx(vn,{size:12,className:"text-text-muted"}),c.jsx("span",{className:"flex-1 text-[10px] text-text-primary",children:g.name||`Audio ${g.id.slice(-4)}`}),t.sourceTrackId===g.id&&c.jsx(Ei,{size:12,className:"text-primary"})]},g.id))}):c.jsxs("div",{className:"p-3 bg-background-tertiary rounded-lg text-center",children:[c.jsx(T0,{size:16,className:"mx-auto mb-1 text-text-muted opacity-50"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Add another audio track to use as trigger"})]})]}),t.sourceTrackId&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-[10px] font-medium text-text-secondary flex items-center gap-2",children:[c.jsx(Gr,{size:12}),"Ducking Presets"]}),c.jsx("div",{className:"grid grid-cols-2 gap-1",children:G2.map(g=>c.jsx("button",{onClick:()=>p(g.id),className:"p-2 text-[9px] text-text-secondary bg-background-tertiary rounded-lg hover:bg-primary/10 hover:text-primary transition-colors",children:g.name},g.id))})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Detection Threshold"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.threshold," dB"]})]}),c.jsx(st,{min:-50,max:-10,step:1,value:[t.threshold],onValueChange:g=>h("threshold",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Voice level that triggers ducking"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Volume Reduction"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[Math.round(t.reduction*100),"%"]})]}),c.jsx(st,{min:0,max:100,step:5,value:[t.reduction*100],onValueChange:g=>h("reduction",g[0]/100)}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"How much to lower background music"})]})]}),c.jsxs("button",{onClick:()=>n(!i),className:"w-full flex items-center gap-2 py-1.5 text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[i?c.jsx(ls,{size:12}):c.jsx(Js,{size:12}),"Timing Controls"]}),i&&c.jsxs("div",{className:"space-y-3 p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Attack"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.attack.toFixed(2),"s"]})]}),c.jsx(st,{min:.01,max:.5,step:.01,value:[t.attack],onValueChange:g=>h("attack",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"How fast volume drops when voice starts"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Release"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.release.toFixed(2),"s"]})]}),c.jsx(st,{min:.1,max:1,step:.05,value:[t.release],onValueChange:g=>h("release",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"How fast volume returns after voice stops"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Hold Time"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[t.holdTime.toFixed(2),"s"]})]}),c.jsx(st,{min:0,max:.5,step:.05,value:[t.holdTime],onValueChange:g=>h("holdTime",g[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Minimum time to stay ducked between words"})]})]}),a?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/20 rounded-lg",children:[c.jsx(Ei,{size:12,className:"text-green-400"}),c.jsx("span",{className:"text-[10px] text-green-400",children:"Ducking Applied"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("button",{onClick:f,className:"flex items-center justify-center gap-1 py-2 bg-background-tertiary rounded-lg text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(il,{size:10}),"Update"]}),c.jsx("button",{onClick:m,className:"py-2 bg-red-500/10 border border-red-500/20 rounded-lg text-[10px] text-red-400 hover:bg-red-500/20 transition-colors",children:"Remove"})]})]}):c.jsxs("button",{onClick:f,className:"w-full py-2.5 bg-primary hover:bg-primary-hover rounded-lg text-[11px] font-medium text-white flex items-center justify-center gap-2 transition-colors",children:[c.jsx(fp,{size:14}),"Apply Ducking"]})]})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Automatically reduces music volume when voice is detected"})})]})},yJ=({clipId:r})=>{const{getClip:e,getMediaItem:t}=W(),[s,i]=v.useState(hJ),[n,a]=v.useState(!1),[o,l]=v.useState(!1),[d,u]=v.useState(null),[h,p]=v.useState(0),[f,m]=v.useState(""),g=e(r),y=g?t(g.mediaId):void 0,x=y?.type==="audio"||y?.type==="video",b=v.useCallback(k=>{i(S=>({...S,...k})),u(null)},[]),w=v.useCallback(async()=>{if(r){a(!0),p(0),m("Initializing...");try{const S=await V2().analyzeClip(r,s,(A,T)=>{p(A),m(T)});u(S),S.silentRegions.length===0&&Hs.info("No Silence Detected","No silent sections found with current settings. Try lowering the threshold.")}catch(k){console.error("Silence analysis failed:",k),Hs.error("Analysis Failed",k instanceof Error?k.message:"Unknown error")}finally{a(!1)}}},[r,s]),C=v.useCallback(async()=>{if(!(!d||d.silentRegions.length===0)){l(!0),p(0),m("Preparing...");try{const S=await V2().cutSilence(r,d.silentRegions,(A,T)=>{p(A),m(T)});S.success?(Hs.success("Silence Removed",`Removed ${d.silentRegions.length} silent section${d.silentRegions.length>1?"s":""}`),u(null)):Hs.error("Cut Failed",S.error??"Unknown error")}catch(k){console.error("Cut silence failed:",k),Hs.error("Cut Failed",k instanceof Error?k.message:"Unknown error")}finally{l(!1)}}},[r,d]);return x?c.jsx("div",{className:"space-y-3",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsxs("label",{className:"text-[10px] text-text-secondary flex items-center gap-1",children:[c.jsx(vn,{size:10}),"Silence Threshold"]}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.threshold," dB"]})]}),c.jsx(st,{min:-80,max:-20,step:1,value:[s.threshold],onValueChange:k=>b({threshold:k[0]})}),c.jsx("p",{className:"text-[8px] text-text-muted mt-1",children:"Lower values detect more silence"})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Min Duration"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.minSilenceDuration.toFixed(1),"s"]})]}),c.jsx(st,{min:.1,max:2,step:.1,value:[s.minSilenceDuration],onValueChange:k=>b({minSilenceDuration:k[0]})}),c.jsx("p",{className:"text-[8px] text-text-muted mt-1",children:"Minimum silence length to detect"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Pad Before"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.paddingBefore.toFixed(1),"s"]})]}),c.jsx(st,{min:0,max:2,step:.05,value:[s.paddingBefore],onValueChange:k=>b({paddingBefore:k[0]})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Pad After"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[s.paddingAfter.toFixed(1),"s"]})]}),c.jsx(st,{min:0,max:2,step:.05,value:[s.paddingAfter],onValueChange:k=>b({paddingAfter:k[0]})})]})]}),d&&c.jsxs("div",{className:"p-2 bg-background-secondary rounded border border-primary/20",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Silent Sections Found"}),c.jsx("span",{className:"text-sm font-bold text-primary",children:d.silentRegions.length})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Total Silence"}),c.jsxs("span",{className:"text-[10px] text-text-primary",children:[d.totalSilenceDuration.toFixed(1),"s of"," ",d.clipDuration.toFixed(1),"s (",Math.round(d.totalSilenceDuration/d.clipDuration*100),"%)"]})]})]}),(n||o)&&c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:f}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[h,"%"]})]}),c.jsx("div",{className:"h-1 bg-background-secondary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${h}%`}})})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:w,disabled:n||o,className:`flex-1 py-2 rounded text-[11px] font-medium transition-colors flex items-center justify-center gap-2 ${d?"bg-background-secondary hover:bg-background-primary border border-border text-text-primary":"bg-primary hover:bg-primary-hover disabled:bg-primary/50 text-white"}`,children:n?c.jsxs(c.Fragment,{children:[c.jsx(Ci,{size:14,className:"animate-spin"}),"Analyzing..."]}):c.jsxs(c.Fragment,{children:[c.jsx(jo,{size:14}),d?"Re-analyze":"Analyze"]})}),d&&d.silentRegions.length>0&&c.jsx("button",{onClick:C,disabled:o,className:"flex-1 py-2 bg-primary hover:bg-primary-hover disabled:bg-primary/50 text-white rounded text-[11px] font-medium transition-colors flex items-center justify-center gap-2",children:o?c.jsxs(c.Fragment,{children:[c.jsx(Ci,{size:14,className:"animate-spin"}),"Cutting..."]}):c.jsxs(c.Fragment,{children:[c.jsx(zx,{size:14}),"Cut ",d.silentRegions.length]})})]}),c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Tip: Use Ctrl+Z to undo all cuts at once"})]})}):null},W2=[{id:"none",label:"None",icon:null},{id:"fade",label:"Fade",icon:c.jsx(Ur,{size:12})},{id:"slide-left",label:"Slide Left",icon:c.jsx(Fx,{size:12})},{id:"slide-right",label:"Slide Right",icon:c.jsx(na,{size:12})},{id:"slide-up",label:"Slide Up",icon:c.jsx($B,{size:12})},{id:"slide-down",label:"Slide Down",icon:c.jsx(FB,{size:12})},{id:"zoom-in",label:"Zoom In",icon:c.jsx(D$,{size:12})},{id:"zoom-out",label:"Zoom Out",icon:c.jsx(L$,{size:12})},{id:"rotate",label:"Rotate",icon:c.jsx(zO,{size:12})},{id:"blur",label:"Blur",icon:c.jsx(EL,{size:12})},{id:"iris-circle",label:"Iris Circle",icon:c.jsx(Vr,{size:12})},{id:"iris-rectangle",label:"Iris Rect",icon:c.jsx(is,{size:12})},{id:"iris-diamond",label:"Iris Diamond",icon:c.jsx(Jp,{size:12})},{id:"iris-star",label:"Iris Star",icon:c.jsx(fa,{size:12})}],Y2=[{id:"linear",label:"Linear"},{id:"ease-in",label:"Ease In"},{id:"ease-out",label:"Ease Out"},{id:"ease-in-out",label:"Ease In Out"}];function xJ(r,e){const t=r.position.x,s=r.position.y,i=.1;return{left:t+.5+i,right:1-t+.5+i,up:s+.5+i,down:1-s+.5+i}}function bJ(r,e,t,s,i){const n=[],a=r.transform,o=r.duration,l=e.duration,d=o-t.duration,u=xJ(a);if(e.preset!=="none")switch(e.preset){case"fade":n.push({id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"slide-left":n.push({id:"kf-entry-pos-0",time:0,property:"position.x",value:a.position.x-u.left,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.x",value:a.position.x,easing:e.easing});break;case"slide-right":n.push({id:"kf-entry-pos-0",time:0,property:"position.x",value:a.position.x+u.right,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.x",value:a.position.x,easing:e.easing});break;case"slide-up":n.push({id:"kf-entry-pos-0",time:0,property:"position.y",value:a.position.y-u.up,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.y",value:a.position.y,easing:e.easing});break;case"slide-down":n.push({id:"kf-entry-pos-0",time:0,property:"position.y",value:a.position.y+u.down,easing:e.easing},{id:"kf-entry-pos-1",time:l,property:"position.y",value:a.position.y,easing:e.easing});break;case"zoom-in":n.push({id:"kf-entry-scale-0",time:0,property:"scale.x",value:.3,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:.3,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"zoom-out":n.push({id:"kf-entry-scale-0",time:0,property:"scale.x",value:1.8,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:1.8,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"rotate":n.push({id:"kf-entry-rot-0",time:0,property:"rotation",value:a.rotation-90,easing:e.easing},{id:"kf-entry-rot-1",time:l,property:"rotation",value:a.rotation,easing:e.easing},{id:"kf-entry-scale-0",time:0,property:"scale.x",value:.5,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:.5,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"blur":n.push({id:"kf-entry-blur-0",time:0,property:"blur",value:30,easing:e.easing},{id:"kf-entry-blur-1",time:l,property:"blur",value:0,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:0,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break;case"iris-circle":case"iris-rectangle":case"iris-diamond":case"iris-star":n.push({id:"kf-entry-scale-0",time:0,property:"scale.x",value:0,easing:e.easing},{id:"kf-entry-scale-1",time:0,property:"scale.y",value:0,easing:e.easing},{id:"kf-entry-scale-2",time:l,property:"scale.x",value:a.scale.x,easing:e.easing},{id:"kf-entry-scale-3",time:l,property:"scale.y",value:a.scale.y,easing:e.easing},{id:"kf-entry-opacity-0",time:0,property:"opacity",value:.5,easing:e.easing},{id:"kf-entry-opacity-1",time:l,property:"opacity",value:a.opacity,easing:e.easing});break}if(t.preset!=="none")switch(t.preset){case"fade":n.push({id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"slide-left":n.push({id:"kf-exit-pos-0",time:d,property:"position.x",value:a.position.x,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.x",value:a.position.x-u.left,easing:t.easing});break;case"slide-right":n.push({id:"kf-exit-pos-0",time:d,property:"position.x",value:a.position.x,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.x",value:a.position.x+u.right,easing:t.easing});break;case"slide-up":n.push({id:"kf-exit-pos-0",time:d,property:"position.y",value:a.position.y,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.y",value:a.position.y-u.up,easing:t.easing});break;case"slide-down":n.push({id:"kf-exit-pos-0",time:d,property:"position.y",value:a.position.y,easing:t.easing},{id:"kf-exit-pos-1",time:o,property:"position.y",value:a.position.y+u.down,easing:t.easing});break;case"zoom-in":n.push({id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:1.8,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:1.8,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"zoom-out":n.push({id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:.3,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:.3,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"rotate":n.push({id:"kf-exit-rot-0",time:d,property:"rotation",value:a.rotation,easing:t.easing},{id:"kf-exit-rot-1",time:o,property:"rotation",value:a.rotation+90,easing:t.easing},{id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:.5,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:.5,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"blur":n.push({id:"kf-exit-blur-0",time:d,property:"blur",value:0,easing:t.easing},{id:"kf-exit-blur-1",time:o,property:"blur",value:30,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:0,easing:t.easing});break;case"iris-circle":case"iris-rectangle":case"iris-diamond":case"iris-star":n.push({id:"kf-exit-scale-0",time:d,property:"scale.x",value:a.scale.x,easing:t.easing},{id:"kf-exit-scale-1",time:d,property:"scale.y",value:a.scale.y,easing:t.easing},{id:"kf-exit-scale-2",time:o,property:"scale.x",value:0,easing:t.easing},{id:"kf-exit-scale-3",time:o,property:"scale.y",value:0,easing:t.easing},{id:"kf-exit-opacity-0",time:d,property:"opacity",value:a.opacity,easing:t.easing},{id:"kf-exit-opacity-1",time:o,property:"opacity",value:.5,easing:t.easing});break}return n}function vJ(r){const e={preset:"none",duration:.5,easing:"ease-out"},t={preset:"none",duration:.5,easing:"ease-in"},s=r.keyframes||[],i=s.filter(a=>a.id.startsWith("kf-entry-")),n=s.filter(a=>a.id.startsWith("kf-exit-"));if(i.length>0){const a=i.find(m=>m.property==="opacity"),o=i.find(m=>m.property==="position.x"),l=i.find(m=>m.property==="position.y"),d=i.find(m=>m.property==="scale.x"),u=i.find(m=>m.property==="rotation");i.find(m=>m.property==="blur")?e.preset="blur":u?e.preset="rotate":d&&Number(d.value)===0?e.preset="iris-circle":d&&Number(d.value)<1?e.preset="zoom-in":d&&Number(d.value)>1?e.preset="zoom-out":o&&Number(o.value)<r.transform.position.x?e.preset="slide-left":o&&Number(o.value)>r.transform.position.x?e.preset="slide-right":l&&Number(l.value)<r.transform.position.y?e.preset="slide-up":l&&Number(l.value)>r.transform.position.y?e.preset="slide-down":a&&(e.preset="fade");const p=Math.max(...i.map(m=>m.time));p>0&&(e.duration=p);const f=i[0];f&&(e.easing=f.easing)}if(n.length>0){const a=n.find(m=>m.property==="opacity"&&m.time===r.duration),o=n.find(m=>m.property==="position.x"&&m.time===r.duration),l=n.find(m=>m.property==="position.y"&&m.time===r.duration),d=n.find(m=>m.property==="scale.x"&&m.time===r.duration),u=n.find(m=>m.property==="rotation"&&m.time===r.duration);n.find(m=>m.property==="blur"&&m.time===r.duration)?t.preset="blur":u?t.preset="rotate":d&&Number(d.value)===0?t.preset="iris-circle":d&&Number(d.value)>1?t.preset="zoom-in":d&&Number(d.value)<1?t.preset="zoom-out":o&&Number(o.value)<r.transform.position.x?t.preset="slide-left":o&&Number(o.value)>r.transform.position.x?t.preset="slide-right":l&&Number(l.value)<r.transform.position.y?t.preset="slide-up":l&&Number(l.value)>r.transform.position.y?t.preset="slide-down":a&&(t.preset="fade");const p=Math.min(...n.filter(m=>m.id.includes("-0")).map(m=>m.time));p<r.duration&&(t.duration=r.duration-p);const f=n[0];f&&(t.easing=f.easing)}return{entry:e,exit:t}}const wJ=({clipId:r})=>{const{project:e,updateClipKeyframes:t,updateTextClipKeyframes:s,getTextClip:i,getShapeClip:n,getSVGClip:a,getStickerClip:o}=W(),l=fe(_=>_.getTitleEngine),d=fe(_=>_.getGraphicsEngine),{settings:u}=e,h=v.useMemo(()=>{const _=e.timeline.tracks.flatMap(B=>B.clips).find(B=>B.id===r);if(_)return{type:"regular",data:_};const M=i(r);if(M)return{type:"text",data:M};const P=n(r);if(P)return{type:"shape",data:P};const R=a(r);if(R)return{type:"svg",data:R};const D=o(r);return D?{type:"sticker",data:D}:null},[e.timeline.tracks,r,i,n,a,o,l,e.modifiedAt]),p=h?vJ(h.data):{entry:{preset:"none",duration:.5,easing:"ease-out"},exit:{preset:"none",duration:.5,easing:"ease-in"}},[f,m]=v.useState(p.entry.preset),[g,y]=v.useState(p.entry.duration),[x,b]=v.useState(p.entry.easing),[w,C]=v.useState(p.exit.preset),[k,S]=v.useState(p.exit.duration),[A,T]=v.useState(p.exit.easing),j=v.useCallback(()=>{if(!h)return;const _=(h.data.keyframes||[]).filter(D=>!D.id.startsWith("kf-entry-")&&!D.id.startsWith("kf-exit-"));u.width,u.height,(h.type==="regular"||h.type==="text")&&h.type;const M=bJ(h.data,{preset:f,duration:g,easing:x},{preset:w,duration:k,easing:A}),P=[..._,...M];if(h.type==="text")s(r,P);else if(h.type==="shape"||h.type==="svg"||h.type==="sticker"){const D=d();if(D){const B=h.type==="shape"?D.getShapeClip(r):h.type==="svg"?D.getSVGClip(r):D.getStickerClip(r);B&&(B.keyframes=P,W.setState(O=>({project:{...O.project,modifiedAt:Date.now()}})))}}else t(r,P);const R=[];f!=="none"&&R.push(`Entry: ${f}`),w!=="none"&&R.push(`Exit: ${w}`),R.length>0?Hs.success("Clip Animation Applied",R.join(", ")):Hs.info("Animations Cleared")},[h,r,f,g,x,w,k,A,t,s,u]);return h?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary uppercase tracking-wider",children:"Entry Animation"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:W2.map(_=>c.jsxs("button",{onClick:()=>m(_.id),className:`flex items-center justify-center gap-1 py-1.5 px-2 rounded text-[9px] transition-all ${f===_.id?"bg-primary text-white font-medium":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary hover:border-text-muted"}`,children:[_.icon,c.jsx("span",{children:_.label})]},`entry-${_.id}`))}),f!=="none"&&c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Duration"}),c.jsx("input",{type:"number",step:"0.1",min:"0.1",max:h.data.duration/2,value:g,onChange:_=>y(parseFloat(_.target.value)||.5),className:"w-full px-2 py-1 text-[10px] bg-background-tertiary border border-border rounded"})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Easing"}),c.jsxs(jt,{value:x,onValueChange:_=>b(_),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary text-[10px] h-7",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:Y2.map(_=>c.jsx(Ve,{value:_.id,children:_.label},_.id))})]})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary uppercase tracking-wider",children:"Exit Animation"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:W2.map(_=>c.jsxs("button",{onClick:()=>C(_.id),className:`flex items-center justify-center gap-1 py-1.5 px-2 rounded text-[9px] transition-all ${w===_.id?"bg-primary text-white font-medium":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary hover:border-text-muted"}`,children:[_.icon,c.jsx("span",{children:_.label})]},`exit-${_.id}`))}),w!=="none"&&c.jsxs("div",{className:"flex gap-2 mt-2",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Duration"}),c.jsx("input",{type:"number",step:"0.1",min:"0.1",max:h.data.duration/2,value:k,onChange:_=>S(parseFloat(_.target.value)||.5),className:"w-full px-2 py-1 text-[10px] bg-background-tertiary border border-border rounded"})]}),c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Easing"}),c.jsxs(jt,{value:A,onValueChange:_=>T(_),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary text-[10px] h-7",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:Y2.map(_=>c.jsx(Ve,{value:_.id,children:_.label},_.id))})]})]})]})]}),c.jsx("button",{onClick:j,className:"w-full py-2 bg-primary hover:bg-primary-hover text-white font-medium rounded-lg text-[11px] transition-all",children:"Apply Transitions"})]}):null},Zo=new wM,qh=[{id:"position.x",label:"Position X",category:"Transform",defaultValue:0,min:-2e3,max:2e3},{id:"position.y",label:"Position Y",category:"Transform",defaultValue:0,min:-2e3,max:2e3},{id:"scale.x",label:"Scale X",category:"Transform",defaultValue:1,min:0,max:10,step:.01},{id:"scale.y",label:"Scale Y",category:"Transform",defaultValue:1,min:0,max:10,step:.01},{id:"rotation",label:"Rotation",category:"Transform",defaultValue:0,min:-360,max:360},{id:"opacity",label:"Opacity",category:"Transform",defaultValue:1,min:0,max:1,step:.01},{id:"effect.brightness",label:"Brightness",category:"Effects",defaultValue:0,min:-100,max:100},{id:"effect.contrast",label:"Contrast",category:"Effects",defaultValue:1,min:0,max:2,step:.01},{id:"effect.saturation",label:"Saturation",category:"Effects",defaultValue:1,min:0,max:2,step:.01},{id:"effect.blur",label:"Blur",category:"Effects",defaultValue:0,min:0,max:100},{id:"volume",label:"Volume",category:"Audio",defaultValue:1,min:0,max:2,step:.01},{id:"pan",label:"Pan",category:"Audio",defaultValue:0,min:-1,max:1,step:.01}],q2=r=>r.replace(/([A-Z])/g," $1").replace(/^ease/,"").trim()||r,kJ=({selectedProperty:r,onSelect:e,existingProperties:t})=>{const[s,i]=v.useState(!1),n=[...new Set(qh.map(o=>o.category))],a=r?qh.find(o=>o.id===r)?.label||r:"Select Property";return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>i(!s),className:"w-full flex items-center justify-between px-3 py-2 bg-background-tertiary border border-border rounded-lg text-[10px] text-text-primary hover:border-text-secondary transition-colors",children:[c.jsx("span",{children:a}),c.jsx(ls,{size:12,className:`transition-transform ${s?"rotate-180":""}`})]}),s&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),c.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background-secondary border border-border rounded-lg shadow-lg z-20 max-h-64 overflow-y-auto",children:n.map(o=>c.jsxs("div",{children:[c.jsx("div",{className:"px-3 py-1.5 text-[9px] font-medium text-text-muted uppercase tracking-wider bg-background-tertiary",children:o}),qh.filter(l=>l.category===o).map(l=>{const d=t.includes(l.id);return c.jsxs("button",{onClick:()=>{e(l.id),i(!1)},className:`w-full px-3 py-2 text-left text-[10px] flex items-center justify-between hover:bg-background-tertiary transition-colors ${r===l.id?"bg-primary/10 text-primary":"text-text-primary"}`,children:[c.jsx("span",{children:l.label}),d&&c.jsx(Jp,{size:10,className:"text-primary fill-primary"})]},l.id)})]},o))})]})]})},H2=({easing:r,size:e=16})=>{const t=s=>{const i={linear:"M0,16 L16,0",easeIn:"M0,16 Q8,16 16,0",easeOut:"M0,16 Q8,0 16,0",easeInOut:"M0,16 Q4,16 8,8 Q12,0 16,0",easeInQuad:"M0,16 C0,16 12,16 16,0",easeOutQuad:"M0,16 C4,0 16,0 16,0",easeInOutQuad:"M0,16 C0,16 6,16 8,8 C10,0 16,0 16,0",easeInCubic:"M0,16 C0,16 14,16 16,0",easeOutCubic:"M0,16 C2,0 16,0 16,0",easeInOutCubic:"M0,16 C0,16 5,16 8,8 C11,0 16,0 16,0",easeInElastic:"M0,16 Q2,18 4,16 Q6,14 8,16 Q12,8 16,0",easeOutElastic:"M0,16 Q4,8 8,0 Q10,2 12,0 Q14,-2 16,0",easeInBounce:"M0,16 L4,16 L6,14 L8,16 L12,8 L16,0",easeOutBounce:"M0,16 L4,8 L8,0 L10,2 L12,0 L14,2 L16,0"};return i[s]||i.linear};return c.jsx("svg",{width:e,height:e,viewBox:"0 0 16 16",className:"text-primary",children:c.jsx("path",{d:t(r),fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})})},CJ=({value:r,onChange:e})=>{const[t,s]=v.useState(!1),i=q2(r);return c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>s(!t),className:"flex items-center gap-1.5 px-2 py-1 bg-background-tertiary border border-border rounded text-[9px] text-text-secondary hover:text-text-primary hover:border-primary/50 transition-colors",title:`Easing: ${i}`,children:[c.jsx(H2,{easing:r,size:14}),c.jsx("span",{children:i}),c.jsx(ls,{size:10})]}),t&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>s(!1)}),c.jsx("div",{className:"absolute top-full right-0 mt-1 bg-background-secondary border border-border rounded-lg shadow-lg z-20 min-w-[160px] max-h-64 overflow-y-auto",children:k9.map(n=>c.jsxs("div",{children:[c.jsx("div",{className:"px-3 py-1 text-[8px] font-medium text-text-muted uppercase tracking-wider bg-background-tertiary sticky top-0",children:n.name}),n.easings.map(a=>c.jsxs("button",{onClick:()=>{e(a),s(!1)},className:`w-full px-3 py-1.5 text-left text-[10px] hover:bg-background-tertiary transition-colors flex items-center gap-2 ${r===a?"text-primary":"text-text-primary"}`,children:[c.jsx(H2,{easing:a,size:14}),q2(a)]},a))]},n.name))})]})]})},SJ=({keyframe:r,onUpdate:e,onDelete:t,onEasingChange:s,property:i})=>c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg border border-border",children:[c.jsx(Jp,{size:12,className:"text-primary fill-primary flex-shrink-0"}),c.jsx("div",{className:"flex-1 min-w-0",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("span",{className:"text-[10px] text-text-secondary",children:[r.time.toFixed(2),"s"]}),c.jsx("span",{className:"text-[10px] text-text-muted",children:""}),c.jsx("input",{type:"number",value:typeof r.value=="number"?r.value:0,onChange:n=>e({value:parseFloat(n.target.value)||0}),min:i?.min,max:i?.max,step:i?.step||1,className:"w-16 text-[10px] font-mono text-text-primary bg-background-secondary px-1.5 py-0.5 rounded border border-border outline-none focus:border-primary"})]})}),c.jsx(CJ,{value:r.easing,onChange:s}),c.jsx("button",{onClick:t,className:"p-1 hover:bg-red-500/20 rounded transition-colors text-text-muted hover:text-red-400",title:"Delete keyframe",children:c.jsx(Ss,{size:12})})]}),TJ=({clipId:r})=>{const{getClip:e,updateClipKeyframes:t,project:s}=W(),i=$t(C=>C.playheadPosition),n=fe(C=>C.getGraphicsEngine),a=fe(C=>C.getTitleEngine),[o,l]=v.useState(null),d=v.useMemo(()=>{const C=e(r);if(C)return C;const k=n(),S=k?.getSVGClip(r);if(S)return S;const A=k?.getShapeClip(r);if(A)return A;const T=k?.getStickerClip(r);if(T)return T;const _=a()?.getTextClip(r);if(_)return _},[r,e,n,a,s.modifiedAt]),u=d?.keyframes||[],h=v.useMemo(()=>[...new Set(u.map(C=>C.property))],[u]),p=v.useMemo(()=>o?Zo.getKeyframesForProperty(u,o):[],[u,o]),f=v.useMemo(()=>qh.find(C=>C.id===o),[o]),m=v.useMemo(()=>!o||p.length===0?f?.defaultValue??0:Zo.getValueAtTime(p,i).value,[o,p,i,f]),g=v.useMemo(()=>o?p.some(C=>Math.abs(C.time-i)<.01):!1,[o,p,i]),y=v.useCallback(()=>{if(!o||!d)return;const C=Zo.addKeyframe(r,o,i,m,"linear"),k=[...u,C].sort((S,A)=>S.time-A.time);t(r,k)},[r,d,o,i,m,u,t]),x=v.useCallback((C,k)=>{const S=Zo.updateKeyframe(u,C,k);t(r,S)},[r,u,t]),b=v.useCallback(C=>{const k=Zo.removeKeyframe(u,C);t(r,k)},[r,u,t]),w=v.useCallback((C,k)=>{const S=Zo.updateKeyframe(u,C,{easing:k});t(r,S)},[r,u,t]);return d?c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-[10px] text-text-secondary font-medium",children:"Animate Property"}),c.jsx(kJ,{selectedProperty:o,onSelect:l,existingProperties:h})]}),o&&c.jsxs("div",{className:"flex items-center justify-between p-2 bg-background-tertiary rounded-lg border border-border",children:[c.jsxs("span",{className:"text-[10px] text-text-secondary",children:["Value at ",i.toFixed(2),"s"]}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary",children:typeof m=="number"?m.toFixed(2):String(m)})]}),o&&c.jsx("button",{onClick:y,disabled:g,className:`w-full py-2 rounded-lg text-[10px] flex items-center justify-center gap-2 transition-colors ${g?"bg-background-tertiary border border-border text-text-muted cursor-not-allowed":"bg-primary/10 border border-primary/30 text-primary hover:bg-primary/20"}`,children:g?c.jsxs(c.Fragment,{children:[c.jsx(Nw,{size:12}),"Keyframe exists at ",i.toFixed(2),"s"]}):c.jsxs(c.Fragment,{children:[c.jsx(wr,{size:12}),"Add Keyframe at ",i.toFixed(2),"s"]})}),o&&p.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("span",{className:"text-[10px] text-text-secondary font-medium",children:["Keyframes (",p.length,")"]})}),c.jsx("div",{className:"space-y-1.5 max-h-48 overflow-y-auto",children:p.map(C=>c.jsx(SJ,{keyframe:C,property:f,onUpdate:k=>x(C.id,k),onDelete:()=>b(C.id),onEasingChange:k=>w(C.id,k)},C.id))})]}),!o&&c.jsxs("div",{className:"text-center py-4",children:[c.jsx(Nw,{size:24,className:"mx-auto text-text-muted mb-2"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Select a property to animate"})]}),o&&p.length===0&&c.jsx("p",{className:"text-[10px] text-text-muted text-center py-2",children:"No keyframes for this property. Add one to start animating."})]}):c.jsx("div",{className:"text-[10px] text-text-muted text-center py-4",children:"No clip selected"})},AJ=({clipId:r})=>{const{getClip:e,getTextClip:t,getShapeClip:s,getSVGClip:i,getStickerClip:n,updateClipBlendMode:a,updateClipBlendOpacity:o,project:l}=W(),d=v.useMemo(()=>{const g=e(r);if(g)return g;const y=t(r);if(y)return y;const x=s(r);if(x)return x;const b=i(r);if(b)return b;const w=n(r);return w||null},[r,e,t,s,i,n,l.modifiedAt]),u=d?.blendMode||"normal",h=d?.blendOpacity??100,p=v.useMemo(()=>xW(),[]),f=v.useCallback(g=>{a(r,g)},[r,a]),m=v.useCallback(g=>{o(r,g)},[r,o]);return d?c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Blend Mode"}),c.jsxs(jt,{value:u,onValueChange:g=>f(g),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:p.map(g=>c.jsx(Ve,{value:g,children:bW(g)},g))})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[u==="normal"&&"Default blending, no special effect",u==="multiply"&&"Darkens by multiplying colors",u==="screen"&&"Lightens by screening colors",u==="overlay"&&"Combines multiply and screen",u==="darken"&&"Keeps darker pixels",u==="lighten"&&"Keeps lighter pixels",u==="color-dodge"&&"Brightens base color",u==="color-burn"&&"Darkens base color",u==="hard-light"&&"Strong contrast effect",u==="soft-light"&&"Subtle contrast effect",u==="difference"&&"Subtracts colors",u==="exclusion"&&"Similar to difference but softer"]})]}),c.jsx(ht,{label:"Opacity",value:h,onChange:m,min:0,max:100,step:1,unit:"%"}),u!=="normal"&&c.jsx("div",{className:"p-2 bg-primary/5 border border-primary/20 rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-text-muted",children:[c.jsx("span",{className:"text-primary font-medium",children:"Tip:"})," Blend modes affect how this layer combines with layers below it. Experiment with different modes for creative effects."]})})]}):c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No clip selected"})},jJ=({clipId:r})=>{const{getClip:e,getTextClip:t,getShapeClip:s,getSVGClip:i,getStickerClip:n,updateClipRotate3D:a,updateClipPerspective:o,updateClipTransformStyle:l,project:d}=W(),u=v.useMemo(()=>{const w=e(r);if(w)return w;const C=t(r);if(C)return C;const k=s(r);if(k)return k;const S=i(r);if(S)return S;const A=n(r);return A||null},[r,e,t,s,i,n,d.modifiedAt]),h=u?.transform.rotate3d??{x:0,y:0,z:0},p=u?.transform.perspective??1e3,f=u?.transform.transformStyle??"flat",m=v.useCallback(w=>{a(r,{...h,x:w})},[r,h,a]),g=v.useCallback(w=>{a(r,{...h,y:w})},[r,h,a]),y=v.useCallback(w=>{a(r,{...h,z:w})},[r,h,a]),x=v.useCallback(w=>{o(r,w)},[r,o]),b=v.useCallback(w=>{l(r,w)},[r,l]);return u?c.jsxs("div",{className:"space-y-3",children:[c.jsx(ht,{label:"Rotation X",value:h.x,onChange:m,min:-360,max:360,step:1,unit:""}),c.jsx(ht,{label:"Rotation Y",value:h.y,onChange:g,min:-360,max:360,step:1,unit:""}),c.jsx(ht,{label:"Rotation Z",value:h.z,onChange:y,min:-360,max:360,step:1,unit:""}),c.jsx(ht,{label:"Perspective",value:p,onChange:x,min:100,max:2e3,step:10,unit:"px"}),c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Transform Style"}),c.jsxs(jt,{value:f,onValueChange:w=>b(w),children:[c.jsx(vt,{className:"w-full bg-background-tertiary border-border text-text-primary",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"flat",children:"Flat"}),c.jsx(Ve,{value:"preserve-3d",children:"Preserve 3D"})]})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[f==="flat"&&"Flattens children into the plane of this element",f==="preserve-3d"&&"Children positioned in 3D space"]})]}),(h.x!==0||h.y!==0||h.z!==0)&&c.jsx("div",{className:"p-2 bg-primary/5 border border-primary/20 rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-text-muted",children:[c.jsx("span",{className:"text-primary font-medium",children:"Tip:"})," 3D rotations allow you to rotate layers along X, Y, and Z axes for depth effects. Adjust perspective to control the 3D depth perception."]})})]}):c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No clip selected"})},_J="openreel-motion-presets",EJ=1,Vp="userPresets";function MJ(){return new Promise((r,e)=>{const t=indexedDB.open(_J,EJ);t.onerror=()=>e(t.error),t.onsuccess=()=>r(t.result),t.onupgradeneeded=s=>{const i=s.target.result;i.objectStoreNames.contains(Vp)||i.createObjectStore(Vp,{keyPath:"id"})}})}async function PJ(){try{const r=await MJ();return new Promise((e,t)=>{const n=r.transaction(Vp,"readonly").objectStore(Vp).getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}catch{return[]}}const NJ=[{id:"fade-in",name:"Fade In",category:"entrance",description:"Smooth fade in from transparent",duration:.5,tags:["simple","opacity"],tracks:[{property:"opacity",keyframes:[{time:0,value:0,easing:"ease-out"},{time:.5,value:1}]}]},{id:"slide-in-left",name:"Slide In Left",category:"entrance",description:"Slide in from the left edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:-200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"slide-in-right",name:"Slide In Right",category:"entrance",description:"Slide in from the right edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"slide-in-top",name:"Slide In Top",category:"entrance",description:"Slide in from the top edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.y",keyframes:[{time:0,value:-200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"slide-in-bottom",name:"Slide In Bottom",category:"entrance",description:"Slide in from the bottom edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.y",keyframes:[{time:0,value:200,easing:"ease-out-cubic"},{time:.6,value:0}],relative:!0},{property:"opacity",keyframes:[{time:0,value:0},{time:.2,value:1}]}]},{id:"scale-in",name:"Scale In",category:"entrance",description:"Pop in with scale animation",duration:.4,tags:["scale","pop"],tracks:[{property:"scale.x",keyframes:[{time:0,value:0,easing:"ease-out-back"},{time:.4,value:1}]},{property:"scale.y",keyframes:[{time:0,value:0,easing:"ease-out-back"},{time:.4,value:1}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.1,value:1}]}]},{id:"pop",name:"Pop",category:"entrance",description:"Quick pop entrance with overshoot",duration:.3,tags:["scale","quick"],tracks:[{property:"scale.x",keyframes:[{time:0,value:.5,easing:"ease-out-back"},{time:.3,value:1}]},{property:"scale.y",keyframes:[{time:0,value:.5,easing:"ease-out-back"},{time:.3,value:1}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.05,value:1}]}]},{id:"bounce-in",name:"Bounce In",category:"entrance",description:"Bouncy scale entrance",duration:.6,tags:["bounce","playful"],tracks:[{property:"scale.x",keyframes:[{time:0,value:0},{time:.4,value:1.15,easing:"ease-out"},{time:.5,value:.9},{time:.6,value:1}]},{property:"scale.y",keyframes:[{time:0,value:0},{time:.4,value:1.15,easing:"ease-out"},{time:.5,value:.9},{time:.6,value:1}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.1,value:1}]}]},{id:"flip-in",name:"Flip In",category:"entrance",description:"3D flip entrance effect",duration:.5,tags:["3d","rotation"],tracks:[{property:"rotation",keyframes:[{time:0,value:-90,easing:"ease-out"},{time:.5,value:0}]},{property:"opacity",keyframes:[{time:0,value:0},{time:.25,value:1}]}]},{id:"blur-in",name:"Blur In",category:"entrance",description:"Fade in with blur effect",duration:.5,tags:["blur","soft"],tracks:[{property:"opacity",keyframes:[{time:0,value:0,easing:"ease-out"},{time:.5,value:1}]},{property:"scale.x",keyframes:[{time:0,value:1.1,easing:"ease-out"},{time:.5,value:1}]},{property:"scale.y",keyframes:[{time:0,value:1.1,easing:"ease-out"},{time:.5,value:1}]}]},{id:"fade-out",name:"Fade Out",category:"exit",description:"Smooth fade out to transparent",duration:.5,tags:["simple","opacity"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:0}]}]},{id:"slide-out-left",name:"Slide Out Left",category:"exit",description:"Slide out to the left edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:0,easing:"ease-in-cubic"},{time:.6,value:-200}],relative:!0},{property:"opacity",keyframes:[{time:.4,value:1},{time:.6,value:0}]}]},{id:"slide-out-right",name:"Slide Out Right",category:"exit",description:"Slide out to the right edge",duration:.6,tags:["slide","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:0,easing:"ease-in-cubic"},{time:.6,value:200}],relative:!0},{property:"opacity",keyframes:[{time:.4,value:1},{time:.6,value:0}]}]},{id:"scale-out",name:"Scale Out",category:"exit",description:"Shrink and fade out",duration:.4,tags:["scale"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in-back"},{time:.4,value:0}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in-back"},{time:.4,value:0}]},{property:"opacity",keyframes:[{time:.3,value:1},{time:.4,value:0}]}]},{id:"shrink",name:"Shrink",category:"exit",description:"Quick shrink exit",duration:.3,tags:["scale","quick"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.3,value:.5}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.3,value:.5}]},{property:"opacity",keyframes:[{time:0,value:1},{time:.3,value:0}]}]},{id:"blur-out",name:"Blur Out",category:"exit",description:"Fade out with blur effect",duration:.5,tags:["blur","soft"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:0}]},{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.1}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.1}]}]},{id:"pulse",name:"Pulse",category:"emphasis",description:"Subtle pulsing scale effect",duration:.8,tags:["attention","loop"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in-out"},{time:.4,value:1.1},{time:.8,value:1}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in-out"},{time:.4,value:1.1},{time:.8,value:1}]}]},{id:"shake",name:"Shake",category:"emphasis",description:"Quick horizontal shake",duration:.5,tags:["attention","error"],tracks:[{property:"position.x",keyframes:[{time:0,value:0},{time:.1,value:-10},{time:.2,value:10},{time:.3,value:-10},{time:.4,value:10},{time:.5,value:0}],relative:!0}]},{id:"bounce",name:"Bounce",category:"emphasis",description:"Bouncing attention effect",duration:.6,tags:["attention","playful"],tracks:[{property:"position.y",keyframes:[{time:0,value:0},{time:.2,value:-20,easing:"ease-out"},{time:.4,value:0,easing:"ease-in"},{time:.5,value:-10,easing:"ease-out"},{time:.6,value:0,easing:"ease-in"}],relative:!0}]},{id:"wiggle",name:"Wiggle",category:"emphasis",description:"Playful wiggle rotation",duration:.6,tags:["attention","playful"],tracks:[{property:"rotation",keyframes:[{time:0,value:0},{time:.1,value:-5},{time:.2,value:5},{time:.3,value:-5},{time:.4,value:5},{time:.5,value:-2},{time:.6,value:0}],relative:!0}]},{id:"rubber-band",name:"Rubber Band",category:"emphasis",description:"Elastic stretch effect",duration:.6,tags:["attention","playful"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1},{time:.2,value:1.25},{time:.35,value:.85},{time:.5,value:1.1},{time:.6,value:1}]},{property:"scale.y",keyframes:[{time:0,value:1},{time:.2,value:.85},{time:.35,value:1.15},{time:.5,value:.95},{time:.6,value:1}]}]},{id:"glow-pulse",name:"Glow Pulse",category:"emphasis",description:"Subtle opacity pulse",duration:1,tags:["attention","subtle"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"ease-in-out"},{time:.5,value:.7},{time:1,value:1}]}]},{id:"cross-dissolve",name:"Cross Dissolve",category:"transition",description:"Simple opacity crossfade",duration:.5,tags:["simple"],tracks:[{property:"opacity",keyframes:[{time:0,value:1,easing:"linear"},{time:.5,value:0}]}]},{id:"wipe-left",name:"Wipe Left",category:"transition",description:"Wipe transition to the left",duration:.5,tags:["wipe","direction"],tracks:[{property:"position.x",keyframes:[{time:0,value:0,easing:"ease-in-out"},{time:.5,value:-100}],relative:!0},{property:"opacity",keyframes:[{time:.3,value:1},{time:.5,value:0}]}]},{id:"zoom-transition",name:"Zoom Transition",category:"transition",description:"Zoom out transition",duration:.5,tags:["zoom","scale"],tracks:[{property:"scale.x",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.5}]},{property:"scale.y",keyframes:[{time:0,value:1,easing:"ease-in"},{time:.5,value:1.5}]},{property:"opacity",keyframes:[{time:.2,value:1},{time:.5,value:0}]}]}];let zy=[],jg=!1;async function RJ(){if(!jg)try{zy=await PJ(),jg=!0}catch{zy=[],jg=!0}}RJ();function IJ(){return[...NJ,...zy]}function DJ(){const r=IJ();return{entrance:r.filter(e=>e.category==="entrance"),exit:r.filter(e=>e.category==="exit"),emphasis:r.filter(e=>e.category==="emphasis"),transition:r.filter(e=>e.category==="transition")}}const FJ=[{id:"entrance",name:"In",icon:na},{id:"exit",name:"Out",icon:Fx},{id:"emphasis",name:"Emphasis",icon:ci},{id:"transition",name:"Transition",icon:il}];function BJ(r){return{linear:"linear",ease:"ease-in-out","ease-in":"ease-in","ease-out":"ease-out","ease-in-out":"ease-in-out","ease-in-cubic":"ease-in","ease-out-cubic":"ease-out","ease-in-out-cubic":"ease-in-out","ease-out-back":"ease-out","ease-in-back":"ease-in"}[r]||"ease-in-out"}function LJ(r,e,t,s,i,n){const a=[],o=i||r.duration,l=s==="entrance"?"motion-in":s==="exit"?"motion-out":"motion-emphasis";let d=0;s==="exit"?d=e-o:s==="emphasis"&&(d=(e-o)/2);const u=i?i/r.duration:1,h=n?.width||1920,p=n?.height||1080;for(const f of r.tracks)for(let m=0;m<f.keyframes.length;m++){const g=f.keyframes[m],y=Math.min(e,d+g.time*u),x=BJ(g.easing||"ease-out");let b=g.value;if(f.relative)switch(f.property){case"position.x":{if(g.value!==0){const w=g.value>0?1:-1,C=h+100;b=t.position.x+w*C}else b=t.position.x;break}case"position.y":{if(g.value!==0){const w=g.value>0?1:-1,C=p+100;b=t.position.y+w*C}else b=t.position.y;break}case"rotation":b=t.rotation+g.value;break}else f.property==="opacity"&&g.value===1?b=t.opacity:(f.property==="scale.x"||f.property==="scale")&&g.value===1?b=t.scale.x:f.property==="scale.y"&&g.value===1&&(b=t.scale.y);a.push({id:`${l}-${f.property}-${m}-${dt().slice(0,4)}`,time:y,property:f.property,value:b,easing:x})}return a}function OJ(r){const e=[];for(let s=0;s<=10;s++){const i=s/10,n=i*r.duration;let a=1,o=0,l=0,d=1,u=1,h=0;for(const p of r.tracks){let f=0;const m=p.keyframes.filter(y=>y.time<=n),g=p.keyframes.filter(y=>y.time>n);if(m.length>0&&g.length>0){const y=m[m.length-1],x=g[0],b=(n-y.time)/(x.time-y.time);f=y.value+(x.value-y.value)*b}else m.length>0?f=m[m.length-1].value:g.length>0&&(f=g[0].value);switch(p.property){case"opacity":a=f;break;case"position.x":o=f*.3;break;case"position.y":l=f*.3;break;case"scale":case"scale.x":d=f;break;case"scale.y":u=f;break;case"rotation":h=f;break}}e.push({opacity:a,transform:`translate(${o}px, ${l}px) scale(${d}, ${u}) rotate(${h}deg)`,offset:i})}return e}const $J=({preset:r,isApplied:e,onApply:t})=>{const[s,i]=v.useState(!1),n=v.useRef(null),a=v.useRef(null);return v.useEffect(()=>{if(!s||!n.current){a.current&&(a.current.cancel(),a.current=null);return}const o=n.current,l=OJ(r);return a.current=o.animate(l,{duration:r.duration*1e3,iterations:1/0,easing:"ease-in-out"}),()=>{a.current?.cancel()}},[s,r]),c.jsxs("button",{onClick:t,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),className:`relative w-full rounded-lg border transition-all overflow-hidden ${e?"border-primary bg-primary/10":"border-border bg-background-tertiary hover:border-primary/50"}`,children:[c.jsxs("div",{className:"relative h-20 bg-gradient-to-br from-background-secondary to-background-tertiary flex items-center justify-center overflow-hidden",children:[c.jsx("div",{ref:n,className:"w-10 h-10 rounded bg-primary/80 flex items-center justify-center",children:c.jsx(ti,{size:16,className:"text-white"})}),e&&c.jsx("div",{className:"absolute top-2 right-2",children:c.jsx(Ei,{size:14,className:"text-primary"})}),s&&!e&&c.jsx("div",{className:"absolute inset-0 bg-black/40 flex items-center justify-center",children:c.jsx("span",{className:"text-[10px] text-white font-medium px-2 py-1 bg-primary rounded",children:"Apply"})})]}),c.jsxs("div",{className:"p-2 text-left",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary block truncate",children:r.name}),c.jsxs("span",{className:"text-[8px] text-text-muted",children:[r.duration,"s"]})]})]})},zJ=({clipId:r})=>{const e=Ft(k=>k.getSelectedClipIds()),t=W(k=>k.project),s=W(k=>k.updateClipKeyframes),i=W(k=>k.updateTextClipKeyframes),n=W(k=>k.getTextClip),a=W(k=>k.getShapeClip),o=W(k=>k.getSVGClip),l=W(k=>k.getStickerClip),d=fe(k=>k.getGraphicsEngine),[u,h]=v.useState("entrance"),p={},f=r||e[0],g=v.useMemo(()=>DJ(),[])[u]||[],y=v.useMemo(()=>{if(!f)return null;const k=t.timeline.tracks.flatMap(_=>_.clips).find(_=>_.id===f);if(k)return{type:"regular",data:k};const S=n(f);if(S)return{type:"text",data:S};const A=a(f);if(A)return{type:"shape",data:A};const T=o(f);if(T)return{type:"svg",data:T};const j=l(f);return j?{type:"sticker",data:j}:null},[f,t.timeline.tracks,n,a,o,l,t.modifiedAt]),b=v.useCallback(()=>{if(!y)return{entrance:null,exit:null,emphasis:null};const k=y.data.keyframes||[],S=k.some(j=>j.id.startsWith("motion-in-")),A=k.some(j=>j.id.startsWith("motion-out-")),T=k.some(j=>j.id.startsWith("motion-emphasis-"));return{entrance:S?"applied":null,exit:A?"applied":null,emphasis:T?"applied":null}},[y])(),w=v.useCallback(k=>{if(!y||!f)return;const S=k.category==="entrance"?"motion-in-":k.category==="exit"?"motion-out-":"motion-emphasis-",A=(y.data.keyframes||[]).filter(R=>!R.id.startsWith(S)),T=y.data.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1},j=p[k.id],_={width:t.settings.width,height:t.settings.height},M=LJ(k,y.data.duration,T,k.category,j,_),P=[...A,...M];if(y.type==="text")i(f,P);else if(y.type==="shape"||y.type==="svg"||y.type==="sticker"){const R=d();if(R){const D=y.type==="shape"?R.getShapeClip(f):y.type==="svg"?R.getSVGClip(f):R.getStickerClip(f);D&&(D.keyframes=P,W.setState(B=>({project:{...B.project,modifiedAt:Date.now()}})))}}else s(f,P);Hs.success("Motion Preset Applied",`${k.name} added to clip`)},[y,f,p,s,i,d,t.settings]),C=v.useCallback(k=>{if(!y||!f)return;const S=k==="entrance"?"motion-in-":k==="exit"?"motion-out-":"motion-emphasis-",A=(y.data.keyframes||[]).filter(T=>!T.id.startsWith(S));if(y.type==="text")i(f,A);else if(y.type==="shape"||y.type==="svg"||y.type==="sticker"){const T=d();if(T){const j=y.type==="shape"?T.getShapeClip(f):y.type==="svg"?T.getSVGClip(f):T.getStickerClip(f);j&&(j.keyframes=A,W.setState(_=>({project:{..._.project,modifiedAt:Date.now()}})))}}else s(f,A);Hs.info("Preset Removed")},[y,f,s,i,d]);return f?y?c.jsxs("div",{className:"space-y-4",children:[(b.entrance||b.exit||b.emphasis)&&c.jsxs("div",{className:"space-y-1 p-2 bg-background-tertiary rounded-lg border border-border",children:[c.jsx("span",{className:"text-[10px] text-text-secondary font-medium",children:"Applied Animations"}),c.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[b.entrance&&c.jsxs("button",{onClick:()=>C("entrance"),className:"flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 rounded text-[9px] hover:bg-green-500/30",children:[c.jsx(na,{size:10}),"Entry "]}),b.exit&&c.jsxs("button",{onClick:()=>C("exit"),className:"flex items-center gap-1 px-2 py-1 bg-red-500/20 text-red-400 rounded text-[9px] hover:bg-red-500/30",children:[c.jsx(Fx,{size:10}),"Exit "]}),b.emphasis&&c.jsxs("button",{onClick:()=>C("emphasis"),className:"flex items-center gap-1 px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-[9px] hover:bg-yellow-500/30",children:[c.jsx(ci,{size:10}),"Emphasis "]})]})]}),c.jsx("div",{className:"flex gap-1",children:FJ.map(k=>{const S=k.icon,A=k.id==="entrance"&&b.entrance||k.id==="exit"&&b.exit||k.id==="emphasis"&&b.emphasis||k.id==="transition"&&b.emphasis;return c.jsxs("button",{onClick:()=>h(k.id),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-[10px] whitespace-nowrap transition-colors relative ${u===k.id?"bg-primary text-white font-medium":"bg-background-tertiary text-text-secondary hover:text-text-primary"}`,children:[c.jsx(S,{size:12}),k.name,A&&c.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full"})]},k.id)})}),c.jsx("div",{className:"grid grid-cols-3 gap-2 max-h-72 overflow-y-auto",children:g.map(k=>{const S=k.category==="entrance"?"entrance":k.category==="exit"?"exit":"emphasis";return c.jsx($J,{preset:k,isApplied:!!b[S],onApply:()=>w(k)},k.id)})}),c.jsxs("p",{className:"text-[9px] text-text-muted text-center",children:[g.length," presets in ",u]})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(ci,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Clip not found"})]}):c.jsxs("div",{className:"p-4 text-center",children:[c.jsx(ci,{size:24,className:"mx-auto mb-2 text-text-muted"}),c.jsx("p",{className:"text-[10px] text-text-muted",children:"Select a clip to apply motion presets"})]})},VJ=({clipId:r})=>{const{getClip:e,project:t}=W(),{motionPathMode:s,motionPathClipId:i,setMotionPathMode:n}=Ft(),a=fe(_=>_.getGraphicsEngine),o=fe(_=>_.getTitleEngine),[l,d]=v.useState(0),u=v.useMemo(()=>{const _=e(r);if(_)return _;const M=a(),P=M?.getSVGClip(r);if(P)return P;const R=M?.getShapeClip(r);if(R)return R;const D=M?.getStickerClip(r);if(D)return D;const O=o()?.getTextClip(r);if(O)return O},[r,e,a,o,t.modifiedAt]),h=v.useMemo(()=>sX(),[]),p=v.useMemo(()=>h.getMotionPath(r),[r,h,l]),f=s&&i===r,m=v.useCallback(_=>{if(_){const M=h.getMotionPath(r);if(M)h.setMotionPath(r,{...M,enabled:!0});else{const P=[{x:0,y:0,time:0},{x:100,y:0,time:1}];h.setMotionPath(r,{enabled:!0,pathType:"bezier",points:Ay(P),showPath:!0,autoOrient:!1,alignOrigin:[.5,.5]})}}else{const M=h.getMotionPath(r);M&&h.setMotionPath(r,{...M,enabled:!1})}d(M=>M+1)},[r,h]),g=v.useCallback(_=>{const M=h.getMotionPath(r);M&&(h.setMotionPath(r,{...M,showPath:_}),d(P=>P+1))},[r,h]),y=v.useCallback(_=>{const M=h.getMotionPath(r);M&&(h.setMotionPath(r,{...M,autoOrient:_}),d(P=>P+1))},[r,h]),x=v.useCallback(_=>{const M=h.getMotionPath(r);M&&(h.setMotionPath(r,{...M,pathType:_}),d(P=>P+1))},[r,h]),b=v.useCallback(()=>{f?n(!1):n(!0,r)},[f,r,n]),w=v.useCallback(()=>{const _=h.getMotionPath(r);if(!_)return;const M=_.points[_.points.length-1],P={x:M.x+50,y:M.y,time:Math.min(1,M.time+.2)};h.addGSAPMotionPathPoint(r,P),d(R=>R+1)},[r,h]),C=v.useCallback(()=>{h.removeMotionPath(r),n(!1),d(_=>_+1)},[r,h,n]);if(!u)return c.jsx("div",{className:"text-center py-8 text-text-muted text-xs",children:"No clip selected"});const k=p?.enabled??!1,S=p?.showPath??!0,A=p?.autoOrient??!1,T=p?.pathType??"bezier",j=p?.points.length??0;return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Iw,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-xs font-medium text-text-primary",children:"Motion Path"})]}),c.jsx(ya,{checked:k,onCheckedChange:m})]}),k&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"p-3 bg-background-tertiary rounded-lg space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Show Path"}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("button",{onClick:()=>g(!S),className:`p-1.5 rounded transition-colors ${S?"bg-primary/20 text-primary":"bg-background-elevated text-text-muted"}`,children:S?c.jsx(Ur,{size:12}):c.jsx(ha,{size:12})})})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Auto Orient"}),c.jsx(ya,{checked:A,onCheckedChange:y})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Path Type"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:["linear","bezier","catmull-rom"].map(_=>c.jsx("button",{onClick:()=>x(_),className:`py-1.5 rounded text-[9px] capitalize transition-colors ${T===_?"bg-primary text-white":"bg-background-elevated border border-border text-text-secondary hover:text-text-primary"}`,children:_==="catmull-rom"?"Smooth":_},_))})]})]}),c.jsxs("div",{className:"flex items-center justify-between p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Path Points"}),c.jsxs("p",{className:"text-sm font-medium text-text-primary",children:[j," points"]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:w,className:"p-1.5 rounded bg-primary/20 text-primary hover:bg-primary/30 transition-colors",title:"Add point",children:c.jsx(wr,{size:12})}),c.jsx("button",{onClick:C,className:"p-1.5 rounded bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-colors",title:"Clear path",children:c.jsx(Ss,{size:12})})]})]}),c.jsxs(Et,{onClick:b,className:`w-full ${f?"bg-primary text-white":"bg-background-tertiary text-text-primary border border-border hover:bg-background-elevated"}`,size:"sm",children:[c.jsx(Iw,{size:14,className:"mr-2"}),f?"Exit Edit Mode":"Edit Path on Canvas"]}),f&&c.jsx("div",{className:"p-2 bg-primary/10 border border-primary/30 rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-primary",children:[c.jsx("span",{className:"font-medium",children:"Editing:"})," Click on the path to add points. Drag points to move them. Right-click to remove. Drag handles to adjust curves."]})}),c.jsx("div",{className:"p-2 bg-background-tertiary/50 border border-border rounded-lg",children:c.jsxs("p",{className:"text-[9px] text-text-muted",children:[c.jsx("span",{className:"text-text-secondary font-medium",children:"Tip:"})," ","Motion paths animate the clip's position along a curved path over time. Use bezier handles for smooth curves."]})})]})]})},Sh=r=>{const e=Math.floor(r/60),t=(r%60).toFixed(1);return e>0?`${e}:${t.padStart(4,"0")}`:`${t}s`},X2=[{category:"Attention",animations:[{type:"pulse",label:"Pulse",description:"Gentle scale breathing effect"},{type:"heartbeat",label:"Heartbeat",description:"Double-beat pulse like a heart"},{type:"flash",label:"Flash",description:"Opacity pulsing effect"},{type:"glow",label:"Glow",description:"Scale and opacity pulse"},{type:"breathe",label:"Breathe",description:"Slow, calming scale effect"}]},{category:"Movement",animations:[{type:"shake",label:"Shake",description:"Quick side-to-side shake"},{type:"bounce",label:"Bounce",description:"Bouncing up and down"},{type:"float",label:"Float",description:"Gentle floating motion"},{type:"vibrate",label:"Vibrate",description:"Random small movements"},{type:"wave",label:"Wave",description:"Wave-like motion"}]},{category:"Rotation",animations:[{type:"spin",label:"Spin",description:"Continuous rotation"},{type:"swing",label:"Swing",description:"Pendulum-like rotation"},{type:"wobble",label:"Wobble",description:"Wobbling with rotation"},{type:"tilt",label:"Tilt",description:"Slow tilting motion"},{type:"tada",label:"Tada",description:"Attention-grabbing wiggle"}]},{category:"Distortion",animations:[{type:"jello",label:"Jello",description:"Jelly-like squish effect"},{type:"rubber-band",label:"Rubber Band",description:"Stretchy rubber effect"},{type:"flicker",label:"Flicker",description:"Random visibility flicker"}]},{category:"Zoom & Pan",animations:[{type:"zoom-pulse",label:"Zoom Pulse",description:"Scale in and out"},{type:"focus-zoom",label:"Focus Zoom",description:"Zoom to point and back"},{type:"ken-burns",label:"Ken Burns",description:"Slow zoom with pan"},{type:"pan-left",label:"Pan Left",description:"Slow pan to the left"},{type:"pan-right",label:"Pan Right",description:"Slow pan to the right"},{type:"pan-up",label:"Pan Up",description:"Slow pan upward"},{type:"pan-down",label:"Pan Down",description:"Slow pan downward"}]}],K2={type:"none",speed:1,intensity:1,loop:!0},UJ=({clipId:r})=>{const{project:e,updateClipEmphasisAnimation:t}=W(),s=fe(h=>h.getTitleEngine),i=fe(h=>h.getGraphicsEngine),n=v.useMemo(()=>{const h=e.timeline.tracks.flatMap(b=>b.clips).find(b=>b.id===r);if(h)return h.duration;const f=s()?.getTextClip(r);if(f)return f.duration;const m=i(),g=m?.getShapeClip(r);if(g)return g.duration;const y=m?.getSVGClip(r);if(y)return y.duration;const x=m?.getStickerClip(r);return x?x.duration:5},[r,e.timeline.tracks,s,i,e.modifiedAt]),a=v.useMemo(()=>{const h=e.timeline.tracks.flatMap(b=>b.clips).find(b=>b.id===r);if(h?.emphasisAnimation)return h.emphasisAnimation;const f=s()?.getTextClip(r);if(f?.emphasisAnimation)return f.emphasisAnimation;const m=i(),g=m?.getShapeClip(r);if(g?.emphasisAnimation)return g.emphasisAnimation;const y=m?.getSVGClip(r);if(y?.emphasisAnimation)return y.emphasisAnimation;const x=m?.getStickerClip(r);return x?.emphasisAnimation?x.emphasisAnimation:K2},[r,e.timeline.tracks,s,i,e.modifiedAt]),o=v.useCallback(h=>{const p={...a,...h};t(r,p)},[r,a,t]),l=v.useCallback(h=>{o(h==="focus-zoom"?{type:h,focusPoint:{x:.5,y:.5},zoomScale:1.5,holdDuration:.3,loop:!1}:h==="ken-burns"?{type:h,loop:!1}:{type:h})},[o]),d=v.useCallback(()=>{o(K2)},[o]),u=X2.flatMap(h=>h.animations).find(h=>h.type===a.type);return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:()=>l("none"),className:`py-2 rounded-lg text-[10px] font-medium transition-all ${a.type==="none"?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:"None"}),c.jsxs("button",{onClick:d,className:"py-2 rounded-lg text-[10px] font-medium bg-background-tertiary border border-border text-text-secondary hover:text-text-primary transition-all flex items-center justify-center gap-1",children:[c.jsx($i,{size:10}),"Reset"]})]}),X2.map(h=>c.jsxs("div",{children:[c.jsx("h4",{className:"text-[10px] font-medium text-text-muted mb-2",children:h.category}),c.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:h.animations.map(p=>c.jsx("button",{onClick:()=>l(p.type),className:`py-2 px-2 rounded-lg text-[10px] transition-all text-left ${a.type===p.type?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary hover:border-primary/50"}`,children:p.label},p.type))})]},h.category)),a.type!=="none"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[u&&c.jsx("p",{className:"text-[10px] text-text-muted italic",children:u.description}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Speed"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[a.speed.toFixed(1),"x"]})]}),c.jsx(st,{min:.1,max:3,step:.1,value:[a.speed],onValueChange:h=>o({speed:h[0]})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Intensity"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[Math.round(a.intensity*100),"%"]})]}),c.jsx(st,{min:.1,max:2,step:.1,value:[a.intensity],onValueChange:h=>o({intensity:h[0]})})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Loop Animation"}),c.jsx("button",{onClick:()=>o({loop:!a.loop}),className:`w-10 h-5 rounded-full transition-colors ${a.loop?"bg-primary":"bg-background-tertiary border border-border"}`,children:c.jsx("div",{className:`w-4 h-4 rounded-full bg-white shadow-sm transition-transform ${a.loop?"translate-x-5":"translate-x-0.5"}`})})]})]}),c.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[c.jsx(ui,{size:12}),c.jsx("span",{className:"text-[10px] font-medium",children:"Timing"}),c.jsxs("span",{className:"text-[9px] text-text-muted ml-auto",children:["Clip: ",Sh(n)]})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Start Time"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:Sh(a.startTime??0)})]}),c.jsx(st,{min:0,max:n,step:.1,value:[a.startTime??0],onValueChange:h=>o({startTime:h[0]})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Duration"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:a.animationDuration?Sh(a.animationDuration):"Full clip"})]}),c.jsx(st,{min:0,max:n-(a.startTime??0),step:.1,value:[a.animationDuration??n-(a.startTime??0)],onValueChange:h=>{const p=h[0];o({animationDuration:p>0?p:void 0})}}),c.jsxs("div",{className:"flex justify-between text-[9px] text-text-muted",children:[c.jsx("span",{children:"0s"}),c.jsx("button",{onClick:()=>o({startTime:0,animationDuration:void 0}),className:"text-primary hover:underline",children:"Reset to full clip"}),c.jsx("span",{children:Sh(n-(a.startTime??0))})]})]})]}),a.type==="focus-zoom"&&c.jsxs("div",{className:"pt-3 border-t border-border space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[c.jsx(j0,{size:12}),c.jsx("span",{className:"text-[10px] font-medium",children:"Focus Zoom Settings"})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Zoom Scale"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[(a.zoomScale||1.5).toFixed(1),"x"]})]}),c.jsx(st,{min:1.1,max:3,step:.1,value:[a.zoomScale||1.5],onValueChange:h=>o({zoomScale:h[0]})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Hold Duration"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary bg-background-tertiary px-1.5 py-0.5 rounded border border-border",children:[((a.holdDuration||.3)*100).toFixed(0),"%"]})]}),c.jsx(st,{min:0,max:1,step:.05,value:[a.holdDuration||.3],onValueChange:h=>o({holdDuration:h[0]})})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Focus Point"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"X Position"}),c.jsx(st,{min:0,max:1,step:.05,value:[a.focusPoint?.x||.5],onValueChange:h=>o({focusPoint:{x:h[0],y:a.focusPoint?.y||.5}})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:"Y Position"}),c.jsx(st,{min:0,max:1,step:.05,value:[a.focusPoint?.y||.5],onValueChange:h=>o({focusPoint:{x:a.focusPoint?.x||.5,y:h[0]}})})]})]}),c.jsx("div",{className:"grid grid-cols-3 gap-1 mt-2",children:[{x:0,y:0,label:"TL"},{x:.5,y:0,label:"TC"},{x:1,y:0,label:"TR"},{x:0,y:.5,label:"ML"},{x:.5,y:.5,label:"C"},{x:1,y:.5,label:"MR"},{x:0,y:1,label:"BL"},{x:.5,y:1,label:"BC"},{x:1,y:1,label:"BR"}].map(h=>c.jsx("button",{onClick:()=>o({focusPoint:{x:h.x,y:h.y}}),className:`py-1.5 rounded text-[9px] transition-all ${a.focusPoint?.x===h.x&&a.focusPoint?.y===h.y?"bg-primary text-white":"bg-background-tertiary border border-border text-text-muted hover:text-text-primary"}`,children:h.label},h.label))})]})]})]}),c.jsx("div",{className:"pt-3 border-t border-border",children:c.jsxs("div",{className:"flex items-center gap-2 text-text-muted",children:[c.jsx(ci,{size:10}),c.jsx("span",{className:"text-[9px]",children:"Emphasis animations play while the clip is visible (not during entry/exit)"})]})})]})},GJ=[{id:"correlation",name:"Correlation",description:"Best for high-contrast objects"},{id:"optical-flow",name:"Optical Flow",description:"Good for smooth motion"},{id:"feature",name:"Feature Match",description:"Works with complex textures"}],WJ=({clipId:r})=>{const[e,t]=v.useState({isTracking:!1,progress:0,currentJob:null,trackingData:null,lostFrames:[],error:null}),[s,i]=v.useState({x:100,y:100,width:200,height:200}),[n,a]=v.useState("correlation"),[o,l]=v.useState(70),[d,u]=v.useState(!1),[h,p]=v.useState(0),[f,m]=v.useState(0),[g,y]=v.useState(!0),[x,b]=v.useState(!0),[w,C]=v.useState(0),[k,S]=v.useState(!1),A=lJ();v.useEffect(()=>{const D=A.subscribe(t),B=A.getTrackingDataForClip(r);return B.length>0&&t(O=>({...O,trackingData:B[B.length-1]})),D},[A,r]);const T=v.useCallback(async()=>{try{await A.startTracking(r,s,{frameRate:30,startFrame:0,endFrame:150,algorithm:n,confidenceThreshold:o/100})}catch(D){console.error("Failed to start tracking:",D)}},[A,r,s,n,o]),j=v.useCallback(()=>{e.currentJob&&A.cancelTracking(e.currentJob.id)},[A,e.currentJob]),_=v.useCallback(()=>{A.applyTrackingToClip(r,{x:h,y:f})&&(A.setApplyScale(r,g),A.setApplyRotation(r,x),S(!0))},[A,r,h,f,g,x]),M=v.useCallback(()=>{A.removeAttachment(r),S(!1)},[A,r]),P=v.useCallback((D,B)=>{D==="x"?p(B):m(B),k&&A.setTrackingOffset(r,{x:D==="x"?B:h,y:D==="y"?B:f})},[A,r,k,h,f]),R=e.trackingData!==null||A.hasTrackingData(r);return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(j0,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Motion Tracking"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Track objects to attach elements"})]})]}),!e.isTracking&&!R&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{className:"text-[10px] font-medium text-text-secondary",children:"Tracking Region"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"X Position"}),c.jsx("input",{type:"number",value:s.x,onChange:D=>i({...s,x:Number(D.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Y Position"}),c.jsx("input",{type:"number",value:s.y,onChange:D=>i({...s,y:Number(D.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Width"}),c.jsx("input",{type:"number",value:s.width,onChange:D=>i({...s,width:Number(D.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Height"}),c.jsx("input",{type:"number",value:s.height,onChange:D=>i({...s,height:Number(D.target.value)}),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]})]}),c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Draw region in preview or enter coordinates"})]}),c.jsxs("button",{onClick:()=>u(!d),className:"w-full flex items-center gap-2 py-1.5 text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[d?c.jsx(ls,{size:12}):c.jsx(Js,{size:12}),c.jsx(e_,{size:12}),"Advanced Options"]}),d&&c.jsxs("div",{className:"space-y-3 p-2 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsx("label",{className:"text-[10px] font-medium text-text-secondary",children:"Algorithm"}),c.jsx("div",{className:"space-y-1",children:GJ.map(D=>c.jsxs("button",{onClick:()=>a(D.id),className:`w-full flex items-center gap-2 p-2 rounded-lg text-left transition-colors ${n===D.id?"bg-primary/20 border border-primary":"bg-background-secondary border border-transparent hover:border-border"}`,children:[c.jsx("div",{className:`w-3 h-3 rounded-full border-2 flex items-center justify-center ${n===D.id?"border-primary":"border-border"}`,children:n===D.id&&c.jsx("div",{className:"w-1.5 h-1.5 bg-primary rounded-full"})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-primary",children:D.name}),c.jsx("p",{className:"text-[8px] text-text-muted",children:D.description})]})]},D.id))})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Confidence Threshold"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[o,"%"]})]}),c.jsx(st,{min:30,max:95,step:5,value:[o],onValueChange:D=>l(D[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Higher = more accurate but may lose track easier"})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Path Smoothing"}),c.jsx("span",{className:"text-[10px] font-mono text-text-primary",children:w})]}),c.jsx(st,{min:0,max:10,step:1,value:[w],onValueChange:D=>C(D[0])}),c.jsx("p",{className:"text-[8px] text-text-muted",children:"Reduces jitter in tracking path"})]})]}),c.jsxs("button",{onClick:T,className:"w-full py-2.5 bg-primary hover:bg-primary-hover rounded-lg text-[11px] font-medium text-white flex items-center justify-center gap-2 transition-colors",children:[c.jsx(j0,{size:14}),"Start Tracking"]})]}),e.isTracking&&c.jsxs("div",{className:"space-y-3 p-3 bg-background-tertiary rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),c.jsx("span",{className:"text-[11px] font-medium text-primary",children:"Tracking in Progress"})]}),c.jsx("button",{onClick:j,className:"p-1.5 text-text-muted hover:text-red-400 hover:bg-red-400/10 rounded transition-colors",title:"Cancel Tracking",children:c.jsx(Zs,{size:14})})]}),c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between text-[10px]",children:[c.jsx("span",{className:"text-text-muted",children:"Analyzing frames..."}),c.jsxs("span",{className:"font-mono text-text-primary",children:[Math.round(e.progress),"%"]})]}),c.jsx("div",{className:"w-full h-2 bg-background-secondary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-200",style:{width:`${e.progress}%`}})})]}),e.lostFrames.length>0&&c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-amber-500/10 border border-amber-500/20 rounded text-[10px] text-amber-400",children:[c.jsx(_o,{size:12}),"Lost tracking on ",e.lostFrames.length," frame(s)"]})]}),e.error&&c.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-[10px] text-red-400",children:[c.jsxs("div",{className:"flex items-center gap-2 font-medium mb-1",children:[c.jsx(_o,{size:12}),"Tracking Failed"]}),c.jsx("p",{className:"text-[9px] text-red-300/80",children:e.error})]}),R&&!e.isTracking&&c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-green-500/10 border border-green-500/30 rounded-lg",children:[c.jsx(Ei,{size:14,className:"text-green-400"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[10px] font-medium text-green-400",children:"Tracking Complete"}),e.trackingData&&c.jsxs("p",{className:"text-[9px] text-green-300/70",children:[e.trackingData.keyframes.length," keyframes captured",e.trackingData.lostFrames.length>0&&`  ${e.trackingData.lostFrames.length} frames lost`]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"text-[10px] font-medium text-text-secondary flex items-center gap-2",children:[c.jsx(aa,{size:12}),"Position Offset"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"X Offset"}),c.jsx("input",{type:"number",value:h,onChange:D=>P("x",Number(D.target.value)),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]}),c.jsxs("div",{className:"space-y-0.5",children:[c.jsx("label",{className:"text-[9px] text-text-muted",children:"Y Offset"}),c.jsx("input",{type:"number",value:f,onChange:D=>P("y",Number(D.target.value)),className:"w-full px-2 py-1.5 text-[10px] bg-background-secondary border border-border rounded focus:border-primary focus:outline-none"})]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx(ts,{className:"text-[10px] font-medium text-text-secondary",children:"Transform Options"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(E0,{id:"apply-scale",checked:g,onCheckedChange:D=>{const B=D===!0;y(B),k&&A.setApplyScale(r,B)}}),c.jsxs(ts,{htmlFor:"apply-scale",className:"flex items-center gap-1 cursor-pointer",children:[c.jsx(Ca,{size:10,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Scale"})]})]}),c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-background-tertiary rounded-lg",children:[c.jsx(E0,{id:"apply-rotation",checked:x,onCheckedChange:D=>{const B=D===!0;b(B),k&&A.setApplyRotation(r,B)}}),c.jsxs(ts,{htmlFor:"apply-rotation",className:"flex items-center gap-1 cursor-pointer",children:[c.jsx($i,{size:10,className:"text-text-muted"}),c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Rotation"})]})]})]})]}),k?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-primary/10 border border-primary/20 rounded-lg",children:[c.jsx(Ei,{size:12,className:"text-primary"}),c.jsx("span",{className:"text-[10px] text-primary",children:"Tracking Applied"})]}),c.jsx("button",{onClick:M,className:"w-full py-2 bg-red-500/10 border border-red-500/30 rounded-lg text-[10px] text-red-400 hover:bg-red-500/20 transition-colors",children:"Remove Tracking"})]}):c.jsx("button",{onClick:_,className:"w-full py-2.5 bg-primary/20 border border-primary/30 rounded-lg text-[11px] font-medium text-primary hover:bg-primary/30 transition-colors",children:"Apply Tracking to Clip"}),c.jsxs("button",{onClick:T,className:"w-full flex items-center justify-center gap-2 py-1.5 text-[9px] text-text-muted hover:text-text-secondary transition-colors",children:[c.jsx(il,{size:10}),"Re-track with Different Settings"]})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Track objects to pin graphics, text, or effects"})})]})},YJ=({clipId:r})=>{const e=fe(T=>T.getNestedSequenceEngine),t=W(T=>T.project),s=Ft(T=>T.getSelectedClipIds()),[i,n]=v.useState(null),[a,o]=v.useState(null),[l,d]=v.useState(""),[u,h]=v.useState(null);v.useEffect(()=>{let T=!1;return(async()=>{const _=await e();T||h(_)})(),()=>{T=!0}},[e]);const p=v.useMemo(()=>u?.getAllCompoundClips()||[],[u]),f=v.useMemo(()=>u?u.getInstance(r):null,[u,r]),m=v.useMemo(()=>!u||!f?null:u.getCompoundClip(f.compoundClipId),[u,f]),g=v.useMemo(()=>{const T=[];for(const j of t.timeline.tracks)for(const _ of j.clips)s.includes(_.id)&&T.push({id:_.id,trackId:j.id,startTime:_.startTime,duration:_.duration});return T},[t.timeline.tracks,s]),y=v.useCallback(()=>{if(!u||g.length<2)return;const T=[];for(const _ of t.timeline.tracks)for(const M of _.clips)s.includes(M.id)&&T.push(M);if(T.length<2)return;const j=u.createCompoundClip(T,t.timeline.tracks);W.setState(_=>({project:{..._.project,modifiedAt:Date.now()}})),n(j.id)},[u,g,s,t.timeline.tracks]),x=v.useCallback(()=>{if(!u||!r)return;u.flattenInstance(r)&&W.setState(j=>({project:{...j.project,modifiedAt:Date.now()}}))},[u,r]),b=v.useCallback(T=>{u&&(u.duplicateCompoundClip(T),W.setState(j=>({project:{...j.project,modifiedAt:Date.now()}})))},[u]),w=v.useCallback(T=>{if(!u)return;u.deleteCompoundClip(T)&&(W.setState(_=>({project:{..._.project,modifiedAt:Date.now()}})),i===T&&n(null))},[u,i]),C=v.useCallback(T=>{o(T.id),d(T.name)},[]),k=v.useCallback(()=>{!u||!a||(u.renameCompoundClip(a,l.trim()),W.setState(T=>({project:{...T.project,modifiedAt:Date.now()}})),o(null),d(""))},[u,a,l]),S=v.useCallback(()=>{o(null),d("")},[]),A=T=>{const j=Math.floor(T/60),_=Math.floor(T%60);return`${j}:${_.toString().padStart(2,"0")}`};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r bg-primary/10 rounded-lg border border-primary/30",children:[c.jsx(zs,{size:16,className:"text-primary"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Nested Sequences"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Create compound clips from selections"})]})]}),m&&c.jsxs("div",{className:"p-3 bg-primary/10 border border-primary/20 rounded-lg space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ox,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:m.name})]}),c.jsxs("div",{className:"flex gap-2 text-[9px] text-text-muted",children:[c.jsxs("span",{children:[m.content.clips.length," clips"]}),c.jsx("span",{children:""}),c.jsx("span",{children:A(m.content.duration)})]}),c.jsxs("div",{className:"flex gap-2 pt-1",children:[c.jsxs("button",{onClick:x,className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-background-tertiary rounded text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(Ca,{size:10}),"Flatten"]}),c.jsxs("button",{onClick:()=>b(m.id),className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-background-tertiary rounded text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(Ao,{size:10}),"Duplicate"]})]})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Create Compound Clip"}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[g.length," clips selected"]})]}),c.jsxs("button",{onClick:y,disabled:g.length<2,className:`w-full py-2.5 rounded-lg text-[11px] font-medium flex items-center justify-center gap-2 transition-colors ${g.length>=2?"bg-primary/20 border border-primary/30 text-primary hover:bg-primary/20":"bg-background-tertiary text-text-muted cursor-not-allowed"}`,children:[c.jsx(wr,{size:14}),"Create Compound Clip"]}),g.length<2&&c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Select 2+ clips to create a compound clip"})]}),p.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Compound Clips Library"}),c.jsx("div",{className:"space-y-1.5",children:p.map(T=>{const j=u?.getInstanceCount(T.id)||0,_=i===T.id,M=a===T.id;return c.jsxs("div",{className:"bg-background-tertiary rounded-lg overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 cursor-pointer hover:bg-background-secondary transition-colors",onClick:()=>n(_?null:T.id),children:[c.jsx(Js,{size:12,className:`text-text-muted transition-transform ${_?"rotate-90":""}`}),c.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:T.color}}),M?c.jsx("input",{type:"text",value:l,onChange:P=>d(P.target.value),onClick:P=>P.stopPropagation(),onKeyDown:P=>{P.key==="Enter"&&k(),P.key==="Escape"&&S()},className:"flex-1 bg-background-secondary px-1.5 py-0.5 rounded text-[10px] text-text-primary outline-none border border-primary",autoFocus:!0}):c.jsx("span",{className:"flex-1 text-[10px] text-text-primary truncate",children:T.name}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[j," instance",j!==1?"s":""]})]}),_&&c.jsxs("div",{className:"px-2 pb-2 space-y-2",children:[c.jsxs("div",{className:"flex gap-2 text-[9px] text-text-muted pl-5",children:[c.jsxs("span",{children:[T.content.clips.length," clips"]}),c.jsx("span",{children:""}),c.jsx("span",{children:A(T.content.duration)}),c.jsx("span",{children:""}),c.jsxs("span",{children:[T.content.tracks.length," tracks"]})]}),c.jsx("div",{className:"flex gap-1 pl-5",children:M?c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:P=>{P.stopPropagation(),k()},className:"p-1.5 bg-green-500/20 rounded text-green-400 hover:bg-green-500/30 transition-colors",children:c.jsx(Ei,{size:10})}),c.jsx("button",{onClick:P=>{P.stopPropagation(),S()},className:"p-1.5 bg-red-500/20 rounded text-red-400 hover:bg-red-500/30 transition-colors",children:c.jsx(Zs,{size:10})})]}):c.jsxs(c.Fragment,{children:[c.jsx("button",{onClick:P=>{P.stopPropagation(),C(T)},className:"p-1.5 bg-background-secondary rounded text-text-muted hover:text-text-primary transition-colors",title:"Rename",children:c.jsx(TO,{size:10})}),c.jsx("button",{onClick:P=>{P.stopPropagation(),b(T.id)},className:"p-1.5 bg-background-secondary rounded text-text-muted hover:text-text-primary transition-colors",title:"Duplicate",children:c.jsx(Ao,{size:10})}),c.jsx("button",{onClick:P=>{P.stopPropagation(),w(T.id)},disabled:j>0,className:`p-1.5 rounded transition-colors ${j>0?"bg-background-secondary text-text-muted cursor-not-allowed opacity-50":"bg-red-500/20 text-red-400 hover:bg-red-500/30"}`,title:j>0?"Cannot delete - has instances":"Delete",children:c.jsx(Ss,{size:10})})]})})]})]},T.id)})})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Group clips into reusable compound clips"})})]})},Q2=[{id:"brightness",name:"Brightness",effect:{type:"brightness",params:{value:0},enabled:!0}},{id:"contrast",name:"Contrast",effect:{type:"contrast",params:{value:1},enabled:!0}},{id:"saturation",name:"Saturation",effect:{type:"saturation",params:{value:1},enabled:!0}},{id:"exposure",name:"Exposure",effect:{type:"exposure",params:{value:0},enabled:!0}},{id:"blur",name:"Blur",effect:{type:"blur",params:{radius:0},enabled:!0}},{id:"sharpen",name:"Sharpen",effect:{type:"sharpen",params:{amount:0},enabled:!0}},{id:"vignette",name:"Vignette",effect:{type:"vignette",params:{intensity:0},enabled:!0}},{id:"tint",name:"Tint",effect:{type:"tint",params:{color:"#ffffff",strength:0},enabled:!0}}],J2=[{id:"normal",name:"Normal",group:"Basic"},{id:"multiply",name:"Multiply",group:"Darken"},{id:"screen",name:"Screen",group:"Lighten"},{id:"overlay",name:"Overlay",group:"Contrast"},{id:"darken",name:"Darken",group:"Darken"},{id:"lighten",name:"Lighten",group:"Lighten"},{id:"color-dodge",name:"Color Dodge",group:"Lighten"},{id:"color-burn",name:"Color Burn",group:"Darken"},{id:"hard-light",name:"Hard Light",group:"Contrast"},{id:"soft-light",name:"Soft Light",group:"Contrast"},{id:"difference",name:"Difference",group:"Inversion"},{id:"exclusion",name:"Exclusion",group:"Inversion"},{id:"hue",name:"Hue",group:"Component"},{id:"saturation",name:"Saturation",group:"Component"},{id:"color",name:"Color",group:"Component"},{id:"luminosity",name:"Luminosity",group:"Component"}],qJ=({clipId:r})=>{const e=fe(k=>k.getAdjustmentLayerEngine),t=W(k=>k.project),[s,i]=v.useState(null),[n,a]=v.useState(!1),[o,l]=v.useState(null);v.useEffect(()=>{let k=!1;return(async()=>{const A=await e();k||l(A)})(),()=>{k=!0}},[e]);const d=v.useMemo(()=>{for(const k of t.timeline.tracks)for(const S of k.clips)if(S.id===r)return k;return null},[t.timeline.tracks,r]),u=v.useMemo(()=>o?.getAllLayers()||[],[o,t.modifiedAt]),h=v.useMemo(()=>d?o?.getLayersForTrack(d.id)||[]:[],[o,d,t.modifiedAt]),p=v.useCallback(()=>{if(!o||!d)return;const k=d.clips.find(j=>j.id===r),S=k?.startTime||0,A=k?.duration||5,T=o.createAdjustmentLayer(d.id,S,{duration:A,name:`Adjustment ${u.length+1}`});i(T.id),W.setState(j=>({project:{...j.project,modifiedAt:Date.now()}}))},[o,d,r,u.length]),f=v.useCallback(k=>{o&&(o.deleteLayer(k),s===k&&i(null),W.setState(S=>({project:{...S.project,modifiedAt:Date.now()}})))},[o,s]),m=v.useCallback((k,S)=>{o&&(o.setEnabled(k,S),W.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),g=v.useCallback((k,S)=>{o&&(o.setOpacity(k,S),W.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),y=v.useCallback((k,S)=>{o&&(o.setBlendMode(k,S),a(!1),W.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),x=v.useCallback((k,S)=>{if(!o)return;const A=Q2.find(T=>T.id===S);A&&(o.addEffect(k,{id:`effect_${Date.now()}`,...A.effect}),W.setState(T=>({project:{...T.project,modifiedAt:Date.now()}})))},[o]),b=v.useCallback((k,S)=>{o&&(o.removeEffect(k,S),W.setState(A=>({project:{...A.project,modifiedAt:Date.now()}})))},[o]),w=v.useCallback(k=>{if(!o)return;const S=o.duplicateLayer(k);S&&i(S.id),W.setState(A=>({project:{...A.project,modifiedAt:Date.now()}}))},[o]),C=k=>{const S=s===k.id;return c.jsxs("div",{className:"bg-background-tertiary rounded-lg overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 cursor-pointer hover:bg-background-secondary transition-colors",onClick:()=>i(S?null:k.id),children:[c.jsx(Js,{size:12,className:`text-text-muted transition-transform ${S?"rotate-90":""}`}),c.jsx(zs,{size:12,className:"text-indigo-400"}),c.jsx("span",{className:"flex-1 text-[10px] text-text-primary truncate",children:k.name}),c.jsx("button",{onClick:A=>{A.stopPropagation(),m(k.id,!k.enabled)},className:`p-1 rounded transition-colors ${k.enabled?"text-text-primary":"text-text-muted opacity-50"}`,children:k.enabled?c.jsx(Ur,{size:12}):c.jsx(ha,{size:12})})]}),S&&c.jsxs("div",{className:"px-2 pb-2 space-y-3",children:[c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Opacity"}),c.jsxs("span",{className:"text-[10px] font-mono text-text-primary",children:[Math.round(k.opacity*100),"%"]})]}),c.jsx(st,{min:0,max:100,step:1,value:[k.opacity*100],onValueChange:A=>g(k.id,A[0]/100)})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("label",{className:"text-[10px] text-text-secondary flex items-center gap-1",children:[c.jsx(Vd,{size:10}),"Blend Mode"]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>a(!n),className:"w-full flex items-center justify-between p-2 bg-background-secondary rounded text-[10px] text-text-primary hover:bg-background-tertiary transition-colors",children:[c.jsx("span",{children:J2.find(A=>A.id===k.blendMode)?.name||"Normal"}),c.jsx(ls,{size:10})]}),n&&c.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-background-secondary border border-border rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:J2.map(A=>c.jsx("button",{onClick:()=>y(k.id,A.id),className:`w-full text-left px-3 py-1.5 text-[10px] hover:bg-background-tertiary transition-colors ${k.blendMode===A.id?"text-indigo-400 bg-indigo-500/10":"text-text-secondary"}`,children:A.name},A.id))})]})]}),c.jsxs("div",{className:"space-y-1.5",children:[c.jsxs("label",{className:"text-[10px] text-text-secondary flex items-center gap-1",children:[c.jsx(jL,{size:10}),"Effects (",k.effects.length,")"]}),k.effects.length>0&&c.jsx("div",{className:"space-y-1",children:k.effects.map(A=>c.jsxs("div",{className:"flex items-center justify-between p-1.5 bg-background-secondary rounded",children:[c.jsx("span",{className:"text-[9px] text-text-primary capitalize",children:A.type}),c.jsx("button",{onClick:()=>b(k.id,A.id),className:"p-0.5 text-red-400 hover:bg-red-500/20 rounded transition-colors",children:c.jsx(Ss,{size:10})})]},A.id))}),c.jsx("div",{className:"grid grid-cols-2 gap-1",children:Q2.slice(0,4).map(A=>c.jsxs("button",{onClick:()=>x(k.id,A.id),className:"p-1.5 text-[9px] text-text-secondary bg-background-secondary rounded hover:bg-indigo-500/10 hover:text-indigo-400 transition-colors",children:["+ ",A.name]},A.id))})]}),c.jsxs("div",{className:"flex gap-1 pt-2 border-t border-border",children:[c.jsxs("button",{onClick:()=>w(k.id),className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-background-secondary rounded text-[10px] text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx(Ao,{size:10}),"Duplicate"]}),c.jsxs("button",{onClick:()=>f(k.id),className:"flex-1 flex items-center justify-center gap-1 py-1.5 bg-red-500/10 rounded text-[10px] text-red-400 hover:bg-red-500/20 transition-colors",children:[c.jsx(Ss,{size:10}),"Delete"]})]})]})]},k.id)};return c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gradient-to-r from-indigo-500/20 to-violet-500/20 rounded-lg border border-indigo-500/30",children:[c.jsx(zs,{size:16,className:"text-indigo-400"}),c.jsxs("div",{className:"flex-1",children:[c.jsx("span",{className:"text-[11px] font-medium text-text-primary",children:"Adjustment Layers"}),c.jsx("p",{className:"text-[9px] text-text-muted",children:"Non-destructive effects on clips below"})]})]}),c.jsxs("button",{onClick:p,disabled:!d,className:`w-full py-2.5 rounded-lg text-[11px] font-medium flex items-center justify-center gap-2 transition-colors ${d?"bg-indigo-500/20 border border-indigo-500/30 text-indigo-400 hover:bg-indigo-500/30":"bg-background-tertiary text-text-muted cursor-not-allowed"}`,children:[c.jsx(wr,{size:14}),"Add Adjustment Layer"]}),h.length>0&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("span",{className:"text-[10px] font-medium text-text-secondary",children:["Track Layers (",h.length,")"]}),c.jsx("div",{className:"space-y-1.5",children:h.map(C)})]}),u.length>h.length&&c.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[c.jsx("span",{className:"text-[10px] font-medium text-text-secondary",children:"Other Layers"}),c.jsx("div",{className:"space-y-1.5",children:u.filter(k=>!h.some(S=>S.id===k.id)).map(C)})]}),c.jsx("div",{className:"pt-2 border-t border-border",children:c.jsx("p",{className:"text-[9px] text-text-muted text-center",children:"Apply color, effects to all clips below"})})]})},HJ={youtube:c.jsx(ki,{size:14}),tiktok:c.jsx(bi,{size:14}),"instagram-reels":c.jsx(bi,{size:14}),"instagram-feed":c.jsx(is,{size:14}),"instagram-stories":c.jsx(bi,{size:14}),"youtube-shorts":c.jsx(bi,{size:14}),facebook:c.jsx(ki,{size:14}),twitter:c.jsx(ki,{size:14}),linkedin:c.jsx(ki,{size:14})},XJ=({onReframeComplete:r})=>{const e=W(b=>b.updateSettings),[t,s]=v.useState(ZY),[i,n]=v.useState(!1),[a,o]=v.useState(!1),[l,d]=v.useState(0),[u,h]=v.useState(""),[p,f]=v.useState("tiktok"),m=v.useCallback(b=>{s(w=>({...w,...b}))},[]),g=v.useCallback(b=>{f(b);const w=rh[b],C=Object.entries(Ll).find(([,k])=>Math.abs(k.ratio-w.ratio)<.01);C&&m({targetAspectRatio:C[0]})},[m]),y=v.useCallback(b=>{f(null),m({targetAspectRatio:b})},[m]),x=v.useCallback(async()=>{n(!0),d(0),h("Updating canvas size...");try{const b=Ll[t.targetAspectRatio];console.log("[AutoReframe] Applying canvas size:",{targetAspectRatio:t.targetAspectRatio,targetConfig:b,newDimensions:{width:b.width,height:b.height}}),d(50);const w=await e({width:b.width,height:b.height});console.log("[AutoReframe] Update result:",w),d(100),h("Complete!"),o(!0);const C={keyframes:[],outputWidth:b.width,outputHeight:b.height,success:!0,message:`Canvas resized to ${b.name} (${b.width}x${b.height})`};r?.(C);const k=p?rh[p].name:t.targetAspectRatio;Hs.success("Canvas Resized",`Project output size changed to ${k} (${b.width}x${b.height})`)}catch(b){console.error("Canvas resize failed:",b),Hs.error("Resize Failed",b instanceof Error?b.message:"Unknown error"),o(!1)}finally{n(!1)}},[t,p,r,e]);return c.jsx("div",{className:"space-y-3",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-text-secondary block mb-2",children:"Platform Presets"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:Object.keys(rh).map(b=>c.jsxs("button",{onClick:()=>g(b),className:`flex items-center gap-1 p-2 rounded text-[9px] transition-colors ${p===b?"bg-primary/20 border border-primary text-text-primary":"bg-background-secondary hover:bg-background-primary border border-transparent text-text-secondary"}`,children:[HJ[b],c.jsx("span",{className:"truncate",children:rh[b].name})]},b))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-text-secondary block mb-2",children:"Aspect Ratio"}),c.jsx("div",{className:"grid grid-cols-3 gap-1",children:Object.keys(Ll).filter(b=>b!=="custom").map(b=>c.jsx("button",{onClick:()=>y(b),className:`p-2 rounded text-[9px] transition-colors ${t.targetAspectRatio===b&&!p?"bg-primary/20 border border-primary text-text-primary":"bg-background-secondary hover:bg-background-primary border border-transparent text-text-secondary"}`,children:b},b))})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Tracking Speed"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(t.trackingSpeed*100),"%"]})]}),c.jsx(st,{min:0,max:100,step:1,value:[t.trackingSpeed*100],onValueChange:b=>m({trackingSpeed:b[0]/100})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Smoothing"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(t.smoothing*100),"%"]})]}),c.jsx(st,{min:0,max:100,step:1,value:[t.smoothing*100],onValueChange:b=>m({smoothing:b[0]/100})})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Center Bias"}),c.jsxs("span",{className:"text-[10px] text-text-muted font-mono",children:[Math.round(t.centerBias*100),"%"]})]}),c.jsx(st,{min:0,max:100,step:1,value:[t.centerBias*100],onValueChange:b=>m({centerBias:b[0]/100})})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("label",{className:"text-[10px] text-text-secondary",children:"Follow Subject"}),c.jsx("button",{onClick:()=>m({followSubject:!t.followSubject}),className:`w-8 h-4 rounded-full transition-colors ${t.followSubject?"bg-primary":"bg-background-secondary"}`,children:c.jsx("div",{className:`w-3 h-3 rounded-full bg-white transition-transform ${t.followSubject?"translate-x-4":"translate-x-0.5"}`})})]}),i&&c.jsxs("div",{className:"space-y-1",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[9px] text-text-muted",children:u}),c.jsxs("span",{className:"text-[9px] text-text-muted",children:[l,"%"]})]}),c.jsx("div",{className:"h-1 bg-background-secondary rounded-full overflow-hidden",children:c.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${l}%`}})})]}),c.jsx("button",{onClick:x,disabled:i,className:"w-full py-2 rounded text-[11px] font-medium transition-colors flex items-center justify-center gap-2 bg-primary hover:bg-primary-hover disabled:bg-primary/50 text-white",children:i?c.jsxs(c.Fragment,{children:[c.jsx(Ci,{size:14,className:"animate-spin"}),"Resizing Canvas..."]}):a?c.jsxs(c.Fragment,{children:[c.jsx(Bx,{size:14}),"Applied - Click to Change Again"]}):c.jsxs(c.Fragment,{children:[c.jsx(ti,{size:14}),"Apply Canvas Size"]})}),c.jsxs("div",{className:"text-[9px] text-text-muted text-center",children:["Output:"," ",Ll[t.targetAspectRatio].width," x"," ",Ll[t.targetAspectRatio].height]})]})})},KJ=({clipId:r,clipDuration:e,clipStartTime:t,effects:s,onAddEffect:i,onUpdateEffect:n,onRemoveEffect:a,onToggleEffect:o,onUpdateTiming:l,onPreviewEffect:d})=>{const[u,h]=v.useState(new Set),[p,f]=v.useState(""),m=v.useCallback(C=>{h(k=>{const S=new Set(k);return S.has(C)?S.delete(C):S.add(C),S})},[]),g=v.useCallback(()=>{if(!p)return;const C=`particle-${Date.now()}-${Math.random().toString(36).slice(2,11)}`,k=aX(p,C,r,t,e);k&&(i(k),h(S=>new Set(S).add(C)))},[p,r,t,e,i]),y=v.useCallback((C,k,S)=>{n(C,{[k]:S})},[n]),x=v.useCallback((C,k,S)=>{const A=t+S;l(C,A,k.duration)},[t,l]),b=v.useCallback((C,k,S)=>{l(C,k.startTime,S)},[l]),w=VP.reduce((C,k)=>(C[k.type]||(C[k.type]=[]),C[k.type].push(k),C),{});return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"flex gap-2",children:[c.jsxs(jt,{value:p,onValueChange:f,children:[c.jsx(vt,{className:"flex-1 h-8 text-xs min-w-0 [&>span]:truncate",children:c.jsx(_t,{placeholder:"Select effect preset..."})}),c.jsx(wt,{children:Object.entries(w).map(([C,k])=>c.jsxs("div",{children:[c.jsx("div",{className:"px-2 py-1.5 text-xs font-semibold text-text-muted uppercase tracking-wider",children:C}),k.map(S=>c.jsx(Ve,{value:S.id,textValue:S.name,children:S.name},S.id))]},C))})]}),c.jsxs(Et,{variant:"default",size:"sm",onClick:g,disabled:!p,className:"h-8 px-3",children:[c.jsx(wr,{size:14,className:"mr-1"}),"Add"]})]}),s.length===0?c.jsxs("div",{className:"text-center py-6 text-text-muted text-xs",children:[c.jsx(Zp,{size:24,className:"mx-auto mb-2 opacity-50"}),c.jsx("p",{children:"No particle effects added"}),c.jsx("p",{className:"mt-1 text-[10px]",children:"Select a preset above to add effects"})]}):c.jsx(oa,{className:"max-h-[400px]",children:c.jsx("div",{className:"space-y-2 pr-2",children:s.map(C=>{const k=C.startTime-t;return c.jsxs("div",{className:"bg-background-tertiary rounded-lg border border-border overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 px-3 py-2",children:[c.jsx("button",{onClick:()=>m(C.id),className:"p-0.5 rounded hover:bg-background-elevated text-text-muted",children:u.has(C.id)?c.jsx(ls,{size:14}):c.jsx(Js,{size:14})}),c.jsx("span",{className:"flex-1 text-xs font-medium text-text-primary capitalize",children:C.type}),d&&c.jsx("button",{onClick:()=>d(C.id),className:"p-1 rounded hover:bg-background-elevated text-text-muted hover:text-primary transition-colors",title:"Preview effect",children:c.jsx(ti,{size:12})}),c.jsx("button",{onClick:()=>o(C.id,!C.enabled),className:`p-1 rounded transition-colors ${C.enabled?"text-primary hover:bg-primary/20":"text-text-muted hover:bg-background-elevated"}`,title:C.enabled?"Disable":"Enable",children:C.enabled?c.jsx(Ur,{size:12}):c.jsx(ha,{size:12})}),c.jsx("button",{onClick:()=>a(C.id),className:"p-1 rounded hover:bg-red-500/20 text-text-muted hover:text-red-400 transition-colors",title:"Remove effect",children:c.jsx(Ss,{size:12})})]}),u.has(C.id)&&c.jsxs("div",{className:"px-3 pb-3 space-y-3 border-t border-border/50 pt-3",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx(ts,{className:"text-[10px] text-text-muted mb-1",children:"Start Time (s)"}),c.jsx(Ms,{type:"number",value:k.toFixed(1),onChange:S=>{const A=parseFloat(S.target.value);!isNaN(A)&&A>=0&&A<e&&x(C.id,C,A)},className:"h-7 text-xs",step:.1,min:0,max:e})]}),c.jsxs("div",{children:[c.jsx(ts,{className:"text-[10px] text-text-muted mb-1",children:"Duration (s)"}),c.jsx(Ms,{type:"number",value:C.duration.toFixed(1),onChange:S=>{const A=parseFloat(S.target.value);!isNaN(A)&&A>=.1&&b(C.id,C,A)},className:"h-7 text-xs",step:.1,min:.1})]})]}),c.jsxs(Xd,{children:[c.jsxs(Cp,{className:"flex items-center gap-1 text-[10px] text-text-muted hover:text-text-primary",children:[c.jsx(Js,{size:10,className:"transition-transform data-[state=open]:rotate-90"}),"Particle Settings"]}),c.jsxs(Kd,{className:"pt-2 space-y-3",children:[c.jsxs("div",{children:[c.jsxs(ts,{className:"text-[10px] text-text-muted mb-1",children:["Particle Count: ",C.config.particleCount]}),c.jsx(st,{value:[C.config.particleCount],onValueChange:([S])=>y(C.id,"particleCount",S),min:10,max:500,step:10,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ts,{className:"text-[10px] text-text-muted mb-1",children:["Speed: ",C.config.speed]}),c.jsx(st,{value:[C.config.speed],onValueChange:([S])=>y(C.id,"speed",S),min:10,max:500,step:10,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ts,{className:"text-[10px] text-text-muted mb-1",children:["Gravity: ",C.config.gravity]}),c.jsx(st,{value:[C.config.gravity],onValueChange:([S])=>y(C.id,"gravity",S),min:-500,max:500,step:10,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ts,{className:"text-[10px] text-text-muted mb-1",children:["Emission Rate: ",C.config.emissionRate]}),c.jsx(st,{value:[C.config.emissionRate],onValueChange:([S])=>y(C.id,"emissionRate",S),min:1,max:200,step:1,className:"w-full"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsxs(ts,{className:"text-[10px] text-text-muted mb-1",children:["Min Size: ",C.config.size.min]}),c.jsx(st,{value:[C.config.size.min],onValueChange:([S])=>y(C.id,"size",{...C.config.size,min:S}),min:1,max:20,step:1,className:"w-full"})]}),c.jsxs("div",{children:[c.jsxs(ts,{className:"text-[10px] text-text-muted mb-1",children:["Max Size: ",C.config.size.max]}),c.jsx(st,{value:[C.config.size.max],onValueChange:([S])=>y(C.id,"size",{...C.config.size,max:S}),min:1,max:30,step:1,className:"w-full"})]})]}),c.jsxs("div",{children:[c.jsxs(ts,{className:"text-[10px] text-text-muted mb-1",children:["Turbulence: ",C.config.turbulence]}),c.jsx(st,{value:[C.config.turbulence],onValueChange:([S])=>y(C.id,"turbulence",S),min:0,max:100,step:5,className:"w-full"})]}),c.jsxs("div",{children:[c.jsx(ts,{className:"text-[10px] text-text-muted mb-1",children:"Blend Mode"}),c.jsxs(jt,{value:C.config.blendMode,onValueChange:S=>y(C.id,"blendMode",S),children:[c.jsx(vt,{className:"h-7 text-xs",children:c.jsx(_t,{})}),c.jsxs(wt,{children:[c.jsx(Ve,{value:"normal",children:"Normal"}),c.jsx(Ve,{value:"add",children:"Additive"}),c.jsx(Ve,{value:"multiply",children:"Multiply"}),c.jsx(Ve,{value:"screen",children:"Screen"})]})]})]})]})]}),c.jsxs(Xd,{children:[c.jsxs(Cp,{className:"flex items-center gap-1 text-[10px] text-text-muted hover:text-text-primary",children:[c.jsx(Js,{size:10,className:"transition-transform data-[state=open]:rotate-90"}),"Colors (",C.config.colors.length,")"]}),c.jsx(Kd,{className:"pt-2",children:c.jsxs("div",{className:"flex flex-wrap gap-1",children:[C.config.colors.map((S,A)=>c.jsx(QJ,{color:S,onChange:T=>{const j=[...C.config.colors];j[A]=T,y(C.id,"colors",j)},onRemove:C.config.colors.length>1?()=>{const T=C.config.colors.filter((j,_)=>_!==A);y(C.id,"colors",T)}:void 0},A)),c.jsx("button",{onClick:()=>{const S=[...C.config.colors,"#ffffff"];y(C.id,"colors",S)},className:"w-6 h-6 rounded border border-dashed border-border flex items-center justify-center text-text-muted hover:text-text-primary hover:border-primary transition-colors",children:c.jsx(wr,{size:12})})]})})]})]})]},C.id)})})})]})},QJ=({color:r,onChange:e,onRemove:t})=>{const[s,i]=v.useState(!1),n=v.useRef(null);return c.jsxs(nM,{open:s,onOpenChange:i,children:[c.jsx(aM,{asChild:!0,children:c.jsx("button",{className:"w-6 h-6 rounded border border-border cursor-pointer hover:ring-2 hover:ring-primary/50 transition-all",style:{backgroundColor:r}})}),c.jsx(kb,{side:"top",align:"start",className:"w-auto p-2",children:c.jsxs("div",{className:"space-y-2",children:[c.jsx("input",{ref:n,type:"color",value:r,onChange:a=>e(a.target.value),className:"w-32 h-24 cursor-pointer border-0 p-0"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ms,{type:"text",value:r,onChange:a=>{const o=a.target.value;/^#[0-9A-Fa-f]{6}$/.test(o)&&e(o)},className:"h-7 text-xs font-mono flex-1",placeholder:"#ffffff"}),t&&c.jsx("button",{onClick:()=>{t(),i(!1)},className:"p-1.5 rounded hover:bg-red-500/20 text-text-muted hover:text-red-400 transition-colors",title:"Remove color",children:c.jsx(Ss,{size:12})})]})]})})]})},Gn=new SM({width:1920,height:1080}),ct=({title:r,defaultOpen:e=!1,sectionId:t,children:s})=>{const[i,n]=Ye.useState(e);return c.jsxs("div",{className:"mb-6 transition-all","data-section-id":t,children:[c.jsxs("button",{onClick:()=>n(!i),className:"flex items-center gap-2 text-text-secondary hover:text-text-primary transition-colors mb-3 w-full group",children:[c.jsx(ls,{size:12,className:`transition-transform duration-200 ${i?"":"-rotate-90"} text-text-muted group-hover:text-text-primary`}),c.jsx("span",{className:"text-xs font-medium",children:r})]}),i&&c.jsx("div",{className:"animate-in slide-in-from-top-2 duration-200",children:s})]})},JJ=()=>c.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center opacity-50",children:[c.jsx("p",{className:"text-sm text-text-secondary mb-2",children:"No selection"}),c.jsx("p",{className:"text-xs text-text-muted",children:"Select a clip to view its properties"})]}),ZJ=({clipId:r,clipDuration:e,clipStartTime:t})=>{const[s,i]=Ye.useState(0),n=Ye.useMemo(()=>eu(),[]),a=Ye.useMemo(()=>n.getEffectsForClip(r),[r,n,s]),o=Ye.useCallback(p=>{n.addEffect(p),i(f=>f+1)},[n]),l=Ye.useCallback((p,f)=>{n.updateEffect(p,f),i(m=>m+1)},[n]),d=Ye.useCallback(p=>{n.removeEffect(p),i(f=>f+1)},[n]),u=Ye.useCallback((p,f)=>{n.toggleEffect(p,f),i(m=>m+1)},[n]),h=Ye.useCallback((p,f,m)=>{n.updateEffectTiming(p,f,m),i(g=>g+1)},[n]);return c.jsx(KJ,{clipId:r,clipDuration:e,clipStartTime:t,effects:a,onAddEffect:o,onUpdateEffect:l,onRemoveEffect:d,onToggleEffect:u,onUpdateTiming:h})},eZ=()=>{const{getClip:r,getMediaItem:e,addSubtitle:t,updateSubtitle:s,getSubtitle:i}=W(),n=W(z=>z.project),{getSelectedClipIds:a}=Ft(),o=Ft(z=>z.selectedItems),l=a(),d=fe(z=>z.getTitleEngine),u=fe(z=>z.getGraphicsEngine),[h,p]=v.useState(null),[f,m]=v.useState(!1),[g,y]=v.useState("word-highlight"),x=v.useMemo(()=>o.find(Ue=>Ue.type==="subtitle")?.id||null,[o]),b=v.useMemo(()=>x&&i(x)||null,[x,i,n.timeline.subtitles]),w=v.useMemo(()=>{if(l.length!==1)return null;const z=l[0],Ue=r(z);if(Ue)return Ue;const ge=d()?.getTextClip(z);if(ge)return{id:ge.id,mediaId:`text-${ge.id}`,startTime:ge.startTime,duration:ge.duration,inPoint:0,outPoint:ge.duration,transform:ge.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],text:ge.text,trackId:ge.trackId};const Ce=u(),He=Ce?.getShapeClip(z);if(He)return{id:He.id,mediaId:`shape-${He.id}`,startTime:He.startTime,duration:He.duration,inPoint:0,outPoint:He.duration,transform:He.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],shapeType:He.shapeType,trackId:He.trackId};const Ze=Ce?.getSVGClip(z);if(Ze)return{id:Ze.id,mediaId:`svg-${Ze.id}`,startTime:Ze.startTime,duration:Ze.duration,inPoint:0,outPoint:Ze.duration,transform:Ze.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],svgContent:Ze.svgContent,trackId:Ze.trackId};const Mt=Ce?.getStickerClip(z);return Mt?{id:Mt.id,mediaId:`sticker-${Mt.id}`,startTime:Mt.startTime,duration:Mt.duration,inPoint:0,outPoint:Mt.duration,transform:Mt.transform||{position:{x:0,y:0},scale:{x:1,y:1},rotation:0,anchor:{x:.5,y:.5},opacity:1},effects:[],imageUrl:Mt.imageUrl,trackId:Mt.trackId}:null},[l,r,d,u,n.modifiedAt]),[C,k]=Ye.useReducer(z=>z+1,0),S=w?.id||"",A=v.useMemo(()=>S?Gn.getSettings(S):null,[S,C]),T=W(z=>z.updateClipTransform),j=W(z=>z.updateShapeTransform),_=v.useCallback(z=>{w&&(w.mediaId.startsWith("shape-")||w.mediaId.startsWith("svg-")?j(w.id,z):T(w.id,z))},[w,T,j]),M=v.useCallback(z=>{w&&(z?Gn.enableChromaKey(w.id):Gn.disableChromaKey(w.id),k())},[w]),P=v.useCallback(z=>{if(!w)return;const Ue=z.replace("#",""),Je=parseInt(Ue.substring(0,2),16)/255,ge=parseInt(Ue.substring(2,4),16)/255,Ce=parseInt(Ue.substring(4,6),16)/255;Gn.setKeyColor(w.id,{r:Je,g:ge,b:Ce}),k()},[w]),R=v.useCallback(z=>{w&&(Gn.setTolerance(w.id,z/100),k())},[w]),{addVideoEffect:D,updateVideoEffect:B}=W(),O=v.useCallback(()=>{w&&(Gn.enableChromaKey(w.id),Gn.setKeyColor(w.id,{r:0,g:1,b:0}),Gn.setTolerance(w.id,.35),k())},[w]),[F,I]=v.useState(!1),[J,Z]=v.useState(!1),E=v.useCallback(async()=>{if(w){I(!0);try{await tN();const z=Nr(),Ue=ud.map((Ce,He)=>{let Ze=0;return He===0&&(Ze=-3),He===1&&(Ze=2),He===2&&(Ze=4),He===3&&(Ze=3),He===4&&(Ze=-2),{...Ce,gain:Ze}}),Je=z.applyEQ(w.id,Ue),ge=z.applyCompressor(w.id,{threshold:-18,ratio:3,attack:.005,release:.15});Je.success&&ge.success&&(Z(!0),setTimeout(()=>Z(!1),2e3)),k()}catch(z){console.error("Failed to enhance audio:",z)}finally{I(!1)}}},[w,k]),G=v.useCallback(()=>{if(!w)return;D(w.id,"saturation"),D(w.id,"contrast"),D(w.id,"brightness");const z=W.getState().getVideoEffects(w.id),Ue=z.find(Ce=>Ce.type==="saturation"),Je=z.find(Ce=>Ce.type==="contrast"),ge=z.find(Ce=>Ce.type==="brightness");Ue&&B(w.id,Ue.id,{value:1.15}),Je&&B(w.id,Je.id,{value:1.1}),ge&&B(w.id,ge.id,{value:5})},[w,D,B]),V=v.useCallback(async()=>{if(!w||f)return;const z=e(w.mediaId);if(!z){console.error("[Subtitles] No media item found for clip");return}m(!0),p({phase:"extracting",progress:0,message:"Preparing audio..."});try{let Ue=pY();Ue||(Ue=fY({apiEndpoint:"https://transcribe.openreel.video"}));const Je=r(w.id);if(!Je)throw new Error("Could not find clip data");const ge=await Ue.transcribeClip(Je,z,p);for(const Ce of ge)t({...Ce,animationStyle:g});p({phase:"complete",progress:100,message:`Added ${ge.length} subtitles`}),setTimeout(()=>{p(null),m(!1)},2e3)}catch(Ue){console.error("[Subtitles] Transcription failed:",Ue),p({phase:"error",progress:0,message:Ue instanceof Error?Ue.message:"Transcription failed"}),setTimeout(()=>{p(null),m(!1)},3e3)}},[w,f,e,r,t,g]),U={position:{x:0,y:0},scale:{x:1,y:1},rotation:0,opacity:1,borderRadius:0},oe=w?.transform||U,re=A?.enabled||!1,ne=A?`#${Math.round(A.keyColor.r*255).toString(16).padStart(2,"0")}${Math.round(A.keyColor.g*255).toString(16).padStart(2,"0")}${Math.round(A.keyColor.b*255).toString(16).padStart(2,"0")}`:"#00ff00",Ee=(A?.tolerance||.3)*100,K=v.useMemo(()=>{if(!w)return null;if(w.mediaId.startsWith("text-"))return"text";if(w.mediaId.startsWith("shape-"))return"shape";if(w.mediaId.startsWith("svg-"))return"svg";if(w.mediaId.startsWith("sticker-")||w.mediaId.startsWith("emoji-"))return"sticker";const z=n.timeline.tracks.find(Je=>Je.clips.some(ge=>ge.id===w.id));if(!z)return"video";const Ue=n.mediaLibrary.items.find(Je=>Je.id===w.mediaId);return z.type==="audio"?"audio":z.type==="image"||Ue?.type==="image"?"image":"video"},[w,n.timeline.tracks,n.mediaLibrary.items]),me=K==="video"||K==="image",$=K==="video"||K==="image",Q=K==="video"||K==="audio",le=K==="text",ke=K==="shape",de=K==="svg",ae=K==="video"||K==="image",Pe=K==="video"||K==="image"||K==="text"||K==="shape"||K==="svg"||K==="sticker";return c.jsx("div",{"data-tour":"inspector",className:"w-80 bg-background-secondary border-l border-border flex flex-col overflow-y-auto h-full custom-scrollbar",children:c.jsxs("div",{className:"p-5",children:[c.jsx("h3",{className:"text-sm font-bold text-text-primary mb-5 tracking-tight",children:"Inspector"}),w?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"mb-4 p-3 bg-background-tertiary rounded-lg border border-border",children:[c.jsxs("p",{className:"text-xs text-text-primary font-medium truncate",children:[w.id.substring(0,20),"..."]}),c.jsxs("p",{className:"text-[10px] text-text-muted",children:["Duration: ",w.duration.toFixed(2),"s"]})]}),K==="video"&&c.jsx(ct,{title:"AI Auto-Captions",sectionId:"auto-captions",defaultOpen:!1,children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] text-text-secondary block mb-1",children:"Animation Style"}),c.jsxs(jt,{value:g,onValueChange:z=>y(z),disabled:f,children:[c.jsx(vt,{className:"w-full bg-background-secondary border-border text-text-primary text-[11px]",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:SC.map(z=>c.jsx(Ve,{value:z,children:CC(z)},z))})]})]}),h?c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx(Ci,{size:12,className:"animate-spin text-primary"}),c.jsx("span",{className:"text-[10px] text-text-primary",children:h.message})]}),c.jsx("div",{className:"h-1.5 bg-background-tertiary rounded-full overflow-hidden",children:c.jsx("div",{className:`h-full transition-all duration-300 ${h.phase==="error"?"bg-red-500":h.phase==="complete"?"bg-green-500":"bg-primary"}`,style:{width:`${h.progress}%`}})})]}):c.jsxs("button",{onClick:V,disabled:f,className:"w-full py-2 bg-primary hover:bg-primary/80 text-black rounded-lg text-[11px] font-medium transition-all flex items-center justify-center gap-2",children:[c.jsx(Mw,{size:14}),"Generate Captions"]})]})}),K==="video"&&c.jsx(ct,{title:"Output Size",sectionId:"output-size",defaultOpen:!1,children:c.jsx(XJ,{clipId:S})}),Q&&c.jsx(ct,{title:"Auto Cut Silence",sectionId:"auto-cut-silence",defaultOpen:!1,children:c.jsx(yJ,{clipId:S})}),K==="audio"&&c.jsx(ct,{title:"Beat Sync",sectionId:"beat-sync",defaultOpen:!1,children:c.jsx(ZQ,{clipId:S})}),Pe&&c.jsx(ct,{title:"Transform",sectionId:"transform",children:c.jsxs("div",{className:"space-y-3",children:[c.jsx(ht,{label:"Position X",value:oe.position.x,onChange:z=>_({position:{...oe.position,x:z}}),min:-1920,max:1920,step:1,unit:"px"}),c.jsx(ht,{label:"Position Y",value:oe.position.y,onChange:z=>_({position:{...oe.position,y:z}}),min:-1080,max:1080,step:1,unit:"px"}),c.jsx(ht,{label:"Scale X",value:oe.scale.x*100,onChange:z=>_({scale:{...oe.scale,x:z/100}}),min:0,max:300,step:1,unit:"%"}),c.jsx(ht,{label:"Scale Y",value:oe.scale.y*100,onChange:z=>_({scale:{...oe.scale,y:z/100}}),min:0,max:300,step:1,unit:"%"}),c.jsx(ht,{label:"Rotation",value:oe.rotation,onChange:z=>_({rotation:z}),min:-180,max:180,step:1,unit:""}),c.jsx(ht,{label:"Opacity",value:oe.opacity*100,onChange:z=>_({opacity:z/100}),min:0,max:100,step:1,unit:"%"}),c.jsx(ht,{label:"Border Radius",value:oe.borderRadius||0,onChange:z=>_({borderRadius:z}),min:0,max:200,step:1,unit:"px"}),K==="image"&&c.jsxs("div",{className:"space-y-1 pt-2 border-t border-border",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Fit Mode"}),c.jsx("div",{className:"grid grid-cols-4 gap-1",children:["contain","cover","stretch","none"].map(z=>c.jsx("button",{onClick:()=>_({fitMode:z}),className:`py-1.5 rounded text-[9px] capitalize transition-colors ${(oe.fitMode||"none")===z?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:z==="contain"?"Fit":z==="cover"?"Fill":z},z))})]})]})}),ae&&w&&!w.mediaId.startsWith("text-")&&!w.mediaId.startsWith("shape-")&&!w.mediaId.startsWith("svg-")&&!w.mediaId.startsWith("sticker-")&&c.jsx(ct,{title:"Crop",sectionId:"crop",defaultOpen:!1,children:c.jsx(vQ,{clip:w})}),ae&&w&&!w.mediaId.startsWith("text-")&&!w.mediaId.startsWith("shape-")&&!w.mediaId.startsWith("svg-")&&!w.mediaId.startsWith("sticker-")&&c.jsx(ct,{title:"Speed & Direction",sectionId:"speed",defaultOpen:!0,children:c.jsx(kQ,{clip:w})}),(K==="video"||K==="image"||K==="text"||K==="shape"||K==="svg"||K==="sticker")&&c.jsx(ct,{title:"Blending",sectionId:"blending",defaultOpen:!1,children:c.jsx(AJ,{clipId:S})}),(K==="video"||K==="image"||K==="text"||K==="shape"||K==="svg"||K==="sticker")&&c.jsx(ct,{title:"3D Transforms",sectionId:"transform-3d",defaultOpen:!1,children:c.jsx(jJ,{clipId:S})}),c.jsx(ct,{title:"Keyframes",sectionId:"keyframes",children:c.jsx(TJ,{clipId:S})}),(K==="video"||K==="image"||K==="text"||K==="shape"||K==="svg"||K==="sticker")&&c.jsx(ct,{title:"Entry/Exit Transitions",sectionId:"transitions",defaultOpen:!1,children:c.jsx(wJ,{clipId:S})}),(K==="video"||K==="image"||K==="shape"||K==="svg"||K==="sticker")&&c.jsx(ct,{title:"Motion Presets",sectionId:"motion-presets",defaultOpen:!1,children:c.jsx(zJ,{clipId:S})}),(K==="video"||K==="image"||K==="text"||K==="shape"||K==="svg"||K==="sticker")&&c.jsx(ct,{title:"Motion Path",sectionId:"motion-path",defaultOpen:!1,children:c.jsx(VJ,{clipId:S})}),(K==="video"||K==="image"||K==="text"||K==="shape"||K==="svg"||K==="sticker")&&w&&c.jsx(ct,{title:"Particle Effects",sectionId:"particle-effects",defaultOpen:!1,children:c.jsx(ZJ,{clipId:S,clipDuration:w.duration,clipStartTime:w.startTime})}),(K==="video"||K==="image"||K==="text"||K==="shape"||K==="svg"||K==="sticker")&&c.jsx(ct,{title:"Emphasis Animation",sectionId:"emphasis-animation",defaultOpen:!1,children:c.jsx(UJ,{clipId:S})}),ae&&c.jsx(ct,{title:"Chroma Key (Green Screen)",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Enable"}),c.jsx(ya,{checked:re,onCheckedChange:M})]}),re&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Key Color"}),c.jsx("input",{type:"color",value:ne,onChange:z=>P(z.target.value),className:"w-8 h-6 rounded border border-border cursor-pointer"})]}),c.jsx(ht,{label:"Tolerance",value:Ee,onChange:R,unit:"%"})]})]})}),ae&&c.jsx(ct,{title:"Motion Tracking",sectionId:"motion-tracking",children:c.jsx(WJ,{clipId:S})}),me&&c.jsx(ct,{title:"Video Effects",sectionId:"video-effects",children:c.jsx(rQ,{clipId:S})}),me&&c.jsx(ct,{title:"Green Screen",sectionId:"green-screen",defaultOpen:!1,children:c.jsx(cQ,{clipId:S})}),ae&&c.jsx(ct,{title:"Picture-in-Picture",sectionId:"pip",defaultOpen:!1,children:c.jsx(pQ,{clipId:S})}),ae&&c.jsx(ct,{title:"Masking",sectionId:"masking",defaultOpen:!1,children:c.jsx(uQ,{clipId:S})}),ae&&c.jsx(ct,{title:"Nested Sequences",defaultOpen:!1,children:c.jsx(YJ,{clipId:S})}),ae&&c.jsx(ct,{title:"Adjustment Layers",defaultOpen:!1,children:c.jsx(qJ,{clipId:S})}),$&&c.jsx(ct,{title:"Color Grading",sectionId:"color-grading",defaultOpen:!1,children:c.jsx(RQ,{clipId:S})}),Q&&c.jsx(ct,{title:"Audio Effects",sectionId:"audio-effects",defaultOpen:!1,children:c.jsx(mJ,{clipId:S})}),Q&&c.jsx(ct,{title:"Audio Ducking",sectionId:"audio-ducking",defaultOpen:!1,children:c.jsx(gJ,{clipId:S})}),le&&c.jsx(ct,{title:"Text Properties",sectionId:"text-properties",children:c.jsx(BQ,{clipId:S})}),le&&c.jsx(ct,{title:"Text Animation",sectionId:"text-animation",defaultOpen:!1,children:c.jsx($Q,{clipId:S})}),ke&&c.jsx(ct,{title:"Shape Properties",sectionId:"shape-properties",children:c.jsx(sJ,{clipId:S})}),de&&c.jsx(ct,{title:"SVG Properties",children:c.jsx(rJ,{clipId:S})}),(ae||Q||me)&&c.jsxs("div",{className:"border border-primary/30 bg-primary/5 rounded-xl p-4 relative overflow-hidden",children:[c.jsxs("div",{className:"flex items-center gap-2 text-primary mb-3",children:[c.jsx(ci,{size:14}),c.jsx("span",{className:"text-xs font-bold",children:"Quick Actions"})]}),c.jsxs("div",{className:"space-y-2",children:[ae&&c.jsx("button",{onClick:O,className:"w-full py-2 bg-background-tertiary hover:bg-primary hover:text-white border border-border hover:border-primary rounded-lg text-[10px] transition-all",children:"Remove Background"}),Q&&c.jsx("button",{onClick:E,disabled:F,className:`w-full py-2 border rounded-lg text-[10px] transition-all flex items-center justify-center gap-1.5 ${J?"bg-green-500/20 border-green-500 text-green-400":F?"bg-background-tertiary border-border text-text-muted cursor-not-allowed":"bg-background-tertiary hover:bg-primary hover:text-white border-border hover:border-primary"}`,children:F?c.jsxs(c.Fragment,{children:[c.jsx(Ci,{size:12,className:"animate-spin"}),"Enhancing..."]}):J?" Enhanced":"Enhance Audio"}),me&&c.jsx("button",{onClick:G,className:"w-full py-2 bg-background-tertiary hover:bg-primary hover:text-white border border-border hover:border-primary rounded-lg text-[10px] transition-all",children:"Auto-Color"})]})]})]}):b?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"mb-4 p-3 bg-primary/10 rounded-lg border border-primary/30",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[c.jsx(Mw,{size:14,className:"text-primary"}),c.jsx("span",{className:"text-xs font-bold text-primary",children:"Subtitle"})]}),c.jsxs("p",{className:"text-[10px] text-text-muted",children:[b.startTime.toFixed(2),"s -"," ",b.endTime.toFixed(2),"s"]})]}),c.jsx(ct,{title:"Text Content",children:c.jsx("div",{className:"space-y-3",children:c.jsx("textarea",{value:b.text,onChange:z=>s(b.id,{text:z.target.value}),className:"w-full h-24 px-3 py-2 bg-background-tertiary border border-border rounded-lg text-xs text-text-primary resize-none focus:outline-none focus:border-primary",placeholder:"Enter subtitle text..."})})}),c.jsx(ct,{title:"Timing",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Start Time"}),c.jsx(Ms,{type:"number",step:"0.1",value:b.startTime.toFixed(2),onChange:z=>s(b.id,{startTime:parseFloat(z.target.value)||0}),className:"w-20 h-7 text-[10px] bg-background-tertiary border-border text-text-primary text-right"})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"End Time"}),c.jsx(Ms,{type:"number",step:"0.1",value:b.endTime.toFixed(2),onChange:z=>s(b.id,{endTime:parseFloat(z.target.value)||0}),className:"w-20 h-7 text-[10px] bg-background-tertiary border-border text-text-primary text-right"})]})]})}),c.jsx(ct,{title:"Position",children:c.jsx("div",{className:"grid grid-cols-3 gap-2",children:["top","center","bottom"].map(z=>c.jsx("button",{onClick:()=>s(b.id,{style:{...b.style||{},position:z}}),className:`py-1.5 rounded text-[10px] capitalize transition-colors ${(b.style?.position||"bottom")===z?"bg-primary text-white":"bg-background-tertiary border border-border text-text-secondary hover:text-text-primary"}`,children:z},z))})}),c.jsx(ct,{title:"Animation",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Style"}),c.jsxs(jt,{value:b.animationStyle||"none",onValueChange:z=>s(b.id,{animationStyle:z}),children:[c.jsx(vt,{className:"w-auto min-w-[100px] bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(_t,{})}),c.jsx(wt,{className:"bg-background-secondary border-border",children:SC.map(z=>c.jsx(Ve,{value:z,children:CC(z)},z))})]})]}),c.jsxs("p",{className:"text-[9px] text-text-muted",children:[b.animationStyle==="karaoke"&&"Words fill with color as they're spoken",b.animationStyle==="word-highlight"&&"Current word is highlighted and scaled",b.animationStyle==="word-by-word"&&"Shows one word at a time",b.animationStyle==="bounce"&&"Words bounce in as they appear",b.animationStyle==="typewriter"&&"Words appear progressively like typing",(!b.animationStyle||b.animationStyle==="none")&&"Static text, no animation"]}),b.animationStyle&&b.animationStyle!=="none"&&!b.words?.length&&c.jsx("p",{className:"text-[9px] text-amber-400 bg-amber-400/10 p-2 rounded",children:" No word-level timing data. Re-generate captions to enable animation."}),b.animationStyle&&b.animationStyle!=="none"&&b.animationStyle!=="typewriter"&&b.animationStyle!=="word-by-word"&&c.jsxs("div",{className:"pt-2 border-t border-border space-y-2",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Highlight Color"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:b.style?.highlightColor||"#ffff00",onChange:z=>s(b.id,{style:{...b.style||{},highlightColor:z.target.value}}),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[9px] font-mono text-text-muted uppercase",children:b.style?.highlightColor||"#ffff00"})]})]}),c.jsx("div",{className:"grid grid-cols-6 gap-1",children:["#ffff00","#00ff00","#ff6b6b","#4ecdc4","#ff9f43","#a55eea"].map(z=>c.jsx("button",{onClick:()=>s(b.id,{style:{...b.style||{},highlightColor:z}}),className:`w-6 h-6 rounded border-2 transition-transform hover:scale-110 ${(b.style?.highlightColor||"#ffff00")===z?"border-white":"border-transparent"}`,style:{backgroundColor:z}},z))})]})]})}),c.jsx(ct,{title:"Font",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Font Family"}),c.jsxs(jt,{value:b.style?.fontFamily||"Inter",onValueChange:z=>s(b.id,{style:{...b.style||{},fontFamily:z}}),children:[c.jsx(vt,{className:"max-w-[120px] bg-background-tertiary border-border text-text-primary text-[10px]",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border max-h-60",children:[c.jsxs(id,{children:[c.jsx(mc,{className:"text-text-muted text-[10px] font-medium",children:"Popular"}),["Inter","Poppins","Montserrat","Roboto","Open Sans","Lato","DM Sans"].map(z=>c.jsx(Ve,{value:z,style:{fontFamily:z},children:z},z))]}),c.jsxs(id,{children:[c.jsx(mc,{className:"text-text-muted text-[10px] font-medium",children:"Display"}),["Bebas Neue","Anton","Oswald","Teko","Staatliches","Alfa Slab One"].map(z=>c.jsx(Ve,{value:z,style:{fontFamily:z},children:z},z))]}),c.jsxs(id,{children:[c.jsx(mc,{className:"text-text-muted text-[10px] font-medium",children:"Elegant"}),["Playfair Display","Cinzel","Lora","Merriweather","DM Serif Display"].map(z=>c.jsx(Ve,{value:z,style:{fontFamily:z},children:z},z))]}),c.jsxs(id,{children:[c.jsx(mc,{className:"text-text-muted text-[10px] font-medium",children:"Handwritten"}),["Pacifico","Lobster","Dancing Script","Caveat","Permanent Marker"].map(z=>c.jsx(Ve,{value:z,style:{fontFamily:z},children:z},z))]})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Font Size"}),c.jsx(Ms,{type:"number",min:12,max:72,value:b.style?.fontSize||24,onChange:z=>s(b.id,{style:{...b.style||{},fontSize:parseInt(z.target.value)||24}}),className:"w-16 h-7 text-[10px] bg-background-tertiary border-border text-text-primary text-right"})]})]})}),c.jsx(ct,{title:"Colors",children:c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Text Color"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:b.style?.color||"#ffffff",onChange:z=>s(b.id,{style:{...b.style||{},color:z.target.value}}),className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsx("span",{className:"text-[10px] font-mono text-text-muted uppercase",children:b.style?.color||"#ffffff"})]})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-[10px] text-text-secondary",children:"Background"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"color",value:b.style?.backgroundColor?.replace(/rgba?\([^)]+\)/,"#000000")||"#000000",onChange:z=>{const Ue=z.target.value,Je=parseInt(Ue.slice(1,3),16),ge=parseInt(Ue.slice(3,5),16),Ce=parseInt(Ue.slice(5,7),16);s(b.id,{style:{...b.style||{},backgroundColor:`rgba(${Je}, ${ge}, ${Ce}, 0.7)`}})},className:"w-6 h-6 rounded border border-border cursor-pointer"}),c.jsxs(jt,{value:b.style?.backgroundColor?.includes("0.7")?"0.7":b.style?.backgroundColor?.includes("0.5")?"0.5":"1",onValueChange:z=>{const Je=(b.style?.backgroundColor||"rgba(0, 0, 0, 0.7)").replace(/[\d.]+\)$/,`${z})`);s(b.id,{style:{...b.style||{},backgroundColor:Je}})},children:[c.jsx(vt,{className:"w-auto min-w-[50px] bg-background-tertiary border-border text-text-primary text-[9px] h-6",children:c.jsx(_t,{})}),c.jsxs(wt,{className:"bg-background-secondary border-border",children:[c.jsx(Ve,{value:"0",children:"None"}),c.jsx(Ve,{value:"0.5",children:"50%"}),c.jsx(Ve,{value:"0.7",children:"70%"}),c.jsx(Ve,{value:"1",children:"100%"})]})]})]})]})]})}),c.jsx("div",{className:"pt-4 border-t border-border",children:c.jsx("button",{onClick:()=>{const{removeSubtitle:z}=W.getState();z(b.id)},className:"w-full py-2 bg-red-500/20 hover:bg-red-500/30 text-red-400 border border-red-500/30 rounded-lg text-[10px] transition-all",children:"Delete Subtitle"})})]}):c.jsx(JJ,{})]})})},tZ=(r,e,t,s,i,n)=>{if(!i.enabled)return{time:r,snapped:!1};const a=i.snapThreshold/n,o=[];if(i.snapToClips)for(const u of t)for(const h of u.clips)h.id!==e&&(o.push({time:h.startTime,type:"clip-start"}),o.push({time:h.startTime+h.duration,type:"clip-end"}));if(i.snapToPlayhead&&o.push({time:s,type:"playhead"}),i.snapToGrid){const u=Math.round(r/i.gridSize)*i.gridSize;o.push({time:u,type:"grid"})}let l,d=1/0;for(const u of o){const h=Math.abs(u.time-r);h<a&&h<d&&(d=h,l=u)}return l?{time:l.time,snapped:!0,snapPoint:l}:{time:r,snapped:!1}},sZ=(r,e)=>{if(!r||r.length===0)return"M0,20 L100,20";const t=Array.from(r),s=Math.max(1,Math.floor(t.length/e)),i=[];for(let n=0;n<e;n++){const a=Math.min(n*s,t.length-1),l=20-Math.abs(t[a]||0)*18;i.push(`${n===0?"M":"L"}${n},${l}`)}return i.join(" ")},sN=(r,e=30)=>{if(!isFinite(r)||isNaN(r)||r<0)return"00:00:00:00";const t=Math.floor(r/3600),s=Math.floor(r%3600/60),i=Math.floor(r%60),n=Math.floor(r%1*e);return`${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},iN=(r,e)=>{switch(r.type){case"video":return{label:`V${e+1}`,icon:pa,color:"bg-primary",textColor:"text-primary",bgLight:"bg-primary/20"};case"audio":return{label:`A${e+1}`,icon:vn,color:"bg-blue-500",textColor:"text-blue-400",bgLight:"bg-blue-500/20"};case"image":return{label:`I${e+1}`,icon:Eo,color:"bg-purple-500",textColor:"text-purple-400",bgLight:"bg-purple-500/20"};case"text":return{label:`T${e+1}`,icon:Os,color:"bg-amber-500",textColor:"text-amber-400",bgLight:"bg-amber-500/20"};case"graphics":return{label:`G${e+1}`,icon:yu,color:"bg-green-500",textColor:"text-green-400",bgLight:"bg-green-500/20"};default:return{label:`?${e+1}`,icon:zs,color:"bg-gray-500",textColor:"text-gray-400",bgLight:"bg-gray-500/20"}}},iZ=r=>{switch(r){case"video":return{bg:"bg-primary/10",border:"border-primary/30",text:"text-white/90",selectedText:"text-white"};case"audio":return{bg:"bg-blue-500/10",border:"border-blue-500/30",text:"text-text-secondary",selectedText:"text-blue-400"};case"image":return{bg:"bg-purple-500/10",border:"border-purple-500/30",text:"text-purple-300",selectedText:"text-purple-400"};default:return{bg:"bg-gray-500/10",border:"border-gray-500/30",text:"text-text-secondary",selectedText:"text-text-primary"}}},rZ=({position:r,pixelsPerSecond:e,scrollX:t,headerOffset:s})=>{const i=r*e-t;return i<0?null:c.jsxs("div",{className:"absolute top-0 bottom-0 z-50 pointer-events-none",style:{left:s,transform:`translateX(${i}px)`,willChange:"transform"},children:[c.jsx("div",{className:"absolute -translate-x-1/2",style:{top:"-1px"},children:c.jsx("svg",{width:"13",height:"14",viewBox:"0 0 13 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"drop-shadow-[0_0_8px_rgba(34,197,94,0.8)]",children:c.jsx("path",{d:"M0.5 0H12.5V8L6.5 14L0.5 8V0Z",fill:"#22c55e"})})}),c.jsx("div",{className:"absolute w-px bg-primary shadow-[0_0_10px_#22c55e]",style:{top:"13px",bottom:0,left:0}})]})},nZ=({pixelsPerSecond:r,scrollX:e,viewportWidth:t,onSeek:s,onScrubStart:i,onScrubEnd:n})=>{const a=v.useRef(null),[o,l]=v.useState(!1),[d,u]=v.useState(()=>zp().getState());v.useEffect(()=>zp().subscribe(u),[]);const h=r>0?r:100,p=e/h,f=(e+t)/h,m=v.useMemo(()=>{if(d.beatMarkers.length===0)return[];const A=1;return d.beatMarkers.filter(T=>T.time>=p-A&&T.time<=f+A)},[d.beatMarkers,p,f]),y=h>500?{minor:.01,major:.1,labelEvery:.5}:h>200?{minor:.05,major:.5,labelEvery:1}:h>100?{minor:.1,major:1,labelEvery:1}:h>50?{minor:.5,major:1,labelEvery:5}:h>20?{minor:1,major:5,labelEvery:5}:{minor:5,major:10,labelEvery:10},x=Math.floor(p/y.minor)*y.minor,b=Math.max(0,x),w=[];for(let A=b;A<=f+y.minor;A+=y.minor){if(A<0)continue;const T=Math.round(A*1e4)/1e4;if(!isFinite(T)||isNaN(T))continue;const j=T===0||Math.abs(T%y.major)<1e-4,_=T===0||Math.abs(T%y.labelEvery)<1e-4;w.push({time:T,isMajor:j,showLabel:_})}const C=v.useRef(e);C.current=e;const k=v.useCallback(A=>{const T=a.current?.parentElement?.parentElement;if(!T)return 0;const j=T.getBoundingClientRect(),_=A.clientX-j.left+C.current;return Math.max(0,_/h)},[h]),S=v.useCallback(A=>{A.preventDefault(),A.stopPropagation(),l(!0),i?.();const T=k(A);s(T)},[k,s,i]);return v.useEffect(()=>{if(!o)return;const A=j=>{j.preventDefault();const _=k(j);s(_)},T=j=>{j.preventDefault(),l(!1),n?.()};return window.addEventListener("mousemove",A),window.addEventListener("mouseup",T),()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",T)}},[o,k,s,n]),c.jsxs("div",{ref:a,className:`h-8 border-b border-border flex items-end relative bg-background-secondary select-none ${o?"cursor-grabbing":"cursor-pointer"}`,onMouseDown:S,style:{cursor:o?"grabbing":"pointer"},children:[w.map(A=>c.jsx("div",{className:`absolute border-l pointer-events-none ${A.isMajor?"border-border h-4":"border-border/50 h-2"}`,style:{left:`${A.time*h}px`},children:A.showLabel&&A.time>=0&&c.jsx("span",{className:"text-[9px] font-mono text-text-muted pl-1 whitespace-nowrap",children:sN(Math.max(0,A.time)).slice(3)})},`tick-${A.time}`)),m.map(A=>c.jsx("div",{className:`absolute bottom-0 pointer-events-none ${A.isDownbeat?"w-[2px] h-5 bg-orange-500":"w-px h-3 bg-orange-400/50"}`,style:{left:`${A.time*h}px`}},`beat-ruler-${A.index}`)),d.beatAnalysis&&c.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1.5 bg-orange-500/20 px-2 py-0.5 rounded text-[9px] text-orange-400 font-medium pointer-events-none",children:[c.jsx("span",{className:"opacity-70",children:""}),c.jsxs("span",{children:[d.beatAnalysis.bpm," BPM"]})]})]})},aZ=({track:r,index:e,onDragStart:t,onDragOver:s,onDrop:i,keyframeCount:n=0})=>{const{lockTrack:a,hideTrack:o,muteTrack:l,removeTrack:d}=W(),{isTrackExpanded:u,toggleTrackExpanded:h}=$t(),p=u(r.id),f=iN(r,e),m=f.icon,g=r.type==="video"||r.type==="image"||r.type==="text"||r.type==="graphics",y=async()=>{await d(r.id)};return c.jsxs(of,{children:[c.jsx(cf,{asChild:!0,children:c.jsxs("div",{draggable:!0,onDragStart:x=>t(x,r.id),onDragOver:s,onDrop:x=>i(x,r.id),className:`h-20 border-b border-border flex flex-col justify-between py-2 px-3 relative group transition-colors cursor-grab active:cursor-grabbing ${r.hidden?"opacity-50":""} ${r.locked?"bg-background-secondary/50":"bg-background-tertiary"}`,children:[c.jsxs("div",{className:"flex items-center gap-2",children:[n>0&&c.jsx("button",{onClick:x=>{x.stopPropagation(),h(r.id)},className:"p-0.5 rounded transition-colors hover:bg-background-elevated text-text-muted",title:p?"Collapse keyframes":"Expand keyframes",children:p?c.jsx(ls,{size:12}):c.jsx(Js,{size:12})}),c.jsx("div",{className:`w-5 h-5 rounded flex items-center justify-center ${f.bgLight}`,children:c.jsx(m,{size:12,className:f.textColor})}),c.jsx("span",{className:`text-[11px] font-semibold truncate max-w-[70px] ${f.textColor}`,children:r.name||f.label}),n>0&&c.jsx("span",{className:"text-[8px] text-text-muted bg-background-elevated px-1 py-0.5 rounded",children:n})]}),c.jsxs("div",{className:"flex items-center gap-1 text-text-secondary",children:[g&&c.jsx("button",{onClick:x=>{x.stopPropagation(),o(r.id,!r.hidden)},className:`p-1 rounded transition-colors ${r.hidden?"text-yellow-500 bg-yellow-500/10":"text-text-muted hover:bg-background-elevated hover:text-text-primary"}`,title:r.hidden?"Show track":"Hide track",children:r.hidden?c.jsx(ha,{size:12}):c.jsx(Ur,{size:12})}),c.jsx("button",{onClick:x=>{x.stopPropagation(),l(r.id,!r.muted)},className:`p-1 rounded transition-colors ${r.muted?"text-red-500 bg-red-500/10":"text-text-muted hover:bg-background-elevated hover:text-text-primary"}`,title:r.muted?"Unmute":"Mute",children:c.jsx(vn,{size:12})}),c.jsx("button",{onClick:x=>{x.stopPropagation(),a(r.id,!r.locked)},className:`p-1 rounded transition-colors ${r.locked?"text-yellow-500 bg-yellow-500/10":"text-text-muted hover:bg-background-elevated hover:text-text-primary"}`,title:r.locked?"Unlock":"Lock",children:c.jsx(dO,{size:12})}),c.jsx("button",{onClick:x=>{x.stopPropagation(),y()},className:"p-1 rounded transition-colors hover:bg-red-500/20 text-red-400/50 hover:text-red-400",title:"Delete track",children:c.jsx(Ss,{size:12})})]}),c.jsx("div",{className:`absolute left-0 top-0 w-1 h-full ${f.color} opacity-60 group-hover:opacity-100 transition-opacity`})]})}),c.jsx(lf,{className:"min-w-[160px]",children:c.jsxs(mi,{onClick:y,className:"text-red-400 focus:text-red-400 hover:text-red-400",children:[c.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Delete Track"]})})]})},oZ=({clip:r,track:e,onClose:t})=>{const{copyClips:s,duplicateClip:i,removeClip:n,rippleDeleteClip:a,splitClip:o,separateAudio:l,getMediaItem:d,copyEffects:u,pasteEffects:h,copiedEffects:p}=W(),{playheadPosition:f}=$t(),m=f>=r.startTime&&f<=r.startTime+r.duration,g=d(r.mediaId),y=e.type==="video",x=e.type==="audio",b=e.type==="image",w=y&&g?.type==="video"&&g?.metadata?.channels&&g.metadata.channels>0,C=r.effects&&r.effects.length>0,k=p&&p.length>0,S=()=>{s([r.id]),t?.()},A=async()=>{await i(r.id),t?.()},T=async()=>{await n(r.id),t?.()},j=async()=>{await a(r.id),t?.()},_=async()=>{m&&await o(r.id,f),t?.()},M=async()=>{await l(r.id),t?.()},P=()=>{u(r.id),t?.()},R=async()=>{await h(r.id),t?.()},D=()=>y?"Video Clip":x?"Audio Clip":b?"Image Clip":"Clip",B=()=>y?c.jsx(pa,{className:"mr-2 h-3 w-3 text-primary"}):x?c.jsx(vn,{className:"mr-2 h-3 w-3 text-blue-400"}):b?c.jsx(Eo,{className:"mr-2 h-3 w-3 text-purple-400"}):null;return c.jsxs(lf,{className:"min-w-[220px]",children:[c.jsxs(wb,{className:"flex items-center text-[10px] text-text-muted",children:[B(),D()]}),c.jsx(ln,{}),c.jsxs(mi,{onClick:S,children:[c.jsx(Ao,{className:"mr-2 h-4 w-4"}),"Copy Clip",c.jsx(co,{children:"C"})]}),c.jsxs(mi,{onClick:A,children:[c.jsx(zs,{className:"mr-2 h-4 w-4"}),"Duplicate to New Track",c.jsx(co,{children:"D"})]}),c.jsx(ln,{}),c.jsxs(mi,{onClick:_,disabled:!m,children:[c.jsx(zx,{className:"mr-2 h-4 w-4"}),"Split at Playhead",c.jsx(co,{children:"S"})]}),(y||b)&&c.jsxs(c.Fragment,{children:[c.jsx(ln,{}),c.jsxs(rC,{children:[c.jsxs(Z0,{children:[c.jsx(Zp,{className:"mr-2 h-4 w-4"}),"Effects"]}),c.jsxs(ey,{children:[c.jsx(mi,{onClick:P,disabled:!C,children:"Copy Effects"}),c.jsx(mi,{onClick:R,disabled:!k,children:"Paste Effects"})]})]})]}),w&&c.jsxs(c.Fragment,{children:[c.jsx(ln,{}),c.jsxs(mi,{onClick:M,children:[c.jsx(Gr,{className:"mr-2 h-4 w-4"}),"Separate Audio"]})]}),x&&c.jsxs(c.Fragment,{children:[c.jsx(ln,{}),c.jsxs(rC,{children:[c.jsxs(Z0,{children:[c.jsx(vn,{className:"mr-2 h-4 w-4"}),"Audio"]}),c.jsxs(ey,{children:[c.jsx(mi,{onClick:P,disabled:!C,children:"Copy Audio Effects"}),c.jsx(mi,{onClick:R,disabled:!k,children:"Paste Audio Effects"})]})]})]}),c.jsx(ln,{}),c.jsxs(mi,{onClick:j,className:"text-red-400",children:[c.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Ripple Delete",c.jsx(co,{children:""})]}),c.jsxs(mi,{onClick:T,className:"text-red-400",children:[c.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Delete"]})]})},Z2=80,eS=10,cZ=5,lZ=({clip:r,track:e,allTracks:t,pixelsPerSecond:s,isSelected:i,trackHeights:n,timelineRef:a,onSelect:o,onMoveClip:l,onSnapIndicator:d,onTrimClip:u})=>{const{getMediaItem:h}=W(),{snapSettings:p}=Ft(),{playheadPosition:f}=$t(),m=h(r.mediaId),[g,y]=v.useState(!1),[x,b]=v.useState(!1),[w,C]=v.useState(0),[k,S]=v.useState(0),[A,T]=v.useState(!1),[j,_]=v.useState(!1),[M,P]=v.useState(null),R=v.useRef({mouseX:0,startTime:r.startTime,duration:r.duration}),D=v.useRef({mouseY:0,clipY:0,scrollTop:0}),B=v.useRef({x:0,y:0}),O=v.useRef({time:0}),F=v.useRef({active:!1,startX:0,startY:0}),I=v.useRef(null),J=r.startTime*s,Z=r.duration*s,E=e.type==="video",G=e.type==="audio",V=e.type==="image",U=iZ(e.type),oe=$=>{$.button===0&&(g||x||($.stopPropagation(),o(r.id,$.shiftKey||$.metaKey)))},re=$=>{if($.button!==0||e.locked||j)return;$.stopPropagation();const Q=I.current?.parentElement?.getBoundingClientRect(),le=I.current?.getBoundingClientRect();if(!Q||!le)return;const ke=$.clientX-Q.left,de=r.startTime*s;C(ke-de),D.current={mouseY:$.clientY,clipY:le.top-Q.top,scrollTop:a.current?.scrollTop||0},B.current={x:$.clientX,y:$.clientY},F.current={active:!0,startX:$.clientX,startY:$.clientY},S(0),T(!1),b(!0)},ne=$=>Q=>{Q.button===0&&(e.locked||!u||(Q.stopPropagation(),_(!0),P($),R.current={mouseX:Q.clientX,startTime:r.startTime,duration:r.duration},document.body.style.cursor="ew-resize"))};v.useEffect(()=>{if(!x)return;const $=le=>{const ke=le.clientX-F.current.startX,de=le.clientY-F.current.startY;Math.sqrt(ke*ke+de*de)>=cZ&&(F.current.active=!1,b(!1),y(!0))},Q=le=>{F.current.active=!1,b(!1),o(r.id,le.shiftKey||le.metaKey)};return window.addEventListener("mousemove",$),window.addEventListener("mouseup",Q),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",Q)}},[x,r.id,o]),v.useEffect(()=>{if(!g)return;let $=null;const Q=()=>{if(!a.current){$=requestAnimationFrame(Q);return}const de=a.current,ae=de.getBoundingClientRect(),Pe=B.current.y,z=ae.top,Ue=ae.bottom,Je=de.scrollTop>0,ge=de.scrollTop<de.scrollHeight-de.clientHeight,Ce=Pe-z,He=Ue-Pe;Ce<Z2&&Je?de.scrollTop-=eS:He<Z2&&ge&&(de.scrollTop+=eS),$=requestAnimationFrame(Q)};$=requestAnimationFrame(Q);const le=de=>{B.current.x=de.clientX,B.current.y=de.clientY;const ae=I.current?.parentElement?.getBoundingClientRect(),Pe=a.current?.getBoundingClientRect();if(!ae||!Pe)return;const z=de.clientX-ae.left-w,Ue=Math.max(0,z/s),Je=tZ(Ue,r.id,t,f,p,s),Ce=(a.current?.scrollTop||0)-D.current.scrollTop,He=de.clientY-D.current.mouseY+Ce;S(He);const Ze=a.current?.scrollTop||0,Mt=de.clientY-Pe.top+Ze;let ut,Ne,It=0;for(const si of t){const An=n.get(si.id)||60;if(Mt>=It&&Mt<It+An){Ne=si.type,si.type===e.type&&si.id!==e.id&&(ut=si.id);break}It+=An}const dr=Ne!==void 0&&Ne!==e.type;T(dr),O.current={time:Je.time,targetTrackId:ut},l(r.id,Je.time,void 0),d(Je.snapped?Je.time:null)},ke=()=>{$!==null&&cancelAnimationFrame($);const{time:de,targetTrackId:ae}=O.current;ae&&l(r.id,de,ae),y(!1),S(0),T(!1),d(null)};return window.addEventListener("mousemove",le),window.addEventListener("mouseup",ke),()=>{$!==null&&cancelAnimationFrame($),window.removeEventListener("mousemove",le),window.removeEventListener("mouseup",ke)}},[g,w,s,r.id,e.id,e.type,t,n,a,f,p,l,d]),v.useEffect(()=>{if(!j||!M||!u)return;const $=le=>{const de=(le.clientX-R.current.mouseX)/s;if(M==="left"){const ae=Math.max(0,R.current.startTime+de),Pe=R.current.startTime+R.current.duration-.1,z=Math.min(ae,Pe);u(r.id,"left",z)}else{const ae=R.current.startTime+R.current.duration+de,Pe=R.current.startTime+.1,z=Math.max(ae,Pe);u(r.id,"right",z)}},Q=()=>{_(!1),P(null),document.body.style.cursor=""};return window.addEventListener("mousemove",$),window.addEventListener("mouseup",Q),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",Q)}},[j,M,r.id,s,u]);const Ee=Math.max(1,Math.floor(Z/60)),K=m?.name||r.mediaId.slice(0,8),me=g||j;return c.jsxs(of,{children:[c.jsx(cf,{asChild:!0,children:c.jsxs("div",{ref:I,onClick:oe,onMouseDown:re,className:`group absolute top-1 bottom-1 rounded-lg overflow-hidden shadow-sm ${g?`cursor-grabbing z-50 ${A?"opacity-50 ring-2 ring-red-500 border-red-500":"opacity-90 shadow-xl"}`:"cursor-grab"} ${i&&!g?"ring-2 ring-primary border-primary z-10":g?"":"border-opacity-30 hover:border-opacity-60 hover:brightness-110"} ${U.bg} border ${U.border} ${e.locked?"cursor-not-allowed opacity-60":""}`,style:{transform:g?`translate(${J}px, ${k}px)`:`translateX(${J}px)`,width:`${Z}px`,willChange:me?"transform, width":"auto",transition:me?"none":"opacity 150ms, box-shadow 150ms",pointerEvents:g?"none":"auto"},children:[E&&(m?.filmstripThumbnails?.length||m?.thumbnailUrl)&&c.jsx("div",{className:"absolute inset-0 flex pointer-events-none",children:m?.filmstripThumbnails&&m.filmstripThumbnails.length>0?Array.from({length:Ee}).map(($,Q)=>{const le=Q/Math.max(1,Ee-1),ke=Math.min(Math.floor(le*m.filmstripThumbnails.length),m.filmstripThumbnails.length-1),de=m.filmstripThumbnails[ke];return c.jsx("div",{className:"flex-1 h-full bg-cover bg-center opacity-70",style:{backgroundImage:`url(${de.url})`,borderRight:Q<Ee-1?"1px solid rgba(0,0,0,0.2)":"none"}},Q)}):Array.from({length:Ee}).map(($,Q)=>c.jsx("div",{className:"flex-1 h-full bg-cover bg-center opacity-60",style:{backgroundImage:`url(${m.thumbnailUrl})`,borderRight:Q<Ee-1?"1px solid rgba(0,0,0,0.2)":"none"}},Q))}),E&&!m?.thumbnailUrl&&c.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/20 to-primary/10 pointer-events-none"}),V&&c.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-500/20 to-purple-500/10 flex items-center justify-center pointer-events-none",children:m?.thumbnailUrl?c.jsx("img",{src:m.thumbnailUrl,alt:K,className:"h-full object-cover opacity-60"}):c.jsx(Eo,{size:24,className:"text-purple-400/50"})}),c.jsx("div",{className:"w-full h-full flex flex-col justify-end px-2 pb-1 relative z-10 pointer-events-none",children:c.jsx("span",{className:`text-[10px] font-medium truncate drop-shadow-md ${i?U.selectedText:U.text}`,children:K})}),G&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute inset-0 flex items-center opacity-50 px-1 pointer-events-none",children:m?.waveformData?c.jsx("svg",{className:"w-full h-full",preserveAspectRatio:"none",viewBox:"0 0 100 40",children:c.jsx("path",{d:sZ(m.waveformData,100),stroke:"currentColor",className:"text-blue-400",fill:"none",strokeWidth:"1",vectorEffect:"non-scaling-stroke"})}):c.jsx("svg",{className:"w-full h-full",preserveAspectRatio:"none",children:c.jsx("path",{d:"M0,20 Q10,5 20,20 T40,20 T60,20 T80,20 T100,20",stroke:"currentColor",className:"text-blue-400",fill:"none",vectorEffect:"non-scaling-stroke"})})}),c.jsx("div",{className:"absolute inset-x-0 top-1 flex justify-center opacity-0 group-hover:opacity-60 transition-opacity pointer-events-none",children:c.jsxs("div",{className:"flex gap-0.5",children:[c.jsx("div",{className:"w-1 h-1 rounded-full bg-blue-300"}),c.jsx("div",{className:"w-1 h-1 rounded-full bg-blue-300"}),c.jsx("div",{className:"w-1 h-1 rounded-full bg-blue-300"})]})})]}),r.keyframes&&r.keyframes.length>0&&c.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-3 flex items-center pointer-events-none",children:r.keyframes.map($=>{const Q=$.time-r.startTime;if(Q<0||Q>r.duration)return null;const le=Q/r.duration*100;return c.jsx("div",{className:"absolute w-2 h-2 bg-yellow-400 rotate-45 border border-yellow-600",style:{left:`${le}%`,marginLeft:"-4px"},title:`${$.property} @ ${$.time.toFixed(2)}s`},$.id)})}),i&&c.jsx("div",{className:"absolute inset-0 border-2 border-primary rounded-lg pointer-events-none shadow-[inset_0_0_10px_rgba(34,197,94,0.2)]"}),(E||V||G)&&u&&c.jsxs(c.Fragment,{children:[c.jsx("div",{onMouseDown:ne("left"),className:`absolute left-0 top-0 bottom-0 w-3 cursor-ew-resize z-20 opacity-0 group-hover:opacity-100 transition-opacity ${G?"hover:bg-blue-400/50":E?"hover:bg-green-400/50":"hover:bg-purple-400/50"}`,onClick:$=>$.stopPropagation(),title:"Drag to adjust start"}),c.jsx("div",{onMouseDown:ne("right"),className:`absolute right-0 top-0 bottom-0 w-3 cursor-ew-resize z-20 opacity-0 group-hover:opacity-100 transition-opacity ${G?"hover:bg-blue-400/50":E?"hover:bg-green-400/50":"hover:bg-purple-400/50"}`,onClick:$=>$.stopPropagation(),title:"Drag to adjust end"})]})]})}),c.jsx(oZ,{clip:r,track:e})]})},rN=({clip:r,clipType:e,onClose:t,onDelete:s,onDuplicate:i})=>{const{deleteShapeClip:n,deleteSVGClip:a,deleteStickerClip:o,deleteTextClip:l}=W(),d=()=>{if(s)s();else switch(e){case"shape":n(r.id);break;case"svg":a(r.id);break;case"sticker":case"emoji":o(r.id);break;case"text":l(r.id);break}t?.()},u=()=>{i?.(),t?.()},h=()=>{switch(e){case"shape":return"Shape";case"svg":return"SVG";case"sticker":return"Sticker";case"emoji":return"Emoji";case"text":return"Text";default:return"Graphics"}},p=()=>{switch(e){case"text":return c.jsx(Os,{className:"mr-2 h-3 w-3 text-amber-400"});default:return c.jsx(yu,{className:"mr-2 h-3 w-3 text-green-400"})}};return c.jsxs(lf,{className:"min-w-[200px]",children:[c.jsxs(wb,{className:"flex items-center text-[10px] text-text-muted",children:[p(),h()," Clip"]}),c.jsx(ln,{}),i&&c.jsxs(c.Fragment,{children:[c.jsxs(mi,{onClick:u,children:[c.jsx(zs,{className:"mr-2 h-4 w-4"}),"Duplicate",c.jsx(co,{children:"D"})]}),c.jsx(ln,{})]}),c.jsxs(mi,{onClick:d,className:"text-red-400",children:[c.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Delete",c.jsx(co,{children:""})]})]})},dZ=({textClip:r,pixelsPerSecond:e,isSelected:t,onSelect:s,onTrim:i,onMoveClip:n})=>{const a=v.useRef(null),[o,l]=v.useState(null),[d,u]=v.useState(!1),[h,p]=v.useState(0),f=v.useRef({mouseX:0,startTime:r.startTime,duration:r.duration}),m=r.startTime*e,g=r.duration*e,y=C=>{C.button===0&&(o||d||(C.stopPropagation(),s(r.id,C.shiftKey||C.metaKey)))},x=C=>{if(C.button!==0||o)return;C.stopPropagation();const k=a.current?.parentElement?.getBoundingClientRect();if(!k)return;const S=C.clientX-k.left,A=r.startTime*e;p(S-A),u(!0),s(r.id,C.shiftKey||C.metaKey)};v.useEffect(()=>{if(!d||!n)return;const C=S=>{const A=a.current?.parentElement?.getBoundingClientRect();if(!A)return;const T=S.clientX-A.left-h,j=Math.max(0,T/e);n(r.id,j)},k=()=>{u(!1)};return window.addEventListener("mousemove",C),window.addEventListener("mouseup",k),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",k)}},[d,r.id,e,h,n]);const b=(C,k)=>{C.button===0&&(C.stopPropagation(),C.preventDefault(),l(k),f.current={mouseX:C.clientX,startTime:r.startTime,duration:r.duration},document.body.style.cursor="ew-resize",document.body.style.userSelect="none")};v.useEffect(()=>{if(!o)return;const C=S=>{const T=(S.clientX-f.current.mouseX)/e;if(o==="left"){const j=Math.max(0,f.current.startTime+T),_=f.current.startTime+f.current.duration-.1,M=Math.min(j,_);i(r.id,"left",M)}else{const j=f.current.startTime+f.current.duration+T,_=f.current.startTime+.1,M=Math.max(j,_);i(r.id,"right",M)}},k=()=>{l(null),document.body.style.cursor="",document.body.style.userSelect=""};return window.addEventListener("mousemove",C),window.addEventListener("mouseup",k),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",k)}},[o,r.id,e,i]);const w=d||o;return c.jsxs(of,{children:[c.jsx(cf,{asChild:!0,children:c.jsxs("div",{ref:a,onClick:y,onMouseDown:x,className:`absolute top-1 bottom-1 rounded-lg overflow-hidden cursor-grab group ${d?"cursor-grabbing opacity-75":""} ${t?"ring-2 ring-amber-400 border-amber-400 z-10":"border-amber-500/30 hover:border-amber-500/60 hover:brightness-110"} bg-amber-500/20 border`,style:{transform:`translateX(${m}px)`,width:`${Math.max(g,40)}px`,willChange:w?"transform, width":"auto",transition:w?"none":"opacity 150ms, box-shadow 150ms"},children:[c.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-amber-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:C=>b(C,"left"),title:"Drag to trim start"}),c.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-amber-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity",onMouseDown:C=>b(C,"right"),title:"Drag to trim end"}),c.jsxs("div",{className:"w-full h-full flex items-center gap-1 px-3",children:[c.jsx(Os,{size:12,className:"text-amber-400 flex-shrink-0"}),c.jsx("span",{className:"text-[10px] font-medium text-amber-200 truncate",children:r.text||"Text"})]}),t&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute inset-0 border-2 border-amber-400 rounded-lg pointer-events-none"}),c.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-amber-400 rounded-r cursor-ew-resize",onMouseDown:C=>b(C,"left")}),c.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-amber-400 rounded-l cursor-ew-resize",onMouseDown:C=>b(C,"right")})]})]})}),c.jsx(rN,{clip:r,clipType:"text"})]})},uZ=({shapeClip:r,pixelsPerSecond:e,isSelected:t,onSelect:s,onTrim:i,onMoveClip:n})=>{const a=v.useRef(null),[o,l]=v.useState(!1),[d,u]=v.useState(0),[h,p]=v.useState(null),f=v.useRef({mouseX:0,startTime:r.startTime,duration:r.duration}),m=r.startTime*e,g=r.duration*e,y=_=>{if(_.button!==0||h)return;_.stopPropagation();const M=a.current?.getBoundingClientRect();if(!M)return;const P=_.clientX-M.left;u(P),l(!0)},x=_=>{_.button===0&&(h||o||(_.stopPropagation(),s(r.id,_.shiftKey||_.metaKey)))},b=(_,M)=>{_.button===0&&(_.stopPropagation(),_.preventDefault(),p(M),f.current={mouseX:_.clientX,startTime:r.startTime,duration:r.duration},document.body.style.cursor="ew-resize",document.body.style.userSelect="none")};v.useEffect(()=>{if(!o)return;const _=P=>{const R=a.current?.parentElement;if(!R)return;const D=R.getBoundingClientRect(),O=(P.clientX-D.left-d)/e,F=Math.max(0,O);n(r.id,F)},M=()=>{l(!1)};return window.addEventListener("mousemove",_),window.addEventListener("mouseup",M),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",M)}},[o,d,e,r.id,n]),v.useEffect(()=>{if(!h)return;const _=P=>{const D=(P.clientX-f.current.mouseX)/e;if(h==="left"){const B=Math.max(0,f.current.startTime+D),O=f.current.startTime+f.current.duration-.1,F=Math.min(B,O);i(r.id,"left",F)}else{const B=f.current.startTime+f.current.duration+D,O=f.current.startTime+.1,F=Math.max(B,O);i(r.id,"right",F)}},M=()=>{p(null),document.body.style.cursor="",document.body.style.userSelect=""};return window.addEventListener("mousemove",_),window.addEventListener("mouseup",M),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",M)}},[h,r.id,e,i]);const w=r.type==="shape",C=r.type==="sticker"||r.type==="emoji",k=w&&"shapeType"in r?r.shapeType.charAt(0).toUpperCase()+r.shapeType.slice(1):C?r.type==="emoji"?"Emoji":"Sticker":"SVG",S=w?yu:C?t_:zc,A=w?"green":C?"pink":"purple",T=o||h,j=w?"shape":C?r.type==="emoji"?"emoji":"sticker":"svg";return c.jsxs(of,{children:[c.jsx(cf,{asChild:!0,children:c.jsxs("div",{ref:a,onClick:x,onMouseDown:y,className:`absolute top-1 bottom-1 rounded-lg overflow-hidden cursor-grab group ${o?"cursor-grabbing opacity-75":""} ${t?`ring-2 ring-${A}-400 border-${A}-400 z-10`:`border-${A}-500/30 hover:border-${A}-500/60 hover:brightness-110`} bg-${A}-500/20 border`,style:{transform:`translateX(${m}px)`,width:`${Math.max(g,40)}px`,willChange:T?"transform, width":"auto",transition:T?"none":"opacity 150ms, box-shadow 150ms"},children:[c.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-${A}-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity`,onMouseDown:_=>b(_,"left"),title:"Drag to trim start"}),c.jsx("div",{className:`absolute right-0 top-0 bottom-0 w-2 cursor-ew-resize hover:bg-${A}-400/50 z-20 opacity-0 group-hover:opacity-100 transition-opacity`,onMouseDown:_=>b(_,"right"),title:"Drag to trim end"}),c.jsxs("div",{className:"w-full h-full flex items-center gap-1 px-3",children:[c.jsx(S,{size:12,className:`text-${A}-400 flex-shrink-0`}),c.jsx("span",{className:`text-[10px] font-medium text-${A}-200 truncate`,children:k})]}),t&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"absolute inset-0 border-2 border-green-400 rounded-lg pointer-events-none"}),c.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-green-400 rounded-r cursor-ew-resize",onMouseDown:_=>b(_,"left")}),c.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-1.5 h-6 bg-green-400 rounded-l cursor-ew-resize",onMouseDown:_=>b(_,"right")})]})]})}),c.jsx(rN,{clip:r,clipType:j})]})},hZ=({keyframe:r,xPosition:e,color:t,isSelected:s,onSelect:i,onMove:n,onDelete:a})=>{const[o,l]=v.useState(!1),[d,u]=v.useState(0),h=v.useRef(null),p=v.useCallback(x=>{x.preventDefault(),x.stopPropagation();const b=x.shiftKey||x.metaKey||x.ctrlKey;i(b),l(!0),u(x.clientX)},[i]),f=v.useCallback(x=>{if(!o)return;const b=x.clientX-d;Math.abs(b)>2&&(n(b),u(x.clientX))},[o,d,n]),m=v.useCallback(()=>{l(!1)},[]);v.useEffect(()=>{if(o)return window.addEventListener("mousemove",f),window.addEventListener("mouseup",m),()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",m)}},[o,f,m]);const g=v.useCallback(x=>{x.preventDefault(),a()},[a]),y=v.useCallback(x=>{x.preventDefault(),x.stopPropagation()},[]);return c.jsxs("div",{ref:h,className:`absolute top-1/2 -translate-y-1/2 cursor-pointer transition-transform hover:scale-110 ${o?"scale-125 z-50":""}`,style:{left:e,transform:`translate(-50%, -50%) rotate(45deg) ${o?"scale(1.25)":""}`},onMouseDown:p,onContextMenu:g,onDoubleClick:y,children:[c.jsx("div",{className:`w-2.5 h-2.5 rounded-sm transition-all ${s?"ring-2 ring-white ring-offset-1 ring-offset-background-secondary":""}`,style:{backgroundColor:t,boxShadow:s?`0 0 8px ${t}`:"none"}}),s&&c.jsx("div",{className:"absolute -bottom-4 left-1/2 -translate-x-1/2 rotate-[-45deg] whitespace-nowrap",children:c.jsxs("span",{className:"text-[8px] text-text-muted bg-background-secondary/80 px-1 rounded",children:[r.time.toFixed(2),"s"]})})]})},pZ=({startX:r,endX:e,easing:t,color:s,height:i})=>{const n=v.useMemo(()=>{const o=e-r;if(o<=0)return"";const d={linear:"linear","ease-in":"easeInQuad","ease-out":"easeOutQuad","ease-in-out":"easeInOutQuad",bezier:"easeInOutCubic"}[t]||t,u=ni[d]||ni.linear,h=4,p=i-h*2,f=[],m=Math.min(32,Math.max(8,Math.floor(o/4)));for(let g=0;g<=m;g++){const y=g/m,x=y*o,b=u(y),w=h+p*(1-b);g===0?f.push(`M ${x} ${w}`):f.push(`L ${x} ${w}`)}return f.join(" ")},[r,e,t,i]),a=e-r;return a<=0?null:c.jsxs("svg",{className:"absolute top-0 pointer-events-none",style:{left:r,width:a,height:i},viewBox:`0 0 ${a} ${i}`,preserveAspectRatio:"none",children:[c.jsx("line",{x1:"0",y1:i/2,x2:a,y2:i/2,stroke:s,strokeWidth:"1",opacity:"0.2"}),c.jsx("path",{d:n,fill:"none",stroke:s,strokeWidth:"1.5",opacity:"0.6",strokeLinecap:"round",strokeLinejoin:"round"})]})},tS={"position.x":"#22d3ee","position.y":"#a78bfa","scale.x":"#4ade80","scale.y":"#86efac",rotation:"#f472b6",opacity:"#fbbf24",borderRadius:"#94a3b8",default:"#64748b"},fZ={"position.x":"Position X","position.y":"Position Y","scale.x":"Scale X","scale.y":"Scale Y",rotation:"Rotation",opacity:"Opacity",borderRadius:"Border Radius"},mZ=({clip:r,pixelsPerSecond:e,onKeyframeSelect:t,onKeyframeMove:s,onKeyframeDelete:i,selectedKeyframeIds:n})=>{const a=v.useMemo(()=>{const d=new Map;for(const u of r.keyframes){const h=d.get(u.property)||[];h.push(u),d.set(u.property,h)}return Array.from(d.entries()).map(([u,h])=>({property:u,keyframes:h.sort((p,f)=>p.time-f.time),color:tS[u]||tS.default,label:fZ[u]||u})).sort((u,h)=>u.label.localeCompare(h.label))},[r.keyframes]),o=v.useCallback((d,u)=>{const h=u/e,p=r.keyframes.find(m=>m.id===d);if(!p)return;const f=Math.max(0,Math.min(r.duration,p.time+h));s(d,f)},[r.keyframes,r.duration,e,s]);if(a.length===0)return c.jsx("div",{className:"h-8 flex items-center justify-center text-[9px] text-text-muted",children:"No keyframes"});const l=24;return c.jsx("div",{className:"bg-background-tertiary/30 border-t border-border/30",children:a.map(d=>c.jsxs("div",{className:"relative border-b border-border/20 last:border-b-0",style:{height:l},children:[c.jsxs("div",{className:"absolute left-0 top-0 bottom-0 w-20 flex items-center px-2 bg-background-tertiary/50 border-r border-border/30 z-10",children:[c.jsx("div",{className:"w-2 h-2 rounded-full mr-1.5 flex-shrink-0",style:{backgroundColor:d.color}}),c.jsx("span",{className:"text-[9px] text-text-muted truncate",children:d.label})]}),c.jsx("div",{className:"absolute left-20 right-0 top-0 bottom-0",children:d.keyframes.map((u,h)=>{const p=d.keyframes[h+1],f=u.time*e;return c.jsxs(Ye.Fragment,{children:[p&&c.jsx(pZ,{startX:f,endX:p.time*e,easing:u.easing,color:d.color,height:l}),c.jsx(hZ,{keyframe:u,xPosition:f,color:d.color,isSelected:n.includes(u.id),onSelect:m=>t(u.id,m),onMove:m=>o(u.id,m),onDelete:()=>i(u.id)})]},u.id)})})]},d.property))})},gZ=({track:r,allTracks:e,pixelsPerSecond:t,selectedClipIds:s,textClips:i,shapeClips:n,trackHeights:a,timelineRef:o,onSelectClip:l,onDropMedia:d,onMoveClip:u,onMoveTextClip:h,onSnapIndicator:p,onTrimClip:f,onTrimTextClip:m,onTrimShapeClip:g,scrollX:y,trackHeight:x,onResizeTrack:b,onKeyframeSelect:w,onKeyframeMove:C,onKeyframeDelete:k,selectedKeyframeIds:S=[]})=>{const{isTrackExpanded:A}=$t(),T=A(r.id),[j,_]=v.useState(!1),[M,P]=v.useState(!1),R=v.useRef(null),D=v.useRef(0),B=v.useRef(0),O=v.useMemo(()=>r.clips.filter(E=>E.keyframes&&E.keyframes.length>0),[r.clips]),F=v.useCallback(E=>{E.preventDefault(),E.dataTransfer.dropEffect="copy",_(!0)},[]),I=v.useCallback(()=>{_(!1)},[]),J=v.useCallback(E=>{E.preventDefault(),_(!1);try{const G=E.dataTransfer.getData("application/json");if(!G)return;const V=JSON.parse(G);if(!V||typeof V!="object"||typeof V.mediaId!="string"||!V.mediaId.trim())return;const U=R.current?.getBoundingClientRect();if(U){const oe=E.clientX-U.left+y,re=Math.max(0,oe/t);d(r.id,V.mediaId,re)}}catch{}},[r.id,t,y,d]),Z=v.useCallback(E=>{E.preventDefault(),E.stopPropagation(),P(!0),D.current=E.clientY,B.current=x,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},[x]);return v.useEffect(()=>{if(!M)return;const E=V=>{const U=V.clientY-D.current,oe=B.current+U;b(r.id,oe)},G=()=>{P(!1),document.body.style.cursor="",document.body.style.userSelect=""};return document.addEventListener("mousemove",E),document.addEventListener("mouseup",G),()=>{document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",G)}},[M,r.id,b]),c.jsxs("div",{className:"relative",children:[c.jsxs("div",{ref:R,style:{height:x},className:`border-b border-border/50 relative transition-colors ${j?"bg-primary/10 border-primary/30":"bg-background-secondary/20"}`,onDragOver:F,onDragLeave:I,onDrop:J,children:[r.clips.filter(E=>!i.some(G=>G.id===E.id)).filter(E=>!n.some(G=>G.id===E.id)).map(E=>c.jsx(lZ,{clip:E,track:r,allTracks:e,pixelsPerSecond:t,isSelected:s.includes(E.id),trackHeights:a,timelineRef:o,onSelect:l,onMoveClip:u,onSnapIndicator:p,onTrimClip:f},E.id)),i.map(E=>c.jsx(dZ,{textClip:E,pixelsPerSecond:t,isSelected:s.includes(E.id),onSelect:l,onTrim:m,onMoveClip:h},E.id)),n.map(E=>c.jsx(uZ,{shapeClip:E,pixelsPerSecond:t,isSelected:s.includes(E.id),onSelect:l,onTrim:g,onMoveClip:u},E.id)),j&&c.jsx("div",{className:"absolute inset-0 border-2 border-dashed border-primary/50 rounded pointer-events-none flex items-center justify-center",children:c.jsx("span",{className:"text-xs text-primary bg-background/80 px-2 py-1 rounded",children:"Drop to add clip"})})]}),c.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-1 cursor-row-resize hover:bg-primary/50 transition-colors z-10 ${M?"bg-primary":""}`,onMouseDown:Z}),T&&O.length>0&&c.jsx("div",{className:"absolute left-0 right-0",style:{top:x},children:O.map(E=>c.jsx("div",{className:"relative",style:{left:E.startTime*t},children:c.jsx(mZ,{clip:E,pixelsPerSecond:t,onKeyframeSelect:w??(()=>{}),onKeyframeMove:C??(()=>{}),onKeyframeDelete:k??(()=>{}),selectedKeyframeIds:S})},`keyframes-${E.id}`))})]})},yZ=({pixelsPerSecond:r,scrollX:e,viewportWidth:t,totalHeight:s})=>{const[i,n]=v.useState(()=>zp().getState());v.useEffect(()=>zp().subscribe(n),[]);const a=v.useMemo(()=>{if(i.beatMarkers.length===0)return[];const o=e/r,l=(e+t)/r,d=1;return i.beatMarkers.filter(u=>u.time>=o-d&&u.time<=l+d)},[i.beatMarkers,e,t,r]);return a.length===0?null:c.jsx("div",{className:"absolute inset-0 pointer-events-none z-5",children:a.map(o=>{const l=o.time*r,d=o.isDownbeat;return c.jsxs("div",{className:"absolute top-0",style:{left:`${l}px`,height:`${s}px`},children:[c.jsx("div",{className:`h-full transition-opacity ${d?"w-[2px] bg-orange-500/60":"w-px bg-orange-400/30"}`}),d&&c.jsx("div",{className:"absolute -top-0.5 left-1/2 -translate-x-1/2 w-2 h-2 rounded-full bg-orange-500",title:`Beat ${o.index+1}`})]},`beat-${o.index}`)})})},xZ=({marker:r,pixelsPerSecond:e,scrollX:t,onSeek:s,onRemove:i,onUpdate:n})=>{const[a,o]=Ye.useState(!1),[l,d]=Ye.useState(!1),[u,h]=Ye.useState(r.label),p=r.time*e-t,f=x=>{x.stopPropagation(),s&&s(r.time)},m=x=>{x.stopPropagation(),d(!0)},g=x=>{x.stopPropagation(),i&&i(r.id)},y=x=>{x.key==="Enter"?(n&&u.trim()&&n(r.id,{label:u.trim()}),d(!1)):x.key==="Escape"&&(h(r.label),d(!1))};return c.jsxs("div",{className:"absolute top-0 bottom-0 flex flex-col items-center cursor-pointer z-20",style:{left:`${p}px`},onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:f,onDoubleClick:m,children:[c.jsx("div",{className:"w-0.5 h-full transition-opacity",style:{backgroundColor:r.color,opacity:a?1:.6}}),c.jsxs("div",{className:"absolute top-1 flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium whitespace-nowrap transition-all shadow-lg",style:{backgroundColor:r.color,color:"#fff",transform:a?"scale(1.05)":"scale(1)"},children:[c.jsx(BL,{size:10}),l?c.jsx("input",{type:"text",value:u,onChange:x=>h(x.target.value),onKeyDown:y,onBlur:()=>{h(r.label),d(!1)},className:"bg-transparent border-none outline-none text-white w-20 px-1",autoFocus:!0,onClick:x=>x.stopPropagation()}):c.jsx("span",{children:r.label}),a&&i&&c.jsx("button",{onClick:g,className:"ml-1 hover:bg-white/20 rounded p-0.5 transition-colors",children:c.jsx(Zs,{size:10})})]})]})},bZ=()=>{const r=v.useRef(null),e=v.useRef(null),{project:t,undo:s,redo:i,canUndo:n,canRedo:a,splitClip:o,removeClip:l,addTrack:d,reorderTrack:u,deleteShapeClip:h,deleteSVGClip:p,deleteTextClip:f,removeMarker:m,updateMarker:g,updateClipKeyframes:y,setTimelineDuration:x}=W(),b=t.timeline.tracks,[w,C]=Ye.useState(null),{playheadPosition:k,playbackState:S,pixelsPerSecond:A,scrollX:T,scrollY:j,viewportWidth:_,setScrollX:M,setScrollY:P,setViewportDimensions:R,zoomIn:D,zoomOut:B,setTrackHeightById:O,getTrackHeight:F}=$t(),[I,J]=v.useState(!1),{select:Z,selectMultiple:E,clearSelection:G,getSelectedClipIds:V}=Ft(),U=V(),{getTitleEngine:oe,getGraphicsEngine:re}=fe(),ne=oe(),Ee=v.useMemo(()=>ne?.getAllTextClips()??[],[ne,t.modifiedAt]),K=v.useCallback(X=>Ee.filter(be=>be.trackId===X),[Ee]),me=re(),$=v.useMemo(()=>{const X=me?.getAllShapeClips()??[],be=me?.getAllSVGClips()??[],De=me?.getAllStickerClips()??[];return[...X,...be,...De]},[me,t.modifiedAt]),Q=v.useCallback(X=>$.filter(be=>be.trackId===X),[$]),[le,ke]=Ye.useState(!1),[de,ae]=Ye.useState(null),Pe=v.useMemo(()=>{const X=t.timeline?.duration||0;if(X>0)return X;let be=0;for(const De of b)for(const Te of De.clips){const ot=Te.startTime+Te.duration;ot>be&&(be=ot)}return Math.max(be,60)},[b,t.timeline?.duration]),z=v.useMemo(()=>{let X=0;for(const be of b)X+=F(be.id);return X},[b,F]),Ue=v.useMemo(()=>{const X=new Map;for(const be of b)X.set(be.id,F(be.id));return X},[b,F]),Je=v.useCallback((X,be)=>{X.dataTransfer.setData("trackId",be),X.dataTransfer.effectAllowed="move",C(be)},[]),ge=v.useCallback(X=>{X.preventDefault(),X.dataTransfer.dropEffect="move"},[]),Ce=v.useCallback(async(X,be)=>{X.preventDefault();const De=X.dataTransfer.getData("trackId");if(C(null),De&&De!==be){const Te=b.findIndex(ot=>ot.id===be);Te!==-1&&await u(De,Te)}},[b,u]);v.useEffect(()=>{if(!r.current)return;const X=new ResizeObserver(be=>{for(const De of be)R(De.contentRect.width,De.contentRect.height)});return X.observe(r.current),()=>X.disconnect()},[R]),v.useEffect(()=>{if(S!=="playing")return;const X=k*A,be=T+_-150;if(X>be&&e.current){const De=X-_+200;e.current.scrollLeft=Math.max(0,De)}},[k,S,A,T,_]);const He=v.useCallback((X,be)=>{if(Ee.some(nt=>nt.id===X)){const nt=Ee.find(yt=>yt.id===X);Z({type:"text-clip",id:X,trackId:nt?.trackId},be);return}if($.some(nt=>nt.id===X)){const nt=$.find(yt=>yt.id===X);Z({type:"shape-clip",id:X,trackId:nt?.trackId},be);return}let ot;for(const nt of b)if(nt.clips.some(yt=>yt.id===X)){ot=nt.id;break}Z({type:"clip",id:X,trackId:ot},be)},[b,Z,Ee,$]),[Ze,Mt]=v.useState([]),ut=v.useCallback((X,be)=>{Mt(be?De=>De.includes(X)?De.filter(Te=>Te!==X):[...De,X]:[X])},[]),Ne=v.useCallback((X,be)=>{for(const De of b)for(const Te of De.clips)if(Te.keyframes?.find(nt=>nt.id===X)){const nt=Te.keyframes?.map(yt=>yt.id===X?{...yt,time:Math.max(0,be)}:yt);nt&&y(Te.id,nt);return}},[b,y]),It=v.useCallback(X=>{for(const be of b)for(const De of be.clips)if(De.keyframes?.find(ot=>ot.id===X)){const ot=De.keyframes?.filter(nt=>nt.id!==X);ot&&y(De.id,ot),Mt(nt=>nt.filter(yt=>yt!==X));return}},[b,y]),dr=v.useCallback(async()=>{U.length===1&&await o(U[0],k)},[U,k,o]),si=v.useCallback(async()=>{if(U.length!==0){for(const X of U){if(Ee.find(Te=>Te.id===X)){f(X);continue}const De=$.find(Te=>Te.id===X);if(De){De.type==="svg"?p(X):h(X);continue}l(X)}G()}},[U,l,G,Ee,$,f,h,p]),An=v.useCallback(()=>{G()},[G]),No=v.useCallback(X=>{if(X.button!==0||X.target.closest(".clip-component"))return;const be=e.current?.getBoundingClientRect();if(!be)return;const De=X.clientX-be.left+T,Te=X.clientY-be.top+j;ke(!0),ae({startX:De,startY:Te,currentX:De,currentY:Te})},[T,j]),Cr=v.useCallback(X=>{if(!le||!de)return;const be=e.current?.getBoundingClientRect();if(!be)return;const De=X.clientX-be.left+T,Te=X.clientY-be.top+j;ae({...de,currentX:De,currentY:Te})},[le,de,T,j]),qr=v.useCallback(()=>{if(!le||!de){ke(!1),ae(null);return}const X=Math.min(de.startX,de.currentX),be=Math.max(de.startX,de.currentX),De=X/A,Te=be/A;let ot=0;const nt=[];for(const yt of b){const Ns=F(yt.id),kt=ot,Sr=ot+Ns,Pa=Math.min(de.startY,de.currentY),jn=Math.max(de.startY,de.currentY);if(Pa<Sr&&jn>kt)for(const Do of yt.clips){const ju=Do.startTime,Gs=Do.startTime+Do.duration;De<Gs&&Te>ju&&nt.push({type:"clip",id:Do.id,trackId:yt.id})}ot+=Ns}nt.length>0&&E(nt),ke(!1),ae(null)},[le,de,A,b,F,E]);v.useEffect(()=>{if(!le)return;const X=()=>qr();return document.addEventListener("mouseup",X),()=>document.removeEventListener("mouseup",X)},[le,qr]);const ur=v.useCallback(async(X,be,De)=>{const{addClipToNewTrack:Te}=W.getState();await Te(be,De)},[]),{moveClip:Ma}=W(),Ro=v.useCallback(async(X,be,De)=>{const Te=$.find(ot=>ot.id===X);Te&&me?(Te.type==="sticker"||Te.type==="emoji"?me.updateStickerClip(X,{startTime:be}):Te.type==="svg"?me.updateSVGClip(X,{startTime:be}):me.updateShapeClip(X,{startTime:be}),W.setState(ot=>({project:{...ot.project,modifiedAt:Date.now()}}))):await Ma(X,be,De)},[Ma,$,me]),[Io,dl]=Ye.useState(null),Ut=v.useCallback(X=>{dl(X)},[]),mf=v.useCallback((X,be,De)=>{if(!ne)return;const Te=Ee.find(Ns=>Ns.id===X);if(!Te)return;const ot=Te.duration,nt=be==="left"?Math.max(.1,Te.startTime+Te.duration-De):Math.max(.1,De-Te.startTime),yt=Te.keyframes.map(Ns=>{if(Ns.id.startsWith("kf-exit-")){const kt=Ns.time-ot;return{...Ns,time:nt+kt}}return Ns});be==="left"?ne.updateTextClip(X,{startTime:De,duration:nt}):ne.updateTextClip(X,{duration:nt}),W.getState().updateTextClipKeyframes(X,yt),W.setState(Ns=>({project:{...Ns.project,modifiedAt:Date.now()}}))},[ne,Ee]),ul=v.useCallback((X,be)=>{!ne||!Ee.find(Te=>Te.id===X)||(ne.updateTextClip(X,{startTime:Math.max(0,be)}),W.setState(Te=>({project:{...Te.project,modifiedAt:Date.now()}})))},[ne,Ee]),Au=v.useCallback((X,be,De)=>{if(!me)return;const Te=$.find(kt=>kt.id===X);if(!Te)return;const ot=Te.duration,nt=be==="left"?Math.max(.1,Te.startTime+Te.duration-De):Math.max(.1,De-Te.startTime),yt=be==="left"?{startTime:De,duration:nt}:{duration:nt},Ns=Te.keyframes.map(kt=>{if(kt.id.startsWith("kf-exit-")){const Sr=kt.time-ot;return{...kt,time:nt+Sr}}return kt});Te.type==="sticker"||Te.type==="emoji"?me.updateStickerClip(X,yt):Te.type==="svg"?me.updateSVGClip(X,yt):me.updateShapeClip(X,yt),W.getState().updateClipKeyframes(X,Ns),W.setState(kt=>({project:{...kt.project,modifiedAt:Date.now()}}))},[me,$]),Pi=v.useCallback((X,be,De)=>{const Te=b.flatMap(kt=>kt.clips).find(kt=>kt.id===X);if(!Te)return;const ot=Te.duration,nt=be==="left"?Math.max(.1,Te.startTime+Te.duration-De):Math.max(.1,De-Te.startTime),yt=be==="left"?{startTime:De,duration:nt}:{duration:nt},Ns=Te.keyframes.map(kt=>{if(kt.id.startsWith("kf-exit-")){const Sr=kt.time-ot;return{...kt,time:nt+Sr}}return kt});W.setState(kt=>({project:{...kt.project,timeline:{...kt.project.timeline,tracks:kt.project.timeline.tracks.map(Sr=>({...Sr,clips:Sr.clips.map(Pa=>Pa.id===X?{...Pa,...yt,keyframes:Ns}:Pa)}))},modifiedAt:Date.now()}}))},[b]),hl=v.useMemo(()=>b,[b]);return c.jsxs("div",{"data-tour":"timeline",className:"h-full bg-background border-t border-border flex flex-col",children:[c.jsxs("div",{className:"h-12 border-b border-border flex items-center justify-between px-4 bg-background-secondary relative z-[100]",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("div",{className:"flex bg-background-tertiary rounded-lg p-1 border border-border",children:[c.jsx(Br,{icon:i_,onClick:s,disabled:!n(),title:"Undo (Cmd+Z)"}),c.jsx(Br,{icon:Zj,onClick:i,disabled:!a(),title:"Redo (Cmd+Shift+Z)"})]}),c.jsx("div",{className:"w-px h-6 bg-border mx-1"}),c.jsxs("div",{className:"flex bg-background-tertiary rounded-lg p-1 border border-border gap-1",children:[c.jsxs("button",{onClick:dr,disabled:U.length!==1,title:"Split clip at playhead (S)",className:`flex items-center gap-1.5 px-2 py-1 rounded transition-colors ${U.length===1?"bg-orange-500/20 text-orange-400 hover:bg-orange-500/30 border border-orange-500/30":"text-text-muted opacity-50 cursor-not-allowed"}`,children:[c.jsx(zx,{size:14}),c.jsx("span",{className:"text-[10px] font-medium",children:"SPLIT"})]}),c.jsx(Br,{icon:Ss,onClick:si,disabled:U.length===0,title:"Delete clip (Del)",className:"hover:text-red-500"})]}),c.jsx("div",{className:"w-px h-6 bg-border mx-1"}),c.jsxs(Sp,{children:[c.jsx(Tp,{asChild:!0,children:c.jsxs("button",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-lg bg-primary/10 text-primary hover:bg-primary/20 border border-primary/20 transition-colors",title:"Add new track",children:[c.jsx(wr,{size:14}),c.jsx("span",{className:"text-[11px] font-semibold",children:"Add Track"}),c.jsx(ls,{size:12,className:"ml-0.5 opacity-60"})]})}),c.jsxs(Qd,{side:"top",align:"start",sideOffset:8,className:"w-48",children:[c.jsxs(Zi,{onClick:()=>d("video"),children:[c.jsx(pa,{size:16,className:"text-green-400"}),c.jsx("span",{children:"Video Track"})]}),c.jsxs(Zi,{onClick:()=>d("audio"),children:[c.jsx(Gr,{size:16,className:"text-blue-400"}),c.jsx("span",{children:"Audio Track"})]}),c.jsx(Sd,{}),c.jsxs(Zi,{onClick:()=>d("image"),children:[c.jsx(Eo,{size:16,className:"text-purple-400"}),c.jsx("span",{children:"Image Track"})]}),c.jsxs(Zi,{onClick:()=>d("text"),children:[c.jsx(Os,{size:16,className:"text-yellow-400"}),c.jsx("span",{children:"Text Track"})]}),c.jsxs(Zi,{onClick:()=>d("graphics"),children:[c.jsx(yu,{size:16,className:"text-pink-400"}),c.jsx("span",{children:"Graphics Track"})]})]})]}),c.jsx("div",{className:"w-px h-6 bg-border mx-1"}),c.jsxs(nM,{open:I,onOpenChange:J,children:[c.jsx(aM,{asChild:!0,children:c.jsxs("button",{className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg transition-colors ${I?"bg-primary/20 text-primary":"hover:bg-background-elevated text-text-secondary hover:text-text-primary"}`,title:"Manage track layers",children:[c.jsx(zs,{size:14}),c.jsx("span",{className:"text-[10px] font-medium tracking-wide",children:"LAYERS"})]})}),c.jsxs(kb,{side:"top",align:"start",sideOffset:8,className:"w-64 p-0 bg-background-secondary border-border",children:[c.jsx("div",{className:"flex items-center justify-between px-3 py-2.5 border-b border-border bg-background-tertiary",children:c.jsx("span",{className:"text-xs font-semibold text-text-primary",children:"Track Layers"})}),c.jsx("div",{className:"p-2 max-h-60 overflow-y-auto",children:b.length===0?c.jsx("p",{className:"text-xs text-text-muted text-center py-6",children:"No tracks yet"}):c.jsx("div",{className:"space-y-0.5",children:b.map((X,be)=>{const De=iN(X,be);return c.jsxs("div",{className:"flex items-center gap-2.5 px-2 py-2 rounded-md hover:bg-background-tertiary group transition-colors cursor-default",children:[c.jsx("div",{className:`w-7 h-7 rounded-md flex items-center justify-center ${De.bgLight}`,children:c.jsx(De.icon,{size:14,className:De.textColor})}),c.jsx("span",{className:"text-[11px] font-medium text-text-primary flex-1 truncate",children:X.name||De.label}),c.jsxs("div",{className:"flex gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[c.jsx("button",{onClick:()=>be>0&&u(X.id,be-1),disabled:be===0,className:"p-1.5 rounded-md hover:bg-background-elevated disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Move up",children:c.jsx(Wj,{size:12})}),c.jsx("button",{onClick:()=>be<b.length-1&&u(X.id,be+1),disabled:be===b.length-1,className:"p-1.5 rounded-md hover:bg-background-elevated disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Move down",children:c.jsx(ls,{size:12})})]})]},X.id)})})})]})]})]}),c.jsx("div",{className:"font-mono text-primary text-sm font-bold tracking-wider bg-background-tertiary px-4 py-1.5 rounded-lg border border-primary/20 shadow-[0_0_12px_rgba(34,197,94,0.15)]",children:sN(k)}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("div",{className:"flex items-center bg-background-tertiary rounded-lg border border-border px-3 py-1.5 gap-2",children:[c.jsx("label",{className:"text-[11px] text-text-secondary whitespace-nowrap",children:"Project Length"}),c.jsx("input",{type:"number",step:"0.1",min:"0",value:t.timeline?.duration||0,onChange:X=>{const be=parseFloat(X.target.value);!isNaN(be)&&be>=0&&x(be)},onFocus:()=>{},className:"w-20 bg-background text-text-primary text-[11px] font-mono px-2 py-1 rounded border border-border focus:border-primary focus:outline-none",placeholder:"Auto",title:"Project duration in seconds (0 = auto-calculate from clips)"}),c.jsx("span",{className:"text-[11px] text-text-secondary",children:"s"})]}),c.jsxs("div",{className:"flex items-center bg-background-tertiary rounded-lg border border-border overflow-hidden",children:[c.jsx("button",{onClick:B,className:"w-8 h-8 flex items-center justify-center text-text-secondary hover:text-text-primary hover:bg-background-elevated transition-colors border-r border-border",title:"Zoom out",children:c.jsx("span",{className:"text-base font-medium",children:""})}),c.jsxs("span",{className:"text-[11px] w-14 text-center font-mono text-text-secondary tabular-nums",children:[Math.round(A),"px/s"]}),c.jsx("button",{onClick:D,className:"w-8 h-8 flex items-center justify-center text-text-secondary hover:text-text-primary hover:bg-background-elevated transition-colors border-l border-border",title:"Zoom in",children:c.jsx("span",{className:"text-base font-medium",children:"+"})})]}),c.jsx(Br,{icon:Ca,title:"Maximize timeline"})]})]}),c.jsxs("div",{ref:r,className:"flex-1 flex flex-col overflow-hidden relative",onClick:An,children:[c.jsxs("div",{className:"flex shrink-0",children:[c.jsx("div",{className:"w-32 h-8 bg-background-tertiary border-b border-r border-border shrink-0"}),c.jsx("div",{className:"flex-1 overflow-hidden relative",children:c.jsx("div",{style:{width:`${Pe*A}px`,transform:`translateX(-${T}px)`},children:c.jsx(nZ,{duration:Pe,pixelsPerSecond:A,scrollX:T,viewportWidth:_,onSeek:X=>{hd().scrubTo(X)},onScrubStart:()=>{hd().startScrubbing()},onScrubEnd:()=>{hd().endScrubbing()}})})})]}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx("div",{className:"w-32 bg-background-secondary border-r border-border shrink-0 z-20 shadow-lg overflow-hidden",children:c.jsx("div",{className:"flex flex-col",style:{transform:`translateY(-${j}px)`},children:hl.map((X,be)=>{const De=X.clips.reduce((Te,ot)=>Te+(ot.keyframes?.length||0),0);return c.jsx("div",{className:w===X.id?"opacity-50":"",children:c.jsx(aZ,{track:X,index:be,onDragStart:Je,onDragOver:ge,onDrop:Ce,keyframeCount:De})},X.id)})})}),c.jsx("div",{ref:e,className:"flex-1 bg-background relative overflow-auto custom-scrollbar",onScroll:X=>{M(X.currentTarget.scrollLeft),P(X.currentTarget.scrollTop)},onMouseDown:No,onMouseMove:Cr,children:c.jsxs("div",{style:{width:`${Pe*A}px`},className:"min-w-full",children:[hl.map(X=>c.jsx(gZ,{track:X,allTracks:hl,pixelsPerSecond:A,selectedClipIds:U,textClips:K(X.id),shapeClips:Q(X.id),trackHeights:Ue,timelineRef:e,onSelectClip:He,onDropMedia:ur,onMoveClip:Ro,onSnapIndicator:Ut,onTrimClip:X.type==="video"||X.type==="image"||X.type==="audio"?Pi:void 0,onTrimTextClip:mf,onMoveTextClip:ul,onTrimShapeClip:Au,scrollX:T,trackHeight:F(X.id),onResizeTrack:O,onKeyframeSelect:ut,onKeyframeMove:Ne,onKeyframeDelete:It,selectedKeyframeIds:Ze},X.id)),c.jsx(yZ,{pixelsPerSecond:A,scrollX:T,viewportWidth:_,totalHeight:z}),t.timeline.markers.map(X=>c.jsx(xZ,{marker:X,pixelsPerSecond:A,scrollX:T,onSeek:be=>{hd().scrubTo(be)},onRemove:m,onUpdate:g},X.id)),Io!==null&&c.jsx("div",{className:"absolute top-0 bottom-0 w-px bg-yellow-400 z-30 pointer-events-none",style:{left:`${Io*A}px`},children:c.jsx("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-2 h-2 bg-yellow-400 rounded-full"})}),le&&de&&c.jsx("div",{className:"absolute border-2 border-primary bg-primary/10 pointer-events-none z-40",style:{left:Math.min(de.startX,de.currentX)-T,top:Math.min(de.startY,de.currentY)-j,width:Math.abs(de.currentX-de.startX),height:Math.abs(de.currentY-de.startY)}})]})})]}),c.jsx(rZ,{position:k,pixelsPerSecond:A,scrollX:T,headerOffset:128})]})]})},sS={"position.x":"#22d3ee","position.y":"#a78bfa","scale.x":"#4ade80","scale.y":"#86efac",rotation:"#f472b6",opacity:"#fbbf24",borderRadius:"#94a3b8",default:"#64748b"},vZ=[{label:"Linear",value:"linear"},{label:"Ease In",value:"easeInQuad"},{label:"Ease Out",value:"easeOutQuad"},{label:"Ease In Out",value:"easeInOutQuad"},{label:"Ease In Cubic",value:"easeInCubic"},{label:"Ease Out Cubic",value:"easeOutCubic"},{label:"Ease In Out Cubic",value:"easeInOutCubic"},{label:"Ease In Quart",value:"easeInQuart"},{label:"Ease Out Quart",value:"easeOutQuart"},{label:"Ease In Out Quart",value:"easeInOutQuart"},{label:"Ease In Back",value:"easeInBack"},{label:"Ease Out Back",value:"easeOutBack"},{label:"Ease In Out Back",value:"easeInOutBack"},{label:"Ease In Elastic",value:"easeInElastic"},{label:"Ease Out Elastic",value:"easeOutElastic"},{label:"Ease In Out Elastic",value:"easeInOutElastic"},{label:"Ease In Bounce",value:"easeInBounce"},{label:"Ease Out Bounce",value:"easeOutBounce"},{label:"Ease In Out Bounce",value:"easeInOutBounce"}],Gt=40,fr=200,wZ=({clip:r,onClose:e,onUpdateKeyframe:t,onDeleteKeyframe:s,onCopyKeyframes:i,onPasteKeyframes:n,selectedKeyframeIds:a,onSelectKeyframe:o,copiedKeyframes:l})=>{const[d,u]=v.useState(null),h=v.useRef(null),[p,f]=v.useState(!1),[m,g]=v.useState(null),y=600,x=v.useMemo(()=>{if(!r?.keyframes)return[];const F=new Map;for(const I of r.keyframes){const J=F.get(I.property)||[];J.push(I),F.set(I.property,J)}return Array.from(F.entries()).map(([I,J])=>({property:I,keyframes:J.sort((Z,E)=>Z.time-E.time),color:sS[I]||sS.default})).sort((I,J)=>I.property.localeCompare(J.property))},[r?.keyframes]);v.useEffect(()=>{x.length>0&&!d&&u(x[0].property)},[x,d]);const b=v.useMemo(()=>x.find(F=>F.property===d)||null,[x,d]),w=v.useMemo(()=>{if(!b||b.keyframes.length===0)return{min:0,max:r?.duration||1};const F=b.keyframes.map(I=>I.time);return{min:Math.min(0,...F),max:Math.max(r?.duration||1,...F)}},[b,r?.duration]),C=v.useMemo(()=>{if(!b||b.keyframes.length===0)return{min:0,max:1};const F=b.keyframes.map(E=>E.value),I=Math.min(...F),J=Math.max(...F),Z=(J-I)*.1||.1;return{min:I-Z,max:J+Z}},[b]),k=v.useCallback(F=>{const I=w.max-w.min;return Gt+(F-w.min)/I*(y-Gt*2)},[w,y]),S=v.useCallback(F=>{const I=C.max-C.min;return Gt+(1-(F-C.min)/I)*(fr-Gt*2)},[C]),A=v.useCallback(F=>{const I=w.max-w.min;return w.min+(F-Gt)/(y-Gt*2)*I},[w,y]),T=v.useCallback(F=>{const I=C.max-C.min;return C.min+(1-(F-Gt)/(fr-Gt*2))*I},[C]),j=v.useCallback(()=>{const F=h.current;if(!F||!b)return;const I=F.getContext("2d");if(!I)return;const J=window.devicePixelRatio||1;F.width=y*J,F.height=fr*J,I.scale(J,J),I.fillStyle="#1a1a1a",I.fillRect(0,0,y,fr),I.strokeStyle="#333",I.lineWidth=1;for(let Z=0;Z<=10;Z++){const E=Gt+Z/10*(y-Gt*2);I.beginPath(),I.moveTo(E,Gt),I.lineTo(E,fr-Gt),I.stroke()}for(let Z=0;Z<=5;Z++){const E=Gt+Z/5*(fr-Gt*2);I.beginPath(),I.moveTo(Gt,E),I.lineTo(y-Gt,E),I.stroke()}I.strokeStyle="#555",I.lineWidth=2,I.beginPath(),I.moveTo(Gt,fr-Gt),I.lineTo(y-Gt,fr-Gt),I.lineTo(y-Gt,Gt),I.stroke(),I.fillStyle="#888",I.font="10px sans-serif",I.textAlign="center";for(let Z=0;Z<=5;Z++){const E=w.min+Z/5*(w.max-w.min),G=k(E);I.fillText(E.toFixed(2)+"s",G,fr-10)}I.textAlign="right";for(let Z=0;Z<=5;Z++){const E=C.min+Z/5*(C.max-C.min),G=S(E);I.fillText(E.toFixed(2),Gt-5,G+3)}if(b.keyframes.length>1){I.strokeStyle=b.color,I.lineWidth=2,I.beginPath();const Z=100;for(let E=0;E<=Z;E++){const G=E/Z,V=Math.floor(G*(b.keyframes.length-1)),U=Math.min(V+1,b.keyframes.length-1),oe=G*(b.keyframes.length-1)-V,re=b.keyframes[V],ne=b.keyframes[U],K=(ni[re.easing]||ni.linear)(oe),me=re.time+(ne.time-re.time)*oe,$=re.value+(ne.value-re.value)*K,Q=k(me),le=S($);E===0?I.moveTo(Q,le):I.lineTo(Q,le)}I.stroke()}for(const Z of b.keyframes){const E=k(Z.time),G=S(Z.value),V=a.includes(Z.id);I.save(),I.translate(E,G),I.rotate(Math.PI/4),I.fillStyle=b.color,I.fillRect(-6,-6,12,12),V&&(I.strokeStyle="#fff",I.lineWidth=2,I.strokeRect(-6,-6,12,12),I.shadowColor=b.color,I.shadowBlur=10,I.fillRect(-6,-6,12,12)),I.restore()}},[b,y,k,S,w,C,a]);v.useEffect(()=>{j()},[j]);const _=v.useCallback(F=>{if(!b)return;const I=h.current?.getBoundingClientRect();if(!I)return;const J=F.clientX-I.left,Z=F.clientY-I.top;for(const E of b.keyframes){const G=k(E.time),V=S(E.value);if(Math.sqrt((J-G)**2+(Z-V)**2)<10){o(E.id,F.shiftKey||F.metaKey),f(!0),g(E.id);return}}},[b,k,S,o]),M=v.useCallback(F=>{if(!p||!m||!b)return;const I=h.current?.getBoundingClientRect();if(!I)return;const J=F.clientX-I.left,Z=F.clientY-I.top,E=Math.max(0,A(J)),G=T(Z);t(m,{time:E,value:G})},[p,m,b,A,T,t]),P=v.useCallback(()=>{f(!1),g(null)},[]);v.useEffect(()=>{const F=()=>{f(!1),g(null)};return window.addEventListener("mouseup",F),()=>window.removeEventListener("mouseup",F)},[]);const R=v.useCallback(()=>{i(a)},[i,a]),D=v.useCallback(()=>{r&&n(r.id,0)},[r,n]),B=v.useCallback(()=>{for(const F of a)s(F)},[a,s]),O=v.useCallback(F=>{for(const I of a)t(I,{easing:F})},[a,t]);return r?c.jsxs("div",{className:"h-full flex flex-col bg-background-secondary border-l border-border",children:[c.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[c.jsx("h3",{className:"text-sm font-semibold text-text-primary",children:"Keyframe Editor"}),c.jsx("button",{onClick:e,className:"p-1 rounded hover:bg-background-elevated text-text-muted hover:text-text-primary transition-colors",children:c.jsx(Zs,{size:16})})]}),c.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border bg-background-tertiary",children:[c.jsxs(jt,{value:d||"",onValueChange:u,children:[c.jsx(vt,{className:"w-[180px] h-8",children:c.jsx(_t,{placeholder:"Select property"})}),c.jsx(wt,{children:x.map(F=>c.jsx(Ve,{value:F.property,children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:F.color}}),c.jsx("span",{children:F.property})]})},F.property))})]}),c.jsx("div",{className:"flex-1"}),c.jsxs(Et,{variant:"ghost",size:"sm",onClick:R,disabled:a.length===0,className:"h-8 px-2",children:[c.jsx(Ao,{size:14,className:"mr-1"}),"Copy"]}),c.jsxs(Et,{variant:"ghost",size:"sm",onClick:D,disabled:l.length===0,className:"h-8 px-2",children:[c.jsx(hL,{size:14,className:"mr-1"}),"Paste"]}),c.jsxs(Et,{variant:"ghost",size:"sm",onClick:B,disabled:a.length===0,className:"h-8 px-2 text-red-400 hover:text-red-300",children:[c.jsx(Ss,{size:14,className:"mr-1"}),"Delete"]})]}),c.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:c.jsx("canvas",{ref:h,width:y,height:fr,className:"rounded border border-border cursor-crosshair",style:{width:y,height:fr},onMouseDown:_,onMouseMove:M,onMouseUp:P})}),c.jsx("div",{className:"px-4 py-3 border-t border-border bg-background-tertiary",children:c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-xs text-text-muted",children:"Easing:"}),c.jsxs(jt,{value:a.length>0?void 0:"",onValueChange:O,disabled:a.length===0,children:[c.jsx(vt,{className:"w-[160px] h-7 text-xs",children:c.jsx(_t,{placeholder:"Select easing"})}),c.jsx(wt,{children:vZ.map(F=>c.jsx(Ve,{value:F.value,children:F.label},F.value))})]})]}),c.jsx("div",{className:"flex-1"}),c.jsxs("span",{className:"text-xs text-text-muted",children:[a.length," keyframe",a.length!==1?"s":""," selected"]})]})}),b&&c.jsx(oa,{className:"max-h-32 border-t border-border",children:c.jsx("div",{className:"p-2",children:c.jsxs("table",{className:"w-full text-xs",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"text-text-muted",children:[c.jsx("th",{className:"text-left py-1 px-2",children:"Time"}),c.jsx("th",{className:"text-left py-1 px-2",children:"Value"}),c.jsx("th",{className:"text-left py-1 px-2",children:"Easing"})]})}),c.jsx("tbody",{children:b.keyframes.map(F=>c.jsxs("tr",{className:`cursor-pointer hover:bg-background-elevated transition-colors ${a.includes(F.id)?"bg-primary/20":""}`,onClick:I=>o(F.id,I.shiftKey||I.metaKey),children:[c.jsxs("td",{className:"py-1 px-2",children:[F.time.toFixed(3),"s"]}),c.jsx("td",{className:"py-1 px-2",children:F.value.toFixed(3)}),c.jsx("td",{className:"py-1 px-2",children:F.easing})]},F.id))})]})})})]}):c.jsx("div",{className:"h-full flex items-center justify-center text-text-muted",children:c.jsx("p",{className:"text-sm",children:"Select a clip with keyframes to edit"})})},iS="openreel_shortcuts",rS="openreel_shortcut_preset";function Vy(r){const e=r.toLowerCase().split("+");return{key:e[e.length-1],meta:e.includes("cmd")||e.includes("meta"),ctrl:e.includes("ctrl"),shift:e.includes("shift"),alt:e.includes("alt")||e.includes("option")}}function nN(r){const e=[];(r.meta||r.ctrl)&&e.push(""),r.shift&&e.push(""),r.alt&&e.push("");const t={space:"Space",arrowleft:"",arrowright:"",arrowup:"",arrowdown:"",delete:"",backspace:"",escape:"Esc",enter:"",tab:"",home:"Home",end:"End"};return e.push(t[r.key]||r.key.toUpperCase()),e.join("")}const kZ=[{id:"playback.playPause",name:"Play/Pause",description:"Toggle playback",category:"playback",defaultKey:"space",currentKey:"space",action:"playback.playPause",enabled:!0},{id:"playback.frameBack",name:"Frame Back",description:"Move back one frame",category:"playback",defaultKey:"arrowleft",currentKey:"arrowleft",action:"playback.frameBack",enabled:!0},{id:"playback.frameForward",name:"Frame Forward",description:"Move forward one frame",category:"playback",defaultKey:"arrowright",currentKey:"arrowright",action:"playback.frameForward",enabled:!0},{id:"playback.secondBack",name:"Second Back",description:"Move back one second",category:"playback",defaultKey:"shift+arrowleft",currentKey:"shift+arrowleft",action:"playback.secondBack",enabled:!0},{id:"playback.secondForward",name:"Second Forward",description:"Move forward one second",category:"playback",defaultKey:"shift+arrowright",currentKey:"shift+arrowright",action:"playback.secondForward",enabled:!0},{id:"playback.jump5Back",name:"Jump 5s Back",description:"Move back 5 seconds",category:"playback",defaultKey:"arrowup",currentKey:"arrowup",action:"playback.jump5Back",enabled:!0},{id:"playback.jump5Forward",name:"Jump 5s Forward",description:"Move forward 5 seconds",category:"playback",defaultKey:"arrowdown",currentKey:"arrowdown",action:"playback.jump5Forward",enabled:!0},{id:"playback.goToStart",name:"Go to Start",description:"Jump to timeline start",category:"playback",defaultKey:"home",currentKey:"home",action:"playback.goToStart",enabled:!0},{id:"playback.goToEnd",name:"Go to End",description:"Jump to timeline end",category:"playback",defaultKey:"end",currentKey:"end",action:"playback.goToEnd",enabled:!0},{id:"playback.prevClip",name:"Previous Clip",description:"Jump to previous clip edge",category:"playback",defaultKey:"[",currentKey:"[",action:"playback.prevClip",enabled:!0},{id:"playback.nextClip",name:"Next Clip",description:"Jump to next clip edge",category:"playback",defaultKey:"]",currentKey:"]",action:"playback.nextClip",enabled:!0},{id:"editing.undo",name:"Undo",description:"Undo last action",category:"editing",defaultKey:"cmd+z",currentKey:"cmd+z",action:"editing.undo",enabled:!0},{id:"editing.redo",name:"Redo",description:"Redo last undone action",category:"editing",defaultKey:"cmd+shift+z",currentKey:"cmd+shift+z",action:"editing.redo",enabled:!0},{id:"editing.cut",name:"Cut",description:"Cut selected clips",category:"editing",defaultKey:"cmd+x",currentKey:"cmd+x",action:"editing.cut",enabled:!0},{id:"editing.copy",name:"Copy",description:"Copy selected clips",category:"editing",defaultKey:"cmd+c",currentKey:"cmd+c",action:"editing.copy",enabled:!0},{id:"editing.paste",name:"Paste",description:"Paste clips at playhead",category:"editing",defaultKey:"cmd+v",currentKey:"cmd+v",action:"editing.paste",enabled:!0},{id:"editing.duplicate",name:"Duplicate",description:"Duplicate selected clip",category:"editing",defaultKey:"cmd+d",currentKey:"cmd+d",action:"editing.duplicate",enabled:!0},{id:"editing.delete",name:"Delete",description:"Delete selected clips",category:"editing",defaultKey:"delete",currentKey:"delete",action:"editing.delete",enabled:!0},{id:"editing.rippleDelete",name:"Ripple Delete",description:"Delete and close gap",category:"editing",defaultKey:"shift+delete",currentKey:"shift+delete",action:"editing.rippleDelete",enabled:!0},{id:"editing.split",name:"Split",description:"Split clip at playhead",category:"editing",defaultKey:"s",currentKey:"s",action:"editing.split",enabled:!0},{id:"editing.trimStart",name:"Trim Start",description:"Trim clip start to playhead",category:"editing",defaultKey:"q",currentKey:"q",action:"editing.trimStart",enabled:!0},{id:"editing.trimEnd",name:"Trim End",description:"Trim clip end to playhead",category:"editing",defaultKey:"w",currentKey:"w",action:"editing.trimEnd",enabled:!0},{id:"selection.selectAll",name:"Select All",description:"Select all clips",category:"selection",defaultKey:"cmd+a",currentKey:"cmd+a",action:"selection.selectAll",enabled:!0},{id:"selection.deselect",name:"Deselect",description:"Clear selection",category:"selection",defaultKey:"escape",currentKey:"escape",action:"selection.deselect",enabled:!0},{id:"timeline.toggleSnap",name:"Toggle Snap",description:"Toggle snapping",category:"timeline",defaultKey:"n",currentKey:"n",action:"timeline.toggleSnap",enabled:!0},{id:"timeline.zoomIn",name:"Zoom In",description:"Zoom in timeline",category:"timeline",defaultKey:"cmd+=",currentKey:"cmd+=",action:"timeline.zoomIn",enabled:!0},{id:"timeline.zoomOut",name:"Zoom Out",description:"Zoom out timeline",category:"timeline",defaultKey:"cmd+-",currentKey:"cmd+-",action:"timeline.zoomOut",enabled:!0},{id:"timeline.fitTimeline",name:"Fit Timeline",description:"Fit timeline to view",category:"timeline",defaultKey:"cmd+0",currentKey:"cmd+0",action:"timeline.fitTimeline",enabled:!0},{id:"view.showShortcuts",name:"Show Shortcuts",description:"Show keyboard shortcuts",category:"view",defaultKey:"?",currentKey:"?",action:"view.showShortcuts",enabled:!0},{id:"file.save",name:"Save",description:"Save project",category:"file",defaultKey:"cmd+s",currentKey:"cmd+s",action:"file.save",enabled:!0},{id:"file.export",name:"Export",description:"Export video",category:"file",defaultKey:"cmd+e",currentKey:"cmd+e",action:"file.export",enabled:!0},{id:"tools.addText",name:"Add Text",description:"Add text clip",category:"tools",defaultKey:"t",currentKey:"t",action:"tools.addText",enabled:!0},{id:"tools.addMarker",name:"Add Marker",description:"Add marker at playhead",category:"tools",defaultKey:"m",currentKey:"m",action:"tools.addMarker",enabled:!0}],nS=[{id:"openreel",name:"OpenReel Default",description:"Default OpenReel shortcuts",shortcuts:{}},{id:"capcut",name:"CapCut",description:"CapCut-style shortcuts",shortcuts:{"editing.split":"ctrl+b","playback.playPause":"space","editing.delete":"delete"}},{id:"premiere",name:"Adobe Premiere",description:"Premiere Pro-style shortcuts",shortcuts:{"editing.split":"cmd+k","playback.playPause":"space","playback.frameBack":"arrowleft","playback.frameForward":"arrowright","editing.rippleDelete":"shift+delete"}},{id:"finalcut",name:"Final Cut Pro",description:"Final Cut Pro-style shortcuts",shortcuts:{"editing.split":"cmd+b","playback.playPause":"space","editing.trimStart":"[","editing.trimEnd":"]"}},{id:"davinci",name:"DaVinci Resolve",description:"DaVinci Resolve-style shortcuts",shortcuts:{"editing.split":"cmd+\\","playback.playPause":"space","editing.rippleDelete":"shift+backspace"}}];class CZ{shortcuts=new Map;handlers=new Map;activePreset="openreel";isListening=!1;constructor(){this.loadShortcuts(),this.loadPreset()}loadShortcuts(){const e=localStorage.getItem(iS),t=e?JSON.parse(e):{};kZ.forEach(s=>{const i=t[s.id];this.shortcuts.set(s.id,{...s,currentKey:i||s.defaultKey})})}loadPreset(){const e=localStorage.getItem(rS);e&&(this.activePreset=e)}saveShortcuts(){const e={};this.shortcuts.forEach((t,s)=>{t.currentKey!==t.defaultKey&&(e[s]=t.currentKey)}),localStorage.setItem(iS,JSON.stringify(e))}savePreset(){localStorage.setItem(rS,this.activePreset)}startListening(){this.isListening||(this.isListening=!0,window.addEventListener("keydown",this.handleKeyDown))}stopListening(){this.isListening&&(this.isListening=!1,window.removeEventListener("keydown",this.handleKeyDown))}handleKeyDown=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;const t=this.findMatchingShortcut(e);t&&(e.preventDefault(),e.stopPropagation(),this.executeAction(t.action,e))};findMatchingShortcut(e){const t=e.metaKey||e.ctrlKey;for(const s of this.shortcuts.values()){if(!s.enabled)continue;const i=Vy(s.currentKey),n=e.key.toLowerCase()===i.key||e.code.toLowerCase()===i.key,a=(i.meta||i.ctrl)===t,o=i.shift===e.shiftKey,l=i.alt===e.altKey;if(n&&a&&o&&l)return s}return null}executeAction(e,t){const s=this.handlers.get(e);s&&s.forEach(i=>i(t))}registerHandler(e,t){return this.handlers.has(e)||this.handlers.set(e,new Set),this.handlers.get(e).add(t),()=>{this.handlers.get(e)?.delete(t)}}getShortcut(e){return this.shortcuts.get(e)}getAllShortcuts(){return Array.from(this.shortcuts.values())}getShortcutsByCategory(e){return this.getAllShortcuts().filter(t=>t.category===e)}setShortcut(e,t){const s=this.shortcuts.get(e);return!s||this.findConflict(t,e)?!1:(this.shortcuts.set(e,{...s,currentKey:t}),this.saveShortcuts(),!0)}resetShortcut(e){const t=this.shortcuts.get(e);t&&(this.shortcuts.set(e,{...t,currentKey:t.defaultKey}),this.saveShortcuts())}resetAllShortcuts(){this.shortcuts.forEach((e,t)=>{this.shortcuts.set(t,{...e,currentKey:e.defaultKey})}),this.saveShortcuts()}findConflict(e,t){for(const[s,i]of this.shortcuts)if(s!==t&&i.currentKey.toLowerCase()===e.toLowerCase())return i;return null}getPresets(){return nS}getActivePreset(){return this.activePreset}applyPreset(e){const t=nS.find(s=>s.id===e);t&&(this.resetAllShortcuts(),Object.entries(t.shortcuts).forEach(([s,i])=>{const n=this.shortcuts.get(s);n&&this.shortcuts.set(s,{...n,currentKey:i})}),this.activePreset=e,this.saveShortcuts(),this.savePreset())}formatShortcut(e){const t=this.shortcuts.get(e);if(!t)return"";const s=Vy(t.currentKey);return nN(s)}getCategories(){return["playback","editing","selection","timeline","view","file","tools"]}getCategoryName(e){return{playback:"Playback",editing:"Editing",selection:"Selection",timeline:"Timeline",view:"View",file:"File",tools:"Tools"}[e]}}const Es=new CZ;function SZ(r){const e=Vy(r);return nN(e)}const TZ=({isOpen:r,onClose:e})=>{const[t,s]=v.useState(""),[i,n]=v.useState("all"),[a,o]=v.useState([]),[l,d]=v.useState(null),[u,h]=v.useState(!1),[p,f]=v.useState(Es.getActivePreset());v.useEffect(()=>{o(Es.getAllShortcuts())},[]),v.useEffect(()=>{const S=A=>{A.key==="Escape"&&r&&(l?d(null):e())};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[r,e,l]);const m=a.filter(S=>{const A=i==="all"||S.category===i,T=t===""||S.name.toLowerCase().includes(t.toLowerCase())||S.description.toLowerCase().includes(t.toLowerCase());return A&&T}),g=m.reduce((S,A)=>(S[A.category]||(S[A.category]=[]),S[A.category].push(A),S),{}),y=v.useCallback((S,A)=>{if(S.preventDefault(),S.stopPropagation(),S.key==="Escape"){d(null);return}if(["Shift","Control","Alt","Meta"].includes(S.key))return;const T=[];(S.metaKey||S.ctrlKey)&&T.push("cmd"),S.shiftKey&&T.push("shift"),S.altKey&&T.push("alt"),T.push(S.key.toLowerCase());const j=T.join("+"),_=Es.findConflict(j,A);if(_){alert(`This shortcut conflicts with "${_.name}". Choose a different key.`);return}Es.setShortcut(A,j),o(Es.getAllShortcuts()),d(null)},[]),x=S=>{Es.resetShortcut(S),o(Es.getAllShortcuts())},b=()=>{confirm("Reset all shortcuts to defaults?")&&(Es.resetAllShortcuts(),o(Es.getAllShortcuts()))},w=S=>{Es.applyPreset(S),o(Es.getAllShortcuts()),f(S),h(!1)},C=Es.getCategories(),k=Es.getPresets();return r?c.jsx(Ta,{open:!0,onOpenChange:S=>!S&&e(),children:c.jsxs(Sn,{className:"max-w-3xl max-h-[80vh] p-0 gap-0 bg-background-secondary border-border overflow-hidden flex flex-col",children:[c.jsx(Aa,{className:"p-4 border-b border-border bg-background-tertiary space-y-0",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx(Rw,{size:20,className:"text-primary"}),c.jsx(ja,{className:"text-lg font-bold text-text-primary",children:"Keyboard Shortcuts"})]})}),c.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-border",children:[c.jsxs("div",{className:"flex-1 relative",children:[c.jsx(jo,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-text-muted z-10"}),c.jsx(Ms,{type:"text",value:t,onChange:S=>s(S.target.value),placeholder:"Search shortcuts...",className:"pl-9 bg-background-tertiary border-border text-text-primary"})]}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{onClick:()=>h(!u),className:"flex items-center gap-2 px-3 py-2 bg-background-tertiary border border-border rounded-lg text-sm text-text-secondary hover:text-text-primary transition-colors",children:[c.jsx("span",{children:k.find(S=>S.id===p)?.name||"Preset"}),c.jsx(ls,{size:14})]}),u&&c.jsx("div",{className:"absolute top-full right-0 mt-1 w-48 bg-background-secondary border border-border rounded-lg shadow-lg z-10",children:k.map(S=>c.jsxs("button",{onClick:()=>w(S.id),className:`w-full text-left px-3 py-2 text-sm transition-colors ${p===S.id?"bg-primary/10 text-primary":"text-text-secondary hover:bg-background-tertiary hover:text-text-primary"}`,children:[c.jsx("div",{className:"font-medium",children:S.name}),c.jsx("div",{className:"text-[10px] text-text-muted",children:S.description})]},S.id))})]}),c.jsxs("button",{onClick:b,className:"flex items-center gap-1 px-3 py-2 text-sm text-text-muted hover:text-text-primary transition-colors",children:[c.jsx($i,{size:14}),"Reset All"]})]}),c.jsxs("div",{className:"flex gap-2 px-4 py-2 border-b border-border overflow-x-auto",children:[c.jsx("button",{onClick:()=>n("all"),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${i==="all"?"bg-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-background-tertiary"}`,children:"All"}),C.map(S=>c.jsx("button",{onClick:()=>n(S),className:`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap transition-colors ${i===S?"bg-primary text-white":"text-text-secondary hover:text-text-primary hover:bg-background-tertiary"}`,children:Es.getCategoryName(S)},S))]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[Object.entries(g).map(([S,A])=>c.jsxs("div",{children:[c.jsx("h3",{className:"text-xs font-bold text-text-muted uppercase tracking-wider mb-3",children:Es.getCategoryName(S)}),c.jsx("div",{className:"space-y-1",children:A.map(T=>c.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-background-tertiary group",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"text-sm text-text-primary",children:T.name}),c.jsx("div",{className:"text-[10px] text-text-muted",children:T.description})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[l===T.id?c.jsx("input",{autoFocus:!0,onKeyDown:j=>y(j,T.id),placeholder:"Press keys...",className:"w-32 px-2 py-1 bg-primary/20 border border-primary rounded text-sm text-center text-text-primary focus:outline-none"}):c.jsx("button",{onClick:()=>d(T.id),className:"min-w-[80px] px-3 py-1.5 bg-background-tertiary border border-border rounded text-sm font-mono text-text-primary hover:border-primary transition-colors",children:SZ(T.currentKey)}),T.currentKey!==T.defaultKey&&c.jsx("button",{onClick:()=>x(T.id),className:"p-1 text-text-muted hover:text-text-primary opacity-0 group-hover:opacity-100 transition-opacity",title:"Reset to default",children:c.jsx($i,{size:12})})]})]},T.id))})]},S)),m.length===0&&c.jsxs("div",{className:"text-center py-8 text-text-muted",children:[c.jsx(Rw,{size:32,className:"mx-auto mb-2 opacity-30"}),c.jsx("p",{className:"text-sm",children:"No shortcuts found"})]})]}),c.jsx("div",{className:"p-3 border-t border-border bg-background-tertiary text-center",children:c.jsxs("p",{className:"text-[10px] text-text-muted",children:["Click a shortcut key to customize  Press"," ",c.jsx("kbd",{className:"px-1.5 py-0.5 bg-background-secondary border border-border rounded text-[10px]",children:"?"})," ","to toggle this overlay"]})})]})}):null};class AZ extends Ye.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("[ErrorBoundary] Component error:",e,t),this.props.onError?.(e,t)}handleRetry=()=>{this.setState({hasError:!1,error:null})};render(){return this.state.hasError?this.props.fallback?this.props.fallback:c.jsxs("div",{className:"flex flex-col items-center justify-center p-8 text-center bg-background-secondary/50 rounded-lg m-2",children:[c.jsx("div",{className:"text-red-400 text-sm font-medium mb-2",children:"Something went wrong"}),c.jsx("div",{className:"text-text-muted text-xs mb-4 max-w-xs",children:this.state.error?.message||"An unexpected error occurred"}),c.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-primary/20 hover:bg-primary/30 text-primary text-xs rounded transition-colors",children:"Retry"})]}):this.props.children}}const Gl=({name:r,children:e})=>c.jsx(AZ,{fallback:c.jsx("div",{className:"flex-1 flex items-center justify-center p-4 text-center",children:c.jsxs("div",{className:"text-text-muted text-xs",children:[r," failed to load. Please refresh the page."]})}),children:e});function jZ(){const[r,e]=v.useState(!1),{undo:t,redo:s,splitClip:i,removeClip:n,rippleDeleteClip:a,copyClips:o,pasteClips:l,duplicateClip:d,getClip:u,project:h,addMarker:p}=W(),{getSelectedClipIds:f,clearSelection:m,toggleSnap:g,select:y}=Ft(),{togglePlayback:x,seekRelative:b,seekTo:w,playheadPosition:C,zoomIn:k,zoomOut:S,zoomToFit:A}=$t(),T=v.useCallback(()=>{x()},[x]),j=v.useCallback(()=>{b(-1/30)},[b]),_=v.useCallback(()=>{b(1/30)},[b]),M=v.useCallback(()=>{b(-1)},[b]),P=v.useCallback(()=>{b(1)},[b]),R=v.useCallback(()=>{b(-5)},[b]),D=v.useCallback(()=>{b(5)},[b]),B=v.useCallback(()=>{w(0)},[w]),O=v.useCallback(()=>{let ge=0;for(const Ce of h.timeline.tracks)for(const He of Ce.clips){const Ze=He.startTime+He.duration;Ze>ge&&(ge=Ze)}w(ge)},[w,h.timeline.tracks]),F=v.useCallback(()=>{const ge=C;let Ce=0;for(const He of h.timeline.tracks)for(const Ze of He.clips){const Mt=Ze.startTime+Ze.duration;Ze.startTime<ge-.001&&Ze.startTime>Ce&&(Ce=Ze.startTime),Mt<ge-.001&&Mt>Ce&&(Ce=Mt)}w(Ce)},[w,h.timeline.tracks,C]),I=v.useCallback(()=>{const ge=C;let Ce=1/0;for(const He of h.timeline.tracks)for(const Ze of He.clips){const Mt=Ze.startTime+Ze.duration;Ze.startTime>ge+.001&&Ze.startTime<Ce&&(Ce=Ze.startTime),Mt>ge+.001&&Mt<Ce&&(Ce=Mt)}Ce!==1/0&&w(Ce)},[w,h.timeline.tracks,C]),J=v.useCallback(()=>{t()},[t]),Z=v.useCallback(()=>{s()},[s]),E=v.useCallback(()=>{const ge=f();ge.length>0&&o(ge)},[f,o]),G=v.useCallback(()=>{const ge=f();ge.length>0&&(o(ge),ge.forEach(Ce=>n(Ce)))},[f,o,n]),V=v.useCallback(()=>{const ge=C,Ce=h.timeline.tracks[0];Ce&&l(Ce.id,ge)},[l,C,h.timeline.tracks]),U=v.useCallback(()=>{const ge=f();ge.length===1&&d(ge[0])},[f,d]),oe=v.useCallback(()=>{f().forEach(Ce=>n(Ce)),m()},[f,n,m]),re=v.useCallback(()=>{f().forEach(Ce=>a(Ce)),m()},[f,a,m]),ne=v.useCallback(()=>{const ge=f();if(ge.length===1){const Ce=C,He=u(ge[0]);He&&Ce>He.startTime&&Ce<He.startTime+He.duration&&i(ge[0],Ce)}},[f,C,u,i]),Ee=v.useCallback(()=>{const ge=f();if(ge.length===1){const Ce=C;W.getState().trimToPlayhead(ge[0],Ce,!0)}},[f,C]),K=v.useCallback(()=>{const ge=f();if(ge.length===1){const Ce=C;W.getState().trimToPlayhead(ge[0],Ce,!1)}},[f,C]),me=v.useCallback(()=>{for(const ge of h.timeline.tracks)for(const Ce of ge.clips)y({id:Ce.id,type:"clip"})},[y,h.timeline.tracks]),$=v.useCallback(()=>{m()},[m]),Q=v.useCallback(()=>{g()},[g]),le=v.useCallback(()=>{k()},[k]),ke=v.useCallback(()=>{S()},[S]),de=v.useCallback(()=>{let ge=0;for(const Ce of h.timeline.tracks)for(const He of Ce.clips){const Ze=He.startTime+He.duration;Ze>ge&&(ge=Ze)}A(ge||60)},[A,h.timeline.tracks]),ae=v.useCallback(()=>{e(!0)},[]),Pe=v.useCallback(()=>{},[]),z=v.useCallback(()=>{},[]),Ue=v.useCallback(()=>{},[]),Je=v.useCallback(()=>{const ge=C,Ce=h.timeline.markers.length;p(ge,`Marker ${Ce+1}`,"#3b82f6")},[C,h.timeline.markers.length,p]);return v.useEffect(()=>{const Ce=[["playback.playPause",T],["playback.frameBack",j],["playback.frameForward",_],["playback.secondBack",M],["playback.secondForward",P],["playback.jump5Back",R],["playback.jump5Forward",D],["playback.goToStart",B],["playback.goToEnd",O],["playback.prevClip",F],["playback.nextClip",I],["editing.undo",J],["editing.redo",Z],["editing.cut",G],["editing.copy",E],["editing.paste",V],["editing.duplicate",U],["editing.delete",oe],["editing.rippleDelete",re],["editing.split",ne],["editing.trimStart",Ee],["editing.trimEnd",K],["selection.selectAll",me],["selection.deselect",$],["timeline.toggleSnap",Q],["timeline.zoomIn",le],["timeline.zoomOut",ke],["timeline.fitTimeline",de],["view.showShortcuts",ae],["file.save",Pe],["file.export",z],["tools.addText",Ue],["tools.addMarker",Je]].map(([He,Ze])=>Es.registerHandler(He,Ze));return Es.startListening(),()=>{Ce.forEach(He=>He()),Es.stopListening()}},[T,j,_,M,P,R,D,B,O,F,I,J,Z,G,E,V,U,oe,re,ne,Ee,K,me,$,Q,le,ke,de,ae,Pe,z,Ue,Je]),{showShortcutsOverlay:r,setShowShortcutsOverlay:e}}const _Z=()=>{const{initializeAutoSave:r}=W();v.useEffect(()=>{r().catch(console.error)},[r])},EZ=()=>{const{initialize:r,initialized:e,initializing:t,initError:s}=fe(),[i,n]=v.useState(!1),[a,o]=v.useState("Starting..."),[l,d]=v.useState(null);return v.useEffect(()=>{let u=!0;return(async()=>{try{const p=fe.getState();if(!p.initialized&&!p.initializing?(o("Initializing video engine..."),await r()):p.initializing&&await new Promise(x=>{const b=fe.subscribe(w=>{(w.initialized||w.initError)&&(b(),x())})}),!u)return;const f=fe.getState();if(!f.initialized)throw new Error(f.initError||"Engine initialization failed");if(o("Initializing media bridge..."),await Ny(),!u||(o("Initializing playback bridge..."),await aJ(),!u)||(o("Initializing render bridge..."),await AK(),!u))return;o("Initializing effects bridge...");const m=W.getState(),{width:g,height:y}=m.project.settings;try{await NX(g,y)}catch(x){console.error("[EditorInterface] EffectsBridge initialization failed:",x)}if(!u)return;o("Initializing transition bridge...");try{EK(g,y)}catch(x){console.error("[EditorInterface] TransitionBridge initialization failed:",x)}if(!u)return;n(!0)}catch(p){console.error("Failed to initialize engines/bridges:",p),u&&(d(p instanceof Error?p.message:"Unknown error"),o(`Error: ${p instanceof Error?p.message:"Unknown error"}`))}})(),()=>{u=!1,oJ(),VX(),jK(),RX(),MK()}},[r,e,t]),{initialized:e&&i,initializing:t||!i&&e,initError:s||l,initStatus:a}},Uy=()=>{const{initialized:r,initializing:e,initError:t,initStatus:s}=EZ(),{showShortcutsOverlay:i,setShowShortcutsOverlay:n}=jZ();_Z();const{keyframeEditorOpen:a,setKeyframeEditorOpen:o,getSelectedClipIds:l}=Ft(),{project:d,updateClipKeyframes:u}=W(),h=d.timeline.tracks,[p,f]=Ye.useState([]),[m,g]=Ye.useState([]),y=Ye.useMemo(()=>{const _=l();if(_.length===0)return null;const M=_[0];for(const P of h){const R=P.clips.find(D=>D.id===M);if(R)return R}return null},[l,h]),x=Ye.useCallback((_,M)=>{if(!y?.keyframes)return;const P=y.keyframes.map(R=>R.id===_?{...R,...M}:R);u(y.id,P)},[y,u]),b=Ye.useCallback(_=>{if(!y?.keyframes)return;const M=y.keyframes.filter(P=>P.id!==_);u(y.id,M),f(P=>P.filter(R=>R!==_))},[y,u]),w=Ye.useCallback(_=>{if(!y?.keyframes)return;const M=y.keyframes.filter(P=>_.includes(P.id));g(M)},[y]),C=Ye.useCallback((_,M)=>{const P=h.flatMap(D=>D.clips).find(D=>D.id===_);if(!P)return;const R=m.map(D=>({...D,id:`kf-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,time:D.time+M}));u(_,[...P.keyframes||[],...R])},[m,h,u]),k=Ye.useCallback((_,M)=>{f(M?P=>P.includes(_)?P.filter(R=>R!==_):[...P,_]:[_])},[]),[S,A]=v.useState(320),T=v.useRef(!1),j=v.useCallback(_=>{_.preventDefault(),T.current=!0,document.body.style.cursor="row-resize",document.body.style.userSelect="none"},[]);return v.useEffect(()=>{const _=P=>{if(!T.current)return;const R=window.innerHeight-P.clientY,D=window.innerHeight*.6;A(Math.max(200,Math.min(R,D)))},M=()=>{T.current=!1,document.body.style.cursor="",document.body.style.userSelect=""};return window.addEventListener("mousemove",_),window.addEventListener("mouseup",M),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",M)}},[]),e||!r?c.jsx("div",{className:"w-full h-full bg-background flex items-center justify-center",children:c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"}),c.jsx("p",{className:"text-text-secondary text-sm",children:"Initializing editor..."}),c.jsx("p",{className:"text-text-muted text-xs mt-2",children:s}),t&&c.jsx("p",{className:"text-red-500 text-xs mt-2",children:t})]})}):c.jsxs("div",{className:"w-full h-full bg-background flex flex-col overflow-hidden font-sans select-none relative z-20 text-xs text-text-secondary",children:[c.jsx(fK,{}),c.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[c.jsx(Gl,{name:"Assets Panel",children:c.jsx(SK,{})}),c.jsx(Gl,{name:"Preview",children:c.jsx(eQ,{})}),c.jsx(Gl,{name:"Inspector",children:c.jsx(eZ,{})}),a&&c.jsx(Gl,{name:"Keyframe Editor",children:c.jsx(wZ,{clip:y,onClose:()=>o(!1),onUpdateKeyframe:x,onDeleteKeyframe:b,onCopyKeyframes:w,onPasteKeyframes:C,selectedKeyframeIds:p,onSelectKeyframe:k,copiedKeyframes:m})})]}),c.jsx("div",{className:"h-1 bg-border hover:bg-primary/50 cursor-row-resize transition-colors z-10 relative group",onMouseDown:j,children:c.jsx("div",{className:"absolute inset-x-0 -top-1 -bottom-1 bg-transparent"})}),c.jsx("div",{style:{height:S},className:"shrink-0 flex flex-col",children:c.jsx(Gl,{name:"Timeline",children:c.jsx(bZ,{})})}),c.jsx(TZ,{isOpen:i,onClose:()=>n(!1)}),c.jsx(cK,{}),c.jsx(pK,{})]})},MZ=Object.freeze(Object.defineProperty({__proto__:null,EditorInterface:Uy,default:Uy},Symbol.toStringTag,{value:"Module"})),PZ={"1080x1920":"tiktok","1920x1080":"youtube-video","1080x1080":"instagram-post","720x1280":"instagram-stories","1280x720":"youtube-video"};function NZ(){const{activeModal:r,closeModal:e,skipWelcomeScreen:t}=Ft(),{openModal:s}=Ft(),i=W(k=>k.createNewProject),{showDialog:n,availableSaves:a,recover:o,dismiss:l,clearAll:d}=P7(),{route:u,params:h,navigate:p,parsedDimensions:f,fps:m}=Jb(),g=v.useRef(!1),y=typeof window<"u"&&new URLSearchParams(window.location.search).get("embedded")==="true";R7({enabled:y}),v.useEffect(()=>{if(!g.current)if(u==="new"){g.current=!0;let k="New Project",S=1920,A=1080,T=m;if(h.preset){const j=h.preset,_=Ap[j];_&&(S=_.width,A=_.height,T=_.frameRate||m,k=`New ${j.charAt(0).toUpperCase()+j.slice(1).replace(/-/g," ")} Project`)}else if(f){S=f.width,A=f.height;const j=`${S}x${A}`,_=PZ[j];_&&(T=Ap[_].frameRate||m);const M=S/A;M<1?k="New Vertical Video":M>1?k="New Horizontal Video":k="New Square Video"}i(k,{width:S,height:A,frameRate:T}),p("editor")}else(u==="editor"&&t||["welcome","templates","recent"].includes(u))&&(g.current=!0)},[u,h,f,m,i,p,t]);const x=v.useCallback(k=>{k.key==="Escape"&&u!=="editor"&&p("editor"),(k.metaKey||k.ctrlKey)&&k.key==="k"&&(k.preventDefault(),s("search"))},[u,p,s]);v.useEffect(()=>(window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)),[x]);const b=["welcome","templates","recent"].includes(u)&&!t&&!y,w=u==="templates"?"templates":u==="recent"?"recent":void 0,C=u==="share"&&h.shareId;return c.jsx(VG,{children:c.jsxs("div",{className:"h-screen w-screen bg-background text-text-primary overflow-hidden",children:[!y&&c.jsx(o7,{}),C?c.jsx(M7,{shareId:h.shareId}):b?c.jsx(S7,{initialTab:w}):c.jsx(Uy,{}),c.jsx(V$,{}),c.jsx(t7,{isOpen:r==="scriptView",onClose:e}),c.jsx(a7,{isOpen:r==="search",onClose:e}),n&&a.length>0&&c.jsx(T7,{saves:a,onRecover:async k=>{await o(k)&&p("editor")},onDismiss:l,onClearAll:d})]})})}class RZ{registration=null;listeners=new Map;isOnline=typeof navigator<"u"?navigator.onLine:!0;constructor(){typeof window<"u"&&(window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline))}isSupported(){return typeof navigator<"u"&&"serviceWorker"in navigator}async register(){if(!this.isSupported())return console.warn("[SW Manager] Service workers not supported"),null;try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return this.registration=e,e.addEventListener("updatefound",()=>{this.handleUpdateFound(e)}),setInterval(()=>{this.checkForUpdates()},60*60*1e3),this.emit("registered",{registration:e}),e}catch(e){return console.error("[SW Manager] Registration failed:",e),this.emit("error",{error:e}),null}}async unregister(){if(!this.registration)return!1;try{const e=await this.registration.unregister();return e&&(this.registration=null),e}catch(e){return console.error("[SW Manager] Unregistration failed:",e),!1}}async checkForUpdates(){if(this.registration)try{await this.registration.update()}catch(e){console.error("[SW Manager] Update check failed:",e)}}async skipWaiting(){this.registration?.waiting&&this.sendMessage({type:"SKIP_WAITING"})}getStatus(){return{supported:this.isSupported(),registered:!!this.registration,active:!!this.registration?.active,waiting:!!this.registration?.waiting,updateAvailable:!!this.registration?.waiting}}async getCacheStatus(){return this.sendMessageWithResponse({type:"GET_CACHE_STATUS"})}async clearCache(){await this.sendMessageWithResponse({type:"CLEAR_CACHE"})}getOnlineStatus(){return this.isOnline}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.get(e)?.delete(t)}sendMessage(e){this.registration?.active&&this.registration.active.postMessage(e)}sendMessageWithResponse(e){return new Promise(t=>{if(!this.registration?.active){t(null);return}const s=new MessageChannel;s.port1.onmessage=i=>{t(i.data?.payload||null)},this.registration.active.postMessage(e,[s.port2]),setTimeout(()=>t(null),5e3)})}handleUpdateFound(e){const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&this.emit("updated",{registration:e})})}handleOnline=()=>{this.isOnline=!0,this.emit("online")};handleOffline=()=>{this.isOnline=!1,this.emit("offline")};emit(e,t){this.listeners.get(e)?.forEach(s=>{try{s(t)}catch(i){console.error("[SW Manager] Event callback error:",i)}})}destroy(){typeof window<"u"&&(window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)),this.listeners.clear()}}const IZ=new RZ;async function DZ(){return typeof window<"u"&&new URLSearchParams(window.location.search).get("embedded")==="true"?null:IZ.register()}DZ().then(r=>{});const FZ=document.getElementById("root");IN.createRoot(FZ).render(c.jsx(Ye.StrictMode,{children:c.jsx(NZ,{})}));export{pW as $,WG as A,u9 as B,h9 as C,_s as D,MX as E,r9 as F,p9 as G,g9 as H,HG as I,Lh as J,y9 as K,x9 as L,s9 as M,e9 as N,b9 as O,JG as P,oW as Q,kM as R,Ap as S,Su as T,z9 as U,Ln as V,m9 as W,sy as X,iy as Y,ry as Z,hW as _,ag as a,Oh as a$,CM as a0,Cu as a1,fW as a2,mW as a3,gW as a4,yW as a5,xW as a6,bW as a7,V9 as a8,U9 as a9,RW as aA,AW as aB,jW as aC,_W as aD,EW as aE,xC as aF,bC as aG,MW as aH,IW as aI,DW as aJ,FW as aK,Ab as aL,BW as aM,LW as aN,AM as aO,sh as aP,$W as aQ,WW as aR,UW as aS,GW as aT,tY as aU,sY as aV,_M as aW,iY as aX,rY as aY,nY as aZ,TM as a_,G9 as aa,gc as ab,wM as ac,pi as ad,vW as ae,Fl as af,SM as ag,wW as ah,kW as ai,Wc as aj,A9 as ak,Jn as al,j9 as am,K9 as an,Q9 as ao,q9 as ap,H9 as aq,X9 as ar,fC as as,J9 as at,Z9 as au,eW as av,tW as aw,CW as ax,TW as ay,NW as az,c2 as b,yX as b$,OW as b0,v9 as b1,w9 as b2,S9 as b3,go as b4,C9 as b5,_p as b6,jb as b7,Um as b8,vC as b9,WY as bA,YY as bB,qY as bC,qm as bD,KY as bE,JY as bF,Ll as bG,rh as bH,ZY as bI,ni as bJ,k9 as bK,tX as bL,sX as bM,e2 as bN,eX as bO,zP as bP,Ay as bQ,Gi as bR,nW as bS,eu as bT,VP as bU,nX as bV,aX as bW,fX as bX,_y as bY,r2 as bZ,gX as b_,wC as ba,aY as bb,oY as bc,cY as bd,_b as be,hY as bf,pY as bg,fY as bh,wY as bi,CC as bj,SC as bk,Gm as bl,BY as bm,LY as bn,OY as bo,TC as bp,Tm as bq,Ep as br,T9 as bs,br as bt,$Y as bu,zY as bv,bee as bw,VY as bx,UY as by,GY as bz,pM as c,UP as c0,vX as c1,wX as c2,dg as d,bm as e,GG as f,dd as g,Xu as h,rd as i,XG as j,KG as k,tt as l,fM as m,QG as n,Dl as o,ZG as p,Ac as q,mM as r,UG as s,gM as t,yM as u,xM as v,oC as w,bM as x,cC as y,Bh as z};
