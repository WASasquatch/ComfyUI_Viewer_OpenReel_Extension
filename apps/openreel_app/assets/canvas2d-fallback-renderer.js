class u{type="canvas2d";canvas;ctx=null;width;height;deviceLostCallbacks=[];layers=[];constructor(e){this.width=e.width,this.height=e.height,this.canvas=new OffscreenCanvas(e.width,e.height)}async initialize(){try{return this.ctx=this.canvas.getContext("2d"),this.ctx!==null}catch{return!1}}isSupported(){return!0}destroy(){this.ctx=null,this.deviceLostCallbacks=[],this.layers=[]}beginFrame(){this.ctx&&(this.ctx.clearRect(0,0,this.width,this.height),this.layers=[])}renderLayer(e){this.layers.push(e)}async endFrame(){if(!this.ctx)throw new Error("Canvas2D context not initialized");for(const e of this.layers)await this.renderLayerToCanvas(e);return createImageBitmap(this.canvas)}async renderLayerToCanvas(e){if(!this.ctx)return;const t=this.ctx,{transform:a,opacity:i,borderRadius:s}=e;let n;if(e.texture instanceof ImageBitmap)n=e.texture;else return;t.save(),t.globalAlpha=i*a.opacity;const r=this.width/2+a.position.x,h=this.height/2+a.position.y;t.translate(r,h),t.rotate(a.rotation*Math.PI/180),t.scale(a.scale.x,a.scale.y);const c=-n.width*a.anchor.x,o=-n.height*a.anchor.y;s>0&&(t.beginPath(),this.roundRect(t,c,o,n.width,n.height,s),t.clip()),t.drawImage(n,c,o),t.restore()}roundRect(e,t,a,i,s,n){const r=Math.min(n,i/2,s/2);e.moveTo(t+r,a),e.lineTo(t+i-r,a),e.quadraticCurveTo(t+i,a,t+i,a+r),e.lineTo(t+i,a+s-r),e.quadraticCurveTo(t+i,a+s,t+i-r,a+s),e.lineTo(t+r,a+s),e.quadraticCurveTo(t,a+s,t,a+s-r),e.lineTo(t,a+r),e.quadraticCurveTo(t,a,t+r,a),e.closePath()}createTextureFromImage(e){return e}releaseTexture(e){}applyEffects(e,t){return e}onDeviceLost(e){this.deviceLostCallbacks.push(e)}async recreateDevice(){return!0}resize(e,t){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t}getMemoryUsage(){return this.width*this.height*4}getDevice(){return null}}export{u as Canvas2DFallbackRenderer};
