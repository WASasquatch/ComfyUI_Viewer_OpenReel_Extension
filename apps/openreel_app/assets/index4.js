const w=new Error("failed to get response body reader"),R=new Error("failed to complete download"),g="Content-Length",y=async(o,e)=>{const r=await fetch(o);let n;try{const t=parseInt(r.headers.get(g)||"-1"),d=r.body?.getReader();if(!d)throw w;const l=[];let s=0;for(;;){const{done:a,value:c}=await d.read(),f=c?c.length:0;if(a){if(t!=-1&&t!==s)throw R;e&&e({url:o,total:t,received:s,delta:f,done:a});break}l.push(c),s+=f,e&&e({url:o,total:t,received:s,delta:f,done:a})}const i=new Uint8Array(s);let h=0;for(const a of l)i.set(a,h),h+=a.length;n=i.buffer}catch(t){console.log("failed to send download progress event: ",t),n=await r.arrayBuffer(),e&&e({url:o,total:n.byteLength,received:n.byteLength,delta:0,done:!0})}return n},E=async(o,e,r=!1,n)=>{const t=r?await y(o,n):await(await fetch(o)).arrayBuffer(),d=new Blob([t],{type:e});return URL.createObjectURL(d)};export{y as downloadWithProgress,E as toBlobURL};
